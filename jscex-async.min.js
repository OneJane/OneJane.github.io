!function(){function r(){}function o(e){return"function"==typeof e.start&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener&&"function"==typeof e.complete}function s(s){if(!s.modules.async){function e(){}e.prototype={register:function(e){this.isCancellationRequested&&e(),this._handlers||(this._handlers=[]),this._handlers.push(e)},unregister:function(e){this._handlers&&(0<=(e=this._handlers.indexOf(e))&&this._handlers.splice(e,1))},cancel:function(){if(!this.isCancellationRequested){this.isCancellationRequested=!0;var e=this._handlers;delete this._handlers;for(var t=0;t<e.length;t++)try{e[t]()}catch(e){s.logger.warn("[WARNING] Cancellation handler threw an error: "+e)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested)throw new r}};function n(e){this.id=++__jscex__async__taskIdSeed,this._delegate=e,this._listeners={},this.status="ready"}n.prototype={start:function(){if("ready"!=this.status)throw Error('Task can only be started in "ready" status.');this.status="running",this._delegate(this)},complete:function(e,t){if("running"!=this.status)throw Error('The "complete" method can only be called in "running" status.');var n=this._listeners;if(delete this._listeners,"success"==e)this.result=t,this.status="succeeded",this._notify("success",n.success);else{if("failure"!=e)throw Error("Unsupported type: "+e);this.error=t,this.status=t.isCancellation?"canceled":"faulted",this._notify("failure",n.failure)}this._notify("complete",n.complete),!this.error||n.failure||n.complete||s.logger.warn("[WARNING] An unhandled error occurred: "+this.error)},_notify:function(t,e){if(e)for(var n=0;n<e.length;n++)try{e[n](this)}catch(e){s.logger.warn("[WARNING] The task's "+t+" listener threw an error: "+e)}},addEventListener:function(e,t){this._listeners&&(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t))},removeEventListener:function(e,t){this._listeners&&(!(e=this._listeners[e])||0<=(t=e.indexOf(t))&&e.splice(t,1))}},n.create=function(e){return new n(e)},n.isTask=o;function t(){}for(var i in t.prototype={Start:function(e,t){return n.create(function(n){t.next(e,function(e,t){if("normal"==e||"return"==e)n.complete("success",t);else{if("throw"!=e)throw Error("Unsupported type: "+e);n.complete("failure",t)}})})},Bind:function(t,i){return{next:function(n,s){function e(e){if(e.error)s("throw",e.error);else{var t;try{t=i.call(n,e.result)}catch(e){return void s("throw",e)}t.next(n,s)}}"ready"==t.status?(t.addEventListener("complete",e),t.start()):"running"==t.status?t.addEventListener("complete",e):e(t)}}}},s.BuilderBase.prototype)t.prototype[i]=s.BuilderBase.prototype[i];s.Async||(s.Async={}),(i=s.Async).CancellationToken=e,i.CanceledError=r,i.Task=n,i.AsyncBuilder=t,s.builders||(s.builders={}),s.binders.async="$await",s.builders.async=new t,s.modules.async=!0}}r.prototype={isCancellation:!0,message:"The task has been cancelled."},"undefined"==typeof __jscex__async__taskIdSeed&&(__jscex__async__taskIdSeed=0);var e="function"==typeof define&&!define.amd,t="function"==typeof require&&"function"==typeof define&&define.amd;if("function"==typeof require&&"undefined"!=typeof module&&module.exports)module.exports.init=function(e){if(!e.modules.builderbase){if("string"==typeof __dirname)try{require.paths.unshift(__dirname)}catch(e){try{module.paths.unshift(__dirname)}catch(e){}}require("jscex-builderbase").init(e)}s(e)};else if(e)define("jscex-async",["jscex-builderbase"],function(t,e,n){n.exports.init=function(e){e.modules.builderbase||t("jscex-builderbase").init(e),s(e)}});else if(t)define("jscex-async",["jscex-builderbase"],function(t){return{init:function(e){e.modules.builderbase||t.init(e),s(e)}}});else{if("undefined"==typeof Jscex)throw Error('Missing the root object, please load "jscex" module first.');if(!Jscex.modules.builderbase)throw Error('Missing essential components, please initialize "builderbase" module first.');s(Jscex)}}();