<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="frida常用api大全"><meta name="keywords" content="frida"><meta name="author" content="J"><meta name="copyright" content="J"><title>frida常用api大全 | 万物皆可逆向</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.2.1"}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#篇幅有限"><span class="toc-number">1.</span> <span class="toc-text">篇幅有限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动静态函数"><span class="toc-number">2.</span> <span class="toc-text">动静态函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#静态函数-use"><span class="toc-number">2.1.</span> <span class="toc-text">静态函数 use</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例函数-choose"><span class="toc-number">2.2.</span> <span class="toc-text">实例函数 choose</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#so导出函数"><span class="toc-number">3.</span> <span class="toc-text">so导出函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#so偏移地址"><span class="toc-number">4.</span> <span class="toc-text">so偏移地址</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JNIEnv函数"><span class="toc-number">5.</span> <span class="toc-text">JNIEnv函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动静态变量修改"><span class="toc-number">6.</span> <span class="toc-text">动静态变量修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#构造函数-实例化"><span class="toc-number">7.</span> <span class="toc-text">构造函数 实例化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook实例化"><span class="toc-number">8.</span> <span class="toc-text">Hook实例化</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook构造函数"><span class="toc-number">9.</span> <span class="toc-text">Hook构造函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sleep"><span class="toc-number">10.</span> <span class="toc-text">sleep</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#枚举类所有方法"><span class="toc-number">11.</span> <span class="toc-text">枚举类所有方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#特殊不可见字符"><span class="toc-number">12.</span> <span class="toc-text">特殊不可见字符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wallbreaker"><span class="toc-number">13.</span> <span class="toc-text">wallbreaker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#枚举所有类"><span class="toc-number">14.</span> <span class="toc-text">枚举所有类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#枚举接口实现"><span class="toc-number">15.</span> <span class="toc-text">枚举接口实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-Char-amp-Byte"><span class="toc-number">16.</span> <span class="toc-text">Hook Char&amp;Byte</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-Map"><span class="toc-number">17.</span> <span class="toc-text">Hook Map</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-重载"><span class="toc-number">18.</span> <span class="toc-text">Hook 重载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-内部类"><span class="toc-number">19.</span> <span class="toc-text">Hook 内部类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-匿名类"><span class="toc-number">20.</span> <span class="toc-text">Hook 匿名类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-枚举类"><span class="toc-number">21.</span> <span class="toc-text">Hook 枚举类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-动态加载dex"><span class="toc-number">22.</span> <span class="toc-text">Hook 动态加载dex</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#trace类调用栈"><span class="toc-number">23.</span> <span class="toc-text">trace类调用栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调用栈打印"><span class="toc-number">24.</span> <span class="toc-text">调用栈打印</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#手动注册类"><span class="toc-number">25.</span> <span class="toc-text">手动注册类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-Click"><span class="toc-number">26.</span> <span class="toc-text">Hook Click</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-Activity"><span class="toc-number">27.</span> <span class="toc-text">Hook Activity</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook-绕过root检测"><span class="toc-number">28.</span> <span class="toc-text">Hook 绕过root检测</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#frida主线程运行"><span class="toc-number">29.</span> <span class="toc-text">frida主线程运行</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#过滤打印"><span class="toc-number">30.</span> <span class="toc-text">过滤打印</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#禁止退出"><span class="toc-number">31.</span> <span class="toc-text">禁止退出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#修改设备参数"><span class="toc-number">32.</span> <span class="toc-text">修改设备参数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#请求调用栈"><span class="toc-number">33.</span> <span class="toc-text">请求调用栈</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#上下文Context"><span class="toc-number">34.</span> <span class="toc-text">上下文Context</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RPC"><span class="toc-number">35.</span> <span class="toc-text">RPC</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#强制类型转换"><span class="toc-number">36.</span> <span class="toc-text">强制类型转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#map2json"><span class="toc-number">37.</span> <span class="toc-text">map2json</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bytes2Hex"><span class="toc-number">38.</span> <span class="toc-text">bytes2Hex</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#string2Bytes"><span class="toc-number">39.</span> <span class="toc-text">string2Bytes</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bytes2String"><span class="toc-number">40.</span> <span class="toc-text">bytes2String</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bytes2Base64"><span class="toc-number">41.</span> <span class="toc-text">bytes2Base64</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常见算法hook"><span class="toc-number">42.</span> <span class="toc-text">常见算法hook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#base64实现"><span class="toc-number">43.</span> <span class="toc-text">base64实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常用转换模板"><span class="toc-number">44.</span> <span class="toc-text">常用转换模板</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#打印class"><span class="toc-number">45.</span> <span class="toc-text">打印class</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">86</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">69</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">10</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">万物皆可逆向</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">frida常用api大全</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-13</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">13.8k</span><span class="post-meta__separator">|</span><span>阅读时长: 81 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><div id="vip-container"><h1 id="篇幅有限"><a href="#篇幅有限" class="headerlink" title="篇幅有限"></a>篇幅有限</h1><p>完整内容及源码关注公众号：ReverseCode，发送 <strong>冲</strong></p><table><thead><tr><th align="left">java type</th><th align="left">语法</th></tr></thead><tbody><tr><td align="left">int类型</td><td align="left"><code>int</code></td></tr><tr><td align="left">float类型</td><td align="left"><code>float</code></td></tr><tr><td align="left">boolean类型</td><td align="left"><code>boolean</code></td></tr><tr><td align="left">string类型</td><td align="left"><code>java.lang.String</code></td></tr><tr><td align="left">byte类型</td><td align="left"><code>[B</code></td></tr><tr><td align="left">char类型</td><td align="left"><code>[C</code></td></tr><tr><td align="left">list结构</td><td align="left"><code>java.util.List</code></td></tr><tr><td align="left">安卓上下文</td><td align="left"><code>android.content.Context</code></td></tr></tbody></table><table><thead><tr><th align="left">符号</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><code>$init</code></td><td align="left">hook构造函数</td></tr><tr><td align="left"><code>$new()</code></td><td align="left">实例化对象用户主动调用</td></tr></tbody></table><p>frida中数组格式<code>[java.lang.String;</code></p><table><thead><tr><th><strong>java type</strong></th><th><strong>so type</strong></th></tr></thead><tbody><tr><td><code>int</code></td><td><code>I</code></td></tr><tr><td><code>float</code></td><td><code>F</code></td></tr><tr><td><code>boolean</code></td><td><code>Z</code></td></tr><tr><td><code>string</code></td><td><code>java.lang.String</code></td></tr><tr><td><code>byte</code></td><td><code>B</code></td></tr><tr><td><code>long</code></td><td><code>J</code></td></tr><tr><td><code>short</code></td><td><code>S</code></td></tr><tr><td><code>double</code></td><td><code>D</code></td></tr><tr><td><code>char</code></td><td><code>C</code></td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; byte array to string</span><br><span class="line">&#x2F;&#x2F; 方法一</span><br><span class="line">var JavaString &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">JavaString.$new(&#39;byte array&#39;).toString();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 方法二</span><br><span class="line">var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">&#x2F;&#x2F; 转成 hex 在转 string</span><br><span class="line">ByteString.of(&#39;byte array&#39;).hex();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 使用 Java.cast 把 java byet 转成 java Object</span><br><span class="line">var javaBytes &#x3D; Java.use(&#39;java.lang.String&#39;).$new(&quot;aaaaa&quot;).getBytes();</span><br><span class="line">var javaBytesClass &#x3D; Java.cast(javaBytes, Java.use(&#39;java.lang.Object&#39;)).getClass();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 使用 Java.array 把 js array 转成 java Object array</span><br><span class="line">var params &#x3D; [</span><br><span class="line">    Java.use(&#39;java.lang.String&#39;).$new(&#39;str1&#39;),</span><br><span class="line">    Java.use(&#39;java.lang.String&#39;).$new(&#39;str2&#39;),</span><br><span class="line">    Java.use(&#39;java.lang.Boolean&#39;).$new(false),</span><br><span class="line">    Java.use(&#39;java.lang.Integer&#39;).$new(0)</span><br><span class="line">];</span><br><span class="line">var ps &#x3D; Java.array(&#39;Ljava.lang.Object;&#39;, params);</span><br></pre></td></tr></table></figure><h1 id="动静态函数"><a href="#动静态函数" class="headerlink" title="动静态函数"></a>动静态函数</h1><h2 id="静态函数-use"><a href="#静态函数-use" class="headerlink" title="静态函数 use"></a>静态函数 use</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">function static() &#123;</span><br><span class="line">    Java.perform(function () &#123;&#x2F;&#x2F;只要是java的代码都要跑在Java.perform里面</span><br><span class="line">        &#x2F;&#x2F; hook</span><br><span class="line">        Java.use(&quot;com.example.junior.util.Utils&quot;).dip2px.implementation &#x3D; function (context, float) &#123;</span><br><span class="line">            &#x2F;&#x2F;return null;</span><br><span class="line">            var result &#x3D; this.dip2px(context, 100)</span><br><span class="line">            console.log(&quot;context,float,result  &#x3D;&#x3D;&gt; &quot;, context, float, result);</span><br><span class="line">            &#x2F;&#x2F; 打印log</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            return 26;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">		Java.use(&#39;com.xx.app.ShufferMap&#39;).show.implementation &#x3D; function (map) &#123;</span><br><span class="line">       		 console.log(JSON.stringify(map));</span><br><span class="line">			var hm &#x3D; Java.use(&#39;java.util.HashMap&#39;).$new();</span><br><span class="line">			hm.put(&quot;user&quot;,&quot;dajianbang&quot;);</span><br><span class="line">			hm.put(&quot;pass&quot;,&quot;87654321&quot;);</span><br><span class="line">			hm.put(&quot;code&quot;,&quot;123456&quot;);</span><br><span class="line">			return this.show(hm);</span><br><span class="line">		&#125;     </span><br><span class="line">        </span><br><span class="line">        var myBytes &#x3D; StringClass.$new(&quot;Hello World&quot;).getBytes();</span><br><span class="line">        var base64Class &#x3D; Java.use(&quot;android.util.Base64&quot;);</span><br><span class="line">        &#x2F;&#x2F; 主动调用</span><br><span class="line">        var result &#x3D; Java.use(&quot;com.xiaojianbang.app.RSA&quot;).encrypt(myBytes);</span><br><span class="line">        console.log(&quot;result is :&quot;, result);</span><br><span class="line">        console.log(JSON.stringify(result));</span><br><span class="line">        console.log(&quot;base64 result is :&quot;, base64Class.encodeToString(result,0));        </span><br><span class="line">        </span><br><span class="line">        Java.use(&quot;java.lang.String&quot;).valueOf(1); </span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实例函数-choose"><a href="#实例函数-choose" class="headerlink" title="实例函数 choose"></a>实例函数 choose</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function dynamic()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">    	&#x2F;&#x2F; 主动调用 函数</span><br><span class="line">        Java.choose(&quot;com.example.junior.CalculatorActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance &#x3D;&gt;&quot;,instance);</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.clear(&quot;666&quot;))</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.showText.value)</span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&#39;Search complete&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)  </span><br><span class="line">        Java.choose(&quot;com.xiaojianbang.app.Money&quot;,&#123;</span><br><span class="line">            onMatch : function(instance)&#123;</span><br><span class="line">                console.log(&quot;find it!!&quot;, instance.getInfo());</span><br><span class="line">            &#125;, </span><br><span class="line">            onComplete: function()&#123;</span><br><span class="line">                console.log(&quot;compelete!!!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; $new 实例化类</span><br><span class="line">        Java.use(&quot;java.lang.String&quot;).$new().toString();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="so导出函数"><a href="#so导出函数" class="headerlink" title="so导出函数"></a>so导出函数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var native_func &#x3D; Module.findExportByName(&quot;$&#123;so file name&#125;&quot;, &quot;$&#123;so export function name&#125;&quot;);</span><br><span class="line"></span><br><span class="line">Interceptor.attach(native_func, &#123;</span><br><span class="line">    &#x2F;&#x2F; 函数开始</span><br><span class="line">    onEnter: function (args) &#123;&#125;,</span><br><span class="line">    &#x2F;&#x2F; 函数结束</span><br><span class="line">    onLeave: function (return_val) &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="so偏移地址"><a href="#so偏移地址" class="headerlink" title="so偏移地址"></a>so偏移地址</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var native_func_addr &#x3D; Module.findBaseAddress(&quot;$&#123;so file name&#125;&quot;);</span><br><span class="line">var native_addr &#x3D; native_func_addr.add($&#123;so 函数偏移地址&#125;);</span><br><span class="line"></span><br><span class="line">Interceptor.attach(native_addr, &#123;</span><br><span class="line">    &#x2F;&#x2F; 函数开始</span><br><span class="line">    onEnter: function (args) &#123;</span><br><span class="line">        &#x2F;&#x2F; 读取 r0 的数据</span><br><span class="line">        this.context.r0.readCString()</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 函数结束</span><br><span class="line">    onLeave: function (return_val) &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="JNIEnv函数"><a href="#JNIEnv函数" class="headerlink" title="JNIEnv函数"></a>JNIEnv函数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 获取 JNIEnv</span><br><span class="line">var env &#x3D; Java.vm.getEnv();</span><br><span class="line">var jstring &#x3D; env.newStringUtf(&#39;xiaojianbang&#39;);</span><br></pre></td></tr></table></figure><h1 id="动静态变量修改"><a href="#动静态变量修改" class="headerlink" title="动静态变量修改"></a>动静态变量修改</h1><p>静态变量 use</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function staticField()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var divscale &#x3D; Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value;</span><br><span class="line">        console.log(&quot;divscale1 is &#x3D;&gt;&quot;,divscale);</span><br><span class="line">        Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value&#x3D;20;</span><br><span class="line">        divscale &#x3D; Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value;</span><br><span class="line">        console.log(&quot;divscale2 is &#x3D;&gt;&quot;,divscale);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态变量 choose</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function dynamicField()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.junior.CalculatorActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance &#x3D;&gt;&quot;,instance);</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.showText.value)</span><br><span class="line">                instance.showText.value &#x3D; &quot;123&quot;</span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&#39;Search complete&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="构造函数-实例化"><a href="#构造函数-实例化" class="headerlink" title="构造函数 实例化"></a>构造函数 实例化</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Utils.test(new Money(200，&quot;美元&quot;))  </span><br><span class="line">Java.perform(function () &#123;</span><br><span class="line">    var money &#x3D; Java.use(&#39;com.xx.app.Money&#39;)  &#x2F;&#x2F; 如果要自定义实例化就要获取并重写</span><br><span class="line">    var utils &#x3D; Java.use(&#39;com.xx.app.Utils&#39;);</span><br><span class="line">    utils.test.overload(&quot;com.xx.app.Money&quot;).implementation &#x3D; function (obj) &#123; </span><br><span class="line">        var myBytes &#x3D; StringClass.$new(&quot;Hello World&quot;).getBytes();</span><br><span class="line">        &#x2F;&#x2F; 重新实例化  $new()</span><br><span class="line">        var mon &#x3D; money.$new(999,&#39;我的天&#39;)</span><br><span class="line">        return mon.getInfo();  &#x2F;&#x2F; 根据需求return</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook实例化"><a href="#Hook实例化" class="headerlink" title="Hook实例化"></a>Hook实例化</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaClass.$new.implementation &#x3D; function () &#123;&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook构造函数"><a href="#Hook构造函数" class="headerlink" title="Hook构造函数"></a>Hook构造函数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; JavaClass.$init.implementation &#x3D; function () &#123;&#125;</span><br><span class="line">Java.perform(function () &#123;</span><br><span class="line">    var money &#x3D; Java.use(&#39;com.xx.app.Money&#39;);</span><br><span class="line">    money.$init.implementation &#x3D; function (a, b) &#123;</span><br><span class="line">        console.log(&quot;构造函数Hook中...&quot;, a, b);</span><br><span class="line">        return this.$init(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; hook 构造方法 $init</span><br><span class="line">    var MoneyClass &#x3D; Java.use(&quot;com.kevin.app.Money&quot;);</span><br><span class="line">    MoneyClass.$init.overload().implementation &#x3D; function () &#123;</span><br><span class="line">        console.log(&quot;hook Money $init&quot;);</span><br><span class="line">        this.$init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var StringClass &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">    var MoneyClass &#x3D; Java.use(&quot;com.xiaojianbang.app.Money&quot;);</span><br><span class="line">    MoneyClass.$init.overload(&#39;java.lang.String&#39;, &#39;int&#39;).implementation &#x3D; function (x, y) &#123;</span><br><span class="line">        console.log(&#39;hook Money init&#39;);</span><br><span class="line">        var myX &#x3D; StringClass.new(&quot;Hello World!&quot;);</span><br><span class="line">        var myY &#x3D; 9999;</span><br><span class="line">        this.$init(myX, myY);</span><br><span class="line">    &#125;	    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function sleep(numberMillis) &#123;</span><br><span class="line">    var now &#x3D; new Date();</span><br><span class="line">    var exitTime &#x3D; now.getTime() + numberMillis;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        now &#x3D; new Date();</span><br><span class="line">        if (now.getTime() &gt; exitTime)</span><br><span class="line">            return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 毫秒级别</span><br><span class="line">sleep(1000)</span><br></pre></td></tr></table></figure><h1 id="枚举类所有方法"><a href="#枚举类所有方法" class="headerlink" title="枚举类所有方法"></a>枚举类所有方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Hook类的所有方法</span><br><span class="line">Java.perform(function()&#123;</span><br><span class="line">    var md5 &#x3D; Java.use(&quot;com.xxx.xxx.xxx&quot;);</span><br><span class="line">    var methods &#x3D; md5.class.getDeclaredMethods();</span><br><span class="line">    for(var j &#x3D; 0; j &lt; methods.length; j++)&#123;</span><br><span class="line">        var methodName &#x3D; methods[j].getName();</span><br><span class="line">        console.log(methodName); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function main() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        &#x2F;&#x2F; return String[] class name</span><br><span class="line">        var classList &#x3D; Java.enumerateLoadedClassesSync();</span><br><span class="line">        for (var i &#x3D; 0; i &lt; classList.length; i++) &#123;</span><br><span class="line">            var targetClass &#x3D; classList[i];</span><br><span class="line">            if (targetClass.indexOf(&quot;com.xiaojianbang.app.Money&quot;) !&#x3D; -1) &#123;</span><br><span class="line">                console.log(&quot;hook the class: &quot;, targetClass);</span><br><span class="line">                var TargetClass &#x3D; Java.use(targetClass);</span><br><span class="line">                &#x2F;&#x2F; 利用反射获取类中的所有方法</span><br><span class="line">                var methodsList &#x3D; TargetClass.class.getDeclaredMethods();</span><br><span class="line">                for (var k &#x3D; 0; k &lt; methodsList.length; k++) &#123;</span><br><span class="line">                    console.log(methodsList[k].getName());</span><br><span class="line">  					</span><br><span class="line">                    &#x2F;&#x2F; hook methodName 这个类的所有方法（难点在于每个方法的参数是不同的）</span><br><span class="line">                    for (var k &#x3D; 0; k &lt; TargetClass[methodName].overloads.length; k++) &#123;</span><br><span class="line">                        TargetClass[methodName].overloads[k].implementation &#x3D; function () &#123;</span><br><span class="line">                            &#x2F;&#x2F; 这是 hook 逻辑</span><br><span class="line">                            for (var i &#x3D; 0; i &lt; arguments.length; i++) &#123;</span><br><span class="line">                                console.log(arguments[i]);</span><br><span class="line">                            &#125;</span><br><span class="line">                            return this[methodName].apply(this, arguments);  &#x2F;&#x2F; 重新调用</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch: function(name,handle)&#123;</span><br><span class="line">                if (name.indexOf(&quot;com.xiaojianbang.app.Money&quot;) !&#x3D; -1)&#123;</span><br><span class="line">                    console.log(name,handle);</span><br><span class="line">                    &#x2F;&#x2F; 利用反射 获取类中的所有方法</span><br><span class="line">                    var TargetClass &#x3D; Java.use(name);</span><br><span class="line">                    &#x2F;&#x2F; return Method Object List</span><br><span class="line">                    var methodsList &#x3D; TargetClass.class.getDeclaredMethods(); </span><br><span class="line">                    for (var i &#x3D; 0; i &lt; methodsList.length; i++)&#123;</span><br><span class="line">                        &#x2F;&#x2F; Method Objection getName()</span><br><span class="line">                        console.log(methodsList[i].getName());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: function()&#123;</span><br><span class="line">                console.log(&quot;complete!!!&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="特殊不可见字符"><a href="#特殊不可见字符" class="headerlink" title="特殊不可见字符"></a>特殊不可见字符</h1><p>当方法名被混淆时֏，打印出来所有的类名<code>%D6%8F</code>,用编码后的字符串hook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(</span><br><span class="line">    function x() &#123;</span><br><span class="line"></span><br><span class="line">        var targetClass &#x3D; &quot;com.example.hooktest.MainActivity&quot;;</span><br><span class="line"></span><br><span class="line">        var hookCls &#x3D; Java.use(targetClass);</span><br><span class="line">        var methods &#x3D; hookCls.class.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">        for (var i in methods) &#123;</span><br><span class="line">            console.log(methods[i].toString());</span><br><span class="line">            console.log(encodeURIComponent(methods[i].toString().replace(&#x2F;^.*?\.([^\s\.\(\)]+)\(.*?$&#x2F;, &quot;$1&quot;)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hookCls[decodeURIComponent(&quot;%D6%8F&quot;)].implementation &#x3D; function (x) &#123;</span><br><span class="line">                console.log(&quot;original call: fun(&quot; + x + &quot;)&quot;);</span><br><span class="line">                var result &#x3D; this[decodeURIComponent(&quot;%D6%8F&quot;)](900);</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="wallbreaker"><a href="#wallbreaker" class="headerlink" title="wallbreaker"></a>wallbreaker</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var Class &#x3D; Java.use(&quot;java.lang.Class&quot;);</span><br><span class="line">        </span><br><span class="line">      	function inspectObject(obj)&#123;</span><br><span class="line">            var obj_class &#x3D; Java.cast(obj.getClass(), Class);</span><br><span class="line">            var fields &#x3D; obj_class.getDeclaredFields();</span><br><span class="line">            var methods &#x3D; obj_class.getMethods();</span><br><span class="line">            console.log(&quot;Inspectiong &quot; + obj.getClass().toString());</span><br><span class="line">            console.log(&quot;\t Fields:&quot;)</span><br><span class="line">            for (var i in fields)&#123;</span><br><span class="line">                console.log(&quot;\t\t&quot; + fields[i].toString());</span><br><span class="line">            &#125;</span><br><span class="line">            console.log(&quot;\t Methods:&quot;)</span><br><span class="line">            for (var i in methods)&#123;</span><br><span class="line">                console.log(&quot;\t\t&quot; + methods[i].toString())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Java.choose(&quot;com.baidu.lbs.waimai.WaimaiActivity&quot;,&#123;</span><br><span class="line">            onComplete: function()&#123;</span><br><span class="line">                console.log(&quot;complete!&quot;);</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line">            onMatch: function(instance)&#123;</span><br><span class="line">                console.log(&quot;find instance&quot;, instance);</span><br><span class="line">                inspectObject(instance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="枚举所有类"><a href="#枚举所有类" class="headerlink" title="枚举所有类"></a>枚举所有类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function ()&#123;</span><br><span class="line">  console.log(&quot;\n[*] enumerating classes...&quot;);</span><br><span class="line">  Java.enumerateLoadedClasses(&#123;</span><br><span class="line">    onMatch: function(_className)&#123;</span><br><span class="line">      console.log(&quot;[*] found instance of &#39;&quot;+_className+&quot;&#39;&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">    onComplete: function()&#123;</span><br><span class="line">      console.log(&quot;[*] class enuemration complete&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="枚举接口实现"><a href="#枚举接口实现" class="headerlink" title="枚举接口实现"></a>枚举接口实现</h1><p>获取指定包下所有类的接口实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function searchInterface()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onComplete: function()&#123;&#125;,</span><br><span class="line">            onMatch: function(name,handle)&#123;</span><br><span class="line">                if (name.indexOf(&quot;com.r0ysue.a0526printout&quot;) &gt; -1) &#123; &#x2F;&#x2F; 使用包名进行过滤</span><br><span class="line">                    console.log(&quot;find class&quot;);</span><br><span class="line">                    var targetClass &#x3D; Java.use(name);</span><br><span class="line">                    var interfaceList &#x3D; targetClass.class.getInterfaces(); &#x2F;&#x2F; 使用反射获取类实现的接口数组</span><br><span class="line">                    if (interfaceList.length &gt; 0) &#123;</span><br><span class="line">                        console.log(name) &#x2F;&#x2F; 打印类名</span><br><span class="line">                        for (var i in interfaceList) &#123;</span><br><span class="line">                            console.log(&quot;\t&quot;, interfaceList[i].toString()); &#x2F;&#x2F; 直接打印接口名称</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多个ClassLoader时枚举指定类所有关联的接口实现和父子类关系</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">    console.log(&quot;start&quot;)</span><br><span class="line">    &#x2F;&#x2F; 枚举classLoader设置含有关键类的classLoader  动态dex切换classLoader</span><br><span class="line">    Java.enumerateClassLoaders(&#123;</span><br><span class="line">        onMatch: function (loader) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (loader.findClass(&quot;com.jdd.motorfans.modules.detail.RecordFinishListener&quot;)) &#123;</span><br><span class="line">                    console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                    console.log(loader);</span><br><span class="line">                    Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (error) &#123;</span><br><span class="line">                console.log(&quot;find error:&quot; + error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onComplete: function () &#123;</span><br><span class="line">            console.log(&quot;end1&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &#x2F;&#x2F; 枚举所有的类</span><br><span class="line">    Java.enumerateLoadedClasses(&#123;</span><br><span class="line">        onMatch: function (className) &#123;</span><br><span class="line">            if (className.toString().indexOf(&quot;RecordFinishListener&quot;) &gt; 0 &amp;&amp;</span><br><span class="line">                className.toString().indexOf(&quot;$&quot;) &gt; 0</span><br><span class="line">            ) &#123;</span><br><span class="line">                console.log(&quot;found &#x3D;&gt; &quot;, className)</span><br><span class="line">                &#x2F;&#x2F; 使用反射获取类实现的接口数组</span><br><span class="line">                var interFaces &#x3D; Java.use(className).class.getInterfaces();</span><br><span class="line">                if(interFaces.length&gt;0)&#123;</span><br><span class="line">                    console.log(&quot;interface is &#x3D;&gt; &quot;);</span><br><span class="line">                    for(var i in interFaces)&#123;</span><br><span class="line">                        console.log(&quot;\t&quot;,interFaces[i].toString())</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; 获取该类的父类名包含指定名称</span><br><span class="line">                if (Java.use(className).class.getSuperclass()) &#123;</span><br><span class="line">                    var superClass &#x3D; Java.use(className).class.getSuperclass().getName();</span><br><span class="line">                    &#x2F;&#x2F; console.log(&quot;superClass is &#x3D;&gt; &quot;,superClass);</span><br><span class="line">                    if (superClass.indexOf(&quot;XC_MethodHook&quot;) &gt; 0) &#123;</span><br><span class="line">                        console.log(&quot;found class is &#x3D;&gt; &quot;, className.toString())</span><br><span class="line">                        traceClass(className);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, onComplete: function () &#123;</span><br><span class="line">            console.log(&quot;search completed!&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;) </span><br><span class="line">    console.log(&quot;end2&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Hook-Char-amp-Byte"><a href="#Hook-Char-amp-Byte" class="headerlink" title="Hook Char&amp;Byte"></a>Hook Char&amp;Byte</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">    &#x2F;&#x2F; 调用 自写dex</span><br><span class="line">    Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;r0gson.dex&quot;).load();</span><br><span class="line">    const gson &#x3D; Java.use(&#39;com.r0ysue.gson.Gson&#39;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 打印CharArray数组</span><br><span class="line">    Java.use(&quot;java.util.Arrays&quot;).toString.overload(&#39;[C&#39;).implementation &#x3D; function(charArray)&#123;</span><br><span class="line">        &#x2F;&#x2F; Java.array(&#39;char&#39;, [ &#39;一&#39;,&#39;去&#39;,&#39;二&#39;,&#39;三&#39;,&#39;里&#39; ]);</span><br><span class="line">        &#x2F;&#x2F; Java.use(&#39;java.lang.String&#39;).$new(Java.array(&#39;char&#39;, [ &#39;烟&#39;,&#39;村&#39;,&#39;四&#39;,&#39;五&#39;,&#39;家&#39;])) </span><br><span class="line">        &#x2F;&#x2F; Java.array(&quot;java.lang.String&quot;,[&quot;一&quot;,&quot;二&quot;,&quot;三&quot;]);</span><br><span class="line">        var result &#x3D; this.toString(charArray);</span><br><span class="line">        var result1 &#x3D; JSON.stringify(charArray);</span><br><span class="line">        console.log(&quot;charArray,result:&quot;,charArray,result)</span><br><span class="line">        console.log(ArrayClass.toString(result));</span><br><span class="line">        console.log(&quot;charArray Object Object:&quot;,gson.$new().toJson(charArray));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 打印char字符</span><br><span class="line">    var CharClass &#x3D; Java.use(&quot;java.lang.Character&quot;);</span><br><span class="line">    CharClass.toString.overload(&quot;char&quot;).implementation &#x3D; function(inputChar)&#123;</span><br><span class="line">        var result &#x3D; this.toString(inputChar);</span><br><span class="line">        console.log(&quot;inputChar, result: &quot;, inputChar, result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; byteArray</span><br><span class="line">    Java.use(&quot;java.util.Arrays&quot;).toString.overload(&#39;[B&#39;).implementation &#x3D; function(byteArray)&#123;</span><br><span class="line">        var result &#x3D; this.toString(byteArray);</span><br><span class="line">        var result1 &#x3D; JSON.stringify(byteArray);</span><br><span class="line">        console.log(&quot;byteArray,result):&quot;,byteArray,result)</span><br><span class="line">        console.log(&quot;byteArray Object Object:&quot;,gson.$new().toJson(byteArray));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var StringClass &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">    var byteArray &#x3D; StringClass.$new(&quot;Hello World&quot;).getBytes();</span><br><span class="line">    Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;r0gson.dex&quot;).load();</span><br><span class="line">    var gson &#x3D; Java.use(&quot;com.r0ysue.gson.Gson&quot;);</span><br><span class="line">    console.log(gson.$new().toJson(byteArray));</span><br><span class="line">    &#x2F;&#x2F; &#x2F;&#x2F; console byte[]</span><br><span class="line">    var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">    console.log(ByteString.of(byteArray).hex()); &#x2F;&#x2F; byte转16进制字符串</span><br><span class="line">    &#x2F;&#x2F; &#x2F;&#x2F; 创建自定义Java数组 并打印</span><br><span class="line">    var MyArray &#x3D; Java.array(&quot;byte&quot;,[13,4,4,2]);</span><br><span class="line">    console.log(gson.$new().toJson(MyArray));</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-Map"><a href="#Hook-Map" class="headerlink" title="Hook Map"></a>Hook Map</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">遍历打印</span><br><span class="line">function main() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var targetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line">        targetClass.show.implementation &#x3D; function (map) &#123;</span><br><span class="line">            &#x2F;&#x2F; 遍历 map</span><br><span class="line">            var result &#x3D; &quot;&quot;;</span><br><span class="line">            var it &#x3D; map.keySet().iterator();</span><br><span class="line">            while (it.hasNext()) &#123;</span><br><span class="line">                var keyStr &#x3D; it.next();</span><br><span class="line">                var valueStr &#x3D; map.get(keyStr);</span><br><span class="line">                result +&#x3D; valueStr;</span><br><span class="line">            &#125;</span><br><span class="line">            console.log(&quot;result :&quot;, result);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 修改 map</span><br><span class="line">            map.put(&quot;pass&quot;, &quot;fxxk&quot;);</span><br><span class="line">            map.put(&quot;code&quot;, &quot;Hello World&quot;);</span><br><span class="line">            console.log(JSON.stringify(map));</span><br><span class="line"></span><br><span class="line">            return this.show(map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line">cast打印 HashMap</span><br><span class="line">function main() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var HashMapNode &#x3D; Java.use(&quot;java.util.HashMap$Node&quot;);</span><br><span class="line">        var targetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line"></span><br><span class="line">        var targetClass.show.implementation &#x3D; function (map) &#123;</span><br><span class="line">            var result &#x3D; &quot;&quot;;</span><br><span class="line">            var iterator &#x3D; map.entrySet().iterator();</span><br><span class="line">            while (iterator.hasNext()) &#123;</span><br><span class="line">                console.log(&quot;entry&quot;, iterator.next());</span><br><span class="line">                var entry &#x3D; Java.cast(iterator.next(), HashMapNode);</span><br><span class="line">                console.log(entry.getKey());</span><br><span class="line">                console.log(entry.getValue());</span><br><span class="line">                return +&#x3D; entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            console.log(&quot;result is :&quot;, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var targetClass &#x3D; Java.use(&quot;com.xiaojianbang.app.ShufferMap&quot;);</span><br><span class="line">        var HashMap &#x3D; Java.use(&#39;java.util.HashMap&#39;);</span><br><span class="line">        targetClass.show.implementation &#x3D; function(map)&#123;</span><br><span class="line">            &#x2F;&#x2F; 直接调用 toString()</span><br><span class="line">            var args_map &#x3D; Java.cast(param_hm, HashMap);</span><br><span class="line">            console.log(&quot;打印hashmap: -&gt; &quot; + map.toString() + args_map.toString());</span><br><span class="line">            return this.show.apply(this,arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><h1 id="Hook-重载"><a href="#Hook-重载" class="headerlink" title="Hook 重载"></a>Hook 重载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">function hookdecodeimgkey() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var base64 &#x3D; Java.use(&quot;android.util.Base64&quot;)</span><br><span class="line">        Java.use(&quot;com.ilulutv.fulao2.other.i.b&quot;).b.overload(&#39;[B&#39;, &#39;[B&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function (key, iv, image) &#123;</span><br><span class="line">            var result &#x3D; this.b(key, iv, image);</span><br><span class="line">            console.log(&quot;key&quot;, base64.encodeToString(key, 0));</span><br><span class="line">            console.log(&quot;iv&quot;, base64.encodeToString(iv, 0));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        var UtilsClass &#x3D; Java.use(&quot;com.kevin.app.Utils&quot;);</span><br><span class="line">        &#x2F;&#x2F; 重载无参方法</span><br><span class="line">        UtilsClass.test.overload().implementation &#x3D; function () &#123;</span><br><span class="line">            console.log(&quot;hook overload no args&quot;);</span><br><span class="line">            return this.test();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 重载有参方法 - 基础数据类型</span><br><span class="line">		UtilsClass.test.overload(&#39;int&#39;).implementation &#x3D; function(num)&#123;</span><br><span class="line">            console.log(&quot;hook overload int args&quot;);</span><br><span class="line">            var myNum &#x3D; 9999;</span><br><span class="line">            var oriResult &#x3D; this.test(num);</span><br><span class="line">            console.log(&quot;oriResult is :&quot; + oriResult);</span><br><span class="line">            return this.test(myNum);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; 重载有参方法 - 引用数据类型</span><br><span class="line">        UtilsClass.test.overload(&#39;com.kevin.app.Money&#39;).implementation &#x3D; function(money)&#123;</span><br><span class="line">            console.log(&quot;hook Money args&quot;);</span><br><span class="line">            return this.test(money);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; hook 指定方法的所有重载</span><br><span class="line">        var ClassName &#x3D; Java.use(&quot;com.xiaojianbang.app.Utils&quot;);</span><br><span class="line">        var overloadsLength &#x3D; ClassName.test.overloads.length;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; overloadsLength; i++)&#123;</span><br><span class="line">            ClassName.test.overloads[i].implementation &#x3D; function () &#123;</span><br><span class="line">                &#x2F;&#x2F; 遍历打印 arguments </span><br><span class="line">                for (var a &#x3D; 0; a &lt; arguments.length; a++)&#123;</span><br><span class="line">                    console.log(a + &quot; : &quot; + arguments[a]);</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F; 调用原方法</span><br><span class="line">                return this.test.apply(this,arguments);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-内部类"><a href="#Hook-内部类" class="headerlink" title="Hook 内部类"></a>Hook 内部类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perfor(function()&#123;</span><br><span class="line">        &#x2F;&#x2F; hook 内部类</span><br><span class="line">        &#x2F;&#x2F; 内部类使用$进行分隔 不使用.</span><br><span class="line">        var InnerClass &#x3D; Java.use(&quot;com.xiaojianbang.app.Money$innerClass&quot;);</span><br><span class="line">        &#x2F;&#x2F; 重写内部类的 $init 方法</span><br><span class="line">        InnerClass.$init.overload(&quot;java.lang.String&quot;,&quot;int&quot;).implementation &#x3D; function(x,y)&#123;</span><br><span class="line">            console.log(&quot;x: &quot;,x);</span><br><span class="line">            console.log(&quot;y: &quot;,y);</span><br><span class="line">            this.$init(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="Hook-匿名类"><a href="#Hook-匿名类" class="headerlink" title="Hook 匿名类"></a>Hook 匿名类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 接口, 抽象类, 不可以被new</span><br><span class="line">&#x2F;&#x2F; 接口, 抽象类 要使用必须要实例化, 实例化不是通过new, 而是通过实现接口方法, 继承抽象类等方式</span><br><span class="line">&#x2F;&#x2F; new __接口__&#123;&#125; 可以理解成 new 了一个实现接口的匿名类, 在匿名类的内部(花括号内),实现了这个接口</span><br><span class="line"></span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;&#x2F; hook 匿名类</span><br><span class="line">        &#x2F;&#x2F; 匿名类在 smail中以 $1, $2 等方式存在, 需要通过 java 行号去 smail 找到准确的匿名类名称 </span><br><span class="line">        var NiMingClass &#x3D; Java.use(&quot;com.xiaojianbang.app.MainActivity$1&quot;);</span><br><span class="line">        NiMingClass.getInfo.implementation &#x3D; function ()&#123;</span><br><span class="line">            return &quot;kevin change 匿名类&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h1 id="Hook-枚举类"><a href="#Hook-枚举类" class="headerlink" title="Hook 枚举类"></a>Hook 枚举类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function enumPrint()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.r0ysue.a0526printout.Signal&quot;,&#123;</span><br><span class="line">            onComplete: function()&#123;&#125;,</span><br><span class="line">            onMatch: function(instance)&#123;</span><br><span class="line">                console.log(&#39;find it ,&#39;,instance);</span><br><span class="line">                console.log(instance.class.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Hook-动态加载dex"><a href="#Hook-动态加载dex" class="headerlink" title="Hook 动态加载dex"></a>Hook 动态加载dex</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch : function(loader)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; loadClass or findClass 并切换classLoader</span><br><span class="line">                    if (loader.loadClass(&quot;com.xiaojianbang.app.Dynamic&quot;))&#123;</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                        var hookClass &#x3D; Java.use(&quot;com.xiaojianbang.app.Dynamic&quot;);</span><br><span class="line">                        console.log(&quot;success hook it :&quot;, hookClass);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            </span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;complete !!! &quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure><p>经常在加壳的 app 中, 没办法正确找到正常加载 app 类的 classloader</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        Java.enumerateClassLoadersSync().forEach(function (classloader) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                console.log(&quot;classloader&quot;, classloader);</span><br><span class="line">                classloader.loadClass(&quot;com.kanxue.encrypt01.MainActivity&quot;);</span><br><span class="line">                Java.classFactory.loader &#x3D; classloader;</span><br><span class="line">                var mainActivityClass &#x3D; Java.use(&quot;com.kanxue.encrypt01.MainActivity&quot;);</span><br><span class="line">                console.log(&quot;mainActivityClass&quot;, mainActivityClass);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.log(&quot;error&quot;, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="trace类调用栈"><a href="#trace类调用栈" class="headerlink" title="trace类调用栈"></a>trace类调用栈</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function uniqBy(array, key) &#123;</span><br><span class="line">    var seen &#x3D; &#123;&#125;;</span><br><span class="line">    return array.filter(function (item) &#123;</span><br><span class="line">        var k &#x3D; key(item);</span><br><span class="line">        return seen.hasOwnProperty(k) ? false : (seen[k] &#x3D; true);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; trace a specific Java Method</span><br><span class="line">function traceMethod(targetClassMethod) &#123;</span><br><span class="line">    var delim &#x3D; targetClassMethod.lastIndexOf(&quot;.&quot;);</span><br><span class="line">    if (delim &#x3D;&#x3D;&#x3D; -1) return;</span><br><span class="line"></span><br><span class="line">    var targetClass &#x3D; targetClassMethod.slice(0, delim)</span><br><span class="line">    var targetMethod &#x3D; targetClassMethod.slice(delim + 1, targetClassMethod.length)</span><br><span class="line"></span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    var overloadCount &#x3D; hook[targetMethod].overloads.length;</span><br><span class="line"></span><br><span class="line">    console.log(&quot;Tracing &quot; + targetClassMethod + &quot; [&quot; + overloadCount + &quot; overload(s)]&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; hook all class_method</span><br><span class="line">    for (var i &#x3D; 0; i &lt; overloadCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">        hook[targetMethod].overloads[i].implementation &#x3D; function () &#123;</span><br><span class="line">            console.warn(&quot;\n*** entered &quot; + targetClassMethod);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print backtrace</span><br><span class="line">            &#x2F;&#x2F; Java.perform(function() &#123;</span><br><span class="line">            &#x2F;&#x2F;	var bt &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new());</span><br><span class="line">            &#x2F;&#x2F;	console.log(&quot;\nBacktrace:\n&quot; + bt);</span><br><span class="line">            &#x2F;&#x2F; &#125;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print args</span><br><span class="line">            if (arguments.length) console.log();</span><br><span class="line">            for (var j &#x3D; 0; j &lt; arguments.length; j++) &#123;</span><br><span class="line">                console.log(&quot;arg[&quot; + j + &quot;]: &quot; + arguments[j]);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print retval</span><br><span class="line">            var retval &#x3D; this[targetMethod].apply(this, arguments); &#x2F;&#x2F; rare crash (Frida bug?)</span><br><span class="line">            console.log(&quot;\nretval: &quot; + retval);</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            console.warn(&quot;\n*** exiting &quot; + targetClassMethod);</span><br><span class="line">            return retval;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function traceClass(targetClass) &#123;</span><br><span class="line">    &#x2F;&#x2F;Java.use是新建一个对象哈，大家还记得么？</span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    &#x2F;&#x2F;利用反射的方式，拿到当前类的所有方法</span><br><span class="line">    var methods &#x3D; hook.class.getDeclaredMethods();</span><br><span class="line">    &#x2F;&#x2F; var methods &#x3D; hook.class.getMethods();</span><br><span class="line">    &#x2F;&#x2F;建完对象之后记得将对象释放掉哈</span><br><span class="line">    hook.$dispose;</span><br><span class="line">    &#x2F;&#x2F;将方法名保存到数组中</span><br><span class="line">    var parsedMethods &#x3D; [];</span><br><span class="line">    methods.forEach(function (method) &#123;</span><br><span class="line">        parsedMethods.push(method.toString().replace(targetClass + &quot;.&quot;, &quot;TOKEN&quot;).match(&#x2F;\sTOKEN(.*)\(&#x2F;)[1]);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#x2F;&#x2F;去掉一些重复的值</span><br><span class="line">    var targets &#x3D; uniqBy(parsedMethods, JSON.stringify);</span><br><span class="line">    &#x2F;&#x2F;对数组中所有的方法进行hook，traceMethod也就是第一小节的内容</span><br><span class="line">    targets.forEach(function (targetMethod) &#123;</span><br><span class="line">        traceMethod(targetClass + &quot;.&quot; + targetMethod);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="调用栈打印"><a href="#调用栈打印" class="headerlink" title="调用栈打印"></a>调用栈打印</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function printStacks(name)&#123;</span><br><span class="line">    console.log(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; printStacks start &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &quot; + name + &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; sample 1</span><br><span class="line">    var throwable &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new());</span><br><span class="line">    console.log(throwable);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; sample 2</span><br><span class="line">    var exception &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new());</span><br><span class="line">    console.log(exception);</span><br><span class="line">    </span><br><span class="line">    console.log(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; printStacks end &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &quot; + name + &quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="手动注册类"><a href="#手动注册类" class="headerlink" title="手动注册类"></a>手动注册类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">    var Runnable &#x3D; Java.use(&quot;java.lang.Runnable&quot;);</span><br><span class="line">    var saveImg &#x3D; Java.registerClass(&#123;</span><br><span class="line">        name: &quot;com.roysue.runnable&quot;,</span><br><span class="line">        implements: [Runnable],</span><br><span class="line">        fields: &#123;</span><br><span class="line">            bm: &quot;android.graphics.Bitmap&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            $init: [&#123;</span><br><span class="line">                returnType: &quot;void&quot;,</span><br><span class="line">                argumentTypes: [&quot;android.graphics.Bitmap&quot;],</span><br><span class="line">                implementation: function (bitmap) &#123;</span><br><span class="line">                    this.bm.value &#x3D; bitmap;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            run: function () &#123;</span><br><span class="line">                var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot; + guid() + &quot;.jpg&quot;</span><br><span class="line">                console.log(&quot;path&#x3D;&gt; &quot;, path)</span><br><span class="line">                var file &#x3D; Java.use(&quot;java.io.File&quot;).$new(path)</span><br><span class="line">                var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).$new(file);</span><br><span class="line"></span><br><span class="line">                this.bm.value.compress(Java.use(&quot;android.graphics.Bitmap$CompressFormat&quot;).JPEG.value, 100, fos)</span><br><span class="line">                fos.flush();</span><br><span class="line">                fos.close();</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            onRequest: function (request, response) &#123;</span><br><span class="line">          	  &#x2F;&#x2F; 主动调用代码直接写这里</span><br><span class="line">            	response.send(JSON.stringify(&#123;</span><br><span class="line">                	&quot;code&quot;: 0,</span><br><span class="line">	                &quot;message&quot;: &quot; 服务已经注册成功, 默认端口8181&quot;</span><br><span class="line">    	        &#125;));</span><br><span class="line">        	&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory$Options&#39;).implementation &#x3D; function (data, offset, length, opts) &#123;</span><br><span class="line">        var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">        var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line"></span><br><span class="line">        var runnable &#x3D; saveImg.$new(result);</span><br><span class="line">        runnable.run()</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Java.perform(function() &#123;</span><br><span class="line">   &#x2F;&#x2F; https:&#x2F;&#x2F;developer.android.com&#x2F;reference&#x2F;android&#x2F;view&#x2F;WindowManager.LayoutParams.html#FLAG_SECURE</span><br><span class="line">   var FLAG_SECURE &#x3D; 0x2000;</span><br><span class="line">   var Runnable &#x3D; Java.use(&quot;java.lang.Runnable&quot;);</span><br><span class="line">   var DisableSecureRunnable &#x3D; Java.registerClass(&#123;</span><br><span class="line">      name: &quot;me.bhamza.DisableSecureRunnable&quot;,</span><br><span class="line">      implements: [Runnable],</span><br><span class="line">      fields: &#123;</span><br><span class="line">          activity: &quot;android.app.Activity&quot;,</span><br><span class="line">       &#125;,</span><br><span class="line">       methods: &#123;</span><br><span class="line">          $init: [&#123;</span><br><span class="line">             returnType: &quot;void&quot;,</span><br><span class="line">             argumentTypes: [&quot;android.app.Activity&quot;],</span><br><span class="line">             implementation: function (activity) &#123;</span><br><span class="line">                this.activity.value &#x3D; activity;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;],</span><br><span class="line">          run: function() &#123;</span><br><span class="line">             var flags &#x3D; this.activity.value.getWindow().getAttributes().flags.value; &#x2F;&#x2F; get current value</span><br><span class="line">             flags &amp;&#x3D; ~FLAG_SECURE; &#x2F;&#x2F; toggle it</span><br><span class="line">             this.activity.value.getWindow().setFlags(flags, FLAG_SECURE); &#x2F;&#x2F; disable it!</span><br><span class="line">             console.log(&quot;Done disabling SECURE flag...&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Java.choose(&quot;com.example.app.FlagSecureTestActivity&quot;, &#123;</span><br><span class="line">       &quot;onMatch&quot;: function (instance) &#123;</span><br><span class="line">          var runnable &#x3D; DisableSecureRunnable.$new(instance);</span><br><span class="line">          instance.runOnUiThread(runnable);</span><br><span class="line">       &#125;,</span><br><span class="line">       &quot;onComplete&quot;: function () &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h1 id="Hook-Click"><a href="#Hook-Click" class="headerlink" title="Hook Click"></a>Hook Click</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">var jclazz &#x3D; null;</span><br><span class="line">var jobj &#x3D; null;</span><br><span class="line"></span><br><span class="line">function getObjClassName(obj) &#123;</span><br><span class="line">    if (!jclazz) &#123;</span><br><span class="line">        var jclazz &#x3D; Java.use(&quot;java.lang.Class&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!jobj) &#123;</span><br><span class="line">        var jobj &#x3D; Java.use(&quot;java.lang.Object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return jclazz.getName.call(jobj.getClass.call(obj));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function watch(obj, mtdName) &#123;</span><br><span class="line">    var listener_name &#x3D; getObjClassName(obj);</span><br><span class="line">    var target &#x3D; Java.use(listener_name);</span><br><span class="line">    if (!target || !mtdName in target) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; send(&quot;[WatchEvent] hooking &quot; + mtdName + &quot;: &quot; + listener_name);</span><br><span class="line">    target[mtdName].overloads.forEach(function (overload) &#123;</span><br><span class="line">        overload.implementation &#x3D; function () &#123;</span><br><span class="line">            &#x2F;&#x2F;send(&quot;[WatchEvent] &quot; + mtdName + &quot;: &quot; + getObjClassName(this));</span><br><span class="line">            console.log(&quot;[WatchEvent] &quot; + mtdName + &quot;: &quot; + getObjClassName(this))</span><br><span class="line">            return this[mtdName].apply(this, arguments);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function OnClickListener() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;以spawn启动进程的模式来attach的话</span><br><span class="line">        Java.use(&quot;android.view.View&quot;).setOnClickListener.implementation &#x3D; function (listener) &#123;</span><br><span class="line">            if (listener !&#x3D; null) &#123;</span><br><span class="line">                watch(listener, &#39;onClick&#39;);</span><br><span class="line">            &#125;</span><br><span class="line">            return this.setOnClickListener(listener);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;如果frida以attach的模式进行attch的话</span><br><span class="line">        Java.choose(&quot;android.view.View$ListenerInfo&quot;, &#123;</span><br><span class="line">            onMatch: function (instance) &#123;</span><br><span class="line">                instance &#x3D; instance.mOnClickListener.value;</span><br><span class="line">                if (instance) &#123;</span><br><span class="line">                    console.log(&quot;mOnClickListener name is :&quot; + getObjClassName(instance));</span><br><span class="line">                    watch(instance, &#39;onClick&#39;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(OnClickListener);</span><br></pre></td></tr></table></figure><h1 id="Hook-Activity"><a href="#Hook-Activity" class="headerlink" title="Hook Activity"></a>Hook Activity</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">    var Activity &#x3D; Java.use(&quot;android.app.Activity&quot;);</span><br><span class="line">    &#x2F;&#x2F;console.log(Object.getOwnPropertyNames(Activity));</span><br><span class="line">    Activity.startActivity.overload(&#39;android.content.Intent&#39;).implementation&#x3D;function(p1)&#123;</span><br><span class="line">        console.log(&quot;Hooking android.app.Activity.startActivity(p1) successfully,p1&#x3D;&quot;+p1);</span><br><span class="line">        console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">        console.log(decodeURIComponent(p1.toUri(256)));</span><br><span class="line">        this.startActivity(p1);</span><br><span class="line">    &#125;</span><br><span class="line">    Activity.startActivity.overload(&#39;android.content.Intent&#39;, &#39;android.os.Bundle&#39;).implementation&#x3D;function(p1,p2)&#123;</span><br><span class="line">        console.log(&quot;Hooking android.app.Activity.startActivity(p1,p2) successfully,p1&#x3D;&quot;+p1+&quot;,p2&#x3D;&quot;+p2);</span><br><span class="line">        console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">        console.log(decodeURIComponent(p1.toUri(256)));</span><br><span class="line">        this.startActivity(p1,p2);</span><br><span class="line">    &#125;</span><br><span class="line">    Activity.startService.overload(&#39;android.content.Intent&#39;).implementation&#x3D;function(p1)&#123;</span><br><span class="line">        console.log(&quot;Hooking android.app.Activity.startService(p1) successfully,p1&#x3D;&quot;+p1);</span><br><span class="line">        console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">        console.log(decodeURIComponent(p1.toUri(256)));</span><br><span class="line">        this.startService(p1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="Hook-绕过root检测"><a href="#Hook-绕过root检测" class="headerlink" title="Hook 绕过root检测"></a>Hook 绕过root检测</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; $ frida -l antiroot.js -U -f com.example.app --no-pause</span><br><span class="line">&#x2F;&#x2F; CHANGELOG by Pichaya Morimoto (p.morimoto@sth.sh): </span><br><span class="line">&#x2F;&#x2F;  - I added extra whitelisted items to deal with the latest versions </span><br><span class="line">&#x2F;&#x2F; 						of RootBeer&#x2F;Cordova iRoot as of August 6, 2019</span><br><span class="line">&#x2F;&#x2F;  - The original one just fucked up (kill itself) if Magisk is installed lol</span><br><span class="line">&#x2F;&#x2F; Credit &amp; Originally written by: https:&#x2F;&#x2F;codeshare.frida.re&#x2F;@dzonerzy&#x2F;fridantiroot&#x2F;</span><br><span class="line">&#x2F;&#x2F; If this isn&#39;t working in the future, check console logs, rootbeer src, or libtool-checker.so</span><br><span class="line"></span><br><span class="line">Java.perform(function() &#123;</span><br><span class="line"></span><br><span class="line">    var RootPackages &#x3D; [&quot;com.noshufou.android.su&quot;, &quot;com.noshufou.android.su.elite&quot;, &quot;eu.chainfire.supersu&quot;,</span><br><span class="line">        &quot;com.koushikdutta.superuser&quot;, &quot;com.thirdparty.superuser&quot;, &quot;com.yellowes.su&quot;, &quot;com.koushikdutta.rommanager&quot;,</span><br><span class="line">        &quot;com.koushikdutta.rommanager.license&quot;, &quot;com.dimonvideo.luckypatcher&quot;, &quot;com.chelpus.lackypatch&quot;,</span><br><span class="line">        &quot;com.ramdroid.appquarantine&quot;, &quot;com.ramdroid.appquarantinepro&quot;, &quot;com.devadvance.rootcloak&quot;, &quot;com.devadvance.rootcloakplus&quot;,</span><br><span class="line">        &quot;de.robv.android.xposed.installer&quot;, &quot;com.saurik.substrate&quot;, &quot;com.zachspong.temprootremovejb&quot;, &quot;com.amphoras.hidemyroot&quot;,</span><br><span class="line">        &quot;com.amphoras.hidemyrootadfree&quot;, &quot;com.formyhm.hiderootPremium&quot;, &quot;com.formyhm.hideroot&quot;, &quot;me.phh.superuser&quot;,</span><br><span class="line">        &quot;eu.chainfire.supersu.pro&quot;, &quot;com.kingouser.com&quot;, &quot;com.android.vending.billing.InAppBillingService.COIN&quot;,&quot;com.topjohnwu.magisk&quot;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    var RootBinaries &#x3D; [&quot;su&quot;, &quot;busybox&quot;, &quot;supersu&quot;, &quot;Superuser.apk&quot;, &quot;KingoUser.apk&quot;, &quot;SuperSu.apk&quot;,&quot;magisk&quot;];</span><br><span class="line"></span><br><span class="line">    var RootProperties &#x3D; &#123;</span><br><span class="line">        &quot;ro.build.selinux&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;ro.debuggable&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;service.adb.root&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ro.secure&quot;: &quot;1&quot;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var RootPropertiesKeys &#x3D; [];</span><br><span class="line"></span><br><span class="line">    for (var k in RootProperties) RootPropertiesKeys.push(k);</span><br><span class="line"></span><br><span class="line">    var PackageManager &#x3D; Java.use(&quot;android.app.ApplicationPackageManager&quot;);</span><br><span class="line"></span><br><span class="line">    var Runtime &#x3D; Java.use(&#39;java.lang.Runtime&#39;);</span><br><span class="line"></span><br><span class="line">    var NativeFile &#x3D; Java.use(&#39;java.io.File&#39;);</span><br><span class="line"></span><br><span class="line">    var String &#x3D; Java.use(&#39;java.lang.String&#39;);</span><br><span class="line"></span><br><span class="line">    var SystemProperties &#x3D; Java.use(&#39;android.os.SystemProperties&#39;);</span><br><span class="line"></span><br><span class="line">    var BufferedReader &#x3D; Java.use(&#39;java.io.BufferedReader&#39;);</span><br><span class="line"></span><br><span class="line">    var ProcessBuilder &#x3D; Java.use(&#39;java.lang.ProcessBuilder&#39;);</span><br><span class="line"></span><br><span class="line">    var StringBuffer &#x3D; Java.use(&#39;java.lang.StringBuffer&#39;);</span><br><span class="line"></span><br><span class="line">    var loaded_classes &#x3D; Java.enumerateLoadedClassesSync();</span><br><span class="line"></span><br><span class="line">    send(&quot;Loaded &quot; + loaded_classes.length + &quot; classes!&quot;);</span><br><span class="line"></span><br><span class="line">    var useKeyInfo &#x3D; false;</span><br><span class="line"></span><br><span class="line">    var useProcessManager &#x3D; false;</span><br><span class="line"></span><br><span class="line">    send(&quot;loaded: &quot; + loaded_classes.indexOf(&#39;java.lang.ProcessManager&#39;));</span><br><span class="line"></span><br><span class="line">    if (loaded_classes.indexOf(&#39;java.lang.ProcessManager&#39;) !&#x3D; -1) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;useProcessManager &#x3D; true;</span><br><span class="line">            &#x2F;&#x2F;var ProcessManager &#x3D; Java.use(&#39;java.lang.ProcessManager&#39;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            send(&quot;ProcessManager Hook failed: &quot; + err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        send(&quot;ProcessManager hook not loaded&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var KeyInfo &#x3D; null;</span><br><span class="line"></span><br><span class="line">    if (loaded_classes.indexOf(&#39;android.security.keystore.KeyInfo&#39;) !&#x3D; -1) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;useKeyInfo &#x3D; true;</span><br><span class="line">            &#x2F;&#x2F;var KeyInfo &#x3D; Java.use(&#39;android.security.keystore.KeyInfo&#39;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            send(&quot;KeyInfo Hook failed: &quot; + err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        send(&quot;KeyInfo hook not loaded&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PackageManager.getPackageInfo.overload(&#39;java.lang.String&#39;, &#39;int&#39;).implementation &#x3D; function(pname, flags) &#123;</span><br><span class="line">        var shouldFakePackage &#x3D; (RootPackages.indexOf(pname) &gt; -1);</span><br><span class="line">        if (shouldFakePackage) &#123;</span><br><span class="line">            send(&quot;Bypass root check for package: &quot; + pname);</span><br><span class="line">            pname &#x3D; &quot;set.package.name.to.a.fake.one.so.we.can.bypass.it&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return this.getPackageInfo.call(this, pname, flags);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    NativeFile.exists.implementation &#x3D; function() &#123;</span><br><span class="line">        var name &#x3D; NativeFile.getName.call(this);</span><br><span class="line">        var shouldFakeReturn &#x3D; (RootBinaries.indexOf(name) &gt; -1);</span><br><span class="line">        if (shouldFakeReturn) &#123;</span><br><span class="line">            send(&quot;Bypass return value for binary: &quot; + name);</span><br><span class="line">            return false;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return this.exists.call(this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var exec &#x3D; Runtime.exec.overload(&#39;[Ljava.lang.String;&#39;);</span><br><span class="line">    var exec1 &#x3D; Runtime.exec.overload(&#39;java.lang.String&#39;);</span><br><span class="line">    var exec2 &#x3D; Runtime.exec.overload(&#39;java.lang.String&#39;, &#39;[Ljava.lang.String;&#39;);</span><br><span class="line">    var exec3 &#x3D; Runtime.exec.overload(&#39;[Ljava.lang.String;&#39;, &#39;[Ljava.lang.String;&#39;);</span><br><span class="line">    var exec4 &#x3D; Runtime.exec.overload(&#39;[Ljava.lang.String;&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.io.File&#39;);</span><br><span class="line">    var exec5 &#x3D; Runtime.exec.overload(&#39;java.lang.String&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.io.File&#39;);</span><br><span class="line"></span><br><span class="line">    exec5.implementation &#x3D; function(cmd, env, dir) &#123;</span><br><span class="line">        if (cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;mount&quot; || cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;id&quot; || cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        if (cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        if (cmd &#x3D;&#x3D; &quot;which&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">            send(&quot;Bypass which command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        return exec5.call(this, cmd, env, dir);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec4.implementation &#x3D; function(cmdarr, env, file) &#123;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; cmdarr.length; i &#x3D; i + 1) &#123;</span><br><span class="line">            var tmp_cmd &#x3D; cmdarr[i];</span><br><span class="line">            if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;mount&quot; || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;id&quot; || tmp_cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (tmp_cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return exec4.call(this, cmdarr, env, file);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec3.implementation &#x3D; function(cmdarr, envp) &#123;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; cmdarr.length; i &#x3D; i + 1) &#123;</span><br><span class="line">            var tmp_cmd &#x3D; cmdarr[i];</span><br><span class="line">            if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;mount&quot; || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;id&quot; || tmp_cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (tmp_cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return exec3.call(this, cmdarr, envp);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec2.implementation &#x3D; function(cmd, env) &#123;</span><br><span class="line">        if (cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;mount&quot; || cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;id&quot; || cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        if (cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        return exec2.call(this, cmd, env);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec.implementation &#x3D; function(cmd) &#123;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; cmd.length; i &#x3D; i + 1) &#123;</span><br><span class="line">            var tmp_cmd &#x3D; cmd[i];</span><br><span class="line">            if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;mount&quot; || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;id&quot; || tmp_cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (tmp_cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">                send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">                return exec1.call(this, fakeCmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return exec.call(this, cmd);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    exec1.implementation &#x3D; function(cmd) &#123;</span><br><span class="line">        if (cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;mount&quot; || cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;id&quot; || cmd &#x3D;&#x3D; &quot;sh&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;grep&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        if (cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">            var fakeCmd &#x3D; &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;;</span><br><span class="line">            send(&quot;Bypass &quot; + cmd + &quot; command&quot;);</span><br><span class="line">            return exec1.call(this, fakeCmd);</span><br><span class="line">        &#125;</span><br><span class="line">        return exec1.call(this, cmd);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    String.contains.implementation &#x3D; function(name) &#123;</span><br><span class="line">        if (name &#x3D;&#x3D; &quot;test-keys&quot;) &#123;</span><br><span class="line">            send(&quot;Bypass test-keys check&quot;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return this.contains.call(this, name);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var get &#x3D; SystemProperties.get.overload(&#39;java.lang.String&#39;);</span><br><span class="line"></span><br><span class="line">    get.implementation &#x3D; function(name) &#123;</span><br><span class="line">        if (RootPropertiesKeys.indexOf(name) !&#x3D; -1) &#123;</span><br><span class="line">            send(&quot;Bypass &quot; + name);</span><br><span class="line">            return RootProperties[name];</span><br><span class="line">        &#125;</span><br><span class="line">        return this.get.call(this, name);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(&quot;libc.so&quot;, &quot;fopen&quot;), &#123;</span><br><span class="line">        onEnter: function(args) &#123;</span><br><span class="line">            var path1 &#x3D; Memory.readCString(args[0]);</span><br><span class="line">            var path &#x3D; path1.split(&quot;&#x2F;&quot;);</span><br><span class="line">            var executable &#x3D; path[path.length - 1];</span><br><span class="line">            var shouldFakeReturn &#x3D; (RootBinaries.indexOf(executable) &gt; -1)</span><br><span class="line">            if (shouldFakeReturn) &#123;</span><br><span class="line">                Memory.writeUtf8String(args[0], &quot;&#x2F;ggezxxx&quot;);</span><br><span class="line">                send(&quot;Bypass native fopen &gt;&gt; &quot;+path1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: function(retval) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(&quot;libc.so&quot;, &quot;fopen&quot;), &#123;</span><br><span class="line">        onEnter: function(args) &#123;</span><br><span class="line">            var path1 &#x3D; Memory.readCString(args[0]);</span><br><span class="line">            var path &#x3D; path1.split(&quot;&#x2F;&quot;);</span><br><span class="line">            var executable &#x3D; path[path.length - 1];</span><br><span class="line">            var shouldFakeReturn &#x3D; (RootBinaries.indexOf(executable) &gt; -1)</span><br><span class="line">            if (shouldFakeReturn) &#123;</span><br><span class="line">                Memory.writeUtf8String(args[0], &quot;&#x2F;ggezxxx&quot;);</span><br><span class="line">                send(&quot;Bypass native fopen &gt;&gt; &quot;+path1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: function(retval) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Interceptor.attach(Module.findExportByName(&quot;libc.so&quot;, &quot;system&quot;), &#123;</span><br><span class="line">        onEnter: function(args) &#123;</span><br><span class="line">            var cmd &#x3D; Memory.readCString(args[0]);</span><br><span class="line">            send(&quot;SYSTEM CMD: &quot; + cmd);</span><br><span class="line">            if (cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;mount&quot; || cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || cmd &#x3D;&#x3D; &quot;id&quot;) &#123;</span><br><span class="line">                send(&quot;Bypass native system: &quot; + cmd);</span><br><span class="line">                Memory.writeUtf8String(args[0], &quot;grep&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if (cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                send(&quot;Bypass native system: &quot; + cmd);</span><br><span class="line">                Memory.writeUtf8String(args[0], &quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: function(retval) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;*</span><br><span class="line">    TO IMPLEMENT:</span><br><span class="line">    Exec Family</span><br><span class="line">    int execl(const char *path, const char *arg0, ..., const char *argn, (char *)0);</span><br><span class="line">    int execle(const char *path, const char *arg0, ..., const char *argn, (char *)0, char *const envp[]);</span><br><span class="line">    int execlp(const char *file, const char *arg0, ..., const char *argn, (char *)0);</span><br><span class="line">    int execlpe(const char *file, const char *arg0, ..., const char *argn, (char *)0, char *const envp[]);</span><br><span class="line">    int execv(const char *path, char *const argv[]);</span><br><span class="line">    int execve(const char *path, char *const argv[], char *const envp[]);</span><br><span class="line">    int execvp(const char *file, char *const argv[]);</span><br><span class="line">    int execvpe(const char *file, char *const argv[], char *const envp[]);</span><br><span class="line">    *&#x2F;</span><br><span class="line"></span><br><span class="line">    BufferedReader.readLine.overload().implementation &#x3D; function() &#123;</span><br><span class="line">        var text &#x3D; this.readLine.call(this);</span><br><span class="line">        if (text &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class="line">            &#x2F;&#x2F; just pass , i know it&#39;s ugly as hell but test !&#x3D; null won&#39;t work :(</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            var shouldFakeRead &#x3D; (text.indexOf(&quot;ro.build.tags&#x3D;test-keys&quot;) &gt; -1);</span><br><span class="line">            if (shouldFakeRead) &#123;</span><br><span class="line">                send(&quot;Bypass build.prop file read&quot;);</span><br><span class="line">                text &#x3D; text.replace(&quot;ro.build.tags&#x3D;test-keys&quot;, &quot;ro.build.tags&#x3D;release-keys&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return text;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    var executeCommand &#x3D; ProcessBuilder.command.overload(&#39;java.util.List&#39;);</span><br><span class="line"></span><br><span class="line">    ProcessBuilder.start.implementation &#x3D; function() &#123;</span><br><span class="line">        var cmd &#x3D; this.command.call(this);</span><br><span class="line">        var shouldModifyCommand &#x3D; false;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; cmd.size(); i &#x3D; i + 1) &#123;</span><br><span class="line">            var tmp_cmd &#x3D; cmd.get(i).toString();</span><br><span class="line">            if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd.indexOf(&quot;mount&quot;) !&#x3D; -1 || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd.indexOf(&quot;id&quot;) !&#x3D; -1) &#123;</span><br><span class="line">                shouldModifyCommand &#x3D; true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (shouldModifyCommand) &#123;</span><br><span class="line">            send(&quot;Bypass ProcessBuilder &quot; + cmd);</span><br><span class="line">            this.command.call(this, [&quot;grep&quot;]);</span><br><span class="line">            return this.start.call(this);</span><br><span class="line">        &#125;</span><br><span class="line">        if (cmd.indexOf(&quot;su&quot;) !&#x3D; -1) &#123;</span><br><span class="line">            send(&quot;Bypass ProcessBuilder &quot; + cmd);</span><br><span class="line">            this.command.call(this, [&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;]);</span><br><span class="line">            return this.start.call(this);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return this.start.call(this);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    if (useProcessManager) &#123;</span><br><span class="line">        var ProcManExec &#x3D; ProcessManager.exec.overload(&#39;[Ljava.lang.String;&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.io.File&#39;, &#39;boolean&#39;);</span><br><span class="line">        var ProcManExecVariant &#x3D; ProcessManager.exec.overload(&#39;[Ljava.lang.String;&#39;, &#39;[Ljava.lang.String;&#39;, &#39;java.lang.String&#39;, &#39;java.io.FileDescriptor&#39;, &#39;java.io.FileDescriptor&#39;, &#39;java.io.FileDescriptor&#39;, &#39;boolean&#39;);</span><br><span class="line"></span><br><span class="line">        ProcManExec.implementation &#x3D; function(cmd, env, workdir, redirectstderr) &#123;</span><br><span class="line">            var fake_cmd &#x3D; cmd;</span><br><span class="line">            for (var i &#x3D; 0; i &lt; cmd.length; i &#x3D; i + 1) &#123;</span><br><span class="line">                var tmp_cmd &#x3D; cmd[i];</span><br><span class="line">                if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;mount&quot; || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;id&quot;) &#123;</span><br><span class="line">                    var fake_cmd &#x3D; [&quot;grep&quot;];</span><br><span class="line">                    send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (tmp_cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                    var fake_cmd &#x3D; [&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;];</span><br><span class="line">                    send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return ProcManExec.call(this, fake_cmd, env, workdir, redirectstderr);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ProcManExecVariant.implementation &#x3D; function(cmd, env, directory, stdin, stdout, stderr, redirect) &#123;</span><br><span class="line">            var fake_cmd &#x3D; cmd;</span><br><span class="line">            for (var i &#x3D; 0; i &lt; cmd.length; i &#x3D; i + 1) &#123;</span><br><span class="line">                var tmp_cmd &#x3D; cmd[i];</span><br><span class="line">                if (tmp_cmd.indexOf(&quot;getprop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;mount&quot; || tmp_cmd.indexOf(&quot;build.prop&quot;) !&#x3D; -1 || tmp_cmd &#x3D;&#x3D; &quot;id&quot;) &#123;</span><br><span class="line">                    var fake_cmd &#x3D; [&quot;grep&quot;];</span><br><span class="line">                    send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (tmp_cmd &#x3D;&#x3D; &quot;su&quot;) &#123;</span><br><span class="line">                    var fake_cmd &#x3D; [&quot;justafakecommandthatcannotexistsusingthisshouldthowanexceptionwheneversuiscalled&quot;];</span><br><span class="line">                    send(&quot;Bypass &quot; + cmdarr + &quot; command&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return ProcManExecVariant.call(this, fake_cmd, env, directory, stdin, stdout, stderr, redirect);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (useKeyInfo) &#123;</span><br><span class="line">        KeyInfo.isInsideSecureHardware.implementation &#x3D; function() &#123;</span><br><span class="line">            send(&quot;Bypass isInsideSecureHardware&quot;);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="frida主线程运行"><a href="#frida主线程运行" class="headerlink" title="frida主线程运行"></a>frida主线程运行</h1><p>使用一些方法的时候出现报错 <code>on a thread that has not called Looper.prepare()</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function() &#123;</span><br><span class="line">  var Toast &#x3D; Java.use(&#39;android.widget.Toast&#39;);</span><br><span class="line">  &#x2F;&#x2F; 获取 androidcontext</span><br><span class="line">  var currentApplication &#x3D; Java.use(&#39;android.app.ActivityThread&#39;).currentApplication(); </span><br><span class="line">  var context &#x3D; currentApplication.getApplicationContext();</span><br><span class="line"></span><br><span class="line">  Java.scheduleOnMainThread(function() &#123;</span><br><span class="line">    Toast.makeText(context, &quot;Hello World&quot;, Toast.LENGTH_LONG.value).show();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="过滤打印"><a href="#过滤打印" class="headerlink" title="过滤打印"></a>过滤打印</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">function hook_lnf() &#123;</span><br><span class="line">    var activate &#x3D; false;</span><br><span class="line"></span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var hashmapClass &#x3D; Java.use(&quot;java.util.HashMap&quot;);</span><br><span class="line">        hashmapClass.put.implementation &#x3D; function(key,value)&#123;</span><br><span class="line">            if (activate)&#123;</span><br><span class="line">                console.log(&quot;key:&quot;, key, &quot;value:&quot;, value);</span><br><span class="line">            &#125;</span><br><span class="line">            return this.put(key,value);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var lnfClazz &#x3D; Java.use(&quot;tb.lnf&quot;);</span><br><span class="line">        lnfClazz.a.overload(&#39;java.util.HashMap&#39;, &#39;java.util.HashMap&#39;, &#39;java.lang.String&#39;,</span><br><span class="line">            &#39;java.lang.String&#39;, &#39;boolean&#39;).implementation &#x3D; function (hashmap, hashmap2, str, str2, z) &#123;</span><br><span class="line">                printHashMap(&quot;hashmap&quot;, hashmap);</span><br><span class="line">                printHashMap(&quot;hashmap2&quot;, hashmap2);</span><br><span class="line">                console.log(&quot;str&quot;, str);</span><br><span class="line">                console.log(&quot;str2&quot;, str2);</span><br><span class="line">                console.log(&quot;boolean&quot;, z);</span><br><span class="line">                activate &#x3D; true;</span><br><span class="line">                var result &#x3D; this.a(hashmap, hashmap2, str, str2, z);</span><br><span class="line">                activate &#x3D; false</span><br><span class="line">                printHashMap(&quot;result&quot;, result);</span><br><span class="line">                return result;</span><br><span class="line">            &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="禁止退出"><a href="#禁止退出" class="headerlink" title="禁止退出"></a>禁止退出</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function hookExit()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;[*] Starting hook exit&quot;);</span><br><span class="line">        var exitClass &#x3D; Java.use(&quot;java.lang.System&quot;);</span><br><span class="line">        exitClass.exit.implementation &#x3D; function()&#123;</span><br><span class="line">            console.log(&quot;[*] System.exit.called&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&quot;[*] hooking calls to System.exit&quot;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hookExit);</span><br></pre></td></tr></table></figure><h1 id="修改设备参数"><a href="#修改设备参数" class="headerlink" title="修改设备参数"></a>修改设备参数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; frida hook 修改设备参数</span><br><span class="line">Java.perform(function() &#123;</span><br><span class="line">	var TelephonyManager &#x3D; Java.use(&quot;android.telephony.TelephonyManager&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;IMEI hook</span><br><span class="line">    TelephonyManager.getDeviceId.overload().implementation &#x3D; function () &#123;</span><br><span class="line">               console.log(&quot;[*]Called - getDeviceId()&quot;);</span><br><span class="line">               var temp &#x3D; this.getDeviceId();</span><br><span class="line">               console.log(&quot;real IMEI: &quot;+temp);</span><br><span class="line">               return &quot;867979021642856&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; muti IMEI</span><br><span class="line">    TelephonyManager.getDeviceId.overload(&#39;int&#39;).implementation &#x3D; function (p) &#123;</span><br><span class="line">               console.log(&quot;[*]Called - getDeviceId(int) param is&quot;+p);</span><br><span class="line">               var temp &#x3D; this.getDeviceId(p);</span><br><span class="line">               console.log(&quot;real IMEI &quot;+p+&quot;: &quot;+temp);</span><br><span class="line">               return &quot;867979021642856&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;IMSI hook</span><br><span class="line">	TelephonyManager.getSimSerialNumber.overload().implementation &#x3D; function () &#123;</span><br><span class="line">               console.log(&quot;[*]Called - getSimSerialNumber(String)&quot;);</span><br><span class="line">               var temp &#x3D; this.getSimSerialNumber();</span><br><span class="line">               console.log(&quot;real IMSI: &quot;+temp);</span><br><span class="line">               return &quot;123456789&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;ANDOID_ID hook</span><br><span class="line">    var Secure &#x3D; Java.use(&quot;android.provider.Settings$Secure&quot;);</span><br><span class="line">    Secure.getString.implementation &#x3D; function (p1,p2) &#123;</span><br><span class="line">    	if(p2.indexOf(&quot;android_id&quot;)&lt;0) return this.getString(p1,p2);</span><br><span class="line">    	console.log(&quot;[*]Called - get android_ID, param is:&quot;+p2);</span><br><span class="line">    	var temp &#x3D; this.getString(p1,p2);</span><br><span class="line">    	console.log(&quot;real Android_ID: &quot;+temp);</span><br><span class="line">    	return &quot;844de23bfcf93801&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;android的hidden API，需要通过反射调用</span><br><span class="line">    var SP &#x3D; Java.use(&quot;android.os.SystemProperties&quot;);</span><br><span class="line">    SP.get.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (p1) &#123;</span><br><span class="line">    	var tmp &#x3D; this.get(p1);</span><br><span class="line">    	console.log(&quot;[*]&quot;+p1+&quot; : &quot;+tmp);</span><br><span class="line"></span><br><span class="line">    	return tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    SP.get.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function (p1,p2) &#123;</span><br><span class="line">    	</span><br><span class="line">    	</span><br><span class="line">    	var tmp &#x3D; this.get(p1,p2)</span><br><span class="line">    	console.log(&quot;[*]&quot;+p1+&quot;,&quot;+p2+&quot; : &quot;+tmp);</span><br><span class="line">    	return tmp;</span><br><span class="line">    &#125; </span><br><span class="line">    &#x2F;&#x2F; hook MAC</span><br><span class="line">    var wifi &#x3D; Java.use(&quot;android.net.wifi.WifiInfo&quot;);</span><br><span class="line">    wifi.getMacAddress.implementation &#x3D; function () &#123;</span><br><span class="line">    	var tmp &#x3D; this.getMacAddress();</span><br><span class="line">    	console.log(&quot;[*]real MAC: &quot;+tmp);</span><br><span class="line">    	return tmp;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="请求调用栈"><a href="#请求调用栈" class="headerlink" title="请求调用栈"></a>请求调用栈</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var class_Socket &#x3D; Java.use(&quot;java.net.Socket&quot;);</span><br><span class="line">class_Socket.getOutputStream.overload().implementation &#x3D; function()&#123;</span><br><span class="line">    send(&quot;getOutputSteam&quot;);</span><br><span class="line">    var result &#x3D; this.getOutputStream();</span><br><span class="line">    var bt &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(</span><br><span class="line">        Java.use(&quot;java.lang.Exception&quot;).$new();</span><br><span class="line">    )</span><br><span class="line">    console.log(&quot;Backtrace:&quot; + bt);</span><br><span class="line">    send(result);</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="上下文Context"><a href="#上下文Context" class="headerlink" title="上下文Context"></a>上下文Context</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getContext()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var currentApplication &#x3D; Java.use(&quot;android.app.ActivityThread&quot;).currentApplication();</span><br><span class="line">        console.log(currentApplication);</span><br><span class="line">        var context &#x3D; currentApplication.getApplicationContext();</span><br><span class="line">        console.log(context);</span><br><span class="line">        var packageName &#x3D; context.getPackageName();</span><br><span class="line">        console.log(packageName);</span><br><span class="line">        console.log(currentApplication.getPackageName());</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">frida 传递参数</span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;enter perform&quot;);</span><br><span class="line">        &#x2F;&#x2F; 获取要hook的类</span><br><span class="line">        var TextViewClass &#x3D; Java.use(&quot;android.widget.TextView&quot;);</span><br><span class="line">        &#x2F;&#x2F; 要hook的方法</span><br><span class="line">        TextViewClass.setText.overload(&#39;java.lang.CharSequence&#39;).implementation &#x3D; function (ori_input) &#123;</span><br><span class="line">            console.log(&#39;enter&#39;, &#39;java.lang.CharSequence&#39;);</span><br><span class="line">            console.log(&#39;ori_input&#39;,ori_input.toString());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 定义用于接受python传参的data</span><br><span class="line">            var receive_data;</span><br><span class="line">            &#x2F;&#x2F; 将原参数传递给python 在python中进行处理</span><br><span class="line">            send(ori_input.toString());</span><br><span class="line">            &#x2F;&#x2F; recv 从python接收传递的内容 默认传过来的是个json对象</span><br><span class="line">            recv(function (json_data) &#123;</span><br><span class="line">                console.log(&#39;data from python &#39; + json_data.data);</span><br><span class="line">                receive_data &#x3D; json_data.data;</span><br><span class="line">                console.log(typeof (receive_data));</span><br><span class="line">            &#125;).wait(); &#x2F;&#x2F;wait() 等待python处理 阻塞</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 转java字符串</span><br><span class="line">            receive_data &#x3D; Java.use(&quot;java.lang.String&quot;).$new(receive_data);</span><br><span class="line">            this.setText(receive_data);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main);</span><br><span class="line">python 处理收到的参数</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">__author__ &#x3D; &quot;K&quot;</span><br><span class="line">__time__ &#x3D; &quot;2020-08-06 09:48&quot;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import base64</span><br><span class="line">import frida</span><br><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">def on_message(message,data):</span><br><span class="line">    logger.info(str(message)) # dict</span><br><span class="line">    logger.info(str(data) if data else &quot;None&quot;)</span><br><span class="line"></span><br><span class="line">    if message[&#39;type&#39;] &#x3D;&#x3D; &#39;error&#39;:</span><br><span class="line">        logger.error(&#39;error:&#39; + str(message[&#39;description&#39;]))</span><br><span class="line">        logger.error(&#39;stack: &#39; + str(message[&#39;stack&#39;]))</span><br><span class="line"></span><br><span class="line">    if message[&#39;type&#39;] &#x3D;&#x3D; &#39;send&#39;:</span><br><span class="line">        logger.info(&#39;get message [*] --&gt; &#39; + message[&#39;payload&#39;])</span><br><span class="line"></span><br><span class="line">        payload &#x3D; message[&#39;payload&#39;]</span><br><span class="line">        # 处理逻辑 sending to the server: YWFhOmJiYg&#x3D;&#x3D;</span><br><span class="line">        tmp &#x3D; payload.split(&#39;:&#39;)</span><br><span class="line">        sts &#x3D; tmp[0]</span><br><span class="line">        need_to_db64 &#x3D; tmp[1]</span><br><span class="line">        user_pass &#x3D; base64.b64decode(need_to_db64.encode()).decode()</span><br><span class="line"></span><br><span class="line">        mine_str &#x3D; &#39;admin&#39; + &#39;:&#39; + user_pass.split(&#39;:&#39;)[-1]</span><br><span class="line">        mine_b64_str &#x3D; base64.b64encode(mine_str.encode()).decode()</span><br><span class="line">        mine_b64_str &#x3D; sts + mine_b64_str</span><br><span class="line">        logger.info(mine_b64_str)</span><br><span class="line"></span><br><span class="line">        # python返回数据给js script.post</span><br><span class="line">        script.post(&#123;&#39;data&#39;:mine_b64_str&#125;)</span><br><span class="line">        logger.info(&#39;python complete&#39;)</span><br><span class="line"></span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line"># pid &#x3D; device.spawn([&#39;com.kevin.demo04&#39;])</span><br><span class="line"># time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(&#39;com.kevin.demo02&#39;)</span><br><span class="line">with open(&#39;.&#x2F;hulianhutong.js&#39;,&#39;r&#39;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line"></span><br><span class="line">script.on(&quot;message&quot;,on_message)</span><br><span class="line">script.load()</span><br><span class="line">input()</span><br></pre></td></tr></table></figure><h1 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Java.cast() 子类可以强转成父类, 父类不能转成子类</span><br><span class="line">&#x2F;&#x2F; 可以使用Java.cast()将子类强转成父类, 再调用父类的动态方法</span><br><span class="line"></span><br><span class="line">function castDemo()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var JuiceHandle &#x3D; null; &#x2F;&#x2F; 用来存储内存中找到的Juice对象</span><br><span class="line">        var WaterClass &#x3D; Java.use(&quot;com.r0ysue.a0526printout.Water&quot;);</span><br><span class="line">        </span><br><span class="line">        Java.choose(&quot;com.r0ysue.a0526printout.Juice&quot;,&#123;</span><br><span class="line">			onComplete: function()&#123;&#125;,</span><br><span class="line">             onMatch: function(instance)&#123;</span><br><span class="line">                JuiceHandle &#x3D; instance;</span><br><span class="line">                console.log(&quot;instance:&quot;, instance);</span><br><span class="line">                &#x2F;&#x2F; 调用Juice对象的方法</span><br><span class="line">                console.log(JuiceHandle.fillEnergy());</span><br><span class="line">                &#x2F;&#x2F; 子类Juice转父类Water 并调用父类的动态方法</span><br><span class="line">                var WaterInstance &#x3D; Java.cast(JuiceHandle,WaterClass);</span><br><span class="line">                console.log(WaterInstance.still(WaterInstance));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="map2json"><a href="#map2json" class="headerlink" title="map2json"></a>map2json</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function map2json(mapSet) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        var result &#x3D; &#123;&#125;;</span><br><span class="line">        var key_set &#x3D; mapSet.keySet();</span><br><span class="line">        var it &#x3D; key_set.iterator();</span><br><span class="line">        while (it.hasNext()) &#123;</span><br><span class="line">            var key_str &#x3D; it.next().toString();</span><br><span class="line">            result[key_str] &#x3D; mapSet.get(key_str).toString();</span><br><span class="line">        &#125;</span><br><span class="line">        return result</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">        return mapSet</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="bytes2Hex"><a href="#bytes2Hex" class="headerlink" title="bytes2Hex"></a>bytes2Hex</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function bytes2Hex(arrBytes)&#123;</span><br><span class="line">    var str &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arrBytes.length; i++) &#123;</span><br><span class="line">        var tmp;</span><br><span class="line">        var num &#x3D; arrBytes[i];</span><br><span class="line">        if (num &lt; 0) &#123;</span><br><span class="line">            &#x2F;&#x2F;此处填坑，当byte因为符合位导致数值为负时候，需要对数据进行处理</span><br><span class="line">            tmp &#x3D; (255 + num + 1).toString(16);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tmp &#x3D; num.toString(16);</span><br><span class="line">        &#125;</span><br><span class="line">        if (tmp.length &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        if(i&gt;0)&#123;</span><br><span class="line">            str +&#x3D; &quot; &quot;+tmp;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            str +&#x3D; tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="string2Bytes"><a href="#string2Bytes" class="headerlink" title="string2Bytes"></a>string2Bytes</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function string2Bytes(str) &#123;</span><br><span class="line">    var bytes &#x3D; new Array();</span><br><span class="line">    var len, c;</span><br><span class="line">    len &#x3D; str.length;</span><br><span class="line">    for(var i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">        c &#x3D; str.charCodeAt(i);</span><br><span class="line">        if(c &gt;&#x3D; 0x010000 &amp;&amp; c &lt;&#x3D; 0x10FFFF) &#123;</span><br><span class="line">            bytes.push(((c &gt;&gt; 18) &amp; 0x07) | 0xF0);</span><br><span class="line">            bytes.push(((c &gt;&gt; 12) &amp; 0x3F) | 0x80);</span><br><span class="line">            bytes.push(((c &gt;&gt; 6) &amp; 0x3F) | 0x80);</span><br><span class="line">            bytes.push((c &amp; 0x3F) | 0x80);</span><br><span class="line">        &#125; else if(c &gt;&#x3D; 0x000800 &amp;&amp; c &lt;&#x3D; 0x00FFFF) &#123;</span><br><span class="line">            bytes.push(((c &gt;&gt; 12) &amp; 0x0F) | 0xE0);</span><br><span class="line">            bytes.push(((c &gt;&gt; 6) &amp; 0x3F) | 0x80);</span><br><span class="line">            bytes.push((c &amp; 0x3F) | 0x80);</span><br><span class="line">        &#125; else if(c &gt;&#x3D; 0x000080 &amp;&amp; c &lt;&#x3D; 0x0007FF) &#123;</span><br><span class="line">            bytes.push(((c &gt;&gt; 6) &amp; 0x1F) | 0xC0);</span><br><span class="line">            bytes.push((c &amp; 0x3F) | 0x80);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            bytes.push(c &amp; 0xFF);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="bytes2String"><a href="#bytes2String" class="headerlink" title="bytes2String"></a>bytes2String</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">function bytes2String(arr) &#123;</span><br><span class="line">    if(typeof arr &#x3D;&#x3D;&#x3D; &#39;string&#39;) &#123;</span><br><span class="line">        return arr;</span><br><span class="line">    &#125;</span><br><span class="line">    var str &#x3D; &#39;&#39;,</span><br><span class="line">        _arr &#x3D; arr;</span><br><span class="line">    for(var i &#x3D; 0; i &lt; _arr.length; i++) &#123;</span><br><span class="line">        var one &#x3D; _arr[i].toString(2),</span><br><span class="line">            v &#x3D; one.match(&#x2F;^1+?(?&#x3D;0)&#x2F;);</span><br><span class="line">        if(v &amp;&amp; one.length &#x3D;&#x3D; 8) &#123;</span><br><span class="line">            var bytesLength &#x3D; v[0].length;</span><br><span class="line">            var store &#x3D; _arr[i].toString(2).slice(7 - bytesLength);</span><br><span class="line">            for(var st &#x3D; 1; st &lt; bytesLength; st++) &#123;</span><br><span class="line">                store +&#x3D; _arr[st + i].toString(2).slice(2);</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                str +&#x3D; String.fromCharCode(parseInt(store, 2));</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                str +&#x3D; parseInt(store, 2).toString(); </span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">            i +&#x3D; bytesLength - 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                str +&#x3D; String.fromCharCode(_arr[i]);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                str +&#x3D; parseInt(store, 2).toString(); </span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="bytes2Base64"><a href="#bytes2Base64" class="headerlink" title="bytes2Base64"></a>bytes2Base64</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function bytes2Base64(e) &#123;</span><br><span class="line">    var base64EncodeChars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&#39;;</span><br><span class="line">    var r, a, c, h, o, t;</span><br><span class="line">    for (c &#x3D; e.length, a &#x3D; 0, r &#x3D; &#39;&#39;; a &lt; c;) &#123;</span><br><span class="line">        if (h &#x3D; 255 &amp; e[a++], a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        if (o &#x3D; e[a++], a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        t &#x3D; e[a++],</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2 | (192 &amp; t) &gt;&gt; 6),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(63 &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    return r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="常见算法hook"><a href="#常见算法hook" class="headerlink" title="常见算法hook"></a>常见算法hook</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">    var secretKeySpec &#x3D; Java.use(&#39;javax.crypto.spec.SecretKeySpec&#39;);</span><br><span class="line">    secretKeySpec.$init.overload(&#39;[B&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function (a, b) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.$init(a, b);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;算法名：&quot; + b + &quot;|Dec密钥:&quot; + bytesToString(a));</span><br><span class="line">        send(&quot;算法名：&quot; + b + &quot;|Hex密钥:&quot; + bytesToHex(a));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var mac &#x3D; Java.use(&#39;javax.crypto.Mac&#39;);</span><br><span class="line">    mac.getInstance.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.getInstance(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;算法名：&quot; + a);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    mac.update.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        this.update(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a))</span><br><span class="line">    &#125;</span><br><span class="line">    mac.update.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function (a, b, c) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        this.update(a, b, c)</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a) + &quot;|&quot; + b + &quot;|&quot; + c);</span><br><span class="line">    &#125;</span><br><span class="line">    mac.doFinal.overload().implementation &#x3D; function () &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.doFinal();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    mac.doFinal.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.doFinal(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;doFinal参数:&quot; + bytesToString(a));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var md &#x3D; Java.use(&#39;java.security.MessageDigest&#39;);</span><br><span class="line">    md.getInstance.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function (a, b) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;算法名：&quot; + a);</span><br><span class="line">        return this.getInstance(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">    md.getInstance.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;算法名：&quot; + a);</span><br><span class="line">        return this.getInstance(a);</span><br><span class="line">    &#125;</span><br><span class="line">    md.update.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a))</span><br><span class="line">        return this.update(a);</span><br><span class="line">    &#125;</span><br><span class="line">    md.update.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function (a, b, c) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a) + &quot;|&quot; + b + &quot;|&quot; + c);</span><br><span class="line">        return this.update(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    md.digest.overload().implementation &#x3D; function () &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        var result &#x3D; this.digest();</span><br><span class="line">        send(&quot;digest结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;digest结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    md.digest.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;digest参数:&quot; + bytesToString(a));</span><br><span class="line">        var result &#x3D; this.digest(a);</span><br><span class="line">        send(&quot;digest结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;digest结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var ivParameterSpec &#x3D; Java.use(&#39;javax.crypto.spec.IvParameterSpec&#39;);</span><br><span class="line">    ivParameterSpec.$init.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.$init(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;iv向量:&quot; + bytesToString(a));</span><br><span class="line">        send(&quot;iv向量:&quot; + bytesToHex(a));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var cipher &#x3D; Java.use(&#39;javax.crypto.Cipher&#39;);</span><br><span class="line">    cipher.getInstance.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.getInstance(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;模式填充:&quot; + a);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    cipher.update.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.update(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    cipher.update.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function (a, b, c) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.update(a, b, c);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;update:&quot; + bytesToString(a) + &quot;|&quot; + b + &quot;|&quot; + c);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    cipher.doFinal.overload().implementation &#x3D; function () &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.doFinal();</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    cipher.doFinal.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.doFinal(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;doFinal参数:&quot; + bytesToString(a));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToHex(result));</span><br><span class="line">        send(&quot;doFinal结果:&quot; + bytesToBase64(result));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var x509EncodedKeySpec &#x3D; Java.use(&#39;java.security.spec.X509EncodedKeySpec&#39;);</span><br><span class="line">    x509EncodedKeySpec.$init.overload(&#39;[B&#39;).implementation &#x3D; function (a) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.$init(a);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        send(&quot;RSA密钥:&quot; + bytesToBase64(a));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    var rSAPublicKeySpec &#x3D; Java.use(&#39;java.security.spec.RSAPublicKeySpec&#39;);</span><br><span class="line">    rSAPublicKeySpec.$init.overload(&#39;java.math.BigInteger&#39;, &#39;java.math.BigInteger&#39;).implementation &#x3D; function (a, b) &#123;</span><br><span class="line">        showStacks();</span><br><span class="line">        var result &#x3D; this.$init(a, b);</span><br><span class="line">        send(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">        &#x2F;&#x2F;send(&quot;RSA密钥:&quot; + bytesToBase64(a));</span><br><span class="line">        send(&quot;RSA密钥N:&quot; + a.toString(16));</span><br><span class="line">        send(&quot;RSA密钥E:&quot; + b.toString(16));</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="base64实现"><a href="#base64实现" class="headerlink" title="base64实现"></a>base64实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">DEFAULT &#x3D; 0  # 默认模式, 每行不超过76个字符</span><br><span class="line">NO_PADDING &#x3D; 1  # 移除最后的&#x3D;</span><br><span class="line">NO_WRAP &#x3D; 2  # 不换行，一行输出</span><br><span class="line">CRLF &#x3D; 4  # 采用win上的换行符</span><br><span class="line">URL_SAVE &#x3D; 8  # 采用urlsafe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def decode(content: str, flag: int) -&gt; bytes:</span><br><span class="line">    missing_padding &#x3D; len(content) % 4</span><br><span class="line">    if missing_padding !&#x3D; 0:</span><br><span class="line">        content &#x3D; content.ljust(len(content) + (4 - missing_padding), &quot;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">    if flag &amp; URL_SAVE:</span><br><span class="line">        result &#x3D; base64.urlsafe_b64decode(content.encode(&quot;utf-8&quot;))</span><br><span class="line">    else:</span><br><span class="line">        result &#x3D; base64.b64decode(content.encode(&quot;utf-8&quot;))</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def encode(content: bytes, flag: int) -&gt; str:</span><br><span class="line">    need_wrap &#x3D; True</span><br><span class="line">    need_padding &#x3D; True</span><br><span class="line">    lf &#x3D; &quot;\n&quot;</span><br><span class="line"></span><br><span class="line">    if flag &amp; NO_WRAP:</span><br><span class="line">        need_wrap &#x3D; False</span><br><span class="line">    if flag &amp; NO_PADDING:</span><br><span class="line">        need_padding &#x3D; False</span><br><span class="line">    if flag &amp; CRLF:</span><br><span class="line">        lf &#x3D; &quot;\r\n&quot;</span><br><span class="line"></span><br><span class="line">    if flag &amp; URL_SAVE:</span><br><span class="line">        result &#x3D; base64.urlsafe_b64encode(content).decode(&quot;utf-8&quot;)</span><br><span class="line">    else:</span><br><span class="line">        result &#x3D; base64.b64encode(content).decode(&quot;utf-8&quot;)</span><br><span class="line"></span><br><span class="line">    if not need_padding:</span><br><span class="line">        result &#x3D; result.rstrip(&quot;&#x3D;&quot;)</span><br><span class="line"></span><br><span class="line">    if need_wrap:</span><br><span class="line">        n &#x3D; 76</span><br><span class="line">        output &#x3D; lf.join([result[i:i + n] for i in range(0, len(result), n)])</span><br><span class="line">    else:</span><br><span class="line">        output &#x3D; result</span><br><span class="line"></span><br><span class="line">    return output</span><br></pre></td></tr></table></figure><h1 id="常用转换模板"><a href="#常用转换模板" class="headerlink" title="常用转换模板"></a>常用转换模板</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;工具相关函数</span><br><span class="line">var base64EncodeChars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&#39;,</span><br><span class="line">    base64DecodeChars &#x3D; new Array((-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), (-1), 62, (-1), (-1), (-1), 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, (-1), (-1), (-1), (-1), (-1), (-1), (-1), 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, (-1), (-1), (-1), (-1), (-1), (-1), 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, (-1), (-1), (-1), (-1), (-1));</span><br><span class="line"></span><br><span class="line">function stringToBase64(e) &#123;</span><br><span class="line">    var r, a, c, h, o, t;</span><br><span class="line">    for (c &#x3D; e.length, a &#x3D; 0, r &#x3D; &#39;&#39;; a &lt; c;) &#123;</span><br><span class="line">        if (h &#x3D; 255 &amp; e.charCodeAt(a++), a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        if (o &#x3D; e.charCodeAt(a++), a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        t &#x3D; e.charCodeAt(a++),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2 | (192 &amp; t) &gt;&gt; 6),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(63 &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    return r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function base64ToString(e) &#123;</span><br><span class="line">    var r, a, c, h, o, t, d;</span><br><span class="line">    for (t &#x3D; e.length, o &#x3D; 0, d &#x3D; &#39;&#39;; o &lt; t;) &#123;</span><br><span class="line">        do</span><br><span class="line">            r &#x3D; base64DecodeChars[255 &amp; e.charCodeAt(o++)];</span><br><span class="line">        while (o &lt; t &amp;&amp; r &#x3D;&#x3D; -1);</span><br><span class="line">        if (r &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        do</span><br><span class="line">            a &#x3D; base64DecodeChars[255 &amp; e.charCodeAt(o++)];</span><br><span class="line">        while (o &lt; t &amp;&amp; a &#x3D;&#x3D; -1);</span><br><span class="line">        if (a &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d +&#x3D; String.fromCharCode(r &lt;&lt; 2 | (48 &amp; a) &gt;&gt; 4);</span><br><span class="line">        do &#123;</span><br><span class="line">            if (c &#x3D; 255 &amp; e.charCodeAt(o++), 61 &#x3D;&#x3D; c)</span><br><span class="line">                return d;</span><br><span class="line">            c &#x3D; base64DecodeChars[c]</span><br><span class="line">        &#125; while (o &lt; t &amp;&amp; c &#x3D;&#x3D; -1);</span><br><span class="line">        if (c &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d +&#x3D; String.fromCharCode((15 &amp; a) &lt;&lt; 4 | (60 &amp; c) &gt;&gt; 2);</span><br><span class="line">        do &#123;</span><br><span class="line">            if (h &#x3D; 255 &amp; e.charCodeAt(o++), 61 &#x3D;&#x3D; h)</span><br><span class="line">                return d;</span><br><span class="line">            h &#x3D; base64DecodeChars[h]</span><br><span class="line">        &#125; while (o &lt; t &amp;&amp; h &#x3D;&#x3D; -1);</span><br><span class="line">        if (h &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d +&#x3D; String.fromCharCode((3 &amp; c) &lt;&lt; 6 | h)</span><br><span class="line">    &#125;</span><br><span class="line">    return d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hexToBase64(str) &#123;</span><br><span class="line">    return base64Encode(String.fromCharCode.apply(null, str.replace(&#x2F;\r|\n&#x2F;g, &quot;&quot;).replace(&#x2F;([\da-fA-F]&#123;2&#125;) ?&#x2F;g, &quot;0x$1 &quot;).replace(&#x2F; +$&#x2F;, &quot;&quot;).split(&quot; &quot;)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function base64ToHex(str) &#123;</span><br><span class="line">    for (var i &#x3D; 0, bin &#x3D; base64Decode(str.replace(&#x2F;[ \r\n]+$&#x2F;, &quot;&quot;)), hex &#x3D; []; i &lt; bin.length; ++i) &#123;</span><br><span class="line">        var tmp &#x3D; bin.charCodeAt(i).toString(16);</span><br><span class="line">        if (tmp.length &#x3D;&#x3D;&#x3D; 1)</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        hex[hex.length] &#x3D; tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return hex.join(&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hexToBytes(str) &#123;</span><br><span class="line">    var pos &#x3D; 0;</span><br><span class="line">    var len &#x3D; str.length;</span><br><span class="line">    if (len % 2 !&#x3D; 0) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    len &#x2F;&#x3D; 2;</span><br><span class="line">    var hexA &#x3D; new Array();</span><br><span class="line">    for (var i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">        var s &#x3D; str.substr(pos, 2);</span><br><span class="line">        var v &#x3D; parseInt(s, 16);</span><br><span class="line">        hexA.push(v);</span><br><span class="line">        pos +&#x3D; 2;</span><br><span class="line">    &#125;</span><br><span class="line">    return hexA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bytesToHex(arr) &#123;</span><br><span class="line">    var str &#x3D; &#39;&#39;;</span><br><span class="line">    var k, j;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        k &#x3D; arr[i];</span><br><span class="line">        j &#x3D; k;</span><br><span class="line">        if (k &lt; 0) &#123;</span><br><span class="line">            j &#x3D; k + 256;</span><br><span class="line">        &#125;</span><br><span class="line">        if (j &lt; 16) &#123;</span><br><span class="line">            str +&#x3D; &quot;0&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; j.toString(16);</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stringToHex(str) &#123;</span><br><span class="line">    var val &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; str.length; i++) &#123;</span><br><span class="line">        if (val &#x3D;&#x3D; &quot;&quot;)</span><br><span class="line">            val &#x3D; str.charCodeAt(i).toString(16);</span><br><span class="line">        else</span><br><span class="line">            val +&#x3D; str.charCodeAt(i).toString(16);</span><br><span class="line">    &#125;</span><br><span class="line">    return val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stringToBytes(str) &#123;</span><br><span class="line">    var ch, st, re &#x3D; [];</span><br><span class="line">    for (var i &#x3D; 0; i &lt; str.length; i++) &#123;</span><br><span class="line">        ch &#x3D; str.charCodeAt(i);</span><br><span class="line">        st &#x3D; [];</span><br><span class="line">        do &#123;</span><br><span class="line">            st.push(ch &amp; 0xFF);</span><br><span class="line">            ch &#x3D; ch &gt;&gt; 8;</span><br><span class="line">        &#125;</span><br><span class="line">        while (ch);</span><br><span class="line">        re &#x3D; re.concat(st.reverse());</span><br><span class="line">    &#125;</span><br><span class="line">    return re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;将byte[]转成String的方法</span><br><span class="line">function bytesToString(arr) &#123;</span><br><span class="line">    var str &#x3D; &#39;&#39;;</span><br><span class="line">    arr &#x3D; new Uint8Array(arr);</span><br><span class="line">    for (var i in arr) &#123;</span><br><span class="line">        str +&#x3D; String.fromCharCode(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bytesToBase64(e) &#123;</span><br><span class="line">    var r, a, c, h, o, t;</span><br><span class="line">    for (c &#x3D; e.length, a &#x3D; 0, r &#x3D; &#39;&#39;; a &lt; c;) &#123;</span><br><span class="line">        if (h &#x3D; 255 &amp; e[a++], a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        if (o &#x3D; e[a++], a &#x3D;&#x3D; c) &#123;</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">                r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2),</span><br><span class="line">                r +&#x3D; &#39;&#x3D;&#39;;</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        t &#x3D; e[a++],</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(h &gt;&gt; 2),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((3 &amp; h) &lt;&lt; 4 | (240 &amp; o) &gt;&gt; 4),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt((15 &amp; o) &lt;&lt; 2 | (192 &amp; t) &gt;&gt; 6),</span><br><span class="line">            r +&#x3D; base64EncodeChars.charAt(63 &amp; t)</span><br><span class="line">    &#125;</span><br><span class="line">    return r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function base64ToBytes(e) &#123;</span><br><span class="line">    var r, a, c, h, o, t, d;</span><br><span class="line">    for (t &#x3D; e.length, o &#x3D; 0, d &#x3D; []; o &lt; t;) &#123;</span><br><span class="line">        do</span><br><span class="line">            r &#x3D; base64DecodeChars[255 &amp; e.charCodeAt(o++)];</span><br><span class="line">        while (o &lt; t &amp;&amp; r &#x3D;&#x3D; -1);</span><br><span class="line">        if (r &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        do</span><br><span class="line">            a &#x3D; base64DecodeChars[255 &amp; e.charCodeAt(o++)];</span><br><span class="line">        while (o &lt; t &amp;&amp; a &#x3D;&#x3D; -1);</span><br><span class="line">        if (a &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d.push(r &lt;&lt; 2 | (48 &amp; a) &gt;&gt; 4);</span><br><span class="line">        do &#123;</span><br><span class="line">            if (c &#x3D; 255 &amp; e.charCodeAt(o++), 61 &#x3D;&#x3D; c)</span><br><span class="line">                return d;</span><br><span class="line">            c &#x3D; base64DecodeChars[c]</span><br><span class="line">        &#125; while (o &lt; t &amp;&amp; c &#x3D;&#x3D; -1);</span><br><span class="line">        if (c &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d.push((15 &amp; a) &lt;&lt; 4 | (60 &amp; c) &gt;&gt; 2);</span><br><span class="line">        do &#123;</span><br><span class="line">            if (h &#x3D; 255 &amp; e.charCodeAt(o++), 61 &#x3D;&#x3D; h)</span><br><span class="line">                return d;</span><br><span class="line">            h &#x3D; base64DecodeChars[h]</span><br><span class="line">        &#125; while (o &lt; t &amp;&amp; h &#x3D;&#x3D; -1);</span><br><span class="line">        if (h &#x3D;&#x3D; -1)</span><br><span class="line">            break;</span><br><span class="line">        d.push((3 &amp; c) &lt;&lt; 6 | h)</span><br><span class="line">    &#125;</span><br><span class="line">    return d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 打印log</span><br><span class="line">function showStacks() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        send(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new()));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 字节数组转hex字符串</span><br><span class="line">function bytesToHex(arr) &#123;</span><br><span class="line">    var str &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        var tmp &#x3D; arr[i];</span><br><span class="line">        if (tmp &lt; 0) &#123;</span><br><span class="line">            tmp &#x3D; (255 + tmp + 1).toString(16);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tmp &#x3D; tmp.toString(16);</span><br><span class="line">        &#125;</span><br><span class="line">        if (tmp.length &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bytesToBase64(arr) &#123;</span><br><span class="line">    var str &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        var tmp &#x3D; arr[i];</span><br><span class="line">        if (tmp &lt; 0) &#123;</span><br><span class="line">            tmp &#x3D; (255 + tmp + 1).toString(16);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tmp &#x3D; tmp.toString(16);</span><br><span class="line">        &#125;</span><br><span class="line">        if (tmp.length &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bytesToString(arr) &#123;</span><br><span class="line">    var str &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        var tmp &#x3D; arr[i];</span><br><span class="line">        if (tmp &lt; 0) &#123;</span><br><span class="line">            tmp &#x3D; (255 + tmp + 1).toString(16);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tmp &#x3D; tmp.toString(16);</span><br><span class="line">        &#125;</span><br><span class="line">        if (tmp.length &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line">function byteToHexString(uint8arr) &#123;</span><br><span class="line">    if (!uint8arr) &#123;</span><br><span class="line">        return &#39;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    var hexStr &#x3D; &#39;&#39;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; uint8arr.length; i++) &#123;</span><br><span class="line">        var hex &#x3D; (uint8arr[i] &amp; 0xff).toString(16);</span><br><span class="line">        hex &#x3D; (hex.length &#x3D;&#x3D;&#x3D; 1) ? &#39;0&#39; + hex : hex;</span><br><span class="line">        hexStr +&#x3D; hex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return hexStr.toUpperCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function stringToUint8Array(str)&#123;</span><br><span class="line">  var arr &#x3D; [];</span><br><span class="line">  for (var i &#x3D; 0, j &#x3D; str.length; i &lt; j; ++i) &#123;</span><br><span class="line">    arr.push(str.charCodeAt(i));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var tmpUint8Array &#x3D; new Uint8Array(arr);</span><br><span class="line">  return tmpUint8Array</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function str2arraybffer(str) &#123;</span><br><span class="line">    var buf &#x3D; new ArrayBuffer(str.length * 2); &#x2F;&#x2F; 每个字符占用2个字节</span><br><span class="line">    var bufView &#x3D; new Uint16Array(buf);</span><br><span class="line">    for (var i &#x3D; 0, strLen &#x3D; str.length; i &lt; strLen; i++) &#123;</span><br><span class="line">        bufView[i] &#x3D; str.charCodeAt(i);</span><br><span class="line">    &#125;</span><br><span class="line">    return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function printBytes(b)&#123;</span><br><span class="line">	</span><br><span class="line">    var hexstr &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i&#x3D;0; i&lt; b.length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        var uByte &#x3D; (b[i]&gt;&gt;&gt;0)&amp;0xff;</span><br><span class="line">        var n &#x3D; uByte.toString(16);</span><br><span class="line">        hexstr +&#x3D; &quot;0x&quot; + (&quot;00&quot; + n).slice(-2)+&quot;, &quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	return hexstr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;字节数组转十六进制字符串，对负值填坑</span><br><span class="line">&#x2F;&#x2F; 二进制数据（包括内存地址）在计算机中一般以16进制的方式表示</span><br><span class="line">function Bytes2HexString(arrBytes) &#123;</span><br><span class="line">    var str &#x3D; &quot;&quot;;</span><br><span class="line">    for (var i &#x3D; 0; i &lt; arrBytes.length; i++) &#123;</span><br><span class="line">        var tmp;</span><br><span class="line">        var num&#x3D;arrBytes[i];</span><br><span class="line">        if (num &lt; 0) &#123;</span><br><span class="line">            &#x2F;&#x2F;此处填坑，当byte因为符合位导致数值为负时候，需要对数据进行处理</span><br><span class="line">            tmp &#x3D;(255+num+1).toString(16);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tmp &#x3D; num.toString(16);</span><br><span class="line">        &#125;</span><br><span class="line">        if (tmp.length &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            tmp &#x3D; &quot;0&quot; + tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 会转成有符号的数字  	JSON.stringify(bytes)</span><br><span class="line">function HexString2Bytes(str) &#123;</span><br><span class="line">    var pos &#x3D; 0;</span><br><span class="line">    var len &#x3D; str.length;</span><br><span class="line">    if (len % 2 !&#x3D; 0) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    len &#x2F;&#x3D; 2;</span><br><span class="line">    var arrBytes &#x3D; new Array();</span><br><span class="line">    for (var i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">        var s &#x3D; str.substr(pos, 2);</span><br><span class="line">        var v &#x3D; parseInt(s, 16);</span><br><span class="line">		&#x2F;&#x2F; 转成有符号的 10进制</span><br><span class="line">		if (v &gt; 127) &#123; v &#x3D; v - 256 &#125;</span><br><span class="line">		&#x2F;&#x2F; end</span><br><span class="line">        arrBytes.push(v);</span><br><span class="line">        pos +&#x3D; 2;</span><br><span class="line">    &#125;</span><br><span class="line">    return arrBytes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function jstring2Str(jstring) &#123;</span><br><span class="line">   var ret;</span><br><span class="line">   Java.perform(function() &#123;</span><br><span class="line">       var String &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">       ret &#x3D; Java.cast(jstring, String);</span><br><span class="line">   &#125;);</span><br><span class="line">   return ret;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function jbyteArray2Array(jbyteArray) &#123;</span><br><span class="line">   var ret;</span><br><span class="line">   Java.perform(function() &#123;</span><br><span class="line">       var b &#x3D; Java.use(&#39;[B&#39;);</span><br><span class="line">       var buffer &#x3D; Java.cast(jbyteArray, b);</span><br><span class="line">       ret &#x3D; Java.array(&#39;byte&#39;, buffer);</span><br><span class="line">   &#125;);</span><br><span class="line">   return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getParamType(obj) &#123;</span><br><span class="line">    return obj &#x3D;&#x3D; null ? String(obj) : Object.prototype.toString.call(obj).replace(&#x2F;\[object\s+(\w+)\]&#x2F;i, &quot;$1&quot;) || &quot;object&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="打印class"><a href="#打印class" class="headerlink" title="打印class"></a>打印class</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">function printClass(c)&#123;</span><br><span class="line">    var str &#x3D; &quot;-------------------------------\n&quot;;</span><br><span class="line">    str +&#x3D; &quot;|&quot; + JSON.stringify(c) + &quot;\n&quot;;</span><br><span class="line">    var fields &#x3D; c.getClass().getFields();</span><br><span class="line">    for(var index in fields)&#123;</span><br><span class="line">        var field &#x3D; fields[index];</span><br><span class="line">        var fieldName &#x3D; &quot;&quot;;</span><br><span class="line">        var value &#x3D; &quot;&quot;;</span><br><span class="line">        try&#123;</span><br><span class="line">            fieldName &#x3D; field.getName();</span><br><span class="line">            value &#x3D; field.get(c);</span><br><span class="line">        &#125;catch(e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        if(fieldName &#x3D;&#x3D; &quot;&quot;)&#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        str +&#x3D; &quot;|&quot; + fieldName + &quot;:&quot; + printValue(value) + &quot;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    str +&#x3D; &quot;------------------------------\n\n\n&quot;;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function printValue(value)&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        var newValue &#x3D; Java.cast(value, Java.use(&quot;java.lang.Object&quot;))</span><br><span class="line">        switch(newValue.getClass().getName())&#123;</span><br><span class="line">            case &quot;[B&quot;:</span><br><span class="line">                return printBytes(value)</span><br><span class="line">        &#125;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function printBytes(result)&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        var ByteArrayOutputStreamClass &#x3D; Java.use(&quot;java.io.ByteArrayOutputStream&quot;);</span><br><span class="line">        var out &#x3D; ByteArrayOutputStreamClass.$new()</span><br><span class="line">        var ObjectOutputStreamClass &#x3D; Java.use(&quot;java.io.ObjectOutputStream&quot;);</span><br><span class="line">        var sOut &#x3D; ObjectOutputStreamClass.$new(out);</span><br><span class="line">        sOut.writeObject(result);</span><br><span class="line">        sOut.flush();</span><br><span class="line">        var bytes &#x3D; out.toByteArray();</span><br><span class="line">        var argsArray &#x3D; [];</span><br><span class="line">        for(var i &#x3D; 0; i &lt; bytes.length; i++) &#123;</span><br><span class="line">            argsArray.push(bytes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;[&quot;+argsArray.join(&quot;,&quot;)+&quot;]&quot;;</span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        console.log(e);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"25827-1638538754631-918",name:"万物皆可逆向",qrcode:"https://onejane.github.io/gzh.jpg",keyword:"密码"})}</script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2021/11/13/frida常用api大全/">http://onejane.github.io/2021/11/13/frida常用api大全/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">万物皆可逆向</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frida/">frida</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/11/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E8%85%BE%E8%AE%AF%E8%A7%86%E9%A2%91wasm%E7%9A%84ckey%E5%88%86%E6%9E%90/"><i class="fa fa-chevron-left"></i> <span>JS逆向之腾讯视频wasm的ckey分析</span></a></div><div class="next-post pull-right"><a href="/2021/11/11/SO%E9%80%86%E5%90%91%E4%B9%8B%E6%9C%80%E5%8F%B3sign%E5%88%86%E6%9E%90/"><span>SO逆向之最右sign分析</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2023 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>