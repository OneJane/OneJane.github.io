<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Xposed搭建开发"><meta name="keywords" content="xposed"><meta name="author" content="J"><meta name="copyright" content="J"><title>Xposed搭建开发 | 万物皆可逆向</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.2.1"}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#篇幅有限"><span class="toc-number">1.</span> <span class="toc-text">篇幅有限</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pixel刷安卓7"><span class="toc-number">2.</span> <span class="toc-text">pixel刷安卓7</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xposed"><span class="toc-number">3.</span> <span class="toc-text">xposed</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#demo"><span class="toc-number">3.1.</span> <span class="toc-text">demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook"><span class="toc-number">3.2.</span> <span class="toc-text">hook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook-HookTest"><span class="toc-number">3.2.1.</span> <span class="toc-text">Hook HookTest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook-XposedBridge"><span class="toc-number">3.2.2.</span> <span class="toc-text">Hook XposedBridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook-All-Methods"><span class="toc-number">3.2.3.</span> <span class="toc-text">Hook All Methods</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GravityBox"><span class="toc-number">4.</span> <span class="toc-text">GravityBox</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#源码分析"><span class="toc-number">4.1.</span> <span class="toc-text">源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Not-In-Frida"><span class="toc-number">4.2.</span> <span class="toc-text">Not In Frida</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Not-In-Xposed"><span class="toc-number">4.3.</span> <span class="toc-text">Not In Xposed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hook-1"><span class="toc-number">4.4.</span> <span class="toc-text">hook</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">74</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">64</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">万物皆可逆向</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">Xposed搭建开发</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">4.2k</span><span class="post-meta__separator">|</span><span>阅读时长: 23 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><div id="vip-container"><h1 id="篇幅有限"><a href="#篇幅有限" class="headerlink" title="篇幅有限"></a>篇幅有限</h1><p>完整内容及源码关注公众号：ReverseCode，发送 <strong>冲</strong></p><h1 id="pixel刷安卓7"><a href="#pixel刷安卓7" class="headerlink" title="pixel刷安卓7"></a>pixel刷安卓7</h1><p>proxychains wget <a href="https://dl.google.com/dl/android/aosp/sailfish-n2g47o-factory-f2bc8024.zip" target="_blank" rel="noopener">https://dl.google.com/dl/android/aosp/sailfish-n2g47o-factory-f2bc8024.zip</a></p><p>proxychains wget <a href="https://forum.xda-developers.com/attachments/xposedinstaller_3-1-5-apk.4393082/" target="_blank" rel="noopener">https://forum.xda-developers.com/attachments/xposedinstaller_3-1-5-apk.4393082/</a></p><p>proxychains wget <a href="https://supersuroot.org/downloads/supersu-pro.apk" target="_blank" rel="noopener">https://supersuroot.org/downloads/supersu-pro.apk</a></p><p>proxychains wget <a href="https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img" target="_blank" rel="noopener">https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd sailfish-opm4.171019.021.p1 &amp;&amp; adb reboot bootloader &amp;&amp;  .&#x2F;flash-all.sh</span><br><span class="line">adb push SR5-SuperSU-v2.82-SR5-20171001224502.zip  &#x2F;data&#x2F;local&#x2F;tmp</span><br><span class="line">adb reboot bootloader &amp;&amp; fastboot boot twrp-3.3.0-0-sailfish.img   刷入twrp后安装supersu</span><br><span class="line">adb install XposedInstaller_3.1.5.apk  常见模块https:&#x2F;&#x2F;github.com&#x2F;WrBug&#x2F;GravityBox.git</span><br><span class="line">adb push timeadjust.sh &#x2F;data&#x2F;local&#x2F;tmp &amp;&amp; sh timeadjust.sh  时间修改正确</span><br><span class="line">adb install com.ttxapps.wifiadb_2.1.3-810031745_minAPI15.apk</span><br></pre></td></tr></table></figure><h1 id="xposed"><a href="#xposed" class="headerlink" title="xposed"></a>xposed</h1><p><a href="https://api.xposed.info/reference/android/app/AndroidAppHelper.html" target="_blank" rel="noopener">xposed api</a></p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423225219896.png" alt="image-20210423225219896"></p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>过滤子进程：loadPackageParam.processName,可以通过hook参数、调用栈、返回值 ，打印和修改，Xposed的开发，本质上就是Java的开发。</p><ol><li><p><strong>创建安卓项目xposed1</strong></p></li><li><p><strong>build.gradle引入xposed api依赖</strong></p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;com.android.application&#39;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 30</span><br><span class="line">    buildToolsVersion &quot;30.0.2&quot;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.roysue.xposed1&quot;</span><br><span class="line">        minSdkVersion 16</span><br><span class="line">        targetSdkVersion 30</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly &#39;de.robv.android.xposed:api:82&#39;</span><br><span class="line">    compileOnly &#39;de.robv.android.xposed:api:82:sources&#39;</span><br><span class="line">    implementation fileTree(dir: &quot;libs&quot;, include: [&quot;*.jar&quot;])</span><br><span class="line">    implementation &#39;androidx.appcompat:appcompat:1.2.0&#39;</span><br><span class="line">    implementation &#39;androidx.constraintlayout:constraintlayout:2.0.2&#39;</span><br><span class="line">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.2&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.3.0&#39;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>AndroidManifest.xml添加xposed项目基本配置</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    package&#x3D;&quot;com.roysue.xposed1&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class="line">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class="line">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class="line">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class="line">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class="line">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposedmodule&quot;</span><br><span class="line">            android:value&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposeddescription&quot;</span><br><span class="line">            android:value&#x3D;&quot;这是一个Xposed例程&quot; &#x2F;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposedminversion&quot;</span><br><span class="line">            android:value&#x3D;&quot;53&quot; &#x2F;&gt;</span><br><span class="line">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class="line">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;intent-filter&gt;</span><br><span class="line">        &lt;&#x2F;activity&gt;</span><br><span class="line">    &lt;&#x2F;application&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>activity_main.xml添加按钮组件</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;button&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:text&#x3D;&quot;Button&quot;</span><br><span class="line">        tools:layout_editor_absoluteX&#x3D;&quot;158dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY&#x3D;&quot;238dp&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>MainActivity调用Button组件，实现被hook方法toastMessage</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private Button button;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button &#x3D; (Button) findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Toast.makeText(MainActivity.this, toastMessage(&quot;我未被劫持&quot;), Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public String toastMessage(String message) &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><strong>继承IXposedHookLoadPackage实现hook</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class HookTest implements IXposedHookLoadPackage &#123;</span><br><span class="line">    &#x2F;&#x2F; 堆栈打印</span><br><span class="line">    public void PrintStack()&#123;</span><br><span class="line"></span><br><span class="line">        XposedBridge.log(&quot;Dump Stack: &quot;+ &quot;---------------start----------------&quot;);</span><br><span class="line">        Throwable ex &#x3D; new Throwable();</span><br><span class="line">        StackTraceElement[] stackElements &#x3D; ex.getStackTrace();</span><br><span class="line">        if (stackElements !&#x3D; null) &#123;</span><br><span class="line">            for (int i &#x3D; 0; i &lt; stackElements.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">                XposedBridge.log(&quot;Dump Stack&quot;+i+&quot;: &quot;+ stackElements[i].getClassName()</span><br><span class="line">                        +&quot;----&quot;+stackElements[i].getFileName()</span><br><span class="line">                        +&quot;----&quot; + stackElements[i].getLineNumber()</span><br><span class="line">                        +&quot;----&quot; +stackElements[i].getMethodName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedBridge.log(&quot;Dump Stack: &quot;+ &quot;---------------over----------------&quot;);</span><br><span class="line">        RuntimeException e &#x3D; new RuntimeException(&quot;&lt;Start dump Stack !&gt;&quot;);</span><br><span class="line">        e.fillInStackTrace();</span><br><span class="line">        Log.i(&quot;&lt;Dump Stack&gt;:&quot;, &quot;++++++++++++&quot;, e);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        &#x2F;&#x2F;XposedBridge.log(loadPackageParam.processName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.roysue.xposed1&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot; has Hooked!&quot;);</span><br><span class="line">            XposedBridge.log(&quot;inner&quot;+loadPackageParam.processName);</span><br><span class="line">            Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;com.roysue.xposed1.MainActivity&quot;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(clazz, &quot;toastMessage&quot;, String.class,new XC_MethodHook() &#123;</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                	&#x2F;&#x2F; 原始参数</span><br><span class="line">                    String oldText &#x3D; (String) param.args[0];</span><br><span class="line">                    Log.d(&quot;din not hijacked&#x3D;&gt;&quot;, oldText);</span><br><span class="line">                    &#x2F;&#x2F;param.args[0] &#x3D; &quot;test&quot;;</span><br><span class="line">                    &#x2F;&#x2F; 修改新参数</span><br><span class="line">                    param.args[0] &#x3D; &quot;你已被劫持&quot;;</span><br><span class="line">                    PrintStack();</span><br><span class="line">                    &#x2F;&#x2F;super.beforeHookedMethod(param);</span><br><span class="line">                    &#x2F;&#x2F;XposedBridge.log(&quot; has Hooked!&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    Log.d(&quot;getResult is &#x3D;&gt; &quot;,(String) param.getResult());</span><br><span class="line">                    param.setResult(&quot;你已被劫持2&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li><strong>xposed_init配置hook方法</strong><br><code>com.roysue.xposed1.HookTest</code></li></ol><p>编译启动该app，注入Xposed</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423225205264.png" alt="image-20210423225205264"></p><p>点击按钮查看log及调用栈</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423233543529.png" alt="image-20210423233543529"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.roysue.xposed1 explore</span><br><span class="line">android hooking search classes HookTest </span><br><span class="line">android hooking list class_methods com.roysue.xposed1.HookTest  找不到该类，原因是实现了接口IXposedHookLoadPackage，HookTest不在接口包中，需要在xposed_init里指定路径</span><br></pre></td></tr></table></figure><h2 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h2><h3 id="Hook-HookTest"><a href="#Hook-HookTest" class="headerlink" title="Hook HookTest"></a>Hook HookTest</h3><p>objection无法找到，通过frida进行hook拿到HookTest，frida -UF -l hookXposed.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if(loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;))&#123;</span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch(error)&#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    Java.use(&quot;com.roysue.xposed1.HookTest&quot;).PrintStack.implementation &#x3D; function (param)&#123;</span><br><span class="line">        console.log(&quot;entering PrintStack&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&quot;end2&quot;) </span><br><span class="line">&#125;</span><br><span class="line">function main()&#123;</span><br><span class="line">    hook()</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501135526330.png" alt="image-20210501135526330"></p><h3 id="Hook-XposedBridge"><a href="#Hook-XposedBridge" class="headerlink" title="Hook XposedBridge"></a>Hook XposedBridge</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; if (loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;)) &#123;</span><br><span class="line">                    if(loader.findClass(&quot;de.robv.android.xposed.XposedBridge&quot;))&#123;                        </span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        Java.use(&quot;de.robv.android.xposed.XposedBridge&quot;).log.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (str) &#123;</span><br><span class="line">            console.log(&quot;entering XposedBridge.log&quot;,str.toString());</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501140005696.png" alt="image-20210501140005696"></p><h3 id="Hook-All-Methods"><a href="#Hook-All-Methods" class="headerlink" title="Hook All Methods"></a>Hook All Methods</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function uniqBy(array, key) &#123;</span><br><span class="line">    var seen &#x3D; &#123;&#125;;</span><br><span class="line">    return array.filter(function (item) &#123;</span><br><span class="line">        var k &#x3D; key(item);</span><br><span class="line">        return seen.hasOwnProperty(k) ? false : (seen[k] &#x3D; true);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; trace a specific Java Method</span><br><span class="line">function traceMethod(targetClassMethod) &#123;</span><br><span class="line">    var delim &#x3D; targetClassMethod.lastIndexOf(&quot;.&quot;);</span><br><span class="line">    if (delim &#x3D;&#x3D;&#x3D; -1) return;</span><br><span class="line"></span><br><span class="line">    var targetClass &#x3D; targetClassMethod.slice(0, delim)</span><br><span class="line">    var targetMethod &#x3D; targetClassMethod.slice(delim + 1, targetClassMethod.length)</span><br><span class="line"></span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    var overloadCount &#x3D; hook[targetMethod].overloads.length;</span><br><span class="line"></span><br><span class="line">    console.log(&quot;Tracing &quot; + targetClassMethod + &quot; [&quot; + overloadCount + &quot; overload(s)]&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;* </span><br><span class="line">    &#x2F;&#x2F; hook all class_method</span><br><span class="line">    for (var i &#x3D; 0; i &lt; overloadCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">        hook[targetMethod].overloads[i].implementation &#x3D; function () &#123;</span><br><span class="line">            console.warn(&quot;\n*** entered &quot; + targetClassMethod);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print backtrace</span><br><span class="line">            &#x2F;&#x2F; Java.perform(function() &#123;</span><br><span class="line">            &#x2F;&#x2F;	var bt &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new());</span><br><span class="line">            &#x2F;&#x2F;	console.log(&quot;\nBacktrace:\n&quot; + bt);</span><br><span class="line">            &#x2F;&#x2F; &#125;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print args</span><br><span class="line">            if (arguments.length) console.log();</span><br><span class="line">            for (var j &#x3D; 0; j &lt; arguments.length; j++) &#123;</span><br><span class="line">                console.log(&quot;arg[&quot; + j + &quot;]: &quot; + arguments[j]);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print retval</span><br><span class="line">            var retval &#x3D; this[targetMethod].apply(this, arguments); &#x2F;&#x2F; rare crash (Frida bug?)</span><br><span class="line">            console.log(&quot;\nretval: &quot; + retval);</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            console.warn(&quot;\n*** exiting &quot; + targetClassMethod);</span><br><span class="line">            return retval;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *&#x2F;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function traceClass(targetClass) &#123;</span><br><span class="line">    &#x2F;&#x2F;Java.use是新建一个对象哈，大家还记得么？</span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    &#x2F;&#x2F;利用反射的方式，拿到当前类的所有方法</span><br><span class="line">    var methods &#x3D; hook.class.getDeclaredMethods();</span><br><span class="line">    &#x2F;&#x2F; var methods &#x3D; hook.class.getMethods();</span><br><span class="line">    &#x2F;&#x2F;建完对象之后记得将对象释放掉哈</span><br><span class="line">    hook.$dispose;</span><br><span class="line">    &#x2F;&#x2F;将方法名保存到数组中</span><br><span class="line">    var parsedMethods &#x3D; [];</span><br><span class="line">    methods.forEach(function (method) &#123;</span><br><span class="line">        parsedMethods.push(method.toString().replace(targetClass + &quot;.&quot;, &quot;TOKEN&quot;).match(&#x2F;\sTOKEN(.*)\(&#x2F;)[1]);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#x2F;&#x2F;去掉一些重复的值</span><br><span class="line">    var targets &#x3D; uniqBy(parsedMethods, JSON.stringify);</span><br><span class="line">    &#x2F;&#x2F;对数组中所有的方法进行hook，traceMethod也就是第一小节的内容</span><br><span class="line">    targets.forEach(function (targetMethod) &#123;</span><br><span class="line">        traceMethod(targetClass + &quot;.&quot; + targetMethod);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>traceClass(“de.robv.android.xposed.XposedBridge”);</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501141314991.png" alt="image-20210501141314991"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (loader.findClass(&quot;com.roysue.xposed1.HookTest$1&quot;)) &#123;   </span><br><span class="line">traceClass(&quot;com.roysue.xposed1.HookTest$1&quot;);</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501141552600.png" alt="image-20210501141552600"></p><p>说明<code>com.roysue.xposed1.HookTest$1</code>就是<code>XposedHelpers.findAndHookMethod(clazz, &quot;toastMessage&quot;, String.class,new XC_MethodHook() {</code>中的XC_MethodHook内部类</p><p><strong>hook afterHookedMethod</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; if (loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;)) &#123;</span><br><span class="line">                    if(loader.findClass(&quot;com.roysue.xposed1.HookTest$1&quot;))&#123;                        </span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        Java.use(&quot;com.roysue.xposed1.HookTest$1&quot;).afterHookedMethod.implementation &#x3D; function (param) &#123;</span><br><span class="line">            console.log(&quot;entering afterHookedMethod param is &quot;,param);</span><br><span class="line">            return this.afterHookedMethod(param);</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501142210586.png" alt="image-20210501142210586"></p><p>通过<code>traceClass(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;)</code>拿到所有的类方法，在classloader中而不是在app中</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501142632392.png" alt="image-20210501142632392"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.use(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;).setResult.implementation &#x3D; function (param) &#123;</span><br><span class="line">	console.log(&quot;entering XC_MethodHook$MethodHookParam setResult param is &quot;,param);</span><br><span class="line">	&#x2F;&#x2F; 打印调用栈</span><br><span class="line">	console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new())); </span><br><span class="line">	return this.setResult(param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501143142237.png" alt="image-20210501143142237"></p><p>XC_MethodHook是抽象类不能直接hook，需要hook实现。</p><p>traceClass(“com.roysue.xposed1.HookTest$1”)</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501143735138.png" alt="image-20210501143735138"></p><h1 id="GravityBox"><a href="#GravityBox" class="headerlink" title="GravityBox"></a>GravityBox</h1><p>git clone <a href="https://github.com/GravityBox/GravityBox.git" target="_blank" rel="noopener">https://github.com/GravityBox/GravityBox.git</a></p><p>修改app/build.gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">compileSdkVersion 23</span><br><span class="line">targetSdkVersion 23</span><br><span class="line">        debug &#123;  避免打包需要秘钥</span><br><span class="line">&#x2F;&#x2F;            versionNameSuffix &quot;-Dev&quot; </span><br><span class="line">&#x2F;&#x2F;            if (signingConfigs.releaseConfig !&#x3D; null) &#123;</span><br><span class="line">&#x2F;&#x2F;                signingConfig signingConfigs.releaseConfig</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">compile &#39;com.android.support:appcompat-v7:26.0.2&#39;         指定版本</span><br></pre></td></tr></table></figure><p>build.gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()  添加google镜像源</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &#39;com.android.tools.build:gradle:2.3.3&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">        maven &#123; url &#39;https:&#x2F;&#x2F;jitpack.io&#39; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>src/assets/xposed_init 文件中提供了入口类<code>com.wrbug.gravitybox.nougat.GravityBox</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class GravityBox implements IXposedHookZygoteInit, IXposedHookInitPackageResources, IXposedHookLoadPackage</span><br></pre></td></tr></table></figure><p>入口类中实现了三个接口<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookInitPackageResources.html" target="_blank" rel="noopener">IXposedHookInitPackageResources</a>，<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookLoadPackage.html" target="_blank" rel="noopener">IXposedHookLoadPackage</a>，<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookZygoteInit.html" target="_blank" rel="noopener">IXposedHookZygoteInit</a></p><blockquote><p><strong>IXposedHookZygoteInit</strong> 所有的进程</p><p>Hook the initialization of ** <strong>(es), from which **all the apps</strong> are forked.</p><p>Implement this interface in your module’s main class in order to be notified when <strong>Android is starting up</strong>. In <code>IXposedHookZygoteInit</code>, you can modify objects and place hooks that should be applied <strong>for every app</strong>. <strong>Only the Android framework/system classes are available</strong> at that point in time. Use <code>null</code> as class loader for <code>XposedHelpers.findAndHookMethod(String, ClassLoader, String, Object...)</code> and its variants.</p><p>If you want to hook one/multiple specific apps, use <code>IXposedHookLoadPackage</code> instead.</p><p>说明initZygote只有在系统启动的时候执行一遍，只有系统框架库可以使用。</p></blockquote><p>XposedBridge.log(“GB:Hardware: “ + Build.HARDWARE); 代码中调用了Build.HARDWARE</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U|grep gravity</span><br><span class="line">objection -g com.ceco.nougat.gravitybox explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname android.os.Build</span><br></pre></td></tr></table></figure><blockquote><p>**IXposedHookInitPackageResources ** 所有的资源</p><p>Get notified when the resources for an app are initialized. In <code>handleInitPackageResources(XC_InitPackageResources.InitPackageResourcesParam)</code>, resource replacements can be created.</p><p>This interface should be implemented by the module’s main class. Xposed will take care of registering it as a callback automatically.</p><p>说明handleInitPackageResources实现的回调在创建之后就会得到通知</p></blockquote><blockquote><p>**IXposedHookLoadPackage ** 所有的包</p><p>Get notified when an app (“Android package”) is loaded. This is especially useful to hook some app-specific methods.</p><p>This interface should be implemented by the module’s main class. Xposed will take care of registering it as a callback automatically.</p><p>xposed会将handleLoadPackage注册成为回调，app在加载时都会经过该回调，主要用来实现具体的hook逻辑。</p></blockquote><p>在handleLoadPackage中调用了ModStatusbarColor.init</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (lpparam.packageName.equals(ModStatusbarColor.PACKAGE_NAME)) &#123;</span><br><span class="line">    ModStatusbarColor.init(prefs, lpparam.classLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public static final String PACKAGE_NAME &#x3D; &quot;com.android.systemui&quot;; </span><br><span class="line">private static final String CLASS_PHONE_STATUSBAR &#x3D; &quot;com.android.systemui.statusbar.phone.PhoneStatusBar&quot;;</span><br><span class="line">   public static void init(final XSharedPreferences prefs, final ClassLoader classLoader) &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">           &#x2F;&#x2F; findClass底层通过反射获取CLASS_PHONE_STATUSBAR类</span><br><span class="line">           final Class&lt;?&gt; phoneStatusbarClass &#x3D; XposedHelpers.findClass(CLASS_PHONE_STATUSBAR, classLoader);</span><br><span class="line">           final Class&lt;?&gt; statusbarIconViewClass &#x3D; XposedHelpers.findClass(CLASS_STATUSBAR_ICON_VIEW, classLoader);</span><br><span class="line">           final Class&lt;?&gt; sbTransitionsClass &#x3D; XposedHelpers.findClass(CLASS_SB_TRANSITIONS, classLoader);</span><br><span class="line"></span><br><span class="line">           XposedHelpers.findAndHookMethod(phoneStatusbarClass, </span><br><span class="line">           		&#x2F;&#x2F; hook相同的类时XCallback.PRIORITY_LOWEST最低,优先级最高</span><br><span class="line">           		&#x2F;&#x2F; https:&#x2F;&#x2F;api.xposed.info&#x2F;reference&#x2F;de&#x2F;robv&#x2F;android&#x2F;xposed&#x2F;XC_MethodHook.html</span><br><span class="line">                   &quot;makeStatusBarView&quot;, new XC_MethodHook(XCallback.PRIORITY_LOWEST) &#123;</span><br><span class="line">               @Override</span><br><span class="line">               protected void afterHookedMethod(final MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                   mPhoneStatusBar &#x3D; param.thisObject;</span><br><span class="line">                   &#x2F;&#x2F; getObjectField获取对象的属性值</span><br><span class="line">                   &#x2F;&#x2F; https:&#x2F;&#x2F;api.xposed.info&#x2F;reference&#x2F;de&#x2F;robv&#x2F;android&#x2F;xposed&#x2F;XposedHelpers.html</span><br><span class="line">                   Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br><span class="line"></span><br><span class="line">                   if (SysUiManagers.IconManager !&#x3D; null) &#123;</span><br><span class="line">                       SysUiManagers.IconManager.registerListener(mIconManagerListener);</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   Intent i &#x3D; new Intent(ACTION_PHONE_STATUSBAR_VIEW_MADE);</span><br><span class="line">                   context.sendBroadcast(i);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125; catch (Throwable t) &#123;</span><br><span class="line">           GravityBox.log(TAG, t);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>由于<code>com.android.systemui</code>和当前hook的包在不同进程中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.android.systemui explore</span><br><span class="line">android hooking search classes com.android.systemui ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname com.android.systemui.statusbar.phone.PhoneStatusBar</span><br></pre></td></tr></table></figure><p><strong>静态域</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BRIGHTNESS_ON &#x3D; XposedHelpers.getStaticIntField(powerManagerClass, &quot;BRIGHTNESS_ON&quot;);</span><br><span class="line">plugin wallbreaker classdump --fullname android.os.PowerManager  查看静态域</span><br><span class="line">(int[])XposedHelpers.getStaticObjectField(classAudioService, &quot;MAX_STREAM_VOLUME&quot;);</span><br><span class="line">XposedHelpers.getStaticLongField(param.thisObject.getClass(),&quot;SWIPE_TIMEOUT_MS&quot;)</span><br><span class="line">(boolean) XposedHelpers.getStaticBooleanField(mDisplayPowerController.getClass(), &quot;MTK_ULTRA_DIMMING_SUPPORT&quot;);</span><br></pre></td></tr></table></figure><p><strong>动态域</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.getObjectField(param.thisObject, &quot;mNotification&quot;) &#x3D;&#x3D; null</span><br><span class="line">objection -g com.ceco.nougat.gravitybox explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">android heap search instances com.android.systemui.statusbar.phone.PhoneStatusBar  内存搜索PhoneStatusBar类实例</span><br><span class="line">plugin wallbreaker objectsearch com.android.systemui.statusbar.phone.PhoneStatusBar  内存搜索对象</span><br><span class="line">plugin wallbreaker objectiondump --fullname 0x100e6e  查看类内容中的动态域mNotification</span><br></pre></td></tr></table></figure><p><strong>主动调用</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Float) XposedHelpers.callMethod(param.thisObject, &quot;getNonBatteryClockAlphaFor&quot;, (Integer) param.args[0]);</span><br><span class="line">XposedHelpers.callStaticMethod(mClsPhoneFactory, &quot;getPhone&quot;, mSimSlot);</span><br><span class="line">plugin wallbreaker objectsearch com.android.systemui.statusbar.phone.PhoneStatusBarTransitions</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x10141e   查找getNonBatteryClockAlphaFor方法</span><br><span class="line">int phoneId &#x3D; XposedHelpers.getIntField(param.thisObject, &quot;mPhoneId&quot;);</span><br><span class="line">Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br></pre></td></tr></table></figure><p><strong>构造函数</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookConstructor(&quot;android.media.AudioManager&quot;, classLoader, Context.class,</span><br><span class="line">        new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        Object objService &#x3D; XposedHelpers.callMethod(param.thisObject, &quot;getService&quot;);</span><br><span class="line">        Context mApplicationContext &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject,</span><br><span class="line">                &quot;mApplicationContext&quot;);</span><br><span class="line">        if (objService !&#x3D; null &amp;&amp; mApplicationContext !&#x3D; null) &#123;</span><br><span class="line">            XposedHelpers.callMethod(param.thisObject, &quot;disableSafeMediaVolume&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">android hooking search classes android.media.AudioManger</span><br><span class="line">plugin wallbreaker objectsearch android.media.AudioManager</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x186e  查看getService和disableSafeMediaVolume和mApplicationContext</span><br></pre></td></tr></table></figure><h2 id="Not-In-Frida"><a href="#Not-In-Frida" class="headerlink" title="Not In Frida"></a>Not In Frida</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">setAdditionalInstanceField(param.thisObject, &quot;mVolumeUpLongPress&quot;, mVolumeUpLongPress);  给对象加静态域</span><br><span class="line">Object ls &#x3D; XposedHelpers.getSurroundingThis(mLight);  内部类对象返回给外部类</span><br><span class="line">Class[] params &#x3D; method.getParameterTypes();  获取参数列表</span><br><span class="line">UserHandle uh &#x3D; (UserHandle) uhConst.newInstance(-2);  创建新实例对象</span><br><span class="line">Constructor&lt;?&gt; uhConst &#x3D; XposedHelpers.findConstructorExact(UserHandle.class, int.class);  查找一个构造函数让其可用</span><br><span class="line">XposedBridge.hookAllConstructors(XposedHelpers.findClass(  hook所有构造函数</span><br><span class="line">        CLASS_TRUST_MANAGER_SERVICE, classLoader), new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(final MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        mTrustManager &#x3D; param.thisObject;</span><br><span class="line">        Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br><span class="line">        mWifiManager &#x3D; new WifiManagerWrapper(context, null);</span><br><span class="line">        mConnectivityManager &#x3D; (ConnectivityManager) context.getSystemService(</span><br><span class="line">                Context.CONNECTIVITY_SERVICE);</span><br><span class="line"></span><br><span class="line">        IntentFilter intentFilter &#x3D; new IntentFilter();</span><br><span class="line">        intentFilter.addAction(WifiPriorityActivity.ACTION_WIFI_TRUSTED_CHANGED);</span><br><span class="line">        intentFilter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);</span><br><span class="line">        context.registerReceiver(mBroadcastReceiver, intentFilter);</span><br><span class="line"></span><br><span class="line">        if (DEBUG) log(&quot;Trust manager constructed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">XposedBridge.hookMethod(mtdHandlePlay, new XC_MethodHook() &#123;   hook所有方法并创建回调</span><br><span class="line">    @Override</span><br><span class="line">    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        qhPrefs.reload();</span><br><span class="line">        QuietHours qh &#x3D; new QuietHours(qhPrefs);</span><br><span class="line">        if (qh.isSystemSoundMuted(QuietHours.SystemSound.RINGER)) &#123;</span><br><span class="line">            param.setResult(null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        if (!mRingerConfig.enabled) return;</span><br><span class="line"></span><br><span class="line">        mRingtone &#x3D; (Ringtone) XposedHelpers.getObjectField(mAsyncRinger, &quot;mRingtone&quot;);</span><br><span class="line">        if (mRingtone &#x3D;&#x3D; null) &#123;</span><br><span class="line">            if (DEBUG) log(&quot;handlePlay called but ringtone is null&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setVolume(mRingerConfig.minVolume);</span><br><span class="line">        mIncrementAmount &#x3D; (1f - mRingerConfig.minVolume) &#x2F; (float) mRingerConfig.rampUpDuration;</span><br><span class="line">        mCurrentIncrementVolume &#x3D; mRingerConfig.minVolume;</span><br><span class="line">        mHandler &#x3D; (Handler) XposedHelpers.getObjectField(mAsyncRinger, &quot;mHandler&quot;);</span><br><span class="line">        mHandler.postDelayed(mRunnable, 1000);</span><br><span class="line">        if (DEBUG) log(&quot;Starting increasing ring&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>set(get)AdditionalInstanceField</li><li>getMD5Sum</li><li>getMethodDepth</li><li>getParameterTypes</li><li>getSurroundingThis</li><li>hookMethod</li><li>系统级别的，过滤所有的进程</li><li>只要Xposed生效了，可以把Xposed理解为系统框架，作为系统的本身来考虑没有关系。</li></ul><h2 id="Not-In-Xposed"><a href="#Not-In-Xposed" class="headerlink" title="Not In Xposed"></a>Not In Xposed</h2><ul><li>Java.choose</li><li>rpc</li><li>热重载/加载</li><li>单进程级别的，只能在hook的进程内生效</li></ul><h2 id="hook-1"><a href="#hook-1" class="headerlink" title="hook"></a>hook</h2><p>本项目中 xposed 系统级别的，过滤所有的进程，入口类中实现了三个接口，hook了所有的资源，进程，包。只会hook进程中的包等于ModStatusbarColor.PACKAGE_NAME即<code>com.android.systemui</code>时，才启动hook。所有逻辑不在GravityBox中，也不在xposed.jar中，而是在com.android.systemui</p><pre><code>if (lpparam.packageName.equals(ModStatusbarColor.PACKAGE_NAME)) {
    ModStatusbarColor.init(prefs, lpparam.classLoader);
}
</code></pre><p>frida-ps -U |grep com.android.systemui</p><p>在app逆向中遇到interface搜索其实现还是一顿乱搜，可以使用反射getInterfaces得到实现的接口数组，然后打印出来即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if (loader.findClass(&quot;com.ceco.nougat.gravitybox.ModStatusbarColor$1&quot;)) &#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;de.robv.android.xposed.XC_MethodHook&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;de.robv.android.xposed.XposedBridge&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F;if(loader.findClass(&quot;com.android.internal.statusbar.StatusBarIcon&quot;))&#123;</span><br><span class="line"></span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;de.robv.android.xposed.XposedBridge&quot;).log.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (str) &#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entering Xposedbridge.log &quot;,str.toString())</span><br><span class="line">        &#x2F;&#x2F;     return true</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">        &#x2F;&#x2F;traceClass(&quot;com.ceco.nougat.gravitybox.ModStatusbarColor&quot;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;com.roysue.xposed1.HookTest$1&quot;).afterHookedMethod.implementation &#x3D; function (param)&#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entering afterHookedMethod param is &#x3D;&gt; &quot;,param);</span><br><span class="line">        &#x2F;&#x2F;     return this.afterHookedMethod(param);</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">        &#x2F;&#x2F; traceClass(&quot;de.robv.android.xposed.XC_MethodHook&quot;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;).setResult.implementation &#x3D; function(str)&#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entersing de.robv.android.xposed.XC_MethodHook$MethodHookParam setResult &#x3D;&gt; &quot;,str)</span><br><span class="line">        &#x2F;&#x2F;     console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">        &#x2F;&#x2F;     return this.setResult(str);</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line"></span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch: function (className) &#123;</span><br><span class="line">                if (className.toString().indexOf(&quot;gravitybox&quot;) &gt; 0 &amp;&amp;</span><br><span class="line">                    className.toString().indexOf(&quot;$&quot;) &gt; 0</span><br><span class="line">                ) &#123;</span><br><span class="line">                    console.log(&quot;found &#x3D;&gt; &quot;, className)</span><br><span class="line">                    &#x2F;&#x2F; var interFaces &#x3D; Java.use(className).class.getInterfaces();</span><br><span class="line">                    &#x2F;&#x2F; if(interFaces.length&gt;0)&#123;</span><br><span class="line">                    &#x2F;&#x2F;     console.log(&quot;interface is &#x3D;&gt; &quot;);</span><br><span class="line">                    &#x2F;&#x2F;     for(var i in interFaces)&#123;</span><br><span class="line">                    &#x2F;&#x2F;         console.log(&quot;\t&quot;,interFaces[i].toString())</span><br><span class="line">                    &#x2F;&#x2F;     &#125;</span><br><span class="line">                    &#x2F;&#x2F; &#125;</span><br><span class="line">                    if (Java.use(className).class.getSuperclass()) &#123;</span><br><span class="line">                        var superClass &#x3D; Java.use(className).class.getSuperclass().getName();</span><br><span class="line">                        &#x2F;&#x2F; console.log(&quot;superClass is &#x3D;&gt; &quot;,superClass);</span><br><span class="line">                        if (superClass.indexOf(&quot;XC_MethodHook&quot;) &gt; 0) &#123;</span><br><span class="line">                            console.log(&quot;found class is &#x3D;&gt; &quot;, className.toString())</span><br><span class="line">                            traceClass(className);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;search completed!&quot;)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"25827-1638538754631-918",name:"万物皆可逆向",qrcode:"https://onejane.github.io/gzh.jpg",keyword:"密码"})}</script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2021/04/23/Xposed搭建开发/">http://onejane.github.io/2021/04/23/Xposed搭建开发/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">万物皆可逆向</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/xposed/">xposed</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/"><i class="fa fa-chevron-left"></i> <span>JS逆向之淘宝h5视频sign破解</span></a></div><div class="next-post pull-right"><a href="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/"><span>违法应用移动TV取证分析</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>