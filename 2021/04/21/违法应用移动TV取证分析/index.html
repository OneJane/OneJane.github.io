<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="违法应用移动TV取证分析"><meta name="keywords" content="fart,postern,charles,youpk,dexdump"><meta name="author" content="J"><meta name="copyright" content="J"><title>违法应用移动TV取证分析 | J</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.1.1"}</script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#抓包"><span class="toc-number">1.</span> <span class="toc-text">抓包</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#应用层抓包"><span class="toc-number">1.1.</span> <span class="toc-text">应用层抓包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#传输层抓包"><span class="toc-number">1.2.</span> <span class="toc-text">传输层抓包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置charles"><span class="toc-number">1.2.1.</span> <span class="toc-text">配置charles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#postern"><span class="toc-number">1.2.2.</span> <span class="toc-text">postern</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#movetv分析"><span class="toc-number">1.3.</span> <span class="toc-text">movetv分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#脱壳"><span class="toc-number">2.</span> <span class="toc-text">脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FRIDA-DEXDump"><span class="toc-number">2.1.</span> <span class="toc-text">FRIDA-DEXDump</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#登录"><span class="toc-number">2.1.1.</span> <span class="toc-text">登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册"><span class="toc-number">2.1.2.</span> <span class="toc-text">注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#取证实现"><span class="toc-number">2.1.3.</span> <span class="toc-text">取证实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Youpk"><span class="toc-number">2.2.</span> <span class="toc-text">Youpk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景"><span class="toc-number">2.2.1.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题"><span class="toc-number">2.2.2.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fart"><span class="toc-number">2.3.</span> <span class="toc-text">fart</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装新环境"><span class="toc-number">2.3.1.</span> <span class="toc-text">安装新环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用fart"><span class="toc-number">2.3.2.</span> <span class="toc-text">调用fart</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">54</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">53</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">7</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">J</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">违法应用移动TV取证分析</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">2k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><h2 id="应用层抓包"><a href="#应用层抓包" class="headerlink" title="应用层抓包"></a><strong>应用层抓包</strong></h2><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/t01c2d220dfd81d4d18.png" alt="img"></p><h2 id="传输层抓包"><a href="#传输层抓包" class="headerlink" title="传输层抓包"></a><strong>传输层抓包</strong></h2><p>charles开启Enable socks proxy</p><p>wget <a href="https://www.charlesproxy.com/assets/release/4.6.1/charles-proxy-4.6.1_amd64.tar.gz?k=17bcbd3dc2" target="_blank" rel="noopener">https://www.charlesproxy.com/assets/release/4.6.1/charles-proxy-4.6.1_amd64.tar.gz?k=17bcbd3dc2</a></p><p>tar zxf charles-proxy-4.6.1_amd64.tar.gz &amp;&amp; ./charles 通过<a href="https://www.charles.ren/" target="_blank" rel="noopener">注册码</a>注册或生成加权<a href="https://www.zzzmode.com/mytools/charles/" target="_blank" rel="noopener">jar包</a>破解</p><p>vim ~/.zshrc 并source ~/.zshrc 使得charles在任意路径可启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&quot;&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;ndk-bundle:&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;platform-tools:$&#123;JAVA_HOME&#125;&#x2F;bin:$PATH:&#x2F;root&#x2F;Desktop&#x2F;charles&#x2F;bin:&#x2F;root&#x2F;Desktop&#x2F;jadx-1.2.0&#x2F;bin&quot;</span><br></pre></td></tr></table></figure><p>htop 查看破解情况</p><p>电脑：192.168.0.106</p><p>手机：192.168.0.102</p><p>虚拟机：192.168.0.107</p><p>虚拟网络编辑器选择获取ip的网卡，保证这三台机器在同一局域网内且互相ping通。</p><h3 id="配置charles"><a href="#配置charles" class="headerlink" title="配置charles"></a>配置charles</h3><p>socks proxy工作于传输层，更好的观察应用层协议和socks抓包。</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211129237.png" alt="image-20210422211129237"></p><p>开启ssl</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211216544.png" alt="image-20210422211216544"></p><h3 id="postern"><a href="#postern" class="headerlink" title="postern"></a>postern</h3><p>adb install 0714com.tunnelworkshop.postern_2018-10-07.apk</p><p>QtScrcpy 设置投屏</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211526433.png" alt="image-20210422211526433"></p><p>配置socks5抓包代理</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211731524.png" alt="image-20210422211731524"></p><p>配置socks5抓包配置规则</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211826284.png" alt="image-20210422211826284"></p><p>打开socks vpn连接虚拟机抓包，虚拟机收到连接请求后点击Allow</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422212010520.png" alt="image-20210422212010520"></p><p>在手机浏览器输入地址 chls.pro/ssl 或者 charlesproxy.com/getssl ，出现证书安装页面，点击安装，如果依旧app抓不到，需要把个人证书放到系统根目录</p><blockquote><p>Android8</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added&#x2F;</span><br><span class="line">mount -o remount,rw &#x2F;</span><br><span class="line">chmod 777 *</span><br><span class="line">cp * &#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mount -o remount,ro &#x2F;</span><br></pre></td></tr></table></figure><p>Android 7</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added&#x2F;</span><br><span class="line">mount -o rw,remount &#x2F;system</span><br><span class="line">chmod 777 *</span><br><span class="line">cp * &#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mount -o ro,remount &#x2F;system</span><br></pre></td></tr></table></figure></blockquote><h2 id="movetv分析"><a href="#movetv分析" class="headerlink" title="movetv分析"></a>movetv分析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;fs1428arm64 </span><br><span class="line">pyenv local 3.8.5</span><br><span class="line">frida -UF -l hookSocket.js -o moveTV.txt  attach方式hook登录抓包，基于socks层抓包无法对抗，除非做了VPN检测</span><br><span class="line">frida -U -f com.cz.babySister -l hookSocket.js -o moveTV.txt   spawn方式hook，输入%resume重新启动，或者直接在命令后加--no-pause</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422213451714.png" alt="image-20210422213451714"></p><p>jadx-gui movetv.apk 已经加壳一个Activity都找不到</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422214547118.png" alt="image-20210422214547118"></p><h1 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h1><h2 id="FRIDA-DEXDump"><a href="#FRIDA-DEXDump" class="headerlink" title="FRIDA-DEXDump"></a>FRIDA-DEXDump</h2><p>git clone <a href="https://github.com/hluwa/FRIDA-DEXDump.git" target="_blank" rel="noopener">https://github.com/hluwa/FRIDA-DEXDump.git</a> 启动app放在前台</p><p>cd ~/Desktop/FRIDA-DEXDump/frida_dexdump &amp;&amp; python main.py 开始脱壳</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422220211650.png" alt="image-20210422220211650"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities  查看所有Activity</span><br><span class="line">grep -ril &quot;MainActivity&quot; *  从脱下的dex中查找MainActivity</span><br><span class="line">grep -ril &quot;LoginActivity&quot; *</span><br><span class="line">jadx-gui com.cz.babySister&#x2F;0x748d44201c.dex</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422220645424.png" alt="image-20210422220645424"></p><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>抓登录包获取memi1字段其实来源于android-id</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423013934848.png" alt="image-20210423013934848"></p><p>android hooking watch class com.cz.babySister.activity.LoginActivity –dump-args –dump-backtrace –dump-return hook类中所有方法</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014732415.png" alt="image-20210423014732415"></p><p>android hooking watch class_method com.cz.babySister.activity.LoginActivity.b –dump-args –dump-backtrace –dump-return hook登录b方法</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014946081.png" alt="image-20210423014946081"></p><p>进入b方法中调用的RunnableC0042q类中</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015105146.png" alt="image-20210423015105146"></p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015154139.png" alt="image-20210423015154139"></p><p>android hooking watch class_method com.cz.babySister.c.a.a –dump-args –dump-backtrace –dump-return hook方法a</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015411937.png" alt="image-20210423015411937"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore</span><br><span class="line">android hooking search classes Settings </span><br><span class="line">android hooking list class_methods android.provider.Settings </span><br><span class="line">android hooking list class_methods android.provider.Settings$Secure</span><br><span class="line">android hooking watch class_method android.provider.Settings$Secure.getString --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423013626273.png" alt="image-20210423013626273"></p><p>通过hook获取返回的结果50463fa80244d95f和chales中抓包的memi1完全一致</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014359588.png" alt="image-20210423014359588"></p><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>android hooking watch class_method com.cz.babySister.c.a.a –dump-args –dump-backtrace –dump-return</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015832197.png" alt="image-20210423015832197"></p><p>对比抓包结果</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015906716.png" alt="image-20210423015906716"></p><h3 id="取证实现"><a href="#取证实现" class="headerlink" title="取证实现"></a>取证实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">class tv:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.root &#x3D; &#39;http:&#x2F;&#x2F;39.108.64.125&#x2F;WebRoot&#x2F;superMaster&#x2F;Server&#39;</span><br><span class="line">        self.memi1 &#x3D; &quot;50463fa80244d95f&quot;</span><br><span class="line">        self.rightkey &#x3D; &quot;376035775&quot;</span><br><span class="line">        self.key &#x3D; &quot;308202d5308201bda00302010202041669d9bf300d06092a864886f70d01010b0500301b310b3009060355040613023836310c300a06035504031303776569301e170d3136303731383038313935395a170d3431303731323038313935395a301b310b3009060355040613023836310c300a0603550403130377656930820122300d06092a864886f70d01010105000382010f003082010a028201010095f85892400aae03ca4ed9dcd838d162290ae8dd51939aac6ecfde8282f207c4cd9e507929a279e0a36f1e4847330cb53908c92915b2c6a93d7064be452d073a472093f7ca14f4ab68f827582fe0988e9e4bc8a6ea3b56001cbbbb760f9eec571b0bbc97392e65aaf08c686f0e2ba353896d48a37c36716239977bd0e4dd878025cab497d8164537aec9f6599eefb98577dce972a1b794e211226520e23497beec3fd8548bb5b4d263120d40115cca28116bac32378df5033f536a0d7367fef78c587fefed28c5c9b35ba684ed6e46d9369c40950cf7ad7236d10b7a51dfd2a8f218db72323bbd19f46947410b1191f263012ad4ba8f749223e37591254ee7f50203010001a321301f301d0603551d0e041604143d43284bd5e4b0d322c9962a5b70aad4dcbc3634300d06092a864886f70d01010b050003820101000f04c51ff763311aa011777ba2842b441b15c316373d1e1ed4116cf86e29d55c6ed3fa4c475251b1fb4fac57195dbca0166ebe565d9834552a3758b97c4528bab1f7ab82bb3a9faa932f5bc10943f3daf52e0fe5889ffb58a6be67ea1c9a2fb37dc8aa6f3af476039a467336991a4e52dccd520195cd473eb5b984e702ed9ff638a14c3abb575a7a80ae4062084d1138a06a20e173be9df32df631311b07352898706198ddebaaa011f0da8e5f288f7cfb77505bc943f6476d6cc1feef56b68137aad91f23c4bb772169539d05653a6f0d75f7192164e822b934322f3a975df677903b1667f5dc1e9ddb185da3281d31bfb8f67a84bd23bbcb398f8bb637dd72&quot;</span><br><span class="line"></span><br><span class="line">    def post(self, data&#x3D;None):</span><br><span class="line">        if data is None:</span><br><span class="line">            data &#x3D; &#123;&#125;</span><br><span class="line">        return requests.post(url&#x3D;self.root, data&#x3D;data)</span><br><span class="line"></span><br><span class="line">    def query(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password&#125;)</span><br><span class="line">        print(&quot;query result is : &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def register(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password, &#39;memi1&#39;: self.memi1,</span><br><span class="line">                        &#39;key&#39;: self.key, &#39;rightkey&#39;: self.rightkey, &#39;register&#39;: &#39;register&#39;&#125;)</span><br><span class="line">        print(&quot;Register response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def login(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password, &#39;memi1&#39;: self.memi1,</span><br><span class="line">                        &#39;key&#39;: self.key, &#39;rightkey&#39;: self.rightkey, &#39;login&#39;: &#39;login&#39;&#125;)</span><br><span class="line">        print(&quot;Login response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def updateSocre(self, name, password, jifen):</span><br><span class="line">        t &#x3D; int(round(time.time() * 1000))</span><br><span class="line">        sign &#x3D; base64.b64encode(str(5 * t).encode(&#39;utf-8&#39;)).decode(&#39;utf-8&#39;)</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password,</span><br><span class="line">                        &#39;jifen&#39;: jifen, &#39;time&#39;: t, &#39;sign&#39;: sign&#125;)</span><br><span class="line">        print(&quot;UpdataScore response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    tv &#x3D; tv()</span><br><span class="line"></span><br><span class="line">    # print(tv.query(&quot;eeeeffff&quot;, &quot;gggghhhh&quot;))</span><br><span class="line"></span><br><span class="line">    # 注册账号</span><br><span class="line"></span><br><span class="line">    print(tv.register(&quot;onejane3&quot;, &quot;123456&quot;))</span><br><span class="line"></span><br><span class="line">    # time.sleep(3)</span><br><span class="line"></span><br><span class="line">    # 登录账号</span><br><span class="line">    print(tv.login(&quot;onejane3&quot;, &quot;123456&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 更新积分</span><br><span class="line">    # print(tv.updateSocre(&quot;mee4&quot;,&quot;mee4&quot;,&quot;1000&quot;))</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423020347585.png" alt="image-20210423020347585"></p><h2 id="Youpk"><a href="#Youpk" class="headerlink" title="Youpk"></a>Youpk</h2><p><a href="https://bbs.pediy.com/thread-259854.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-259854.htm</a></p><p>linux平台下载最新的platform-tools刷机的时候，fastboot会报各种unknow command或接近的错误，把fastboot文件替换成以下随着aosp一起编译出来的即可：</p><blockquote><p>fastboot_aosp7.1.zip</p><p>fastboot6.0.zip</p><p>fastboot8.1.0r1.zip</p></blockquote><p>下载Youpk_v1.1</p><ol><li>重启至bootloader: <code>adb reboot bootloader</code></li><li>解压 Youpk_sailfish.zip 并双击 <code>flash-all.bat</code>,（尽量在kali上刷机，<code>./flash-all.sh</code>,因为windows会给我们的编程生涯带来80%的苦难）</li></ol><blockquote><p>adb install movetv.apk</p><p>adb shell “echo com.cz.babySister &gt;&gt; /data/local/tmp/unpacker.config”</p></blockquote><ol start="3"><li>启动apk等待脱壳，每隔10秒将自动重新脱壳(已完全dump的dex将被忽略), 当日志打印unpack end时脱壳完成</li></ol><blockquote><p>adb pull /data/data/com.cz.babySister/unpacker/</p><p>mv unpacker youpk/</p></blockquote><ol start="4"><li>调用修复工具 dexfixer.jar, 两个参数, 第一个为dump文件目录(必须为有效路径), 第二个为重组后的DEX目录(不存在将会创建)<blockquote><pre><code>java -jar dexfixer.jar youpk/ youpk_out/

jadx-gui _data_app_com.cz.babySister-1_base.apk_54276.dex  查看脱壳后的dex 
</code></pre></blockquote></li></ol><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422224021639.png" alt="image-20210422224021639"></p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>整体加固</li><li>抽取:<ul><li>nop占坑型(类似某加密)</li><li>naitve化, 在<clinit>中解密(类似早期阿里)</clinit></li><li>goto解密型(类似新版某加密?najia): <a href="https://bbs.pediy.com/thread-259448.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-259448.htm</a></li></ul></li></ol><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol><li>dump中途退出或卡死，重新启动进程，再次等待脱壳即可</li><li>当前仅支持被壳保护的dex, 不支持App动态加载的dex/jar</li></ol><h2 id="fart"><a href="#fart" class="headerlink" title="fart"></a>fart</h2><p>脱抽取型壳并回填dex</p><h3 id="安装新环境"><a href="#安装新环境" class="headerlink" title="安装新环境"></a>安装新环境</h3><p>vim /etc/proxychains4.conf 配置代理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socks5  192.168.0.106 1080</span><br><span class="line">#http 127.0.0.1 12333</span><br></pre></td></tr></table></figure><p>主机192.168.0.106 ssr开启运行局域网连接</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423001429267.png" alt="image-20210423001429267"></p><p>配置新环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains pyenv install 3.9.0  创建python3.9.0环境</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains pip install objection&#x3D;&#x3D;1.9.5  安装objection 1.9.5套件包括frida-tools 9.2.4，frida 14.2.16</span><br></pre></td></tr></table></figure><p>wget <a href="https://github.com/frida/frida/releases/download/14.2.16/frida-server-14.2.16-android-arm64.xz" target="_blank" rel="noopener">frida-server-14.2.16-android-arm64.xz</a></p><p>7z x <a href="https://github.com/frida/frida/releases/download/14.2.16/frida-server-14.2.16-android-arm64.xz" target="_blank" rel="noopener">frida-server-14.2.16-android-arm64.xz</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push ~&#x2F;Desktop&#x2F;frida-server-14.2.16-android-arm64 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;</span><br><span class="line">adb shell</span><br><span class="line">mv &#x2F;data&#x2F;local&#x2F;tmp&#x2F;frida-server-14.2.16-android-arm64 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64  </span><br><span class="line">chmod 777 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64</span><br><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64</span><br></pre></td></tr></table></figure><p>事实证明，新版本不兼容还是用12.8.0的frida吧</p><h3 id="调用fart"><a href="#调用fart" class="headerlink" title="调用fart"></a>调用fart</h3><p>基于hook和反射脱壳，对比发现youpk最优秀。</p><blockquote><p>adb reboot bootloader</p><p>cd ~/Desktop/sailfish-nzh54d 安卓8.0</p><p>./flash-all.sh 刷回去</p><p><a href="https://onejane.github.io/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#Pixel">root及基础配置</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">adb push Magisk-v20.4.zip &#x2F;sdcard    </span><br><span class="line">adb push magisk-riru-v21.3.zip &#x2F;sdcard&#x2F;Download 使用magisk模块安装并重启</span><br><span class="line">adb push magisk-EdXposed-SandHook-v0.4.5.1_beta.4463.-release.zip &#x2F;sdcard&#x2F;Download  使用magisk模块安装并重启</span><br><span class="line">adb install EdXposedManager-4.5.7-45700-org.meowcat.edxposed.manager-release.apk    安装xposed</span><br><span class="line">adb push MagiskHidePropsConf-v5.3.4.zip &#x2F;sdcard&#x2F;Download   </span><br><span class="line">adb install JustTrustMePlus-debug.apk  用于结合xposed突破SSL Pinning抓包限制</span><br><span class="line">adb reboot bootloader</span><br><span class="line">fastboot boot twrp-3.4.0-0-sailfish.img   进入recovery mode</span><br><span class="line">install Magisk-v20.4.zip</span><br><span class="line">adb install MagiskManager-v7.5.1.apk  模块安装MagiskHidePropsConf，riru，EdXposed，</span><br><span class="line">adb shell su通过Magisk获取root权限</span><br><span class="line">settings put global captive_portal_http_url https:&#x2F;&#x2F;www.google.cn&#x2F;generate_204  去除wifi上的×</span><br><span class="line">settings put global captive_portal_https_url https:&#x2F;&#x2F;www.google.cn&#x2F;generate_204</span><br><span class="line">settings put global ntp_server 1.hk.pool.ntp.org  修改时区</span><br><span class="line">props  Edit MagiskHide props--ro.debuggable  设置全局可调试，getprop ro.debuggable 即可查看1,开启全局可调试</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pyenv local 3.8.0</span><br><span class="line">proxychains4 wget https:&#x2F;&#x2F;github.com&#x2F;hanbinglengyue&#x2F;FART.git</span><br><span class="line">7z x frida_fart.zip  &amp;&amp; adb push lib&#x2F;fart* &#x2F;data&#x2F;app &amp;&amp; chmod 777 *.so   如果没有权限，放到&#x2F;sdcard中再放入&#x2F;data&#x2F;app</span><br><span class="line">cd Desktop&#x2F;FART-master&#x2F;frida_fart&#x2F; &amp;&amp; frida -UF -l frida_fart_reflection.js   attach模式启动</span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_reflection.js --no-pause  spawn模式启动</span><br><span class="line">fart() 全量主动调用</span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_hook.js --no-pause  基于安卓8，生成dex，hook连壳一起脱</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422234838689.png" alt="image-20210422234838689"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb pull &#x2F;sdcard&#x2F;com.cz.babySister.activity</span><br><span class="line">grep -ril &quot;LoginActivity&quot; *.dex</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2021/04/21/违法应用移动TV取证分析/">http://onejane.github.io/2021/04/21/违法应用移动TV取证分析/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">J</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/fart/">fart</a><a class="post-meta__tags" href="/tags/postern/">postern</a><a class="post-meta__tags" href="/tags/charles/">charles</a><a class="post-meta__tags" href="/tags/youpk/">youpk</a><a class="post-meta__tags" href="/tags/dexdump/">dexdump</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/"><i class="fa fa-chevron-left"></i> <span>Xposed搭建开发</span></a></div><div class="next-post pull-right"><a href="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/"><span>爬虫基础篇之selenium登陆获取阿里腾讯cookie</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>