<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>frida沙箱自吐实现</title>
      <link href="2021/05/06/frida%E6%B2%99%E7%AE%B1%E8%87%AA%E5%90%90%E5%AE%9E%E7%8E%B0/"/>
      <url>2021/05/06/frida%E6%B2%99%E7%AE%B1%E8%87%AA%E5%90%90%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="沙箱"><a href="#沙箱" class="headerlink" title="沙箱"></a>沙箱</h1><p>沙箱：对于系统来说，单个APP是没有隐私的，不管是脱壳、还是收发包，都是由系统的API来执行的。HOOK系统的API，就能得到很多APP的关键信息。</p><p>APP想要对抗沙箱：</p><ol><li>尽可能减少系统API的调用；</li><li>尽可能自己实现一定量的算法；</li><li>对自己实现的算法进行强混淆；</li><li>增加自身算法的复杂度吧：VMP</li></ol><p>各大安全公司、杀毒软件公司基本上都会有自己的沙箱，只要病毒/木马在自己的沙箱跑一遍，直接得到执行流、病毒相似性分析，如绑绑安全的<a href="https://www.bangcle.com/products/productindex?product_id=3" target="_blank" rel="noopener">安全密钥白盒</a>，对于APP也是一样的。</p><h2 id="基于hook的沙箱"><a href="#基于hook的沙箱" class="headerlink" title="基于hook的沙箱"></a>基于hook的沙箱</h2><p>Youpk Fart 都是沙箱 </p><h3 id="appmon"><a href="#appmon" class="headerlink" title="appmon"></a>appmon</h3><p><a href="https://github.com/dpnishant/appmon/wiki/4.a-Setup-Host" target="_blank" rel="noopener">appmon wiki</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;fs128arm64 </span><br><span class="line">vim &#x2F;etc&#x2F;proxychains4.conf </span><br><span class="line">socks5  192.168.0.107 1080   # 电脑主机 ssr选项设置-开启来自局域网的连接</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains4 pyenv install 3.8.2</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains4 pip install frida&#x3D;&#x3D;12.8.0</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains4 pip install frida-tools&#x3D;&#x3D;5.3.0</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains4 pip install objection&#x3D;&#x3D;1.8.4</span><br><span class="line">proxychains wget https:&#x2F;&#x2F;github.com&#x2F;dpnishant&#x2F;appmon&#x2F;archive&#x2F;refs&#x2F;heads&#x2F;master.zip</span><br><span class="line">7z x master.zip </span><br><span class="line">cd appmon-master </span><br><span class="line">pip install argparse flask termcolor dataset --upgrade --ignore-installed six</span><br><span class="line">python appmon.py -a &quot;com.xiaojianbang.app&quot; -p android -s scripts&#x2F;Android</span><br></pre></td></tr></table></figure><p>点击HookTestDemo.apk的算法加密按钮，触发生成./app_dumps/com.xiaojianbang.app.db</p><p>访问<a href="http://127.0.0.1:5000/" target="_blank" rel="noopener">http://127.0.0.1:5000/</a>  选择com.xiaojianbang.app</p><p><img src="/2021/05/06/frida%E6%B2%99%E7%AE%B1%E8%87%AA%E5%90%90%E5%AE%9E%E7%8E%B0/image-20210506003248713.png" alt="image-20210506003248713"></p><p>由于显示内容都是[Object Object],修改源码打印hook内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data.value &#x3D; byteArraytoHexString(digest);  删除</span><br><span class="line">var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);  替换</span><br><span class="line">data.value &#x3D; ByteString.of(digest).hex()</span><br><span class="line"></span><br><span class="line">frida -UF -l Hash.js</span><br></pre></td></tr></table></figure><p><img src="/2021/05/06/frida%E6%B2%99%E7%AE%B1%E8%87%AA%E5%90%90%E5%AE%9E%E7%8E%B0/image-20210506003840372.png" alt="image-20210506003840372"></p><h2 id="基于源码的沙箱"><a href="#基于源码的沙箱" class="headerlink" title="基于源码的沙箱"></a>基于源码的沙箱</h2><p><a href="https://pan.baidu.com/s/1uPZbnKXa2_RJEUJRFxckLA" target="_blank" rel="noopener">aosp810r1</a>   解压<br><a href="https://dl.google.com/dl/android/aosp/google_devices-sailfish-opm1.171019.011-f3bafc8b.tgz" target="_blank" rel="noopener">驱动Vendor image</a>  <a href="https://dl.google.com/dl/android/aosp/qcom-sailfish-opm1.171019.011-247af472.tgz" target="_blank" rel="noopener">驱动GPS, Audio, Camera, Gestures, Graphics, DRM, Video, Sensors</a>  解压驱动<br>解压到aosp810r1中后<code>./extrace-google_devices-sailfish.sh</code>  和<code>./extrace-qcom-sailfish.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># apt update</span><br><span class="line"># git config --global user.email &quot;you@example.com&quot;</span><br><span class="line"># git config --global user.name &quot;Your Name&quot;</span><br><span class="line"># apt install bison tree</span><br><span class="line"># dpkg --add-architecture i386</span><br><span class="line"># apt update</span><br><span class="line"># apt install libc6:i386 libncurses5:i386 libstdc++6:i386</span><br><span class="line"># apt install libxml2-utils</span><br><span class="line"></span><br><span class="line">dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;swapfile bs&#x3D;1024 count&#x3D;10240000  使用dd创建swapfile作为swap分区空间</span><br><span class="line">mkswap swapfile  mkswap创建交换文件</span><br><span class="line"></span><br><span class="line">Kali下手动安装openjdk-8-jdk：</span><br><span class="line"># wget http:&#x2F;&#x2F;http.kali.org&#x2F;pool&#x2F;main&#x2F;o&#x2F;openjdk-8&#x2F;openjdk-8-jdk-headless_8u212-b01-1_amd64.deb</span><br><span class="line"># dpkg -i openjdk-8-jdk-headless_8u212-b01-1_amd64.deb</span><br><span class="line"># wget http:&#x2F;&#x2F;http.kali.org&#x2F;pool&#x2F;main&#x2F;o&#x2F;openjdk-8&#x2F;openjdk-8-jdk_8u212-b01-1_amd64.deb</span><br><span class="line"># dpkg -i openjdk-8-jdk_8u212-b01-1_amd64.deb</span><br><span class="line">安装完成后再用：</span><br><span class="line"># update-alternatives --config java</span><br><span class="line"># update-alternatives --config javac</span><br><span class="line">选择2来切换jdk的版本：见图</span><br><span class="line">最后用version选项来确认版本：</span><br><span class="line"># java -version</span><br><span class="line"># javac -version</span><br><span class="line">source build&#x2F;envsetup.sh</span><br><span class="line">lunch   选择24 aosp_sailfish-userdebug</span><br><span class="line">make   编译完成的系统镜像位于当前目录的out&#x2F;target&#x2F;product&#x2F;sailfish&#x2F;下包括各个img</span><br></pre></td></tr></table></figure><p><a href="https://dl.google.com/dl/android/aosp/sailfish-opm1.171019.011-factory-56d15350.zip" target="_blank" rel="noopener">官方镜像</a>  下载下来后解压将上面编译好的所有img替换到官方镜像解压后的image-sailfish-opm1.171019.011文件夹，并还原创建zip包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line">.&#x2F;flash-all.sh</span><br></pre></td></tr></table></figure><p><a href="http://wuxiaolong.me/2018/08/15/AOSP3/" target="_blank" rel="noopener">Android Studio 导入 AOSP 源码</a>  <code>development/tools/idegen/idegen.sh</code></p><p>会在根目录下生成<br>android.iml 和 android.ipr 这两个文件，这两个文件是 Android Studio 的工程配置文件，这时候其实已经可以直接导入 Android Studio，但会导入所有的源码模块，会很慢，可以进行过滤，除了 frameworks 模块和 packages 模块，其他都给过滤掉，不导入 Android Studio，打开 android.iml 文件，搜下<code>excludeFolder</code>，在后面加入如下代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;art&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;bionic&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;bootable&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;build&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;cts&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;dalvik&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;developers&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;development&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;device&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;docs&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;external&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;hardware&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;kernel&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;libcore&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;libnativehelper&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;out&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;pdk&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;platform_testing&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;prebuilts&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;sdk&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;system&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;test&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;toolchain&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;tools&quot; &#x2F;&gt;</span><br><span class="line">&lt;excludeFolder url&#x3D;&quot;file:&#x2F;&#x2F;$MODULE_DIR$&#x2F;.repo&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><p>发现 Android Studio 不停 scanning files to index，我的强迫症又犯了，解决：</p><ol><li>invalidate and restart 不起作用；</li><li>右击项目 –&gt; Open module setting –&gt; Modules –&gt; 找到 gen 文件夹 –&gt; 右键选择 Resources，终于告别烦人的 scanning files to index。</li></ol><p>修改MessageDigest.java</p><h3 id="crypto-filter-aosp"><a href="#crypto-filter-aosp" class="headerlink" title="crypto_filter_aosp"></a><a href="https://github.com/icew4y/crypto_filter_aosp" target="_blank" rel="noopener">crypto_filter_aosp</a></h3><p>基于android6.0.1 Nexus 6P <a href="https://pan.baidu.com/s/1Fe_m_OsWiVZJ03eWlR-0mg" target="_blank" rel="noopener">ROM</a></p><ol><li>手机先刷入twrp</li><li>下载rom解压，adb push ROM/ /sdcard/TWRP/BACKUPS</li><li>进入twrp，从备份中恢复,重启手机,然后修改权限 chmod 777 /data/local/tmp/monitor_package</li><li>安装你需要监控的apk(系统自动把最后一次安装的apk添加进去监控的列表 /data/local/tmp/monitor_package),只能同时监控一个</li><li>/data/data/package_name/下面生成APK调用的算法,只有三种(数据均为JSON编码,字段为BASE64编码)</li></ol><p>28:00</p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>魔改系统源码编译</title>
      <link href="2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
      <url>2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h2 id="frida"><a href="#frida" class="headerlink" title="frida"></a>frida</h2><ol><li>pixel(salfish)+官方8.1.0_r1+twrp3.3.0+Magisk+Frida</li><li>pixel(salfish)+twrp3.3.0+lineage16.0+addonsu16.0</li></ol><h2 id="xposed"><a href="#xposed" class="headerlink" title="xposed"></a>xposed</h2><ol><li>pixel(salfish)+官方7.1.2_r8+twrp3.2.1-0+SuperSU+XposedInstaller </li></ol><h2 id="fart同aosp"><a href="#fart同aosp" class="headerlink" title="fart同aosp"></a>fart同aosp</h2><ol><li>pixel(salfish)+最新fastboot+fart8.1.0</li><li>n6p(angler)+老fastboot+fart8.1.0</li></ol><h2 id="NetHunter"><a href="#NetHunter" class="headerlink" title="NetHunter"></a>NetHunter</h2><ol><li>n6p(angler)+原生8.1.0_r1+twrp3.3.1+SuoerSU</li></ol><h1 id="编译aosp刷机"><a href="#编译aosp刷机" class="headerlink" title="编译aosp刷机"></a>编译aosp刷机</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># apt update</span><br><span class="line"># git config --global user.email &quot;you@example.com&quot;</span><br><span class="line"># git config --global user.name &quot;Your Name&quot;</span><br><span class="line"># apt install bison tree</span><br><span class="line"># dpkg --add-architecture i386</span><br><span class="line"># apt update</span><br><span class="line"># apt install libc6:i386 libncurses5:i386 libstdc++6:i386</span><br><span class="line"># apt install libxml2-utils</span><br><span class="line">apt install nethogs  查看流量由哪个进程产生</span><br></pre></td></tr></table></figure><p><a href="https://source.android.com/source/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="noopener">android版本列表</a></p><p>同步<a href="https://mirrors.ustc.edu.cn/help/aosp.html" target="_blank" rel="noopener">清华</a>  同步<a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="noopener">中科大</a> <a href="https://blog.csdn.net/click_idc/article/details/80591686" target="_blank" rel="noopener">编译内存不足加swap</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;swapfile bs&#x3D;1024 count&#x3D;10240000  使用dd创建swapfile作为swap分区空间</span><br><span class="line">mkswap swapfile  mkswap创建交换文件</span><br><span class="line"></span><br><span class="line">## 下载repo工具</span><br><span class="line">mkdir ~&#x2F;bin</span><br><span class="line">PATH&#x3D;~&#x2F;bin:$PATH</span><br><span class="line">curl https:&#x2F;&#x2F;storage.googleapis.com&#x2F;git-repo-downloads&#x2F;repo &gt; ~&#x2F;bin&#x2F;repo</span><br><span class="line">## 如果上述 URL 不可访问，可以用下面的：</span><br><span class="line">## curl -sSL  &#39;https:&#x2F;&#x2F;gerrit-googlesource.proxy.ustclug.org&#x2F;git-repo&#x2F;+&#x2F;master&#x2F;repo?format&#x3D;TEXT&#39; |base64 -d &gt; ~&#x2F;bin&#x2F;repo</span><br><span class="line">chmod a+x ~&#x2F;bin&#x2F;repo</span><br><span class="line">mkdir COMPILE</span><br><span class="line">cd COMPILE</span><br><span class="line"></span><br><span class="line">## 初始化仓库：</span><br><span class="line">repo init -u git:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;aosp&#x2F;platform&#x2F;manifest</span><br><span class="line">## 如果提示无法连接到 gerrit.googlesource.com，可以编辑 ~&#x2F;bin&#x2F;repo，把 REPO_URL 一行替换成下面的：</span><br><span class="line">## REPO_URL &#x3D; &#39;https:&#x2F;&#x2F;gerrit-googlesource.proxy.ustclug.org&#x2F;git-repo&#39;</span><br><span class="line">## 如果需要某个特定的 Android 版本：</span><br><span class="line">repo init -u git:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;aosp&#x2F;platform&#x2F;manifest -b android-7.1.2_r8</span><br><span class="line">或者</span><br><span class="line">wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;aosp-monthly&#x2F;aosp-latest.tar</span><br><span class="line">tar xf aosp-latest.tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 同步源码树（以后只需执行这条命令来同步）：</span><br><span class="line">## 默认线程数4，可增加</span><br><span class="line">repo sync -j8</span><br><span class="line"># 下载java8  或者 apt install openjdk-8-jdk</span><br><span class="line">wget https:&#x2F;&#x2F;download.java.net&#x2F;openjdk&#x2F;jdk8u41&#x2F;ri&#x2F;openjdk-8u41-b04-linux-x64-14_jan_2020.tar.gz</span><br><span class="line"># 解压到&#x2F;home&#x2F;kali&#x2F;Desktop&#x2F;openjdk8&#x2F;</span><br><span class="line">#修改.zshrc</span><br><span class="line">nano ~&#x2F;.zshrc</span><br><span class="line"># 在zshrc中加入下面内容</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;home&#x2F;kali&#x2F;Desktop&#x2F;openjdk8&#x2F;java-se-8u41-ri</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br></pre></td></tr></table></figure><h2 id="编译刷机"><a href="#编译刷机" class="headerlink" title="编译刷机"></a>编译刷机</h2><p>7z x <a href="https://pan.baidu.com/s/16WgxYMyLjsuNk-5RS9yvWA" target="_blank" rel="noopener">aosp712r8</a>  7.62g</p><p><a href="https://developers.google.com/android/drivers/" target="_blank" rel="noopener">驱动下载</a>  注意版本一致，在aosp712r8目录下解压安装 <code>./extrace-google_devices-sailfish.sh</code> 和<code>./extrace-qcom-sailfish.sh</code>不装驱动，编译后没有vender</p><p><img src="/2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/image-20210504165848297.png" alt="image-20210504165848297"></p><p><img src="/2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/20210407134258742.png" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/20210407133741127.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export LC_ALL&#x3D;C   编译前执行命令去除本地化设置</span><br><span class="line">cd COMPILE&#x2F;aosp712r8</span><br><span class="line">source build&#x2F;envsetup.sh  导入环境变量</span><br><span class="line">chsh -s &#x2F;bin&#x2F;bash   提示只支持bash，但kali2021默认是zsh，用zsh可能会导致编译版本不对，需要改成bash</span><br></pre></td></tr></table></figure><p>重启-选择设备</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lunch 选择版本18 aosp_sailfish_userdebug</span><br><span class="line"># j后面参数可以选则核心数*2</span><br><span class="line">make -j8  开始，编译完成的系统镜像位于当前目录的out&#x2F;target&#x2F;product&#x2F;sailfish&#x2F;下包括各个img</span><br><span class="line">which fastboot  查看fastboot位置</span><br></pre></td></tr></table></figure><p>关机+音量-  进入fastboot</p><p>unzip <a href="https://dl.google.com/dl/android/aosp/sailfish-n2g47o-factory-f2bc8024.zip" target="_blank" rel="noopener">sailfish-n2g47o-factory-f2bc8024.zip</a>   将上面编译好的boot.img,ramdisk.img,ramdisk-recovery.img,system.img,system_other.img,userdata.img拷贝到解压后的image-sailfish-n2g47o.zip 删除所有镜像，保留android-info.txt，压缩image-sailfish-n2g47o下所有内容，压缩包名称与flash-all.sh里的内容匹配，压缩包内不要有文件夹<code>zip -j image-sailfish-n2g47o.zip ./image-sailfish-n2g47o/*</code></p><p>./flush-all.sh  开始刷机</p><p><a href="https://bbs.pediy.com/thread-218366.htm" target="_blank" rel="noopener">记一次安卓系统源码下载过程</a> </p><p><a href="https://bbs.pediy.com/thread-218513.htm" target="_blank" rel="noopener">记一次安卓系统源码编译刷机过程</a> </p><p><a href="https://bbs.pediy.com/thread-219233.htm" target="_blank" rel="noopener">记一次安卓内核源码编译刷机过程(修改反调试标志位)</a> </p><h1 id="编译原版Xposed刷机"><a href="#编译原版Xposed刷机" class="headerlink" title="编译原版Xposed刷机"></a>编译原版Xposed刷机</h1><p><a href="https://bbs.pediy.com/thread-258639.htm" target="_blank" rel="noopener">XPOSED魔改一：获取特征</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir XPOSED</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;XposedInstaller.git  xposed框架安装工具</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;XposedBridge.git   xposed框架java部分</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;android_art.git  android 5.0及以上用art虚拟机，对这部分的修改</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;XposedTools.git  打包编译xposed框架</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;Xposed.git     xposed框架native部分</span><br></pre></td></tr></table></figure><p>android-studio编译XposedInstaller</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;Android&#x2F;Sdk&#x2F;build-tools&#x2F;23.0.3</span><br><span class="line">.&#x2F;aapt</span><br><span class="line">apt-file search libz.so.1</span><br><span class="line">apt install lib32z1</span><br></pre></td></tr></table></figure><p><img src="/2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/20210420021959190.png" alt="在这里插入图片描述"></p><p>下载的<a href="https://github.com/rovo89/android_art" target="_blank" rel="noopener">android_art</a>复制到aosp712r8目录，用android_art替换原art重命名为art文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export LC_ALL&#x3D;C</span><br><span class="line">source build&#x2F;envsetup.sh</span><br><span class="line">lunch 18</span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure><p>XposedBridge编译生成的apk改名为XposedBridge.jar放到/root/Desktop/COMPILE/aosp712r8/out/java/</p><p>XposedTools目录，<code>cp build.conf.example ./build.conf</code>修改配置文件build.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[General]</span><br><span class="line"># 输出目录</span><br><span class="line">outdir &#x3D; &#x2F;root&#x2F;Desktop&#x2F;COMPILE&#x2F;aosp712r8&#x2F;out&#x2F;</span><br><span class="line"></span><br><span class="line"># xposedBridge.jar目录</span><br><span class="line">javadir &#x3D; &#x2F;root&#x2F;Desktop&#x2F;COMPILE&#x2F;aosp712r8&#x2F;out&#x2F;java&#x2F;</span><br><span class="line"></span><br><span class="line">[Build]</span><br><span class="line"># Please keep the base version number and add your custom suffix</span><br><span class="line"># 版本</span><br><span class="line">version &#x3D; 89 (custom build by xyz &#x2F; %s)</span><br><span class="line"># 编译时线程数</span><br><span class="line">makeflags &#x3D; -j8</span><br><span class="line"></span><br><span class="line">[GPG]</span><br><span class="line">sign &#x3D; release</span><br><span class="line">user &#x3D; 852109AA!</span><br><span class="line"></span><br><span class="line"># Root directories of the AOSP source tree per SDK version</span><br><span class="line">[AospDir]</span><br><span class="line"># api版本和aosp源码目录</span><br><span class="line">25 &#x3D; &#x2F;root&#x2F;Desktop&#x2F;COMPILE&#x2F;aosp712r8&#x2F;</span><br><span class="line"># SDKs to be used for compiling BusyBox</span><br><span class="line"># Needs https:&#x2F;&#x2F;github.com&#x2F;rovo89&#x2F;android_external_busybox</span><br><span class="line">[BusyBox]</span><br><span class="line"># api版本一致</span><br><span class="line">arm &#x3D; 25</span><br><span class="line">x86 &#x3D; 25</span><br><span class="line">armv5 &#x3D; 25</span><br></pre></td></tr></table></figure><p>下载<a href="https://github.com/rovo89/Xposed" target="_blank" rel="noopener">Xposed</a>复制到 aosp712r87/frameworks/base/cmds目录</p><p>安装perl包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libauthen-ntlm-perl</span><br><span class="line">apt-get install libclass-load-perl</span><br><span class="line">apt-get install libcrypt-ssleay-perl</span><br><span class="line">apt-get install libdata-uniqid-perl</span><br><span class="line">apt-get install libdigest-hmac-perl</span><br><span class="line">apt-get install libdist-checkconflicts-perl</span><br><span class="line">apt-get install libfile-copy-recursive-perl</span><br><span class="line">apt-get install libfile-tail-perl</span><br><span class="line">apt-get install libconfig-inifiles-perl</span><br><span class="line">perl -MCPAN -e &#39;install Config::IniFiles&#39;</span><br><span class="line">perl -MCPAN -e &#39;install File::ReadBackwards&#39;</span><br><span class="line">perl -MCPAN -e &#39;install File::Tail&#39;</span><br><span class="line">cpan</span><br><span class="line">install Archive::Zip</span><br><span class="line">exit</span><br><span class="line">.&#x2F;build.pl -t arm64:25</span><br></pre></td></tr></table></figure><p>hook远程url，修改xposed下载源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U | grep -i xposed</span><br><span class="line">objection -g de.robv.android.xposed.installer explore</span><br><span class="line">android hooking watch class de.robv.android.xposed.installer.util.DownloadsUtil --dump-args --dump-backtrace --dump-return</span><br><span class="line">android hooking watch class_method de.robv.android.xposed.installer.util.DownloadsUtil.getDownloadTargetForUrl --dump-args --dump-backtrace --dump-return  点击install触发打印调用栈</span><br></pre></td></tr></table></figure><p>修改DownloadsUtil是setUrl方法中的mUrl的值为本地的zip地址，zip包目录：aosp712r8/out/sdk25/arm64/，<code>apt install lighttpd</code></p><p><img src="/2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/20210419201415336.png" alt="在这里插入图片描述"></p><p>Android.mk没找到ART.mk，路径问题，修改Android.mk最下面ART.mk路径改成绝对路径</p><p><img src="/2021/05/04/%E9%AD%94%E6%94%B9%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/image-20210504211056918.png" alt="image-20210504211056918"></p><h1 id="魔改Xposed去特征"><a href="#魔改Xposed去特征" class="headerlink" title="魔改Xposed去特征"></a>魔改Xposed去特征</h1><p><a href="https://bbs.pediy.com/thread-255836.htm" target="_blank" rel="noopener">定制Xposed框架</a></p><p>XposedBridge通过Gradle工具jarStubs和jarStubsSource编译生成的XposedBridge/app/build/api/api.jar替换xposed的项目的libs下的api.jar</p><p>build.gradle <code>compileOnly  files(&#39;libs/api.jar&#39;)</code></p><p>修改<strong>XposedInstaller</strong>中的包名xposed为xppsed，所有的de.robv.android.xposed.installer改成de.robv.android.xppsed.installer，所有的/su/xposed/xposed.prop和/system/xposed.prop的xposed.prop改成xppsed.prop</p><p> 修改<strong>XposedBridged</strong>的包名xposed改为xppsed，所有的de.robv.android.xposed改成所有的de.robv.android.xppsed，build好后的XposedBridge后包app-release-unsigned.apk的名字改成XppsedBridge.jar</p><p>进入aosp712r87/frameworks/base/cmds/<strong>xposed</strong>/</p><p>修改libxposed_common.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define CLASS_XPOSED_BRIDGE  &quot;de&#x2F;robv&#x2F;android&#x2F;xppsed&#x2F;XposedBridge&quot;</span><br><span class="line">#define CLASS_ZYGOTE_SERVICE &quot;de&#x2F;robv&#x2F;android&#x2F;xppsed&#x2F;services&#x2F;ZygoteService&quot;</span><br><span class="line">#define CLASS_FILE_RESULT    &quot;de&#x2F;robv&#x2F;android&#x2F;xppsed&#x2F;services&#x2F;FileResult&quot;</span><br></pre></td></tr></table></figure><p>修改xposed.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#define XPOSED_PROP_FILE &quot;&#x2F;system&#x2F;xppsed.prop&quot;</span><br><span class="line">#define XPOSED_LIB_ART           XPOSED_LIB_DIR &quot;libxppsed_art.so&quot;</span><br><span class="line">#define XPOSED_JAR               &quot;&#x2F;system&#x2F;framework&#x2F;XppsedBridge.jar&quot;</span><br><span class="line">#define XPOSED_CLASS_DOTS_ZYGOTE &quot;de.robv.android.xppsed.XposedBridge&quot;</span><br><span class="line">#define XPOSED_CLASS_DOTS_TOOLS  &quot;de.robv.android.xppsed.XposedBridge$ToolEntryPoint&quot;</span><br></pre></td></tr></table></figure><p>修改xposed_service.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IMPLEMENT_META_INTERFACE(XposedService, &quot;de.robv.android.xppsed.IXposedService&quot;);</span><br></pre></td></tr></table></figure><p>修改xposed_shared.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define XPOSED_DIR &quot;&#x2F;data&#x2F;user_de&#x2F;0&#x2F;de.robv.android.xppsed.installer&#x2F;&quot;</span><br><span class="line">#define XPOSED_DIR &quot;&#x2F;data&#x2F;data&#x2F;de.robv.android.xppsed.installer&#x2F;&quot;</span><br></pre></td></tr></table></figure><p>修改libxposed_art.cpp名为libxppsed_art.cpp</p><p>修改ART.mk</p><p>libxposed_art改成libxppsed_art</p><p> 进入<strong>XposedTools</strong></p><p> 修改build.pl</p><p>xposed.prop改成xppsed.prop </p><p>XposedBridge.jar改成XppsedBridge.jar</p><p>libxposed_art改成libxppsed_art</p><p>grep -ril “xposedbridge.jar” * 找到所有包含的文件flash-script.sh等文件中的有上述xposed.prop，XposedBridge.jar，libxposed_art改掉即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;build.pl -t arm64:25  重新编译生成路径aosp712r8&#x2F;out&#x2F;sdk25&#x2F;arm64下的zip包改成xposed-v89-sdk25-arm64.zip</span><br></pre></td></tr></table></figure><p>apt install lighttpd &amp;&amp; service lighttpd start</p><p>cp xposed-v89-sdk25-arm64.zip /var/www/html/</p><p>手机端访问192.168.0.102/xposed-v89-sdk25-arm64.zip (虚拟机) 可以直接下载</p><p>安装XposedInstaller(DownloadsUtil下的setUrl的mUrl改为虚拟机下载)进入Install界面进行安装xposed框架</p><p>adb install xposed_checker_app 过检测</p><p>开发新的xposed模块时，移除libs下的api.jar使用XposedBridge通过jarStubs生成的api.jar，更改代码中的de.robv.android.xppsed…</p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xposed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xposed主动调用开发</title>
      <link href="2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/"/>
      <url>2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>相比于Frida，Xposed在参数的构造上是更有优势的,因为它就是使用的Java进行的开发；</p><p>hook(想通过hook的方式得到一个obj的话需要hook一个实例方法)</p><ol><li><p>constructor.newInstance         </p></li><li><p>xposed.newInstance</p></li></ol><h1 id="案例Qualification"><a href="#案例Qualification" class="headerlink" title="案例Qualification"></a>案例Qualification</h1><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>adb install Qualification-1.3-easy-release.apk  目标就是找到pin的真实值</p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501160104595.png" alt="image-20210501160104595"></p><p>jadx-gui Qualification-1.3-easy-release.apk  搜索not the 找不到可能的结果，弹窗可能存在于dialog_failure或者dialog_success</p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501155903377.png" alt="image-20210501155903377"></p><p>查看strings.xml中定义的变量，<code>&lt;string name=&quot;dialog_failure&quot;&gt;Unfortunately, not the right PIN :(&lt;/string&gt;</code></p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501160334072.png" alt="image-20210501160334072"></p><p>通过hookEvent.js进行hook所有动作触发的组件，找到<code>android.support.v7.app.AppCompatViewInflater$DeclaredOnClickListener</code></p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501220605705.png" alt="image-20210501220605705"></p><p>jadx中搜索<code>android.support.v7.app.AppCompatViewInflater.DeclaredOnClickListener</code>,使用了系统框架，无法准确定位最近的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">objection -g org.teamsik.ahe17.qualification.easy explore -P ~&#x2F;.objection&#x2F;plugins   AndroidManifest.xml拿到包名开始objection</span><br><span class="line">android hooking search classes MainActivity</span><br><span class="line">android hooking list class_methods org.teamsik.ahe17.qualification.MainActivity </span><br><span class="line">android hooking watch class org.teamsik.ahe17.qualification.MainActivity  点击VERIFY PIN按钮触发事件</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501221658530.png" alt="image-20210501221658530"></p><p>根据<code>org.teamsik.ahe17.qualification.MainActivity.verifyPasswordClick</code>触发hook verifyPasswordClick</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method org.teamsik.ahe17.qualification.MainActivity.verifyPasswordClick --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501222041222.png" alt="image-20210501222041222"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker objectsearch android.support.v7.app.AppCompatViewInflater$DeclaredOnClickListener </span><br><span class="line">plugin wallbreaker objectdump --fullname 0x227a  使用反射进行调用的框架</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501222956442.png" alt="image-20210501222956442"></p><h2 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h2><p>校验秘钥逻辑如下，通过调用逻辑改写verifyPassword实现解密。</p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501224643323.png" alt="image-20210501224643323"></p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210501224633987.png" alt="image-20210501224633987"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes Verifier  最好从内存中捞这个类，而非根据静态反编译，hook方法也最好从内存中获取，不要从静态编译结果中获取不准确</span><br></pre></td></tr></table></figure><h3 id="反射调用encodePassword"><a href="#反射调用encodePassword" class="headerlink" title="反射调用encodePassword"></a>反射调用encodePassword</h3><p>f (v[i] != p[i])</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line">&#x2F;&#x2F; 安装xposed1点击button触发反射调用</span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;org.teamsik.ahe17.qualification.Verifier&quot;);</span><br><span class="line">    Method encodePassword &#x3D; clazz.getDeclaredMethod(&quot;encodePassword&quot;, String.class);</span><br><span class="line">    encodePassword.setAccessible(true);</span><br><span class="line">    byte[] p &#x3D; &quot;09042ec2c2c08c4cbece042681caf1d13984f24a&quot;.getBytes();</span><br><span class="line">    &#x2F;&#x2F; XposedBridge.log(&quot;result i is &#x3D;&gt; &quot; + new String(p)); 打印字节数组</span><br><span class="line">    String pStr &#x3D; new String((p));</span><br><span class="line">    for (int i &#x3D; 999; i &lt; 10000; i++) &#123;</span><br><span class="line">        byte[] v &#x3D; (byte[]) encodePassword.invoke(null, String.valueOf(i));</span><br><span class="line">        if (v.length !&#x3D; p.length) &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        String vStr &#x3D; new String(v);</span><br><span class="line">        if (vStr &#x3D;&#x3D; pStr) &#123;</span><br><span class="line">            XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot; + String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="反射调用verifyPassword"><a href="#反射调用verifyPassword" class="headerlink" title="反射调用verifyPassword"></a>反射调用verifyPassword</h3><p>if (!Verifier.verifyPassword(this, this.txPassword.getText().toString())) </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;org.teamsik.ahe17.qualification.Verifier&quot;);</span><br><span class="line">&#x2F;&#x2F; public 方法不需要getDeclaredMethod和setAccessible，反射拿到verifyPassword</span><br><span class="line">    Method verifyPassword &#x3D; clazz.getMethod(&quot;verifyPassword&quot;, Context.class, String.class);</span><br><span class="line">    Context context &#x3D; AndroidAppHelper.currentApplication();</span><br><span class="line"></span><br><span class="line">    for (int i &#x3D; 999; i &lt; 10000; i++) &#123;</span><br><span class="line">        if ((boolean) verifyPassword.invoke(null, context, String.valueOf(i))) &#123;</span><br><span class="line">            XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot; + String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="callStaticMethod-verifyPassword"><a href="#callStaticMethod-verifyPassword" class="headerlink" title="callStaticMethod verifyPassword"></a>callStaticMethod verifyPassword</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line">    XposedBridge.log(&quot;inner&quot;+loadPackageParam.processName);</span><br><span class="line">    Class clazz &#x3D; XposedHelpers.findClass(&quot;org.teamsik.ahe17.qualification.Verifier&quot;,loadPackageParam.classLoader);</span><br><span class="line">&#x2F;&#x2F; hook Verifier类，并直接调用静态方法verifyPassword</span><br><span class="line">    Context context &#x3D; AndroidAppHelper.currentApplication();</span><br><span class="line"></span><br><span class="line">    for(int i &#x3D; 999;i&lt;10000;i++)&#123;</span><br><span class="line">        if((boolean) XposedHelpers.callStaticMethod(clazz,&quot;verifyPassword&quot;,context,String.valueOf(i)))&#123;</span><br><span class="line">            XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot;+ String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="findAndHookMethod-encodePassword"><a href="#findAndHookMethod-encodePassword" class="headerlink" title="findAndHookMethod encodePassword"></a>findAndHookMethod encodePassword</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    Class clazz &#x3D; XposedHelpers.findClass(&quot;org.teamsik.ahe17.qualification.Verifier&quot;, loadPackageParam.classLoader);</span><br><span class="line">    XposedHelpers.findAndHookMethod(clazz, &quot;encodePassword&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">&#x2F;&#x2F; hook encodePassword后拿到所在类，调用该类的verifyPassword</span><br><span class="line">        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            Context context &#x3D; AndroidAppHelper.currentApplication();</span><br><span class="line">            for (int i &#x3D; 999; i &lt; 10000; i++) &#123;</span><br><span class="line">                if ((boolean) XposedHelpers.callMethod(param.thisObject, &quot;verifyPassword&quot;, context, String.valueOf(i))) &#123;</span><br><span class="line">                    XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot; + String.valueOf(i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(&quot;getResult is &#x3D;&gt; &quot;, (String) param.getResult());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="newInstance-Verifier"><a href="#newInstance-Verifier" class="headerlink" title="newInstance Verifier"></a>newInstance Verifier</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    Class clazz &#x3D; XposedHelpers.findClass(&quot;org.teamsik.ahe17.qualification.Verifier&quot;, loadPackageParam.classLoader);</span><br><span class="line">    &#x2F;&#x2F; newInstance拿到Verifier类并调用verifyPassword</span><br><span class="line">    Object Verifier &#x3D; XposedHelpers.newInstance(clazz);</span><br><span class="line">    Context context &#x3D; AndroidAppHelper.currentApplication();</span><br><span class="line"></span><br><span class="line">    for (int i &#x3D; 999; i &lt; 10000; i++) &#123;</span><br><span class="line">        if ((boolean) XposedHelpers.callMethod(Verifier, &quot;verifyPassword&quot;, context, String.valueOf(i))) &#123;</span><br><span class="line">            XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot; + String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="findConstructorExact-Verifier"><a href="#findConstructorExact-Verifier" class="headerlink" title="findConstructorExact Verifier"></a>findConstructorExact Verifier</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">&#x2F;&#x2F; Constructor获取构造器newInstance拿到Verifier并调用verifyPassword</span><br><span class="line">    Constructor cons &#x3D; XposedHelpers.findConstructorExact(&quot;org.teamsik.ahe17.qualification.Verifier&quot;,loadPackageParam.classLoader);</span><br><span class="line">    Object Verifier &#x3D; cons.newInstance();</span><br><span class="line">    Context context &#x3D; AndroidAppHelper.currentApplication();</span><br><span class="line">    for (int i &#x3D; 999; i &lt; 10000; i++) &#123;</span><br><span class="line">        if ((boolean) XposedHelpers.callMethod(Verifier, &quot;verifyPassword&quot;, context, String.valueOf(i))) &#123;</span><br><span class="line">            XposedBridge.log(&quot;Current i is &#x3D;&gt; &quot; + String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="hookAllMethods-onCreate"><a href="#hookAllMethods-onCreate" class="headerlink" title="hookAllMethods onCreate"></a>hookAllMethods onCreate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;org.teamsik.ahe17.qualification.easy&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line"></span><br><span class="line">    Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;org.teamsik.ahe17.qualification.MainActivity&quot;);</span><br><span class="line">&#x2F;&#x2F; 直接调用verifyPassword成功后回调的方法showSuccessDialog</span><br><span class="line">    XposedBridge.hookAllMethods(clazz, &quot;onCreate&quot;,new XC_MethodHook() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            super.afterHookedMethod(param);</span><br><span class="line">            Object mMainAciticity &#x3D; param.thisObject;</span><br><span class="line">            XposedHelpers.callMethod(mMainAciticity,&quot;showSuccessDialog&quot;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="案例demoso1"><a href="#案例demoso1" class="headerlink" title="案例demoso1"></a>案例demoso1</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;fs1426arm64 </span><br><span class="line">pyenv local 3.9.0</span><br><span class="line">objection -g com.example.demoso1 explore </span><br><span class="line">android hooking search classes MainActivity</span><br><span class="line">android hooking list class_methods com.example.demoso1.MainActivity  查看该类中所有函数</span><br><span class="line">android hooking watch class com.example.demoso1.MainActivity</span><br><span class="line">android hooking watch class_method com.example.demoso1.MainActivity.$init  查看构造函数的参数</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503174025839.png" alt="image-20210503174025839"></p><blockquote><ol><li>给android hooking list class_methods 加上构造函数</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;.pyenv</span><br><span class="line">tree -NCfhl|grep objection</span><br><span class="line">cd .&#x2F;versions&#x2F;3.9.0&#x2F;lib&#x2F;python3.9&#x2F;site-packages</span><br><span class="line">tree -NCfhl |grep -i agent.js</span><br><span class="line">vi .&#x2F;objection&#x2F;agent.js</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503182639000.png" alt="image-20210503182639000"></p><p>//android hooking list class_methods com.example.demoso1.MainActivity<br>//protected void com.example.demoso1.MainActivity.onCreate(android.os.Bundle)<br>//public native int com.example.demoso1.MainActivity.init()<br>//public native int com.example.demoso1.MainActivity.myfirstjni()<br>//public native java.lang.String com.example.demoso1.MainActivity.method02(java.lang.String)<br>//public static native java.lang.String com.example.demoso1.MainActivity.method01(java.lang.String)<br>//public static native java.lang.String com.example.demoso1.MainActivity.myfirstjniJNI(java.lang.String)<br>//public static native java.lang.String com.example.demoso1.MainActivity.stringFromJNI()<br>//public static native java.lang.String com.example.demoso1.MainActivity.stringFromJNI2()<br>//public void com.example.demoso1.MainActivity.testField()<br>//public void com.example.demoso1.MainActivity.testMethod()<br>//        Found 10 method(s)</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;com.example.demoso1&quot;)) &#123;</span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    final Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;com.example.demoso1.MainActivity&quot;);</span><br><span class="line">    &#x2F;&#x2F;得到对象：hook(想通过hook的方式得到一个obj的话得hook一个实例方法) onCreate 循环调用method01和method02，onCreate执行后再触发</span><br><span class="line">    XposedBridge.hookAllMethods(clazz, &quot;onCreate&quot;, new XC_MethodHook() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            super.beforeHookedMethod(param);</span><br><span class="line">            Object mMainAciticity &#x3D; param.thisObject;</span><br><span class="line">            String cipherText &#x3D; (String) XposedHelpers.callMethod(mMainAciticity, &quot;method01&quot;, &quot;roysue&quot;);</span><br><span class="line">            String clearText &#x3D; (String) XposedHelpers.callMethod(mMainAciticity, &quot;method02&quot;, &quot;47fcda3822cd10a8e2f667fa49da783f&quot;);</span><br><span class="line">            XposedBridge.log(&quot;Cipher text is &#x3D;&gt; &quot; + cipherText);</span><br><span class="line">            XposedBridge.log(&quot;Clear text is &#x3D;&gt; &quot; + clearText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;xposed.newInstance获取对象 毕竟在hook中，进行主动调用的话，触发条件需要将mMainActivity进行newInstance，包只要打开就会触发</span><br><span class="line">    Object newMainActivity &#x3D; XposedHelpers.newInstance(clazz);</span><br><span class="line">    String cipherText &#x3D; (String) XposedHelpers.callMethod(newMainActivity, &quot;method01&quot;, &quot;roysue&quot;);</span><br><span class="line">    String clearText &#x3D; (String) XposedHelpers.callMethod(newMainActivity, &quot;method02&quot;, &quot;47fcda3822cd10a8e2f667fa49da783f&quot;);</span><br><span class="line">    XposedBridge.log(&quot;Cipher text 2 is &#x3D;&gt; &quot; + cipherText);</span><br><span class="line">    XposedBridge.log(&quot;Clear text 2 is &#x3D;&gt; &quot; + clearText);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503183616411.png" alt="image-20210503183616411"></p><h2 id="Nanohttpd"><a href="#Nanohttpd" class="headerlink" title="Nanohttpd"></a>Nanohttpd</h2><p><a href="https://curz0n.github.io/2018/05/31/nanohttpd_encrypt/" target="_blank" rel="noopener">利用NanoHTTPD反射调用Android APP加密函数</a></p><p>build.gradle添加依赖<code>implementation &#39;org.nanohttpd:nanohttpd:2.3.1&#39;</code></p><p>AndroidManifest.xml添加网络权限声明<code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">Object mMainActivity &#x3D; null;</span><br><span class="line"></span><br><span class="line">public void setActivity(Object obj) &#123;</span><br><span class="line">    mMainActivity &#x3D; obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Object getActivity() &#123;</span><br><span class="line">    return mMainActivity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (loadPackageParam.packageName.equals(&quot;com.example.demoso1&quot;)) &#123;</span><br><span class="line">    XposedBridge.log(&quot;inner&quot; + loadPackageParam.processName);</span><br><span class="line">    final Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;com.example.demoso1.MainActivity&quot;);</span><br><span class="line">    &#x2F;&#x2F;得到对象：hook(想通过hook的方式得到一个obj的话得hook一个实例方法) onCreate 循环调用method01和method02</span><br><span class="line">    XposedBridge.hookAllMethods(clazz, &quot;onCreate&quot;, new XC_MethodHook() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            super.beforeHookedMethod(param);</span><br><span class="line">            Object mMainAciticity &#x3D; param.thisObject;</span><br><span class="line">            String cipherText &#x3D; (String) XposedHelpers.callMethod(mMainAciticity, &quot;method01&quot;, &quot;roysue&quot;);</span><br><span class="line">            String clearText &#x3D; (String) XposedHelpers.callMethod(mMainAciticity, &quot;method02&quot;, &quot;47fcda3822cd10a8e2f667fa49da783f&quot;);</span><br><span class="line">            XposedBridge.log(&quot;Cipher text is &#x3D;&gt; &quot; + cipherText);</span><br><span class="line">            XposedBridge.log(&quot;Clear text is &#x3D;&gt; &quot; + clearText);</span><br><span class="line">&#x2F;&#x2F;                    setActivity(mMainAciticity);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;xposed.newInstance获取对象 毕竟在hook中，进行主动调用的话，触发条件需要将mMainActivity进行newInstance</span><br><span class="line">    Object newMainActivity &#x3D; XposedHelpers.newInstance(clazz);</span><br><span class="line">    String cipherText &#x3D; (String) XposedHelpers.callMethod(newMainActivity, &quot;method01&quot;, &quot;roysue&quot;);</span><br><span class="line">    String clearText &#x3D; (String) XposedHelpers.callMethod(newMainActivity, &quot;method02&quot;, &quot;47fcda3822cd10a8e2f667fa49da783f&quot;);</span><br><span class="line">    XposedBridge.log(&quot;Cipher text 2 is &#x3D;&gt; &quot; + cipherText);</span><br><span class="line">    XposedBridge.log(&quot;Clear text 2 is &#x3D;&gt; &quot; + clearText);</span><br><span class="line">    setActivity(newMainActivity);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class App extends NanoHTTPD &#123;</span><br><span class="line"></span><br><span class="line">        public App() throws IOException &#123;</span><br><span class="line">            super(8899);</span><br><span class="line">            &#x2F;&#x2F; 内部新起线程实现http，无法直接调用当前类的变量，需要在上面定义setActivity拿到callMethod里的对象</span><br><span class="line">            start(NanoHTTPD.SOCKET_READ_TIMEOUT, true);</span><br><span class="line">            XposedBridge.log(&quot;\nRunning! Point your browsers to http:&#x2F;&#x2F;localhost:8899&#x2F; \n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public NanoHTTPD.Response serve(IHTTPSession session) &#123;</span><br><span class="line"></span><br><span class="line">            Method method &#x3D; session.getMethod();</span><br><span class="line">            String uri &#x3D; session.getUri();</span><br><span class="line">            String RemoteIP &#x3D; session.getRemoteIpAddress();</span><br><span class="line">            String RemoteHostName &#x3D; session.getRemoteHostName();</span><br><span class="line">            Log.i(&quot;r0ysue nanohttpd &quot;,&quot;Method &#x3D;&gt; &quot;+method + &quot; ;Url &#x3D;&gt; &quot; + uri + &quot;&#39; &quot;);</span><br><span class="line">            Log.i(&quot;r0ysue nanohttpd &quot;,&quot;Remote IP  &#x3D;&gt; &quot;+RemoteIP + &quot; ;RemoteHostName &#x3D;&gt; &quot; + RemoteHostName + &quot;&#39; &quot;);</span><br><span class="line"></span><br><span class="line">            String paramBody &#x3D; &quot;&quot;;</span><br><span class="line">            Map&lt;String, String&gt; files &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">            try &#123;</span><br><span class="line">                session.parseBody(files);</span><br><span class="line">                paramBody &#x3D; session.getQueryParameterString();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (ResponseException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            Log.i(&quot;Nano_post_param &#x3D;&gt; &quot;, paramBody);</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;                    String msg &#x3D; &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello server&lt;&#x2F;h1&gt;\n&quot;;</span><br><span class="line">&#x2F;&#x2F;                    Map&lt;String, String&gt; parms &#x3D; session.getParms();</span><br><span class="line">&#x2F;&#x2F;                    if (parms.get(&quot;username&quot;) &#x3D;&#x3D; null) &#123;</span><br><span class="line">&#x2F;&#x2F;                        msg +&#x3D; &quot;&lt;form action&#x3D;&#39;?&#39; method&#x3D;&#39;get&#39;&gt;\n  &lt;p&gt;Your name: &lt;input type&#x3D;&#39;text&#39; name&#x3D;&#39;username&#39;&gt;&lt;&#x2F;p&gt;\n&quot; + &quot;&lt;&#x2F;form&gt;\n&quot;;</span><br><span class="line">&#x2F;&#x2F;                    &#125; else &#123;</span><br><span class="line">&#x2F;&#x2F;                        msg +&#x3D; &quot;&lt;p&gt;Hello, &quot; + parms.get(&quot;username&quot;) + &quot;!&lt;&#x2F;p&gt;&quot;;</span><br><span class="line">&#x2F;&#x2F;                    &#125;</span><br><span class="line">            String result &#x3D; &quot;&quot;;</span><br><span class="line">            result &#x3D;  (String) XposedHelpers.callMethod(getActivity(), &quot;method01&quot;, &quot;r0ysue&quot;);</span><br><span class="line">            return newFixedLengthResponse(Response.Status.OK, NanoHTTPD.MIME_PLAINTEXT, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    new App();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>curl -s -X POST “<a href="http://192.168.0.103:8899/&quot;" target="_blank" rel="noopener">http://192.168.0.103:8899/&quot;</a> -d ‘{“data”:onejane}’</p><p><strong>python调用实现</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">def encrypt(enParam):</span><br><span class="line">&#x2F;&#x2F; xposed1 app所在手机ip</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;192.168.0.103:8899&quot;</span><br><span class="line">    param &#x3D; enParam</span><br><span class="line">    headers &#x3D; &#123;&quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded&quot;&#125;</span><br><span class="line">    r &#x3D; requests.post(url &#x3D; url ,data&#x3D;param,headers &#x3D; headers)</span><br><span class="line">    print(r.content)</span><br><span class="line">    return r.content</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39; :</span><br><span class="line">    encrypt(&quot;onejane&quot;)</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503191723155.png" alt="image-20210503191723155"></p><p>apt install siege <a href="https://www.jianshu.com/p/74c465ff136f" target="_blank" rel="noopener">https://www.jianshu.com/p/74c465ff136f</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">siege -c5 -r10 &quot;http:&#x2F;&#x2F;192.168.0.103:8899 POST &lt;.&#x2F;iloveroysue.json &quot;   压测</span><br></pre></td></tr></table></figure><blockquote><p>iloveroysue.json</p><p>{</p><p>  “data”:”iloveroysue”</p><p>}</p></blockquote><p>adb forward tcp:8899 tcp:8899  将手机8899转发到电脑8899</p><p>siege -c5 -r10 “<a href="http://127.0.0.1:8899/" target="_blank" rel="noopener">http://127.0.0.1:8899</a> POST &lt;./iloveroysue.json “</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(uri.contains(&quot;encrypt&quot;))&#123;</span><br><span class="line">    result &#x3D; (String) XposedHelpers.callMethod(getActivity(), &quot;method01&quot;, paramBody);</span><br><span class="line">&#125;else if (uri.contains(&quot;decrypt&quot;))&#123;</span><br><span class="line">    result &#x3D; (String) XposedHelpers.callMethod(getActivity(), &quot;method02&quot;, paramBody);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    result &#x3D; paramBody;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>curl -s -X POST “<a href="http://192.168.0.103:8899/encrypt&quot;" target="_blank" rel="noopener">http://192.168.0.103:8899/encrypt&quot;</a> -d ‘{“data”:onejane}’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.example.demoso1 explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classsearch Session</span><br><span class="line">android hooking watch class fi.iki.elonen.NanoHTTPD$IHTTPSession   该类不在目标进程中，在xposed的classloader中，可以hook但是objection没有切classloader的功能</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503211850723.png" alt="image-20210503211850723"></p><h2 id="暴露公网"><a href="#暴露公网" class="headerlink" title="暴露公网"></a>暴露公网</h2><p>手机：npc   <code>file npc</code> 查看该文件格式基本信息，执行客户端命令暴露一个公网ip出去，端口为58899</p><p>服务器：nps </p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503221235226.png" alt="image-20210503221235226"></p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210503220423867.png" alt="image-20210503220423867"></p><p>curl -s -X POST  “<a href="http://118.126.66.193:58899/encrypt&quot;" target="_blank" rel="noopener">http://118.126.66.193:58899/encrypt&quot;</a> -d ‘{“data”:onejane}’</p><p>siege -c5 -r10 “<a href="http://118.126.66.193:8899/" target="_blank" rel="noopener">http://118.126.66.193:8899</a> POST &lt;./iloveroysue.json “</p><h1 id="案例movetv"><a href="#案例movetv" class="headerlink" title="案例movetv"></a>案例movetv</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore</span><br><span class="line">android hooking search classes MainActivity </span><br><span class="line">android hooking list class_methods com.cz.babySister.activity.MainActivity</span><br><span class="line">android hooking watch class com.cz.babySister.activity.MainActivity  将所有MainActivity的方法进行hook，做任意操作打印调用方法</span><br><span class="line">android hooking search classes loadedapk   搜索类名包括loadedapk的类</span><br><span class="line">plugin wallbreaker objectsearch android.app.LoadedApk   内存漫游查找android.app.LoadedApk</span><br><span class="line">plugin wallbreaker objectdump 0x240a  可视化内存中类的信息</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210504123451127.png" alt="image-20210504123451127"></p><p>jadx-gui Desktop/movetv.apk  腾讯加固</p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210504124146972.png" alt="image-20210504124146972"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;com.cz.babySister&quot;)) &#123;</span><br><span class="line">    Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;com.cz.babySister.activity.MainActivity&quot;);</span><br><span class="line"></span><br><span class="line">    XposedHelpers.findAndHookMethod(clazz, &quot;getJiFen&quot;, float.class, new XC_MethodHook() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            super.afterHookedMethod(param);</span><br><span class="line">            XposedBridge.log(&quot;float is &quot;+ String.valueOf( (float) param.args[0]));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210504125110937.png" alt="image-20210504125110937"></p><h2 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h2><p><a href="https://bbs.pediy.com/thread-246767.html" target="_blank" rel="noopener">使用frida来hook加固的Android应用的java层</a>，<a href="https://shuwoom.com/?p=142" target="_blank" rel="noopener">APP的启动过程</a>，<a href="https://bbs.pediy.com/thread-252284.html" target="_blank" rel="noopener">Android万能脱壳机</a>，<a href="https://bbs.pediy.com/thread-252630.html" target="_blank" rel="noopener">FART：ART环境下基于主动调用的自动化脱壳方案</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker objectsearch android.app.ActivityThread </span><br><span class="line">plugin wallbreaker objectdump --fullname 0x2a6a  取mInitialApplication的内存地址</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x10094e</span><br><span class="line">android hooking list class_methods java.lang.ClassLoader  有findClass方法</span><br></pre></td></tr></table></figure><p>首先，对于获取Classloader的时机点的选择。在第一节的App启动流程以及第三节中APP加壳原理和执行流程的介绍中，可以看到，APP中的Application类中的attachBaseContext和onCreate函数是app中最先执行的方法。壳都是通过替换APP的Application类并自己实现这两个函数，并在这两个函数中实现dex的解密加载，hook系统中Class和method加载执行流程中的关键函数，最后通过反射完成关键变量如最终的Classloader，Application等的替换从而完成执行权的交付。因此，我们可以选在任意一个在Application的onCreate函数执行之后才开始被调用的任意一个函数中。众所周知，对于一个正常的应用来说，最终都要由一个个的Activity来展示应用的界面并和用户完成交互，那么我们就可以选择在ActivityThread中的performLaunchActivity函数作为时机，来获取最终的应用的Classloader。选择该函数还有一个好处在于该函数和应用的最终的application同在ActivityThread类中，可以很方便获取到该类的成员。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</span><br><span class="line">        ......</span><br><span class="line">        </span><br><span class="line">Activity activity &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            java.lang.ClassLoader cl &#x3D; r.packageInfo.getClassLoader();</span><br><span class="line">&#x2F;&#x2F;下面通过application的getClassLoader()获取最终的Classloader，并开启线程，在新线程中完成内存中的dex的dump以及主动调用过程，由于该过程相对耗时，为了防止应用出现ANR，从而开启新线程，在新线程中进行，主要的工作都在getDexFilesByClassLoader_23</span><br><span class="line">            &#x2F;&#x2F;addstart</span><br><span class="line">            packagename&#x3D;r.packageInfo.getPackageName();</span><br><span class="line">            &#x2F;&#x2F;mInitialApplication</span><br><span class="line">            &#x2F;&#x2F;final java.lang.ClassLoader finalcl&#x3D;cl</span><br><span class="line">            if(mInitialApplication!&#x3D;null)&#123;</span><br><span class="line">            final java.lang.ClassLoader finalcl&#x3D;mInitialApplication.getClassLoader();</span><br><span class="line">            new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;              </span><br><span class="line">                                getDexFilesByClassLoader_23(finalcl);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;).start();</span><br><span class="line"> </span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F;addend</span><br><span class="line">          &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>wget <a href="https://github.com/hanbinglengyue/FART/blob/master/FART_6.0_sourcecode.zip" target="_blank" rel="noopener">https://github.com/hanbinglengyue/FART/blob/master/FART_6.0_sourcecode.zip</a>   套用FART_6.0_sourcecod/frameworks/base/core/java/android/app/ActivityThread.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">if (loadPackageParam.packageName.equals(&quot;com.cz.babySister&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">    XposedBridge.log(&quot; has Hooked!&quot;);</span><br><span class="line">    XposedBridge.log(&quot;inner  &#x3D;&gt; &quot; + loadPackageParam.processName);</span><br><span class="line"></span><br><span class="line">    Class ActivityThread &#x3D; XposedHelpers.findClass(&quot;android.app.ActivityThread&quot;,loadPackageParam.classLoader);</span><br><span class="line">    XposedBridge.hookAllMethods(ActivityThread, &quot;performLaunchActivity&quot;, new XC_MethodHook() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            super.afterHookedMethod(param);</span><br><span class="line">            Object mInitialApplication &#x3D; (Application) XposedHelpers.getObjectField(param.thisObject,&quot;mInitialApplication&quot;);</span><br><span class="line">            ClassLoader finalCL &#x3D; (ClassLoader) XposedHelpers.callMethod(mInitialApplication,&quot;getClassLoader&quot;);</span><br><span class="line">            XposedBridge.log(&quot;found classload is &#x3D;&gt; &quot;+finalCL.toString());</span><br><span class="line">            Class BabyMain &#x3D; (Class)XposedHelpers.callMethod(finalCL,&quot;findClass&quot;,&quot;com.cz.babySister.activity.MainActivity&quot;);</span><br><span class="line">            XposedBridge.log(&quot;found final class is &#x3D;&gt; &quot;+BabyMain.getName().toString());</span><br><span class="line">            fart(finalCL);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">public static Object invokeStaticMethod(String class_name,</span><br><span class="line">                                        String method_name, Class[] pareTyple, Object[] pareVaules) &#123;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Class obj_class &#x3D; Class.forName(class_name);</span><br><span class="line">        Method method &#x3D; obj_class.getMethod(method_name, pareTyple);</span><br><span class="line">        return method.invoke(null, pareVaules);</span><br><span class="line">    &#125; catch (SecurityException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static Object getFieldOjbect(String class_name, Object obj,</span><br><span class="line">                                    String filedName) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        Class obj_class &#x3D; Class.forName(class_name);</span><br><span class="line">        Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">        field.setAccessible(true);</span><br><span class="line">        return field.get(obj);</span><br><span class="line">    &#125; catch (SecurityException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static Field getClassField(ClassLoader classloader, String class_name,</span><br><span class="line">                                  String filedName) &#123;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Class obj_class &#x3D; classloader.loadClass(class_name);</span><br><span class="line">        Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">        field.setAccessible(true);</span><br><span class="line">        return field;</span><br><span class="line">    &#125; catch (SecurityException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static ClassLoader getClassloader() &#123;</span><br><span class="line">    ClassLoader resultClassloader &#x3D; null;</span><br><span class="line"></span><br><span class="line">    Object currentActivityThread &#x3D; invokeStaticMethod(</span><br><span class="line">            &quot;android.app.ActivityThread&quot;, &quot;currentActivityThread&quot;,</span><br><span class="line">            new Class[]&#123;&#125;, new Object[]&#123;&#125;);</span><br><span class="line">    Object mBoundApplication &#x3D; getFieldOjbect(</span><br><span class="line">            &quot;android.app.ActivityThread&quot;, currentActivityThread,</span><br><span class="line">            &quot;mBoundApplication&quot;);</span><br><span class="line">    Object loadedApkInfo &#x3D; getFieldOjbect(</span><br><span class="line">            &quot;android.app.ActivityThread$AppBindData&quot;,</span><br><span class="line">            mBoundApplication, &quot;info&quot;);</span><br><span class="line">    Application mApplication &#x3D; (Application) getFieldOjbect(&quot;android.app.LoadedApk&quot;, loadedApkInfo, &quot;mApplication&quot;);</span><br><span class="line">    resultClassloader &#x3D; mApplication.getClassLoader();</span><br><span class="line">    return resultClassloader;</span><br><span class="line">&#125;</span><br><span class="line">public static Object getClassFieldObject(ClassLoader classloader, String class_name, Object obj,</span><br><span class="line">                                         String filedName) &#123;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Class obj_class &#x3D; classloader.loadClass(class_name);</span><br><span class="line">        Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">        field.setAccessible(true);</span><br><span class="line">        Object result &#x3D; null;</span><br><span class="line">        result &#x3D; field.get(obj);</span><br><span class="line">        return result;</span><br><span class="line">    &#125; catch (SecurityException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public static void fart(ClassLoader clzloader) throws IOException &#123;</span><br><span class="line">    ClassLoader appClassloader &#x3D; clzloader;</span><br><span class="line">    List&lt;Object&gt; dexFilesArray &#x3D; new ArrayList&lt;Object&gt;();</span><br><span class="line">    Field pathList_Field &#x3D; (Field) getClassField(appClassloader, &quot;dalvik.system.BaseDexClassLoader&quot;, &quot;pathList&quot;);</span><br><span class="line">    Object pathList_object &#x3D; getFieldOjbect(&quot;dalvik.system.BaseDexClassLoader&quot;, appClassloader, &quot;pathList&quot;);</span><br><span class="line">    Object[] ElementsArray &#x3D; (Object[]) getFieldOjbect(&quot;dalvik.system.DexPathList&quot;, pathList_object, &quot;dexElements&quot;);</span><br><span class="line">    Field dexFile_fileField &#x3D; null;</span><br><span class="line">    try &#123;</span><br><span class="line">        dexFile_fileField &#x3D; (Field) getClassField(appClassloader, &quot;dalvik.system.DexPathList$Element&quot;, &quot;dexFile&quot;);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    Class DexFileClazz &#x3D; null;</span><br><span class="line">    try &#123;</span><br><span class="line">        DexFileClazz &#x3D; appClassloader.loadClass(&quot;dalvik.system.DexFile&quot;);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    Method getClassNameList_method &#x3D; null;</span><br><span class="line">    Method defineClass_method &#x3D; null;</span><br><span class="line">    Method dumpDexFile_method &#x3D; null;</span><br><span class="line">    Method dumpMethodCode_method &#x3D; null;</span><br><span class="line"></span><br><span class="line">    for (Method field : DexFileClazz.getDeclaredMethods()) &#123;</span><br><span class="line">        if (field.getName().equals(&quot;getClassNameList&quot;)) &#123;</span><br><span class="line">            getClassNameList_method &#x3D; field;</span><br><span class="line">            getClassNameList_method.setAccessible(true);</span><br><span class="line">        &#125;</span><br><span class="line">        if (field.getName().equals(&quot;defineClassNative&quot;)) &#123;</span><br><span class="line">            defineClass_method &#x3D; field;</span><br><span class="line">            defineClass_method.setAccessible(true);</span><br><span class="line">        &#125;</span><br><span class="line">        if (field.getName().equals(&quot;dumpMethodCode&quot;)) &#123;</span><br><span class="line">            dumpMethodCode_method &#x3D; field;</span><br><span class="line">            dumpMethodCode_method.setAccessible(true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Field mCookiefield &#x3D; getClassField(appClassloader, &quot;dalvik.system.DexFile&quot;, &quot;mCookie&quot;);</span><br><span class="line">    for (int j &#x3D; 0; j &lt; ElementsArray.length; j++) &#123;</span><br><span class="line">        Object element &#x3D; ElementsArray[j];</span><br><span class="line">        Object dexfile &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            dexfile &#x3D; (Object) dexFile_fileField.get(element);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        if (dexfile &#x3D;&#x3D; null) &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (dexfile !&#x3D; null) &#123;</span><br><span class="line">            dexFilesArray.add(dexfile);</span><br><span class="line">            Object mcookie &#x3D; getClassFieldObject(appClassloader, &quot;dalvik.system.DexFile&quot;, dexfile, &quot;mCookie&quot;);</span><br><span class="line">            if (mcookie &#x3D;&#x3D; null) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            String[] classnames &#x3D; null;</span><br><span class="line">            try &#123;</span><br><span class="line">                classnames &#x3D; (String[]) getClassNameList_method.invoke(dexfile, mcookie);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                continue;</span><br><span class="line">            &#125; catch (Error e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            if (classnames !&#x3D; null) &#123;</span><br><span class="line">                File file &#x3D; new File(&quot;&#x2F;sdcard&#x2F;Download&#x2F;dumpClass1122.txt&quot;);</span><br><span class="line">                if (!file.exists()) &#123;</span><br><span class="line">                    Log.d(&quot;TestFile&quot;, &quot;Create the file:&quot; );</span><br><span class="line">                    file.createNewFile();</span><br><span class="line">                &#125;</span><br><span class="line">                RandomAccessFile raf &#x3D; new RandomAccessFile(file, &quot;rw&quot;);</span><br><span class="line">                raf.seek(file.length());</span><br><span class="line"></span><br><span class="line">                for (String eachclassname : classnames) &#123;</span><br><span class="line">                    String log &#x3D; &quot;ClassNameis::&quot; +eachclassname +&quot;  :: &quot;+ dumpMethodCode_method +&quot;::&quot;+appClassloader.toString() +&quot;\n&quot;;</span><br><span class="line">                    raf.write(log.getBytes());</span><br><span class="line">                    Log.i(&quot;classes&#x3D;&gt;&quot;,log);</span><br><span class="line">                &#125;</span><br><span class="line">                raf.close();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cat dumpClass1122.txt |grep MainActivity   脱壳拿到类包括子类，完成trace到classloader所有类的功能</p><p><img src="/2021/05/01/Xposed%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%BC%80%E5%8F%91/image-20210504161102667.png" alt="image-20210504161102667"></p><ul><li><a href="https://bbs.pediy.com/thread-218798.html" target="_blank" rel="noopener">安卓逆向之基于Xposed-ZjDroid脱壳</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xposed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之房天下pwd</title>
      <link href="2021/04/29/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%88%BF%E5%A4%A9%E4%B8%8Bpwd/"/>
      <url>2021/04/29/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%88%BF%E5%A4%A9%E4%B8%8Bpwd/</url>
      
        <content type="html"><![CDATA[<p><a href="https://passport.fang.com/?backurl=https://suzhou.fang.com/" target="_blank" rel="noopener">https://passport.fang.com/?backurl=https%3A%2F%2Fsuzhou.fang.com%2F</a></p><h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>POST <a href="https://passport.fang.com/login.api" target="_blank" rel="noopener">https://passport.fang.com/login.api</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uid: 15806204095@163.com</span><br><span class="line">pwd: 3854d2ef8cc2455ed263a3a697414c6f59043010efba9b24da93c6596123fee5fded0d948bc9148beaa5f58756817725617bb3c09ade11e5586e6430392a27db28005ebcfc442d8cf64c0369d439b17011c88e89a57914d78f45a7bba9a7c9e95b75e9fcb4cccbc4c6d65b3e0d3257d183ff2ba35bf3eb70e6bf0b50d4ffdaa1</span><br><span class="line">Service: soufun-passport-web</span><br><span class="line">AutoLogin: 1</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>搜索login.api，并打上断点，重新登录时可以知道pwd是由key_to_encode和我们输入的密码<code>123456</code>经过encryptedString函数生成<img src="/2021/04/29/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%88%BF%E5%A4%A9%E4%B8%8Bpwd/image-20210429173847817.png" alt="image-20210429173847817"></p><p>搜索key_to_encode，通过RSAKeyPair构造函数返回key_to_encode</p><p><img src="/2021/04/29/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%88%BF%E5%A4%A9%E4%B8%8Bpwd/image-20210429174305829.png" alt="image-20210429174305829"></p><p>进入RSAKeyPair的构造函数中，正好encryptedString方法也在其中，我们将整个RSA.min.js:formatted拷贝下来命名fang.js，添加新方法getpwd，实现通过传入的<code>123456</code>加密生成pwd。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function getpwd(pwd) &#123;</span><br><span class="line">    var key_to_encode &#x3D; new RSAKeyPair(&quot;010001&quot;, &quot;&quot;, &quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;);</span><br><span class="line">    return encryptedString(key_to_encode, pwd)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>拷贝参数到sublime中，使用ctrl+H正则替换功能将<code>(.*?):\s(.*?)\n </code>改成<code>&#39;$1&#39;:&#39;$2&#39;,\n</code>,或者通过请求头加参数.py修改格式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uid: 15806204095@163.com</span><br><span class="line">pwd: 3854d2ef8cc2455ed263a3a697414c6f59043010efba9b24da93c6596123fee5fded0d948bc9148beaa5f58756817725617bb3c09ade11e5586e6430392a27db28005ebcfc442d8cf64c0369d439b17011c88e89a57914d78f45a7bba9a7c9e95b75e9fcb4cccbc4c6d65b3e0d3257d183ff2ba35bf3eb70e6bf0b50d4ffdaa1</span><br><span class="line">Service: soufun-passport-web</span><br><span class="line">AutoLogin: 1</span><br></pre></td></tr></table></figure><p>接下来再通过exec执行扣下的js并利用requests库实现post请求完成登录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def get_pwd():</span><br><span class="line">    with open(&quot;fang.js&quot;, &quot;r&quot;) as f:</span><br><span class="line">        js_code &#x3D; f.read()</span><br><span class="line">    results &#x3D; execjs.compile(js_code).call(&quot;getpwd&quot;, password)</span><br><span class="line">    return results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def login():</span><br><span class="line">    url &#x3D; &#39;https:&#x2F;&#x2F;passport.fang.com&#x2F;login.api&#39;</span><br><span class="line">    pwd &#x3D; get_pwd()</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &#39;uid&#39;: account,</span><br><span class="line">        &#39;pwd&#39;: pwd,</span><br><span class="line">        &#39;Service&#39;: &#39;soufun-passport-web&#39;,</span><br><span class="line">        &#39;AutoLogin&#39;: &#39;1&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.111 Safari&#x2F;537.36&#39;,</span><br><span class="line">        &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,</span><br><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded; charset&#x3D;UTF-8&#39;,</span><br><span class="line">        &#39;Host&#39;: &#39;passport.fang.com&#39;,</span><br><span class="line">        &#39;Origin&#39;: &#39;https:&#x2F;&#x2F;passport.fang.com&#39;,</span><br><span class="line">        &#39;Pragma&#39;: &#39;no-cache&#39;,</span><br><span class="line">        &#39;Referer&#39;: &#39;https:&#x2F;&#x2F;passport.fang.com&#x2F;?backurl&#x3D;https%3A%2F%2Fsuzhou.fang.com%2F&#39;,</span><br><span class="line">        &#39;Sec-Fetch-Dest&#39;: &#39;empty&#39;,</span><br><span class="line">        &#39;Sec-Fetch-Mode&#39;: &#39;cors&#39;,</span><br><span class="line">        &#39;Sec-Fetch-Site&#39;: &#39;same-origin&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">    response &#x3D; requests.post(url, data, headers&#x3D;headers)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    login()</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之多途径抓取失信人名单</title>
      <link href="2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/"/>
      <url>2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>继<a href="https://blog.csdn.net/welggy/article/details/116023394?spm=1001.2014.3001.5501" target="_blank" rel="noopener">爬虫基础篇之Scrapy抓取京东</a>之后，我们对scrapy有了一定的掌握，接下来通过多渠道汇总对失信人信息抓取入库。</p><ol><li>抓取百度失信人名单</li><li>抓取最高人民法院失信人名单</li><li>抓取国家企业信用公示系统失信人公告</li><li>把上面三个来源的失信人信息进行合并,去重</li></ol><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><h3 id="百度"><a href="#百度" class="headerlink" title="百度"></a>百度</h3><ul><li><p>搜索失信人名单</p></li><li><p>抓取数据:  失信人名称, 失信人号码,法人(企业),  年龄(企业的年龄为0), 区域,失信内容, 公布日期, 公布执行单位, 创建日期, 更新日期</p></li></ul><p><img src="/2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/image-20210427202346052.png" alt="image-20210427202346052"></p><h3 id="企业信用信息公示系统"><a href="#企业信用信息公示系统" class="headerlink" title="企业信用信息公示系统"></a>企业信用信息公示系统</h3><ul><li>访问<a href="http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html" target="_blank" rel="noopener">http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html</a></li><li>抓取: 失信人名称, 失信人号码,  年龄(企业的年龄为0), 区域,  失信内容, 公布日期, 公布单位,  类型(个人/企业), 创建日期, 更新日期</li></ul><p><img src="/2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/image-20210427202703732.png" alt="image-20210427202703732"></p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><ul><li>把抓取的数据, 统一存储到同一个数据库的, 同一张表中.</li><li>如何去重?<ul><li>对于个人: 根据失信人号码, 检查一下, 如果不存在才插入.</li><li>对于企业/组织: <ul><li>失信人证件号, 有的是组织机构代码, 有的是信用号, 企业信用信息公示系统的失信人公告有的没有证件号, 所以无法进行准确判断.</li><li>区域 和 企业名称进行检查, 如果有就重复了, 没有才插入. </li></ul></li></ul></li></ul><h1 id="百度-1"><a href="#百度-1" class="headerlink" title="百度"></a>百度</h1><p><code>scrapy startproject dishonest</code>  创建爬虫项目</p><h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p>定义数据模型继承自scrapy.Item的数据模型DishonestItem</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class DishonestItem(scrapy.Item):</span><br><span class="line">    # define the fields for your item here like:</span><br><span class="line">    # 失信人名称</span><br><span class="line">    name &#x3D; scrapy.Field()</span><br><span class="line">    # 失信人证件号</span><br><span class="line">    card_num &#x3D; scrapy.Field()</span><br><span class="line">    # 失信人年龄, 企业年龄都是0</span><br><span class="line">    age &#x3D; scrapy.Field()</span><br><span class="line">    # 区域</span><br><span class="line">    area &#x3D; scrapy.Field()</span><br><span class="line">    # 法人(企业)</span><br><span class="line">    business_entity &#x3D; scrapy.Field()</span><br><span class="line">    # 失信内容</span><br><span class="line">    content &#x3D; scrapy.Field()</span><br><span class="line">    # 公布日期</span><br><span class="line">    publish_date &#x3D; scrapy.Field()</span><br><span class="line">    # 公布&#x2F;执行单位</span><br><span class="line">    publish_unit &#x3D; scrapy.Field()</span><br><span class="line">    # 创建日期</span><br><span class="line">    create_date &#x3D; scrapy.Field()</span><br><span class="line">    # 更新日期</span><br><span class="line">    update_date &#x3D; scrapy.Field()</span><br></pre></td></tr></table></figure><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>通过翻页发起请求，在控制台的All请求下出现了<code>https://sp0.baidu.com/8aQDcjqpAAV3otqbppnN2DJv/api.php?resource_id=6899&amp;query=失信人名单&amp;pn=0&amp;ie=utf-8&amp;oe=utf-8&amp;format=json</code>的目标地址</p><p>参数:</p><ul><li>resource_id=6899: 资源id, 固定值</li><li>query=失信人名单: 查询内容, 固定值</li><li>pn=0: 数据起始号码</li><li>ie=utf-8&amp;oe=utf-8: 指定数据的编码方式, 固定值</li><li>format=json: 数据格式, 固定值</li></ul><p>我们可以根据第一次请求, 获取到总的数据条数, 生成所有页面的URL. </p><p><img src="/2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/image-20210427203819189.png" alt="image-20210427203819189"></p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url &#x3D; &#39;https:&#x2F;&#x2F;sp0.baidu.com&#x2F;8aQDcjqpAAV3otqbppnN2DJv&#x2F;api.php?resource_id&#x3D;6899&amp;query&#x3D;失信人&amp;pn&#x3D;10&amp;rn&#x3D;10&amp;ie&#x3D;utf-8&amp;oe&#x3D;utf-8&#39;</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;70.0.3538.110 Safari&#x2F;537.36&#39;,</span><br><span class="line">    &#39;Referer&#39;: &#39;https:&#x2F;&#x2F;www.baidu.com&#x2F;s?ie&#x3D;UTF-8&amp;wd&#x3D;%E5%A4%B1%E4%BF%A1%E4%BA%BA&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response &#x3D; requests.get(url, headers&#x3D;headers)</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.content.decode())</span><br></pre></td></tr></table></figure><p><img src="/2021/04/27/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E9%80%94%E5%BE%84%E6%8A%93%E5%8F%96%E5%A4%B1%E4%BF%A1%E4%BA%BA%E5%90%8D%E5%8D%95/image-20210427204510667.png" alt="image-20210427204510667"></p><h2 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h2><ol><li>设置默认请求头, 在<code>settings.py</code>文件中</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_REQUEST_HEADERS &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;70.0.3538.110 Safari&#x2F;537.36&#39;,</span><br><span class="line">    &#39;Referer&#39;: &#39;https:&#x2F;&#x2F;www.baidu.com&#x2F;s?ie&#x3D;UTF-8&amp;wd&#x3D;%E5%A4%B1%E4%BF%A1%E4%BA%BA&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>scrapy genspider baidu baidu.com</code>  创建爬虫</li><li>分页实现</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">class BaiduSpider(scrapy.Spider):</span><br><span class="line">    name &#x3D; &#39;baidu&#39;</span><br><span class="line">    allowed_domains &#x3D; [&#39;baidu.com&#39;]</span><br><span class="line">    start_urls &#x3D; [&#39;https:&#x2F;&#x2F;sp0.baidu.com&#x2F;8aQDcjqpAAV3otqbppnN2DJv&#x2F;api.php?resource_id&#x3D;6899&amp;query&#x3D;失信人&amp;pn&#x3D;0&amp;rn&#x3D;10&amp;ie&#x3D;utf-8&amp;oe&#x3D;utf-8&#39;]</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        # 构建所有页面请求</span><br><span class="line">        # 把响应内容的json字符串, 转为字典</span><br><span class="line">        results &#x3D; json.loads(response.text)</span><br><span class="line">        # 取出总数据条数</span><br><span class="line">        disp_num &#x3D; jsonpath(results, &#39;$..dispNum&#39;)[0]</span><br><span class="line">        # print(disp_num)</span><br><span class="line">        # URL模板</span><br><span class="line">        url_pattern &#x3D; &#39;https:&#x2F;&#x2F;sp0.baidu.com&#x2F;8aQDcjqpAAV3otqbppnN2DJv&#x2F;api.php?resource_id&#x3D;6899&amp;query&#x3D;失信人&amp;pn&#x3D;&#123;&#125;&amp;rn&#x3D;10&amp;ie&#x3D;utf-8&amp;oe&#x3D;utf-8&#39;</span><br><span class="line">        # 每隔10条数据, 构建一个请求</span><br><span class="line">        for pn in range(0, disp_num, 10):</span><br><span class="line">            # 构建URL</span><br><span class="line">            url &#x3D; url_pattern.format(pn)</span><br><span class="line">            # 创建请求, 交给引擎</span><br><span class="line">            yield scrapy.Request(url, callback&#x3D;self.parse_data)</span><br><span class="line"></span><br><span class="line">    def parse_data(self, response):</span><br><span class="line">        &quot;&quot;&quot;解析数据&quot;&quot;&quot;</span><br><span class="line">        # 响应数据</span><br><span class="line">        datas &#x3D; json.loads(response.text)</span><br><span class="line">        results &#x3D; jsonpath(datas, &#39;$..result&#39;)[0]</span><br><span class="line">        # 遍历结果列表</span><br><span class="line">        for result in results:</span><br><span class="line">            item &#x3D; DishonestItem()</span><br><span class="line">            #  失信人名称</span><br><span class="line">            item[&#39;name&#39;] &#x3D; result[&#39;iname&#39;]</span><br><span class="line">            # 失信人号码</span><br><span class="line">            item[&#39;card_num&#39;] &#x3D; result[&#39;cardNum&#39;]</span><br><span class="line">            # 失信人年龄</span><br><span class="line">            item[&#39;age&#39;] &#x3D; int(result[&#39;age&#39;])</span><br><span class="line">            # 区域</span><br><span class="line">            item[&#39;area&#39;] &#x3D; result[&#39;areaName&#39;]</span><br><span class="line">            # 法人(企业)</span><br><span class="line">            item[&#39;business_entity&#39;] &#x3D; result[&#39;businessEntity&#39;]</span><br><span class="line">            # 失信内容</span><br><span class="line">            item[&#39;content&#39;] &#x3D; result[&#39;duty&#39;]</span><br><span class="line">            # 公布日期</span><br><span class="line">            item[&#39;publish_date&#39;] &#x3D; result[&#39;publishDate&#39;]</span><br><span class="line">            # 公布&#x2F;执行单位</span><br><span class="line">            item[&#39;publish_unit&#39;] &#x3D; result[&#39;courtName&#39;]</span><br><span class="line">            # 创建日期</span><br><span class="line">            item[&#39;create_date&#39;] &#x3D; datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">            # 更新日期</span><br><span class="line">            item[&#39;update_date&#39;] &#x3D; datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">            # print(item)</span><br><span class="line">            # 把数据交给引擎</span><br><span class="line">            yield item</span><br></pre></td></tr></table></figure><h2 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h2><ol><li>创建数据库表</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> -- 创建数据库</span><br><span class="line">create database dishonest;</span><br><span class="line">-- 如果表存在就删除</span><br><span class="line">drop table if exists dishonest;</span><br><span class="line">-- 创建表</span><br><span class="line">create table dishonest(</span><br><span class="line">dishonest_id INT NOT NULL AUTO_INCREMENT, -- id主键</span><br><span class="line">age INT NOT NULL, -- 年龄, 自然人年龄都是&gt;0的, 企业的年龄等于0</span><br><span class="line">name VARCHAR(200) NOT NULL,   -- 失信人名称</span><br><span class="line">card_num VARCHAR(50) , -- 失信人号码</span><br><span class="line">area VARCHAR(50) NOT NULL, -- 区域</span><br><span class="line">content VARCHAR(2000) NOT NULL, -- 失信内容</span><br><span class="line">business_entity VARCHAR(20), -- 企业法人</span><br><span class="line">publish_unit VARCHAR(200),  -- 发布单位</span><br><span class="line">publish_date VARCHAR(20),  -- 发布单位</span><br><span class="line">create_date DATETIME, -- 创建日期</span><br><span class="line">update_date DATETIME, -- 更新日期</span><br><span class="line">PRIMARY KEY (dishonest_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ol start="2"><li>在settings中配置数据库信息</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 配置MYSQL</span><br><span class="line"># MYSQL的主机IP地址</span><br><span class="line">MYSQL_HOST &#x3D; &#39;127.0.0.1&#39;</span><br><span class="line"># MYSQL端口号</span><br><span class="line">MYSQL_PORT &#x3D; 3306</span><br><span class="line"># MYSQL用户名</span><br><span class="line">MYSQL_USER &#x3D; &#39;root&#39;</span><br><span class="line"># MYSQL密码</span><br><span class="line">MYSQL_PASSWORD &#x3D; &#39;&#39;</span><br><span class="line"># MYSQL数据库名</span><br><span class="line">MYSQL_DB &#x3D; &#39;dishonest&#39;</span><br></pre></td></tr></table></figure><ol start="3"><li>使用pipeline存储数据到mysql</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">class DishonestListPipeline(object):</span><br><span class="line"></span><br><span class="line">        def open_spider(self, spider):</span><br><span class="line">            # 创建数据链接</span><br><span class="line">            self.connect &#x3D; pymysql.connect(host&#x3D;&quot;127.0.0.1&quot;,user&#x3D;&quot;root&quot;, password&#x3D;&quot;123&quot;,</span><br><span class="line">                                db&#x3D;&quot;dishonest&quot;,port&#x3D;3306)</span><br><span class="line">            # 获取执行SQL的cursor</span><br><span class="line">            self.cursor &#x3D; self.connect.cursor()</span><br><span class="line">        </span><br><span class="line">        def close_spider(self, spider):</span><br><span class="line">                    # 释放游标</span><br><span class="line">                    self.cursor.close()</span><br><span class="line">                    # 释放链接</span><br><span class="line">                    self.connect.close()</span><br><span class="line"></span><br><span class="line">        def process_item(self, item, spider):</span><br><span class="line">           </span><br><span class="line">            if item[&#39;age&#39;] &#x3D;&#x3D; 0:</span><br><span class="line">                # 如果年龄 &#x3D;&#x3D; 0 , 就是企业, 就根据公司名和区域进行查询</span><br><span class="line">                name &#x3D; item[&#39;name&#39;]</span><br><span class="line">                area_name &#x3D; item[&#39;area&#39;]</span><br><span class="line">                select_sql &#x3D; &quot;select count(1) from t_dishonest where name&#x3D;&#39;&#123;&#125;&#39; and area &#x3D; &#39;&#123;&#125;&#39;&quot;.format(name, area)</span><br><span class="line">            else:</span><br><span class="line">                # 如果是个人根据证件号, 数据条数</span><br><span class="line">                select_sql &#x3D; &quot;select count(1) from t_dishonest where card_num&#x3D;&#39;&#123;&#125;&#39;&quot;.format(item[&#39;card_num&#39;] )</span><br><span class="line"></span><br><span class="line">            # 根据证件号, 数据条数</span><br><span class="line">            select_sql &#x3D; &quot;select count(1) from dishonest where card_num&#x3D;&#39;&#123;&#125;&#39;&quot;.format(item[&#39;card_num&#39;])</span><br><span class="line">            # 执行查询SQL</span><br><span class="line">            self.cursor.execute(select_sql)</span><br><span class="line">            # 获取查询结果</span><br><span class="line">            count &#x3D; self.cursor.fetchone()[0]</span><br><span class="line">            # 如果查询的数量为0, 说明该人不存在, 不存在就插入</span><br><span class="line">            if count &#x3D;&#x3D; 0:</span><br><span class="line">                # 获取当前的时间, 为插入数据库的时间</span><br><span class="line">                item[&#39;create_date&#39;] &#x3D; datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">                item[&#39;update_date&#39;] &#x3D; datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">                # 把数据转换为键, 值的格式, 方便插入数据库</span><br><span class="line">                keys, values &#x3D; zip(*dict(item).items())</span><br><span class="line">                # 插入数据库SQL</span><br><span class="line">                insert_sql &#x3D; &#39;insert into dishonest (&#123;&#125;) values(&#123;&#125;)&#39;.format(</span><br><span class="line">                    &#39;,&#39;.join(keys),</span><br><span class="line">                    &#39;,&#39;.join([&#39;%s&#39;] * len(values))</span><br><span class="line">                )</span><br><span class="line">                # 执行插入数据SQL</span><br><span class="line">                self.cursor.execute(insert_sql, values)</span><br><span class="line">                # 提交</span><br><span class="line">                self.connect.commit()</span><br><span class="line">            else:</span><br><span class="line">                spider.logger.info(&#39;&#123;&#125;  重复&#39;.format(item))</span><br><span class="line"></span><br><span class="line">            return item</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    pipeline &#x3D;  DishonestListPipeline()</span><br><span class="line">    pipeline.open_spider(&#39;xx&#39;)</span><br><span class="line">    item &#x3D; &#123;</span><br><span class="line">        &#39;card_num&#39;: &#39;12345&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    pipeline.process_item(item, &#39;&#39;)</span><br></pre></td></tr></table></figure><h2 id="随机User-Agent反反爬"><a href="#随机User-Agent反反爬" class="headerlink" title="随机User-Agent反反爬"></a>随机User-Agent反反爬</h2><ol><li>在settings.py中添加USER_AGENTS列表</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">USER_AGENTS &#x3D; [</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident&#x2F;4.0; WOW64; Trident&#x2F;4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit&#x2F;523.15 (KHTML, like Gecko, Safari&#x2F;419.3) Arora&#x2F;0.3 (Change: 287 c9dfb30)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux; en-US) AppleWebKit&#x2F;527+ (KHTML, like Gecko, Safari&#x2F;419.3) Arora&#x2F;0.6&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko&#x2F;20070215 K-Ninja&#x2F;2.1.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko&#x2F;20080705 Firefox&#x2F;3.0 Kapiko&#x2F;3.0&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; Linux i686; U;) Gecko&#x2F;20070322 Kazehakase&#x2F;0.4.5&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora&#x2F;1.9.0.8-1.fc10 Kazehakase&#x2F;0.5.6&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;535.11 (KHTML, like Gecko) Chrome&#x2F;17.0.963.56 Safari&#x2F;535.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit&#x2F;535.20 (KHTML, like Gecko) Chrome&#x2F;19.0.1036.7 Safari&#x2F;535.20&quot;,</span><br><span class="line">    &quot;Opera&#x2F;9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto&#x2F;2.9.168 Version&#x2F;11.52&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;536.11 (KHTML, like Gecko) Chrome&#x2F;20.0.1132.11 TaoBrowser&#x2F;2.0 Safari&#x2F;536.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.71 Safari&#x2F;537.1 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;535.11 (KHTML, like Gecko) Chrome&#x2F;17.0.963.84 Safari&#x2F;535.11 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser&#x2F;7.0.3698.400)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 5.1) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.89 Safari&#x2F;537.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.89 Safari&#x2F;537.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit&#x2F;533.17.9 (KHTML, like Gecko) Version&#x2F;5.0.2 Mobile&#x2F;8C148 Safari&#x2F;6533.18.5&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko&#x2F;20110307 Firefox&#x2F;4.0b13pre&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko&#x2F;20100101 Firefox&#x2F;16.0&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.11 (KHTML, like Gecko) Chrome&#x2F;23.0.1271.64 Safari&#x2F;537.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko&#x2F;20100922 Ubuntu&#x2F;10.10 (maverick) Firefox&#x2F;3.6.10&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ol start="2"><li>实现随机User-Agent下载器中间件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class RandomUserAgent(object):</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        # 如果spider是公示系统爬虫, 就直接跳过</span><br><span class="line">        if isinstance(spider, GsxtSpider):</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">        #  3. 实现process_request方法, 设置随机的User-Agent</span><br><span class="line">        request.headers[&#39;User-Agent&#39;] &#x3D; random.choice(USER_AGENTS)</span><br><span class="line">        return None</span><br></pre></td></tr></table></figure><ol start="3"><li>settings.py中开启中间件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 开启下载器中间件</span><br><span class="line">DOWNLOADER_MIDDLEWARES &#x3D; &#123;</span><br><span class="line">    &#39;dishonest.dishonest.middlewares.RandomUserAgent&#39;: 543,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代理IP反反爬"><a href="#代理IP反反爬" class="headerlink" title="代理IP反反爬"></a>代理IP反反爬</h2><p>实现代理IP下载器中间件，在settings.py中开启, 并配置重试次数，继<a href="https://blog.csdn.net/welggy/article/details/115358013?spm=1001.2014.3001.5501" target="_blank" rel="noopener">爬虫基础篇之IP代理池</a>实现的动态IP代理池启动用于本次失信人抓取。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class ProxyMiddleware(object):</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        # 实现process_request方法, 设置代理IP</span><br><span class="line">        # 如果spider是公示系统爬虫, 就直接跳过</span><br><span class="line">        if isinstance(spider, GsxtSpider):</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">        # 1. 获取协议头</span><br><span class="line">        protocol &#x3D; request.url.split(&#39;:&#x2F;&#x2F;&#39;)[0]</span><br><span class="line">        # 2. 构建代理IP请求的URL</span><br><span class="line">        proxy_url &#x3D; &#39;http:&#x2F;&#x2F;localhost:16888&#x2F;random?protocol&#x3D;&#123;&#125;&#39;.format(protocol)</span><br><span class="line">        # 3. 发送请求, 获取代理IP</span><br><span class="line">        response &#x3D; requests.get(proxy_url)</span><br><span class="line">        # 4. 把代理IP设置给request.meta[&#39;proxy&#39;]</span><br><span class="line">        request.meta[&#39;proxy&#39;] &#x3D; response.content.decode()</span><br><span class="line"></span><br><span class="line">        return None</span><br></pre></td></tr></table></figure><p>配置代理池中间件及重试次数(毕竟免费ip不稳定)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 开启下载器中间件</span><br><span class="line">DOWNLOADER_MIDDLEWARES &#x3D; &#123;</span><br><span class="line">   &#39;dishonest.dishonest.middlewares.ProxyMiddleware&#39;: 500,</span><br><span class="line">   &#39;dishonest.dishonest.middlewares.RandomUserAgent&#39;: 543,</span><br><span class="line">&#125;</span><br><span class="line"># 配置重试次数, 当使用不稳定代理的时候,可能会导致请求失败</span><br><span class="line">RETRY_TIMES &#x3D; 6</span><br></pre></td></tr></table></figure><p>![百度爬虫](爬虫基础篇之多途径抓取失信人名单/GIF 2021-4-27 22-15-36.gif)</p><h1 id="国家企业信用公示系统"><a href="#国家企业信用公示系统" class="headerlink" title="国家企业信用公示系统"></a>国家企业信用公示系统</h1><p>继<a href="https://blog.csdn.net/welggy/article/details/116175773?spm=1001.2014.3001.5501" target="_blank" rel="noopener">JS逆向之国家企业信用信息公示系统Cookie传递</a>完成了cookie的逆向分析，本文利用Cookie的实现逻辑，在scrapy中实现公示系统的爬虫入库。</p><p><code>scrapy genspider gsxt gsxt.gov.cn</code>  创建爬虫</p><p>准备起始URL, 打印响应内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class GsxtSpider(scrapy.Spider):</span><br><span class="line">    name &#x3D; &#39;gsxt&#39;</span><br><span class="line">    allowed_domains &#x3D; [&#39;gsxt.gov.cn&#39;]</span><br><span class="line">    # 准备起始</span><br><span class="line">    start_urls &#x3D; [&#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;corp-query-entprise-info-xxgg-100000.html&#39;]</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        # 打印状态吗</span><br><span class="line">        print(response.status)</span><br><span class="line">        # 内容</span><br><span class="line">        print(response.text)</span><br></pre></td></tr></table></figure><p>修改原来的随机User-Agent, 和随机代理的下载器中间件类, 如果是<code>公示系统</code>爬虫直接跳过.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 随机User-Agent下载器中间件</span><br><span class="line">class RandomUserAgent(object):</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line"></span><br><span class="line">        # 国家企业信用信息系统爬虫, 每次发送请求必须携带cookie信息</span><br><span class="line">        if isinstance(spider, GsxtSpider):</span><br><span class="line">            return</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"># 代理下载器中间件</span><br><span class="line">class ProxyMiddleware(object):</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        # 发送请求获取代理IP</span><br><span class="line">        # 如果是国家企业信用信息系统爬虫, 直接返回 </span><br><span class="line">        if isinstance(spider, GsxtSpider):</span><br><span class="line">            return</span><br></pre></td></tr></table></figure><h2 id="定制cookie"><a href="#定制cookie" class="headerlink" title="定制cookie"></a>定制cookie</h2><p>为了实现代理IP, User-Agent, cookie信息生成, 绑定和重用，实现步骤如下：</p><ul><li><p><code>步骤</code>:</p><ul><li>实现生成cookie的脚本<ul><li>用于生成多套代理IP, User-Agent, Cookie信息, 放到Redis</li></ul></li><li>实现公示系统中间件类, <ul><li>实现<code>process_request</code>方法, 从Redis中随机取出Cookie来使用, 关闭页面重定向. </li><li>实现<code>process_response</code>方法, 如果响应码不是200 或 没有内容重试</li><li>在setting.py文件件中配置, 开启该下载器中间</li></ul></li></ul></li><li><p>实现生成cookie的脚本</p><ul><li>创建<code>gen_gsxt_cookies.py</code>文件, 在其中创建<code>GenGsxtCookie</code>的类</li><li>实现一个方法, 用于把一套代理IP, User-Agent, Cookie绑定在一起的信息放到Redis的list中<ul><li>随机获取一个User-Agent</li><li>随机获取一个代理IP</li><li>获取request的session对象</li><li>把User-Agent, 通过请求头, 设置给session对象</li><li>把代理IP, 通过proxies, 设置给session对象</li><li>使用session对象, 发送请求, 获取需要的cookie信息</li><li>把代理IP, User-Agent, Cookie放到字典中, 序列化后, 存储到Redis的list中</li></ul></li><li>实现一个run方法, 用于开启多个异步来执行这个方法. </li><li><code>注</code>: 为了和下载器中间件交互方便, 需要在settings.py中配置一些常量.</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">def push_cookie_to_redis(self):</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            2. 实现一个方法, 用于把一套代理IP, User-Agent, Cookie绑定在一起的信息放到Redis的list中</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            # 1. 随机获取一个User-Agent</span><br><span class="line">            user_agent &#x3D; random.choice(USER_AGENTS)</span><br><span class="line">            # 2. 随机获取一个代理IP</span><br><span class="line">            # response &#x3D; requests.get(&#39;http:&#x2F;&#x2F;localhost:16888&#x2F;random?protocol&#x3D;http&#39;)</span><br><span class="line">            # proxy &#x3D; response.content.decode()</span><br><span class="line">            # 3. 获取requests的session对象</span><br><span class="line">            session &#x3D; requests.session()</span><br><span class="line">            # 4. 把User-Agent, 通过请求头, 设置给session对象</span><br><span class="line">            session.headers &#x3D; &#123;</span><br><span class="line">                &#39;User-Agent&#39;: user_agent</span><br><span class="line">            &#125;</span><br><span class="line">            # 5. 把代理IP, 通过proxies, 设置给session对象</span><br><span class="line">            # session.proxies &#x3D; &#123;</span><br><span class="line">            #     &#39;http&#39;: proxy</span><br><span class="line">            # &#125;</span><br><span class="line">            # 6. 使用session对象, 发送请求, 获取需要的cookie信息</span><br><span class="line">            index_url &#x3D; &#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;corp-query-entprise-info-xxgg-100000.html&#39;</span><br><span class="line">            # 获取request的session对象, 可以自动合并cookie信息</span><br><span class="line"></span><br><span class="line">            # ######################################################使用session发送index_url请求###########################</span><br><span class="line">            response &#x3D; session.get(index_url)</span><br><span class="line">            print(response.status_code)</span><br><span class="line">            # 第一次请求521 服务器借助这个请求设置一个Set-Cookie: __jsluid_h&#x3D;8af7a39f7cdb1c46f8f624c972968c8f; max-age&#x3D;31536000; path&#x3D;&#x2F;; HttpOnly到本地，并返回一段js</span><br><span class="line">            ########################################################拿到第一个cookie########################</span><br><span class="line">            # 1. 提取script标签中的js</span><br><span class="line">            js1 &#x3D; re.findall(&#39;&lt;script&gt;(.+?)&lt;&#x2F;script&gt;&#39;, response.content.decode())[0].replace(&#39;document.cookie&#x3D;&#39;,</span><br><span class="line">                                                                                             &#39;&#39;).replace(</span><br><span class="line">                &#39;location.href&#x3D;location.pathname+location.search&#39;, &#39;&#39;)</span><br><span class="line">            context &#x3D; js2py.EvalJs()</span><br><span class="line">            ###################################################根据第一个请求返回的js生成第二个cookie###############################</span><br><span class="line">            context.execute(&#39;cookies2 &#x3D;&#39; + js1)</span><br><span class="line">            cookies &#x3D; context.cookies2.split(&#39;;&#39;)[0].split(&#39;&#x3D;&#39;)</span><br><span class="line">            session.cookies.set(cookies[0], cookies[1])  # 到此拿到第两个cookie</span><br><span class="line">            ######################################################拿到第二个cookie############################</span><br><span class="line"></span><br><span class="line">            # 第二次请求携带Cookie: __jsluid_h&#x3D;6ed2648e0a734bc66e3011d648f6f1ab; __jsl_clearance&#x3D;1619152879.013|-1|aS3lFknWlGtD%2FADiygf7vxl4yqk%3D返回一段js</span><br><span class="line">            # 添加jsdom实现浏览器上下文</span><br><span class="line">            js2 &#x3D; &#39;&#39;&#39;const jsdom &#x3D; require(&quot;jsdom&quot;);const &#123;JSDOM&#125; &#x3D; jsdom;const dom &#x3D; new JSDOM();window &#x3D; dom.window;document &#x3D; window.document;location &#x3D; new Array();&#39;&#39;&#39; + \</span><br><span class="line">                  re.findall(&#39;&lt;script&gt;(.+?)&lt;&#x2F;script&gt;&#39;, session.get(index_url).content.decode(&#39;utf-8&#39;))[0]</span><br><span class="line">            # 正则获取document[&#39;cookie&#39;]，由于每次个数不一样我们取最后一个</span><br><span class="line">            cookies2_1 &#x3D; re.findall(r&quot;document\[.*?\]&#x3D;(.*?)location&quot;, js2, re.S)[-1]</span><br><span class="line">            # 将document[&#39;cookie&#39;]内容返回给go函数</span><br><span class="line">            js3 &#x3D; re.sub(&quot;&#125;;go&quot;, &quot;return &quot; + cookies2_1 + &quot;&#125;;go&quot;, js2, 1)</span><br><span class="line">            # 获取调用go函数时里面的参数</span><br><span class="line">            request &#x3D; re.findall(r&quot;go\(&#123;(.*?)&#125;\)&quot;, js3, re.S)[-1]</span><br><span class="line">            # 通过python修改js生成一个request方法</span><br><span class="line">            final_js &#x3D; js3 + &quot;\nfunction request() &#123;return go(&#123;&quot; + request + &quot;&#125;)&#125;&quot;</span><br><span class="line">            # js调用request方法返回cookie并将新的__jsl_clearance塞给session中</span><br><span class="line">            cookies3 &#x3D; execjs.compile(final_js).call(&#39;request&#39;).split(&#39;;&#39;)[0].split(&#39;&#x3D;&#39;)</span><br><span class="line">            session.cookies.set(cookies3[0], cookies3[1])</span><br><span class="line"></span><br><span class="line">            # 第三次请求 修改了__jsl_clearance后服务端向客户端设置新cookie的SECTOKEN</span><br><span class="line">            session.get(index_url)</span><br><span class="line">            cookies &#x3D; requests.utils.dict_from_cookiejar(session.cookies)</span><br><span class="line">            # print(cookies)</span><br><span class="line">            # 7. 把代理IP, User-Agent, Cookie放到字典中, 序列化后, 存储到Redis的list中</span><br><span class="line">            cookies_dict &#x3D; &#123;</span><br><span class="line">                COOKIES_KEY:cookies,</span><br><span class="line">                COOKIES_USER_AGENT_KEY:user_agent,</span><br><span class="line">                # COOKIES_PROXY_KEY:proxy</span><br><span class="line">            &#125;</span><br><span class="line">            # 序列化后, 存储到Redis的list中</span><br><span class="line">            self.redis.lpush(REDIS_COOKIES_KEY, pickle.dumps(cookies_dict))</span><br><span class="line">            print(cookies_dict)</span><br><span class="line">            break</span><br><span class="line">        except Exception as ex:</span><br><span class="line">            print(&quot;error&quot;,ex)</span><br></pre></td></tr></table></figure><p><code>settings.py</code>中配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 定义cookie的键</span><br><span class="line">COOKIE_KEY &#x3D; &#39;COOKIE&#39; # 字典中Cookie键</span><br><span class="line">COOKIE_PROXY_KEY &#x3D; &#39;COOKIE_PROXY&#39; # 字典中代理IP的键</span><br><span class="line">COOKIE_USER_AGENT_KEY &#x3D; &#39;COOKIE_USER_AGENT&#39; # 字典中User-Agent的键</span><br><span class="line">REDIS_COOKIES_KEY &#x3D; &#39;REDIS_COOKIES&#39; # Redis的cookie列表的键</span><br><span class="line">REDIS_URL &#x3D; &#39;redis:&#x2F;&#x2F;127.0.0.1:6379&#x2F;0&#39; # Redis数据库的链接</span><br></pre></td></tr></table></figure><h2 id="定制中间件"><a href="#定制中间件" class="headerlink" title="定制中间件"></a>定制中间件</h2><ul><li><code>步骤</code><ul><li>实现process_request方法, 从Redis中随机取出Cookie来使用, 关闭页面重定向.</li><li>实现process_response方法, 如果响应码不是200 或 没有内容重试    </li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">class GsxtCookieMiddleware(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        &quot;&quot;&quot;建立Redis数据库连接&quot;&quot;&quot;</span><br><span class="line">        self.redis &#x3D; StrictRedis.from_url(REDIS_URL)</span><br><span class="line"></span><br><span class="line">    def process_request(self, request, spider):</span><br><span class="line">        &quot;&quot;&quot;从Redis中随机取出Cookie来使用, 关闭页面重定向.&quot;&quot;&quot;</span><br><span class="line">        count &#x3D; self.redis.llen(REDIS_COOKIES_KEY)</span><br><span class="line">        random_index &#x3D; random.randint(0, count-1)</span><br><span class="line">        cookie_data &#x3D; self.redis.lindex(REDIS_COOKIES_KEY, random_index)</span><br><span class="line">        # 反序列化, 把二进制转换为字典</span><br><span class="line">        cookie_dict &#x3D; pickle.loads(cookie_data)</span><br><span class="line"></span><br><span class="line">        # 把cookie信息设置request</span><br><span class="line">        request.headers[&#39;User-Agent&#39;] &#x3D; cookie_dict[COOKIES_USER_AGENT_KEY]</span><br><span class="line">        # 设置请求代理IP</span><br><span class="line">        request.meta[&#39;proxy&#39;] &#x3D; cookie_dict[COOKIES_PROXY_KEY]</span><br><span class="line">        # 设置cookie信息</span><br><span class="line">        request.cookies &#x3D; cookie_dict[COOKIES_KEY]</span><br><span class="line">        # 设置不要重定向</span><br><span class="line">        request.meta[&#39;dont_redirect&#39;] &#x3D; True</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response, spider):</span><br><span class="line">        &quot;&quot;&quot;如果响应码不是200 或 没有内容重试&quot;&quot;&quot;</span><br><span class="line">        # print(response.status)</span><br><span class="line">        if response.status !&#x3D; 200 or response.body &#x3D;&#x3D; b&#39;&#39;:</span><br><span class="line">            # 备份请求</span><br><span class="line">            req &#x3D; request.copy()</span><br><span class="line">            # 设置请求不过滤</span><br><span class="line">            req.dont_filter &#x3D; True</span><br><span class="line">            # 把请求交给引擎</span><br><span class="line">            return req</span><br><span class="line"></span><br><span class="line">        return response</span><br></pre></td></tr></table></figure><p>在setting.py文件件中配置中间件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES &#x3D; &#123;</span><br><span class="line">   &#39;dishonest.dishonest.middlewares.GsxtCookieMiddleware&#39;: 10,</span><br><span class="line">   &#39;dishonest.dishonest.middlewares.ProxyMiddleware&#39;: 500,</span><br><span class="line">   &#39;dishonest.dishonest.middlewares.RandomUserAgent&#39;: 543,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="完善爬虫"><a href="#完善爬虫" class="headerlink" title="完善爬虫"></a>完善爬虫</h2><ul><li>解析页面中的城市名称和id, 构建公告信息的URL</li><li>解析失信企业公告信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">class GsxtSpider(scrapy.Spider):</span><br><span class="line">        name &#x3D; &#39;gsxt&#39;</span><br><span class="line">        allowed_domains &#x3D; [&#39;gsxt.gov.cn&#39;]</span><br><span class="line">        # 准备起始</span><br><span class="line">        start_urls &#x3D; [&#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;corp-query-entprise-info-xxgg-100000.html&#39;]</span><br><span class="line"></span><br><span class="line">        custom_settings &#x3D; &#123;</span><br><span class="line">            &#39;DOWNLOAD_DELAY&#39; : 5</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        def parse(self, response):</span><br><span class="line"></span><br><span class="line">            # 获取城市标签的div列表</span><br><span class="line">            divs &#x3D; response.xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;qysx&quot;]&#x2F;div[3]&#x2F;div&#39;)</span><br><span class="line">            # 遍历divs, 获取城市id和名称</span><br><span class="line">            for div in divs:</span><br><span class="line">                area_id &#x3D; div.xpath(&#39;.&#x2F;@id&#39;).extract_first()</span><br><span class="line">                area_name &#x3D; div.xpath(&#39;.&#x2F;label&#x2F;text()&#39;).extract_first()</span><br><span class="line">                # 准备请求的URL</span><br><span class="line">                url &#x3D; &#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;affiche-query-area-info-paperall.html?&#39; \</span><br><span class="line">                    &#39;noticeType&#x3D;11&amp;areaid&#x3D;100000&amp;noticeTitle&#x3D;&amp;regOrg&#x3D;&#123;&#125;&#39;.format(area_id)</span><br><span class="line">                # 一个城市最多能够获取50条数据.</span><br><span class="line">                for i in range(0, 50, 10):</span><br><span class="line">                    data &#x3D; &#123;</span><br><span class="line">                        &#39;start&#39;: str(i)</span><br><span class="line">                    &#125;</span><br><span class="line">                    # 构建请求, 交给引擎</span><br><span class="line">                    yield scrapy.FormRequest(url, formdata&#x3D;data, callback&#x3D;self.parse_data,</span><br><span class="line">                                            meta&#x3D;&#123;&#39;area_name&#39;: area_name&#125;)</span><br><span class="line"></span><br><span class="line">        def parse_data(self, response):</span><br><span class="line">            # print(response.text)</span><br><span class="line">            &quot;&quot;&quot;解析页面中的城市&quot;&quot;&quot;</span><br><span class="line">            area_name &#x3D; response.meta[&#39;area_name&#39;]</span><br><span class="line">            result &#x3D; json.loads(response.text)</span><br><span class="line">            datas &#x3D; result[&#39;data&#39;]</span><br><span class="line">            for data in datas:</span><br><span class="line">                item &#x3D; DishonestItem()</span><br><span class="line">                # 区域名称</span><br><span class="line">                item[&#39;area_name&#39;] &#x3D; area_name</span><br><span class="line">                # 公告标题</span><br><span class="line">                notice_title &#x3D; data[&#39;noticeTitle&#39;]</span><br><span class="line">                name &#x3D; re.findall(&#39;关?于?(.+?)的?列入.*&#39;, notice_title)[0]</span><br><span class="line">                item[&#39;name&#39;] &#x3D; name</span><br><span class="line">                # 由于抓取的是失信企业公告, 所以抓到都是企业; 年龄设置为0</span><br><span class="line">                item[&#39;age&#39;] &#x3D; 0</span><br><span class="line">                notice_content &#x3D; data[&#39;noticeContent&#39;]</span><br><span class="line">                card_id &#x3D; re.findall(&#39;经查.+[（\(]统一社会信用码&#x2F;注册号：(\w+)[）\)]&#39;, notice_content)</span><br><span class="line">                item[&#39;card_num&#39;] &#x3D; card_id[0] if len(card_id) !&#x3D; 0 else &#39;&#39;</span><br><span class="line">                item[&#39;content&#39;] &#x3D; notice_content</span><br><span class="line">                # 公布单位</span><br><span class="line">                item[&#39;publish_unit&#39;] &#x3D; data[&#39;judAuth_CN&#39;]</span><br><span class="line">                # 获取到的时间, 是1970年1月1日 0时0分0秒 到发布时间的毫秒数</span><br><span class="line">                publish_ms &#x3D; data[&#39;noticeDate&#39;]</span><br><span class="line">                # 转换为日期类型</span><br><span class="line">                publish_date &#x3D; datetime.fromtimestamp(publish_ms &#x2F; 1000)</span><br><span class="line">                item[&#39;publish_date&#39;] &#x3D; publish_date.strftime(&#39;%Y年%m月%d日&#39;)</span><br><span class="line">                yield item</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之国家企业信用信息公示系统Cookie传递</title>
      <link href="2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/"/>
      <url>2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/</url>
      
        <content type="html"><![CDATA[<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p><a href="http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html" target="_blank" rel="noopener">http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html</a></p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426212409306.png" alt="image-20210426212409306"></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>POST <a href="http://www.gsxt.gov.cn/affiche-query-area-info-paperall.html?noticeType=21&amp;areaid=100000&amp;noticeTitle=&amp;regOrg=110000" target="_blank" rel="noopener">http://www.gsxt.gov.cn/affiche-query-area-info-paperall.html?noticeType=21&amp;areaid=100000&amp;noticeTitle=&amp;regOrg=110000</a></p><ul><li>参数:<ul><li>noticeType=21 通知类型, 失信企业固定21</li><li>areaid=100000 无论在哪个区域, 固定是<code>100000</code></li><li>noticeTitle= 通知标题, 可以为空</li><li>regOrg=  通知的区域id, 可以从省份标签上获取</li></ul></li><li>请求体数据:<ul><li>draw: 1 点击分页按钮的次数, 可以省略</li><li>start: 0 起始索引号</li><li>length: 10 长度, 固定是10, 设置多了也无效</li></ul></li></ul><p>直接访问该接口时，状态521，返回如下js混淆加密代码。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426212523507.png" alt="image-20210426212523507"></p><p>尝试给请求头中加上cookie<code>__jsluid_h=f6db0fc02adff8425bebcd8ed1b5fffc; SECTOKEN=7445298838033400749; __jsl_clearance=1619443187.64|0|nGqWRKwajO%2BeHI6CP7Mt50EbdcU%3D;</code>，正常返回如下结果。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426212723697.png" alt="image-20210426212723697"></p><h2 id="jsluid-h"><a href="#jsluid-h" class="headerlink" title="__jsluid_h"></a>__jsluid_h</h2><p>打开fiddler，刷新页面抓包<code>http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html</code>,一共访问了三次该页面，前两次521第三次正场返回请求页面。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426213449809.png" alt="image-20210426213449809"></p><p>第一次请求时服务端向服务器塞入第一个__jsluid_h关键cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: __jsluid_h&#x3D;01737b0139a221e260d1061c68b4232f; max-age&#x3D;31536000; path&#x3D;&#x2F;; HttpOnly</span><br></pre></td></tr></table></figure><p>并向浏览器返回一段混淆过的js，内容如下，主要功能应该是设置cookie。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;document.cookie&#x3D;(&#39;_&#39;)+(&#39;_&#39;)+(&#39;j&#39;)+(&#39;s&#39;)+(&#39;l&#39;)+(&#39;_&#39;)+(&#39;c&#39;)+(&#39;l&#39;)+(&#39;e&#39;)+(&#39;a&#39;)+(&#39;r&#39;)+(&#39;a&#39;)+(&#39;n&#39;)+(&#39;c&#39;)+(&#39;e&#39;)+(&#39;&#x3D;&#39;)+((+true)+&#39;&#39;)+((1+[2])&#x2F;[2]+&#39;&#39;)+(-~false+&#39;&#39;)+(3+6+&#39;&#39;)+(2+2+&#39;&#39;)+(-~[2]+&#39;&#39;)+(~~false+&#39;&#39;)+((2)*[4]+&#39;&#39;)+((1+[0])&#x2F;[2]+&#39;&#39;)+(9-1*2+&#39;&#39;)+(&#39;.&#39;)+((2)*[2]+&#39;&#39;)+(6+&#39;&#39;)+(1+6+&#39;&#39;)+(&#39;|&#39;)+(&#39;-&#39;)+(-~0+&#39;&#39;)+(&#39;|&#39;)+(&#39;w&#39;)+(&#39;Y&#39;)+(&#39;p&#39;)+(&#39;A&#39;)+(&#39;F&#39;)+(&#39;R&#39;)+(&#39;%&#39;)+(1+1+&#39;&#39;)+(&#39;B&#39;)+(-~(4)+&#39;&#39;)+(&#39;X&#39;)+(&#39;x&#39;)+(&#39;m&#39;)+(&#39;W&#39;)+(&#39;Y&#39;)+((1&lt;&lt;2)+&#39;&#39;)+(&#39;j&#39;)+(&#39;P&#39;)+(&#39;a&#39;)+(&#39;Q&#39;)+([3]*(3)+&#39;&#39;)+(&#39;t&#39;)+(&#39;Q&#39;)+(1+7+&#39;&#39;)+(&#39;T&#39;)+(&#39;P&#39;)+(&#39;Z&#39;)+(&#39;i&#39;)+(&#39;E&#39;)+(&#39;%&#39;)+(3+&#39;&#39;)+(&#39;D&#39;)+(&#39;;&#39;)+(&#39;m&#39;)+(&#39;a&#39;)+(&#39;x&#39;)+(&#39;-&#39;)+(&#39;a&#39;)+(&#39;g&#39;)+(&#39;e&#39;)+(&#39;&#x3D;&#39;)+(3+&#39;&#39;)+(3+3+&#39;&#39;)+(~~&#39;&#39;+&#39;&#39;)+(~~false+&#39;&#39;)+(&#39;;&#39;)+(&#39;p&#39;)+(&#39;a&#39;)+(&#39;t&#39;)+(&#39;h&#39;)+(&#39;&#x3D;&#39;)+(&#39;&#x2F;&#39;);location.href&#x3D;location.pathname+location.search&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>我们将这段js放入浏览器中执行，如我们所料，正是返回第二个__jsl_clearance关键性cookie。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426213656188.png" alt="image-20210426213656188"></p><h2 id="jsl-clearance"><a href="#jsl-clearance" class="headerlink" title="__jsl_clearance"></a>__jsl_clearance</h2><p>第二次请求<code>http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html</code>时，浏览器发送了__jsl_clearance和__jsluid_h两个关键cookie，服务端接收后并返回了一段混淆后的js，这次没有向浏览器塞入cookie。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: __jsluid_h&#x3D;01737b0139a221e260d1061c68b4232f; __jsl_clearance&#x3D;1619430857.467|-1|wYpAFR%2B5XxmWY4jPaQ9tQ8TPZiE%3D</span><br></pre></td></tr></table></figure><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426214109519.png" alt="image-20210426214109519"></p><h2 id="SECTOKEN"><a href="#SECTOKEN" class="headerlink" title="SECTOKEN"></a>SECTOKEN</h2><p>第三次请求<code>http://www.gsxt.gov.cn/corp-query-entprise-info-xxgg-100000.html</code>时，浏览器携带了两个关键性Cookie，不过这次__jsl_clearance和之前的值发生变化，怀疑是第二次请求返回的js做了手脚。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: __jsluid_h&#x3D;01737b0139a221e260d1061c68b4232f; __jsl_clearance&#x3D;1619430857.529|0|WGn9gKxiPtYUHAGBZ1a%2B%2F3o9sJE%3D</span><br></pre></td></tr></table></figure><p>这次请求不仅正常的返回了页面内容，而且还往请求头中塞入了第三个SECTOKEN关键性Cookie。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: SECTOKEN&#x3D;7448433543385710812; Expires&#x3D;Sat, 14-May-2089 13:03:34 GMT; Path&#x3D;&#x2F;; HttpOnly</span><br></pre></td></tr></table></figure><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426214705754.png" alt="image-20210426214705754"></p><h2 id="请求数据"><a href="#请求数据" class="headerlink" title="请求数据"></a>请求数据</h2><p>在上面的三个cookie加持下，终于成功的返回了我们想要的数据，接下来就是分析这三个cookie在代码中如何拿到。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426214745787.png" alt="image-20210426214745787"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>通过requests的session对象，自动合并cookie信息，并设置请求头。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;78.0.3904.70 Safari&#x2F;537.36&#39;,</span><br><span class="line">&#125;</span><br><span class="line">session &#x3D; requests.session()</span><br><span class="line">session.headers &#x3D; headers</span><br></pre></td></tr></table></figure><h2 id="第一次请求"><a href="#第一次请求" class="headerlink" title="第一次请求"></a>第一次请求</h2><p>通过第一次请求，服务端往客户端返回__jsluid_h作为第一个关键cookie，根据返回的js通过正则表达式拿到script标签中的js逻辑，并去除后面无用js<code>location.href...</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">response &#x3D; session.get(index_url)</span><br><span class="line">js1 &#x3D; re.findall(&#39;&lt;script&gt;(.+?)&lt;&#x2F;script&gt;&#39;, response.content.decode())[0].replace(&#39;document.cookie&#x3D;&#39;, &#39;&#39;).replace(</span><br><span class="line">    &#39;location.href&#x3D;location.pathname+location.search&#39;, &#39;&#39;)</span><br><span class="line">context &#x3D; js2py.EvalJs()    </span><br><span class="line">context.execute(&#39;cookies2 &#x3D;&#39; + js1)</span><br><span class="line">cookies &#x3D; context.cookies2.split(&#39;;&#39;)[0].split(&#39;&#x3D;&#39;)</span><br><span class="line">session.cookies.set(cookies[0], cookies[1])  # 到此拿到第两个cookie</span><br><span class="line">print(session.cookies)</span><br></pre></td></tr></table></figure><h2 id="第二次请求"><a href="#第二次请求" class="headerlink" title="第二次请求"></a>第二次请求</h2><p>第二次请求携带了前面两个关键性cookie，并返回了一段js。这里我们的cookie都存在了session中，所以不用额外处理。通过正则取出第二次返回的js中script标签中的内容。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426215550092.png" alt="image-20210426215550092"></p><p>就算格式化后这段代码都难以阅读，我们通过<a href="http://tool.yuanrenxue.com/decode_obfuscator" target="_blank" rel="noopener">ob混淆专解测试版V0.1</a>进行反混淆，重新审视这段js。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426215722445.png" alt="image-20210426215722445"></p><p>逻辑就是通过调用go函数往document中塞入cookie，我们在<code>function go(_0x2323c8)</code>最后返回<code>document[&#39;cookie&#39;]</code>,把setTimeout的时间设置久一点。</p><p><img src="/2021/04/26/JS%E9%80%86%E5%90%91%E4%B9%8B%E5%9B%BD%E5%AE%B6%E4%BC%81%E4%B8%9A%E4%BF%A1%E7%94%A8%E4%BF%A1%E6%81%AF%E5%85%AC%E7%A4%BA%E7%B3%BB%E7%BB%9FCookie/image-20210426215953431.png" alt="image-20210426215953431"></p><p>通过上面分析我们可以通过第二次请求返回的js进行修改后，python调用生成cookie传递后被修改的__jsl_clearance关键cookie。不过很多对象在python调用时不可用，如window，document，location等等，我们可以通过jsdom库实现浏览器的上下文。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const jsdom &#x3D; require(&quot;jsdom&quot;);</span><br><span class="line">const &#123;JSDOM&#125; &#x3D; jsdom;</span><br><span class="line">const dom &#x3D; new JSDOM();</span><br><span class="line">window &#x3D; dom.window;</span><br><span class="line">document &#x3D; window.document;</span><br><span class="line">location &#x3D; new Array();</span><br></pre></td></tr></table></figure><p>就这段js存入文件后，python读取文件，使用execjs实现调用，返回第二个__jsl_clearance关键性cookie，为获取SECTOKEN埋下伏笔。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">with open(r&#39;第二次请求.js&#39;, encoding&#x3D;&#39;utf-8&#39;, mode&#x3D;&#39;r&#39;) as f:</span><br><span class="line">    JsData &#x3D; f.read()</span><br><span class="line">cookie &#x3D; execjs.compile(JsData).call(&#39;request&#39;)</span><br><span class="line">print(cookie)</span><br></pre></td></tr></table></figure><p>在python中为了调用go函数，还需要在js中新创建一个request函数，让go函数的数据返回给python作为cookie存入session中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加jsdom实现浏览器上下文</span></span><br><span class="line">js2 = <span class="string">'''const jsdom = require("jsdom");const &#123;JSDOM&#125; = jsdom;const dom = new JSDOM();window = dom.window;document = window.document;location = new Array();'''</span> + \</span><br><span class="line">      re.findall(<span class="string">'&lt;script&gt;(.+?)&lt;/script&gt;'</span>, session.get(index_url).content.decode(<span class="string">'utf-8'</span>))[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 正则获取document['cookie']，由于每次个数不一样我们取最后一个</span></span><br><span class="line">cookies2_1 = re.findall(<span class="string">r"document\[.*?\]=(.*?)location"</span>, js2, re.S)[<span class="number">-1</span>]</span><br><span class="line"><span class="comment"># 将document['cookie']内容返回给go函数</span></span><br><span class="line">js3 = re.sub(<span class="string">"&#125;;go"</span>, <span class="string">"return "</span> + cookies2_1 + <span class="string">"&#125;;go"</span>, js2, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 获取调用go函数时里面的参数</span></span><br><span class="line">request = re.findall(<span class="string">r"go\(&#123;(.*?)&#125;\)"</span>, js3, re.S)[<span class="number">-1</span>]</span><br><span class="line"><span class="comment"># 通过python修改js生成一个request方法</span></span><br><span class="line">final_js = js3+<span class="string">"\nfunction request() &#123;return go(&#123;"</span>+request+<span class="string">"&#125;)&#125;"</span></span><br><span class="line"><span class="comment"># js调用request方法返回cookie并将新的__jsl_clearance塞给session中</span></span><br><span class="line">cookies3 = execjs.compile(final_js).call(<span class="string">'request'</span>).split(<span class="string">';'</span>)[<span class="number">0</span>].split(<span class="string">'='</span>)</span><br><span class="line">session.cookies.set(cookies3[<span class="number">0</span>], cookies3[<span class="number">1</span>])</span><br><span class="line">print(cookies3)</span><br></pre></td></tr></table></figure><h2 id="第三次请求"><a href="#第三次请求" class="headerlink" title="第三次请求"></a>第三次请求</h2><p>利用新的__jsl_clearance和__jsluid_h发送第三次请求，服务端会向客户端返回新Cookie SECTOKEN，接下来我们打印出所有的cookie。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session.get(index_url)</span><br><span class="line">cookies &#x3D; requests.utils.dict_from_cookiejar(session.cookies)</span><br><span class="line">print(cookies)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&#39;__jsl_clearance&#39;: &#39;1619446283.778|0|DFaPnxb5OqsBcRBkaxTSCax2qLA%3D&#39;,</span><br><span class="line">&#39;HttpOnly&#39;: None,</span><br><span class="line">&#39;JSESSIONID&#39;: &#39;e80d7db0e1fe65e65ab6a29e8cc4&#39;,</span><br><span class="line">&#39;SECTOKEN&#39;: &#39;7448640433386424422&#39;,</span><br><span class="line">&#39;__jsluid_h&#39;: &#39;2c8e0b64535955d16c6db3072464d199&#39;,</span><br><span class="line">&#39;tlb_cookie&#39;: &#39;S172.16.12.67&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据抓取"><a href="#数据抓取" class="headerlink" title="数据抓取"></a>数据抓取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;affiche-query-area-info-paperall.html?noticeType&#x3D;21&amp;areaid&#x3D;100000&amp;noticeTitle&#x3D;&amp;regOrg&#x3D;110000&#39;</span><br><span class="line"></span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    # &#39;draw&#39;: &#39;0&#39;,</span><br><span class="line">    &#39;start&#39;: &#39;0&#39;,</span><br><span class="line">    &#39;length&#39;: &#39;10&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 准备请求头</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;78.0.3904.70 Safari&#x2F;537.36&#39;,</span><br><span class="line">    # &#39;User-Agent&#39;: &#39;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&#39;,</span><br><span class="line">    # &#39;Referer&#39;: &#39;http:&#x2F;&#x2F;www.gsxt.gov.cn&#x2F;corp-query-entprise-info-xxgg-100000.html&#39;,</span><br><span class="line">    # &#39;Cookie&#39;: &#39;__jsluid&#x3D;fb0718dce34ccf53c4b94d15e9ab13d5; SECTOKEN&#x3D;7178252594204902863; __jsl_clearance&#x3D;1546475343.133|0|QZ7AOWMecndqD4CZG4hqoBAHtVw%3D;&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response &#x3D; requests.post(url, cookies&#x3D;cookies, data&#x3D;data, headers&#x3D;headers)</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.content.decode())</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之淘宝h5视频sign破解</title>
      <link href="2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/"/>
      <url>2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>最近需要抓取一些淘宝商品的首图视频，比如<a href="https://item.taobao.com/item.htm?spm=a230r.1.14.31.7ebfcec2qmczgd&amp;id=641116554739&amp;ns=1&amp;abbucket=2#detail%EF%BC%8C%E8%AF%A5%E9%A1%B5%E9%9D%A2%E9%A6%96%E5%9B%BE%E8%A7%86%E9%A2%91%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E6%98%AFblob%E5%8D%8F%E8%AE%AE%E5%8A%A0%E5%AF%86%EF%BC%8C%E8%AF%A5%E5%8D%8F%E8%AE%AE%E8%BF%94%E5%9B%9E%E5%A4%A7%E5%A4%9A%E6%98%AFm3u8%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%A7%86%E9%A2%91%EF%BC%8C%E5%B9%B6%E8%A2%AB%E5%88%87%E5%88%86%E4%B8%BA%E5%A4%9A%E4%B8%AAts%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%B0%8F%E6%AE%B5%E8%A7%86%E9%A2%91%E9%9B%86%E5%90%88%E3%80%82" target="_blank" rel="noopener">https://item.taobao.com/item.htm?spm=a230r.1.14.31.7ebfcec2qmczgd&amp;id=641116554739&amp;ns=1&amp;abbucket=2#detail，该页面首图视频页面元素是blob协议加密，该协议返回大多是m3u8格式的视频，并被切分为多个ts格式的小段视频集合。</a></p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425195135891.png" alt="image-20210425195135891"></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>通过chrome抓包果然找到了m3u8视频请求，第一个请求返回ts文件列表，紧接着发起视频请求返回ts视频数据。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425195624728.png" alt="image-20210425195624728"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># EXTM3U：.m3u8文件的格式定义</span><br><span class="line"># EXT-X-KEY： 密钥的信息</span><br><span class="line"># METHOD： 加密的方法，这里采用的是AES-128的加密方式</span><br><span class="line"># URI： 密钥的地址，需要获取访问得到密钥的信息</span><br><span class="line"># IV： 偏移量，AES加密的方法，通过这个密钥就可以解密，获取正确的视频信息</span><br></pre></td></tr></table></figure><p>数据来源找到了，那么紧跟着就是找到这些链接的组成字段，如首个链接<code>https://tbm-auth.alicdn.com/e99361edd833010b/1Ptetzs7wLumqr8DVXj/IZAAx7ivPbWWLLDYpm0_275076925941___hd.m3u8?auth_key=1619353994-0-0-7eac2e2d00d26717d7aad9746575f99f</code>中大部分url参数都是加密串，通过搜索其中的<code>1Ptetzs7wLumqr8DVXj</code>，找到了多条符合条件的请求。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425200200727.png" alt="image-20210425200200727"></p><p>第一条请求中返回的数据中有两个参数的video_url，分别是hlsResources和mp4Resources，返回了m3u8和mp4格式，好家伙，这样省去了合并m3u8个流程，直接拿mp4格式的视频即可。</p><h1 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h1><p>拿到返回video_url的请求的参数，通过逐条过滤参数发现，最终生效的参数只有四个，分别是appKey,t,sign,data，每次请求都有失效时间。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425203715490.png" alt="image-20210425203715490"></p><p>其中appKey固定为12574478，t为精确到毫秒的时间戳，sign是今天的逆向主角参数，data动态内容为<code>&#39;{&quot;videoId&quot;: &quot;%s&quot;,&quot;from&quot;:&quot;detail&quot;}&#39; % &quot;301079547561&quot;</code>,其中<code>301079547561</code>作为videoId在页面请求时直接返回在页面js中。</p><h2 id="sign"><a href="#sign" class="headerlink" title="sign"></a>sign</h2><p>无痕浏览器清空页面缓存，搜索sign，从众多页面中找到可能出现的位置，sign就是j，而<code> j = h(d.token + &quot;&amp;&quot; + i + &quot;&amp;&quot; + g + &quot;&amp;&quot; + c.data)</code>,其中d.token是加密字符串，i为时间戳，g为固定值12574478，c.data为{“videoId”:”275076925941”,”from”:”detail”}</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425210119516.png" alt="image-20210425210119516"></p><p>在控制台中调用h函数返回32位字符串，猜测是md5加密，就不扣h函数的js了。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425210755226.png" alt="image-20210425210755226"></p><p>接下来就是分析这些参数中唯一变的参数d.token的来源。</p><h2 id="d-token"><a href="#d-token" class="headerlink" title="d.token"></a>d.token</h2><p>第一次断点时d.token为undefined。</p><p>放开断点后搜索d.token的值<code>0027f0b395e6356158d06d22da238855</code>,第一次出现在了返回video_url的请求返回时set-cookie中，作为Response Cookie返回了两个cookie，一个是_m_h5_tk，一个是_m_h5_tk_enc，_分割的前面一段就是d.token的值。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425221325428.png" alt="image-20210425221325428"></p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425224123071.png" alt="image-20210425224123071"></p><p>第二次进入断点时<code>d.token=0027f0b395e6356158d06d22da238855</code>,放开断点后搜索<code>0027f0b395e6356158d06d22da238855</code>出现在了同一个请求的Request Cookie中。</p><p><img src="/2021/04/25/JS%E9%80%86%E5%90%91%E4%B9%8B%E6%B7%98%E5%AE%9Dh5%E8%A7%86%E9%A2%91sign%E7%A0%B4%E8%A7%A3/image-20210425224612523.png" alt="image-20210425224612523"></p><h2 id="逻辑梳理"><a href="#逻辑梳理" class="headerlink" title="逻辑梳理"></a>逻辑梳理</h2><p>大概思路清晰了，对同一个请求多次访问，第一次返回cookie作为第二次请求的cookie，cookie中的_m_h5_tk_enc通过_分割的前半段字符串作为d.token，根据<code>d.token + &quot;&amp;&quot; + i + &quot;&amp;&quot; + g + &quot;&amp;&quot; + c.data</code>进行md5得到sign，请求时加上两个cookie，完成video_url的请求，从而实现淘宝商品首图的视频抓取。</p><h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">APPKEY &#x3D; &#39;12574478&#39;</span><br><span class="line">DATA &#x3D; &#39;&#123;&quot;videoId&quot;: &quot;%s&quot;,&quot;from&quot;:&quot;detail&quot;&#125;&#39; % &quot;301079547561&quot;</span><br><span class="line">URL &#x3D; &#39;https:&#x2F;&#x2F;h5api.m.taobao.com&#x2F;h5&#x2F;mtop.taobao.cloudvideo.video.queryforh5&#x2F;1.0&#x2F;&#39;</span><br><span class="line">params &#x3D; &#123;&#39;jsv&#39;: &#39;2.4.11&#39;, &#39;appKey&#39;: APPKEY, &#39;t&#39;: int(time.time() * 1000),</span><br><span class="line">          &#39;sign&#39;: &#39;FAKE_SIGN_WITH_ANYTHING&#39;, &#39;api&#39;: &#39;mtop.wdetail.getItemDescx&#39;, &#39;callback&#39;: &#39;mtopjsonp1&#39;,&#39;v&#39;: &#39;4.9&#39;,</span><br><span class="line">          &#39;type&#39;: &#39;jsonp&#39;, &#39;dataType&#39;: &#39;jsonp&#39;,</span><br><span class="line">          &#39;data&#39;: DATA&#125;</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (iPhone; CPU iPhone OS 9_3_4 like Mac OS X) AppleWebKit&#x2F;601.1.46 &#39; + \</span><br><span class="line">                  &#39;(KHTML, like Gecko) Version&#x2F;9.0 Mobile&#x2F;13G35 Safari&#x2F;601.1&#39;,</span><br><span class="line">&#125;</span><br><span class="line">images &#x3D; []</span><br><span class="line"># get token in first request</span><br><span class="line">r1 &#x3D; requests.get(URL, params&#x3D;params, headers&#x3D;headers)</span><br><span class="line">token_with_time &#x3D; r1.cookies.get(&#39;_m_h5_tk&#39;)</span><br><span class="line">token &#x3D; token_with_time.split(&#39;_&#39;)[0]</span><br><span class="line">enc_token &#x3D; r1.cookies.get(&#39;_m_h5_tk_enc&#39;)</span><br><span class="line"># get results in second request</span><br><span class="line">t2 &#x3D; str(int(time.time() * 1000))</span><br><span class="line">c &#x3D; &#39;&amp;&#39;.join([token, t2, APPKEY, DATA])</span><br><span class="line">m &#x3D; hashlib.md5()</span><br><span class="line">m.update(c.encode(&#39;utf-8&#39;))</span><br><span class="line">params.update(&#123;&#39;t&#39;: t2, &#39;sign&#39;: m.hexdigest()&#125;)</span><br><span class="line">cookies &#x3D; &#123;&#39;_m_h5_tk&#39;: token_with_time, &#39;_m_h5_tk_enc&#39;: enc_token&#125;</span><br><span class="line">r2 &#x3D; requests.get(URL, params&#x3D;params, headers&#x3D;headers, cookies&#x3D;cookies)</span><br><span class="line">results&#x3D;json.loads(re.match(r&#39; mtopjsonp1\((.*?)\)&#39;, r2.text).group(1))</span><br><span class="line">video_url &#x3D; jsonpath(results, &#39;$..video_url&#39;)[1]</span><br><span class="line">print(video_url)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Xposed搭建开发</title>
      <link href="2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/"/>
      <url>2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="pixel刷安卓7"><a href="#pixel刷安卓7" class="headerlink" title="pixel刷安卓7"></a>pixel刷安卓7</h1><p>proxychains wget <a href="https://dl.google.com/dl/android/aosp/sailfish-n2g47o-factory-f2bc8024.zip" target="_blank" rel="noopener">https://dl.google.com/dl/android/aosp/sailfish-n2g47o-factory-f2bc8024.zip</a></p><p>proxychains wget <a href="https://forum.xda-developers.com/attachments/xposedinstaller_3-1-5-apk.4393082/" target="_blank" rel="noopener">https://forum.xda-developers.com/attachments/xposedinstaller_3-1-5-apk.4393082/</a></p><p>proxychains wget <a href="https://supersuroot.org/downloads/supersu-pro.apk" target="_blank" rel="noopener">https://supersuroot.org/downloads/supersu-pro.apk</a></p><p>proxychains wget <a href="https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img" target="_blank" rel="noopener">https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd sailfish-opm4.171019.021.p1 &amp;&amp; adb reboot bootloader &amp;&amp;  .&#x2F;flash-all.sh</span><br><span class="line">adb push SR5-SuperSU-v2.82-SR5-20171001224502.zip  &#x2F;data&#x2F;local&#x2F;tmp</span><br><span class="line">adb reboot bootloader &amp;&amp; fastboot boot twrp-3.3.0-0-sailfish.img   刷入twrp后安装supersu</span><br><span class="line">adb install XposedInstaller_3.1.5.apk  常见模块https:&#x2F;&#x2F;github.com&#x2F;WrBug&#x2F;GravityBox.git</span><br><span class="line">adb push timeadjust.sh &#x2F;data&#x2F;local&#x2F;tmp &amp;&amp; sh timeadjust.sh  时间修改正确</span><br><span class="line">adb install com.ttxapps.wifiadb_2.1.3-810031745_minAPI15.apk</span><br></pre></td></tr></table></figure><h1 id="xposed"><a href="#xposed" class="headerlink" title="xposed"></a>xposed</h1><p><a href="https://api.xposed.info/reference/android/app/AndroidAppHelper.html" target="_blank" rel="noopener">xposed api</a></p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423225219896.png" alt="image-20210423225219896"></p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>过滤子进程：loadPackageParam.processName,可以通过hook参数、调用栈、返回值 ，打印和修改，Xposed的开发，本质上就是Java的开发。</p><ol><li><p><strong>创建安卓项目xposed1</strong></p></li><li><p><strong>build.gradle引入xposed api依赖</strong></p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;com.android.application&#39;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 30</span><br><span class="line">    buildToolsVersion &quot;30.0.2&quot;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.roysue.xposed1&quot;</span><br><span class="line">        minSdkVersion 16</span><br><span class="line">        targetSdkVersion 30</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly &#39;de.robv.android.xposed:api:82&#39;</span><br><span class="line">    compileOnly &#39;de.robv.android.xposed:api:82:sources&#39;</span><br><span class="line">    implementation fileTree(dir: &quot;libs&quot;, include: [&quot;*.jar&quot;])</span><br><span class="line">    implementation &#39;androidx.appcompat:appcompat:1.2.0&#39;</span><br><span class="line">    implementation &#39;androidx.constraintlayout:constraintlayout:2.0.2&#39;</span><br><span class="line">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.2&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.3.0&#39;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>AndroidManifest.xml添加xposed项目基本配置</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    package&#x3D;&quot;com.roysue.xposed1&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class="line">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class="line">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class="line">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class="line">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class="line">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposedmodule&quot;</span><br><span class="line">            android:value&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposeddescription&quot;</span><br><span class="line">            android:value&#x3D;&quot;这是一个Xposed例程&quot; &#x2F;&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name&#x3D;&quot;xposedminversion&quot;</span><br><span class="line">            android:value&#x3D;&quot;53&quot; &#x2F;&gt;</span><br><span class="line">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class="line">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;intent-filter&gt;</span><br><span class="line">        &lt;&#x2F;activity&gt;</span><br><span class="line">    &lt;&#x2F;application&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>activity_main.xml添加按钮组件</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:text&#x3D;&quot;Hello World!&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;button&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:text&#x3D;&quot;Button&quot;</span><br><span class="line">        tools:layout_editor_absoluteX&#x3D;&quot;158dp&quot;</span><br><span class="line">        tools:layout_editor_absoluteY&#x3D;&quot;238dp&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>MainActivity调用Button组件，实现被hook方法toastMessage</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private Button button;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button &#x3D; (Button) findViewById(R.id.button);</span><br><span class="line">        button.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Toast.makeText(MainActivity.this, toastMessage(&quot;我未被劫持&quot;), Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public String toastMessage(String message) &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><strong>继承IXposedHookLoadPackage实现hook</strong></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class HookTest implements IXposedHookLoadPackage &#123;</span><br><span class="line">    &#x2F;&#x2F; 堆栈打印</span><br><span class="line">    public void PrintStack()&#123;</span><br><span class="line"></span><br><span class="line">        XposedBridge.log(&quot;Dump Stack: &quot;+ &quot;---------------start----------------&quot;);</span><br><span class="line">        Throwable ex &#x3D; new Throwable();</span><br><span class="line">        StackTraceElement[] stackElements &#x3D; ex.getStackTrace();</span><br><span class="line">        if (stackElements !&#x3D; null) &#123;</span><br><span class="line">            for (int i &#x3D; 0; i &lt; stackElements.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">                XposedBridge.log(&quot;Dump Stack&quot;+i+&quot;: &quot;+ stackElements[i].getClassName()</span><br><span class="line">                        +&quot;----&quot;+stackElements[i].getFileName()</span><br><span class="line">                        +&quot;----&quot; + stackElements[i].getLineNumber()</span><br><span class="line">                        +&quot;----&quot; +stackElements[i].getMethodName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedBridge.log(&quot;Dump Stack: &quot;+ &quot;---------------over----------------&quot;);</span><br><span class="line">        RuntimeException e &#x3D; new RuntimeException(&quot;&lt;Start dump Stack !&gt;&quot;);</span><br><span class="line">        e.fillInStackTrace();</span><br><span class="line">        Log.i(&quot;&lt;Dump Stack&gt;:&quot;, &quot;++++++++++++&quot;, e);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        &#x2F;&#x2F;XposedBridge.log(loadPackageParam.processName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.roysue.xposed1&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot; has Hooked!&quot;);</span><br><span class="line">            XposedBridge.log(&quot;inner&quot;+loadPackageParam.processName);</span><br><span class="line">            Class clazz &#x3D; loadPackageParam.classLoader.loadClass(&quot;com.roysue.xposed1.MainActivity&quot;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(clazz, &quot;toastMessage&quot;, String.class,new XC_MethodHook() &#123;</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                &#x2F;&#x2F; 原始参数</span><br><span class="line">                    String oldText &#x3D; (String) param.args[0];</span><br><span class="line">                    Log.d(&quot;din not hijacked&#x3D;&gt;&quot;, oldText);</span><br><span class="line">                    &#x2F;&#x2F;param.args[0] &#x3D; &quot;test&quot;;</span><br><span class="line">                    &#x2F;&#x2F; 修改新参数</span><br><span class="line">                    param.args[0] &#x3D; &quot;你已被劫持&quot;;</span><br><span class="line">                    PrintStack();</span><br><span class="line">                    &#x2F;&#x2F;super.beforeHookedMethod(param);</span><br><span class="line">                    &#x2F;&#x2F;XposedBridge.log(&quot; has Hooked!&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    Log.d(&quot;getResult is &#x3D;&gt; &quot;,(String) param.getResult());</span><br><span class="line">                    param.setResult(&quot;你已被劫持2&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li><strong>xposed_init配置hook方法</strong><br><code>com.roysue.xposed1.HookTest</code></li></ol><p>编译启动该app，注入Xposed</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423225205264.png" alt="image-20210423225205264"></p><p>点击按钮查看log及调用栈</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210423233543529.png" alt="image-20210423233543529"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.roysue.xposed1 explore</span><br><span class="line">android hooking search classes HookTest </span><br><span class="line">android hooking list class_methods com.roysue.xposed1.HookTest  找不到该类，原因是实现了接口IXposedHookLoadPackage，HookTest不在接口包中，需要在xposed_init里指定路径</span><br></pre></td></tr></table></figure><h2 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h2><h3 id="Hook-HookTest"><a href="#Hook-HookTest" class="headerlink" title="Hook HookTest"></a>Hook HookTest</h3><p>objection无法找到，通过frida进行hook拿到HookTest，frida -UF -l hookXposed.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if(loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;))&#123;</span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch(error)&#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    Java.use(&quot;com.roysue.xposed1.HookTest&quot;).PrintStack.implementation &#x3D; function (param)&#123;</span><br><span class="line">        console.log(&quot;entering PrintStack&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&quot;end2&quot;) </span><br><span class="line">&#125;</span><br><span class="line">function main()&#123;</span><br><span class="line">    hook()</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501135526330.png" alt="image-20210501135526330"></p><h3 id="Hook-XposedBridge"><a href="#Hook-XposedBridge" class="headerlink" title="Hook XposedBridge"></a>Hook XposedBridge</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; if (loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;)) &#123;</span><br><span class="line">                    if(loader.findClass(&quot;de.robv.android.xposed.XposedBridge&quot;))&#123;                        </span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        Java.use(&quot;de.robv.android.xposed.XposedBridge&quot;).log.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (str) &#123;</span><br><span class="line">            console.log(&quot;entering XposedBridge.log&quot;,str.toString());</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501140005696.png" alt="image-20210501140005696"></p><h3 id="Hook-All-Methods"><a href="#Hook-All-Methods" class="headerlink" title="Hook All Methods"></a>Hook All Methods</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function uniqBy(array, key) &#123;</span><br><span class="line">    var seen &#x3D; &#123;&#125;;</span><br><span class="line">    return array.filter(function (item) &#123;</span><br><span class="line">        var k &#x3D; key(item);</span><br><span class="line">        return seen.hasOwnProperty(k) ? false : (seen[k] &#x3D; true);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; trace a specific Java Method</span><br><span class="line">function traceMethod(targetClassMethod) &#123;</span><br><span class="line">    var delim &#x3D; targetClassMethod.lastIndexOf(&quot;.&quot;);</span><br><span class="line">    if (delim &#x3D;&#x3D;&#x3D; -1) return;</span><br><span class="line"></span><br><span class="line">    var targetClass &#x3D; targetClassMethod.slice(0, delim)</span><br><span class="line">    var targetMethod &#x3D; targetClassMethod.slice(delim + 1, targetClassMethod.length)</span><br><span class="line"></span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    var overloadCount &#x3D; hook[targetMethod].overloads.length;</span><br><span class="line"></span><br><span class="line">    console.log(&quot;Tracing &quot; + targetClassMethod + &quot; [&quot; + overloadCount + &quot; overload(s)]&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;* </span><br><span class="line">    &#x2F;&#x2F; hook all class_method</span><br><span class="line">    for (var i &#x3D; 0; i &lt; overloadCount; i++) &#123;</span><br><span class="line"></span><br><span class="line">        hook[targetMethod].overloads[i].implementation &#x3D; function () &#123;</span><br><span class="line">            console.warn(&quot;\n*** entered &quot; + targetClassMethod);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print backtrace</span><br><span class="line">            &#x2F;&#x2F; Java.perform(function() &#123;</span><br><span class="line">            &#x2F;&#x2F;var bt &#x3D; Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new());</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;\nBacktrace:\n&quot; + bt);</span><br><span class="line">            &#x2F;&#x2F; &#125;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print args</span><br><span class="line">            if (arguments.length) console.log();</span><br><span class="line">            for (var j &#x3D; 0; j &lt; arguments.length; j++) &#123;</span><br><span class="line">                console.log(&quot;arg[&quot; + j + &quot;]: &quot; + arguments[j]);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; print retval</span><br><span class="line">            var retval &#x3D; this[targetMethod].apply(this, arguments); &#x2F;&#x2F; rare crash (Frida bug?)</span><br><span class="line">            console.log(&quot;\nretval: &quot; + retval);</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            console.warn(&quot;\n*** exiting &quot; + targetClassMethod);</span><br><span class="line">            return retval;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *&#x2F;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function traceClass(targetClass) &#123;</span><br><span class="line">    &#x2F;&#x2F;Java.use是新建一个对象哈，大家还记得么？</span><br><span class="line">    var hook &#x3D; Java.use(targetClass);</span><br><span class="line">    &#x2F;&#x2F;利用反射的方式，拿到当前类的所有方法</span><br><span class="line">    var methods &#x3D; hook.class.getDeclaredMethods();</span><br><span class="line">    &#x2F;&#x2F; var methods &#x3D; hook.class.getMethods();</span><br><span class="line">    &#x2F;&#x2F;建完对象之后记得将对象释放掉哈</span><br><span class="line">    hook.$dispose;</span><br><span class="line">    &#x2F;&#x2F;将方法名保存到数组中</span><br><span class="line">    var parsedMethods &#x3D; [];</span><br><span class="line">    methods.forEach(function (method) &#123;</span><br><span class="line">        parsedMethods.push(method.toString().replace(targetClass + &quot;.&quot;, &quot;TOKEN&quot;).match(&#x2F;\sTOKEN(.*)\(&#x2F;)[1]);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#x2F;&#x2F;去掉一些重复的值</span><br><span class="line">    var targets &#x3D; uniqBy(parsedMethods, JSON.stringify);</span><br><span class="line">    &#x2F;&#x2F;对数组中所有的方法进行hook，traceMethod也就是第一小节的内容</span><br><span class="line">    targets.forEach(function (targetMethod) &#123;</span><br><span class="line">        traceMethod(targetClass + &quot;.&quot; + targetMethod);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>traceClass(“de.robv.android.xposed.XposedBridge”);</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501141314991.png" alt="image-20210501141314991"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (loader.findClass(&quot;com.roysue.xposed1.HookTest$1&quot;)) &#123;   </span><br><span class="line">traceClass(&quot;com.roysue.xposed1.HookTest$1&quot;);</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501141552600.png" alt="image-20210501141552600"></p><p>说明<code>com.roysue.xposed1.HookTest$1</code>就是<code>XposedHelpers.findAndHookMethod(clazz, &quot;toastMessage&quot;, String.class,new XC_MethodHook() {</code>中的XC_MethodHook内部类</p><p><strong>hook afterHookedMethod</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; if (loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;)) &#123;</span><br><span class="line">                    if(loader.findClass(&quot;com.roysue.xposed1.HookTest$1&quot;))&#123;                        </span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        Java.use(&quot;com.roysue.xposed1.HookTest$1&quot;).afterHookedMethod.implementation &#x3D; function (param) &#123;</span><br><span class="line">            console.log(&quot;entering afterHookedMethod param is &quot;,param);</span><br><span class="line">            return this.afterHookedMethod(param);</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501142210586.png" alt="image-20210501142210586"></p><p>通过<code>traceClass(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;)</code>拿到所有的类方法，在classloader中而不是在app中</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501142632392.png" alt="image-20210501142632392"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Java.use(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;).setResult.implementation &#x3D; function (param) &#123;</span><br><span class="line">console.log(&quot;entering XC_MethodHook$MethodHookParam setResult param is &quot;,param);</span><br><span class="line">&#x2F;&#x2F; 打印调用栈</span><br><span class="line">console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new())); </span><br><span class="line">return this.setResult(param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501143142237.png" alt="image-20210501143142237"></p><p>XC_MethodHook是抽象类不能直接hook，需要hook实现。</p><p>traceClass(“com.roysue.xposed1.HookTest$1”)</p><p><img src="/2021/04/23/Xposed%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91/image-20210501143735138.png" alt="image-20210501143735138"></p><h1 id="GravityBox"><a href="#GravityBox" class="headerlink" title="GravityBox"></a>GravityBox</h1><p>git clone <a href="https://github.com/GravityBox/GravityBox.git" target="_blank" rel="noopener">https://github.com/GravityBox/GravityBox.git</a></p><p>修改app/build.gradle  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">compileSdkVersion 23</span><br><span class="line">targetSdkVersion 23</span><br><span class="line">        debug &#123;  避免打包需要秘钥</span><br><span class="line">&#x2F;&#x2F;            versionNameSuffix &quot;-Dev&quot; </span><br><span class="line">&#x2F;&#x2F;            if (signingConfigs.releaseConfig !&#x3D; null) &#123;</span><br><span class="line">&#x2F;&#x2F;                signingConfig signingConfigs.releaseConfig</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">compile &#39;com.android.support:appcompat-v7:26.0.2&#39;         指定版本</span><br></pre></td></tr></table></figure><p>build.gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()  添加google镜像源</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &#39;com.android.tools.build:gradle:2.3.3&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">        maven &#123; url &#39;https:&#x2F;&#x2F;jitpack.io&#39; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>src/assets/xposed_init 文件中提供了入口类<code>com.wrbug.gravitybox.nougat.GravityBox</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class GravityBox implements IXposedHookZygoteInit, IXposedHookInitPackageResources, IXposedHookLoadPackage</span><br></pre></td></tr></table></figure><p>入口类中实现了三个接口<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookInitPackageResources.html" target="_blank" rel="noopener">IXposedHookInitPackageResources</a>，<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookLoadPackage.html" target="_blank" rel="noopener">IXposedHookLoadPackage</a>，<a href="https://api.xposed.info/reference/de/robv/android/xposed/IXposedHookZygoteInit.html" target="_blank" rel="noopener">IXposedHookZygoteInit</a></p><blockquote><p><strong>IXposedHookZygoteInit</strong>  所有的进程</p><p>Hook the initialization of ** <strong>(es), from which **all the apps</strong> are forked.</p><p>Implement this interface in your module’s main class in order to be notified when <strong>Android is starting up</strong>. In <code>IXposedHookZygoteInit</code>, you can modify objects and place hooks that should be applied <strong>for every app</strong>. <strong>Only the Android framework/system classes are available</strong> at that point in time. Use <code>null</code> as class loader for <code>XposedHelpers.findAndHookMethod(String, ClassLoader, String, Object...)</code> and its variants.</p><p>If you want to hook one/multiple specific apps, use <code>IXposedHookLoadPackage</code> instead.</p><p>说明initZygote只有在系统启动的时候执行一遍，只有系统框架库可以使用。</p></blockquote><p>XposedBridge.log(“GB:Hardware: “ + Build.HARDWARE);  代码中调用了Build.HARDWARE</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U|grep gravity</span><br><span class="line">objection -g com.ceco.nougat.gravitybox explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname android.os.Build</span><br></pre></td></tr></table></figure><blockquote><p>**IXposedHookInitPackageResources ** 所有的资源</p><p>Get notified when the resources for an app are initialized. In <code>handleInitPackageResources(XC_InitPackageResources.InitPackageResourcesParam)</code>, resource replacements can be created.</p><p>This interface should be implemented by the module’s main class. Xposed will take care of registering it as a callback automatically.</p><p>说明handleInitPackageResources实现的回调在创建之后就会得到通知</p></blockquote><blockquote><p>**IXposedHookLoadPackage ** 所有的包</p><p>Get notified when an app (“Android package”) is loaded. This is especially useful to hook some app-specific methods.</p><p>This interface should be implemented by the module’s main class. Xposed will take care of registering it as a callback automatically.</p><p>xposed会将handleLoadPackage注册成为回调，app在加载时都会经过该回调，主要用来实现具体的hook逻辑。</p></blockquote><p>在handleLoadPackage中调用了ModStatusbarColor.init</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (lpparam.packageName.equals(ModStatusbarColor.PACKAGE_NAME)) &#123;</span><br><span class="line">    ModStatusbarColor.init(prefs, lpparam.classLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public static final String PACKAGE_NAME &#x3D; &quot;com.android.systemui&quot;; </span><br><span class="line">private static final String CLASS_PHONE_STATUSBAR &#x3D; &quot;com.android.systemui.statusbar.phone.PhoneStatusBar&quot;;</span><br><span class="line">   public static void init(final XSharedPreferences prefs, final ClassLoader classLoader) &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">           &#x2F;&#x2F; findClass底层通过反射获取CLASS_PHONE_STATUSBAR类</span><br><span class="line">           final Class&lt;?&gt; phoneStatusbarClass &#x3D; XposedHelpers.findClass(CLASS_PHONE_STATUSBAR, classLoader);</span><br><span class="line">           final Class&lt;?&gt; statusbarIconViewClass &#x3D; XposedHelpers.findClass(CLASS_STATUSBAR_ICON_VIEW, classLoader);</span><br><span class="line">           final Class&lt;?&gt; sbTransitionsClass &#x3D; XposedHelpers.findClass(CLASS_SB_TRANSITIONS, classLoader);</span><br><span class="line"></span><br><span class="line">           XposedHelpers.findAndHookMethod(phoneStatusbarClass, </span><br><span class="line">           &#x2F;&#x2F; hook相同的类时XCallback.PRIORITY_LOWEST最低,优先级最高</span><br><span class="line">           &#x2F;&#x2F; https:&#x2F;&#x2F;api.xposed.info&#x2F;reference&#x2F;de&#x2F;robv&#x2F;android&#x2F;xposed&#x2F;XC_MethodHook.html</span><br><span class="line">                   &quot;makeStatusBarView&quot;, new XC_MethodHook(XCallback.PRIORITY_LOWEST) &#123;</span><br><span class="line">               @Override</span><br><span class="line">               protected void afterHookedMethod(final MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                   mPhoneStatusBar &#x3D; param.thisObject;</span><br><span class="line">                   &#x2F;&#x2F; getObjectField获取对象的属性值</span><br><span class="line">                   &#x2F;&#x2F; https:&#x2F;&#x2F;api.xposed.info&#x2F;reference&#x2F;de&#x2F;robv&#x2F;android&#x2F;xposed&#x2F;XposedHelpers.html</span><br><span class="line">                   Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br><span class="line"></span><br><span class="line">                   if (SysUiManagers.IconManager !&#x3D; null) &#123;</span><br><span class="line">                       SysUiManagers.IconManager.registerListener(mIconManagerListener);</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   Intent i &#x3D; new Intent(ACTION_PHONE_STATUSBAR_VIEW_MADE);</span><br><span class="line">                   context.sendBroadcast(i);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125; catch (Throwable t) &#123;</span><br><span class="line">           GravityBox.log(TAG, t);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>由于<code>com.android.systemui</code>和当前hook的包在不同进程中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.android.systemui explore</span><br><span class="line">android hooking search classes com.android.systemui ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname com.android.systemui.statusbar.phone.PhoneStatusBar</span><br></pre></td></tr></table></figure><p><strong>静态域</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BRIGHTNESS_ON &#x3D; XposedHelpers.getStaticIntField(powerManagerClass, &quot;BRIGHTNESS_ON&quot;);</span><br><span class="line">plugin wallbreaker classdump --fullname android.os.PowerManager  查看静态域</span><br><span class="line">(int[])XposedHelpers.getStaticObjectField(classAudioService, &quot;MAX_STREAM_VOLUME&quot;);</span><br><span class="line">XposedHelpers.getStaticLongField(param.thisObject.getClass(),&quot;SWIPE_TIMEOUT_MS&quot;)</span><br><span class="line">(boolean) XposedHelpers.getStaticBooleanField(mDisplayPowerController.getClass(), &quot;MTK_ULTRA_DIMMING_SUPPORT&quot;);</span><br></pre></td></tr></table></figure><p><strong>动态域</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.getObjectField(param.thisObject, &quot;mNotification&quot;) &#x3D;&#x3D; null</span><br><span class="line">objection -g com.ceco.nougat.gravitybox explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">android heap search instances com.android.systemui.statusbar.phone.PhoneStatusBar  内存搜索PhoneStatusBar类实例</span><br><span class="line">plugin wallbreaker objectsearch com.android.systemui.statusbar.phone.PhoneStatusBar  内存搜索对象</span><br><span class="line">plugin wallbreaker objectiondump --fullname 0x100e6e  查看类内容中的动态域mNotification</span><br></pre></td></tr></table></figure><p><strong>主动调用</strong></p><p><a href="https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html" target="_blank" rel="noopener">https://api.xposed.info/reference/de/robv/android/xposed/XposedHelpers.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Float) XposedHelpers.callMethod(param.thisObject, &quot;getNonBatteryClockAlphaFor&quot;, (Integer) param.args[0]);</span><br><span class="line">XposedHelpers.callStaticMethod(mClsPhoneFactory, &quot;getPhone&quot;, mSimSlot);</span><br><span class="line">plugin wallbreaker objectsearch com.android.systemui.statusbar.phone.PhoneStatusBarTransitions</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x10141e   查找getNonBatteryClockAlphaFor方法</span><br><span class="line">int phoneId &#x3D; XposedHelpers.getIntField(param.thisObject, &quot;mPhoneId&quot;);</span><br><span class="line">Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br></pre></td></tr></table></figure><p><strong>构造函数</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookConstructor(&quot;android.media.AudioManager&quot;, classLoader, Context.class,</span><br><span class="line">        new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        Object objService &#x3D; XposedHelpers.callMethod(param.thisObject, &quot;getService&quot;);</span><br><span class="line">        Context mApplicationContext &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject,</span><br><span class="line">                &quot;mApplicationContext&quot;);</span><br><span class="line">        if (objService !&#x3D; null &amp;&amp; mApplicationContext !&#x3D; null) &#123;</span><br><span class="line">            XposedHelpers.callMethod(param.thisObject, &quot;disableSafeMediaVolume&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">android hooking search classes android.media.AudioManger</span><br><span class="line">plugin wallbreaker objectsearch android.media.AudioManager</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x186e  查看getService和disableSafeMediaVolume和mApplicationContext</span><br></pre></td></tr></table></figure><h2 id="Not-In-Frida"><a href="#Not-In-Frida" class="headerlink" title="Not In Frida"></a>Not In Frida</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">setAdditionalInstanceField(param.thisObject, &quot;mVolumeUpLongPress&quot;, mVolumeUpLongPress);  给对象加静态域</span><br><span class="line">Object ls &#x3D; XposedHelpers.getSurroundingThis(mLight);  内部类对象返回给外部类</span><br><span class="line">Class[] params &#x3D; method.getParameterTypes();  获取参数列表</span><br><span class="line">UserHandle uh &#x3D; (UserHandle) uhConst.newInstance(-2);  创建新实例对象</span><br><span class="line">Constructor&lt;?&gt; uhConst &#x3D; XposedHelpers.findConstructorExact(UserHandle.class, int.class);  查找一个构造函数让其可用</span><br><span class="line">XposedBridge.hookAllConstructors(XposedHelpers.findClass(  hook所有构造函数</span><br><span class="line">        CLASS_TRUST_MANAGER_SERVICE, classLoader), new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(final MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        mTrustManager &#x3D; param.thisObject;</span><br><span class="line">        Context context &#x3D; (Context) XposedHelpers.getObjectField(param.thisObject, &quot;mContext&quot;);</span><br><span class="line">        mWifiManager &#x3D; new WifiManagerWrapper(context, null);</span><br><span class="line">        mConnectivityManager &#x3D; (ConnectivityManager) context.getSystemService(</span><br><span class="line">                Context.CONNECTIVITY_SERVICE);</span><br><span class="line"></span><br><span class="line">        IntentFilter intentFilter &#x3D; new IntentFilter();</span><br><span class="line">        intentFilter.addAction(WifiPriorityActivity.ACTION_WIFI_TRUSTED_CHANGED);</span><br><span class="line">        intentFilter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);</span><br><span class="line">        context.registerReceiver(mBroadcastReceiver, intentFilter);</span><br><span class="line"></span><br><span class="line">        if (DEBUG) log(&quot;Trust manager constructed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">XposedBridge.hookMethod(mtdHandlePlay, new XC_MethodHook() &#123;   hook所有方法并创建回调</span><br><span class="line">    @Override</span><br><span class="line">    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        qhPrefs.reload();</span><br><span class="line">        QuietHours qh &#x3D; new QuietHours(qhPrefs);</span><br><span class="line">        if (qh.isSystemSoundMuted(QuietHours.SystemSound.RINGER)) &#123;</span><br><span class="line">            param.setResult(null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">        if (!mRingerConfig.enabled) return;</span><br><span class="line"></span><br><span class="line">        mRingtone &#x3D; (Ringtone) XposedHelpers.getObjectField(mAsyncRinger, &quot;mRingtone&quot;);</span><br><span class="line">        if (mRingtone &#x3D;&#x3D; null) &#123;</span><br><span class="line">            if (DEBUG) log(&quot;handlePlay called but ringtone is null&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setVolume(mRingerConfig.minVolume);</span><br><span class="line">        mIncrementAmount &#x3D; (1f - mRingerConfig.minVolume) &#x2F; (float) mRingerConfig.rampUpDuration;</span><br><span class="line">        mCurrentIncrementVolume &#x3D; mRingerConfig.minVolume;</span><br><span class="line">        mHandler &#x3D; (Handler) XposedHelpers.getObjectField(mAsyncRinger, &quot;mHandler&quot;);</span><br><span class="line">        mHandler.postDelayed(mRunnable, 1000);</span><br><span class="line">        if (DEBUG) log(&quot;Starting increasing ring&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>set(get)AdditionalInstanceField</li><li>getMD5Sum</li><li>getMethodDepth</li><li>getParameterTypes</li><li>getSurroundingThis</li><li>hookMethod</li><li>系统级别的，过滤所有的进程</li><li>只要Xposed生效了，可以把Xposed理解为系统框架，作为系统的本身来考虑没有关系。</li></ul><h2 id="Not-In-Xposed"><a href="#Not-In-Xposed" class="headerlink" title="Not In Xposed"></a>Not In Xposed</h2><ul><li>Java.choose</li><li>rpc</li><li>热重载/加载</li><li>单进程级别的，只能在hook的进程内生效</li></ul><h2 id="hook-1"><a href="#hook-1" class="headerlink" title="hook"></a>hook</h2><p>本项目中 xposed 系统级别的，过滤所有的进程，入口类中实现了三个接口，hook了所有的资源，进程，包。只会hook进程中的包等于ModStatusbarColor.PACKAGE_NAME即<code>com.android.systemui</code>时，才启动hook。所有逻辑不在GravityBox中，也不在xposed.jar中，而是在com.android.systemui</p><pre><code>if (lpparam.packageName.equals(ModStatusbarColor.PACKAGE_NAME)) {    ModStatusbarColor.init(prefs, lpparam.classLoader);}</code></pre><p>frida-ps -U |grep com.android.systemui</p><p>在app逆向中遇到interface搜索其实现还是一顿乱搜，可以使用反射getInterfaces得到实现的接口数组，然后打印出来即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function hook() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        console.log(&quot;start&quot;)</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch: function (loader) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if (loader.findClass(&quot;com.ceco.nougat.gravitybox.ModStatusbarColor$1&quot;)) &#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;de.robv.android.xposed.XC_MethodHook&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;com.roysue.xposed1.HookTest&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F; if(loader.findClass(&quot;de.robv.android.xposed.XposedBridge&quot;))&#123;</span><br><span class="line">                        &#x2F;&#x2F;if(loader.findClass(&quot;com.android.internal.statusbar.StatusBarIcon&quot;))&#123;</span><br><span class="line"></span><br><span class="line">                        console.log(&quot;Successfully found loader&quot;)</span><br><span class="line">                        console.log(loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (error) &#123;</span><br><span class="line">                    console.log(&quot;find error:&quot; + error)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;end1&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;de.robv.android.xposed.XposedBridge&quot;).log.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (str) &#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entering Xposedbridge.log &quot;,str.toString())</span><br><span class="line">        &#x2F;&#x2F;     return true</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">        &#x2F;&#x2F;traceClass(&quot;com.ceco.nougat.gravitybox.ModStatusbarColor&quot;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;com.roysue.xposed1.HookTest$1&quot;).afterHookedMethod.implementation &#x3D; function (param)&#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entering afterHookedMethod param is &#x3D;&gt; &quot;,param);</span><br><span class="line">        &#x2F;&#x2F;     return this.afterHookedMethod(param);</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">        &#x2F;&#x2F; traceClass(&quot;de.robv.android.xposed.XC_MethodHook&quot;)</span><br><span class="line">        &#x2F;&#x2F; Java.use(&quot;de.robv.android.xposed.XC_MethodHook$MethodHookParam&quot;).setResult.implementation &#x3D; function(str)&#123;</span><br><span class="line">        &#x2F;&#x2F;     console.log(&quot;entersing de.robv.android.xposed.XC_MethodHook$MethodHookParam setResult &#x3D;&gt; &quot;,str)</span><br><span class="line">        &#x2F;&#x2F;     console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">        &#x2F;&#x2F;     return this.setResult(str);</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line"></span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch: function (className) &#123;</span><br><span class="line">                if (className.toString().indexOf(&quot;gravitybox&quot;) &gt; 0 &amp;&amp;</span><br><span class="line">                    className.toString().indexOf(&quot;$&quot;) &gt; 0</span><br><span class="line">                ) &#123;</span><br><span class="line">                    console.log(&quot;found &#x3D;&gt; &quot;, className)</span><br><span class="line">                    &#x2F;&#x2F; var interFaces &#x3D; Java.use(className).class.getInterfaces();</span><br><span class="line">                    &#x2F;&#x2F; if(interFaces.length&gt;0)&#123;</span><br><span class="line">                    &#x2F;&#x2F;     console.log(&quot;interface is &#x3D;&gt; &quot;);</span><br><span class="line">                    &#x2F;&#x2F;     for(var i in interFaces)&#123;</span><br><span class="line">                    &#x2F;&#x2F;         console.log(&quot;\t&quot;,interFaces[i].toString())</span><br><span class="line">                    &#x2F;&#x2F;     &#125;</span><br><span class="line">                    &#x2F;&#x2F; &#125;</span><br><span class="line">                    if (Java.use(className).class.getSuperclass()) &#123;</span><br><span class="line">                        var superClass &#x3D; Java.use(className).class.getSuperclass().getName();</span><br><span class="line">                        &#x2F;&#x2F; console.log(&quot;superClass is &#x3D;&gt; &quot;,superClass);</span><br><span class="line">                        if (superClass.indexOf(&quot;XC_MethodHook&quot;) &gt; 0) &#123;</span><br><span class="line">                            console.log(&quot;found class is &#x3D;&gt; &quot;, className.toString())</span><br><span class="line">                            traceClass(className);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, onComplete: function () &#123;</span><br><span class="line">                console.log(&quot;search completed!&quot;)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        console.log(&quot;end2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xposed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>违法应用移动TV取证分析</title>
      <link href="2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/"/>
      <url>2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><h2 id="应用层抓包"><a href="#应用层抓包" class="headerlink" title="应用层抓包"></a><strong>应用层抓包</strong></h2><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/t01c2d220dfd81d4d18.png" alt="img"></p><h2 id="传输层抓包"><a href="#传输层抓包" class="headerlink" title="传输层抓包"></a><strong>传输层抓包</strong></h2><p>charles开启Enable socks proxy</p><p>wget  <a href="https://www.charlesproxy.com/assets/release/4.6.1/charles-proxy-4.6.1_amd64.tar.gz?k=17bcbd3dc2" target="_blank" rel="noopener">https://www.charlesproxy.com/assets/release/4.6.1/charles-proxy-4.6.1_amd64.tar.gz?k=17bcbd3dc2</a></p><p>tar zxf charles-proxy-4.6.1_amd64.tar.gz &amp;&amp; ./charles 通过<a href="https://www.charles.ren/" target="_blank" rel="noopener">注册码</a>注册或生成加权<a href="https://www.zzzmode.com/mytools/charles/" target="_blank" rel="noopener">jar包</a>破解</p><p>vim ~/.zshrc  并source ~/.zshrc  使得charles在任意路径可启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&quot;&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;ndk-bundle:&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;platform-tools:$&#123;JAVA_HOME&#125;&#x2F;bin:$PATH:&#x2F;root&#x2F;Desktop&#x2F;charles&#x2F;bin:&#x2F;root&#x2F;Desktop&#x2F;jadx-1.2.0&#x2F;bin&quot;</span><br></pre></td></tr></table></figure><p>htop   查看破解情况</p><p>电脑：192.168.0.106</p><p>手机：192.168.0.102</p><p>虚拟机：192.168.0.107</p><p>虚拟网络编辑器选择获取ip的网卡，保证这三台机器在同一局域网内且互相ping通。</p><h3 id="配置charles"><a href="#配置charles" class="headerlink" title="配置charles"></a>配置charles</h3><p>socks proxy工作于传输层，更好的观察应用层协议和socks抓包。</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211129237.png" alt="image-20210422211129237"></p><p>开启ssl</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211216544.png" alt="image-20210422211216544"></p><h3 id="postern"><a href="#postern" class="headerlink" title="postern"></a>postern</h3><p>adb install 0714com.tunnelworkshop.postern_2018-10-07.apk</p><p>QtScrcpy 设置投屏</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211526433.png" alt="image-20210422211526433"></p><p>配置socks5抓包代理</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211731524.png" alt="image-20210422211731524"></p><p>配置socks5抓包配置规则</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422211826284.png" alt="image-20210422211826284"></p><p>打开socks vpn连接虚拟机抓包，虚拟机收到连接请求后点击Allow</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422212010520.png" alt="image-20210422212010520"></p><p>在手机浏览器输入地址 chls.pro/ssl 或者 charlesproxy.com/getssl ，出现证书安装页面，点击安装，如果依旧app抓不到，需要把个人证书放到系统根目录</p><blockquote><p>Android8</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added&#x2F;</span><br><span class="line">mount -o remount,rw &#x2F;</span><br><span class="line">chmod 777 *</span><br><span class="line">cp * &#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mount -o remount,ro &#x2F;</span><br></pre></td></tr></table></figure><p>Android 7</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added&#x2F;</span><br><span class="line">mount -o rw,remount &#x2F;system</span><br><span class="line">chmod 777 *</span><br><span class="line">cp * &#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mount -o ro,remount &#x2F;system</span><br></pre></td></tr></table></figure></blockquote><h2 id="movetv分析"><a href="#movetv分析" class="headerlink" title="movetv分析"></a>movetv分析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;fs1428arm64 </span><br><span class="line">pyenv local 3.8.5</span><br><span class="line">frida -UF -l hookSocket.js -o moveTV.txt  attach方式hook登录抓包，基于socks层抓包无法对抗，除非做了VPN检测</span><br><span class="line">frida -U -f com.cz.babySister -l hookSocket.js -o moveTV.txt   spawn方式hook，输入%resume重新启动，或者直接在命令后加--no-pause</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422213451714.png" alt="image-20210422213451714"></p><p>jadx-gui movetv.apk 已经加壳一个Activity都找不到</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422214547118.png" alt="image-20210422214547118"></p><h1 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h1><h2 id="FRIDA-DEXDump"><a href="#FRIDA-DEXDump" class="headerlink" title="FRIDA-DEXDump"></a>FRIDA-DEXDump</h2><p>git clone <a href="https://github.com/hluwa/FRIDA-DEXDump.git" target="_blank" rel="noopener">https://github.com/hluwa/FRIDA-DEXDump.git</a>  启动app放在前台</p><p>cd ~/Desktop/FRIDA-DEXDump/frida_dexdump &amp;&amp; python main.py 开始脱壳</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422220211650.png" alt="image-20210422220211650"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities  查看所有Activity</span><br><span class="line">grep -ril &quot;MainActivity&quot; *  从脱下的dex中查找MainActivity</span><br><span class="line">grep -ril &quot;LoginActivity&quot; *</span><br><span class="line">jadx-gui com.cz.babySister&#x2F;0x748d44201c.dex</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422220645424.png" alt="image-20210422220645424"></p><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>抓登录包获取memi1字段其实来源于android-id</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423013934848.png" alt="image-20210423013934848"></p><p>android hooking watch class com.cz.babySister.activity.LoginActivity –dump-args  –dump-backtrace –dump-return  hook类中所有方法</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014732415.png" alt="image-20210423014732415"></p><p>android hooking watch class_method com.cz.babySister.activity.LoginActivity.b –dump-args –dump-backtrace –dump-return  hook登录b方法</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014946081.png" alt="image-20210423014946081"></p><p>进入b方法中调用的RunnableC0042q类中</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015105146.png" alt="image-20210423015105146"></p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015154139.png" alt="image-20210423015154139"></p><p>android hooking watch class_method com.cz.babySister.c.a.a –dump-args –dump-backtrace –dump-return    hook方法a</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015411937.png" alt="image-20210423015411937"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore</span><br><span class="line">android hooking search classes Settings </span><br><span class="line">android hooking list class_methods android.provider.Settings </span><br><span class="line">android hooking list class_methods android.provider.Settings$Secure</span><br><span class="line">android hooking watch class_method android.provider.Settings$Secure.getString --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423013626273.png" alt="image-20210423013626273"></p><p>通过hook获取返回的结果50463fa80244d95f和chales中抓包的memi1完全一致</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423014359588.png" alt="image-20210423014359588"></p><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>android hooking watch class_method com.cz.babySister.c.a.a –dump-args –dump-backtrace –dump-return</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015832197.png" alt="image-20210423015832197"></p><p>对比抓包结果</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423015906716.png" alt="image-20210423015906716"></p><h3 id="取证实现"><a href="#取证实现" class="headerlink" title="取证实现"></a>取证实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line">class tv:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.root &#x3D; &#39;http:&#x2F;&#x2F;39.108.64.125&#x2F;WebRoot&#x2F;superMaster&#x2F;Server&#39;</span><br><span class="line">        self.memi1 &#x3D; &quot;50463fa80244d95f&quot;</span><br><span class="line">        self.rightkey &#x3D; &quot;376035775&quot;</span><br><span class="line">        self.key &#x3D; &quot;308202d5308201bda00302010202041669d9bf300d06092a864886f70d01010b0500301b310b3009060355040613023836310c300a06035504031303776569301e170d3136303731383038313935395a170d3431303731323038313935395a301b310b3009060355040613023836310c300a0603550403130377656930820122300d06092a864886f70d01010105000382010f003082010a028201010095f85892400aae03ca4ed9dcd838d162290ae8dd51939aac6ecfde8282f207c4cd9e507929a279e0a36f1e4847330cb53908c92915b2c6a93d7064be452d073a472093f7ca14f4ab68f827582fe0988e9e4bc8a6ea3b56001cbbbb760f9eec571b0bbc97392e65aaf08c686f0e2ba353896d48a37c36716239977bd0e4dd878025cab497d8164537aec9f6599eefb98577dce972a1b794e211226520e23497beec3fd8548bb5b4d263120d40115cca28116bac32378df5033f536a0d7367fef78c587fefed28c5c9b35ba684ed6e46d9369c40950cf7ad7236d10b7a51dfd2a8f218db72323bbd19f46947410b1191f263012ad4ba8f749223e37591254ee7f50203010001a321301f301d0603551d0e041604143d43284bd5e4b0d322c9962a5b70aad4dcbc3634300d06092a864886f70d01010b050003820101000f04c51ff763311aa011777ba2842b441b15c316373d1e1ed4116cf86e29d55c6ed3fa4c475251b1fb4fac57195dbca0166ebe565d9834552a3758b97c4528bab1f7ab82bb3a9faa932f5bc10943f3daf52e0fe5889ffb58a6be67ea1c9a2fb37dc8aa6f3af476039a467336991a4e52dccd520195cd473eb5b984e702ed9ff638a14c3abb575a7a80ae4062084d1138a06a20e173be9df32df631311b07352898706198ddebaaa011f0da8e5f288f7cfb77505bc943f6476d6cc1feef56b68137aad91f23c4bb772169539d05653a6f0d75f7192164e822b934322f3a975df677903b1667f5dc1e9ddb185da3281d31bfb8f67a84bd23bbcb398f8bb637dd72&quot;</span><br><span class="line"></span><br><span class="line">    def post(self, data&#x3D;None):</span><br><span class="line">        if data is None:</span><br><span class="line">            data &#x3D; &#123;&#125;</span><br><span class="line">        return requests.post(url&#x3D;self.root, data&#x3D;data)</span><br><span class="line"></span><br><span class="line">    def query(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password&#125;)</span><br><span class="line">        print(&quot;query result is : &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def register(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password, &#39;memi1&#39;: self.memi1,</span><br><span class="line">                        &#39;key&#39;: self.key, &#39;rightkey&#39;: self.rightkey, &#39;register&#39;: &#39;register&#39;&#125;)</span><br><span class="line">        print(&quot;Register response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def login(self, name, password):</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password, &#39;memi1&#39;: self.memi1,</span><br><span class="line">                        &#39;key&#39;: self.key, &#39;rightkey&#39;: self.rightkey, &#39;login&#39;: &#39;login&#39;&#125;)</span><br><span class="line">        print(&quot;Login response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">    def updateSocre(self, name, password, jifen):</span><br><span class="line">        t &#x3D; int(round(time.time() * 1000))</span><br><span class="line">        sign &#x3D; base64.b64encode(str(5 * t).encode(&#39;utf-8&#39;)).decode(&#39;utf-8&#39;)</span><br><span class="line">        ret &#x3D; self.post(&#123;&#39;name&#39;: name, &#39;pass&#39;: password,</span><br><span class="line">                        &#39;jifen&#39;: jifen, &#39;time&#39;: t, &#39;sign&#39;: sign&#125;)</span><br><span class="line">        print(&quot;UpdataScore response data: &quot;)</span><br><span class="line">        print(ret.content.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    tv &#x3D; tv()</span><br><span class="line"></span><br><span class="line">    # print(tv.query(&quot;eeeeffff&quot;, &quot;gggghhhh&quot;))</span><br><span class="line"></span><br><span class="line">    # 注册账号</span><br><span class="line"></span><br><span class="line">    print(tv.register(&quot;onejane3&quot;, &quot;123456&quot;))</span><br><span class="line"></span><br><span class="line">    # time.sleep(3)</span><br><span class="line"></span><br><span class="line">    # 登录账号</span><br><span class="line">    print(tv.login(&quot;onejane3&quot;, &quot;123456&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 更新积分</span><br><span class="line">    # print(tv.updateSocre(&quot;mee4&quot;,&quot;mee4&quot;,&quot;1000&quot;))</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423020347585.png" alt="image-20210423020347585"></p><h2 id="Youpk"><a href="#Youpk" class="headerlink" title="Youpk"></a>Youpk</h2><p><a href="https://bbs.pediy.com/thread-259854.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-259854.htm</a></p><p>linux平台下载最新的platform-tools刷机的时候，fastboot会报各种unknow command或接近的错误，把fastboot文件替换成以下随着aosp一起编译出来的即可：</p><blockquote><p>fastboot_aosp7.1.zip</p><p>fastboot6.0.zip</p><p>fastboot8.1.0r1.zip</p></blockquote><p>下载Youpk_v1.1</p><ol><li>重启至bootloader: <code>adb reboot bootloader</code></li><li>解压 Youpk_sailfish.zip 并双击 <code>flash-all.bat</code>,（尽量在kali上刷机，<code>./flash-all.sh</code>,因为windows会给我们的编程生涯带来80%的苦难）</li></ol><blockquote><p>adb install movetv.apk</p><p>adb shell “echo com.cz.babySister &gt;&gt; /data/local/tmp/unpacker.config”</p></blockquote><ol start="3"><li>启动apk等待脱壳，每隔10秒将自动重新脱壳(已完全dump的dex将被忽略), 当日志打印unpack end时脱壳完成</li></ol><blockquote><p>adb pull /data/data/com.cz.babySister/unpacker/</p><p>mv unpacker youpk/    </p></blockquote><ol start="4"><li>调用修复工具 dexfixer.jar, 两个参数, 第一个为dump文件目录(必须为有效路径), 第二个为重组后的DEX目录(不存在将会创建)<blockquote><pre><code>java -jar dexfixer.jar youpk/ youpk_out/jadx-gui _data_app_com.cz.babySister-1_base.apk_54276.dex  查看脱壳后的dex </code></pre></blockquote></li></ol><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422224021639.png" alt="image-20210422224021639"></p><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol><li>整体加固</li><li>抽取:<ul><li>nop占坑型(类似某加密)</li><li>naitve化, 在<clinit>中解密(类似早期阿里)</clinit></li><li>goto解密型(类似新版某加密?najia): <a href="https://bbs.pediy.com/thread-259448.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-259448.htm</a></li></ul></li></ol><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol><li>dump中途退出或卡死，重新启动进程，再次等待脱壳即可</li><li>当前仅支持被壳保护的dex, 不支持App动态加载的dex/jar</li></ol><h2 id="fart"><a href="#fart" class="headerlink" title="fart"></a>fart</h2><p>脱抽取型壳并回填dex</p><h3 id="安装新环境"><a href="#安装新环境" class="headerlink" title="安装新环境"></a>安装新环境</h3><p>vim /etc/proxychains4.conf  配置代理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">socks5  192.168.0.106 1080</span><br><span class="line">#http 127.0.0.1 12333</span><br></pre></td></tr></table></figure><p>主机192.168.0.106 ssr开启运行局域网连接</p><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210423001429267.png" alt="image-20210423001429267"></p><p>配置新环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains pyenv install 3.9.0  创建python3.9.0环境</span><br><span class="line">PYTHON_CONFIGURE_OPTS&#x3D;&quot;--disable-ipv6&quot; proxychains pip install objection&#x3D;&#x3D;1.9.5  安装objection 1.9.5套件包括frida-tools 9.2.4，frida 14.2.16</span><br></pre></td></tr></table></figure><p>wget <a href="https://github.com/frida/frida/releases/download/14.2.16/frida-server-14.2.16-android-arm64.xz" target="_blank" rel="noopener">frida-server-14.2.16-android-arm64.xz</a></p><p>7z x <a href="https://github.com/frida/frida/releases/download/14.2.16/frida-server-14.2.16-android-arm64.xz" target="_blank" rel="noopener">frida-server-14.2.16-android-arm64.xz</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push ~&#x2F;Desktop&#x2F;frida-server-14.2.16-android-arm64 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;</span><br><span class="line">adb shell</span><br><span class="line">mv &#x2F;data&#x2F;local&#x2F;tmp&#x2F;frida-server-14.2.16-android-arm64 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64  </span><br><span class="line">chmod 777 &#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64</span><br><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1426arm64</span><br></pre></td></tr></table></figure><p>事实证明，新版本不兼容还是用12.8.0的frida吧</p><h3 id="调用fart"><a href="#调用fart" class="headerlink" title="调用fart"></a>调用fart</h3><p>基于hook和反射脱壳，对比发现youpk最优秀。</p><blockquote><p>adb reboot bootloader</p><p>cd ~/Desktop/sailfish-nzh54d  安卓8.0</p><p>./flash-all.sh  刷回去</p><p><a href="https://onejane.github.io/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/#Pixel">root及基础配置</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">adb push Magisk-v20.4.zip &#x2F;sdcard    </span><br><span class="line">adb push magisk-riru-v21.3.zip &#x2F;sdcard&#x2F;Download 使用magisk模块安装并重启</span><br><span class="line">adb push magisk-EdXposed-SandHook-v0.4.5.1_beta.4463.-release.zip &#x2F;sdcard&#x2F;Download  使用magisk模块安装并重启</span><br><span class="line">adb install EdXposedManager-4.5.7-45700-org.meowcat.edxposed.manager-release.apk    安装xposed</span><br><span class="line">adb push MagiskHidePropsConf-v5.3.4.zip &#x2F;sdcard&#x2F;Download   </span><br><span class="line">adb install JustTrustMePlus-debug.apk  用于结合xposed突破SSL Pinning抓包限制</span><br><span class="line">adb reboot bootloader</span><br><span class="line">fastboot boot twrp-3.4.0-0-sailfish.img   进入recovery mode</span><br><span class="line">install Magisk-v20.4.zip</span><br><span class="line">adb install MagiskManager-v7.5.1.apk  模块安装MagiskHidePropsConf，riru，EdXposed，</span><br><span class="line">adb shell su通过Magisk获取root权限</span><br><span class="line">settings put global captive_portal_http_url https:&#x2F;&#x2F;www.google.cn&#x2F;generate_204  去除wifi上的×</span><br><span class="line">settings put global captive_portal_https_url https:&#x2F;&#x2F;www.google.cn&#x2F;generate_204</span><br><span class="line">settings put global ntp_server 1.hk.pool.ntp.org  修改时区</span><br><span class="line">props  Edit MagiskHide props--ro.debuggable  设置全局可调试，getprop ro.debuggable 即可查看1,开启全局可调试</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pyenv local 3.8.0</span><br><span class="line">proxychains4 wget https:&#x2F;&#x2F;github.com&#x2F;hanbinglengyue&#x2F;FART.git</span><br><span class="line">7z x frida_fart.zip  &amp;&amp; adb push lib&#x2F;fart* &#x2F;data&#x2F;app &amp;&amp; chmod 777 *.so   如果没有权限，放到&#x2F;sdcard中再放入&#x2F;data&#x2F;app</span><br><span class="line">cd Desktop&#x2F;FART-master&#x2F;frida_fart&#x2F; &amp;&amp; frida -UF -l frida_fart_reflection.js   attach模式启动</span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_reflection.js --no-pause  spawn模式启动</span><br><span class="line">fart() 全量主动调用</span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_hook.js --no-pause  基于安卓8，生成dex，hook连壳一起脱</span><br></pre></td></tr></table></figure><p><img src="/2021/04/21/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8%E7%A7%BB%E5%8A%A8TV%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210422234838689.png" alt="image-20210422234838689"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb pull &#x2F;sdcard&#x2F;com.cz.babySister.activity</span><br><span class="line">grep -ril &quot;LoginActivity&quot; *.dex</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fart </tag>
            
            <tag> postern </tag>
            
            <tag> charles </tag>
            
            <tag> youpk </tag>
            
            <tag> dexdump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之selenium登陆获取阿里腾讯cookie</title>
      <link href="2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/"/>
      <url>2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>selenium本身是自动化测试框架，只是在爬虫领域更能够显示出其一把梭的威力，所有网站比如淘宝，微博等必须登录状态才能访问页面，对数据进行抓取时，逆向分析js将是一条不归路，而自动化测试框架selenium完全模拟人的行为模式，对网站按钮的点击，元素的获取，内容文本的输入有着得天独厚的优势。不过相对于逆向加密参数执行的爬虫程序来说，selenium还是太过效率低下了，常规套路一般是通过selenium拿到cookie或者token后，再通过爬虫程序去抓取页面，事半功倍。</p><h1 id="Alimama实战"><a href="#Alimama实战" class="headerlink" title="Alimama实战"></a>Alimama实战</h1><p>以阿里妈妈后台为例，通过分析我们拿到了请求json来自于<a href="https://pub.alimama.com/campaign/joinedSpecialCampaigns.json?toPage=1&amp;status=2&amp;perPageSize=40" target="_blank" rel="noopener">https://pub.alimama.com/campaign/joinedSpecialCampaigns.json?toPage=1&amp;status=2&amp;perPageSize=40</a></p><p>不过单独访问该页面，会将我们地址重定向到登录界面，这种网站就必须我们登录再发起请求抓取数据了。</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210421103951060.png" alt="image-20210421103951060"></p><h2 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h2><p>该登录页面是淘宝的统一登录框架，右键重新加载时抓包拿到框架地址，去除无用参数拿到原始地址<a href="https://login.taobao.com/member/login.jhtml?style=mini&amp;newMini2=true&amp;from=alimama%EF%BC%8C%E9%81%BF%E5%85%8D%E5%85%B6%E4%BB%96%E8%AF%B7%E6%B1%82%E5%B9%B2%E6%89%B0%E6%88%91%E4%BB%AC%E7%9A%84%E5%88%A4%E6%96%AD%E3%80%82" target="_blank" rel="noopener">https://login.taobao.com/member/login.jhtml?style=mini&amp;newMini2=true&amp;from=alimama，避免其他请求干扰我们的判断。</a></p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210421104149706.png" alt="image-20210421104149706"></p><p>步骤如下：</p><ol><li>获取账户，密码，滑块，按钮的元素位置</li><li>输入账户密码</li><li>判断滑块存在并滑动滑块</li><li>点击登录</li><li>保存cookie并调用cookie发起请求</li></ol><h2 id="chromedriver初始化"><a href="#chromedriver初始化" class="headerlink" title="chromedriver初始化"></a>chromedriver初始化</h2><p>根据本机的chrome版本获取selenium的驱动程序chromedriver版本</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/1191440-20180518111350337-1231574403.png" alt="img"></p><h3 id="特征隐藏"><a href="#特征隐藏" class="headerlink" title="特征隐藏"></a>特征隐藏</h3><p>面对一些网站通过ajax请求，同时携带一些难以破解加密参数，虽然selenium模拟浏览器行为操作，绕过这些反爬虫的手段，不过依旧有一些站点通过JavaScript 探测到Selenium启动的浏览器的天生存在的几十个特征来屏蔽这些爬虫的运行。通过<a href="https://bot.sannysoft.com/" target="_blank" rel="noopener">https://bot.sannysoft.com/</a> 可以查看当前浏览器的一些特征值，正常浏览器打开如下：</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210421110722900.png" alt="image-20210421110722900"></p><p>而通过selenium打开该网站时，部分特征被检测到，这就被安全人员拿来作为关键参数，禁止改浏览器的数据请求。</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210421110939009.png" alt="image-20210421110939009"></p><ol><li><p>比如某平台中对selenium的属性$cdc_asdjflasutopfhvcZLmcfl_做了校验，应对解决方案使用HexEdit 4.2修改chromedriver.exe 的$cdc_asdjflasutopfhvcZLmcfl_修改为同长度的字符串,如$ccccccccccccccccccccccccccc。</p></li><li><p>针对chrome弹窗请停用以开发者模式运行插件，可以通过Chrome.dll-patch75and76.exe放入chrome文件夹下包含包含chrome.dll文件的目录下并管理员身份执行。</p></li><li><p>针对CHROME正受到组件控制的提示，可以通过<code>chrome_options.add_experimental_option(&#39;excludeSwitches&#39;, [&#39;enable-automation&#39;])</code>实现屏蔽’CHROME正受到组件控制’的提示。</p></li><li><p>针对chrome自带密码保存对爬虫的干扰影响，通过<code>chrome_options.add_experimental_option(&quot;prefs&quot;, prefs)</code>屏蔽。</p></li><li><p>针对封禁ip可以通过<code>chrome_options.add_argument(&quot;--proxy-server=http://58.243.205.102:4543&quot;)</code>开启ip代理。</p></li><li><p>设置请求头UA,<code>browser.execute_cdp_cmd(&#39;Network.setUserAgentOverride&#39;, {&quot;userAgent&quot;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.97 Safari/537.36&#39;})</code></p></li><li><p>针对navigator属性中存在webdriver，新页面加载后<code>browser.execute_script(&#39;Object.defineProperty(navigator,&quot;webdriver&quot;,{get:() =&gt; false,});&#39;)</code>去除特征无效，可以通过CDP协议<code>browser.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, {&quot;source&quot;: &quot;&quot;&quot;Object.defineProperty(navigator, &#39;webdriver&#39;, {get: () =&gt; undefined})&quot;&quot;&quot;, })</code></p></li></ol><p>不过仅仅靠隐藏几个特征是毫无意义的，针对众多的特征已经有大牛为我们做了完美隐藏，那就是stealth.min.js</p><p>道高一尺魔高一丈，完整隐藏特征代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># chrome 版本78.0.3904.70，chromedriver版本78.0.3904.70</span><br><span class="line"># 设置代理</span><br><span class="line"># chrome_options.add_argument(&quot;--proxy-server&#x3D;http:&#x2F;&#x2F;58.243.205.102:4543&quot;)</span><br><span class="line"># chrome.exe --remote-debugging-port&#x3D;7222  本地启动selenium</span><br><span class="line"># chrome_options.add_experimental_option(&quot;debuggerAddress&quot;, &quot;127.0.0.1:7222&quot;)</span><br><span class="line">chrome_options &#x3D; Options()</span><br><span class="line"># 设置无头</span><br><span class="line">chrome_options.add_argument(&quot;--headless&quot;)</span><br><span class="line">chrome_options.add_argument(</span><br><span class="line">    &#39;user-agent&#x3D;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;86.0.4240.198 Safari&#x2F;537.36&#39;)</span><br><span class="line"># 屏蔽&#39;CHROME正受到组件控制&#39;的提示</span><br><span class="line">chrome_options.add_experimental_option(&#39;excludeSwitches&#39;, [&#39;enable-automation&#39;])</span><br><span class="line"># 屏蔽保存密码</span><br><span class="line">prefs &#x3D; &#123;&quot;&quot;: &quot;&quot;&#125;</span><br><span class="line">prefs[&quot;credentials_enable_service&quot;] &#x3D; False</span><br><span class="line">prefs[&quot;profile.password_manager_enabled&quot;] &#x3D; False</span><br><span class="line">chrome_options.add_experimental_option(&quot;prefs&quot;, prefs)</span><br><span class="line">driver &#x3D; Chrome(&#39;.&#x2F;chromedriver&#39;, options&#x3D;chrome_options)</span><br><span class="line">#driver.execute_script(&#39;Object.defineProperty(navigator,&quot;webdriver&quot;,&#123;get:() &#x3D;&gt; false,&#125;);&#39;)</span><br><span class="line">#driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;&quot;source&quot;: &quot;&quot;&quot;Object.defineProperty(navigator, &#39;webdriver&#39;, &#123;get: () &#x3D;&gt; undefined&#125;)&quot;&quot;&quot;, &#125;)</span><br><span class="line">#driver.execute_cdp_cmd(&#39;Network.setUserAgentOverride&#39;, &#123;&quot;userAgent&quot;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.97 Safari&#x2F;537.36&#39;&#125;)</span><br><span class="line">    </span><br><span class="line">driver.set_page_load_timeout(10)</span><br><span class="line">with open(&#39;.&#x2F;stealth.min.js&#39;) as f:</span><br><span class="line">    js &#x3D; f.read()</span><br><span class="line"></span><br><span class="line">driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;</span><br><span class="line">    &quot;source&quot;: js</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="保存cookie"><a href="#保存cookie" class="headerlink" title="保存cookie"></a>保存cookie</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">def save_cookies(self):</span><br><span class="line">    # 隐式等待，设置了一个最长等待时间</span><br><span class="line">    self.browser.implicitly_wait(10)</span><br><span class="line">    # 最大化窗口</span><br><span class="line">    self.browser.maximize_window()</span><br><span class="line">    # 向文本框发送账户密码</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;input[@name&#x3D;&quot;fm-login-id&quot;]&#39;).send_keys(&#39;***&#39;)</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;input[@name&#x3D;&quot;fm-login-password&quot;]&#39;).send_keys(&#39;***&#39;)</span><br><span class="line">    # 解决滑块</span><br><span class="line">    slide_block &#x3D; self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;nc_1_n1z&quot;]&#39;)</span><br><span class="line">    if (slide_block.is_displayed()):</span><br><span class="line">        # 点击移动滑块</span><br><span class="line">        action &#x3D; ActionChains(self.browser)</span><br><span class="line">        action.click_and_hold(on_element&#x3D;slide_block)</span><br><span class="line">        action.move_by_offset(xoffset&#x3D;258, yoffset&#x3D;0)</span><br><span class="line">        action.pause(0.5).release().perform()  # perform指定动作链</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;button[@class&#x3D;&quot;fm-button fm-submit password-login&quot;]&#39;).click()</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    if &quot;login_unusual&quot; in self.browser.current_url:</span><br><span class="line">        print(&quot;gg了，要手机验证码了，救命啊啊啊啊啊&quot;)</span><br><span class="line">        input(&quot;输入手机验证码啦：&quot;)</span><br><span class="line">    self.cookies &#x3D; &#39;; &#39;.join(</span><br><span class="line">        item for item in [item[&quot;name&quot;] + &quot;&#x3D;&quot; + item[&quot;value&quot;] for item in self.browser.get_cookies()])</span><br><span class="line">    with open(COOKIES_FILE_PATH, &#39;w&#39;, encoding&#x3D;&#39;utf-8&#39;) as file:</span><br><span class="line">        file.write(self.cookies)</span><br><span class="line">        print(&quot;cookie写入成功：&quot;, self.cookies)</span><br></pre></td></tr></table></figure><h2 id="使用cookie登录"><a href="#使用cookie登录" class="headerlink" title="使用cookie登录"></a>使用cookie登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def taobao_login(self):</span><br><span class="line">    print(&quot;登录中。。。。。&quot;)</span><br><span class="line">    ok &#x3D; False</span><br><span class="line">    while not ok:</span><br><span class="line">        with open(COOKIES_FILE_PATH, &#39;r+&#39;, encoding&#x3D;&#39;utf-8&#39;) as file:</span><br><span class="line">            self.headers[&quot;cookie&quot;] &#x3D; file.read()</span><br><span class="line">        response &#x3D; self.session.get(self.shop_plan_url, headers&#x3D;self.headers, verify&#x3D;False)</span><br><span class="line">        try:</span><br><span class="line">            ok &#x3D; json.loads(response.text)</span><br><span class="line">        except:</span><br><span class="line">            self.browser.get(self.alimama_login_url)</span><br><span class="line">            self.browser.delete_all_cookies()</span><br><span class="line">            self.save_cookies()</span><br><span class="line">        self.browser.close()</span><br><span class="line">        self.browser.quit()</span><br></pre></td></tr></table></figure><h1 id="Tencent实战"><a href="#Tencent实战" class="headerlink" title="Tencent实战"></a>Tencent实战</h1><p>由于腾讯优量汇中的报表不提供api，本次目标是抓取该报表中的广告收益数据。</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210429170106300.png" alt="image-20210429170106300"></p><p>通过抓包分析最关键的cookie为adnet_sso，只要拿到该cookie就可以成功请求数据，该cookie经过了cookie传递层层更新，太烦了，干脆selenium一把梭，登陆后拿到cookie存到文件中，访问api时添加cookie到header中即可。</p><h2 id="模拟登录-1"><a href="#模拟登录-1" class="headerlink" title="模拟登录"></a>模拟登录</h2><p><a href="https://sso.e.qq.com/login/hub?sso_redirect_uri=https://e.qq.com/dev/login&amp;service_tag=14" target="_blank" rel="noopener">https://sso.e.qq.com/login/hub?sso_redirect_uri=https%3A%2F%2Fe.qq.com%2Fdev%2Flogin&amp;service_tag=14</a></p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210429170627325.png" alt="image-20210429170627325"></p><p>我们肯定是避免扫码登录了，登录流程是当<code>QQ账号登录</code>界面出现时，点击<code>账号密码登录</code>，找到文本框输入qq号及密码后点击<code>授权并登录</code>按钮，获取selenium的cookie并保存到文件中，访问api数据时读取该cookie即可，如果异常则删除selenium的cookie重新登录保存cookie。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def adnet_login(self):</span><br><span class="line">    print(&quot;登录中。。。。。&quot;)</span><br><span class="line">    ok &#x3D; False</span><br><span class="line">    while not ok:</span><br><span class="line">        with open(COOKIES_FILE_PATH, &#39;r+&#39;, encoding&#x3D;&#39;utf-8&#39;) as file:</span><br><span class="line">            self.headers[&quot;cookie&quot;] &#x3D; file.read()</span><br><span class="line">        response &#x3D; self.session.post(self.get_date_url, data&#x3D;json.dumps(self.data), headers&#x3D;self.headers, verify&#x3D;False)</span><br><span class="line">        try:</span><br><span class="line">            res &#x3D; json.loads(response.text)</span><br><span class="line">            ok &#x3D; True</span><br><span class="line">        except:</span><br><span class="line">            self.browser.get(self.adnet_login_url)</span><br><span class="line">            self.browser.delete_all_cookies()</span><br><span class="line">            self.save_cookies()</span><br><span class="line">        self.browser.close()</span><br><span class="line">        self.browser.quit()</span><br></pre></td></tr></table></figure><p>初始化selenium的流程和Alimama的一致，腾讯广告的登录界面藏在<code>id=&quot;qqLoginFrame&quot;</code>的frame中的<code>id=&quot;ptlogin_iframe&quot;</code>的frame中，通过switch_to.frame直接切换到frame中获取元素，填写帐密实现登录保存cookie。</p><p><img src="/2021/04/21/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8Bselenium%E7%99%BB%E9%99%86%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E8%85%BE%E8%AE%AFcookie/image-20210429171239101.png" alt="image-20210429171239101"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def save_cookies(self):</span><br><span class="line">    self.browser.implicitly_wait(10)</span><br><span class="line">    self.browser.maximize_window()</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;a[@id&#x3D;&quot;qqLogin&quot;]&#39;).click()</span><br><span class="line">    # el_frame &#x3D; self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;qqLoginFrame&quot;]&#39;)</span><br><span class="line">    # print(self.browser.page_source)</span><br><span class="line">    self.browser.switch_to.frame(&#39;qqLoginFrame&#39;)</span><br><span class="line">    self.browser.switch_to.frame(&#39;ptlogin_iframe&#39;)</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;a[contains(text(),&quot;帐号密码登录&quot;)]&#39;).click()</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;u&quot;]&#39;).send_keys(&#39;*&#39;)</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;p&quot;]&#39;).send_keys(&#39;*&#39;)</span><br><span class="line">    self.browser.find_element_by_xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;loginform&quot;]&#x2F;div[@class&#x3D;&quot;submit&quot;]&#x2F;a&#39;).click()</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    self.cookies &#x3D; &#39;; &#39;.join(</span><br><span class="line">        item for item in [item[&quot;name&quot;] + &quot;&#x3D;&quot; + item[&quot;value&quot;] for item in self.browser.get_cookies()])</span><br><span class="line">    with open(COOKIES_FILE_PATH, &#39;w&#39;, encoding&#x3D;&#39;utf-8&#39;) as file:</span><br><span class="line">        file.write(self.cookies)</span><br><span class="line">        print(&quot;cookie写入成功：&quot;, self.cookies)</span><br></pre></td></tr></table></figure><h2 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h2><p>api请求是通过post提交payload格式的参数，爬虫实现如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def get_report_list(self):</span><br><span class="line">    # 获取所有shop plan</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            response &#x3D; self.session.post(self.get_date_url, data&#x3D;json.dumps(self.data), headers&#x3D;self.headers, verify&#x3D;False)</span><br><span class="line">            print(json.loads(response.text)[&quot;data&quot;][&quot;list&quot;])</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&#39;获取优量汇主页请求失败！&#39;)</span><br><span class="line">            self.adnet_login()</span><br><span class="line">            raise e</span><br></pre></td></tr></table></figure><h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><h2 id="不同系统"><a href="#不同系统" class="headerlink" title="不同系统"></a>不同系统</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chrome_options &#x3D; webdriver.ChromeOptions()</span><br><span class="line">if platform.system() &#x3D;&#x3D; &quot;Windows&quot;:</span><br><span class="line">    driver &#x3D; webdriver.Chrome(&#39;chromedriver.exe&#39;, chrome_options&#x3D;chrome_options)</span><br><span class="line">elif platform.system() &#x3D;&#x3D; &quot;Linux&quot;:</span><br><span class="line">    chrome_options.add_argument(&quot;--headless&quot;)</span><br><span class="line">    chrome_options.add_argument(&#39;--disable-gpu&#39;)</span><br><span class="line">    chrome_options.add_argument(&#39;--no-sandbox&#39;)</span><br><span class="line">    driver &#x3D; webdriver.Chrome(</span><br><span class="line">        executable_path&#x3D;&quot;&#x2F;usr&#x2F;bin&#x2F;chromedriver&quot;,</span><br><span class="line">        chrome_options&#x3D;chrome_options)</span><br></pre></td></tr></table></figure><h2 id="获取元素信息"><a href="#获取元素信息" class="headerlink" title="获取元素信息"></a>获取元素信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def get_data():</span><br><span class="line">    divs &#x3D; driver.find_elements_by_xpath(&#39;&#x2F;&#x2F;div[@class&#x3D;&quot;items&quot;]&#x2F;div[@class&#x3D;&quot;item J_MouserOnverReq  &quot;]&#39;)</span><br><span class="line">    for div in divs:</span><br><span class="line">        info &#x3D; div.find_element_by_xpath(&#39;.&#x2F;&#x2F;div[@class&#x3D;&quot;row row-2 title&quot;]&#x2F;a&#39;).text</span><br><span class="line">        price &#x3D; div.find_element_by_xpath(&#39;.&#x2F;&#x2F;strong&#39;).text</span><br><span class="line">        deal &#x3D; div.find_element_by_xpath(&#39;.&#x2F;&#x2F;div[@class&#x3D;&quot;deal-cnt&quot;]&#39;).text</span><br><span class="line">        shop &#x3D; div.find_element_by_xpath(&#39;.&#x2F;&#x2F;div[@class&#x3D;&quot;shop&quot;]&#x2F;a&#39;).text</span><br><span class="line">        print(info, price, deal, shop, sep&#x3D;&quot;|&quot;)</span><br><span class="line">        with open(&#39;taobao.csv&#39;, mode&#x3D;&#39;a&#39;, newline&#x3D;&quot;&quot;) as csvfile:</span><br><span class="line">            csvwrite &#x3D; csv.writer(csvfile, delimiter&#x3D;&#39;,&#39;)</span><br><span class="line">            csvwrite.writerow([info, price, deal, shop])</span><br><span class="line">browser.find_elements_by_xpath(&quot;&#x2F;&#x2F;div[@id&#x3D;&#39;J_DivItemDesc&#39;]&#x2F;descendant::*&#x2F;img&quot;)  查找后代元素      </span><br><span class="line">browser.find_elements_by_xpath(&quot;&#x2F;&#x2F;div[@id&#x3D;&#39;J_DivItemDesc&#39;]&#x2F;descendant::*&#x2F;img&quot;).tag_name  获取标签</span><br><span class="line">browser.find_elements_by_xpath(&quot;&#x2F;&#x2F;div[@id&#x3D;&#39;J_DivItemDesc&#39;]&#x2F;descendant::*&#x2F;img&quot;).get_attribute(&#39;value&#39;)  获取属性value信息或文本框信息</span><br><span class="line">js &#x3D; &#39;return document.getElementById(&quot;su&quot;).getAttribute(&quot;value&quot;)&#39;</span><br><span class="line">res &#x3D; driver.excute_script(js)  利用js获取元素属性值</span><br></pre></td></tr></table></figure><h2 id="鼠标操作"><a href="#鼠标操作" class="headerlink" title="鼠标操作"></a>鼠标操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">def get_data():</span><br><span class="line">    # 移动鼠标到距离元素的位置</span><br><span class="line">    title &#x3D; browser.find_element_by_xpath(&quot;&#x2F;&#x2F;div[@class&#x3D;&#39;title-bar&#39;]&quot;)</span><br><span class="line">    ActionChains(browser).move_to_element_with_offset(title, 100, 600).perform()</span><br><span class="line">    # 键盘指令</span><br><span class="line">    # browser.find_element_by_tag_name(&#39;body&#39;).send_keys(Keys.CONTROL + Keys.SHIFT + &#39;J&#39;)</span><br><span class="line">    # hover到指定元素</span><br><span class="line">    # ActionChains(browser).move_to_element(browser.find_elements_by_xpath(&#39;&#x2F;&#x2F;tbody[@mx-ie&#x3D;&quot;mouseover&quot;]&#x2F;tr&#39;)[1]).perform()</span><br><span class="line">    # 页面双击操作才能获取列表</span><br><span class="line">    ActionChains(browser).double_click(browser.find_element_by_xpath(&quot;&#x2F;&#x2F;body&quot;)).perform()</span><br><span class="line">    tr_list &#x3D; browser.find_elements_by_xpath(&#39;&#x2F;&#x2F;tbody[contains(@mx-ie,&quot;mouseover&quot;)]&#x2F;tr&#39;)</span><br><span class="line">    if len(tr_list) &#x3D;&#x3D; 0:</span><br><span class="line">        # 页面重载</span><br><span class="line">        browser.execute_script(&quot;location.reload()&quot;)</span><br><span class="line">        title &#x3D; browser.find_element_by_xpath(&quot;&#x2F;&#x2F;div[@class&#x3D;&#39;title-bar&#39;]&quot;)</span><br><span class="line">        # 鼠标移动位置</span><br><span class="line">        ActionChains(browser).move_to_element_with_offset(title, 100, 600).perform()</span><br><span class="line">        # 双击</span><br><span class="line">        ActionChains(browser).double_click(browser.find_element_by_xpath(&quot;&#x2F;&#x2F;body&quot;)).perform()</span><br><span class="line">        # 判断元素属性是否包含</span><br><span class="line">        tr_list &#x3D; browser.find_elements_by_xpath(&#39;&#x2F;&#x2F;tbody[contains(@mx-ie,&quot;mouseover&quot;)]&#x2F;tr&#39;)</span><br><span class="line">        # 滚轮直接滑到底部</span><br><span class="line">        browser.execute_script(&quot;window.scrollTo(0,document.body.scrollHeight);&quot;)</span><br></pre></td></tr></table></figure><h2 id="查找元素"><a href="#查找元素" class="headerlink" title="查找元素"></a>查找元素</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 通过不同的方式查找界面元素</span><br><span class="line">def findElement(by, value):</span><br><span class="line">    if (by &#x3D;&#x3D; &quot;id&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_id(value)</span><br><span class="line">        return element</span><br><span class="line">    elif (by &#x3D;&#x3D; &quot;name&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_name(value)</span><br><span class="line">        return element</span><br><span class="line">    elif (by &#x3D;&#x3D; &quot;xpath&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_xpath(value)</span><br><span class="line">        return element</span><br><span class="line">    elif (by &#x3D;&#x3D; &quot;classname&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_class_name(value)</span><br><span class="line">        return element</span><br><span class="line">    elif (by &#x3D;&#x3D; &quot;css&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_css_selector(value)</span><br><span class="line">        return element</span><br><span class="line">    elif (by &#x3D;&#x3D; &quot;link_text&quot;):</span><br><span class="line">        element &#x3D; browser.find_element_by_link_text(value)</span><br><span class="line">        return element</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;无对应方法，请检查&quot;)</span><br><span class="line">        return None</span><br></pre></td></tr></table></figure><h2 id="元素存在"><a href="#元素存在" class="headerlink" title="元素存在"></a>元素存在</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from selenium.webdriver.common.by import By</span><br><span class="line">from selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line">from selenium.webdriver.support import expected_conditions as EC</span><br><span class="line">def is_element_present(locator):</span><br><span class="line">    wait &#x3D; WebDriverWait(browser, 2)</span><br><span class="line">    try:</span><br><span class="line">       # 显式等待</span><br><span class="line">        wait.until(EC.visibility_of_element_located(locator))</span><br><span class="line">    except TimeoutException:</span><br><span class="line">        return False</span><br><span class="line">    return True</span><br><span class="line">is_element_present((By.XPATH, &#39;&#x2F;&#x2F;*[@id&#x3D;\&quot;sufei-dialog-content\&quot;]&#39;))</span><br></pre></td></tr></table></figure><h2 id="点击元素"><a href="#点击元素" class="headerlink" title="点击元素"></a>点击元素</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def move_element_click(xpath):</span><br><span class="line">    if is_element_present((By.XPATH, xpath)):</span><br><span class="line">        ele_loc &#x3D; browser.find_element_by_xpath(xpath)</span><br><span class="line">        browser.execute_script(&quot;arguments[0].scrollIntoView();&quot;, ele_loc)</span><br><span class="line">        ActionChains(browser).move_to_element(ele_loc).click().perform()</span><br><span class="line">        time.sleep(random.randint(1, 3))</span><br><span class="line">move_element_click(&quot;&#x2F;&#x2F;div[@class&#x3D;&#39;dialog-contentbox&#39;]&#x2F;vframe&#x2F;div&#x2F;div&#x2F;button&quot;)</span><br></pre></td></tr></table></figure><h2 id="hover元素"><a href="#hover元素" class="headerlink" title="hover元素"></a>hover元素</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def hover(by, value):</span><br><span class="line">    element &#x3D; findElement(by, value)</span><br><span class="line">    ActionChains(browser).move_to_element(element).perform()</span><br><span class="line">hover(&quot;xpath&quot;, &#39;&#x2F;&#x2F;tbody[contains(@mx-ie,&quot;mouseover&quot;)]&#x2F;tr[&#39; + str(tr_list.index(tr) + 1) + &#39;]&#39;)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之红岭创投encryption</title>
      <link href="2021/04/19/JS%E9%80%86%E5%90%91%E4%B9%8B%E7%BA%A2%E5%B2%AD%E5%88%9B%E6%8A%95encryption/"/>
      <url>2021/04/19/JS%E9%80%86%E5%90%91%E4%B9%8B%E7%BA%A2%E5%B2%AD%E5%88%9B%E6%8A%95encryption/</url>
      
        <content type="html"><![CDATA[<p><a href="https://sso.my089.com/sso/login" target="_blank" rel="noopener">https://sso.my089.com/sso/login</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录url：</p><p>POST <a href="https://sso.my089.com/sso/login" target="_blank" rel="noopener">https://sso.my089.com/sso/login</a></p><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">username: 15806204095</span><br><span class="line">phone: </span><br><span class="line">encryption: e10adc3949ba59abbe56e057f20f883e</span><br><span class="line">password: </span><br><span class="line">password2: </span><br><span class="line">randomPageId: dc88cc75d91f4ecaa519f232a9a66361</span><br><span class="line">checkCode: 4ctk</span><br><span class="line">session_kept: 30</span><br><span class="line">loginCategory: 0</span><br><span class="line">back_url: </span><br><span class="line">app_key: 16ae450f970448619c3ce7193982089e</span><br><span class="line">ltcc: </span><br><span class="line">requestId: my089-21041920-0757-0529-1535-632509802406</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>搜索sso/login，进入了html页面，点击登录或者回车跳转到loginSubmit方法</p><p><img src="/2021/04/19/JS%E9%80%86%E5%90%91%E4%B9%8B%E7%BA%A2%E5%B2%AD%E5%88%9B%E6%8A%95encryption/image-20210419201127276.png" alt="image-20210419201127276"></p><p>搜索loginSubmit</p><p><img src="/2021/04/19/JS%E9%80%86%E5%90%91%E4%B9%8B%E7%BA%A2%E5%B2%AD%E5%88%9B%E6%8A%95encryption/image-20210419201318273.png" alt="image-20210419201318273"></p><p>加密方法在jQuery.md5.js中，将js整个拷出，修改得到md5方法，完成encryption的解密。</p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之万创帮sign</title>
      <link href="2021/04/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%87%E5%88%9B%E5%B8%AEsign/"/>
      <url>2021/04/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%87%E5%88%9B%E5%B8%AEsign/</url>
      
        <content type="html"><![CDATA[<p><a href="https://m.wcbchina.com/invite/invite.html" target="_blank" rel="noopener">https://m.wcbchina.com/invite/invite.html</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><h2 id="注册url"><a href="#注册url" class="headerlink" title="注册url"></a>注册url</h2><p>POST <a href="https://m.wcbchina.com/api/userRegister/registerByInvite?rnd=0.5886187290129845" target="_blank" rel="noopener">https://m.wcbchina.com/api/userRegister/registerByInvite?rnd=0.5886187290129845</a></p><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>{“auth”:{“timestamp”:1618717702730,”sign”:”81D4F3A45B3202E33971304201135FE5”},”phone”:”15806204095”,”validateCode”:”123”,”inviteCode”:””}</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>搜索userRegister/registerByInvite，进入函数中，打上断点，发起注册请求，此刻的参数中害没有出现加密参数sign，postJson时传递了一个大json数据包括参数service,data和方法success,error</p><p><img src="/2021/04/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%87%E5%88%9B%E5%B8%AEsign/image-20210418121513116.png" alt="image-20210418121513116"></p><p>进入postJson方法，发现重组了请求地址，这就是为什么搜索<code>api/userRegister/registerByInvite</code>不到的原因</p><p><img src="/2021/04/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%87%E5%88%9B%E5%B8%AEsign/image-20210418124035654.png" alt="image-20210418124035654"></p><p>跟进A(a)函数，发现其中的h对象中是data参数有W()构成，W()正是构成sign的关键函数</p><p><img src="/2021/04/18/JS%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%87%E5%88%9B%E5%B8%AEsign/image-20210418125251298.png" alt="image-20210418125251298"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之5173password</title>
      <link href="2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/"/>
      <url>2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/</url>
      
        <content type="html"><![CDATA[<h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录URL：</p><p>POST <a href="https://passport.5173.com/?returnUrl=http://www.5173.com/" target="_blank" rel="noopener">https://passport.5173.com/?returnUrl=http%3A//www.5173.com/</a></p><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smsLogin: 0</span><br><span class="line">userName: 15806204095</span><br><span class="line">password: 6a771c7ecf7ebe2c3d4c0075cdb96ae5</span><br><span class="line">mobileNo: </span><br><span class="line">smsCaptcha: </span><br><span class="line">category: </span><br><span class="line">passpod: </span><br><span class="line">__validationToken__: 1680e6a3947c43aea45d83e69b0d7291</span><br><span class="line">__validationDna__:</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><h2 id="password"><a href="#password" class="headerlink" title="password"></a>password</h2><p>password有32位，有可能是md5</p><p>搜索password，出现的地方太多了，懒得看，放弃。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417101520224.png" alt="image-20210417101520224"></p><p>点击登录按钮，肯定触发事件发送请求，搜索<code>submit-btn</code>无效结果。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417101653242.png" alt="image-20210417101653242"></p><p>搜索<code>tnSubmit</code>加上断点，点击登录按钮时，果然断在了这个function中，不过此刻Network面板的请求包已经发送出去了，gg了，没能拦截到<code>https://passport.5173.com/?returnUrl=http%3a%2f%2fwww.5173.com%2f</code>请求发送前的时间点。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417101856138.png" alt="image-20210417101856138"></p><p>再一次尝试，在加密password时肯定要获取该输入框的值，通过id获取元素的话，我们搜索<code>#txtPass</code>在所出现的位置都打上断点</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417102111667.png" alt="image-20210417102111667"></p><p>点击登录时查看Network已经拦截在了ValidateSlide请求，还没有到登录请求</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417102439074.png" alt="image-20210417102439074"></p><p>查看断点时打印o为<code>aec712a02d8c835b92369e5d7e5494cf</code>,并直接跳到<code>return $[[&quot;ajax&quot;]]</code>处，查看此时提交的data中的<code>a[[&quot;serialize&quot;]]()</code>为<code>&quot;smsLogin=0&amp;userName=15806204095&amp;password=aec712a02d8c835b92369e5d7e5494cf&amp;mobileNo=&amp;smsCaptcha=&amp;category=&amp;passpod=&amp;__validationToken__=31004cd552c94687ba27d1c7258576f7&amp;__validationDna__=&quot;</code>,其中的password就是之前打印的o参数。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417102816463.png" alt="image-20210417102816463"></p><p>由于password=o，现在只需要追踪这个o参数来源即可。往上追溯是<code>onsubmit: function(f, o)</code>中作为第二个参数o传递进来的，通过调用的堆栈查看上一级调用方法submitHandle。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417103714227.png" alt="image-20210417103714227"></p><p>submitHandler这段代码返回a.onsubmit(a, c)，其中c就是<code>onsubmit: function(f, o) </code>中的o=password。由于<code>a.usingTpm || a.passwordHash</code>是true，那么这个c就是通过<code>a.getPassword(a.pkey)</code>获取。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417104004461.png" alt="image-20210417104004461"></p><p>进入getPassword后，<code>this.ready &amp;&amp; this.activeTpm &amp;&amp; this.usingTpm</code>为false，必然进入的是else中的<code>c = hex_md5(hex_md5(c).substr(8, 16) + a);</code>实现加密。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417112035000.png" alt="image-20210417112035000"></p><p><code>(c = b(&quot;#&quot; + this.passwordControlId).val()) &amp;&amp; this.passwordHash</code>赋值必然是true，其中<code>(c = b(&quot;#&quot; + this.passwordControlId).val())</code>的结果为123456，即我们输入的密码，由于传入的a为<code>42m2gl</code>，所以加密逻辑整理为<code>c = hex_md5(hex_md5(&quot;123456&quot;).substr(8, 16) + &quot;42m2gl&quot;)</code></p><p>那么问题来了，传入的a是哪里来的，通过搜索42m2gl，原来每次页面生成的时候页面会加载PasswordKey，通过PasswordKey和SecurityToken等key实现相互验证进行校验。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417113103632.png" alt="image-20210417113103632"></p><h2 id="validationToken"><a href="#validationToken" class="headerlink" title="__validationToken__"></a><strong>__validationToken__</strong></h2><p><strong>__validationToken__</strong>这个字段<code>6b16902a6b134dc9a2c333b965c9405f</code>在请求里面无法搜到是因为页面已经刷新，通过fiddler抓包<code>https://passport.5173.com/?returnUrl=http%3a%2f%2fwww.5173.com%2f</code>历史可以看到首页加载时传入该参数</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B5173password/image-20210417113838930.png" alt="image-20210417113838930"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>首次先请求<a href="https://passport.5173.com/?returnUrl=http://www.5173.com/" target="_blank" rel="noopener">https://passport.5173.com/?returnUrl=http%3a%2f%2fwww.5173.com%2f</a></p><p>获取页面中的PasswordKey的值和SecurityToken的值，通过两次md5密码<code>hex_md5(hex_md5(&quot;123456&quot;).substr(8, 16) + &quot;42m2gl&quot;)</code>拿到password加密结果，发起请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">def hex_md5(s):</span><br><span class="line">    m &#x3D; hashlib.md5()</span><br><span class="line">    m.update(str(s).encode(&quot;utf-8&quot;))</span><br><span class="line">    return m.hexdigest()</span><br><span class="line"></span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;Host&#39;: &#39;passport.5173.com&#39;,</span><br><span class="line">    &#39;Origin&#39;: &#39;https:&#x2F;&#x2F;passport.5173.com&#39;,</span><br><span class="line">    &#39;Pragma&#39;: &#39;no-cache&#39;,</span><br><span class="line">    &#39;Referer&#39;: &#39;https:&#x2F;&#x2F;passport.5173.com&#x2F;?returnUrl&#x3D;http%3A&#x2F;&#x2F;www.5173.com&#x2F;&#39;,</span><br><span class="line">    &#39;Sec-Fetch-Mode&#39;: &#39;cors&#39;,</span><br><span class="line">    &#39;Sec-Fetch-Site&#39;: &#39;same-origin&#39;,</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;78.0.3904.70 Safari&#x2F;537.36&#39;,</span><br><span class="line">    &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,</span><br><span class="line">&#125;</span><br><span class="line">login_url &#x3D; &#39;https:&#x2F;&#x2F;passport.5173.com&#x2F;?returnUrl&#x3D;http%3A&#x2F;&#x2F;www.5173.com&#x2F;&#39;</span><br><span class="line">html &#x3D; requests.get(login_url).text</span><br><span class="line"># print(html)</span><br><span class="line">securityToken &#x3D; re.findall(&#39;SecurityToken:&quot;(.*?)&quot;,&#39;, html, re.M | re.S)[0]</span><br><span class="line">passwordKey &#x3D; re.findall(&#39;PasswordKey:&quot;(.*?)&quot;,&#39;, html, re.M | re.S)[0]</span><br><span class="line">print(passwordKey)</span><br><span class="line">print(securityToken)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 滑块 &#39;https:&#x2F;&#x2F;passport.5173.com&#x2F;Sso&#x2F;ValidateSlide?token&#x3D;&#123;&#125;&#39;.format(securityToken)</span><br><span class="line"># hex_md5(hex_md5(&quot;123456&quot;).substr(8, 16) + &quot;42m2gl&quot;)</span><br><span class="line">password &#x3D; hex_md5(hex_md5(&quot;123456&quot;)[8:8 + 16] + passwordKey)</span><br><span class="line">userName &#x3D; &#39;15806204096&#39;</span><br><span class="line"></span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    &#39;smsLogin&#39;: &#39;0&#39;,</span><br><span class="line">    &#39;userName&#39;: userName,</span><br><span class="line">    &#39;password&#39;: password,</span><br><span class="line">    &#39;mobileNo&#39;: &#39;&#39;,</span><br><span class="line">    &#39;smsCaptcha&#39;: &#39;&#39;,</span><br><span class="line">    &#39;category&#39;: &#39;&#39;,</span><br><span class="line">    &#39;passpod&#39;: &#39;&#39;,</span><br><span class="line">    &#39;__validationToken__&#39;: securityToken,</span><br><span class="line">    &#39;__validationDna__&#39;: &#39;&#39;</span><br><span class="line">&#125;</span><br><span class="line">r &#x3D; requests.post(login_url, data, headers&#x3D;headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>虽然password逻辑已经破解，不过登录时还需要验证码滑块的校验，以后有时间再写吧。。。</p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之金逸电影params</title>
      <link href="2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/"/>
      <url>2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.jycinema.com/wap/#/register" target="_blank" rel="noopener">http://www.jycinema.com/wap/#/register</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录url:</p><p>POST <a href="http://www.jycinema.com/frontUIWebapp/appserver/photoMessageService/newsSendMessage" target="_blank" rel="noopener">http://www.jycinema.com/frontUIWebapp/appserver/photoMessageService/newsSendMessage</a></p><p>参数：</p><p>params:<strong>ey</strong>622Jt557b2114Jp469bG373VO310dW8741i248ZX535Ii076Oi988Ix997NT571gw811Nj907Iw911ND991A5893NS763Is198In627Nl690bm498RU398eX141Bl991Ij727oi670cm475Vn649Ii854wi037Y2151hh831bm4625l109bE023lk146Ij946o3769LC284Jj066aG622Fu333bm353Vs667Q26149k642ZS856I6624Ik524ow241MD637A1091Ii342wi356bW787Vt825Ym215Vy105SW604Qi506Oi857Ii850<strong>fQ</strong>497==152</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>ey开头是base64中的{，fq是base64中的}，有可能是base64加密</p><p>搜索photoMessageService/newsSendMessage</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/image-20210417081614897.png" alt="image-20210417081614897"></p><p>定义了sendMg属性，那么必定被调用才发起请求，搜索.sendMg</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/image-20210417082003298.png" alt="image-20210417082003298"></p><p>点击获取验证码,请求参数中<code>$scope.registerData.tel</code>就是我们提交的手机号，那么加密必然是在<code>getData</code>中</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/image-20210417082318460.png" alt="image-20210417082318460"></p><p>跟进<code>getData</code>后对params进行处理生成<code>{&quot;mobileNumber&quot;:&quot;15806204095&quot;,&quot;sendType&quot;:&quot;reg&quot;,&quot;channelId&quot;:7,&quot;channelCode&quot;:&quot;J0005&quot;,&quot;memberId&quot;:&quot;&quot;}</code></p><p>并发现了密码加密的函数，在下方通过<code>$rootScope.getEncryption(params.params)</code>调用生成密码。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/image-20210417082740728.png" alt="image-20210417082740728"></p><p>由于Base64.encode有utf-8乱码问题，无法直接使用，<code>var re_btou = new RegExp([&quot;[À-ß][-¿]&quot;, &quot;[à-ï][-¿]{2}&quot;, &quot;[ð-÷][-¿]{3}&quot;].join(&quot;|&quot;),&quot;g&quot;);</code>通过<a href="https://github.com/dankogai/js-base64/edit/main/base64.js" target="_blank" rel="noopener">base64.js源码</a>提供<code>Base64.encode(value)</code>实现params加密关键函数getEncryption。</p><p><img src="/2021/04/17/JS%E9%80%86%E5%90%91%E4%B9%8B%E9%87%91%E9%80%B8%E7%94%B5%E5%BD%B1params/image-20210417092425546.png" alt="image-20210417092425546"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>由于个人的js学的太孬了，在python调用js时报错<code>execjs._exceptions.ProgramError: ReferenceError: Base64 is not defined</code>,那么我只能避开，使用python实现base64加密并作为参数传入调用getEncryption。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import requests</span><br><span class="line">import execjs</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">from requests_toolbelt import MultipartEncoder</span><br><span class="line"></span><br><span class="line">username &#x3D; &quot;15806204095&quot;</span><br><span class="line">psssword &#x3D; &quot;123456&quot;</span><br><span class="line">with open(r&#39;jy_params.js&#39;, encoding&#x3D;&#39;utf-8&#39;, mode&#x3D;&#39;r&#39;) as f:</span><br><span class="line">    JsData &#x3D; f.read()</span><br><span class="line">param &#x3D; &#123;&quot;mobileNumber&quot;: &quot;15806204095&quot;, &quot;sendType&quot;: &quot;reg&quot;, &quot;channelId&quot;: 7, &quot;channelCode&quot;: &quot;J0005&quot;, &quot;memberId&quot;: &quot;&quot;&#125;</span><br><span class="line">val &#x3D; base64.b64encode(json.dumps(param).encode())</span><br><span class="line">params &#x3D; execjs.compile(JsData).call(&#39;getEncryption&#39;, val.decode())</span><br><span class="line">print(params)</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;Accept&#39;: &#39;application&#x2F;json, text&#x2F;plain, *&#x2F;*&#39;,</span><br><span class="line">    &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;,</span><br><span class="line">    &#39;Accept-Language&#39;: &#39;zh-CN,zh;q&#x3D;0.9&#39;,</span><br><span class="line">    &#39;Content-Length&#39;: &#39;341&#39;,</span><br><span class="line">    &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8&#39;,</span><br><span class="line">    &#39;Cookie&#39;: &#39;JSESSIONID&#x3D;DD188088D4E4EAC0098C9CCBCC32E52F; Hm_lvt_62d04228e1f84e012c1d9c0227f722c3&#x3D;1618618136; Hm_lpvt_62d04228e1f84e012c1d9c0227f722c3&#x3D;1618618136&#39;,</span><br><span class="line">    &#39;Host&#39;: &#39;www.jycinema.com&#39;,</span><br><span class="line">    &#39;Origin&#39;: &#39;http:&#x2F;&#x2F;www.jycinema.com&#39;,</span><br><span class="line">    &#39;Proxy-Connection&#39;: &#39;keep-alive&#39;,</span><br><span class="line">    &#39;Referer&#39;: &#39;http:&#x2F;&#x2F;www.jycinema.com&#x2F;wap&#x2F;&#39;,</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Linux; Android 6.0; Nexus 5 Build&#x2F;MRA58N) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;90.0.4430.72 Mobile Safari&#x2F;537.36&#39;,</span><br><span class="line">&#125;</span><br><span class="line">data &#x3D; &#123;&#39;params&#39;: params&#125;</span><br><span class="line">r &#x3D; requests.post(&quot;http:&#x2F;&#x2F;www.jycinema.com&#x2F;frontUIWebapp&#x2F;appserver&#x2F;photoMessageService&#x2F;newsSendMessage&quot;, data,</span><br><span class="line">                  headers&#x3D;headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><blockquote><p>{“msg”:”短信发送成功”,”count”:0,”status”:”S”}</p></blockquote><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>违法应用fulao2取证分析</title>
      <link href="2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/"/>
      <url>2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="vip破解"><a href="#vip破解" class="headerlink" title="vip破解"></a>vip破解</h1><p>adb install -r -t fulao2.apk  通过jadx查询已经被混淆</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419212413059.png" alt="image-20210419212413059"></p><p>hookEvent.js实现trace系统框架库android.view.View快速定位关键代码，trace所有的mOnClickListener，hook它们的onClick函数，实现点到哪里，定位到哪个类的功能。</p><p>前台运行fulao2.apk后，frida -UF -l hookEvent.js  启动hook</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419215916951.png" alt="image-20210419215916951"></p><h2 id="清晰度切换"><a href="#清晰度切换" class="headerlink" title="清晰度切换"></a>清晰度切换</h2><p>点击切换高清标清按钮，触发了发现在q0时的com.ilulutv.fulao2.film.l$t类，根据获取的类名进入jadx中搜索t，实现bool判断，下面我们手动将内存中的q0改成true。</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419214658427.png" alt="image-20210419214658427"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyenv local 3.8.0 </span><br><span class="line">objection -g com.ilulutv.fulao2 explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname com.ilulutv.fulao2.film.l\$t</span><br><span class="line">plugin wallbreaker objectsearch com.ilulutv.fulao2.film.l\$t</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x26a2  获取到com.ilulutv.fulao2.film.l的对象实例</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419214133698.png" alt="image-20210419214133698"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker objectdump --fullname 0x2406  拿到内存中的对象数据</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419214241612.png" alt="image-20210419214241612"></p><p>通过内存漫游修改q0的False的默认值，frida -UF -l fulao2.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function hookq0()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.ilulutv.fulao2.film.l&quot;,&#123;</span><br><span class="line">            onMatch:function(ins)&#123;</span><br><span class="line">                if(ins.e0.value)&#123;</span><br><span class="line"></span><br><span class="line">                    ins.q0.value &#x3D; true</span><br><span class="line">                    &#x2F;*</span><br><span class="line">                    if(ins.e0.value.toString().indexOf(&quot;宝宝睡&quot;)&gt;0)&#123;</span><br><span class="line">                        console.log(&quot;e0 value is :&quot;, ins.e0.value); </span><br><span class="line">                        &#x2F;&#x2F;ins.q0.value &#x3D; Java.use(&quot;java.lang.Boolean&quot;).\$new(&quot;true&quot;);</span><br><span class="line">                        &#x2F;&#x2F;ins.q0.value &#x3D; true</span><br><span class="line">                    &#125;</span><br><span class="line">                    *&#x2F;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&quot;search complete!&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(hookq0)</span><br></pre></td></tr></table></figure><blockquote><p>android hooking search classes Boolean   获取Boolean类全路径java.lang.Boolean</p></blockquote><p>重新调用plugin wallbreaker objectdump –fullname 0x2406 查看q0的值</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419215307695.png" alt="image-20210419215307695"></p><p>这样就实现了标清切换高清的功能，破解了vip的切换视频清晰度。这种基于本地代码判断容易破解，基于服务器判断就只能根据逻辑漏洞判断。可以通过setInterval实现不断在内存循环调用，将内存中所有实例的q0改成true。</p><h2 id="线路切换"><a href="#线路切换" class="headerlink" title="线路切换"></a>线路切换</h2><p>frida -UF -l hookEvent.js  attach模式</p><p>frida -U -f com.ilulutv.fulao2 -l hookEvent.js –no-pause spawn模式一开始把所有View的OnClick类hook上，不用从内存中枚举</p><p>点击线路切换按钮，触发了com.ilulutv.fulao2.film.l$s和com.ilulutv.fulao2.film.l$m类方法</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419220749728.png" alt="image-20210419220749728"></p><p>通过jadx查看这两个类方法</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419221125869.png" alt="image-20210419221125869"></p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419221042903.png" alt="image-20210419221042903"></p><p>由于com.ilulutv.fulao2.film.l$s和之前的com.ilulutv.fulao2.film.l$t类似，都是以q0判断，不过没有生效，现在关注com.ilulutv.fulao2.film.l$m中的OnClick里的i方法</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419221328804.png" alt="image-20210419221328804"></p><p>查看jadx的i方法</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419221417228.png" alt="image-20210419221417228"></p><p>进入g()方法</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419221924238.png" alt="image-20210419221924238"></p><p>通过hook androidx.fragment.app.Fragment.g方法，点击切换高清1的线路按钮，触发并返回了调用栈</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419222111488.png" alt="image-20210419222111488"></p><h1 id="登录抓包"><a href="#登录抓包" class="headerlink" title="登录抓包"></a>登录抓包</h1><p>frida -UF -l hookSocket.js -o login.txt  所有内容包括手机号全部加密，除了一些请求头，gzip协议头关键字是1f 8b  ，包括视频 图片都是加密的</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419231251449.png" alt="image-20210419231251449"></p><h1 id="图片下载"><a href="#图片下载" class="headerlink" title="图片下载"></a>图片下载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes ImageView</span><br><span class="line">plugin wallbreaker objectsearch android.widget.ImageView</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419232424458.png" alt="image-20210419232424458"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker classsearch bitmap</span><br><span class="line">android hooking search classes bitmap   将所有相关类保存到file.txt中，sed -i -e &#39;s&#x2F;^&#x2F;android hooking watch class &#x2F;&#39; file.txt</span><br><span class="line">objection -g com.ilulutv.fulao2 explore -c file.txt 批量hook</span><br><span class="line">plugin wallbreaker objectsearch android.graphics.Bitmap</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419232701953.png" alt="image-20210419232701953"></p><p>Java.choose属于内存的搜刮，将现有内存的Bigmap对象实例保存，基于hook的话可以将未来持续增长的setInterval定时保存一份内存中的图片<code>setInterval(main,5*1000)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method android.graphics.BitmapFactory.decodeByteArray --dump-args --dump-backtrace --dump-return   通过批量hook拿到下拉触发的方法进行hook打印堆栈，glide是流式图片展示的框架</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419233511403.png" alt="image-20210419233511403"></p><p>通过jadx搜索com.ilulutv.fulao2.other.helper.glide.b.a，decodeByteArray应该是解密开始了，返回b2应该就是明文。</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419233832484.png" alt="image-20210419233832484"></p><p>开始hook Base64系统库，因为系统库不可能被混淆，下拉加载图片发现确实经过了android.util.Base64.encodeToString</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method android.util.Base64.encodeToString --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419234203880.png" alt="image-20210419234203880"></p><p>frida -UF -l fulao2.js -o /root/raw.txt  通过hook发现Base64.encodeToString得到的和SSLOutputStream得到的数据流一致</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">function hookImageByteCiphered()&#123; # 传输中的流</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;android.util.Base64&quot;).encodeToString.overload(&#39;[B&#39;, &#39;int&#39;).implementation &#x3D; function(bytearray,int)&#123;</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;IMAGE DATA:bytearray,int&#x3D;&gt;&quot;,ByteString.of(bytearray).hex(),int)</span><br><span class="line">            var result &#x3D; this.encodeToString(bytearray,int)</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function hook_SSLsocketandroid8()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;hook_SSLsocket&quot;)</span><br><span class="line">        </span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket\$SSLOutputStream&quot;).write.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.write(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTPS write result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;HTTPS bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            &#x2F;&#x2F;console.log(jhexdump(bytearry,int1,int2));</span><br><span class="line">            console.log(jhexdump(bytearry));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">                </span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket\$SSLInputStream&quot;).read.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.read(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTPS read result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;HTTPS bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            &#x2F;&#x2F;console.log(jhexdump(bytearry,int1,int2));</span><br><span class="line">            &#x2F;&#x2F;console.log(jhexdump(bytearry));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明com.ilulutv.fulao2.other.i.b.a((ByteBuffer) obj)确实是https传输的流，也是加密前的流，ffd8ff 是png文件头，通过后面的代码实现解密。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes BitmapFactory</span><br><span class="line">android hooking watch class_method android.graphics.BitmapFactory.decodeByteArray --dump-args --dump-backtrace --dump-return  开始hook BitmapFactory.decodeByteArray(b2, 0, b2.length)</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210419235827791.png" alt="image-20210419235827791"></p><p>frida -UF -l fulao2.js        </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function hookImage()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory\$Options&#39;) .implementation &#x3D; function(data, offset, length, opts)&#123;</span><br><span class="line">            var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;data, offset, length, opts&#x3D;&gt;&quot;,data, offset, length, opts)</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;IMAGE DATA:bytearray,int&#x3D;&gt;&quot;,ByteString.of(data).hex())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot;+guid()+&quot;.jpg&quot;</span><br><span class="line">            console.log(&quot;path&#x3D;&gt; &quot;,path)</span><br><span class="line">            var file &#x3D; Java.use(&quot;java.io.File&quot;).\$new(path)</span><br><span class="line">            var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).\$new(file);</span><br><span class="line">            fos.write(data);</span><br><span class="line">            fos.close();</span><br><span class="line">            fos.close();</span><br><span class="line"></span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210420000856134.png" alt="image-20210420000856134"></p><h2 id="python调用保存"><a href="#python调用保存" class="headerlink" title="python调用保存"></a>python调用保存</h2><p>fulao2.js 将解密后的字节数组发送给python，二进制写入图片</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function hookImage()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory\$Options&#39;) .implementation &#x3D; function(data, offset, length, opts)&#123;</span><br><span class="line">            var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            send(data)</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用fulao2.js发送到本机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import frida</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">import uuid</span><br><span class="line">import base64</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def my_message_handler(message, payload):</span><br><span class="line">    print(message)</span><br><span class="line">    print(payload)</span><br><span class="line">    if message[&quot;type&quot;] &#x3D;&#x3D; &quot;send&quot;:</span><br><span class="line">        print(message[&quot;payload&quot;])</span><br><span class="line">        #image &#x3D; re.findall(&quot;(-?\d+)&quot;, message[&quot;payload&quot;])</span><br><span class="line">        image &#x3D; message[&quot;payload&quot;]</span><br><span class="line">        intArr &#x3D; []</span><br><span class="line">        for m in image:</span><br><span class="line">            ival &#x3D; int(m)</span><br><span class="line">            if ival &lt; 0:</span><br><span class="line">                ival +&#x3D; 256</span><br><span class="line">            intArr.append(ival)  </span><br><span class="line">        bs &#x3D; bytes(intArr)</span><br><span class="line">        fileName &#x3D; str(uuid.uuid1()) + &quot;.jpg&quot;</span><br><span class="line">        f &#x3D; open(fileName,&#39;wb&#39;)</span><br><span class="line">        f.write(bs)</span><br><span class="line">        f.close()</span><br><span class="line">        </span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line">target &#x3D; device.get_frontmost_application()</span><br><span class="line">session &#x3D; device.attach(target.pid)</span><br><span class="line"># 加载脚本</span><br><span class="line">with open(&quot;fulao2.js&quot;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.on(&quot;message&quot; , my_message_handler) #调用错误处理</span><br><span class="line"></span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 脚本会持续运行等待输入</span><br><span class="line">input()</span><br></pre></td></tr></table></figure><p>不能够以战术的勤奋，掩盖战略的懒惰。</p><p>大多数人努力的程度还谈不上拼天分。</p><h1 id="脱机"><a href="#脱机" class="headerlink" title="脱机"></a>脱机</h1><h2 id="二进制写入图片"><a href="#二进制写入图片" class="headerlink" title="二进制写入图片"></a>二进制写入图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.ilulutv.fulao2 explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">android hooking watch class_method android.graphics.BitmapFactory.decodeByteArray --dump-args --dump-backtrace --dump-return  hook解密方法，下拉获取调用栈</span><br></pre></td></tr></table></figure><p>jadx搜索com.ilulutv.fulao2.other.helper.glide.b.a，抓包抓到的二进制数据流是encodeToString之前的b.a返回的数据，可以将协议中内容直接解密，不需要app参与，可以直接hook收发包</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210420102356732.png" alt="image-20210420102356732"></p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421195745321.png" alt="image-20210421195745321"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method com.ilulutv.fulao2.other.i.b.a --dump-args --dump-backtrace --dump-return  下拉加载图片，关注Hooking com.ilulutv.fulao2.other.i.b.a(java.nio.ByteBuffer)，可以看到其他协议的解密也通过这个方法</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210420194546464.png" alt="image-20210420194546464"></p><p>由于返回是[object Object]，看不出结果还是通过hook实现吧。尽量不要用hookImageByteCiphered，因为其他类可能也用到了Base64</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function hookImageByteCiphered() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        Java.use(&quot;android.util.Base64&quot;).encodeToString.overload(&#39;[B&#39;, &#39;int&#39;).implementation &#x3D; function (bytearray, int) &#123;</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;IMAGE DATA:bytearray,int&#x3D;&gt;&quot;, ByteString.of(bytearray).hex(), int)</span><br><span class="line">            var result &#x3D; this.encodeToString(bytearray, int)</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过hook ByteBuffer获取com.ilulutv.fulao2.other.i.b.a 的入参实现hook com.ilulutv.fulao2.other.i.b.a((ByteBuffer) obj)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function hookByteBuffer() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        Java.use(&quot;com.ilulutv.fulao2.other.i.b&quot;).a.overload(&#39;java.nio.ByteBuffer&#39;).implementation &#x3D; function (bf) &#123;</span><br><span class="line">            var result &#x3D; this.a(bf)</span><br><span class="line">            &#x2F;&#x2F; [b</span><br><span class="line">            &#x2F;&#x2F;var gson &#x3D; Java.use(&#39;com.google.gson.Gson&#39;)</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;result is &#x3D;&gt; &quot;,result);</span><br><span class="line">            send(result)</span><br><span class="line">            &#x2F;&#x2F;console.log( gson.$new().toJson(result))</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>frida -UF -l fulao2.js  下拉显示图片，将打印返回的字节数组的结果，通过python实现解密后结果用于脱机处理。</p><p>通过hook  <code>byte[] b2 = com.ilulutv.fulao2.other.i.b.b(decode, Base64.decode(bytes2, 0), encodeToString);</code>中的com.ilulutv.fulao2.other.i.b.b</p><p>android hooking list class_methods com.ilulutv.fulao2.other.i.b  获取需要hook的方法</p><p>android hooking watch class_method net.idik.lib.cipher.so.CipherClient.decodeImgKey –dump-args –dump-backtrace –dump-return     获取hook的返回</p><p>android hooking search classes base64  获取android.util.Base64方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function hookdecodeimgkey() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var base64 &#x3D; Java.use(&quot;android.util.Base64&quot;)</span><br><span class="line">        Java.use(&quot;com.ilulutv.fulao2.other.i.b&quot;).b.overload(&#39;[B&#39;, &#39;[B&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function (key, iv, image) &#123;</span><br><span class="line">            var result &#x3D; this.b(key, iv, image);</span><br><span class="line">            console.log(&quot;key&quot;, base64.encodeToString(key, 0));</span><br><span class="line">            console.log(&quot;iv&quot;, base64.encodeToString(iv, 0));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &#x2F;*</span><br><span class="line">    key svOEKGb5WD0ezmHE4FXCVQ&#x3D;&#x3D;</span><br><span class="line">    iv 4B7eYzHTevzHvgVZfWVNIg&#x3D;&#x3D;</span><br><span class="line">    *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421202105675.png" alt="image-20210421202105675"><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421202624855.png" alt="image-20210421202624855"></p><p>frida -UF -l fulao2.js  下拉加载图片</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421202954986.png" alt="image-20210421202954986"></p><p>查看加密方式com.ilulutv.fulao2.other.i.b.b</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421203135967.png" alt="image-20210421203135967"></p><p>python实现解密  pip install -i <a href="https://pypi.tuna.tsinghua.edu.cn/simple" target="_blank" rel="noopener">https://pypi.tuna.tsinghua.edu.cn/simple</a> pycrypto </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def IMGdecrypt(bytearray):</span><br><span class="line">    imgkey &#x3D; base64.decodebytes(</span><br><span class="line">        bytes(&quot;svOEKGb5WD0ezmHE4FXCVQ&#x3D;&#x3D;&quot;, encoding&#x3D;&#39;utf8&#39;))</span><br><span class="line">    </span><br><span class="line">    imgiv &#x3D; base64.decodebytes(</span><br><span class="line">        bytes(&quot;4B7eYzHTevzHvgVZfWVNIg&#x3D;&#x3D;&quot;, encoding&#x3D;&#39;utf8&#39;))</span><br><span class="line">    </span><br><span class="line">    cipher &#x3D; AES.new(imgkey, AES.MODE_CBC, imgiv)</span><br><span class="line">    # enStr +&#x3D; (len(enStr) % 4)*&quot;&#x3D;&quot;</span><br><span class="line">    # decryptByts &#x3D; base64.urlsafe_b64decode(enStr)</span><br><span class="line">    msg &#x3D; cipher.decrypt(bytearray)</span><br><span class="line"></span><br><span class="line">    def unpad(s): return s[0:-s[-1]]</span><br><span class="line">    return unpad(msg)</span><br><span class="line"></span><br><span class="line"># 拿到数据后Base64解密</span><br><span class="line">bs &#x3D; IMGdecrypt(bs)</span><br></pre></td></tr></table></figure><p>将比较耗性能的加解密计算放到电脑端处理，减少了手机端的资源损耗，实现脱机处理。抓包后直接使用以上算法解码。</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421205216372.png" alt="image-20210421205216372"></p><p>查看BitmapFactory.decodeByteArray返回的类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes Bitmap</span><br><span class="line">android hooking list class_methods android.graphics.Bitmap</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function getObjClassName(obj) &#123;</span><br><span class="line">    if (!jclazz) &#123;</span><br><span class="line">        var jclazz &#x3D; Java.use(&quot;java.lang.Class&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!jobj) &#123;</span><br><span class="line">        var jobj &#x3D; Java.use(&quot;java.lang.Object&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return jclazz.getName.call(jobj.getClass.call(obj));</span><br><span class="line">&#125;</span><br><span class="line">function hookImage()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory$Options&#39;) .implementation &#x3D; function(data, offset, length, opts)&#123;</span><br><span class="line">            var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line"></span><br><span class="line">            var gson &#x3D; Java.use(&#39;com.google.gson.Gson&#39;)</span><br><span class="line"> console.log(&quot;result is &#x3D;&gt;&quot;,gson.$new().toJson(result)) &#x2F;&#x2F; 打印BitmapFactory对象属性，说明BitmapFactory.decodeByteArray返回对象</span><br><span class="line">            console.log(&quot;className is &#x3D;&gt;&quot;,getObjClassName(result))</span><br><span class="line">            console.log(&#39;Object.getOwnPropertyNames()&#x3D;&gt;&#39;,Object.getOwnPropertyNames(result.$className))</span><br><span class="line"></span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="安卓保存图片"><a href="#安卓保存图片" class="headerlink" title="安卓保存图片"></a>安卓保存图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes CompressFormat</span><br><span class="line">plugin wallbreaker classdump --fullname android.graphics.Bitmap$CompressFormat</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421211014635.png" alt="image-20210421211014635"></p><p>frida -UF -l fulao2.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function hookImage()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory$Options&#39;) .implementation &#x3D; function(data, offset, length, opts)&#123;</span><br><span class="line">            var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line"></span><br><span class="line">            var gson &#x3D; Java.use(&#39;com.google.gson.Gson&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot; + guid() + &quot;.jpg&quot;</span><br><span class="line">           console.log(&quot;path&#x3D;&gt; &quot;, path)</span><br><span class="line">           var file &#x3D; Java.use(&quot;java.io.File&quot;).$new(path)</span><br><span class="line">           var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).$new(file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           result.compress(Java.use(&quot;android.graphics.Bitmap$CompressFormat&quot;).JPEG.value, 100, fos)</span><br><span class="line">           console.log(&quot;success!&quot;)</span><br><span class="line">           fos.flush();</span><br><span class="line">           fos.close();</span><br><span class="line"></span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421211443291.png" alt="image-20210421211443291"></p><h2 id="多线程保存"><a href="#多线程保存" class="headerlink" title="多线程保存"></a>多线程保存</h2><p>创建线程com.onejane.runnable，android hooking search classes onejane</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">function hookImage() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        var Runnable &#x3D; Java.use(&quot;java.lang.Runnable&quot;);</span><br><span class="line">        var saveImg &#x3D; Java.registerClass(&#123;</span><br><span class="line">            name: &quot;com.onejane.runnable&quot;,</span><br><span class="line">            implements: [Runnable],</span><br><span class="line">            fields: &#123;</span><br><span class="line">                bm: &quot;android.graphics.Bitmap&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                $init: [&#123;</span><br><span class="line">                    returnType: &quot;void&quot;,</span><br><span class="line">                    argumentTypes: [&quot;android.graphics.Bitmap&quot;],</span><br><span class="line">                    implementation: function (bitmap) &#123;</span><br><span class="line">                        this.bm.value &#x3D; bitmap;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;],</span><br><span class="line">                run: function () &#123;</span><br><span class="line"></span><br><span class="line">                    var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot; + guid() + &quot;.jpg&quot;</span><br><span class="line">                    console.log(&quot;path&#x3D;&gt; &quot;, path)</span><br><span class="line">                    var file &#x3D; Java.use(&quot;java.io.File&quot;).$new(path)</span><br><span class="line">                    var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).$new(file);</span><br><span class="line"></span><br><span class="line">                    this.bm.value.compress(Java.use(&quot;android.graphics.Bitmap$CompressFormat&quot;).JPEG.value, 100, fos)</span><br><span class="line">                    console.log(&quot;success!&quot;)</span><br><span class="line">                    fos.flush();</span><br><span class="line">                    fos.close();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Java.use(&quot;android.graphics.BitmapFactory&quot;).decodeByteArray.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;, &#39;android.graphics.BitmapFactory$Options&#39;).implementation &#x3D; function (data, offset, length, opts) &#123;</span><br><span class="line">            var result &#x3D; this.decodeByteArray(data, offset, length, opts);</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;var gson &#x3D; Java.use(&#39;com.google.gson.Gson&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;send(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;send(gson.$new().toJson(data))</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;data, offset, length, opts&#x3D;&gt;&quot;,data, offset, length, opts)</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;IMAGE DATA:bytearray,int&#x3D;&gt;&quot;,ByteString.of(data).hex())</span><br><span class="line"></span><br><span class="line">            &#x2F;*</span><br><span class="line">            var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot;+guid()+&quot;.jpg&quot;</span><br><span class="line">            console.log(&quot;path&#x3D;&gt; &quot;,path)</span><br><span class="line">            var file &#x3D; Java.use(&quot;java.io.File&quot;).$new(path)</span><br><span class="line">            var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).$new(file);</span><br><span class="line">            fos.write(data);</span><br><span class="line">            fos.flush();</span><br><span class="line">            fos.close();</span><br><span class="line">            *&#x2F;</span><br><span class="line"></span><br><span class="line">            &#x2F;*var gson &#x3D; Java.use(&#39;com.google.gson.Gson&#39;)</span><br><span class="line">            console.log(&quot;result is &#x3D;&gt;&quot;,gson.$new().toJson(result)) # 打印BitmapFactory对象属性，说明BitmapFactory.decodeByteArray返回</span><br><span class="line">            console.log(&quot;className is &#x3D;&gt;&quot;,getObjClassName(result))</span><br><span class="line">            console.log(&#39;Object.getOwnPropertyNames()&#x3D;&gt;&#39;,Object.getOwnPropertyNames(result.$className))*&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#x2F;*</span><br><span class="line">            var path &#x3D; &quot;&#x2F;sdcard&#x2F;Download&#x2F;tmp&#x2F;&quot; + guid() + &quot;.jpg&quot;</span><br><span class="line">            console.log(&quot;path&#x3D;&gt; &quot;, path)</span><br><span class="line">            var file &#x3D; Java.use(&quot;java.io.File&quot;).$new(path)</span><br><span class="line">            var fos &#x3D; Java.use(&quot;java.io.FileOutputStream&quot;).$new(file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            result.compress(Java.use(&quot;android.graphics.Bitmap$CompressFormat&quot;).JPEG.value, 100, fos)</span><br><span class="line">            console.log(&quot;success!&quot;)</span><br><span class="line">            fos.flush();</span><br><span class="line">            fos.close();</span><br><span class="line">            *&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            var runnable &#x3D; saveImg.$new(result);</span><br><span class="line">            runnable.run()</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="so分析"><a href="#so分析" class="headerlink" title="so分析"></a>so分析</h1><p>CipherClient类中所有的返回都是CipherCore.get</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421213211293.png" alt="image-20210421213211293"></p><p>而CipherCore又加载了cipher-lib的so库</p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421213239499.png" alt="image-20210421213239499"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.ilulutv.fulao2 explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">memory list modules 搜索cipher-lib</span><br><span class="line">ls -alt &#x2F;data&#x2F;app&#x2F;com.ilulutv.fulao2-6tvMrrptF1h1A4NvQbV85A&#x3D;&#x3D;&#x2F;lib&#x2F;arm&#x2F;</span><br><span class="line">memory list exports libcipher-lib.so  查看该so中有哪些导出函数</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421213508844.png" alt="image-20210421213508844"></p><p>其中的getString对应了<code>private static native String getString(String str);</code></p><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421213823826.png" alt="image-20210421213823826"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp libcipher-lib.so &#x2F;sdcard&#x2F;Download&#x2F;  取出so后丢到IDA中分析</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421215733176.png" alt="image-20210421215733176"></p><p>通过jnitrace trace下所有native的执行流。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs1428arm64 </span><br><span class="line">pyenv local 3.8.5</span><br><span class="line">pip install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple jnitrace</span><br><span class="line">jnitrace -m attach -l libcipher-lib.so com.ilulutv.fulao2  下拉加载图片 查看trace的调用栈,默认是spawn</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421220940662.png" alt="image-20210421220940662"></p><p>so层再次调用java层方法AESEncryptor</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class net.idik.lib.cipher.so.encrypt.AESEncryptor 下拉图片加载，虽然到native进行转化，但是啥也没干，重新从java层调用加解密</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421221236514.png" alt="image-20210421221236514"></p><p>由于每次hook时app总是崩掉，objection在app启动时直接执行hook方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.ilulutv.fulao2 explore -P ~&#x2F;.objection&#x2F;plugins -s &quot;android hooking watch class_method net.idik.lib.cipher.so.encrypt.AESEncryptor.decrypt --dump-args --dump-backtrace --dump-return&quot;  堆栈说明确实从native层到了java层</span><br></pre></td></tr></table></figure><p><img src="/2021/04/15/%E8%BF%9D%E6%B3%95%E5%BA%94%E7%94%A8fulao2%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90/image-20210421221625985.png" alt="image-20210421221625985"></p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之爱拍password</title>
      <link href="2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/"/>
      <url>2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.aipai.com/" target="_blank" rel="noopener">http://www.aipai.com/</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录url：</p><p>POST <a href="http://www.aipai.com/login.php" target="_blank" rel="noopener">http://www.aipai.com/login.php</a></p><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">action: loginNew</span><br><span class="line">user: 15806204095</span><br><span class="line">password: 202cb962ac59075b964b07152d234b70</span><br><span class="line">keeplogin: 1</span><br><span class="line">comouterTime: 1</span><br><span class="line">userNowTime: 1618281089</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>参数中只有password加密，搜索/login.php,出现在了sea.js,header.js?t=20210312,global.js的多个地方中</p><p><img src="/2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/image-20210413103749230.png" alt="image-20210413103749230"></p><p>逐步分析各个位置的/login.php,初步定位到两个地方的js处可能是加密password 的位置，因为这两处附近都有user,action等其他参数生成。</p><p><img src="/2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/image-20210413104218105.png" alt="image-20210413104218105"></p><p><img src="/2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/image-20210413104328159.png" alt="image-20210413104328159"></p><p>这两处同样的通过md5函数加密password所在id的内容，我们为这两处加上断点，重新登录发现停在了header.js?t=20210312</p><p>F10单步逐行跳过到<code>metadata=&#39;action=&#39;+ action +&#39;&amp;account=&#39;+ user +&#39;&amp;password=&#39;+ _ts.md5(pass) +&#39;&amp;keeplogin=&#39;+ keep +&#39;&amp;comouterTime=&#39;+ keep +&#39;&amp;userNowTime=&#39;+ userNowTime;</code></p><p>通过Watch面板拿到idPass，pass和_ts.md5(pass)的值</p><p><img src="/2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/image-20210413104814198.png" alt="image-20210413104814198"></p><p>点击进入md5方法，打上断点后，F9单步跳入后抠出md5算法js</p><p><img src="/2021/04/13/js%E9%80%86%E5%90%91%E4%B9%8B%E7%88%B1%E6%8B%8Dpassword/image-20210413105023016.png" alt="image-20210413105023016"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>通过python调用js实现password的逆向分析。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import execjs</span><br><span class="line"></span><br><span class="line">username &#x3D; &quot;15806204095&quot;</span><br><span class="line">password &#x3D; &quot;123&quot;</span><br><span class="line">with open(r&#39;aipai_password.js&#39;, encoding&#x3D;&#39;utf-8&#39;, mode&#x3D;&#39;r&#39;) as f:</span><br><span class="line">    JsData &#x3D; f.read()</span><br><span class="line">password &#x3D; execjs.compile(JsData).call(&#39;pwd&#39;, password)</span><br><span class="line">print(password)</span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    &#39;action&#39;: &#39;loginNew&#39;,</span><br><span class="line">    &#39;user&#39;: username,</span><br><span class="line">    &#39;password&#39;: password,</span><br><span class="line">    &#39;keeplogin&#39;: &#39;1&#39;,</span><br><span class="line">    &#39;comouterTime&#39;: &#39;1&#39;,</span><br><span class="line">    &#39;userNowTime&#39;: &#39;1618281089&#39;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">r &#x3D; requests.post(&quot;http:&#x2F;&#x2F;www.aipai.com&#x2F;login.php&quot;, data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之拉勾password</title>
      <link href="2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/"/>
      <url>2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.lagou.com/" target="_blank" rel="noopener">https://www.lagou.com/</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录url:</p><p>GET <a href="https://passport.lagou.com/login/login.json" target="_blank" rel="noopener">https://passport.lagou.com/login/login.json</a></p><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jsoncallback: jQuery11130510950445912626_1618227551741</span><br><span class="line">isValidate: true</span><br><span class="line">username: 15806204095</span><br><span class="line">password: 990eb670f81e82f546cfaaae1587279a</span><br><span class="line">request_form_verifyCode: </span><br><span class="line">challenge: c7a96a290ed4d75ca2a8bf139172dbe0</span><br><span class="line">_: 1618227551745</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>参数中password和challenge看起来是加密参数，其实challenge是极验验证码请求的参数，本文针对password进行参数分析，暂时先不做讨论。</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/image-20210412195059257.png" alt="image-20210412195059257"></p><p>搜索login/login.json并格式化js后，发现改password通过md5实现加密，在Watch界面输入g查看g的内容</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/image-20210412195442176.png" alt="image-20210412195442176"></p><p>放行程序后，在<code>g.isValidate &amp;&amp; (g.password = md5(g.password)</code>处重新打上断点并登录</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/image-20210412195745639.png" alt="image-20210412195745639"></p><p>那么分析得出password=md5(“veenike”+md5(passwrod)+”veenike”)</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E6%8B%89%E5%8B%BEpassword/image-20210412200010128.png" alt="image-20210412200010128"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from hashlib import md5</span><br><span class="line"></span><br><span class="line">username &#x3D; &#39;15806204095&#39;</span><br><span class="line">pwd &#x3D; &#39;123&#39;</span><br><span class="line">md5_pwd &#x3D; md5((&quot;veenike&quot; + md5(pwd.encode(&#39;utf8&#39;)).hexdigest() + &quot;veenike&quot;).encode(&quot;utf8&quot;)).hexdigest()</span><br><span class="line">print(md5_pwd)</span><br><span class="line">url &#x3D; &#39;https:&#x2F;&#x2F;passport.lagou.com&#x2F;login&#x2F;login.json?jsoncallback&#x3D;jQuery111306946515748870927_1618229101639&amp;isValidate&#x3D;true&amp;username&#x3D;&#39;+username+&#39;&amp;password&#x3D;+&#39;+md5_pwd+&#39;+&amp;request_form_verifyCode&#x3D;&amp;challenge&#x3D;c3bebcad0648898aa58cb3f4dbf2f820&amp;_&#x3D;1618229101642&#39;</span><br><span class="line">r &#x3D;requests.get(url)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之中关村在线pwd</title>
      <link href="2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/"/>
      <url>2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.zol.com.cn/" target="_blank" rel="noopener">https://www.zol.com.cn/</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>本登录页面既然是框架，找到php页面，<a href="https://service.zol.com.cn/user/siteLogin.php?type=small&amp;callback=userLoginCallback&amp;backurl=https://www.zol.com.cn/" target="_blank" rel="noopener">https://service.zol.com.cn/user/siteLogin.php?type=small&amp;callback=userLoginCallback&amp;backurl=https://www.zol.com.cn/</a></p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/image-20210412112404348.png" alt="image-20210412112404348"></p><p>直接访问该php网址，避免其他请求干扰分析</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/image-20210412112527950.png" alt="image-20210412112527950"></p><p>登录url:</p><p>POST <a href="https://service.zol.com.cn/user/ajax/siteLogin/login.php" target="_blank" rel="noopener">https://service.zol.com.cn/user/ajax/siteLogin/login.php</a></p><p>请求头：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">:authority: service.zol.com.cn</span><br><span class="line">:method: POST</span><br><span class="line">:path: &#x2F;user&#x2F;ajax&#x2F;siteLogin&#x2F;login.php</span><br><span class="line">:scheme: https</span><br><span class="line">accept: application&#x2F;json, text&#x2F;javascript, *&#x2F;*; q&#x3D;0.01</span><br><span class="line">accept-encoding: gzip, deflate, br</span><br><span class="line">accept-language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">content-length: 138</span><br><span class="line">content-type: application&#x2F;x-www-form-urlencoded; charset&#x3D;UTF-8</span><br><span class="line">cookie: ip_ck&#x3D;5cKC7&#x2F;vxj7QuMjUzODE2LjE2MTgxOTc3OTM%3D; lv&#x3D;1618197793; vn&#x3D;1; Hm_lvt_ae5edc2bc4fc71370807f6187f0a2dd0&#x3D;1618197793; questionnaire_pv&#x3D;1618185602; Hm_lpvt_ae5edc2bc4fc71370807f6187f0a2dd0&#x3D;1618197883</span><br><span class="line">origin: https:&#x2F;&#x2F;service.zol.com.cn</span><br><span class="line">referer: https:&#x2F;&#x2F;service.zol.com.cn&#x2F;user&#x2F;siteLogin.php?type&#x3D;small&amp;callback&#x3D;userLoginCallback&amp;backurl&#x3D;https:&#x2F;&#x2F;www.zol.com.cn&#x2F;</span><br><span class="line">sec-fetch-mode: cors</span><br><span class="line">sec-fetch-site: same-origin</span><br><span class="line">user-agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;78.0.3904.70 Safari&#x2F;537.36</span><br><span class="line">x-requested-with: XMLHttpRequest</span><br></pre></td></tr></table></figure><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">userid: 15806204096</span><br><span class="line">pwd: 74ce2ba17b2c218246e778fb5e895c95</span><br><span class="line">isAuto: 1</span><br><span class="line">backurl: http:&#x2F;&#x2F;www.zol.com.cn&#x2F;</span><br><span class="line">tmallBtn: 0</span><br><span class="line">activeBtn: 0</span><br><span class="line">headPicid: 0</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>全局搜索siteLogin/login.php</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/image-20210412112828654.png" alt="image-20210412112828654"></p><p>中关村非常的耿直，加密使用md5,<code>var md5Password = CryptoJS.MD5(password+&quot;zol&quot;) + &#39;&#39;;</code>输入123提交的pwd为74ce2ba17b2c218246e778fb5e895c95，通过md5比对</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/image-20210412113012113.png" alt="image-20210412113012113"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>拷贝Form Data到请求头加引号.py中自动生成dict格式</p><p><img src="/2021/04/12/js%E9%80%86%E5%90%91%E4%B9%8B%E4%B8%AD%E5%85%B3%E6%9D%91%E5%9C%A8%E7%BA%BFpwd/image-20210412113757176.png" alt="image-20210412113757176"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from hashlib import md5</span><br><span class="line"></span><br><span class="line">username &#x3D; &#39;15806204095&#39;</span><br><span class="line">pwd &#x3D; &#39;123&#39;</span><br><span class="line">md5_pwd &#x3D; md5((pwd + &#39;zol&#39;).encode(&#39;utf8&#39;)).hexdigest()</span><br><span class="line">print(md5_pwd)</span><br><span class="line">url &#x3D; &#39;https:&#x2F;&#x2F;service.zol.com.cn&#x2F;user&#x2F;ajax&#x2F;siteLogin&#x2F;login.php&#39;</span><br><span class="line">data &#x3D; &#123;</span><br><span class="line">    &#39;userid&#39;: username,</span><br><span class="line">    &#39;pwd&#39;: md5_pwd,</span><br><span class="line">    &#39;isAuto&#39;: &#39;1&#39;,</span><br><span class="line">    &#39;backurl&#39;: &#39;http:&#x2F;&#x2F;www.zol.com.cn&#x2F;&#39;,</span><br><span class="line">    &#39;tmallBtn&#39;: &#39;0&#39;,</span><br><span class="line">    &#39;activeBtn&#39;: &#39;0&#39;,</span><br><span class="line">    &#39;headPicid&#39;: &#39;0&#39;,</span><br><span class="line">&#125;</span><br><span class="line">r &#x3D;requests.post(url,data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS逆向之融金所sign</title>
      <link href="2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/"/>
      <url>2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/</url>
      
        <content type="html"><![CDATA[<p><a href="https://m.rjs.com/member/user.html#1" target="_blank" rel="noopener">https://m.rjs.com/member/user.html#1</a></p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>登录url:</p><p>POST <a href="https://m.rjs.com/japi/account/login.json" target="_blank" rel="noopener">https://m.rjs.com/japi/account/login.json</a></p><p>请求头：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">:authority: m.rjs.com</span><br><span class="line">:method: POST</span><br><span class="line">:path: &#x2F;japi&#x2F;account&#x2F;login.json</span><br><span class="line">:scheme: https</span><br><span class="line">accept: application&#x2F;json, text&#x2F;plain, *&#x2F;*</span><br><span class="line">accept-encoding: gzip, deflate, br</span><br><span class="line">accept-language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">content-length: 172</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">cookie: riskTipTimes1&#x3D;1; Hm_lvt_7ff1e43d61e6b35b46f6bb33c3aba9bb&#x3D;1618099071; Hm_lpvt_7ff1e43d61e6b35b46f6bb33c3aba9bb&#x3D;1618099071</span><br><span class="line">datatype: json</span><br><span class="line">origin: https:&#x2F;&#x2F;m.rjs.com</span><br><span class="line">referer: https:&#x2F;&#x2F;m.rjs.com&#x2F;member&#x2F;user.html</span><br><span class="line">sec-ch-ua: &quot;Google Chrome&quot;;v&#x3D;&quot;89&quot;, &quot;Chromium&quot;;v&#x3D;&quot;89&quot;, &quot;;Not\&quot;A\\Brand&quot;;v&#x3D;&quot;99&quot;</span><br><span class="line">sec-ch-ua-mobile: ?1</span><br><span class="line">sec-fetch-dest: empty</span><br><span class="line">sec-fetch-mode: cors</span><br><span class="line">sec-fetch-site: same-origin</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;50.0.2661.87 Safari&#x2F;537.36</span><br></pre></td></tr></table></figure><p>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;platform&quot;:&quot;wap&quot;,&quot;session_token&quot;:&quot;&quot;,&quot;session_id&quot;:&quot;&quot;,&quot;data&quot;:&#123;&quot;userName&quot;:&quot;15806204085&quot;,&quot;password&quot;:&quot;123&quot;&#125;,&quot;sign&quot;:&quot;b6a20a0b1c82b87d65b78b2943bb3fbc&quot;,&quot;timestamp&quot;:1618099099626&#125;</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>搜索japi/account/login.json 无果</p><p>搜索account/login.json</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">loginAction: function() &#123;</span><br><span class="line">    if (this.checkLoginKey() &amp;&amp; this.checkLoginPwd()) &#123;</span><br><span class="line">        var e &#x3D; this;</span><br><span class="line">        c.Common.fajax(&#123;</span><br><span class="line">            url: &quot;account&#x2F;login.json&quot;,</span><br><span class="line">            easyOriginData: &#123;</span><br><span class="line">                userName: e.loginKey,</span><br><span class="line">                password: e.loginPwd</span><br><span class="line">            &#125;,</span><br><span class="line">            success: function(t) &#123;</span><br><span class="line">                1 &#x3D;&#x3D; t.status ? (c.Common.cookie.set(&quot;session_token_dp&quot;, t.data.sessionToken, &quot;&#x2F;&quot;, &quot;&#x2F;&quot;, 168),</span><br><span class="line">                c.Common.cookie.set(&quot;platform&quot;, &quot;wap&quot;, &quot;&#x2F;&quot;, &quot;&#x2F;&quot;, 168),</span><br><span class="line">                c.Common.localStore.set(&quot;session_token_dp&quot;, t.data.sessionToken),</span><br><span class="line">                c.Common.localStore.set(&quot;uid_dp&quot;, t.data.uid),</span><br><span class="line">                c.Common.cookie.set(&quot;secretKey&quot;, t.data.secretKey, &quot;&#x2F;&quot;, &quot;&#x2F;&quot;, 168),</span><br><span class="line">                c.Common.alert(&quot;simpleSuccess&quot;, &quot;登录成功&quot;, 1, e.goHref, &quot;&#x2F;member-undp&#x2F;index.html&quot;)) : e.alert(t.message)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>打上断点调试，此时并没有出现sign,说明sign应该是在fajax中生成，进入fajax中，逐步调试，<code>t[&quot;sign&quot;] = i(f + &quot;&amp;&quot; + i(o.genSignData(t.data)) + &quot;&amp;&quot; + d),</code>这一步出现了sign进行填值，f为<code>/account/login.json</code></p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411184621104.png" alt="image-20210411184621104"></p><p>d是””空字符串</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411184650658.png" alt="image-20210411184650658"></p><p>接下来分析<code>i(o.genSignData(t.data))</code>中的<code>o.genSignData(t.data)</code>,其中t.data为账户密码的对象</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411184839858.png" alt="image-20210411184839858"></p><h2 id="genSignData"><a href="#genSignData" class="headerlink" title="genSignData"></a>genSignData</h2><p>i(o.genSignData(t.data))分析，先进入o.genSignData函数，拆分出来js如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var genSignData &#x3D; function(e) &#123;</span><br><span class="line">    var t &#x3D; &quot;&quot;</span><br><span class="line">      , n &#x3D; [];</span><br><span class="line">    for (var r in e)</span><br><span class="line">        n.push(r);</span><br><span class="line">    n &#x3D; n.sort();</span><br><span class="line">    for (var i &#x3D; 0; i &lt; n.length; i++) &#123;</span><br><span class="line">        var o &#x3D; n[i]</span><br><span class="line">          , s &#x3D; e[o]</span><br><span class="line">          , l &#x3D; !1;</span><br><span class="line">        if (&quot;object&quot; &#x3D;&#x3D; (&quot;undefined&quot; &#x3D;&#x3D; typeof s ? &quot;undefined&quot; : (0,</span><br><span class="line">        a.default)(s))) &#123;</span><br><span class="line">            var c &#x3D; &quot;&#123;&quot;;</span><br><span class="line">            for (var u in s)</span><br><span class="line">                c +&#x3D; u + &quot;&#x3D;&quot; + s[u] + &quot;, &quot;,</span><br><span class="line">                l &#x3D; !0;</span><br><span class="line">            l &amp;&amp; (s &#x3D; c.substring(0, c.length - 2) + &quot;&#125;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        &quot;sign&quot; !&#x3D; o &amp;&amp; null !&#x3D;&#x3D; s &amp;&amp; void 0 !&#x3D;&#x3D; s &amp;&amp; &quot;&quot; !&#x3D;&#x3D; s &amp;&amp; (&quot;object&quot; !&#x3D; (&quot;undefined&quot; &#x3D;&#x3D; typeof s ? &quot;undefined&quot; : (0,</span><br><span class="line">        a.default)(s)) || l) &amp;&amp; (t +&#x3D; (0 &#x3D;&#x3D; i ? &quot;&quot; : &quot;&amp;&quot;) + o + &quot;&#x3D;&quot; + s)</span><br><span class="line">    &#125;</span><br><span class="line">    return null !&#x3D; t &amp;&amp; &quot;&quot; !&#x3D; t &amp;&amp; &quot;&amp;&quot; &#x3D;&#x3D; t.substr(0, 1) &amp;&amp; (t &#x3D; t.substr(1, t.length)),</span><br><span class="line">    t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单独运行时报错<code>Uncaught ReferenceError: a is not defined</code>,打印a.default</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411185111684.png" alt="image-20210411185111684"></p><p>进入a.default,该三元运算所得结果即为控制台打印结果，必然前面的是完全匹配的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> t.default &#x3D; &quot;function&quot; &#x3D;&#x3D; typeof s.default &amp;&amp; &quot;symbol&quot; &#x3D;&#x3D;&#x3D; l(a.default) ? function(e) &#123;</span><br><span class="line">    return &quot;undefined&quot; &#x3D;&#x3D; typeof e ? &quot;undefined&quot; : l(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该l函数在上面也有定义如下</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411185437746.png" alt="image-20210411185437746"></p><p>那么我们定义函数k即a.default如下,替换genSignData完成函数解密<code>password=123&amp;userName=15806204095</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var k &#x3D; function(e)&#123;</span><br><span class="line">return&quot;undefined&quot;&#x3D;&#x3D;typeof e?&quot;undefined&quot;: typeof e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="i"><a href="#i" class="headerlink" title="i"></a>i</h2><p>i(o.genSignData(t.data))分析，接下来就是i函数的分析，进入i函数</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411124238222.png" alt="image-20210411124238222"></p><p>第一次调用i函数时，先调用o函数进行加密，再调用wordsToBytes转成字节，返回bytesToHex生成16进制字符串，整体逻辑理清后进入o函数。</p><h3 id="o"><a href="#o" class="headerlink" title="o"></a>o</h3><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411185814560.png" alt="image-20210411185814560"></p><p>该函数中引用了n(694),n(247).utf8,n(974),n(247).bin,通过debug可知以上都生成了加密函数</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411185946412.png" alt="image-20210411185946412"></p><p>这些加密函数搜索分别发现出现在了694:function，247:function等等，可以断定，这些函数其实就是作为变量在o函数中调用</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411190204917.png" alt="image-20210411190204917"></p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411190338395.png" alt="image-20210411190338395"></p><p>扣出694,247,974的代码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">var liu94 &#x3D; function (e, t) &#123;</span><br><span class="line">        var t &#x3D; &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&quot;</span><br><span class="line">            , n &#x3D; &#123;</span><br><span class="line">                rotl: function (e, t) &#123;</span><br><span class="line">                    return e &lt;&lt; t | e &gt;&gt;&gt; 32 - t</span><br><span class="line">                &#125;,</span><br><span class="line">                rotr: function (e, t) &#123;</span><br><span class="line">                    return e &lt;&lt; 32 - t | e &gt;&gt;&gt; t</span><br><span class="line">                &#125;,</span><br><span class="line">                endian: function (e) &#123;</span><br><span class="line">                    if (e.constructor &#x3D;&#x3D; Number)</span><br><span class="line">                        return 16711935 &amp; n.rotl(e, 8) | 4278255360 &amp; n.rotl(e, 24);</span><br><span class="line">                    for (var t &#x3D; 0; t &lt; e.length; t++)</span><br><span class="line">                        e[t] &#x3D; n.endian(e[t]);</span><br><span class="line">                    return e</span><br><span class="line">                &#125;,</span><br><span class="line">                randomBytes: function (e) &#123;</span><br><span class="line">                    for (var t &#x3D; []; e &gt; 0; e--)</span><br><span class="line">                        t.push(Math.floor(256 * Math.random()));</span><br><span class="line">                    return t</span><br><span class="line">                &#125;,</span><br><span class="line">                bytesToWords: function (e) &#123;</span><br><span class="line">                    for (var t &#x3D; [], n &#x3D; 0, r &#x3D; 0; n &lt; e.length; n++,</span><br><span class="line">                        r +&#x3D; 8)</span><br><span class="line">                        t[r &gt;&gt;&gt; 5] |&#x3D; e[n] &lt;&lt; 24 - r % 32;</span><br><span class="line">                    return t</span><br><span class="line">                &#125;,</span><br><span class="line">                wordsToBytes: function (e) &#123;</span><br><span class="line">                    for (var t &#x3D; [], n &#x3D; 0; n &lt; 32 * e.length; n +&#x3D; 8)</span><br><span class="line">                        t.push(e[n &gt;&gt;&gt; 5] &gt;&gt;&gt; 24 - n % 32 &amp; 255);</span><br><span class="line">                    return t</span><br><span class="line">                &#125;,</span><br><span class="line">                bytesToHex: function (e) &#123;</span><br><span class="line">                    for (var t &#x3D; [], n &#x3D; 0; n &lt; e.length; n++)</span><br><span class="line">                        t.push((e[n] &gt;&gt;&gt; 4).toString(16)),</span><br><span class="line">                            t.push((15 &amp; e[n]).toString(16));</span><br><span class="line">                    return t.join(&quot;&quot;)</span><br><span class="line">                &#125;,</span><br><span class="line">                hexToBytes: function (e) &#123;</span><br><span class="line">                    for (var t &#x3D; [], n &#x3D; 0; n &lt; e.length; n +&#x3D; 2)</span><br><span class="line">                        t.push(parseInt(e.substr(n, 2), 16));</span><br><span class="line">                    return t</span><br><span class="line">                &#125;,</span><br><span class="line">                bytesToBase64: function (e) &#123;</span><br><span class="line">                    for (var n &#x3D; [], r &#x3D; 0; r &lt; e.length; r +&#x3D; 3)</span><br><span class="line">                        for (var i &#x3D; e[r] &lt;&lt; 16 | e[r + 1] &lt;&lt; 8 | e[r + 2], a &#x3D; 0; a &lt; 4; a++)</span><br><span class="line">                            8 * r + 6 * a &lt;&#x3D; 8 * e.length ? n.push(t.charAt(i &gt;&gt;&gt; 6 * (3 - a) &amp; 63)) : n.push(&quot;&#x3D;&quot;);</span><br><span class="line">                    return n.join(&quot;&quot;)</span><br><span class="line">                &#125;,</span><br><span class="line">                base64ToBytes: function (e) &#123;</span><br><span class="line">                    e &#x3D; e.replace(&#x2F;[^A-Z0-9+\&#x2F;]&#x2F;gi, &quot;&quot;);</span><br><span class="line">                    for (var n &#x3D; [], r &#x3D; 0, i &#x3D; 0; r &lt; e.length; i &#x3D; ++r % 4)</span><br><span class="line">                        0 !&#x3D; i &amp;&amp; n.push((t.indexOf(e.charAt(r - 1)) &amp; Math.pow(2, -2 * i + 8) - 1) &lt;&lt; 2 * i | t.indexOf(e.charAt(r)) &gt;&gt;&gt; 6 - 2 * i);</span><br><span class="line">                    return n</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        return n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var er47 &#x3D; &#123;</span><br><span class="line">    utf8: &#123;</span><br><span class="line">        stringToBytes: function (e) &#123;</span><br><span class="line">            return er47.bin.stringToBytes(unescape(encodeURIComponent(e)))</span><br><span class="line">        &#125;,</span><br><span class="line">        bytesToString: function (e) &#123;</span><br><span class="line">            return decodeURIComponent(escape(er47.bin.bytesToString(e)))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    bin: &#123;</span><br><span class="line">        stringToBytes: function (e) &#123;</span><br><span class="line">            for (var t &#x3D; [], n &#x3D; 0; n &lt; e.length; n++)</span><br><span class="line">                t.push(255 &amp; e.charCodeAt(n));</span><br><span class="line">            return t</span><br><span class="line">        &#125;,</span><br><span class="line">        bytesToString: function (e) &#123;</span><br><span class="line">            for (var t &#x3D; [], n &#x3D; 0; n &lt; e.length; n++)</span><br><span class="line">                t.push(String.fromCharCode(e[n]));</span><br><span class="line">            return t.join(&quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var jiu74 &#x3D; function (e, t) &#123;</span><br><span class="line">    function n(e) &#123;</span><br><span class="line">        return !!e.constructor &amp;&amp; &quot;function&quot; &#x3D;&#x3D; typeof e.constructor.isBuffer &amp;&amp; e.constructor.isBuffer(e)</span><br><span class="line">    &#125;</span><br><span class="line">    function r(e) &#123;</span><br><span class="line">        return &quot;function&quot; &#x3D;&#x3D; typeof e.readFloatLE &amp;&amp; &quot;function&quot; &#x3D;&#x3D; typeof e.slice &amp;&amp; n(e.slice(0, 0))</span><br><span class="line">    &#125;</span><br><span class="line">    return function (e) &#123;</span><br><span class="line">        return null !&#x3D; e &amp;&amp; (n(e) || r(e) || !!e._isBuffer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在o函数中改写t,r,i,a</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var t &#x3D; liu94()</span><br><span class="line">    , r &#x3D; er47.utf8</span><br><span class="line">    , i &#x3D; jiu74()</span><br><span class="line">    , a &#x3D; er47.bin</span><br></pre></td></tr></table></figure><p>最终只要将o函数中exports的函数return出来即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">res &#x3D; function (e, n) &#123;</span><br><span class="line">console.log(e)</span><br><span class="line">if (void 0 &#x3D;&#x3D;&#x3D; e || null &#x3D;&#x3D;&#x3D; e)</span><br><span class="line">        throw new Error(&quot;Illegal argument &quot; + e);</span><br><span class="line">    var r &#x3D; t.wordsToBytes(o(e, n));</span><br><span class="line">    console.log(r)</span><br><span class="line">    return n &amp;&amp; n.asBytes ? r : n &amp;&amp; n.asString ? a.bytesToString(r) : t.bytesToHex(r)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;res(&quot;password&#x3D;123&amp;userName&#x3D;158062204095&quot;, undefined);</span><br><span class="line">&#x2F;&#x2F;console.log(&#39;--------&gt;&#39;,res(origin, undefined))</span><br><span class="line">return res;</span><br></pre></td></tr></table></figure><p>由于o(e,n)中的即为o.genSignData生成的账密参数<code>password=123&amp;userName=15806204095</code>，n为undefined，那么我们就可以直接调用该方法返回真正的sign。</p><p><code>console.log(encrypt()(&quot;/account/login.json&quot;+&quot;&amp;&quot;+encrypt()(genSignData(UP))+&quot;&amp;&quot;+&quot;&quot;));</code></p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411191326027.png" alt="image-20210411191326027"></p><p>查看抓包后的结果如下</p><p><img src="/2021/04/11/js%E9%80%86%E5%90%91%E4%B9%8B%E8%9E%8D%E9%87%91%E6%89%80sign/image-20210411191409718.png" alt="image-20210411191409718"></p><h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import execjs</span><br><span class="line"></span><br><span class="line">username &#x3D; &quot;15806204095&quot;</span><br><span class="line">psssword &#x3D; &quot;123&quot;</span><br><span class="line">with open(r&#39;rjs_sign.js&#39;, encoding&#x3D;&#39;utf-8&#39;, mode&#x3D;&#39;r&#39;) as f:</span><br><span class="line">    JsData &#x3D; f.read()</span><br><span class="line">sign &#x3D; execjs.compile(JsData).call(&#39;request&#39;,username,psssword)</span><br><span class="line">data &#x3D; json.dumps(&#123;&quot;platform&quot;:&quot;wap&quot;,&quot;session_token&quot;:&quot;&quot;,&quot;session_id&quot;:&quot;&quot;,&quot;data&quot;:&#123;&quot;userName&quot;:username,&quot;password&quot;:psssword&#125;,&quot;sign&quot;:sign,&quot;timestamp&quot;:1618153079455&#125;)</span><br><span class="line">r &#x3D;requests.post(&quot;https:&#x2F;&#x2F;m.rjs.com&#x2F;japi&#x2F;account&#x2F;login.json&quot;,data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：JS逆向</strong></p>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hook抓包trace定位实战</title>
      <link href="2021/04/10/hook%E6%8A%93%E5%8C%85trace%E5%AE%9A%E4%BD%8D%E5%AE%9E%E6%88%98/"/>
      <url>2021/04/10/hook%E6%8A%93%E5%8C%85trace%E5%AE%9A%E4%BD%8D%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之Scrapy抓取京东</title>
      <link href="2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/"/>
      <url>2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h1><p>同一台服务器上不同的项目可能依赖的包不同版本，新版本默认覆盖旧版本，可能导致其他项目无法运行，通过虚拟环境，完全隔离各个项目各个版本的依赖包，实现运行环境互不影响。</p><h2 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv安装virtualenv</span><br><span class="line">python -m pip install --upgrade pip  升级pip</span><br><span class="line">pip install -i https:&#x2F;&#x2F;pypi.doubanio.com&#x2F;simple&#x2F; --trusted-host pypi.doubanio.com scrapy</span><br><span class="line">pip install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple  使用清华源</span><br><span class="line">pip uninstall scrapy    卸载django </span><br><span class="line">virtualenv scrapytest   默认环境创建虚拟环境</span><br><span class="line">cd scrapytest&#x2F;Scripts &amp;&amp;  activate.bat &amp;&amp; python 进入3.7虚拟环境</span><br><span class="line">virtualenv -p D:\Python27\python.exe scrapytest</span><br><span class="line">cd scrapytest&#x2F;Scripts &amp;&amp;  activate.bat &amp;&amp; python 进入2.7虚拟环境</span><br><span class="line">deactivate.bat          退出虚拟环境</span><br><span class="line"></span><br><span class="line">apt-get install python-virtualenv       安装虚拟环境</span><br><span class="line">virtualenv py2 &amp;&amp; cd py2 &amp;&amp; cd bin &amp;&amp; source activate &amp;&amp; python 进入2.7虚拟环境</span><br><span class="line">virtualenv -p &#x2F;usr&#x2F;bin&#x2F;python3 py3 &amp;&amp; &amp;&amp; cd py3 &amp;&amp; cd bin &amp;&amp; source activate &amp;&amp; python  进入3.7虚拟环境</span><br></pre></td></tr></table></figure><h2 id="virtualenvwrapper"><a href="#virtualenvwrapper" class="headerlink" title="virtualenvwrapper"></a>virtualenvwrapper</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenvwrapper</span><br><span class="line">pip install virtualenvwrapper-win解决workon不是内部指令</span><br><span class="line">workon  列出所有虚拟环境</span><br><span class="line">新建环境变量   WORKON_HOME&#x3D;E:\envs</span><br><span class="line">mkvirtualenv py3scrapy  新建并进入虚拟环境</span><br><span class="line">deactivate          退出虚拟环境</span><br><span class="line">workon py3scrapy        进入指定虚拟环境</span><br><span class="line">    pip install -i https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple scrapy    安装scrapy源</span><br><span class="line">    若缺少lxml出错https:&#x2F;&#x2F;www.lfd.uci.edu&#x2F;~gohlke&#x2F;pythonlibs&#x2F;寻找对应版本的lxml的whl源</span><br><span class="line">    python -m pip install --upgrade pip     更新pip</span><br><span class="line">    pip install lxml-4.1.1-cp35-cp35m-win_amd64.whl</span><br><span class="line">    若缺少Twisted出错http:&#x2F;&#x2F;www.lfd.uci.edu&#x2F;~gohlke&#x2F;pythonlibs&#x2F;#lxml搜对应版本Twisted</span><br><span class="line">    pip install Twisted‑17.9.0‑cp35‑cp35m‑win_amd64.whl</span><br><span class="line">mkvirtualenv --python&#x3D;D:\Python27\python.exe py2scrapy      一般不会出问题</span><br><span class="line">    pip install -i https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple scrapy</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">pip install virtualenvwrapper    </span><br><span class="line">    find &#x2F; -name virualenvwrapper.sh</span><br><span class="line">    vim ~&#x2F;.bashrc</span><br><span class="line">        export WORKON_HOME&#x3D;$HOME&#x2F;.virtualenvs</span><br><span class="line">        source &#x2F;home&#x2F;wj&#x2F;.local&#x2F;bin&#x2F;virtualenvwrapper.sh</span><br><span class="line">    source ~&#x2F;.bashrc    </span><br><span class="line">mkvirtualenv py2scrapy          指向生成~&#x2F;.virtualenv</span><br><span class="line">deactivate          退出虚拟环境</span><br><span class="line">mkdirtualenv --python&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3 py3scrapy</span><br><span class="line">rmvirtualenv py3scrapy  删除虚拟环境</span><br></pre></td></tr></table></figure><h1 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h1><p><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/%E4%BA%AC%E4%B8%9C%E5%85%A8%E7%BD%91%E7%88%AC%E8%99%AB.png" alt="京东全网爬虫"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple&#x2F; scrapy  安装scrapy</span><br><span class="line">scrapy startproject mall_spider  创建mall_spider项目</span><br><span class="line">scrapy genspider jd_category https:&#x2F;&#x2F;dc.3.cn&#x2F;category&#x2F;get  创建分类爬虫</span><br><span class="line">scrapy genspider --list  查看爬虫生成模板</span><br><span class="line">scrapy genspider -t crawl lagou www.lagou.com   创建全站爬虫</span><br><span class="line">pip freeze &gt; requirements.txt 生成依赖到文件</span><br><span class="line">pip install -r requirements.txt 一键安装依赖</span><br><span class="line">scrapy shell http:&#x2F;&#x2F;blog.jobbole.com&#x2F;       可以在脚本中调试xpath或者chrome浏览器右键copy xpath,chrome浏览器右键copy selector</span><br><span class="line">scrapy shell -s USER_AGENT&#x3D;&quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko&#x2F;20100101 Firefox&#x2F;51.0&quot; https:&#x2F;&#x2F;www.zhihu.com&#x2F;question&#x2F;56320032</span><br><span class="line">view(response)</span><br></pre></td></tr></table></figure><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><h3 id="1-1-抓取首页的分类信息"><a href="#1-1-抓取首页的分类信息" class="headerlink" title="1.1 抓取首页的分类信息"></a>1.1 抓取首页的分类信息</h3><ul><li>抓取数据: 各级分类的名称 和 URL<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/01_%E4%BA%AC%E4%B8%9C%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF.png"></li></ul><h3 id="1-2-抓取商品信息"><a href="#1-2-抓取商品信息" class="headerlink" title="1.2 抓取商品信息"></a>1.2 抓取商品信息</h3><ul><li><p>抓取: 商品名称, 商品价格, 商品评论数量, 商品店铺, 商品促销, 商品选项, 商品图片的URL<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/02_%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E4%BF%A1%E6%81%AF.png"></p></li><li><p>由于全网爬虫, 抓取页面非常多, 为了提高抓的速度, 选择使用scrapy框架 + scrapy_redis分布式组件</p></li><li><p>由于京东全网的数据量达到了亿级, 存储又是结构化数据, 数据库, 选择使用MongoDB;  </p></li></ul><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>我们采用广度优先策略, 我们把类别和商品信息的抓取分开来做. </p><p><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/image-20210422163642994.png" alt="image-20210422163642994"></p><h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><h4 id="类别模型"><a href="#类别模型" class="headerlink" title="类别模型"></a>类别模型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Category(scrapy.Item):</span><br><span class="line">    &quot;&quot;&quot;商品类别&quot;&quot;&quot;</span><br><span class="line">    # 大分类名称</span><br><span class="line">    b_category_name &#x3D; scrapy.Field()</span><br><span class="line">    # 大分类URL</span><br><span class="line">    b_category_url &#x3D; scrapy.Field()</span><br><span class="line">    # 中分类名称</span><br><span class="line">    m_category_name &#x3D; scrapy.Field()</span><br><span class="line">    # 中分类URL</span><br><span class="line">    m_category_url &#x3D; scrapy.Field()</span><br><span class="line">    # 小分类名称</span><br><span class="line">    s_category_name &#x3D; scrapy.Field()</span><br><span class="line">    # 小分类URL</span><br><span class="line">    s_category_url &#x3D; scrapy.Field()</span><br></pre></td></tr></table></figure><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Product(scrapy.Item):</span><br><span class="line">    # 商品类别</span><br><span class="line">    product_category &#x3D; scrapy.Field()</span><br><span class="line">    # 商品ID</span><br><span class="line">    product_sku_id &#x3D; scrapy.Field()</span><br><span class="line">    # 商品名称</span><br><span class="line">    product_name &#x3D; scrapy.Field()</span><br><span class="line">    # 商品图片URL</span><br><span class="line">    product_img_url &#x3D; scrapy.Field()</span><br><span class="line">    # 商品店铺</span><br><span class="line">    product_shop &#x3D; scrapy.Field()</span><br><span class="line">    # 图书信息, 作者,出版社</span><br><span class="line">    product_book_info &#x3D; scrapy.Field()</span><br><span class="line">    # 商品选项</span><br><span class="line">    product_option &#x3D; scrapy.Field()</span><br><span class="line">    # 商品评论数量</span><br><span class="line">    product_comments &#x3D; scrapy.Field()</span><br><span class="line">    # 商品促销</span><br><span class="line">    product_ad &#x3D; scrapy.Field()</span><br><span class="line">    # 商品价格</span><br><span class="line">    product_price &#x3D; scrapy.Field()</span><br></pre></td></tr></table></figure><h3 id="分类爬虫"><a href="#分类爬虫" class="headerlink" title="分类爬虫"></a>分类爬虫</h3><h4 id="分析-分类信息的URL"><a href="#分析-分类信息的URL" class="headerlink" title="分析, 分类信息的URL"></a>分析, 分类信息的URL</h4><ul><li><code>目标</code>: <code>确定分类信息的URL</code></li><li><code>步骤</code>: <ol><li>进入到京东首页</li><li>右键检查, 打开开发者工具, 搜索 <code>家用电器</code></li><li>确定分类的URL</li></ol></li><li><code>图解</code>:<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/03_%E7%A1%AE%E5%AE%9A%E5%88%86%E7%B1%BB%E7%9A%84URL.png"></li><li><code>结论</code>:<ul><li>分类URL: <code>https://dc.3.cn/category/get</code></li></ul></li></ul><h4 id="创建爬虫-抓取数据"><a href="#创建爬虫-抓取数据" class="headerlink" title="创建爬虫, 抓取数据"></a>创建爬虫, 抓取数据</h4><ul><li><code>目标</code>: <code>抓取分类数据, 交给引擎</code></li><li><code>步骤</code>:<ol><li>创建类别爬虫</li><li>指定起始URL</li><li>解析数据, 交给引擎</li></ol></li></ul><h4 id="创建爬虫"><a href="#创建爬虫" class="headerlink" title="创建爬虫"></a>创建爬虫</h4><ul><li>进入项目目录: <code>cd mall_spider</code></li><li>创建爬虫: <code>scrapy genspider category_spider jd.com</code></li></ul><h4 id="指定起始URL"><a href="#指定起始URL" class="headerlink" title="指定起始URL"></a>指定起始URL</h4><ul><li>修改起始URL: <code>https://dc.3.cn/category/get</code></li></ul><h4 id="解析数据-交给引擎"><a href="#解析数据-交给引擎" class="headerlink" title="解析数据, 交给引擎"></a>解析数据, 交给引擎</h4><ul><li>分析数据格式:<ul><li>整体数据<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/05_1_%E6%95%B4%E4%BD%93%E5%88%86%E7%B1%BB%E6%A6%82%E5%86%B5.png"> </li><li>各级分类位置<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/05_2_%E5%90%84%E7%BA%A7%E5%88%86%E7%B1%BB%E4%BD%8D%E7%BD%AE.png"> </li><li>分类信息格式<ul><li>格式1: <ul><li><code>jiadian.jd.com|家用电器||0</code></li><li>特点: 第一项分类URL,第二项分类名称</li></ul></li><li>格式2: <ul><li><code>652-654|摄影摄像||0</code></li><li>对应的URL: <code>https://channel.jd.com/652-654.html</code></li><li>特点:第一项是频道ID, 包含一个 <code>-</code></li></ul></li><li>格式3: <ul><li><code>1318-2628-12131|户外风衣||0</code> </li><li>对应URL: <code>https://list.jd.com/list.html?cat=1318,2628,12131</code></li><li>特点: 第一项为分类ID, 包含两个 <code>-</code></li></ul></li></ul></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">class JdCategorySpider(scrapy.Spider):</span><br><span class="line">    name &#x3D; &#39;jd_category&#39;</span><br><span class="line">    allowed_domains &#x3D; [&#39;3.cn&#39;]</span><br><span class="line">    start_urls &#x3D; [&#39;https:&#x2F;&#x2F;dc.3.cn&#x2F;category&#x2F;get&#39;]</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        # print(response.body.decode(&#39;GBK&#39;))</span><br><span class="line">        result &#x3D; json.loads(response.body.decode(&#39;GBK&#39;))</span><br><span class="line">        datas &#x3D; result[&#39;data&#39;]</span><br><span class="line">        # 遍历数据列表</span><br><span class="line">        for data in datas:</span><br><span class="line"></span><br><span class="line">            item &#x3D; Category()</span><br><span class="line"></span><br><span class="line">            b_category &#x3D; data[&#39;s&#39;][0]</span><br><span class="line">            b_category_info &#x3D; b_category[&#39;n&#39;]</span><br><span class="line">            # print(&#39;大分类: &#123;&#125;&#39;.format(b_category_info))</span><br><span class="line">            item[&#39;b_category_name&#39;], item[&#39;b_category_url&#39;] &#x3D; self.get_category_name_url(b_category_info)</span><br><span class="line"></span><br><span class="line">            # 中分类信息列表</span><br><span class="line">            m_category_s &#x3D; b_category[&#39;s&#39;]</span><br><span class="line">            # 遍历中分类列表</span><br><span class="line">            for m_category in m_category_s:</span><br><span class="line">                # 中分类信息</span><br><span class="line">                m_category_info &#x3D; m_category[&#39;n&#39;]</span><br><span class="line">                # print(&#39;中分类: &#123;&#125;&#39;.format(m_category_info))</span><br><span class="line">                item[&#39;m_category_name&#39;], item[&#39;m_category_url&#39;] &#x3D; self.get_category_name_url(m_category_info)</span><br><span class="line"></span><br><span class="line">                # 小分类数据列表</span><br><span class="line">                s_category_s &#x3D; m_category[&#39;s&#39;]</span><br><span class="line">                for s_category in s_category_s:</span><br><span class="line">                    s_category_info &#x3D; s_category[&#39;n&#39;]</span><br><span class="line">                    # print(&#39;小分类: &#123;&#125;&#39;.format(s_category_info))</span><br><span class="line">                    item[&#39;s_category_name&#39;], item[&#39;s_category_url&#39;] &#x3D; self.get_category_name_url(s_category_info)</span><br><span class="line">                    # print(item)</span><br><span class="line">                    # 把数据交给引擎</span><br><span class="line">                    yield item</span><br><span class="line"></span><br><span class="line">    def get_category_name_url(self, category_info):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        根据分类信息, 提取名称和URL</span><br><span class="line">        :param category_info:  分类信息</span><br><span class="line">        :return: 分类的名称和URL</span><br><span class="line">        分析数据格式(三类数据格式)</span><br><span class="line">        - book.jd.com&#x2F;library&#x2F;science.html|科学技术||0</span><br><span class="line">        - 1713-3287|计算机与互联网||0</span><br><span class="line">          - Https:&#x2F;&#x2F;channel.jd.com&#x2F;&#123;&#125;.html</span><br><span class="line">        - 9987-12854-12856|屏幕换新||0</span><br><span class="line">          - Https:&#x2F;&#x2F;list.jd.com&#x2F;list.html?cat&#x3D;&#123;&#125;</span><br><span class="line">          - 把 - 替换为逗号, 然后填充到占位的地方.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        category &#x3D; category_info.split(&#39;|&#39;)</span><br><span class="line">        # 分类URL</span><br><span class="line">        category_url &#x3D; category[0]</span><br><span class="line">        # 分类名称</span><br><span class="line">        category_name &#x3D; category[1]</span><br><span class="line"></span><br><span class="line">        # 处理第一类分类URL</span><br><span class="line">        if category_url.count(&#39;jd.com&#39;) &#x3D;&#x3D; 1:</span><br><span class="line">            # URL进行补全</span><br><span class="line">            category_url &#x3D; &#39;https:&#x2F;&#x2F;&#39; + category_url</span><br><span class="line">        elif category_url.count(&#39;-&#39;) &#x3D;&#x3D; 1:</span><br><span class="line">            # 1713-3287|计算机与互联网||0</span><br><span class="line">            category_url &#x3D; &#39;https:&#x2F;&#x2F;channel.jd.com&#x2F;&#123;&#125;.html&#39;.format(category_url)</span><br><span class="line">        else:</span><br><span class="line">            # 9987-12854-12856|屏幕换新||0</span><br><span class="line">            # 把URL中 &#96;-&#96; 替换为 &#96;,&#96;</span><br><span class="line">            category_url &#x3D; category_url.replace(&#39;-&#39;, &#39;,&#39;)</span><br><span class="line">            # 补全URL</span><br><span class="line">            category_url &#x3D; &#39;https:&#x2F;&#x2F;list.jd.com&#x2F;list.html?cat&#x3D;&#123;&#125;&#39;.format(category_url)</span><br><span class="line"></span><br><span class="line">        # 返回类别的名称 和 URL</span><br><span class="line">        return category_name, category_url</span><br></pre></td></tr></table></figure><h3 id="保存分类数据"><a href="#保存分类数据" class="headerlink" title="保存分类数据"></a>保存分类数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 在settings.py开启, 类别的Pipeline</span><br><span class="line">ROBOTSTXT_OBEY &#x3D; False  不遵守网络协议</span><br><span class="line">ITEM_PIPELINES &#x3D; &#123;</span><br><span class="line">   &#39;mall_spider.pipelines.CategoryPipeline&#39;: 300,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>步骤</code>:</p><ol><li><code>open_spider</code>方法中, 链接MongoDB数据库, 获取要操作的集合</li><li><code>process_item</code> 方法中, 向MongoDB中插入类别数据</li><li><code>close_spider</code> 方法中, 关闭MongoDB的链接</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">实现保存分类的Pipeline类</span><br><span class="line">- open_spider方法中, 链接MongoDB数据库, 获取要操作的集合</span><br><span class="line">- process_item 方法中, 向MongoDB中插入类别数据</span><br><span class="line">- close_spider 方法中, 关闭MongoDB的链接</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">class CategoryPipeline(object):</span><br><span class="line"></span><br><span class="line">    def open_spider(self, spider):</span><br><span class="line">        &quot;&quot;&quot;当爬虫启动的时候执行1次&quot;&quot;&quot;</span><br><span class="line">        if isinstance(spider, JdCategorySpider):</span><br><span class="line">            # open_spider方法中, 链接MongoDB数据库, 获取要操作的集合</span><br><span class="line">            self.client &#x3D; MongoClient(MONGODB_URL)</span><br><span class="line">            self.collection &#x3D; self.client[&#39;jd&#39;][&#39;category&#39;]</span><br><span class="line"></span><br><span class="line">    def process_item(self, item, spider):</span><br><span class="line">        # process_item 方法中, 向MongoDB中插入类别数据</span><br><span class="line">        if isinstance(spider, JdCategorySpider):</span><br><span class="line">            self.collection.insert_one(dict(item))</span><br><span class="line"></span><br><span class="line">        return item</span><br><span class="line"></span><br><span class="line">    def close_spider(self, spider):</span><br><span class="line">        # close_spider 方法中, 关闭MongoDB的链接</span><br><span class="line">        if isinstance(spider, JdCategorySpider):</span><br><span class="line">            self.client.close()</span><br></pre></td></tr></table></figure><h3 id="商品爬虫"><a href="#商品爬虫" class="headerlink" title="商品爬虫"></a>商品爬虫</h3><p><code>总体设计</code>:</p><ol><li>把MongoDB中存储的分类信息, 放到redis_key指定列表中</li><li>支持分布式爬虫, 当然也可以在一台电脑上运行多次, 以启动多个进程,充分使用CPU的多核.</li><li>所以这里的爬虫, 先从一个分类开始抓就可以了, 后面再改造为分布式</li></ol><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul><li><p>列表页</p><ul><li><p>提取商品 skuid<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/07_1_%E4%BB%8E%E5%88%97%E8%A1%A8%E9%A1%B5%E6%88%96%E5%95%86%E5%93%81%E7%9A%84skuid.png">  </p></li><li><p>实现翻页</p><ul><li>获取下一页URL<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/07_2_%E8%8E%B7%E5%8F%96%E5%88%86%E9%A1%B5%E7%9A%84URL.png"></li><li>没有下一页的情况<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/07_3_%E6%B2%A1%E6%9C%89%E4%B8%8B%E4%B8%80%E9%A1%B5%E7%9A%84%E6%83%85%E5%86%B5.png"></li></ul></li></ul></li><li><p>详情页<br>由于PC和手机页面商品信息, 在js中, 且比较分散, 并且每次请求数量页比较大, 我们这里使用手机抓包, 抓到json数据. </p></li><li><p>商品基本信息</p><ul><li>图:<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/08_1_%E5%95%86%E5%93%81%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF.png"></li><li>URL: <code>https://cdnware.m.jd.com/c1/skuDetail/apple/7.3.0/32426231880.json</code>; 最后一部分是商品skuid</li><li>可以获取到的信息:  商品名称, 商品店铺信息 , 商品类别id, 商品品牌id, 商品选项</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line"><span class="attr">"code"</span>: <span class="string">"0"</span>,</span><br><span class="line"><span class="attr">"wareInfo"</span>: &#123;</span><br><span class="line"><span class="attr">"recommendInfo"</span>: &#123;</span><br><span class="line"><span class="attr">"recommendList"</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line">      <span class="comment">// 商品店铺信息</span></span><br><span class="line"><span class="attr">"shopInfo"</span>: &#123;</span><br><span class="line"><span class="attr">"shop"</span>: &#123;</span><br><span class="line"><span class="attr">"shopId"</span>: <span class="number">1000000127</span>,</span><br><span class="line"><span class="attr">"name"</span>: <span class="string">"京东Apple产品专营店"</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;,</span><br><span class="line">"basicInfo": &#123;</span><br><span class="line">"gift": false,</span><br><span class="line">"bookInfo": &#123;</span><br><span class="line">              <span class="comment">// 如果是书, 这里是书的选项信息</span></span><br><span class="line">"display": false</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">"colorSizeInfo": &#123;</span><br><span class="line">              <span class="comment">// 商品选项信息列表 有的没有</span></span><br><span class="line">"colorSize": [&#123;</span><br><span class="line">"buttons": [&#123;</span><br><span class="line">"no": "1",</span><br><span class="line">"skuList": ["100000177738", "100000287117", "100000287145", "100000309448", "100000309450", "100000375233", "100000435832", "100000458753", "100000458755", "100001860767", "100001860773"],</span><br><span class="line">"text": "金色"</span><br><span class="line">&#125;, &#123;</span><br><span class="line">"no": "2",</span><br><span class="line">"skuList": ["100000177764", "100000287113", "100000287135", "100000435780", "100000435816", "100000435818", "100000569049", "100000602206", "100000602208", "100001860765", "100002539302"],</span><br><span class="line">"text": "深空灰色"</span><br><span class="line">&#125;, &#123;</span><br><span class="line">"no": "3",</span><br><span class="line">"skuList": ["100000177740", "100000177784", "100000287147", "100000435834", "100000458737", "100000458739", "100000602174", "100000602176", "100000602204", "100001860789", "100002539304"],</span><br><span class="line">"text": "银色"</span><br><span class="line">&#125;],</span><br><span class="line">"title": "颜色"</span><br><span class="line">&#125;, &#123;</span><br><span class="line">"buttons": [&#123;</span><br><span class="line">"no": "1",</span><br><span class="line">"skuList": ["100000177738", "100000177740", "100000177764", "100000177784", "100000287113", "100000287117", "100000287135", "100000287145", "100000287147"],</span><br><span class="line">"text": "公开版"</span><br><span class="line">&#125;,</span><br><span class="line">                  ...</span><br><span class="line">                  ],</span><br><span class="line">"title": "版本"</span><br><span class="line">&#125;, &#123;</span><br><span class="line">"buttons": [&#123;</span><br><span class="line">"no": "1",</span><br><span class="line">"skuList": ["100000177764", "100000287145", "100000287147", "100000375233", "100000435818", "100000458739", "100000458755", "100000602204", "100000602208", "100001860765", "100001860773", "100001860789"],</span><br><span class="line">"text": "64GB"</span><br><span class="line">&#125;, </span><br><span class="line">                  ...</span><br><span class="line">                  ],</span><br><span class="line">"title": "内存"</span><br><span class="line">&#125;],</span><br><span class="line">"colorSizeTips": "#与其他已选项无法组成可售商品，请重选"</span><br><span class="line">&#125;,</span><br><span class="line">    ...</span><br><span class="line">          <span class="comment">// 品牌ID</span></span><br><span class="line">"brandID": "14026",</span><br><span class="line">          ...</span><br><span class="line">          <span class="comment">// 商品图片</span></span><br><span class="line">"wareImage": [&#123;</span><br><span class="line">"small": "https://m.360buyimg.com/mobilecms/s720x720_jfs/t1/3/15/4536/138660/5b997bf8Ed72ebce7/819dcf182d743897.jpg!q70.jpg.webp",</span><br><span class="line">              ...</span><br><span class="line">  &#125;</span><br><span class="line">            ...</span><br><span class="line">          ],</span><br><span class="line">          ...</span><br><span class="line">          <span class="comment">// 商品名称</span></span><br><span class="line">"name": "Apple iPhone XS Max (A2104) 256GB 深空灰色 移动联通电信4G手机 双卡双待",</span><br><span class="line">          <span class="comment">// 商品类别id</span></span><br><span class="line">"category": "9987;653;655"</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>商品促销信息(PC端):</p><ul><li>图:<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/08_2_%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E8%8E%B7%E5%8F%96%E4%BF%83%E9%94%80%E4%BF%A1%E6%81%AF.png"></li><li>URL: <a href="https://cd.jd.com/promotion/v2?skuId=4749506&amp;area=1_72_4137_0&amp;cat=737,794,798" target="_blank" rel="noopener">https://cd.jd.com/promotion/v2?skuId=4749506&amp;area=1_72_4137_0&amp;cat=737%2C794%2C798</a><ul><li>参数<ul><li>skuId=4749506: 商品sku_id</li><li>area=1_72_4137_0: 购买者区域, 固定的</li><li>cat=737%2C794%2C798: 类别</li></ul></li></ul></li><li>数据</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 商品促销信息</span></span><br><span class="line">  "ads": [&#123;</span><br><span class="line">      "id": "AD_4749506",</span><br><span class="line">      "ad": "【即刻预约，21号秒杀到手价2999】\n1、前100名晒单送腾讯企鹅影院季卡，联系客服领取！！\n2、曲面爆款，5.5万好评推荐！&lt;a target=\"_blank\" href=\"https://item.jd.com/7055876.html\"&gt;升级55Q1D超清全面屏电视&lt;/a&gt;"</span><br><span class="line">  &#125;],</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>商品评论信息(PC端)</p><ul><li><p>图:<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/08_3_%E5%95%86%E5%93%81%E8%AF%84%E8%AE%BA%E4%BF%A1%E6%81%AFURL.png"></p></li><li><p>URL: <a href="https://club.jd.com/comment/productCommentSummaries.action?referenceIds=4749506" target="_blank" rel="noopener">https://club.jd.com/comment/productCommentSummaries.action?referenceIds=4749506</a></p><ul><li>参数<ul><li>referenceIds=4749506: 商品sku_id</li></ul></li></ul></li><li><p>数据:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"CommentsCount"</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"CommentCountStr"</span>:<span class="string">"10万+"</span>, </span><br><span class="line">        <span class="attr">"CommentCount"</span>:<span class="number">100000</span>, <span class="comment">//评论数量</span></span><br><span class="line">        <span class="attr">"AverageScore"</span>:<span class="number">5</span>,</span><br><span class="line">        <span class="attr">"GoodRate"</span>:<span class="number">0.98</span>, <span class="comment">//好评率</span></span><br><span class="line">        <span class="attr">"PoorCountStr"</span>:<span class="string">"600+"</span>, </span><br><span class="line">        <span class="attr">"PoorCount"</span>:<span class="number">600</span>, <span class="comment">// 差评数量</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;]&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>商品价格信息: </p><ul><li><p>图:<br><img src="/2021/04/09/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BScrapy%E6%8A%93%E5%8F%96%E4%BA%AC%E4%B8%9C/08_4_%E5%95%86%E5%93%81%E4%BB%B7%E6%A0%BCURL.png"></p></li><li><p>URL: <a href="https://p.3.cn/prices/mgets?skuIds=J_4749506" target="_blank" rel="noopener">https://p.3.cn/prices/mgets?skuIds=J_4749506</a></p><ul><li>参数:<ul><li>skuIds=J_4749506 商品的sku_id</li></ul></li></ul></li><li><p>数据:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="attr">"op"</span>: <span class="string">"5499.00"</span>,</span><br><span class="line">      <span class="attr">"m"</span>: <span class="string">"5999.00"</span>,</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"J_4749506"</span>, <span class="comment">//商品skuid</span></span><br><span class="line">      <span class="attr">"p"</span>: <span class="string">"3299.00"</span> <span class="comment">// 商品价格</span></span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><ul><li>步骤:<ol><li>重写start_requests方法, 根据分类信息构建列表页的请求</li><li>解析列表页, 提取商品的skuid, 构建商品基本的信息请求; 实现翻页</li><li>解析商品基本信息, 构建商品促销信息的请求</li><li>解析促销信息,构建商品评价信息的请求,</li><li>解析商品评价信息, 构建价格信息的请求   </li><li>解析价格信息</li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">class JdProductSpider(scrapy.Spider):</span><br><span class="line">    name &#x3D; &#39;jd_product&#39;</span><br><span class="line">    allowed_domains &#x3D; [&#39;jd.com&#39;, &#39;p.3.cn&#39;]</span><br><span class="line"></span><br><span class="line">    def start_requests(self):</span><br><span class="line">        category &#x3D; &#123;  &quot;b_category_name&quot; : &quot;家用电器&quot;,</span><br><span class="line">                      &quot;b_category_url&quot; : &quot;https:&#x2F;&#x2F;jiadian.jd.com&quot;,</span><br><span class="line">                      &quot;m_category_name&quot; : &quot;洗衣机&quot;,</span><br><span class="line">                      &quot;m_category_url&quot; : &quot;https:&#x2F;&#x2F;list.jd.com&#x2F;list.html?cat&#x3D;737,794,880&quot;,</span><br><span class="line">                      &quot;s_category_name&quot; : &quot;洗衣机配件&quot;,</span><br><span class="line">                      &quot;s_category_url&quot; : &quot;https:&#x2F;&#x2F;list.jd.com&#x2F;list.html?cat&#x3D;737,794,877&quot; &#125;</span><br><span class="line"></span><br><span class="line">        yield scrapy.Request(category[&#39;s_category_url&#39;], self.parse, meta&#x3D;&#123;&#39;category&#39;: category&#125;)</span><br><span class="line"></span><br><span class="line">    def parse(self, response):</span><br><span class="line">        # 获取类别信息</span><br><span class="line">        category &#x3D; response.meta[&#39;category&#39;]</span><br><span class="line">        # 获取类别的URL</span><br><span class="line">        category_url &#x3D; response.url.split(&#39;&amp;&#39;)[0]</span><br><span class="line">        # 获取所有商品的sku_ids</span><br><span class="line">        sku_ids &#x3D; response.xpath(&#39;&#x2F;&#x2F;div[contains(@class, &quot;j-sku-item&quot;)]&#x2F;@data-sku&#39;).extract()</span><br><span class="line">        # 遍历sku_ids, 构建基本详情信息的请求</span><br><span class="line">        for sku_id in sku_ids:</span><br><span class="line">            item &#x3D; &#123;</span><br><span class="line">                 &#39;product_category&#39;: category,</span><br><span class="line">                 &#39;product_sku_id&#39;:sku_id</span><br><span class="line">            &#125;</span><br><span class="line">            product_url &#x3D; &#39;https:&#x2F;&#x2F;cdnware.m.jd.com&#x2F;c1&#x2F;skuDetail&#x2F;apple&#x2F;7.3.0&#x2F;&#123;&#125;.json&#39;.format(sku_id)</span><br><span class="line">            yield scrapy.Request(product_url, callback&#x3D;self.parse_product, meta&#x3D;&#123;&#39;item&#39;: item&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        # 获取下一页的URL</span><br><span class="line">        next_url &#x3D; response.xpath(&#39;&#x2F;&#x2F;a[@class&#x3D;&quot;pn-next&quot;]&#x2F;@href&#39;).extract_first()</span><br><span class="line">        if next_url:</span><br><span class="line">            # 补全URL</span><br><span class="line">            next_url &#x3D; response.urljoin(next_url)</span><br><span class="line">            # 构建下一页请求</span><br><span class="line">            yield scrapy.Request(next_url, callback&#x3D;self.parse, meta&#x3D;&#123;&#39;category&#39;: category&#125;)</span><br><span class="line"></span><br><span class="line">    def parse_product(self, response):</span><br><span class="line">        # 取出传递过来的数据</span><br><span class="line">        item &#x3D; response.meta[&#39;item&#39;]</span><br><span class="line">        # 把响应数据数据转为字典</span><br><span class="line">        product_dic &#x3D; json.loads(response.text)</span><br><span class="line"></span><br><span class="line">        # 获取商品名称</span><br><span class="line">        item[&#39;product_name&#39;] &#x3D; product_dic[&#39;wareInfo&#39;][&#39;basicInfo&#39;][&#39;name&#39;]</span><br><span class="line">        if  item[&#39;product_name&#39;]:</span><br><span class="line">            # 获取类别id, 把 &#96;;&#96; 替换为 ,</span><br><span class="line">            item[&#39;product_category_id&#39;] &#x3D; product_dic[&#39;wareInfo&#39;][&#39;basicInfo&#39;][&#39;category&#39;].replace(&#39;;&#39;, &#39;,&#39;)</span><br><span class="line">            # 获取店铺信息</span><br><span class="line">            product_shop &#x3D; jsonpath(product_dic, &#39;$..shop&#39;)</span><br><span class="line">            if product_shop:</span><br><span class="line">                product_shop &#x3D; product_shop[0]</span><br><span class="line">                if product_shop is None:</span><br><span class="line">                    item[&#39;product_shop&#39;] &#x3D; &#123;&#39;name&#39;:&#39;京东自营&#39;&#125;</span><br><span class="line">                else:</span><br><span class="line">                    item[&#39;product_shop&#39;] &#x3D; &#123;</span><br><span class="line">                        &quot;shopId&quot;: product_shop[&#39;shopId&#39;],</span><br><span class="line">                        &quot;name&quot;: product_shop[&#39;name&#39;],</span><br><span class="line">                        &quot;score&quot;: product_shop[&#39;score&#39;],</span><br><span class="line">                        &quot;url&quot;: product_shop[&#39;url&#39;],</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            # 如果是书, 记录书的信息</span><br><span class="line">            if product_dic[&#39;wareInfo&#39;][&#39;basicInfo&#39;][&#39;bookInfo&#39;][&#39;display&#39;]:</span><br><span class="line">                item[&#39;product_book_info&#39;] &#x3D; product_dic[&#39;wareInfo&#39;][&#39;basicInfo&#39;][&#39;bookInfo&#39;]</span><br><span class="line">                # 删除display</span><br><span class="line">                del item[&#39;book_info&#39;][&#39;display&#39;]</span><br><span class="line">            # 获取商品选购信息</span><br><span class="line">            color_sizes &#x3D; jsonpath(product_dic, &#39;$..colorSize&#39;)</span><br><span class="line">            product_option &#x3D; &#123;&#125;</span><br><span class="line">            if color_sizes:</span><br><span class="line">                for color_size in color_sizes[0]:</span><br><span class="line">                    title &#x3D; color_size[&#39;title&#39;]</span><br><span class="line">                    texts &#x3D; jsonpath(color_size, &#39;$..text&#39;)</span><br><span class="line">                    product_option.update(&#123;title:texts&#125;)</span><br><span class="line">                    # print(product_option)</span><br><span class="line">            item[&#39;product_option&#39;] &#x3D; product_option</span><br><span class="line">            # 商品图片</span><br><span class="line">            item[&#39;product_img_url&#39;] &#x3D; jsonpath(product_dic, &#39;$..wareImage[0].small&#39;)[0]</span><br><span class="line"></span><br><span class="line">            # 构建促销信息的请求</span><br><span class="line">            ad_url &#x3D; &#39;https:&#x2F;&#x2F;cd.jd.com&#x2F;promotion&#x2F;v2?skuId&#x3D;&#123;&#125;&amp;area&#x3D;1_72_4137_0&amp;cat&#x3D;&#123;&#125;&#39;.format(item[&#39;product_sku_id&#39;], item[&#39;product_category_id&#39;])</span><br><span class="line">            yield scrapy.Request(ad_url, callback&#x3D;self.parse_ad, meta&#x3D;&#123;&#39;item&#39;: item&#125;)</span><br><span class="line"></span><br><span class="line">    def parse_ad(self, response):</span><br><span class="line">        &quot;&quot;&quot;获取商品促销&quot;&quot;&quot;</span><br><span class="line">        item &#x3D; response.meta[&#39;item&#39;]</span><br><span class="line">        ad_dic &#x3D; json.loads(response.body.decode(&#39;GB18030&#39;))</span><br><span class="line">        ad &#x3D;  ad_dic[&#39;ads&#39;][0][&#39;ad&#39;]</span><br><span class="line">        item[&#39;product_ad&#39;] &#x3D; ad</span><br><span class="line"></span><br><span class="line">        # for key, value in item.items():</span><br><span class="line">        #     print(&#39;&#123;&#125; &#x3D; &#123;&#125;&#39;.format(key, value))</span><br><span class="line"></span><br><span class="line">        # 构建平均信息请求</span><br><span class="line">        comments_url &#x3D; &#39;https:&#x2F;&#x2F;club.jd.com&#x2F;comment&#x2F;productCommentSummaries.action?referenceIds&#x3D;&#123;&#125;&#39;.format(item[&#39;product_sku_id&#39;])</span><br><span class="line">        yield scrapy.Request(comments_url, callback&#x3D;self.parse_comments, meta&#x3D;&#123;&#39;item&#39;: item&#125;)</span><br><span class="line"></span><br><span class="line">    def parse_comments(self, response):</span><br><span class="line">        &quot;&quot;&quot;解析商品评论信息&quot;&quot;&quot;</span><br><span class="line">        item &#x3D; response.meta[&#39;item&#39;]</span><br><span class="line">        comments_dic &#x3D; json.loads(response.text)</span><br><span class="line">        comments &#x3D; &#123;</span><br><span class="line">            &#39;comment_count&#39;: jsonpath(comments_dic, &#39;$..CommentCount&#39;)[0],</span><br><span class="line">            &#39;good_rate&#39;: jsonpath(comments_dic, &#39;$..GoodRate&#39;)[0],</span><br><span class="line">            &#39;poor_count&#39;: jsonpath(comments_dic, &#39;$..PoorCount&#39;)[0],</span><br><span class="line">        &#125;</span><br><span class="line">        item[&#39;product_comments&#39;] &#x3D; comments</span><br><span class="line">        # print(item)</span><br><span class="line">        # 构建价格请求</span><br><span class="line">        price_url &#x3D; &#39;https:&#x2F;&#x2F;p.3.cn&#x2F;prices&#x2F;mgets?skuIds&#x3D;J_&#123;&#125;&#39;.format(item[&#39;product_sku_id&#39;])</span><br><span class="line">        yield scrapy.Request(price_url, callback&#x3D;self.parse_price, meta&#x3D;&#123;&#39;item&#39;: item&#125;)</span><br><span class="line"></span><br><span class="line">    def parse_price(self, response):</span><br><span class="line">        &quot;&quot;&quot;解析价格&quot;&quot;&quot;</span><br><span class="line">        item &#x3D; response.meta[&#39;item&#39;]</span><br><span class="line">        item[&#39;product_price&#39;] &#x3D; json.loads(response.text)[0][&#39;p&#39;]</span><br><span class="line">        # print(item)</span><br><span class="line">        yield item</span><br></pre></td></tr></table></figure><h4 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h4><ul><li><code>步骤</code>:<ol><li>修改爬虫类</li><li>在settings文件中配置scrapy_redis</li><li>写一个程序用于把MongoDB中分类信息, 放入到爬虫redis_key指定的列表中</li></ol></li></ul><p><strong>修改爬虫类</strong></p><ul><li><code>步骤</code>:<ol><li>修改继承关系: 继承RedisSpider</li><li>指定redis_key</li><li>把重写start_requests 改为 重写 make_request_from_data</li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from scrapy_redis.spiders import RedisSpider</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">#  1. 修改继承关系: 继承RedisSpider</span><br><span class="line">class JdProductSpider(RedisSpider):</span><br><span class="line">    name &#x3D; &#39;jd_product&#39;</span><br><span class="line">    allowed_domains &#x3D; [&#39;jd.com&#39;, &#39;p.3.cn&#39;]</span><br><span class="line">    # 2. 指定redis_key</span><br><span class="line">    redis_key &#x3D; &#39;jd_product:start_category&#39;</span><br><span class="line"></span><br><span class="line">    # 3. 把重写start_requests 改为 重写 make_request_from_data</span><br><span class="line">    def make_request_from_data(self, data):</span><br><span class="line">        # 把从Redis中读取到分类信息, 转换为字典</span><br><span class="line">        category &#x3D; pickle.loads(data)</span><br><span class="line">        return scrapy.Request(category[&#39;s_category_url&#39;], self.parse, meta&#x3D;&#123;&#39;category&#39;: category&#125;)</span><br></pre></td></tr></table></figure><p><code>注意</code>: 在<code>make_request_from_data</code>不能使用 <code>yield</code> 必须使用 <code>return</code></p><p><strong>在settings文件中配置scrapy_redis</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># MongoDB数据库的URL</span><br><span class="line">MONGO_URL &#x3D; &#39;mongodb:&#x2F;&#x2F;127.0.0.1:27017&#39;</span><br><span class="line"></span><br><span class="line"># REDIS数据链接</span><br><span class="line">REDIS_URL &#x3D; &#39; redis:&#x2F;&#x2F;127.0.0.1:6379&#x2F;0&#39;</span><br><span class="line"></span><br><span class="line"># 去重容器类: 用于把已爬指纹存储到基于Redis的set集合中</span><br><span class="line">DUPEFILTER_CLASS &#x3D; &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="line"># 调度器: 用于把待爬请求存储到基于Redis的队列</span><br><span class="line">SCHEDULER &#x3D; &quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="line"># 是不进行调度持久化:</span><br><span class="line"># 如果是True, 当程序结束的时候, 会保留Redis中已爬指纹和待爬的请求</span><br><span class="line"># 如果是False, 当程序结束的时候, 会清空Redis中已爬指纹和待爬的请求</span><br><span class="line">SCHEDULER_PERSIST &#x3D; True</span><br></pre></td></tr></table></figure><p><strong>把MongoDB中分类信息, 放入到爬虫redis_key指定的列表中</strong></p><ul><li><p><code>步骤</code>:</p><ul><li><ol><li>在项目文件夹下创建 <code>add_category_to_redis.py</code></li></ol></li><li><ol start="2"><li>实现方法 <code>add_category_to_redis</code>:<ol><li>链接MongoDB</li><li>链接Redis</li><li>读取MongoDB中分类信息, 序列化后, 添加到商品爬虫redis_key指定的list</li><li>关闭MongoDB</li></ol></li></ol></li><li><ol start="3"><li>在<code>if __name__ == &#39;__main__&#39;:</code>中调用<code>add_category_to_redis</code>方法</li></ol></li></ul></li><li><p><code>代码</code></p></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mall_spider.settings <span class="keyword">import</span> MONGO_URL, REDIS_URL</span><br><span class="line"><span class="keyword">from</span> mall_spider.spiders.jd_product <span class="keyword">import</span> JdProductSpider</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把MongoDB中分类信息, 添加到Redis中</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_category_to_redis</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 链接MongoDB</span></span><br><span class="line">    client = MongoClient(MONGO_URL)</span><br><span class="line">    <span class="comment"># 链接Redis</span></span><br><span class="line">    redis = StrictRedis.from_url(REDIS_URL)</span><br><span class="line"></span><br><span class="line">    cursor = client[<span class="string">'jd'</span>][<span class="string">'category'</span>].find()</span><br><span class="line">    <span class="comment"># 读取MongoDB中分类信息, 序列化后, 添加到商品爬虫redis_key指定的list</span></span><br><span class="line">    <span class="keyword">for</span> category <span class="keyword">in</span> cursor:</span><br><span class="line">        redis.rpush(JdProductSpider.redis_key, pickle.dumps(category))</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 关闭MongoDB的链接</span></span><br><span class="line">    client.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    add_category_to_redis()</span><br></pre></td></tr></table></figure><h3 id="保存商品数据"><a href="#保存商品数据" class="headerlink" title="保存商品数据"></a>保存商品数据</h3><p><code>步骤</code></p><ul><li><p>在 open_spider方法, 建立MongoDB数据库连接, 获取要操作的集合</p></li><li><p>在 process_item方法, 把数据插入到MongoDB中</p></li><li><p>在close_spider方法, 关闭数据库连接</p></li><li><p>代码</p></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(spider, JdProductSpider):</span><br><span class="line">            <span class="comment"># 建立MongoDB数据库链接</span></span><br><span class="line">            self.client = MongoClient(MONGO_URL)</span><br><span class="line">            <span class="comment"># 获取要操作集合</span></span><br><span class="line">            self.category = self.client[<span class="string">'jd'</span>][<span class="string">'product'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(spider, JdProductSpider):</span><br><span class="line">            <span class="comment"># 把数据插入到mongo中</span></span><br><span class="line">            self.category.insert_one(dict(item))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        <span class="string">"""关闭"""</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(spider, JdProductSpider):</span><br><span class="line">            self.client.close()</span><br></pre></td></tr></table></figure><p><strong>在settings.py中开启这个管道</strong></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">'mall_spider.pipelines.CategoryPipeline'</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="comment"># 开启商品管道</span></span><br><span class="line">   <span class="string">'mall_spider.pipelines.ProductPipeline'</span>: <span class="number">301</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="反爬"><a href="#反爬" class="headerlink" title="反爬"></a>反爬</h3><p>为了避免IP反爬, 我们实现随机User-Agent和代理IP的中间件</p><ul><li><code>步骤</code>: <ol><li>实现随机User-Agent的中间件</li><li>实现代理IP中间件</li><li>在settings.py 文件开启, 下载器中间件</li></ol></li></ul><h4 id="实现随机User-Agent的中间件"><a href="#实现随机User-Agent的中间件" class="headerlink" title="实现随机User-Agent的中间件"></a>实现随机User-Agent的中间件</h4><ul><li><p><code>步骤</code></p><ul><li>准备User-Agent列表</li><li>在middlewares.py中, 实现RandomUserAgent类</li><li>实现process_request方法<ul><li>如果是请求是 <code>https://cdnware.m.jd.com</code> 开头的, 就是设置一个iPhone的user-agent</li><li>否则从User-Agent列表中随机取出一个</li></ul></li></ul></li><li><p>代码</p></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备请求头</span></span><br><span class="line">USER_AGENTS = [</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20"</span>,</span><br><span class="line">    <span class="string">"Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 LBBROWSER"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko/20100101 Firefox/16.0"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomUserAgent</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.url.startswith(<span class="string">'https://cdnware.m.jd.com'</span>):</span><br><span class="line">            <span class="comment"># 如果使用手机抓包, 获取到商品信息; 生成请求请求头</span></span><br><span class="line">            request.headers[<span class="string">'user-agent'</span>] = <span class="string">'JD4iPhone/164880 (iPhone; iOS 12.1.2; Scale/2.00)'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 随机获取一个请求头, 进行设置</span></span><br><span class="line">            request.headers[<span class="string">'user-agent'</span>] = random.choice(USER_AGENTS)</span><br></pre></td></tr></table></figure><h4 id="实现代理IP中间件"><a href="#实现代理IP中间件" class="headerlink" title="实现代理IP中间件"></a>实现代理IP中间件</h4><ul><li><p><code>步骤</code>:</p><ul><li>在middlewares.py中, 实现ProxyMiddleware类</li><li>实现process_request方法<ul><li>从代理池中获取一个随机的代理IP, 需指定代理IP的协议, 和访问的域名</li><li>设置给request.meta[‘proxy’]</li></ul></li><li>实现process_exception方法</li><li>当请求出现异常的时候, 代理池哪些代理IP在本域名下是不可以用的</li></ul></li><li><p><code>代码</code></p></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">9.2. 实现代理IP中间件</span></span><br><span class="line"><span class="string">步骤:</span></span><br><span class="line"><span class="string">    在middlewares.py中, 实现ProxyMiddleware类</span></span><br><span class="line"><span class="string">    实现process_request方法</span></span><br><span class="line"><span class="string">    从代理池中获取一个随机的代理IP</span></span><br><span class="line"><span class="string">    设置给request.meta['proxy']</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> twisted.internet <span class="keyword">import</span> defer</span><br><span class="line"><span class="keyword">from</span> twisted.internet.error <span class="keyword">import</span> TimeoutError, DNSLookupError, \</span><br><span class="line">        ConnectionRefusedError, ConnectionDone, ConnectError, \</span><br><span class="line">        ConnectionLost, TCPTimedOutError</span><br><span class="line"><span class="keyword">from</span> twisted.web.client <span class="keyword">import</span> ResponseFailed</span><br><span class="line"><span class="keyword">from</span> scrapy.core.downloader.handlers.http11 <span class="keyword">import</span> TunnelError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProxyMiddleware</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    EXCEPTIONS_TO_RETRY = (defer.TimeoutError, TimeoutError, DNSLookupError,</span><br><span class="line">                           ConnectionRefusedError, ConnectionDone, ConnectError,</span><br><span class="line">                           ConnectionLost, TCPTimedOutError, ResponseFailed,</span><br><span class="line">                           IOError, TunnelError)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, spider)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         从代理池中获取一个随机的代理IP</span></span><br><span class="line"><span class="string">         设置给request.meta['proxy']</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        response = requests.get(<span class="string">'http://localhost:6868/random?protocol=https&amp;domain=jd.com'</span>)</span><br><span class="line">        request.meta[<span class="string">'proxy'</span>] = response.content.decode()</span><br><span class="line">        request.meta[<span class="string">'dont_redirect'</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception, spider)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(exception, self.EXCEPTIONS_TO_RETRY):</span><br><span class="line">            <span class="comment"># 获取代理IP</span></span><br><span class="line">            proxy = request.meta[<span class="string">'proxy'</span>]</span><br><span class="line">            <span class="comment"># 提取IP地址</span></span><br><span class="line">            ip = re.findall(<span class="string">'https://(.+):\d+'</span>, proxy)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            params = &#123;</span><br><span class="line">              <span class="string">'ip'</span>: ip,</span><br><span class="line">              <span class="string">'domain'</span>: <span class="string">'jd.com'</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            requests.get(<span class="string">'http://localhost:6868/disable_domain'</span>, params=params)</span><br><span class="line">            <span class="comment"># 构建请求返回</span></span><br><span class="line">            req = request.copy()</span><br><span class="line">            req.dont_filter = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> req</span><br></pre></td></tr></table></figure><p><strong>在settings.py中开启上面的两个下载器中间件</strong></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置下载器中间件</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line"><span class="string">'mall_spider.middlewares.RandomUserAgent'</span>: <span class="number">500</span>,</span><br><span class="line"><span class="string">'mall_spider.middlewares.ProxyMiddl eware'</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> scrapy </tag>
            
            <tag> scrapy_redis </tag>
            
            <tag> mongo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之斗鱼弹幕</title>
      <link href="2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/"/>
      <url>2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><blockquote><p><code>asyncore</code> 模块为异步socket的服务器客户端通信提供简单的接口。该模块提供了异步socket服务客户端和服务器的基础架构。</p><p>相比python原生的socket api，asyncore具备有很大的优势，asyncore对原生的socket进行封装，提供非常简洁优秀的接口，利用asyncore覆写相关需要处理的接口方法，就可以完成一个socket的网络编程，从而不需要处理复杂的socket网络状况以及多线程处理等等。</p></blockquote><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/asyncore%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B.png" alt="asyncore实现流程"></p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netcat-win32-1.12&gt;nc -l -p 9000  启动服务端</span><br></pre></td></tr></table></figure><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>telnet 127.0.0.1 9000 客户端连接到服务器  发送信息</p><ol><li><p>定义类继承自<code>asyncore.dispatcher</code></p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span><span class="params">(asyncore.dispatcher)</span>:</span></span><br></pre></td></tr></table></figure></li><li><p>实现类中的回调代码</p><ul><li><p>实现构造函数</p><ul><li><p>调用父类方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asyncore.dispatcher.__init__(self)</span><br></pre></td></tr></table></figure></li><li><p>创建 Socket 对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.create_socket()</span><br></pre></td></tr></table></figure></li><li><p>连接服务器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">address = (host,port)</span><br><span class="line">self.connect(address)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>实现 <code>handle_connect</code> 回调函数</p><blockquote><p>当 <code>Socket</code> 连接服务器成功时回调该函数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_connect</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"连接成功"</span>)</span><br></pre></td></tr></table></figure></li><li><p>实现 <code>writable</code> 回调函数</p><blockquote><p>描述是否有数据需要被发送到服务器。返回值为 <code>True</code> 表示可写，<code>False</code> 表示不可写，如果不实现默认返回为 <code>True</code>，当返回 <code>True</code> 时，回调函数 <code>handle_write</code> 将被触发</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writable</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure></li><li><p>实现 <code>handle_write</code> 回调函数</p><blockquote><p>当有数据需要发送时（<code>writable </code>回调函数返回True时），该函数被触发，通常情况下在该函数中编写 send 方法发送数据</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_write</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># 内部实现对服务器发送数据的代码</span></span><br><span class="line">    <span class="comment"># 调用 send 方法发送数据，参数是字节数据</span></span><br><span class="line">    self.send(<span class="string">'hello world\n'</span>.encode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure></li><li><p>实现 <code>readable</code> 回调函数</p><blockquote><p>描述是否有数据从服务端读取。返回 <code>True</code> 表示有数据需要读取，<code>False</code> 表示没有数据需要被读取，当不实现默认返回为 <code>True</code>，当返回 <code>True</code> 时，回调函数 <code>handle_read</code> 将被触发</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readable</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure></li><li><p>实现 <code>handle_read</code> 回调函数</p><blockquote><p>当有数据需要读取时触发（<code>readable</code> 回调函数返回 <code>True</code> 时），该函数被触发，通常情况下在该函数中编写 <code>recv</code> 方法接收数据</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_read</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># 主动接收数据，参数是需要接收数据的长度</span></span><br><span class="line">    <span class="comment"># 返回的数据是字节数据</span></span><br><span class="line">    result = self.recv(<span class="number">1024</span>)</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure></li><li><p>实现 <code>handle_error</code> 回调函数</p><blockquote><p>当程序运行过程发生异常时回调</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_error</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># 编写处理错误方法</span></span><br><span class="line">    t,e,trace = sys.exc_info()</span><br><span class="line">    self.close()</span><br></pre></td></tr></table></figure></li><li><p>实现 <code>handle_close</code> 回调函数</p><blockquote><p>当连接被关闭时触发</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_close</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"连接关闭"</span>)</span><br><span class="line">    self.close()</span><br></pre></td></tr></table></figure></li></ul></li><li><p>创建对象并且执行 <code>asyncore.loop</code> 进入运行循环</p><ul><li><p><code>timeout</code> 表示一次循环所需要的时长</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client = SocketClient(<span class="string">'127.0.0.1'</span>,<span class="number">9000</span>)</span><br><span class="line"><span class="comment"># 开始启动运行循环</span></span><br><span class="line">asyncore.loop(timeout=<span class="number">5</span>)</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="抓取弹幕"><a href="#抓取弹幕" class="headerlink" title="抓取弹幕"></a>抓取弹幕</h2><h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><p>根据<code>斗鱼弹幕服务器第三方接入协议v1.6.2.pdf</code> 官方提供协议文档建立弹幕客户端开发流程。</p><ul><li>连接初始化<ul><li>使用TCP连接服务器<ul><li>IP地址：openbarrage.douyutv.com</li><li>端口：8601</li></ul></li><li>客户端向弹幕服务器发送登录请求，登录弹幕服务器</li><li>弹幕服务器收到客户端登录请求并完成登录后，返回登录成功消息给客户端</li><li>客户端收到登录成功消息后发送进入弹幕分组请求给弹幕服务器</li><li>弹幕服务器接受到客户端弹幕分组请求后将客户端添加到请求指定的弹幕分组中</li></ul></li><li>服务过程<ul><li>客户端每隔 45 秒发送心跳给弹幕服务器，弹幕服务器回复心跳信息给客户端</li><li>弹幕服务器如有广播信息，则推送给客户端，服务器消息协议</li></ul></li><li>断开连接<ul><li>客户端发送登出消息</li><li>客户端关闭 TCP 连接</li></ul></li></ul><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B.png" alt="数据包发送和接收流程"></p><h3 id="数据包结构"><a href="#数据包结构" class="headerlink" title="数据包结构"></a>数据包结构</h3><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F.png" alt="协议格式"></p><ul><li>消息长度:4 字节小端整数，表示整条消息(包括自身)长度(字节数)。 消息长度出现两遍，二者相同。</li><li>消息类型:2 字节小端整数，表示消息类型。取值如下:<ul><li>689 客户端发送给弹幕服务器的文本格式数据</li><li>690 弹幕服务器发送给客户端的文本格式数据。</li></ul></li><li>加密字段:1字节，暂时未用，默认为 0。</li><li>保留字段:1字节，暂时未用，默认为 0。</li><li>数据部分:n字节+1字节，斗鱼独创序列化文本数据，结尾必须为‘\0’。(所有协议内容均为 UTF-8 编码)</li></ul><h3 id="数据包封装"><a href="#数据包封装" class="headerlink" title="数据包封装"></a>数据包封装</h3><blockquote><p>对数据包进行对象化封装，对数据的封装方便以后使用，实现对象和二进制数据之间的转换</p></blockquote><ul><li>通过参数构建数据包对象</li><li>实现获取数据包长度的方法</li><li>实现获取二进制数据的方法</li></ul><h3 id="实现发送数据包"><a href="#实现发送数据包" class="headerlink" title="实现发送数据包"></a>实现发送数据包</h3><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="发送数据流程图"></p><ul><li><p>构建发送数据包的队列容器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.send_queue = Queue()</span><br></pre></td></tr></table></figure></li><li><p>实现回调函数，判断容器中有数据就发送没有数据不发送</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writable</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.send_queue.qsize() &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_write</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 从发送数据包队列中获取数据包对象</span></span><br><span class="line">    dp = self.send_queue.get()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据包的长度，并且发送给服务器</span></span><br><span class="line">    dp_length = dp.get_length()</span><br><span class="line">    dp_length_data = dp_length.to_bytes(<span class="number">4</span>,byteorder=<span class="string">'little'</span>,signed=<span class="literal">False</span>)</span><br><span class="line">    self.send(dp_length_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送数据包二进制数据</span></span><br><span class="line">    self.send(dp.get_bytes())</span><br><span class="line">    self.send_queue.task_done()</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li><li><p>实现登录函数</p><ul><li><p>构建登录数据包</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="string">"type@=loginreq/roomid@=&#123;&#125;/"</span>.format(room_id)</span><br><span class="line">login_dp = DataPacket(DATA_PACKET_TYPE_SEND,content=content)</span><br></pre></td></tr></table></figure></li><li><p>把数据包添加到发送数据包容器中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把数据包添加到发送数据包容器中</span></span><br><span class="line"> self.send_queue.put(login_dp)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="实现接收数据"><a href="#实现接收数据" class="headerlink" title="实现接收数据"></a>实现接收数据</h3><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="接收数据流程图"></p><ul><li><p>构建接收数据包队列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 存放接收的数据包对象</span></span><br><span class="line">self.recv_queue = Queue()</span><br></pre></td></tr></table></figure></li><li><p>读取回调函数中读取数据</p><ul><li><p>读取长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取长度,二进制数据</span></span><br><span class="line">data_length_data = self.recv(<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 通过二进制获取length 具体数据</span></span><br><span class="line">data_length = int.from_bytes(data_length_data,byteorder=<span class="string">'little'</span>,signed=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></li><li><p>读取内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过数据包的长度获取数据</span></span><br><span class="line">data = self.recv(data_length)</span><br></pre></td></tr></table></figure></li><li><p>构建数据包对象</p><ul><li><p>数据包构造函数中解析二进制来构建数据包对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.type = int.from_bytes(data_bytes[<span class="number">4</span>:<span class="number">6</span>],byteorder=<span class="string">'little'</span>,signed=<span class="literal">False</span>)</span><br><span class="line">self.encrypt_flag = int.from_bytes(data_bytes[<span class="number">6</span>:<span class="number">7</span>],byteorder=<span class="string">'little'</span>,signed=<span class="literal">False</span>)</span><br><span class="line">self.preserve_flag = int.from_bytes(data_bytes[<span class="number">7</span>:<span class="number">8</span>],byteorder=<span class="string">'little'</span>,signed=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 构建数据部分</span></span><br><span class="line">self.content = str(data_bytes[<span class="number">8</span>:<span class="number">-1</span>],encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure></li><li><p>通过二进制数据构建数据包对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过二进制数据构建数据包对象</span></span><br><span class="line">dp = DataPacket(data_bytes=data)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>把数据包放入接收数据包容器中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把数据包放入接收数据包容器中</span></span><br><span class="line">self.recv_queue.put(dp)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>构建处理线程专门处理接收数据包容器中数据</p><ul><li><p>构建线程</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建一个专门处理接收数据包容器中的数据包的线程</span></span><br><span class="line">self.callback_thread = threading.Thread(target=self.do_callback)</span><br><span class="line">self.callback_thread.setDaemon(<span class="literal">True</span>)</span><br><span class="line">self.callback_thread.start()</span><br></pre></td></tr></table></figure></li><li><p>实现回调函数处理接收的数据包</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_callback</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">        专门负责处理接收数据包容器中的数据</span></span><br><span class="line"><span class="string">        :return: </span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 从接收数据包容器中获取数据包</span></span><br><span class="line">        dp = self.recv_queue.get()</span><br><span class="line">        <span class="comment"># 对数据进行处理</span></span><br><span class="line">        print(dp.content)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="实现外部传入回调函数"><a href="#实现外部传入回调函数" class="headerlink" title="实现外部传入回调函数"></a>实现外部传入回调函数</h3><blockquote><p>通过外部指定回调函数实现自定义数据处理</p></blockquote><ul><li><p>添加参数 <code>callback</code></p><ul><li><p>构造函数中添加参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,port,callback=None)</span>:</span></span><br><span class="line"><span class="comment"># 定义外部传入的自定义回调函数</span></span><br><span class="line">self.callback = callback</span><br></pre></td></tr></table></figure></li><li><p>外部传入自定义回调函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_callback</span><span class="params">(dp)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    自定义回调函数</span></span><br><span class="line"><span class="string">    :param dp: 数据包对象</span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    print(<span class="string">"data_callback:"</span>,dp.content)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    client = DouyuClient(<span class="string">'openbarrage.douyutv.com'</span>,<span class="number">8601</span>,callback=data_callback)</span><br><span class="line"></span><br><span class="line">    client.login_room_id(<span class="number">4494106</span>)</span><br><span class="line"></span><br><span class="line">    asyncore.loop(timeout=<span class="number">10</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>在处理接收数据包的线程中调用回调函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_callback</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">        专门负责处理接收数据包容器中的数据</span></span><br><span class="line"><span class="string">        :return: </span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 从接收数据包容器中获取数据包</span></span><br><span class="line">        dp = self.recv_queue.get()</span><br><span class="line">        <span class="comment"># 对数据进行处理</span></span><br><span class="line">        <span class="keyword">if</span> self.callback <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.callback(dp)</span><br><span class="line">        self.recv_queue.task_done()</span><br></pre></td></tr></table></figure></li></ul><h3 id="数据内容序列化与反序列化"><a href="#数据内容序列化与反序列化" class="headerlink" title="数据内容序列化与反序列化"></a>数据内容序列化与反序列化</h3><ol><li>键 key 和值 value 直接采用‘@=’分割</li><li>数组采用‘/’分割</li><li>如果 key 或者 value 中含有字符‘/’，则使用‘@S’转义</li><li>如果 key 或者 value 中含有字符‘@’，使用‘@A’转义</li></ol><blockquote><p>例子</p><p>多个键值对数据:key1@=value1/key2@=value2/key3@=value3/</p><p>数组数据:value1/value2/value3/</p></blockquote><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E7%99%BB%E5%BD%95.png" alt="登录.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def login_room_id(self, room_id):</span><br><span class="line">    # 2.客户端向弹幕服务器发送登录请求，登录弹幕服务器</span><br><span class="line">    self.room_id &#x3D; room_id</span><br><span class="line"></span><br><span class="line">    send_data &#x3D; &#123;</span><br><span class="line">        &quot;type&quot;: &quot;loginreq&quot;,</span><br><span class="line">        &quot;roomid&quot;: str(room_id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 构建登录数据包</span><br><span class="line">    content &#x3D; encode_content(send_data)</span><br><span class="line">    login_dp &#x3D; DataPacket(DATA_PACKET_TYPE_SEND, content&#x3D;content)</span><br><span class="line"></span><br><span class="line">    # 把数据包添加到发送数据包容器中</span><br><span class="line">    self.send_queue.put(login_dp)</span><br></pre></td></tr></table></figure><h3 id="加入弹幕分组"><a href="#加入弹幕分组" class="headerlink" title="加入弹幕分组"></a>加入弹幕分组</h3><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E5%BC%B9%E5%B9%95%E5%88%86%E7%BB%84.png" alt="弹幕分组.png"></p><blockquote><p>参看斗鱼弹幕文档,<code>-9999</code> 为海量弹幕</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def join_room_group(self):</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    4.客户端收到登录成功消息后发送进入弹幕分组请求给弹幕服务器</span><br><span class="line">    :return:</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line">    send_data &#x3D; &#123;</span><br><span class="line">        &quot;type&quot;: &quot;joingroup&quot;,</span><br><span class="line">        &quot;rid&quot;: str(self.room_id),</span><br><span class="line">        &quot;gid&quot;: &#39;-9999&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    content &#x3D; encode_content(send_data)</span><br><span class="line"></span><br><span class="line">    dp &#x3D; DataPacket(type&#x3D;DATA_PACKET_TYPE_SEND, content&#x3D;content)</span><br><span class="line">    self.send_queue.put(dp)</span><br><span class="line"></span><br><span class="line">    pass</span><br></pre></td></tr></table></figure><h3 id="心跳机制"><a href="#心跳机制" class="headerlink" title="心跳机制"></a>心跳机制</h3><blockquote><p>作用是让服务器解决假死连接问题，客户端必须每隔45秒发送一次请求，否则就会被主动断开。</p></blockquote><ul><li>实现发送心跳函数<ul><li>构建心跳数据包</li><li>把数据包添加到发送数据包容器队列中</li></ul></li><li>构建心跳线程<ul><li>构建心跳线程</li><li>添加触发机制</li><li>添加暂停机制</li></ul></li></ul><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6.png" alt="心跳机制.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def send_heart_data_packet(self):</span><br><span class="line">    # 6.客户端每隔 45 秒发送心跳给弹幕服务器，弹幕服务器回复心跳信息给客户端</span><br><span class="line">    send_data &#x3D; &#123;</span><br><span class="line">        &quot;type&quot;: &quot;mrkl&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    content &#x3D; encode_content(send_data)</span><br><span class="line">    dp &#x3D; DataPacket(type&#x3D;DATA_PACKET_TYPE_SEND, content&#x3D;content)</span><br><span class="line">    self.send_queue.put(dp)</span><br></pre></td></tr></table></figure><h1 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h1><p>以上方案已经失效，斗鱼弹幕已使用websocket实现，不过都是协议而已，基础逻辑没有变化。</p><p>通过抓包获取wss的地址及端口</p><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/websocket2.png" alt="websocket1"></p><p>查看抓包中的Messages中的二进制信息，数据格式和1.6.2保持一致。</p><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/websocket1.png" alt="websocket2"></p><p>run_forever是核心逻辑通过while循环实现自动重连，建立_job_open时调用_one_hello登录加入群组，通过_job_heartbeat持续接受心跳机制。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">async def run_forever(self) -&gt; None:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    重写</span><br><span class="line">    @return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    self._waiting_end &#x3D; self._loop.create_future()</span><br><span class="line">    while not self._closed:</span><br><span class="line">        self._logger_info(f&#39;正在启动 &#123;self._area_id&#125; 号数据连接&#39;)</span><br><span class="line">        if self._waiting_pause is not None:</span><br><span class="line">            self._logger_info(f&#39;暂停启动 &#123;self._area_id&#125; 号数据连接，等待 RESUME 指令&#39;)</span><br><span class="line">            await self._waiting_pause</span><br><span class="line">        </span><br><span class="line">        async with self._opening_lock:</span><br><span class="line">            if self._closed:</span><br><span class="line">                self._logger_info(f&#39;&#123;self._area_id&#125; 号数据连接确认收到关闭信号，正在处理&#39;)</span><br><span class="line">                break</span><br><span class="line">            # 未成功建立数据连接，循环重试</span><br><span class="line">            if await self._prepare_client() and await self._job_open():</span><br><span class="line">                tasks &#x3D; [self._loop.create_task(i()) for i in self._funcs_task]</span><br><span class="line"></span><br><span class="line">                self._task_main &#x3D; self._loop.create_task(self._job_main())</span><br><span class="line">                tasks.append(self._task_main)</span><br><span class="line"></span><br><span class="line">                task_heartbeat &#x3D; self._loop.create_task(self._job_heartbeat())</span><br><span class="line">                tasks.append(task_heartbeat)</span><br><span class="line">            else:</span><br><span class="line">                continue</span><br><span class="line">            </span><br><span class="line">        _, pending &#x3D; await asyncio.wait(tasks, return_when&#x3D;asyncio.FIRST_COMPLETED)</span><br><span class="line">        self._logger_info(f&#39;&#123;self._area_id&#125; 号数据连接异常或主动断开，正在处理剩余信息&#39;)</span><br><span class="line">        for i in pending:</span><br><span class="line">            if i !&#x3D; self._task_main:</span><br><span class="line">                i.cancel()</span><br><span class="line">        await self._job_close()</span><br><span class="line">        if pending:</span><br><span class="line">            await asyncio.wait(pending)</span><br><span class="line">        self._logger_info(f&#39;&#123;self._area_id&#125; 号数据连接退出，剩余任务处理完毕&#39;)</span><br><span class="line">    await self._conn.clean()</span><br><span class="line">    self._waiting_end.set_result(True)</span><br></pre></td></tr></table></figure><p><img src="/2021/04/08/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95/websocket%E6%8A%93%E5%8F%96%E6%96%97%E9%B1%BC%E5%BC%B9%E5%B9%95.gif" alt="websocket抓取斗鱼弹幕"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asyncore </tag>
            
            <tag> socket </tag>
            
            <tag> asyncio </tag>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之IP代理池</title>
      <link href="2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BIP%E4%BB%A3%E7%90%86%E6%B1%A0/"/>
      <url>2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BIP%E4%BB%A3%E7%90%86%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="代理池介绍"><a href="#代理池介绍" class="headerlink" title="代理池介绍"></a>代理池介绍</h1><p>由众多ip组成提供多个稳定可用代理IP的ip池。</p><p>当我们做爬虫时，最常见的反爬手段就是IP反爬，当同一个IP访问网站超出频控限制，将会被限制访问，那么代理IP池应运而生。资金充足的情况下个人建议还是付费ip代理池，比较免费ip时效性低，且难以维护。</p><p>本文将介绍通过requests库多线程抓取多个免费代理ip网站数据落库mongo后并动态维护保证IP高度可用，以API形式暴露接口获取代理IP的解决方案。</p><h2 id="爬取流程"><a href="#爬取流程" class="headerlink" title="爬取流程"></a>爬取流程</h2><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BIP%E4%BB%A3%E7%90%86%E6%B1%A0/%E4%BB%A3%E7%90%86%E6%B1%A0%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF%E5%9B%BE%E8%A7%A3.png" alt="代理池设计思路图解"></p><ul><li>代理IP采集模块： 采集代理IP -&gt; 检测代理IP -&gt;如果不可用用, 直接过滤掉, 如果可用, 指定默认分数 -&gt; 存入数据库中</li><li>代理IP检测模块： 从数据库中获取所有代理IP -&gt; 检测代理IP -&gt; 如果代理IP不可用用, 就把分数-1, 如果分数为0从数据库中删除, 否则更新数据库, 如果代理IP可用, 恢复为默认分值,更新数据库</li><li>代理API模块：从数据库中高可用的代理IP给爬虫使用; </li></ul><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><h3 id="爬虫模块"><a href="#爬虫模块" class="headerlink" title="爬虫模块"></a><strong>爬虫模块</strong></h3><p>从代理IP网站上采集代理IP ,对抓取的ip进行校验(获取代理响应速度, 协议类型, 匿名类型), 并存储到数据库中。</p><h3 id="校验模块"><a href="#校验模块" class="headerlink" title="校验模块"></a><strong>校验模块</strong></h3><p>网站上所标注的响应速度,协议类型和匿名类型是不准确的，通过httpbin.org进行检测，获取指定代理的响应速度, 支持的协议以及匿名程度。</p><h3 id="数据库模块"><a href="#数据库模块" class="headerlink" title="数据库模块"></a><strong>数据库模块</strong></h3><p>使用MongoDB来存储代理IP并实现对代理IP的增删改查操作。</p><h3 id="检测模块"><a href="#检测模块" class="headerlink" title="检测模块"></a><strong>检测模块</strong></h3><p>定时从数据库读取所有的代理IP，对代理IP进行逐一检测, 开启多个协程, 以提高检测速度，如果该代理不可用, 就让这个代理分数-1, 当代理的分数到0了, 就删除该代理; 如果检测到代理可用就恢复为满分。</p><h3 id="API模块"><a href="#API模块" class="headerlink" title="API模块"></a><strong>API模块</strong></h3><p>根据协议类型和域名获取多个随机的高质量代理IP，根据代理IP不可用域名, 告诉代理池这个代理IP在该域名下不可用, 下次获取这个域名的代理IP时候, 就不会再获取这个代理IP了, 从而保证代理IP高可用性。</p><h3 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a><strong>其他模块</strong></h3><p><strong>数据模型</strong></p><p>代理IP的数据模型, 用于封装代理IP相关信息, 比如ip,端口号, 响应速度, 协议类型, 匿名类型,分数等。</p><p><strong>程序入口</strong></p><p>代理池提供一个统一的启动入口</p><p><strong>工具模块</strong></p><ul><li><p>日志模块: 用于记录日志信息</p></li><li><p>http模块: 用于获取随机User-Agent的请求头</p></li></ul><p><strong>配置文件</strong></p><p>用于默认代理的分数, 配置日志格式, 文件, 启动的爬虫, 检验的间隔时间 等。</p><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>思路1：依据流程图，逐步实现各个模块，当需要依赖其他模块时，暂停当前模块，开发其他模块功能，实现完毕再回头开发联调。</p><p>思路2：先实现不依赖其他模块的基础模块，再逐步实现具体的功能模块，比如爬虫模块, 检测模块, 代理API模块。</p><p>这里我们选择思路2实现爬虫代理IP池，因为思路1适合个人完成，不适合分工合作，且不易维护，思路跳来跳去，必须逻辑清晰。</p><h2 id="数据模型domain"><a href="#数据模型domain" class="headerlink" title="数据模型domain"></a>数据模型domain</h2><p>settings.py 中 定义MAX_SCORE = 50, 表示代理IP的默认最高分数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Proxy(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, ip, port, protocol&#x3D;-1, nick_type&#x3D;-1, speed&#x3D;-1, area&#x3D;None, score&#x3D;MAX_SCORE, disable_domains&#x3D;[]):</span><br><span class="line">        # ip: 代理的IP地址</span><br><span class="line">        self.ip &#x3D; ip</span><br><span class="line">        # port: 代理IP的端口号</span><br><span class="line">        self.port &#x3D; port</span><br><span class="line">        # protocol: 代理IP支持的协议类型, http是0, https是1, https和http都支持是2，-1不可用</span><br><span class="line">        self.protocol &#x3D; protocol</span><br><span class="line">        # nick_type: 代理IP的匿名程度, 高匿: 0, 匿名: 1, 透明: 2</span><br><span class="line">        self.nick_type &#x3D; nick_type</span><br><span class="line">        # speed: 代理IP的响应速度, 单位s</span><br><span class="line">        self.speed &#x3D; speed</span><br><span class="line">        # area: 代理IP所在地区</span><br><span class="line">        self.area &#x3D; area</span><br><span class="line">        # score: 代理IP的评分, 用于衡量代理的可用性;</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line">        # 默认分值可以通过配置文件进行配置.在进行代理可用性检查的时候, 每遇到一次请求失败就减1份, 减到0的时候从池中删除.如果检查代理可用, 就恢复默认分值</span><br><span class="line">        # disable_domains: 不可用域名列表, 有些代理IP在某些域名下不可用, 但是在其他域名下可用</span><br><span class="line">        self.disable_domains &#x3D; disable_domains</span><br><span class="line"></span><br><span class="line">    # 3. 提供 __str__ 方法, 返回数据字符串</span><br><span class="line">    def __str__(self):</span><br><span class="line">        # 返回数据字符串</span><br><span class="line">        return str(self.__dict__)</span><br></pre></td></tr></table></figure><h2 id="日志模块log"><a href="#日志模块log" class="headerlink" title="日志模块log"></a>日志模块log</h2><p>导入settings中日志配置信息,如下<br>LOG_LEVEL = logging.DEBUG    # 默认等级<br>LOG_FMT = ‘%(asctime)s %(filename)s [line:%(lineno)d] %(levelname)s: %(message)s’   # 默认日志格式<br>LOG_DATEFMT = ‘%Y-%m-%d %H:%M:%S’  # 默认时间格式<br>LOG_FILENAME = ‘log.log’    # 默认日志文件名称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class Logger(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        # 1. 获取一个logger对象</span><br><span class="line">        self._logger &#x3D; logging.getLogger()</span><br><span class="line">        # 2. 设置format对象</span><br><span class="line">        self.formatter &#x3D; logging.Formatter(fmt&#x3D;LOG_FMT,datefmt&#x3D;LOG_DATEFMT)</span><br><span class="line">        # 3. 设置日志输出</span><br><span class="line">        # 3.1 设置文件日志模式</span><br><span class="line">        self._logger.addHandler(self._get_file_handler(LOG_FILENAME))</span><br><span class="line">        # 3.2 设置终端日志模式</span><br><span class="line">        self._logger.addHandler(self._get_console_handler())</span><br><span class="line">        # 4. 设置日志等级</span><br><span class="line">        self._logger.setLevel(LOG_LEVEL)</span><br><span class="line"></span><br><span class="line">    def _get_file_handler(self, filename):</span><br><span class="line">        &#39;&#39;&#39;返回一个文件日志handler&#39;&#39;&#39;</span><br><span class="line">        # 1. 获取一个文件日志handler</span><br><span class="line">        filehandler &#x3D; logging.FileHandler(filename&#x3D;filename,encoding&#x3D;&quot;utf-8&quot;)</span><br><span class="line">        # 2. 设置日志格式</span><br><span class="line">        filehandler.setFormatter(self.formatter)</span><br><span class="line">        # 3. 返回</span><br><span class="line">        return filehandler</span><br><span class="line"></span><br><span class="line">    def _get_console_handler(self):</span><br><span class="line">        &#39;&#39;&#39;返回一个输出到终端日志handler&#39;&#39;&#39;</span><br><span class="line">        # 1. 获取一个输出到终端日志handler</span><br><span class="line">        console_handler &#x3D; logging.StreamHandler(sys.stdout)</span><br><span class="line">        # 2. 设置日志格式</span><br><span class="line">        console_handler.setFormatter(self.formatter)</span><br><span class="line">        # 3. 返回handler</span><br><span class="line">        return console_handler</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def logger(self):</span><br><span class="line">        return self._logger</span><br><span class="line"></span><br><span class="line"># 初始化并配一个logger对象，达到单例的</span><br><span class="line"># 使用时，直接导入logger就可以使用</span><br><span class="line">logger &#x3D; Logger().logger</span><br></pre></td></tr></table></figure><h2 id="请求模块http"><a href="#请求模块http" class="headerlink" title="请求模块http"></a>请求模块http</h2><p>返回随机请求头和随机User-Agent,对抗反爬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#   1. 准备User-Agent的列表</span><br><span class="line">USER_AGENTS &#x3D; [</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident&#x2F;4.0; WOW64; Trident&#x2F;4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit&#x2F;523.15 (KHTML, like Gecko, Safari&#x2F;419.3) Arora&#x2F;0.3 (Change: 287 c9dfb30)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux; en-US) AppleWebKit&#x2F;527+ (KHTML, like Gecko, Safari&#x2F;419.3) Arora&#x2F;0.6&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko&#x2F;20070215 K-Ninja&#x2F;2.1.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko&#x2F;20080705 Firefox&#x2F;3.0 Kapiko&#x2F;3.0&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; Linux i686; U;) Gecko&#x2F;20070322 Kazehakase&#x2F;0.4.5&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora&#x2F;1.9.0.8-1.fc10 Kazehakase&#x2F;0.5.6&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;535.11 (KHTML, like Gecko) Chrome&#x2F;17.0.963.56 Safari&#x2F;535.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit&#x2F;535.20 (KHTML, like Gecko) Chrome&#x2F;19.0.1036.7 Safari&#x2F;535.20&quot;,</span><br><span class="line">    &quot;Opera&#x2F;9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto&#x2F;2.9.168 Version&#x2F;11.52&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;536.11 (KHTML, like Gecko) Chrome&#x2F;20.0.1132.11 TaoBrowser&#x2F;2.0 Safari&#x2F;536.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.71 Safari&#x2F;537.1 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;535.11 (KHTML, like Gecko) Chrome&#x2F;17.0.963.84 Safari&#x2F;535.11 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser&#x2F;7.0.3698.400)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 5.1) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.89 Safari&#x2F;537.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.1 (KHTML, like Gecko) Chrome&#x2F;21.0.1180.89 Safari&#x2F;537.1&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit&#x2F;533.17.9 (KHTML, like Gecko) Version&#x2F;5.0.2 Mobile&#x2F;8C148 Safari&#x2F;6533.18.5&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko&#x2F;20110307 Firefox&#x2F;4.0b13pre&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko&#x2F;20100101 Firefox&#x2F;16.0&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) AppleWebKit&#x2F;537.11 (KHTML, like Gecko) Chrome&#x2F;23.0.1271.64 Safari&#x2F;537.11&quot;,</span><br><span class="line">    &quot;Mozilla&#x2F;5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko&#x2F;20100922 Ubuntu&#x2F;10.10 (maverick) Firefox&#x2F;3.6.10&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 实现一个方法, 获取随机User-Agent的请求头</span><br><span class="line">def get_request_headers():</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;User-Agent&#39;: random.choice(USER_AGENTS),</span><br><span class="line">        &#39;Accept&#39;: &#39;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8&#39;,</span><br><span class="line">        &#39;Accept-Language&#39;: &#39;en-US,en;q&#x3D;0.5&#39;,</span><br><span class="line">        &#39;Connection&#39;: &#39;keep-alive&#39;,</span><br><span class="line">        &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return headers</span><br></pre></td></tr></table></figure><h2 id="校验模块httpbin-validator"><a href="#校验模块httpbin-validator" class="headerlink" title="校验模块httpbin_validator"></a>校验模块httpbin_validator</h2><ul><li>检查代理IP速度 和 匿名程度; <ul><li>代理IP速度: 就是从发送请求到获取响应的时间间隔</li><li>匿名程度检查: <ul><li>对 <code>http://httpbin.org/get</code> 或 <code>https://httpbin.org/get</code> 发送请求</li><li>如果 响应的<code>origin</code> 中有’,’分割的两个IP就是透明代理IP</li><li>如果 响应的<code>headers</code> 中包含 <code>Proxy-Connection</code> 说明是匿名代理IP </li><li>否则就是高匿代理IP</li></ul></li></ul></li><li>检查代理IP协议类型<ul><li>如果 <code>http://httpbin.org/get</code> 发送请求可以成功, 说明支持http协议</li><li>如果 <code>https://httpbin.org/get</code> 发送请求可以成功, 说明支持https协议 </li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">def check_proxy(proxy):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    用于检查指定 代理IP 响应速度, 匿名程度, 支持协议类型</span><br><span class="line">    :param proxy: 代理IP模型对象</span><br><span class="line">    :return: 检查后的代理IP模型对象</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # 准备代理IP字典</span><br><span class="line">    proxies &#x3D; &#123;</span><br><span class="line">        &#39;http&#39;:&#39;http:&#x2F;&#x2F;&#123;&#125;:&#123;&#125;&#39;.format(proxy.ip, proxy.port),</span><br><span class="line">        &#39;https&#39;:&#39;https:&#x2F;&#x2F;&#123;&#125;:&#123;&#125;&#39;.format(proxy.ip, proxy.port),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 测试该代理IP</span><br><span class="line">    http, http_nick_type, http_speed &#x3D; __check_http_proxies(proxies)</span><br><span class="line">    https, https_nick_type, https_speed &#x3D; __check_http_proxies(proxies, False)</span><br><span class="line">    # 代理IP支持的协议类型, http是0, https是1, https和http都支持是2</span><br><span class="line">    if http and https:</span><br><span class="line">        proxy.protocol &#x3D; 2</span><br><span class="line">        proxy.nick_type &#x3D; http_nick_type</span><br><span class="line">        proxy.speed &#x3D; http_speed</span><br><span class="line">    elif http:</span><br><span class="line">        proxy.protocol &#x3D; 0</span><br><span class="line">        proxy.nick_type &#x3D; http_nick_type</span><br><span class="line">        proxy.speed &#x3D; http_speed</span><br><span class="line">    elif https:</span><br><span class="line">        proxy.protocol &#x3D; 1</span><br><span class="line">        proxy.nick_type &#x3D; https_nick_type</span><br><span class="line">        proxy.speed &#x3D; https_speed</span><br><span class="line">    else:</span><br><span class="line">        proxy.protocol &#x3D; -1</span><br><span class="line">        proxy.nick_type &#x3D; -1</span><br><span class="line">        proxy.speed &#x3D; -1</span><br><span class="line"></span><br><span class="line">    return proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def __check_http_proxies(proxies, is_http&#x3D;True):</span><br><span class="line">    # 匿名类型: 高匿: 0, 匿名: 1, 透明: 2</span><br><span class="line">    nick_type &#x3D; -1</span><br><span class="line">    # 响应速度, 单位s</span><br><span class="line">    speed &#x3D; -1</span><br><span class="line"></span><br><span class="line">    if is_http:</span><br><span class="line">        test_url &#x3D; &#39;http:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;</span><br><span class="line">    else:</span><br><span class="line">        test_url &#x3D; &#39;https:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        # 获取开始时间</span><br><span class="line">        start &#x3D; time.time()</span><br><span class="line">        # 发送请求, 获取响应数据</span><br><span class="line">        response &#x3D; requests.get(test_url, headers&#x3D;get_request_headers(), proxies&#x3D;proxies, timeout&#x3D;TEST_TIMEOUT)</span><br><span class="line"></span><br><span class="line">        if response.ok:</span><br><span class="line">            # 计算响应速度</span><br><span class="line">            speed &#x3D;  round(time.time() - start, 2)</span><br><span class="line">            # 匿名程度</span><br><span class="line">            # 把响应的json字符串, 转换为字典</span><br><span class="line">            dic &#x3D; json.loads(response.text)</span><br><span class="line">            # 获取来源IP: origin</span><br><span class="line">            origin &#x3D; dic[&#39;origin&#39;]</span><br><span class="line">            proxy_connection &#x3D; dic[&#39;headers&#39;].get(&#39;Proxy-Connection&#39;, None)</span><br><span class="line">            if &#39;,&#39; in origin:</span><br><span class="line">                #    1. 如果 响应的origin 中有&#39;,&#39;分割的两个IP就是透明代理IP</span><br><span class="line">                nick_type &#x3D; 2</span><br><span class="line">            elif proxy_connection:</span><br><span class="line">                #    2. 如果 响应的headers 中包含 Proxy-Connection 说明是匿名代理IP</span><br><span class="line">                nick_type &#x3D; 1</span><br><span class="line">            else:</span><br><span class="line">                #  3. 否则就是高匿代理IP</span><br><span class="line">                nick_type &#x3D; 0</span><br><span class="line"></span><br><span class="line">            return True, nick_type, speed</span><br><span class="line">        return False, nick_type, speed</span><br><span class="line">    except Exception as ex:</span><br><span class="line">        # logger.exception(ex)</span><br><span class="line">        return False, nick_type, speed</span><br></pre></td></tr></table></figure><h2 id="数据库模块mongo-pool"><a href="#数据库模块mongo-pool" class="headerlink" title="数据库模块mongo_pool"></a>数据库模块mongo_pool</h2><ol><li>在<code>init</code>中, 建立数据连接, 获取要操作的集合, 在 <code>del</code> 方法中关闭数据库连接</li><li>提供基础的增删改查功能</li><li>提供代理API模块使用的功能</li><li>实现查询功能: 根据条件进行查询, 可以指定查询数量, 先分数降序, 速度升序排, 保证优质的代理IP在上面. </li><li>实现根据协议类型 和 要访问网站的域名, 获取代理IP列表</li><li>实现根据协议类型 和 要访问网站的域名, 随机获取一个代理IP </li><li>实现把指定域名添加到指定IP的disable_domain列表中.</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">class MongoPool(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        # 1.1. 在init中, 建立数据连接</span><br><span class="line">        self.client &#x3D; MongoClient(MONGO_URL)</span><br><span class="line">        # 1.2  获取要操作的集合</span><br><span class="line">        self.proxies &#x3D; self.client[&#39;proxies_pool&#39;][&#39;proxies&#39;]</span><br><span class="line"></span><br><span class="line">    def __del__(self):</span><br><span class="line">        # 1.3 关闭数据库连接</span><br><span class="line">        self.client.close()</span><br><span class="line"></span><br><span class="line">    def insert_one(self, proxy):</span><br><span class="line">        &quot;&quot;&quot;2.1 实现插入功能&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        count &#x3D; self.proxies.count_documents(&#123;&#39;_id&#39;: proxy.ip&#125;)</span><br><span class="line">        if count &#x3D;&#x3D; 0:</span><br><span class="line">            # 我们使用proxy.ip作为, MongoDB中数据的主键: _id</span><br><span class="line">            dic &#x3D; proxy.__dict__</span><br><span class="line">            dic[&#39;_id&#39;] &#x3D; proxy.ip</span><br><span class="line">            self.proxies.insert_one(dic)</span><br><span class="line">            logger.info(&#39;插入新的代理:&#123;&#125;&#39;.format(proxy))</span><br><span class="line">        else:</span><br><span class="line">            logger.warning(&quot;已经存在的代理:&#123;&#125;&quot;.format(proxy))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def update_one(self, proxy):</span><br><span class="line">        &quot;&quot;&quot;2.2 实现修改该功能&quot;&quot;&quot;</span><br><span class="line">        self.proxies.update_one(&#123;&#39;_id&#39;: proxy.ip&#125;, &#123;&#39;$set&#39;:proxy.__dict__&#125;)</span><br><span class="line"></span><br><span class="line">    def delete_one(self, proxy):</span><br><span class="line">        &quot;&quot;&quot;2.3 实现删除代理: 根据代理的IP删除代理&quot;&quot;&quot;</span><br><span class="line">        self.proxies.delete_one(&#123;&#39;_id&#39;: proxy.ip&#125;)</span><br><span class="line">        logger.info(&quot;删除代理IP: &#123;&#125;&quot;.format(proxy))</span><br><span class="line"></span><br><span class="line">    def find_all(self):</span><br><span class="line">        &quot;&quot;&quot;2.4 查询所有代理IP的功能&quot;&quot;&quot;</span><br><span class="line">        cursor &#x3D; self.proxies.find()</span><br><span class="line">        for item in cursor:</span><br><span class="line">            # 删除_id这个key</span><br><span class="line">            item.pop(&#39;_id&#39;)</span><br><span class="line">            proxy &#x3D; Proxy(**item)</span><br><span class="line">            yield proxy</span><br><span class="line"></span><br><span class="line">    def find(self, conditions&#x3D;&#123;&#125;, count&#x3D;0):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        3.1 实现查询功能: 根据条件进行查询, 可以指定查询数量, 先分数降序, 速度升序排, 保证优质的代理IP在上面.</span><br><span class="line">        :param conditions: 查询条件字典</span><br><span class="line">        :param count: 限制最多取出多少个代理IP</span><br><span class="line">        :return: 返回满足要求代理IP(Proxy对象)列表</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        cursor &#x3D; self.proxies.find(conditions, limit&#x3D;count).sort([</span><br><span class="line">            (&#39;score&#39;, pymongo.DESCENDING),(&#39;speed&#39;, pymongo.ASCENDING)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        # 准备列表, 用于存储查询处理代理IP</span><br><span class="line">        proxy_list &#x3D; []</span><br><span class="line">        # 遍历 cursor</span><br><span class="line">        for item in cursor:</span><br><span class="line">            item.pop(&#39;_id&#39;)</span><br><span class="line">            proxy &#x3D; Proxy(**item)</span><br><span class="line">            proxy_list.append(proxy)</span><br><span class="line"></span><br><span class="line">        # 返回满足要求代理IP(Proxy对象)列表</span><br><span class="line">        return proxy_list</span><br><span class="line"></span><br><span class="line">    def get_proxies(self, protocol&#x3D;None, domain&#x3D;None, count&#x3D;0, nick_type&#x3D;0):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        3.2 实现根据协议类型 和 要访问网站的域名, 获取代理IP列表</span><br><span class="line">        :param protocol: 协议: http, https</span><br><span class="line">        :param domain: 域名: jd.com</span><br><span class="line">        :param count:  用于限制获取多个代理IP, 默认是获取所有的</span><br><span class="line">        :param nick_type: 匿名类型, 默认, 获取高匿的代理IP</span><br><span class="line">        :return: 满足要求代理IP的列表</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # 定义查询条件</span><br><span class="line">        conditions &#x3D; &#123;&#39;nick_type&#39;: nick_type&#125;</span><br><span class="line">        # 根据协议, 指定查询条件</span><br><span class="line">        if protocol is None:</span><br><span class="line">            # 如果没有传入协议类型, 返回支持http和https的代理IP</span><br><span class="line">            conditions[&#39;protocol&#39;] &#x3D; 2</span><br><span class="line">        elif protocol.lower() &#x3D;&#x3D; &#39;http&#39;:</span><br><span class="line">            conditions[&#39;protocol&#39;] &#x3D; &#123;&#39;$in&#39;: [0, 2]&#125;</span><br><span class="line">        else:</span><br><span class="line">            conditions[&#39;protocol&#39;] &#x3D; &#123;&#39;$in&#39;: [1, 2]&#125;</span><br><span class="line"></span><br><span class="line">        if domain:</span><br><span class="line">            conditions[&#39;disable_domains&#39;] &#x3D; &#123;&#39;$nin&#39;: [domain]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        # 满足要求代理IP的列表</span><br><span class="line">        return self.find(conditions, count&#x3D;count)</span><br><span class="line"></span><br><span class="line">    def random_proxy(self, protocol&#x3D;None, domain&#x3D;None, count&#x3D;0, nick_type&#x3D;0):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        3.3 实现根据协议类型 和 要访问网站的域名, 随机获取一个代理IP</span><br><span class="line">        :param protocol: 协议: http, https</span><br><span class="line">        :param domain: 域名: jd.com</span><br><span class="line">        :param count:  用于限制获取多个代理IP, 默认是获取所有的</span><br><span class="line">        :param nick_type: 匿名类型, 默认, 获取高匿的代理IP</span><br><span class="line">        :return: 满足要求的随机的一个代理IP(Proxy对象)</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        proxy_list &#x3D; self.get_proxies(protocol&#x3D;protocol, domain&#x3D;domain, count&#x3D;count, nick_type&#x3D;nick_type)</span><br><span class="line">        # 从proxy_list列表中, 随机取出一个代理IP返回</span><br><span class="line">        return random.choice(proxy_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def disable_domain(self, ip, domain):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        3.4 实现把指定域名添加到指定IP的disable_domain列表中.</span><br><span class="line">        :param ip: IP地址</span><br><span class="line">        :param domain: 域名</span><br><span class="line">        :return: 如果返回True, 就表示添加成功了, 返回False添加失败了</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # print(self.proxies.count_documents(&#123;&#39;_id&#39;: ip, &#39;disable_domains&#39;:domain&#125;))</span><br><span class="line"></span><br><span class="line">        if self.proxies.count_documents(&#123;&#39;_id&#39;: ip, &#39;disable_domains&#39;:domain&#125;) &#x3D;&#x3D; 0:</span><br><span class="line">            # 如果disable_domains字段中没有这个域名, 才添加</span><br><span class="line">            self.proxies.update_one(&#123;&#39;_id&#39;:ip&#125;, &#123;&#39;$push&#39;: &#123;&#39;disable_domains&#39;: domain&#125;&#125;)</span><br><span class="line">            return True</span><br><span class="line">        return False</span><br></pre></td></tr></table></figure><h2 id="爬虫模块base-spider"><a href="#爬虫模块base-spider" class="headerlink" title="爬虫模块base_spider"></a>爬虫模块base_spider</h2><ol><li>在base_spider.py文件中,定义一个BaseSpider类, 继承object</li><li>提供三个类成员变量:<ul><li>urls: 代理IP网址的URL的列表</li><li>group_xpath: 分组XPATH, 获取包含代理IP信息标签列表的XPATH</li><li>detail_xpath: 组内XPATH, 获取代理IP详情的信息XPATH, 格式为: {‘ip’:’xx’, ‘port’:’xx’, ‘area’:’xx’}</li></ul></li><li>提供初始方法, 传入爬虫URL列表, 分组XPATH, 详情(组内)XPATH</li><li>对外提供一个获取代理IP的方法 <ul><li>遍历URL列表, 获取URL</li><li>根据发送请求, 获取页面数据</li><li>解析页面, 提取数据, 封装为Proxy对象</li><li>返回Proxy对象列表</li></ul></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 1. 在base_spider.py文件中,定义一个BaseSpider类, 继承object</span><br><span class="line">class BaseSpider(object):</span><br><span class="line"></span><br><span class="line">    # 2. 提供三个类成员变量:</span><br><span class="line">    # urls: 代理IP网址的URL的列表</span><br><span class="line">    urls &#x3D; []</span><br><span class="line">    # group_xpath: 分组XPATH, 获取包含代理IP信息标签列表的XPATH</span><br><span class="line">    group_xpath &#x3D; &#39;&#39;</span><br><span class="line">    # detail_xpath: 组内XPATH, 获取代理IP详情的信息XPATH, 格式为: &#123;&#39;ip&#39;:&#39;xx&#39;, &#39;port&#39;:&#39;xx&#39;, &#39;area&#39;:&#39;xx&#39;&#125;</span><br><span class="line">    detail_xpath &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    # 3. 提供初始方法, 传入爬虫URL列表, 分组XPATH, 详情(组内)XPATH</span><br><span class="line">    def __init__(self, urls&#x3D;[], group_xpath&#x3D;&#39;&#39;, detail_xpath&#x3D;&#123;&#125;):</span><br><span class="line"></span><br><span class="line">        if urls:</span><br><span class="line">            self.urls &#x3D; urls</span><br><span class="line"></span><br><span class="line">        if group_xpath:</span><br><span class="line">            self.group_xpath &#x3D; group_xpath</span><br><span class="line"></span><br><span class="line">        if detail_xpath:</span><br><span class="line">            self.detail_xpath &#x3D; detail_xpath</span><br><span class="line"></span><br><span class="line">    def get_page_from_url(self, url):</span><br><span class="line">        &quot;&quot;&quot;根据URL 发送请求, 获取页面数据&quot;&quot;&quot;</span><br><span class="line">        response &#x3D; requests.get(url, headers&#x3D;get_request_headers())</span><br><span class="line">        print(url)</span><br><span class="line">        print(response.status_code)</span><br><span class="line">        return response.content</span><br><span class="line"></span><br><span class="line">    def get_first_from_list(self, lis):</span><br><span class="line">        # 如果列表中有元素就返回第一个, 否则就返回空串</span><br><span class="line">        return lis[0] if len(lis) !&#x3D; 0 else &#39;&#39;</span><br><span class="line"></span><br><span class="line">    def get_proxies_from_page(self, page):</span><br><span class="line">        &quot;&quot;&quot;解析页面, 提取数据, 封装为Proxy对象&quot;&quot;&quot;</span><br><span class="line">        element &#x3D; etree.HTML(page)</span><br><span class="line">        # 获取包含代理IP信息的标签列表</span><br><span class="line">        trs &#x3D; element.xpath(self.group_xpath)</span><br><span class="line">        # 遍历trs, 获取代理IP相关信息</span><br><span class="line">        for tr in trs:</span><br><span class="line">            ip &#x3D; self.get_first_from_list(tr.xpath(self.detail_xpath[&#39;ip&#39;]))</span><br><span class="line">            port &#x3D; self.get_first_from_list(tr.xpath(self.detail_xpath[&#39;port&#39;]))</span><br><span class="line">            area &#x3D; self.get_first_from_list(tr.xpath(self.detail_xpath[&#39;area&#39;]))</span><br><span class="line">            proxy &#x3D; Proxy(ip, port, area&#x3D;area)</span><br><span class="line">            # print(proxy)</span><br><span class="line">            # 使用yield返回提取到的数据</span><br><span class="line">            yield proxy</span><br><span class="line"></span><br><span class="line">    def get_proxies(self):</span><br><span class="line">        # 4. 对外提供一个获取代理IP的方法</span><br><span class="line">        # 4.1 遍历URL列表, 获取URL</span><br><span class="line">        for url in self.urls:</span><br><span class="line">            # print(url)</span><br><span class="line">            # 4.2 根据发送请求, 获取页面数据</span><br><span class="line">            page &#x3D; self.get_page_from_url(url)</span><br><span class="line">            # 4.3 解析页面, 提取数据, 封装为Proxy对象</span><br><span class="line">            proxies &#x3D; self.get_proxies_from_page(page)</span><br><span class="line">            # 4.4 返回Proxy对象列表</span><br><span class="line">            yield from proxies</span><br></pre></td></tr></table></figure><h2 id="具体爬虫实现proxy-spiders"><a href="#具体爬虫实现proxy-spiders" class="headerlink" title="具体爬虫实现proxy_spiders"></a>具体爬虫实现proxy_spiders</h2><ol><li><p><del>实现<code>西刺代理</code>爬虫: <code>http://www.xicidaili.com/nn/1</code></del></p><ul><li><del>定义一个类,继承通用爬虫类(BasicSpider)</del></li><li><del>提供urls, group_xpath 和 detail_xpath</del></li></ul></li><li><p>实现<code>ip3366代理</code>爬虫: <code>http://www.ip3366.net/free/?stype=1&amp;page=1</code></p><ul><li>定义一个类,继承通用爬虫类(BasicSpider)</li><li>提供urls, group_xpath 和 detail_xpath</li></ul></li><li><p>实现<code>快代理</code>爬虫:   <code>https://www.kuaidaili.com/free/inha/1/</code></p><ul><li>定义一个类,继承通用爬虫类(BasicSpider)</li><li>提供urls, group_xpath 和 detail_xpath</li></ul></li><li><p>实现<code>proxylistplus代理</code>爬虫: <code>https://list.proxylistplus.com/Fresh-HTTP-Proxy-List-1</code></p><ul><li>定义一个类,继承通用爬虫类(BasicSpider)</li><li>提供urls, group_xpath 和 detail_xpath</li></ul></li><li><p>实现<code>66ip</code>爬虫: <code>http://www.66ip.cn/1.html</code></p><ul><li>定义一个类,继承通用爬虫类(BasicSpider)</li><li>提供urls, group_xpath 和 detail_xpath</li><li>由于66ip网页进行js + cookie反爬, 需要重写父类的<code>get_page_from_url</code>方法</li></ul><p>访问<a href="http://www.66ip.cn/1.html" target="_blank" rel="noopener">http://www.66ip.cn/1.html</a> 时返回一堆js，并不返回具体ip信息，通过逐步增加请求头中的Cookie时发现真正生效的Cookie为_ydclearance，控制台打开Preserve log发现页面第一次1.html做了跳转，历史请求中都没有出现_ydclearance的cookie，第二次请求1.html时已经携带了_ydclearance说明该cookie已经不是服务端响应生成，而是由客户端js生成。</p></li></ol><blockquote><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BIP%E4%BB%A3%E7%90%86%E6%B1%A0/66ip%E9%80%86%E5%90%91%E5%88%86%E6%9E%90.png" alt="66ip逆向分析.png"></p><p>一开始我们访问<a href="http://www.66ip.cn/1.html" target="_blank" rel="noopener">http://www.66ip.cn/1.html</a> 时返回一堆js，执行这段js，就是用来生成_ydclearance的。那么分析这段js本身做了加密，js中通过定义函数<strong>jp</strong>并调用后，由于qo=eval，那么等同于最终调用了eval(po)，真正js在 “po” 中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result &#x3D; re.findall(&#39;window.onload&#x3D;setTimeout\(&quot;(.+?)&quot;, 200\);\s*(.+?)\s*&lt;&#x2F;script&gt;&#39; ,text)</span><br></pre></td></tr></table></figure><p>通过正则提取 <code>jp(107)</code> 调用函数方法, 以及函数内容<code> function jp(WI) { var qo, mo=&quot;&quot; ...</code>，通过将替换eval拿到返回的真实js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func_str &#x3D; result[0][1]</span><br><span class="line">func_str &#x3D; func_str.replace(&#39;eval(&quot;qo&#x3D;eval;qo(po);&quot;)&#39;, &#39;return po&#39;)</span><br></pre></td></tr></table></figure><p>执行js并将返回作为Cookie添加到请求头中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">context &#x3D; js2py.EvalJs()</span><br><span class="line">context.execute(func_str)</span><br><span class="line">context.execute(&#39;code &#x3D; &#123;&#125;;&#39;.format(result[0][0]))</span><br><span class="line">cookie_str &#x3D; re.findall(&quot;document.cookie&#x3D;&#39;(.+?); &quot;, context.code)[0]</span><br><span class="line">headers[&#39;Cookie&#39;] &#x3D; cookie_str</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">class XiciSpider(BaseSpider):</span><br><span class="line">    # 准备URL列表</span><br><span class="line">    urls &#x3D; [&#39;https:&#x2F;&#x2F;www.xicidaili.com&#x2F;nn&#x2F;&#123;&#125;&#39;.format(i) for i in range(1, 11)]</span><br><span class="line">    # 分组的XPATH, 用于获取包含代理IP信息的标签列表</span><br><span class="line">    group_xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;ip_list&quot;]&#x2F;tr[position()&gt;1]&#39;</span><br><span class="line">    # 组内的XPATH, 用于提取 ip, port, area</span><br><span class="line">    detail_xpath &#x3D; &#123;</span><br><span class="line">        &#39;ip&#39;:&#39;.&#x2F;td[2]&#x2F;text()&#39;,</span><br><span class="line">        &#39;port&#39;:&#39;.&#x2F;td[3]&#x2F;text()&#39;,</span><br><span class="line">        &#39;area&#39;:&#39;.&#x2F;td[4]&#x2F;a&#x2F;text()&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">2. 实现ip3366代理爬虫: http:&#x2F;&#x2F;www.ip3366.net&#x2F;free&#x2F;?stype&#x3D;1&amp;page&#x3D;1</span><br><span class="line">    定义一个类,继承通用爬虫类(BasicSpider)</span><br><span class="line">    提供urls, group_xpath 和 detail_xpath</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">class Ip3366Spider(BaseSpider):</span><br><span class="line">    # 准备URL列表</span><br><span class="line">    urls &#x3D; [&#39;http:&#x2F;&#x2F;www.ip3366.net&#x2F;free&#x2F;?stype&#x3D;&#123;&#125;&amp;page&#x3D;&#123;&#125;&#39;.format(i, j) for i in range(1, 4, 2) for j in range(1, 8)]</span><br><span class="line">    # # 分组的XPATH, 用于获取包含代理IP信息的标签列表</span><br><span class="line">    group_xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;list&quot;]&#x2F;table&#x2F;tbody&#x2F;tr&#39;</span><br><span class="line">    # 组内的XPATH, 用于提取 ip, port, area</span><br><span class="line">    detail_xpath &#x3D; &#123;</span><br><span class="line">        &#39;ip&#39;:&#39;.&#x2F;td[1]&#x2F;text()&#39;,</span><br><span class="line">        &#39;port&#39;:&#39;.&#x2F;td[2]&#x2F;text()&#39;,</span><br><span class="line">        &#39;area&#39;:&#39;.&#x2F;td[5]&#x2F;text()&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">3. 实现快代理爬虫: https:&#x2F;&#x2F;www.kuaidaili.com&#x2F;free&#x2F;inha&#x2F;1&#x2F;</span><br><span class="line">    定义一个类,继承通用爬虫类(BasicSpider)</span><br><span class="line">    提供urls, group_xpath 和 detail_xpath</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">class KaiSpider(BaseSpider):</span><br><span class="line">    # 准备URL列表</span><br><span class="line">    urls &#x3D; [&#39;https:&#x2F;&#x2F;www.kuaidaili.com&#x2F;free&#x2F;inha&#x2F;&#123;&#125;&#x2F;&#39;.format(i) for i in range(1, 6)]</span><br><span class="line">    # # 分组的XPATH, 用于获取包含代理IP信息的标签列表</span><br><span class="line">    group_xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;list&quot;]&#x2F;table&#x2F;tbody&#x2F;tr&#39;</span><br><span class="line">    # 组内的XPATH, 用于提取 ip, port, area</span><br><span class="line">    detail_xpath &#x3D; &#123;</span><br><span class="line">        &#39;ip&#39;:&#39;.&#x2F;td[1]&#x2F;text()&#39;,</span><br><span class="line">        &#39;port&#39;:&#39;.&#x2F;td[2]&#x2F;text()&#39;,</span><br><span class="line">        &#39;area&#39;:&#39;.&#x2F;td[5]&#x2F;text()&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 当我们两个页面访问时间间隔太短了, 就报错了; 这是一种反爬手段.</span><br><span class="line">    def get_page_from_url(self, url):</span><br><span class="line">        # 随机等待1,3s</span><br><span class="line">        time.sleep(random.uniform(1, 3))</span><br><span class="line">        # 调用父类的方法, 发送请求, 获取响应数据</span><br><span class="line">        return super().get_page_from_url(url)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">4. 实现proxylistplus代理爬虫: https:&#x2F;&#x2F;list.proxylistplus.com&#x2F;Fresh-HTTP-Proxy-List-1</span><br><span class="line">    定义一个类,继承通用爬虫类(BasicSpider)</span><br><span class="line">    提供urls, group_xpath 和 detail_xpath</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">class ProxylistplusSpider(BaseSpider):</span><br><span class="line">    # 准备URL列表</span><br><span class="line">    urls &#x3D; [&#39;https:&#x2F;&#x2F;list.proxylistplus.com&#x2F;Fresh-HTTP-Proxy-List-&#123;&#125;&#39;.format(i) for i in range(1, 7)]</span><br><span class="line">    # # 分组的XPATH, 用于获取包含代理IP信息的标签列表</span><br><span class="line">    group_xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;page&quot;]&#x2F;table[2]&#x2F;tbody&#x2F;tr[position()&gt;2]&#39;</span><br><span class="line">    # 组内的XPATH, 用于提取 ip, port, area</span><br><span class="line">    detail_xpath &#x3D; &#123;</span><br><span class="line">        &#39;ip&#39;:&#39;.&#x2F;td[2]&#x2F;text()&#39;,</span><br><span class="line">        &#39;port&#39;:&#39;.&#x2F;td[3]&#x2F;text()&#39;,</span><br><span class="line">        &#39;area&#39;:&#39;.&#x2F;td[5]&#x2F;text()&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">5. 实现66ip爬虫: http:&#x2F;&#x2F;www.66ip.cn&#x2F;1.html</span><br><span class="line">    定义一个类,继承通用爬虫类(BasicSpider)</span><br><span class="line">    提供urls, group_xpath 和 detail_xpath</span><br><span class="line">    由于66ip网页进行js + cookie反爬, 需要重写父类的get_page_from_url方法</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">class Ip66Spider(BaseSpider):</span><br><span class="line">    # 准备URL列表</span><br><span class="line">    urls &#x3D; [&#39;http:&#x2F;&#x2F;www.66ip.cn&#x2F;&#123;&#125;.html&#39;.format(i) for i in range(1, 11)]</span><br><span class="line">    # # 分组的XPATH, 用于获取包含代理IP信息的标签列表</span><br><span class="line">    group_xpath &#x3D; &#39;&#x2F;&#x2F;*[@id&#x3D;&quot;main&quot;]&#x2F;div&#x2F;div[1]&#x2F;table&#x2F;tbody&#x2F;tr[position()&gt;1]&#39;</span><br><span class="line">    # 组内的XPATH, 用于提取 ip, port, area</span><br><span class="line">    detail_xpath &#x3D; &#123;</span><br><span class="line">        &#39;ip&#39;:&#39;.&#x2F;td[1]&#x2F;text()&#39;,</span><br><span class="line">        &#39;port&#39;:&#39;.&#x2F;td[2]&#x2F;text()&#39;,</span><br><span class="line">        &#39;area&#39;:&#39;.&#x2F;td[3]&#x2F;text()&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 重写方法, 解决反爬问题</span><br><span class="line">    def get_page_from_url(self, url):</span><br><span class="line">        headers &#x3D; get_request_headers()</span><br><span class="line">        response &#x3D; requests.get(url, headers&#x3D;headers)</span><br><span class="line">        if response.status_code &#x3D;&#x3D; 521:</span><br><span class="line">            # 生成cookie信息, 再携带cookie发送请求</span><br><span class="line">            # 生成 &#96;_ydclearance&#96; cookie信息,控制台preserve log,第一个页面就是加密页面521用来做反爬跳转</span><br><span class="line">            # 1. 确定 _ydclearance 是从哪里来的;</span><br><span class="line">            # 观察发现: 这个cookie在前两个页面都没有返回，说明信息不使用通过服务器响应设置过来的; 那么他就是通过js生成.</span><br><span class="line">            # 2. 第一次发送请求的页面中, 有一个生成这个cookie的js; 执行这段js, 生成我们需要的cookie</span><br><span class="line">            # 这段js是经过加密处理后的js, 真正js在 &quot;po&quot; 中.</span><br><span class="line">            # 提取 &#96;jp(107)&#96; 调用函数的方法, 以及函数</span><br><span class="line">            result &#x3D; re.findall(&#39;window.onload&#x3D;setTimeout\(&quot;(.+?)&quot;, 200\);\s*(.+?)\s*&lt;&#x2F;script&gt; &#39;, response.content.decode(&#39;GBK&#39;))</span><br><span class="line">            # print(result)</span><br><span class="line">            # 我希望执行js时候, 返回真正要执行的js</span><br><span class="line">            # 把 &#96;eval(&quot;qo&#x3D;eval;qo(po);&quot;)&#96; 替换为 return po</span><br><span class="line">            func_str &#x3D; result[0][1]</span><br><span class="line">            func_str &#x3D; func_str.replace(&#39;eval(&quot;qo&#x3D;eval;qo(po);&quot;)&#39;, &#39;return po&#39;)</span><br><span class="line">            # print(func_str)</span><br><span class="line">            # 获取执行js的环境</span><br><span class="line">            context &#x3D; js2py.EvalJs()</span><br><span class="line">            # 加载(执行) func_str</span><br><span class="line">            context.execute(func_str)</span><br><span class="line">            # 执行这个方法, 生成我们需要的js</span><br><span class="line">            # code &#x3D; gv(50)</span><br><span class="line">            context.execute(&#39;code &#x3D; &#123;&#125;;&#39;.format(result[0][0]))</span><br><span class="line">            # 打印最终生成的代码</span><br><span class="line">            # print(context.code)</span><br><span class="line">            cookie_str &#x3D; re.findall(&quot;document.cookie&#x3D;&#39;(.+?); &quot;, context.code)[0]</span><br><span class="line">            # print(cookie_str)</span><br><span class="line">            headers[&#39;Cookie&#39;] &#x3D; cookie_str</span><br><span class="line">            response &#x3D; requests.get(url, headers&#x3D;headers)</span><br><span class="line">            return response.content.decode(&#39;GBK&#39;)</span><br><span class="line">        else:</span><br><span class="line">            return response.content.decode(&#39;GBK&#39;)</span><br></pre></td></tr></table></figure><h2 id="运行爬虫模块run-spiders"><a href="#运行爬虫模块run-spiders" class="headerlink" title="运行爬虫模块run_spiders"></a>运行爬虫模块run_spiders</h2><ul><li>创建RunSpider类</li><li>提供一个运行爬虫的<code>run</code>方法</li><li>根据配置文件信息, 加载爬虫, 把爬虫对象放到列表中</li><li>遍历爬虫对象列表, 获取代理, 检测代理(代理IP检测模块), 写入数据库(数据库模块) </li><li>使用异步来执行每一个爬虫任务</li><li>每隔一定的时间, 执行一次爬取任务</li></ul><p>settings配置<code>RUN_SPIDERS_INTERVAL</code>作为爬虫运行时间间隔的配置, 单位为小时</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">class RunSpider(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        # 创建MongoPool对象</span><br><span class="line">        self.mongo_pool &#x3D; MongoPool()</span><br><span class="line">        # 3.1 在init方法中创建协程池对象</span><br><span class="line">        self.coroutine_pool &#x3D; Pool()</span><br><span class="line"></span><br><span class="line">    def get_spider_from_settings(self):</span><br><span class="line">        &quot;&quot;&quot;根据配置文件信息, 获取爬虫对象列表.&quot;&quot;&quot;</span><br><span class="line">        # 遍历配置文件中爬虫信息, 获取每个爬虫全类名</span><br><span class="line">        for full_class_name in PROXIES_SPIDERS:</span><br><span class="line">            # core.proxy_spider.proxy_spiders.Ip66Spider</span><br><span class="line">            # 获取模块名 和 类名</span><br><span class="line">            module_name, class_name &#x3D; full_class_name.rsplit(&#39;.&#39;, maxsplit&#x3D;1)</span><br><span class="line">            # 根据模块名, 导入模块</span><br><span class="line">            module &#x3D; importlib.import_module(module_name)</span><br><span class="line">            # 根据类名, 从模块中, 获取类</span><br><span class="line">            cls &#x3D; getattr(module, class_name)</span><br><span class="line">            # 创建爬虫对象</span><br><span class="line">            spider &#x3D; cls()</span><br><span class="line">            # print(spider)</span><br><span class="line">            yield spider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        # 2.1 根据配置文件信息, 获取爬虫对象列表.</span><br><span class="line">        spiders &#x3D; self.get_spider_from_settings()</span><br><span class="line">        # 2.2 遍历爬虫对象列表, 获取爬虫对象, 遍历爬虫对象的get_proxies方法, 获取代理IP</span><br><span class="line">        for spider in spiders:</span><br><span class="line">            #  2.5 处理异常, 防止一个爬虫内部出错了, 影响其他的爬虫.</span><br><span class="line">            # 3.3 使用异步执行这个方法</span><br><span class="line">            # self.__execute_one_spider_task(spider)</span><br><span class="line">            self.coroutine_pool.apply_async(self.__execute_one_spider_task,args&#x3D;(spider, ))</span><br><span class="line"></span><br><span class="line">        # 3.4 调用协程的join方法, 让当前线程等待 协程 任务的完成.</span><br><span class="line">        self.coroutine_pool.join()</span><br><span class="line"></span><br><span class="line">    def __execute_one_spider_task(self, spider):</span><br><span class="line">        # 3.2 把处理一个代理爬虫的代码抽到一个方法</span><br><span class="line">        # 用于处理一个爬虫任务的.</span><br><span class="line">        try:</span><br><span class="line">            # 遍历爬虫对象的get_proxies方法, 获取代理I</span><br><span class="line">            for proxy in spider.get_proxies():</span><br><span class="line">                # print(proxy)</span><br><span class="line">                # 2.3 检测代理IP(代理IP检测模块)</span><br><span class="line">                proxy &#x3D; check_proxy(proxy)</span><br><span class="line">                # 2.4 如果可用,写入数据库(数据库模块)</span><br><span class="line">                # 如果speed不为-1, 就说明可用</span><br><span class="line">                if proxy.speed !&#x3D; -1:</span><br><span class="line">                    # 写入数据库(数据库模块)</span><br><span class="line">                    self.mongo_pool.insert_one(proxy)</span><br><span class="line">        except Exception as ex:</span><br><span class="line">            logger.exception(ex)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def start(cls):</span><br><span class="line">        # 4. 使用schedule模块, 实现每隔一定的时间, 执行一次爬取任务</span><br><span class="line">        # 4.1 定义一个start的类方法</span><br><span class="line">        # 4.2 创建当前类的对象, 调用run方法</span><br><span class="line">        rs &#x3D; RunSpider()</span><br><span class="line">        rs.run()</span><br><span class="line">        # 4.3 使用schedule模块, 每隔一定的时间, 执行当前对象的run方法</span><br><span class="line">        # 4.3.1 修改配置文件, 增加爬虫运行时间间隔的配置, 单位为小时</span><br><span class="line">        schedule.every(RUN_SPIDERS_INTERVAL).hours.do(rs.run)</span><br><span class="line">        while True:</span><br><span class="line">            schedule.run_pending()</span><br><span class="line">            time.sleep(1)</span><br></pre></td></tr></table></figure><h2 id="检测模块proxy-test"><a href="#检测模块proxy-test" class="headerlink" title="检测模块proxy_test"></a>检测模块proxy_test</h2><ol><li>创建ProxyTester类，检查代理IP可用性, 保证代理池中代理IP基本可用</li><li>提供一个 <code>run</code> 方法, 用于处理检测代理IP核心逻辑<ol><li>从数据库中获取所有代理IP</li><li>遍历代理IP列表</li><li>检查代理可用性<ul><li>如果代理不可用, 让代理分数-1, 如果代理分数等于0就从数据库中删除该代理, 否则更新该代理IP</li><li>如果代理可用, 就恢复该代理的分数, 更新到数据库中</li></ul></li></ol></li><li>为了提高检查的速度, 使用异步来执行检测任务<ol><li>把要检测的代理IP, 放到队列中</li><li>把检查一个代理可用性的代码, 抽取到一个方法中; 从队列中获取代理IP, 进行检查; 检查完毕, 调度队列的task_done方法</li><li>通过异步回调, 使用死循环不断执行这个方法,</li><li>开启多个一个异步任务, 来处理代理IP的检测; 可以通过配置文件指定异步数量 </li></ol></li><li>使用<code>schedule</code>模块, 每隔一定的时间, 执行一次检测任务<ol><li>定义类方法 <code>start</code>, 用于启动检测模块</li><li>在<code>start</code>方法中<ol><li>创建本类对象</li><li>调用run方法</li><li>每间隔一定时间, 执行一下, run方法</li></ol></li></ol></li></ol><p><code>setting.py</code> 文件, 检查代理IP可用性间隔时间的配置</p><p>RUN_SPIDERS_INTERVAL = 2  # 修改配置文件, 增加爬虫运行时间间隔的配置, 单位为小时<br>TEST_PROXIES_ASYNC_COUNT = 10  # 配置检测代理IP的异步数量<br>TEST_PROXIES_INTERVAL = 2  # 配置检查代理IP的时间间隔, 单位是小时</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">class ProxyTester(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        # 创建操作数据库的MongoPool对象</span><br><span class="line">        self.mongo_pool &#x3D; MongoPool()</span><br><span class="line">        # 3.1 在&#96;init&#96;方法, 创建队列和协程池</span><br><span class="line">        self.queue &#x3D; Queue()</span><br><span class="line">        self.coroutine_pool &#x3D; Pool()</span><br><span class="line"></span><br><span class="line">    def __check_callback(self, temp):</span><br><span class="line">        self.coroutine_pool.apply_async(self.__check_one_proxy, callback&#x3D;self.__check_callback)</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        # 提供一个 run 方法, 用于处理检测代理IP核心逻辑</span><br><span class="line">        # 2.1 从数据库中获取所有代理IP</span><br><span class="line">        proxies &#x3D; self.mongo_pool.find_all()</span><br><span class="line">        # 2.2 遍历代理IP列表</span><br><span class="line">        for proxy in proxies:</span><br><span class="line">            #  3.2 把要检测的代理IP, 放到队列中</span><br><span class="line">            self.queue.put(proxy)</span><br><span class="line"></span><br><span class="line">        #  3.5 开启多个一个异步任务, 来处理代理IP的检测; 可以通过配置文件指定异步数量</span><br><span class="line">        for i in range(TEST_PROXIES_ASYNC_COUNT):</span><br><span class="line">            #  3.4 通过异步回调, 使用死循环不断执行这个方法,</span><br><span class="line">            self.coroutine_pool.apply_async(self.__check_one_proxy, callback&#x3D;self.__check_callback)</span><br><span class="line"></span><br><span class="line">        # 让当前线程, 等待队列任务完成</span><br><span class="line">        self.queue.join()</span><br><span class="line"></span><br><span class="line">    def __check_one_proxy(self):</span><br><span class="line">        # 检查一个代理IP的可用性</span><br><span class="line">        #  3.3 把检查一个代理可用性的代码, 抽取到一个方法中;</span><br><span class="line">        # 从队列中获取代理IP, 进行检查; 检查完毕</span><br><span class="line">        proxy &#x3D; self.queue.get()</span><br><span class="line">        #  2.3 检查代理可用性</span><br><span class="line">        proxy &#x3D; check_proxy(proxy)</span><br><span class="line">        # 2.4 如果代理不可用, 让代理分数-1,</span><br><span class="line">        if proxy.speed &#x3D;&#x3D; -1:</span><br><span class="line">            proxy.score -&#x3D; 1</span><br><span class="line">            # 如果代理分数等于0就从数据库中删除该代理</span><br><span class="line">            if proxy.score &#x3D;&#x3D; 0:</span><br><span class="line">                self.mongo_pool.delete_one(proxy)</span><br><span class="line">            else:</span><br><span class="line">                # 否则更新该代理IP</span><br><span class="line">                self.mongo_pool.update_one(proxy)</span><br><span class="line">        else:</span><br><span class="line">            # 2.5 如果代理可用, 就恢复该代理的分数, 更新到数据库中</span><br><span class="line">            proxy.score &#x3D; MAX_SCORE</span><br><span class="line">            self.mongo_pool.update_one(proxy)</span><br><span class="line">        # 调度队列的task_done方法</span><br><span class="line">        self.queue.task_done()</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def start(cls):</span><br><span class="line">        #  4.2.1 创建本类对象</span><br><span class="line">        proxy_tester &#x3D; cls()</span><br><span class="line">        #  4.2.2 调用run方法</span><br><span class="line">        proxy_tester.run()</span><br><span class="line"></span><br><span class="line">        # 4.2.3 每间隔一定时间, 执行一下, run方法</span><br><span class="line">        schedule.every(TEST_PROXIES_INTERVAL).hours.do(proxy_tester.run)</span><br><span class="line">        while True:</span><br><span class="line">            schedule.run_pending()</span><br><span class="line">            time.sleep(1)</span><br></pre></td></tr></table></figure><h2 id="API模块proxy-api"><a href="#API模块proxy-api" class="headerlink" title="API模块proxy_api"></a>API模块proxy_api</h2><ul><li>创建<code>ProxyApi</code>类，为爬虫提供高可用代理IP的服务接口</li><li>实现初始方法<ul><li>初始一个Flask的Web服务</li><li>实现根据协议类型和域名, 提供随机的获取高可用代理IP的服务<ul><li>可用通过 <code>protocol</code> 和 <code>domain</code> 参数对IP进行过滤</li><li><code>protocol</code>: 当前请求的协议类型</li><li><code>domain</code>: 当前请求域名</li></ul></li><li>实现根据协议类型和域名, 提供获取多个高可用代理IP的服务<ul><li>可用通过<code>protocol</code> 和 <code>domain</code> 参数对IP进行过滤</li></ul></li><li>实现给指定的IP上追加不可用域名的服务 <ul><li>如果在获取IP的时候, 有指定域名参数, 将不在获取该IP, 从而进一步提高代理IP的可用性.</li></ul></li></ul></li><li>实现run方法, 用于启动Flask的WEB服务</li><li>实现start的类方法, 用于通过类名, 启动服务</li></ul><p>settings中配置<code>PROXIES_MAX_COUNT</code>配置获取的代理IP最大数量; 这个越小可用性就越高; 但是随机性越差</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">class ProxyApi(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        # 2. 实现初始方法</span><br><span class="line">        # 2.1 初始一个Flask的Web服务</span><br><span class="line">        self.app &#x3D; Flask(__name__)</span><br><span class="line">        # 创建MongoPool对象, 用于操作数据库</span><br><span class="line">        self.mongo_pool &#x3D; MongoPool()</span><br><span class="line"></span><br><span class="line">        @self.app.route(&#39;&#x2F;random&#39;)</span><br><span class="line">        def random():</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            localhost:6868&#x2F;random?protocol&#x3D;https&amp;domain&#x3D;jd.com</span><br><span class="line">            2.2 实现根据协议类型和域名, 提供随机的获取高可用代理IP的服务</span><br><span class="line">                可用通过 protocol 和 domain 参数对IP进行过滤</span><br><span class="line">                protocol: 当前请求的协议类型</span><br><span class="line">                domain: 当前请求域名</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            protocol &#x3D; request.args.get(&#39;protocol&#39;)</span><br><span class="line">            domain &#x3D; request.args.get(&#39;domain&#39;)</span><br><span class="line">            proxy &#x3D; self.mongo_pool.random_proxy(protocol, domain, count&#x3D;PROXIES_MAX_COUNT)</span><br><span class="line"></span><br><span class="line">            if protocol:</span><br><span class="line">                return &#39;&#123;&#125;:&#x2F;&#x2F;&#123;&#125;:&#123;&#125;&#39;.format(protocol, proxy.ip, proxy.port)</span><br><span class="line">            else:</span><br><span class="line">                return &#39;&#123;&#125;:&#123;&#125;&#39;.format(proxy.ip, proxy.port)</span><br><span class="line"></span><br><span class="line">        @self.app.route(&#39;&#x2F;proxies&#39;)</span><br><span class="line">        def proxies():</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">                localhost:6868&#x2F;proxies?protocol&#x3D;https&amp;domain&#x3D;jd.com</span><br><span class="line">                2.3 实现根据协议类型和域名, 提供获取多个高可用代理IP的服务</span><br><span class="line">                可用通过protocol 和 domain 参数对IP进行过滤</span><br><span class="line">                实现给指定的IP上追加不可用域名的服务</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            # 获取协议: http&#x2F;https</span><br><span class="line">            protocol &#x3D; request.args.get(&#39;protocol&#39;)</span><br><span class="line">            # 域名: 如:jd.com</span><br><span class="line">            domain &#x3D; request.args.get(&#39;domain&#39;)</span><br><span class="line"></span><br><span class="line">            proxies &#x3D; self.mongo_pool.get_proxies(protocol, domain, count&#x3D;PROXIES_MAX_COUNT)</span><br><span class="line">            # proxies 是一个 Proxy对象的列表, 但是Proxy对象不能进行json序列化, 需要转换为字典列表</span><br><span class="line">            # 转换为字典列表</span><br><span class="line">            proxies &#x3D; [proxy.__dict__ for proxy in proxies]</span><br><span class="line">            # 返回json格式值串</span><br><span class="line">            return json.dumps(proxies)</span><br><span class="line"></span><br><span class="line">        @self.app.route(&#39;&#x2F;disable_domain&#39;)</span><br><span class="line">        def disable_domain():</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            localhost:6868&#x2F;disable_domain?ip&#x3D;120.92.174.12&amp;domain&#x3D;jd.com</span><br><span class="line">            2.4 如果在获取IP的时候, 有指定域名参数, 将不在获取该IP, 从而进一步提高代理IP的可用性.</span><br><span class="line">            &quot;&quot;&quot;</span><br><span class="line">            ip &#x3D; request.args.get(&#39;ip&#39;)</span><br><span class="line">            domain &#x3D; request.args.get(&#39;domain&#39;)</span><br><span class="line"></span><br><span class="line">            if ip is None:</span><br><span class="line">                return &#39;请提供ip参数&#39;</span><br><span class="line">            if domain is None:</span><br><span class="line">                return &#39;请提供域名domain参数&#39;</span><br><span class="line"></span><br><span class="line">            self.mongo_pool.disable_domain(ip, domain)</span><br><span class="line">            return &quot;&#123;&#125; 禁用域名 &#123;&#125; 成功&quot;.format(ip, domain)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        &quot;&quot;&quot;3. 实现run方法, 用于启动Flask的WEB服务&quot;&quot;&quot;</span><br><span class="line">        self.app.run(&#39;0.0.0.0&#39;, port&#x3D;6868)</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def start(cls):</span><br><span class="line">        # 4. 实现start的类方法, 用于通过类名, 启动服务</span><br><span class="line">        proxy_api &#x3D; cls()</span><br><span class="line">        proxy_api.run()</span><br></pre></td></tr></table></figure><h2 id="启动入口main"><a href="#启动入口main" class="headerlink" title="启动入口main"></a>启动入口main</h2><ul><li>定义一个run方法用于启动动代理池，开启三个进程, 分别用于启动<code>爬虫</code>, <code>检测代理IP</code>, <code>WEB服务</code><ul><li>定义一个列表, 用于存储要启动的进程</li><li>创建 <code>启动爬虫</code> 的进程, 添加到列表中</li><li>创建 <code>启动检测</code> 的进程, 添加到列表中</li><li>创建 <code>启动提供API服务</code> 的进程, 添加到列表中</li><li>遍历进程列表, 启动所有进程</li><li>遍历进程列表, 让主进程等待子进程的完成</li></ul></li><li>在 <code>if __name__ == &#39;__main__&#39;:</code> 中调用run方法</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def run():</span><br><span class="line">    # 1. 定义一个列表, 用于存储要启动的进程</span><br><span class="line">    process_list &#x3D; []</span><br><span class="line">    # 2. 创建 启动爬虫 的进程, 添加到列表中</span><br><span class="line">    process_list.append(Process(target&#x3D;RunSpider.start))</span><br><span class="line">    # 3. 创建 启动检测 的进程, 添加到列表中</span><br><span class="line">    process_list.append(Process(target&#x3D;ProxyTester.start))</span><br><span class="line">    # 4. 创建 启动提供API服务 的进程, 添加到列表中</span><br><span class="line">    process_list.append(Process(target&#x3D;ProxyApi.start))</span><br><span class="line"></span><br><span class="line">    # 5. 遍历进程列表, 启动所有进程</span><br><span class="line">    for process in process_list:</span><br><span class="line">        # 设置守护进程</span><br><span class="line">        process.daemon &#x3D; True</span><br><span class="line">        process.start()</span><br><span class="line"></span><br><span class="line">    # 6. 遍历进程列表, 让主进程等待子进程的完成</span><br><span class="line">    for process in process_list:</span><br><span class="line">        process.join()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8BIP%E4%BB%A3%E7%90%86%E6%B1%A0/%E7%88%AC%E8%99%AB%E4%BB%A3%E7%90%86%E6%B1%A0%E5%AE%9E%E7%8E%B0.gif" alt="爬虫代理池实现"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> requests </tag>
            
            <tag> pymongo </tag>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之页面请求解析</title>
      <link href="2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/"/>
      <url>2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h1><p>html中为指定元素指定显示效果，比如颜色，背景，字体等不同的属性，这些样式都是通过css选择器告诉浏览器指定样式风格。</p><table><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td>#animal</td><td>获取id为animal的所有元素</td></tr><tr><td>.animal</td><td>获取class为animal的所有元素</td></tr><tr><td>a.active</td><td>获取类为active的a标签</td></tr><tr><td>.animal &gt; .pig</td><td>获取类animal直接子元素中类为.pig的元素</td></tr><tr><td>.animal  .pig</td><td>获取类animal后代元素中类为.pig的元素</td></tr><tr><td>a[href*=”animal”]</td><td>获取包含类animal的a元素</td></tr><tr><td>a[href^=”http”]</td><td>获取href以http开头的a元素</td></tr><tr><td>a[href$=”gov.cn”]</td><td>获取href以gov.cn结尾的a元素</td></tr><tr><td>div[class=”animal”][ctype=”pig”]</td><td>获取多属性同时具备的元素</td></tr><tr><td>div &gt; a:nth-child(2)</td><td>获取div下的第二个a元素</td></tr><tr><td>.pig , .animal</td><td>同时选择两个class的所有元素</td></tr><tr><td>p:nth-last-child(1)</td><td>获取倒数第一个p元素</td></tr><tr><td>p:nth-child(even) p:nth-child(odd)</td><td>获取奇数偶数节点</td></tr><tr><td>h3 + span</td><td>获取h3 <code>后面紧跟着的兄弟节点</code> span</td></tr><tr><td>h3 ~ span</td><td>获取h3 <code>后面所有的兄弟节点</code> span</td></tr></tbody></table><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="链家"><a href="#链家" class="headerlink" title="链家"></a>链家</h3><p>目标抓取网站：<a href="https://su.lianjia.com/ershoufang/pg" target="_blank" rel="noopener">https://su.lianjia.com/ershoufang/pg</a></p><p>抓取内容：分页抓取二手房的标题，地址，信息，关注量，标签，总价，单价等</p><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E9%93%BE%E5%AE%B6%E5%88%86%E6%9E%901.gif" alt="链家分析1"></p><p>通过获取网页源代码发现所有的二手房信息都直接渲染在页面上，那么可以直接请求<a href="https://su.lianjia.com/ershoufang/pg" target="_blank" rel="noopener">页面地址</a>分析二手房源码后，通过parsel库<code>parsel.Selector(html_data)</code>转为我们可以使用选择器分析的对象。</p><p>通过css选择器<code>.clear.LOGCLICKDATA</code>拿到所有的二手房信息所在的li元素</p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E9%93%BE%E5%AE%B6%E5%88%86%E6%9E%902.png" alt="链家分析2.png"></p><p>在li元素下可以css选择器获取所有的<code>.title a::text</code>标题，<code>.positionInfo a::text</code>地址，<code>.followInfo::text</code>关注量等信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">selector &#x3D; parsel.Selector(html_data)</span><br><span class="line">lis &#x3D; selector.css(&#39;.clear.LOGCLICKDATA&#39;)</span><br><span class="line">for li in lis:</span><br><span class="line">    title &#x3D; li.css(&#39;.title a::text&#39;).get()  # 标题</span><br><span class="line">    address &#x3D; li.css(&#39;.positionInfo a::text&#39;).getall()  # 地址</span><br><span class="line">    address &#x3D; &#39;,&#39;.join(address)</span><br><span class="line">    houseInfo &#x3D; li.css(&#39;.houseInfo::text&#39;).get()  # 信息</span><br><span class="line">    followInfo &#x3D; li.css(&#39;.followInfo::text&#39;).get()  # 关注</span><br><span class="line">    tags &#x3D; li.css(&#39;.tag span::text&#39;).get()  # 标签</span><br><span class="line">    tags &#x3D; &#39;,&#39;.join(tags)</span><br><span class="line">    totalPrice &#x3D; li.css(&#39;.totalPrice span::text&#39;).get() + &#39;万&#39;  # 总价</span><br><span class="line">    unitePrice &#x3D; li.css(&#39;.unitPrice span::text&#39;).get()  # 单价</span><br><span class="line">    title_url &#x3D; li.css(&#39;.title a::attr(href)&#39;).get()  # 标题</span><br><span class="line">    print(title, address, houseInfo, followInfo, tags, totalPrice, unitePrice, title_url, sep&#x3D;&quot;---&quot;)</span><br></pre></td></tr></table></figure><h4 id="爬取完成"><a href="#爬取完成" class="headerlink" title="爬取完成"></a>爬取完成</h4><p>点击下一页的时候，页面url添加了路径参数pg{}，那么可以通过加该字段实现分页抓取。</p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E9%93%BE%E5%AE%B6%E7%88%AC%E5%8F%96%E5%AE%8C%E6%88%90.png" alt="链家爬取完成.png"></p><h3 id="猫眼电影"><a href="#猫眼电影" class="headerlink" title="猫眼电影"></a>猫眼电影</h3><h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><p>目标抓取网站：<a href="https://maoyan.com/board" target="_blank" rel="noopener">https://maoyan.com/board</a></p><p>抓取内容：热映口碑榜的电影名，主演，上映时间等。</p><p>老规矩，查看网页源代码电影数据完整返回给前端，没有做异步请求。那么直接访问猫眼的<a href="https://maoyan.com/board" target="_blank" rel="noopener">热映口碑榜</a>通过parsel库解析成Selector对象，开始利用css选择器分析页面字段。</p><p>通过控制台源码发现类.board-wrapper下dd元素包含了所有的电影信息，那么遍历其下的标签列表根据css选择器筛选拿到需要的数据即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">selector &#x3D; parsel.Selector(html_data)</span><br><span class="line">print(selector)</span><br><span class="line">dds &#x3D; selector.css(&#39;.board-wrapper dd&#39;)</span><br><span class="line">for dd in dds:</span><br><span class="line">    title &#x3D; dd.css(&#39;.name a::attr(title)&#39;).get()</span><br><span class="line">    star &#x3D; dd.css(&#39;.star::text&#39;).get().strip()</span><br><span class="line">    releasetime &#x3D; dd.css(&#39;.releasetime::text&#39;).get()</span><br><span class="line">    score &#x3D; dd.css(&#39;.score i::text&#39;).getall()</span><br><span class="line">    score &#x3D; &#39;&#39;.join(score)</span><br><span class="line">    print(title, star, releasetime, score)</span><br><span class="line"></span><br><span class="line">    with open(&#39;maoyan.csv&#39;, mode&#x3D;&#39;a&#39;, encoding&#x3D;&#39;utf-8&#39;, newline&#x3D;&#39;&#39;) as f:</span><br><span class="line">        csv_write &#x3D; csv.writer(f)</span><br><span class="line">        csv_write.writerow([title, star, releasetime, score])</span><br></pre></td></tr></table></figure><h4 id="爬取完成-1"><a href="#爬取完成-1" class="headerlink" title="爬取完成"></a>爬取完成</h4><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E7%8C%AB%E7%9C%BC%E7%88%AC%E5%8F%96%E7%BB%93%E6%9E%9C.png" alt="猫眼爬取结果.png"></p><h3 id="喜马拉雅"><a href="#喜马拉雅" class="headerlink" title="喜马拉雅"></a>喜马拉雅</h3><h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><p>目标网站：<a href="https://www.ximalaya.com/xiangsheng/9723091" target="_blank" rel="noopener">https://www.ximalaya.com/xiangsheng/9723091</a></p><p>抓取内容：下载当前主题的所有页面的音频文件。</p><p>老规矩，查看网页源代码发现所有的音频标签会在当前页面ur后添加音频的id跳转到一个新的页面，如：<a href="https://www.ximalaya.com/xiangsheng/9723091/45982355" target="_blank" rel="noopener">https://www.ximalaya.com/xiangsheng/9723091/45982355</a></p><p>点击播放后，控制台的Media出现请求的音频地址,如：<a href="https://aod.cos.tx.xmcdn.com/group31/M01/36/04/wKgJSVmC6drBDNayAh_Q8WincwI414.m4a" target="_blank" rel="noopener">https://aod.cos.tx.xmcdn.com/group31/M01/36/04/wKgJSVmC6drBDNayAh_Q8WincwI414.m4a</a></p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85.gif" alt="喜马拉雅"></p><p>通过控制台搜索音频关键字段，找到返回音频地址的请求<a href="https://www.ximalaya.com/revision/play/v1/audio?id=46106992&amp;ptype=1" target="_blank" rel="noopener">https://www.ximalaya.com/revision/play/v1/audio?id=46106992&amp;ptype=1</a></p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E9%9F%B3%E9%A2%91%E6%BA%90%E5%9C%B0%E5%9D%80.png" alt="喜马拉雅音频源地址.png"></p><p>该请求参数由音频id和ptype=1组成，通过css选择器<code>.sound-list li.lF_ a::attr(href)</code>分析列表页的音频的href拿到音频id，通过css选择器<code>.sound-list li.lF_ a::attr(title)</code>拿到音频标题。点击下一页发现只是在原url后添加p{page}字段，综上通过open函数写入音频文件完成下载。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">titles &#x3D; selector.css(&#39;.sound-list li.lF_ a::attr(title)&#39;).getall()</span><br><span class="line">href &#x3D; selector.css(&#39;.sound-list li.lF_ a::attr(href)&#39;).getall()</span><br><span class="line"># zip() 可以讲两个列表进行打包, 遍历之后 是一个元组</span><br><span class="line">data &#x3D; zip(titles, href)</span><br><span class="line">for index in data:</span><br><span class="line">    title &#x3D; index[0]</span><br><span class="line">    mp3_id &#x3D; index[1].split(&#39;&#x2F;&#39;)[-1]</span><br><span class="line">    # f&#39;&#123;mp3_id&#125;&#39;  &#39;&#123;&#125;&#39;.format(mp3_id) 字符串格式化方法</span><br><span class="line">    index_url &#x3D; f&#39;https:&#x2F;&#x2F;www.ximalaya.com&#x2F;revision&#x2F;play&#x2F;v1&#x2F;audio?id&#x3D;&#123;mp3_id&#125;&amp;ptype&#x3D;1&#39;</span><br><span class="line">    response_1 &#x3D; requests.get(url&#x3D;index_url, headers&#x3D;headers)</span><br><span class="line">    # 什么是json数据  字典嵌套字典  还嵌套一些列表</span><br><span class="line">    # json数据取值和字典取值方式是一样的  根据关键词提取内容  通俗的讲 就是根据左边的内容提取右边的内容</span><br><span class="line">    # print(response_1.text)</span><br><span class="line">    mp3_url &#x3D; response_1.json()[&#39;data&#39;][&#39;src&#39;]</span><br><span class="line">    print(title, mp3_url)</span><br><span class="line">    # 保存数据</span><br><span class="line">    # 保存数据: 如果是图片&#x2F;音频&#x2F;视频 等 都是要获取它的二进制数据,要以二进制的数据保存</span><br><span class="line">    mp3_content &#x3D; requests.get(url&#x3D;mp3_url).content</span><br><span class="line">    # 相对路径</span><br><span class="line">    with open(&#39;相声\\&#39; + title + &#39;.mp3&#39;, mode&#x3D;&#39;wb&#39;) as f:</span><br><span class="line">        f.write(mp3_content)</span><br><span class="line">        print(&#39;正在保存: &#39;, title)</span><br></pre></td></tr></table></figure><h4 id="爬取完成-2"><a href="#爬取完成-2" class="headerlink" title="爬取完成"></a>爬取完成</h4><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E5%96%9C%E9%A9%AC%E6%8B%89%E9%9B%85%E7%88%AC%E5%8F%96%E5%AE%8C%E6%88%90.png" alt="喜马拉雅爬取完成.png"></p><h1 id="XPATH选择器"><a href="#XPATH选择器" class="headerlink" title="XPATH选择器"></a>XPATH选择器</h1><p>XPath (XML Path Language) 是由国际标准化组织W3C指定的，用来在 XML 和 HTML 文档中选择节点的语言。目前主流浏览器 (chrome、firefox，edge，safari) 都支持XPath语法，xpath有 1 和 2 两个版本，目前浏览器支持的是 xpath 1的语法，且比CSS选择器功能更强大。</p><table><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td>/html/body/div</td><td>选择根节点html下面的body下面的div元素，/从子节点找，//从所有子节点包括子节点的子节点中找</td></tr><tr><td>//div/*</td><td>所有div节点下所有元素</td></tr><tr><td>//*[@id=’west’]</td><td>id为west的元素</td></tr><tr><td>//select[@class=’single_choice’]</td><td>class为single_choice的select元素</td></tr><tr><td>//p[@class=”capital huge-city”]</td><td>多元素组合选择</td></tr><tr><td>//*[@multiple]</td><td>具有multiple属性的元素</td></tr><tr><td>//*[contains(@style,’color’)]</td><td>style包含color的元素</td></tr><tr><td>//*[starts-with(@style,’color’)]</td><td>以style是color开头的元素，//*[ends-with(@style,’color’)]结尾元素</td></tr><tr><td>//div/p[2]</td><td>所有div下的第二个p标签</td></tr><tr><td>//p[last()]</td><td>最后一个p元素</td></tr><tr><td>//div/p[last()-2]</td><td>所有div下倒数第三个p元素</td></tr><tr><td>//option[position()&lt;=2]</td><td>option类型的第1-2个元素</td></tr><tr><td>//*[@class=’multi_choice’]/*[position()&gt;=last()-2]</td><td>选择class属性为multi_choice的后3个子元素</td></tr><tr><td>//option|//h4</td><td>所有的option元素 和所有的 h4 元素</td></tr><tr><td>//*[@id=’china’]/..</td><td>选择 id 为 china 的节点的父节点</td></tr><tr><td>//*[@id=’china’]/../../..</td><td>上上父节点</td></tr><tr><td>//*[@class=’single_choice’]/following-sibling::div</td><td>选择后续节点中的div节点  等同于CSS选择器.single_choice ~ *</td></tr><tr><td>//<em>[@class=’single_choice’]/preceding-sibling::</em></td><td>前面兄弟节点</td></tr></tbody></table><h2 id="实战-1"><a href="#实战-1" class="headerlink" title="实战"></a>实战</h2><h3 id="新笔趣阁"><a href="#新笔趣阁" class="headerlink" title="新笔趣阁"></a>新笔趣阁</h3><h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4><p>目标网站：<a href="http://www.xbiquge.la/10/10489/" target="_blank" rel="noopener">http://www.xbiquge.la/10/10489/</a></p><p>抓取内容：抓取三寸人间所有章节的文章保存。</p><p>章节列表只有小说章节信息，点击每个章节跳转到章节页面，通常xpath表达式<code>//div[@id=&quot;info&quot;]/h1/text()</code>拿到书籍名称，所有的章节都依赖于于id为list的div下的dl下的dd下的a标签的href属性跳转到章节页面。</p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E4%B8%89%E5%AF%B8%E4%BA%BA%E9%97%B4%E7%AB%A0%E8%8A%82%E5%88%86%E6%9E%90.png" alt="三寸人间章节分析"></p><p>拼接主域名<code>http://www.xbiquge.la</code>即可跳转到章节详情页面，通过xpath表达式<code>//*[@id=&quot;content&quot;]/text()</code>拿到详情页面小说的完整内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 开文件流   打开一个文件 把我们数据写入到文件中去    a是追加写入 写入完第一章就继续追加写入第二章</span><br><span class="line">with open(book_name + &#39;.txt&#39;, &#39;a&#39;, encoding&#x3D;&#39;utf-8&#39;)as f:</span><br><span class="line">    f.write(book_name+&#39;\n&#39;)</span><br><span class="line">    # title 章节的名称     urls 每个章节的详情链接</span><br><span class="line">    # 遍历获取到该本书的每个章节和对应的内容详情链接  zip一次性遍历多个列表</span><br><span class="line">    for title,urls in zip(book_title,book_url):</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        c_url&#x3D;&#39;http:&#x2F;&#x2F;www.xbiquge.la&#39;+urls</span><br><span class="line"></span><br><span class="line">        print(title)</span><br><span class="line">        print(c_url)</span><br><span class="line"></span><br><span class="line">        # 异常处理</span><br><span class="line">        try: #捕捉异常</span><br><span class="line">            #参数1：单个章节的url:以获取到这个章节的小说内容的html源码 参数2：headers  参数3：请求等待时间3秒</span><br><span class="line">            titles_url &#x3D; requests.get(c_url, headers&#x3D;headers, timeout&#x3D;3).content.decode(&#39;utf-8&#39;)</span><br><span class="line">        except: # 如果捕捉异常怎么办  请求失败那就再请求一遍</span><br><span class="line">            titles_url &#x3D; requests.get(c_url, headers&#x3D;headers).content.decode(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">        # 那我们还差一个小说文本内容对不对 那每个章节链接我们有了</span><br><span class="line">        # 每个章节里面的内容是不是好解决 一样xpath语法给他获取下来</span><br><span class="line">        # 通过xpath获取到小说文本内容</span><br><span class="line">        book_content &#x3D; etree.HTML(titles_url).xpath(&#39;&#x2F;&#x2F;*[@id&#x3D;&quot;content&quot;]&#x2F;text()&#39;)</span><br><span class="line"></span><br><span class="line">        f.write(title) # 先写入章节名称</span><br><span class="line">        f.write(&#39;\n&#39;)</span><br><span class="line"></span><br><span class="line">        # f.write不能够写列表，但可以写字符串格式（二进制）。。。  所以要for循环</span><br><span class="line">        for line in book_content:</span><br><span class="line">            f.write(line) # 再写入章节对应的内容</span><br><span class="line">        f.write(&#39;\n&#39;)  # 每写完一章换行  一共1000多个章节</span><br></pre></td></tr></table></figure><h4 id="爬取完成-3"><a href="#爬取完成-3" class="headerlink" title="爬取完成"></a>爬取完成</h4><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E6%96%B0%E7%AC%94%E8%B6%A3%E9%98%81%E6%8A%93%E5%8F%96%E5%AE%8C%E6%88%90.png" alt="新笔趣阁抓取完成.png"></p><blockquote><p>其实很多情况下不需要自己去分析dom节点定位css或xpath表达式，chrome已经为我们集成了插件。</p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/xpath%E5%92%8Ccss%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F.gif" alt="xpath和css获取方式.gif"></p></blockquote><h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><p>很多情况页面不直接返回html或xml文本元素，或者这些文本分析起来很困难的情况下，可以通过控制台中的xhr模式抓取后端请求回来的json数据，直接解析json即可拿到想要的数据。</p><h2 id="实战-2"><a href="#实战-2" class="headerlink" title="实战"></a>实战</h2><h3 id="拉勾"><a href="#拉勾" class="headerlink" title="拉勾"></a>拉勾</h3><h4 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h4><p>目标网站：<a href="https://www.lagou.com/jobs/list_C%2B%2B?labelWords=&amp;fromSearch=true&amp;suginput=" target="_blank" rel="noopener">https://www.lagou.com/jobs/list_C%2B%2B?labelWords=&amp;fromSearch=true&amp;suginput=</a></p><p>抓取内容：抓取首页职位地址，公司名，规模等信息保存。</p><p>搜索C++后，打开控制台将结果中的<code>带薪年假</code>搜索拿到实际请求路径<code>https://www.lagou.com/jobs/positionAjax.json?needAddtionalResult=false</code>，该请求是post请求，参数如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data &#x3D; &#123;</span><br><span class="line">    &quot;first&quot;: &quot;true&quot;,</span><br><span class="line">    &quot;pn&quot;: &quot;1&quot;,</span><br><span class="line">    &quot;kd&quot;: &quot;C++&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E6%8B%89%E5%8B%BE%E5%88%86%E6%9E%90.png" alt="拉勾分析.png"></p><p>通过控制台Preview分析返回的json数据，<code>data[&#39;content&#39;][&#39;positionResult&#39;][&#39;result&#39;]</code>即为职位信息</p><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E6%8B%89%E5%8B%BEjson.png" alt="拉勾json.png"></p><p>不过当我们直接请求时会报dtacess deny,可能对请求头中的参数做了校验。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;F:&#x2F;MyProject&#x2F;CrawlerBase&#x2F;lagou&#x2F;lagou.py&quot;, line 21, in &lt;module&gt;</span><br><span class="line">    result &#x3D; data[&#39;content&#39;][&#39;positionResult&#39;][&#39;result&#39;]</span><br><span class="line">KeyError: &#39;content&#39;</span><br><span class="line">&#123;&#39;clientIp&#39;: &#39;61.155.198.*&#39;,</span><br><span class="line"> &#39;msg&#39;: &#39;dtaccess deny &#39;,</span><br><span class="line"> &#39;state&#39;: 2410,</span><br><span class="line"> &#39;status&#39;: False&#125;</span><br></pre></td></tr></table></figure><p>我们将Cookie和User-Agent加入header后，即可以完整请求到json数据，进行数据分析。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">resp &#x3D; requests.post(api_url, headers&#x3D;headers)</span><br><span class="line">pprint(resp.json())</span><br><span class="line">data &#x3D; resp.json()</span><br><span class="line">result &#x3D; data[&#39;content&#39;][&#39;positionResult&#39;][&#39;result&#39;]</span><br><span class="line"># [print(r) for r in result]</span><br><span class="line">for r in result:</span><br><span class="line">    d &#x3D; &#123;</span><br><span class="line">        &#39;city&#39;: r[&#39;city&#39;],</span><br><span class="line">        &#39;companyFullName&#39;: r[&#39;companyFullName&#39;],</span><br><span class="line">        &#39;companySize&#39;: r[&#39;companySize&#39;],</span><br><span class="line">        &#39;education&#39;: r[&#39;education&#39;],</span><br><span class="line">        &#39;positionName&#39;: r[&#39;positionName&#39;],</span><br><span class="line">        &#39;salary&#39;: r[&#39;salary&#39;],</span><br><span class="line">        &#39;workYear&#39;: r[&#39;workYear&#39;]</span><br><span class="line">    &#125;</span><br><span class="line">    with open(&#39;拉钩职位.csv&#39;,mode&#x3D;&#39;a&#39;,encoding&#x3D;&#39;utf-8&#39;) as f:</span><br><span class="line">        f.write(&quot;,&quot;.join(d.values()))</span><br><span class="line">        f.write(&quot;\n&quot;)</span><br></pre></td></tr></table></figure><h4 id="爬取完成-4"><a href="#爬取完成-4" class="headerlink" title="爬取完成"></a>爬取完成</h4><p><img src="/2021/03/30/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%AF%B7%E6%B1%82%E8%A7%A3%E6%9E%90/%E6%8B%89%E5%8B%BE%E6%8A%93%E5%8F%96.png" alt="拉勾抓取.png"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xpath </tag>
            
            <tag> css </tag>
            
            <tag> json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之多线程实现</title>
      <link href="2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/"/>
      <url>2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h1><p>python并不像java这类高级语言需要将文件编译为机器码交给虚拟机执行，而是由python虚拟机一条条地将py语句解释运行，故而称之为解释型语言。</p><p>python先将py文件编译成字节码，交给字节码虚拟机后，虚拟机从编译得到的PyCodeObject对象在当前的上下文环境逐条执行字节码指令，完成整个程序的执行流程。</p><blockquote><p>字节码在python虚拟机程序里对应的是PyCodeObject对象， .pyc文件是字节码在磁盘上的表现形式。</p></blockquote><p>例如：在python test.py过程中会将test.py进行编译成字节码并解释执行，当test.py中加载了其他模块，如import urllib2，python会将urllib2.py进行编译成字节码，生成urllib2.pyc，并重新对字节码解释执行。加载模块时，当.py和.pyc同时存在时，优先运行.pyc文件，若.pyc文件比.py编译时间早，执行流程也会优先重新编译.py文件并更新.pyc文件。</p><blockquote><p>.pyc文件通过内置模块py_compile来编译生成test.pyc,或者通过python -m test.py生成test.pyc</p></blockquote><h2 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h2><p>由于物理上的科技发展，各CPU厂商在核心频率上已经被多核CPU所取代，为了更有效的利用多核处理器的性能，就出现了多线程的编程技巧，又因为Python GIL的存在让Python虚拟机在进行运算时无法有效利用多核心，几乎只能单线程处理任务，所以将任务并行化，分散到多个线程或多个进程的实现和GIL本身的存在是天生冲突的矛盾。</p><p>首先，GIL不是python的特性，是实现python解析器(CPython)时的语法标准，并不是python的特性，类似的还有JPython等就没有GIL，但是CPython是大部分环境下默认的Python执行环境，自然而然CPython==python，自然而然GIL成为的python天生的缺陷。</p><p>当多核CPU出现在市场的时候，python为了支持多线程，首要解决的就是线程之间的数据完整性和数据同步性，GIL应运而生，简单粗暴的为线程加上了一把大锁，后起之库们默认都接受了这种实现方案，省去考虑额外线程间的内存锁和同步操作，导致大量的三方库都极度依赖GIL来实现线程安全。GIL这把全局排他锁，是多线程处理的致命伤，效率极底，因为python的线程就是C的一个pthread，通过操作系统的调度算法调度，为在调度过程中各线程平均利用CPU的时间，python会计算已执行的代码量，达到阈值强制释放GIL锁，触发一次操作系统的调度。</p><p>任何一个线程在唤起时可以成功获取到GIL，但是多核CPU上，release和acquire几乎没有间隔，导致其他核上的线程被唤醒时，主线程已经再次拿到GIL，导致被唤醒的其他线程只能白白浪费CPU时间，眼睁睁看着另一个线程拿个GIL快乐的执行，当达到切换时间后进入待调度状态，再次唤醒再次等待，恶性循环。</p><h2 id="多线程方案"><a href="#多线程方案" class="headerlink" title="多线程方案"></a>多线程方案</h2><h3 id="multiprocessing"><a href="#multiprocessing" class="headerlink" title="multiprocessing"></a>multiprocessing</h3><p>一定程度弥补了thread库由于GIL锁导致低效的缺陷，完整的实现了一套thread接口，但是只是使用了多进程而本身不是多进程，原理上每个进程有自己独立的GIL，不会出现进程间的GIL争抢，但是增加了线程间数据通讯和同步的麻烦，由于不同进程间无法看到对方的数据状态，只能在主线程声明一个队列，通过队列的实现解决数据本身的问题，无疑徒增的代码的开发与维护成本。</p><h3 id="concurrent"><a href="#concurrent" class="headerlink" title="concurrent"></a>concurrent</h3><p>提供了多线程ThreadPoolExecutor和多进程ProcessPoolExecutor两种并发模型。</p><ul><li>计算密集型任务<br>永远最多只能榨干单核CPU，如果需要提升效率，必须通过ProcessPoolExecutor fork出多个子进程来分担计算任务。</li><li>IO密集型任务<br>CPU使用效率极低，虽然使用多线程加倍CPU使用率，但是还远远到不了饱和(100%)的地步，在单核心可以应付整体计算的前提下，自然是应该选择资源占用少的模式，也就是多线程模式。主线程是通过队列将任务传递给多个子线程的。一旦主线程将任务塞进任务队列，子线程们就会开始争抢，最终只有一个线程能抢到这个任务，并立即进行执行，执行完后将结果放进Future对象就完成了这个任务的完整执行过程。</li></ul><blockquote><p>concurrent的线程池有个重大的缺陷，那就是任务队列是无界的。如果队列的生产者任务生产的太快，而线程池消费太慢处理不过来，任务就会堆积。如果堆积一直持续下去，内存就会持续增长直到OOM，任务队列里堆积的所有任务全部彻底丢失。</p></blockquote><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/concurrent%E5%8E%9F%E7%90%86.jpg" alt="concurrent原理"></p><ol><li>主线程将任务塞进TaskQueue(普通内存队列)，拿到Future对象</li><li>唯一的管理线程从TaskQueue获取任务，塞进CallQueue(分布式跨进程队列)</li><li>子进程从CallQueue中争抢任务进行处理</li><li>子进程将处理结果塞进ResultQueue(分布式跨进程队列)</li><li>管理线程从ResultQueue中获取结果，塞进Future对象</li><li>主线程从Future对象中拿到结果</li></ol><blockquote><p>进程池模型中的跨进程队列是用multiprocessing.Queue实现的。它使用无名套接字sockerpair来完成的跨进程通信，socketpair和socket的区别就在于socketpair不需要端口，不需要走网络协议栈，通过内核的套接字读写缓冲区直接进行跨进程通信。multiprocessing.Queue是支持双工通信，数据流向是父子双向，只不过在concurrent的进程池实现中只用到了单工通信。CallQueue是从父到子，ResultQueue是从子到父。</p><blockquote><p>当父进程要传递任务给子进程时，先使用pickle将任务对象进行序列化成字节数组，然后将字节数组通过socketpair的写描述符写入内核的buffer中。子进程接下来就可以从buffer中读取到字节数组，然后再使用pickle对字节数组进行反序列化来得到任务对象，这样总算可以执行任务了。同样子进程将结果传递给父进程走的也是一样的流程，只不过这里的socketpair是ResultQueue内部创建的无名套接字。</p></blockquote></blockquote><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="doutula"><a href="#doutula" class="headerlink" title="doutula"></a>doutula</h2><p>上文讲到通过分析页面元素分页抓取doutula表情包并保存图片的的案例，由于网络请求结果返回往往比IO存储图片要快，接下来通过多线程的方式实现在IO相对较慢的前提下使用多线程处理存储图片。核心代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def main(page):</span><br><span class="line">    &quot;&quot;&quot;函数入口&quot;&quot;&quot;</span><br><span class="line">    for page in range(1, page + 1):</span><br><span class="line">        print(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;正在爬去第&#123;&#125;页数据&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;.format(page))</span><br><span class="line">        # 定义最多 max_workers 个线程的线程池来异步执行调用。如果 max_workers 为 None 或没有指定，将默认为机器处理器的个数</span><br><span class="line">        thread_pool &#x3D; concurrent.futures.ThreadPoolExecutor(max_workers&#x3D;3)</span><br><span class="line">        res &#x3D; send_request(&#39;https:&#x2F;&#x2F;www.doutula.com&#x2F;photo&#x2F;list&#x2F;?page&#x3D;&#123;&#125;&#39;.format(str(page)))</span><br><span class="line">        # 封装解析函数</span><br><span class="line">        src_url &#x3D; parse_data(res.text)</span><br><span class="line">        for file, url in src_url:</span><br><span class="line">            image_response &#x3D; send_request(url)</span><br><span class="line">            # 提交线程请求，save_data是封装保存函数，file和image_response.content是save_data的入参</span><br><span class="line">            thread_pool.submit(save_data, file, image_response.content)</span><br><span class="line">        # 关闭线程池    </span><br><span class="line">        thread_pool.shutdown()</span><br></pre></td></tr></table></figure><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8Bdoutula.png" alt="多线程doutula"></p><h2 id="guazi"><a href="#guazi" class="headerlink" title="guazi"></a>guazi</h2><p>同时执行多个线程的确可以提高程序效率，但并非线程越多越好，相对计算机而言，线程越多越吃资源，成百上千个线程可能直接瘫痪。故而多线程在运行时，设置最大线程锁，设置最大线程同时允许处理任务，多线程threading使用Semaphore(无上限)或BoundedSemaphore(初始设置最大值), 如果release调用检查计数器的值是否超过了计数器最大值则出ValueError 实现并发限制。</p><p>例如：通过semaphore信号量可以利用内置计数器来控制同时运行线程的数量，启动线程(消耗信号量)内置计数器会自动减一，线程结束(释放信号量)内置计数器会自动加一；内置计数器为零，启动线程会阻塞，直到有本线程结束或者其他线程结束为止;</p><p>以下我们对<a href="https://www.guazi.com/su/buy/o1" target="_blank" rel="noopener">瓜子二手车</a>数据进行多线程抓取，并保存到csv中。</p><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>当我们访问<a href="https://www.guazi.com/su/buy/o1" target="_blank" rel="noopener">第一页</a>时，<a href="https://www.guazi.com/su/buy/o1" target="_blank" rel="noopener">https://www.guazi.com/su/buy/o1</a></p><p>当我们访问<a href="https://www.guazi.com/su/buy/o2" target="_blank" rel="noopener">第二页</a>时，<a href="https://www.guazi.com/su/buy/o2" target="_blank" rel="noopener">https://www.guazi.com/su/buy/o2</a></p><p>以此类推，不难得出分页数据以<code>start_url = &#39;https://www.guazi.com/su/buy/o&#39;+str(i)</code>形式拼接，i为页码数，根据页面控制台的Elements分析所有的数据都存在于含有类<code>carlist clearfix js-top</code>的ul节点下的所有li节点下，我们可以通过解析得到html代码转化为bs4库的BeautifulSoup对象，利用BeautifulSoup的api获取这些li节点的元素属性，解析拿到类型，年份，里程，售价，具体BeautifulSoup语法出门右转见<a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/" target="_blank" rel="noopener">中文文档</a>。</p><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/guazi%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0.png" alt="guazi页面元素"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">def get_data(html):</span><br><span class="line">    # 将之前抓取的html页面解析生成BeautifulSoup对象</span><br><span class="line">    soup &#x3D; BeautifulSoup(html, &#39;html.parser&#39;)</span><br><span class="line">    # 调用api获取含有类carlist clearfix js-top的ul节点下的所有li节点</span><br><span class="line">    infos &#x3D; soup.find(&#39;ul&#39;, &#123;&#39;class&#39;: &#39;carlist clearfix js-top&#39;&#125;).find_all(&#39;li&#39;)</span><br><span class="line">    # 打开文件开始写入</span><br><span class="line">    with open(&#39;.&#x2F;guazi.csv&#39;, &#39;a&#39;, encoding&#x3D;&#39;utf-8&#39;) as f:</span><br><span class="line">        pic_urls &#x3D; []</span><br><span class="line">        for info in infos:</span><br><span class="line">            leixing &#x3D; info.find(&#39;h2&#39;).get_text()</span><br><span class="line">            nianfen1 &#x3D; info.find(&#39;div&#39;, &#123;&#39;class&#39;: &#39;t-i&#39;&#125;).get_text()</span><br><span class="line">            # 通过正则分割年份字符串</span><br><span class="line">            nianfen2 &#x3D; re.sub(r&#39;|&#39;, &#39;&#39;, nianfen1).split(&#39;|&#39;)</span><br><span class="line">            nianfen &#x3D; nianfen2[0]</span><br><span class="line">            licheng &#x3D; nianfen2[1]</span><br><span class="line">            didian &#x3D; &#39;苏州&#39;</span><br><span class="line">            shoujia &#x3D; info.find(&#39;div&#39;, &#123;&#39;class&#39;: &#39;t-price&#39;&#125;).find(&#39;p&#39;).get_text()</span><br><span class="line">            try:</span><br><span class="line">                yuanjia &#x3D; info.find(&#39;div&#39;, &#123;&#39;class&#39;: &#39;t-price&#39;&#125;).find(&#39;em&#39;).get_text()</span><br><span class="line">            except AttributeError:</span><br><span class="line">                yuanjia &#x3D; &#39;&#39;</span><br><span class="line">            tupian &#x3D; info.find(&#39;a&#39;).find(&#39;img&#39;)[&#39;src&#39;]</span><br><span class="line">            pic_urls.append(tupian)</span><br><span class="line">            f.write(&quot;&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;\n&quot;.format(leixing, nianfen, licheng, didian, shoujia, yuanjia))</span><br><span class="line">    return pic_urls</span><br></pre></td></tr></table></figure><p>get_data拿到所有的数据属性后，接下来通过含有信号量的多线程方式调用封装好的download_pics方法批量抓取图片。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 定义最多10个线程同时允许</span><br><span class="line">thread_lock &#x3D; threading.BoundedSemaphore(value&#x3D;10)</span><br><span class="line">def main():</span><br><span class="line">    n &#x3D; 0</span><br><span class="line">    for i in range(1,51):</span><br><span class="line">        start_url &#x3D; &#39;https:&#x2F;&#x2F;www.guazi.com&#x2F;su&#x2F;buy&#x2F;o&#39;+str(i)</span><br><span class="line">        html &#x3D; getHtmlText(start_url)</span><br><span class="line">        pic_urls &#x3D; get_data(html)</span><br><span class="line">        for url in pic_urls:</span><br><span class="line">            n+&#x3D;1</span><br><span class="line">            print(&#39;正在下载第&#123;&#125;张图片&#39;.format(n))</span><br><span class="line">            # 上锁 避免下载同一张</span><br><span class="line">            thread_lock.acquire()</span><br><span class="line">            t &#x3D; threading.Thread(target&#x3D;download_pics,args&#x3D;(url,n))</span><br></pre></td></tr></table></figure><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0/guazi%E5%A4%9A%E7%BA%BF%E7%A8%8B.png" alt="guazi多线程"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ThreadPoolExecutor </tag>
            
            <tag> BoundedSemaphore </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础篇之基本库的使用</title>
      <link href="2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="爬虫介绍"><a href="#爬虫介绍" class="headerlink" title="爬虫介绍"></a>爬虫介绍</h1><h2 id="爬虫目的"><a href="#爬虫目的" class="headerlink" title="爬虫目的"></a>爬虫目的</h2><ul><li>大数据时代所谓的人工智能都需要建立海量基础的数据上，一切一切的分析都是一数据为基础核心，那么对于企业来说，合理采集数据是既节省成本同时间也可以完成业务分析的捷径。</li><li>企业需要大量数据进行测试，对网站或app的负载，流量，服务器的CPU进行测试，采集数据是保证大数据量业务上线正常流转的必备前提。</li><li>所有搜索引擎的底层都是一个个的自动化爬虫，在海量的互联网信息中进行分析处理收录。</li><li>各大企业都希望自己的产品搜索靠前，对于SEO来说，除了充钱，足够了解爬虫可以从原理上实现搜索引擎的工作原理，实现SEO优化。</li><li>从技术层面来说，爬虫虽不是成体系型的一种技术栈，不过技术涉及领域极光，包括html解析，js逆向，安卓底层逆向，汇编分析，反爬虫与反反爬虫的对抗等等，其实以上也属于网络安全层的一个方向，文明爬虫，技术无罪。</li></ul><h2 id="什么是最好的语言"><a href="#什么是最好的语言" class="headerlink" title="什么是最好的语言"></a>什么是最好的语言</h2><p>当之无愧强类型语言Python，毋庸置疑，一来Python的三方库种类繁多且爬虫框架日新月异，请求与解析模块成熟，且拥有很多有趣的语法糖可以快速处理数据。相对于代码量臃肿的java来说语法简单，学习曲线短，因为java需要jvm虚拟机的编译成字节码的过程，对于爬虫来讲，Python免编译即可跨平台运行，且基于C++更接近底层，性能在一定程度上领超java，故优先选择python(别跟我提php)。</p><p>当然玩到最后语言只是一种实现方式而已，只是这些路都通往罗马，哪条在实际场景中更方便到达而已。比如：安卓逆向过程hook框架中，xposed和frida是我们的首选，两者各有优劣，视不同场景而定。</p><ul><li>Xposed是一个在andoid平台上比较成熟的hook框架，可以完美的在dalvik虚拟机上做到hook任意java方法，配置安装环境繁琐，兼容性差，无法对native层实现底层注入。</li><li>Frida是一个跨平台的hook框架，可以hook Java和native层，且不需要每次都重启手机，需要我们手动将java的语法转为frida的实现方式，无法像Xposed用于实践生产中。</li></ul><h2 id="爬虫路对抗现状"><a href="#爬虫路对抗现状" class="headerlink" title="爬虫路对抗现状"></a>爬虫路对抗现状</h2><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E7%88%AC%E8%99%AB%E5%AF%B9%E6%8A%97.png" alt="爬虫对抗"></p><p>这是一张老图，当然现在很多网站在请求头中实现了对selenium，phantomjs底层的api监控，总之，道高一尺魔高一丈，攻防之间，其乐无穷。</p><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>话不多说，直接开干。<strong>鲁迅曾经说过，他在爬虫生涯中超过一半的苦难均由Windows赐予</strong>，所以我建议还是用kali或者ubuntu吧，如果嫌麻烦，就退一步用centos吧，当然你用windows出现的问题需要自行google解决，基础篇目测应该不存在，用windows可以直接跳到doutula内容。</p><h2 id="服务器搭建"><a href="#服务器搭建" class="headerlink" title="服务器搭建"></a>服务器搭建</h2><p>这里就不聊kali或者ubuntu在虚拟机的搭建了，简单介绍一下使用vagrant创建centos虚拟机吧，</p><p>进入vagrant官网，<a href="https://releases.hashicorp.com/vagrant/2.2.14/vagrant_2.2.14_x86_64.msi" target="_blank" rel="noopener">vagrant</a>安装好后进入<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">镜像仓库</a>搜索需要安装的镜像。</p><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/vagrant%E4%BB%93%E5%BA%93.png" alt="vagrant仓库"></p><p><code>mkdir centos7 &amp;&amp; vagrant init centos/7 &amp;&amp; vagrant up &amp;&amp; vagrant ssh</code>  创建并开启镜像，自动生成Vagrantfile，默认网络nat，初始配置如下</p><blockquote><p><code>config.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.10&quot;</code>  配置NAT网络，选其一即可<br><code>config.vm.network &quot;public_network&quot;, ip: &quot;192.168.0.102&quot;</code>  配置桥接网络</p><p>yum list installed | grep openssh-server 确保安装了 openssh-server，否则yum install openssh-server</p><p> vi /etc/ssh/sshd_config  并注释<code>#PasswordAuthentication yes</code>,打开Port,ListenAddress,PermitRootLoin,PasswordAuthentication执行<code>service sshd restart</code> 实现远程连接</p></blockquote><p>安装<a href="https://npm.taobao.org/mirrors/node/v10.15.3/node-v10.15.3-x64.msi" target="_blank" rel="noopener">nodejs</a>并配置淘宝源<code>npm config set registry http://registry.npm.taobao.org/</code></p><h2 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h2><p>由于python2已经废弃维护，往后皆基于python3实战开发。进入python官网下载<a href="https://www.python.org/ftp/python/3.7.0/python-3.7.0-amd64.exe" target="_blank" rel="noopener">python 3.7.0</a>，或者通过清华大学源下载<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-5.3.1-Windows-x86_64.exe" target="_blank" rel="noopener">anaconda 5.3.1</a>会自动下载常用库。</p><p>为了避免不同项目间引用的依赖包冲突，我们将不同项目维护不同的环境。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget zlib-devel gcc bzip2-devel openssl-devel libffi-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel net-tools ftp vsftpd  安装常用包</span><br><span class="line">mkdir &#x2F;usr&#x2F;local&#x2F;python3  由于默认centos已经有了python2，避免环境冲突，配置多环境python3</span><br><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.7.0&#x2F;Python-3.7.0.tgz   下载python3的包</span><br><span class="line">tar zxf Python-3.7.0.tgz  解压</span><br><span class="line">cd Python-3.7.0&#x2F; &amp;&amp; .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python3  编译</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">vim &#x2F;etc&#x2F;profile   配置环境变量</span><br><span class="line">PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$JRE_HOME&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;</span><br><span class="line">export PATH</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;python3  配置软链接</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;python3&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;bin&#x2F;pip3</span><br></pre></td></tr></table></figure><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/python%E5%AE%89%E8%A3%85.png" alt="python安装"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade pip</span><br><span class="line">pip install virtualenvwrapper  安装虚拟环境</span><br><span class="line">vim ~&#x2F;.bashrc  配置环境变量</span><br><span class="line">VIRTUALENVWRAPPER_PYTHON&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">export WORKON_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;python3&#x2F;venv</span><br><span class="line">source ~&#x2F;.bashrc  编译</span><br><span class="line">mkvirtualenv --python&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3 baseSpider  指定python3创建名为baseSpider环境</span><br><span class="line">mkvirtualenv --python&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 baseSpider2 指定python2创建名为baseSpider2环境</span><br><span class="line">workon baseSpider  进入baseSpider环境</span><br><span class="line">deactivate 退出环境</span><br></pre></td></tr></table></figure><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.png" alt="多环境配置"></p><h2 id="doutula"><a href="#doutula" class="headerlink" title="doutula"></a>doutula</h2><p>这是一个表情包网站，本次就以本网站的最新表情页面作为案例。</p><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E6%9C%80%E6%96%B0%E8%A1%A8%E6%83%85.png" alt="最新表情"></p><p>ctrl+u获取网页源代码，发现本页面所有的表情包都以html表情直接显示在页面上，那么只需要使用requests库请求URL，parsel库来解析页面，通过xpath或者css选择器获取页面元素。</p><p>通过点击分页，该页面的url会跳转时添加page参数，从<code>https://www.doutula.com/photo/list/</code>变成<code>https://www.doutula.com/photo/list/?page=2</code>,重新向服务器发起请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">base_url &#x3D; &#39;https:&#x2F;&#x2F;www.doutula.com&#x2F;photo&#x2F;list&#x2F;&#39;</span><br><span class="line">response &#x3D; requests.get(url&#x3D;base_url)</span><br><span class="line">print(response.content)</span><br></pre></td></tr></table></figure><p>打印出来的结果是<code>b&#39;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;\r\n&lt;body bgcolor=&quot;white&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;\r\n&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n&#39;</code>,说明做了反爬，可能对请求头的参数做了校验。先尝试将User-Agent加入请求头中，再次发起请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">base_url &#x3D; &#39;https:&#x2F;&#x2F;www.doutula.com&#x2F;photo&#x2F;list&#x2F;?page&#x3D;&#123;&#125;&#39;.format(1)</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;85.0.4183.121 Safari&#x2F;537.36&#39;&#125;</span><br><span class="line">response &#x3D; requests.get(url&#x3D;base_url, headers&#x3D;headers)</span><br><span class="line">print(response.content)</span><br></pre></td></tr></table></figure><p>果然将页面内容完整打印出来，所有的图片地址也都明文显示在页面上。通过分析页面上的图片元素的dom节点，所有的图片节点都存在于类col-xs-6 col-sm-3的a标签下的img元素，通过xpath表达式可以取出这些元素下的属性，包括图片地址data-original，说明alt等。</p><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E8%A1%A8%E6%83%85%E5%8C%85dom%E5%88%86%E6%9E%90.png" alt="表情包dom分析"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">for page in range(1,3466):</span><br><span class="line">    print(&#39;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;正在爬去第&#123;&#125;页数据&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;.format(page))</span><br><span class="line">    base_url &#x3D; &#39;https:&#x2F;&#x2F;www.doutula.com&#x2F;photo&#x2F;list&#x2F;?page&#x3D;&#123;&#125;&#39;.format(page)</span><br><span class="line">    headers &#x3D; &#123;&#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;85.0.4183.121 Safari&#x2F;537.36&#39;&#125;</span><br><span class="line">    response &#x3D; requests.get(url&#x3D;base_url,headers&#x3D;headers)</span><br><span class="line">    html_data&#x3D;response.text</span><br><span class="line"></span><br><span class="line">    selector &#x3D; parsel.Selector(html_data)</span><br><span class="line">    result_list &#x3D; selector.xpath(&#39;&#x2F;&#x2F;a[@class&#x3D;&quot;col-xs-6 col-sm-3&quot;]&#39;)</span><br><span class="line">    for result in result_list:</span><br><span class="line">        img_url &#x3D; result.xpath(&#39;.&#x2F;img&#x2F;@data-original&#39;).extract_first()</span><br><span class="line">        img_title &#x3D; result.xpath(&#39;.&#x2F;img&#x2F;@alt&#39;).extract_first()</span><br><span class="line">        print(img_url+&quot;---&quot;+img_title)</span><br></pre></td></tr></table></figure><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E8%A1%A8%E6%83%85%E5%8C%85%E6%8A%93%E5%8F%96%E7%BB%93%E6%9E%9C%E6%89%93%E5%8D%B0.png" alt="表情包抓取结果打印"></p><p>接下来在通过IO流将图片存储到本地完成基础图片爬取。</p><p><img src="/2021/03/28/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/%E8%A1%A8%E6%83%85%E5%8C%85%E6%8A%93%E5%8F%96.png" alt="表情包抓取"></p><p><strong>完整源码请关注微信公众号：ReverseCode，回复：爬虫基础</strong></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> requests </tag>
            
            <tag> parsel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加壳与脱壳之二代壳函数抽取</title>
      <link href="2021/03/25/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%BA%8C%E4%BB%A3%E5%A3%B3%E5%87%BD%E6%95%B0%E6%8A%BD%E5%8F%96/"/>
      <url>2021/03/25/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%BA%8C%E4%BB%A3%E5%A3%B3%E5%87%BD%E6%95%B0%E6%8A%BD%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<p>函数抽取宣告一代壳整体保护的结束，由此进入二代壳的时代。</p><h1 id="Dalvik"><a href="#Dalvik" class="headerlink" title="Dalvik"></a>Dalvik</h1><ul><li><p><a href="https://blog.csdn.net/m0_46204016/article/details/104579974?spm=1001.2014.3001.5501" target="_blank" rel="noopener">Android中实现「类方法指令抽取方式」加固方案原理解析</a>：对dex结构简单介绍，定位函数指令地址，实现函数抽取壳的demo，对getPwd函数进行指令抽取，类被加载时重填恢复指令。</p></li><li><p><a href="https://blog.csdn.net/m0_46204016/article/details/104579953" target="_blank" rel="noopener">Android免Root权限通过Hook系统函数修改程序运行时内存指令逻辑</a>：为了修改原有系统对dex加载流程，需要hook系统某些关键函数，自然可以在原有函数逻辑中添加需要自定义的逻辑功能，再添加一些保护函数的填充。</p></li></ul><h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>实现函数抽取壳需要保证对函数恢复的时机肯定早于函数被调用的时机，即当函数被调用时指令流必须已经被修复了，否则app逻辑被破坏导致app崩了。再选择时机，<a href="https://blog.csdn.net/m0_46204016/article/details/104579974?spm=1001.2014.3001.5501" target="_blank" rel="noopener">Android中实现「类方法指令抽取方式」加固方案原理解析</a>中选择了dexFindClass函数。。</p><p>对于函数来说在被调用之前，首先dex加载(dexclassloader动态加载)，对类加载需要经过装载-链接-初始化，在这些加载过程中有非常多的时机供我们选择，Dalvik源代码编译生成的libdvm.so通过ida打开，搜索文中的<strong>dexFindClass</strong>函数，获取导出的函数名可实现函数抽取。loadClass加载一个dex中的类的流程:DexClassLoader-&gt;BaseDexClassLoader-&gt;ClassLoader的loadClass,完整体现了双亲委派的特性。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">486    protected Class&lt;?&gt; loadClass(String className, boolean resolve) throws ClassNotFoundException &#123;   &#x2F;&#x2F; 为了提高加载类效率，如果已经加载直接返回，否则进行双亲委派的父节点加载</span><br><span class="line">487        Class&lt;?&gt; clazz &#x3D; findLoadedClass(className);</span><br><span class="line">488</span><br><span class="line">489        if (clazz &#x3D;&#x3D; null) &#123;</span><br><span class="line">490            try &#123;</span><br><span class="line">491                clazz &#x3D; parent.loadClass(className, false);</span><br><span class="line">492            &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">493                &#x2F;&#x2F; Don&#39;t want to see this.</span><br><span class="line">494            &#125;</span><br><span class="line">495</span><br><span class="line">496            if (clazz &#x3D;&#x3D; null) &#123;</span><br><span class="line">497                clazz &#x3D; findClass(className);</span><br><span class="line">498            &#125;</span><br><span class="line">499        &#125;</span><br><span class="line">500</span><br><span class="line">501        return clazz;</span><br><span class="line">502    &#125;</span><br></pre></td></tr></table></figure><p>对于使用DexClassLoader第一次加载类的parent节点是pathClassLoader或被指定的bootClassLoader,因为类只由当前的classloader加载必然是找不到的，因此进入BaseDexClassLoader的<strong>findClass</strong>实现中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">52    protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;</span><br><span class="line">53        List&lt;Throwable&gt; suppressedExceptions &#x3D; new ArrayList&lt;Throwable&gt;();</span><br><span class="line">54        Class c &#x3D; pathList.findClass(name, suppressedExceptions);</span><br><span class="line">55        if (c &#x3D;&#x3D; null) &#123;</span><br><span class="line">56            ClassNotFoundException cnfe &#x3D; new ClassNotFoundException(&quot;Didn&#39;t find class \&quot;&quot; + name + &quot;\&quot; on path: &quot; + pathList);</span><br><span class="line">57            for (Throwable t : suppressedExceptions) &#123;</span><br><span class="line">58                cnfe.addSuppressed(t);</span><br><span class="line">59            &#125;</span><br><span class="line">60            throw cnfe;</span><br><span class="line">61        &#125;</span><br><span class="line">62        return c;</span><br><span class="line">63    &#125;</span><br></pre></td></tr></table></figure><p>紧接着进入pathList.findClass，其中pathList是在<a href="http://androidxref.com/4.4.4_r1/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java#45" target="_blank" rel="noopener">BaseDexClassLoader</a>构造函数中实例化化，跟着进入<a href="http://androidxref.com/4.4.4_r1/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#317" target="_blank" rel="noopener">pathList.findClass</a>，调用了dex.loadClassBinaryName查找类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">317    public Class findClass(String name, List&lt;Throwable&gt; suppressed) &#123;</span><br><span class="line">318        for (Element element : dexElements) &#123;</span><br><span class="line">319            DexFile dex &#x3D; element.dexFile;</span><br><span class="line">320</span><br><span class="line">321            if (dex !&#x3D; null) &#123;</span><br><span class="line">                   &#x2F;&#x2F; 尝试从每个dex中遍历找到类所在的dex中并返回类所在dex</span><br><span class="line">322                Class clazz &#x3D; dex.loadClassBinaryName(name, definingContext, suppressed); </span><br><span class="line">323                if (clazz !&#x3D; null) &#123;</span><br><span class="line">324                    return clazz;</span><br><span class="line">325                &#125;</span><br><span class="line">326            &#125;</span><br><span class="line">327        &#125;</span><br><span class="line">328        if (dexElementsSuppressedExceptions !&#x3D; null) &#123;</span><br><span class="line">329            suppressed.addAll(Arrays.asList(dexElementsSuppressedExceptions));</span><br><span class="line">330        &#125;</span><br><span class="line">331        return null;</span><br><span class="line">332    &#125;</span><br></pre></td></tr></table></figure><p>跟着进入<a href="http://androidxref.com/4.4.4_r1/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#214" target="_blank" rel="noopener">loadClassBinaryName</a>,其中调用了native层实现defineClassNative</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">214    public Class loadClassBinaryName(String name, ClassLoader loader, List&lt;Throwable&gt; suppressed) &#123;</span><br><span class="line">215        return defineClass(name, loader, mCookie, suppressed);</span><br><span class="line">216    &#125;</span><br><span class="line">217</span><br><span class="line">218    private static Class defineClass(String name, ClassLoader loader, int cookie,</span><br><span class="line">219                                     List&lt;Throwable&gt; suppressed) &#123;</span><br><span class="line">220        Class result &#x3D; null;</span><br><span class="line">221        try &#123;</span><br><span class="line">222            result &#x3D; defineClassNative(name, loader, cookie);</span><br><span class="line">223        &#125; catch (NoClassDefFoundError e) &#123;</span><br><span class="line">224            if (suppressed !&#x3D; null) &#123;</span><br><span class="line">225                suppressed.add(e);</span><br><span class="line">226            &#125;</span><br><span class="line">227        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">228            if (suppressed !&#x3D; null) &#123;</span><br><span class="line">229                suppressed.add(e);</span><br><span class="line">230            &#125;</span><br><span class="line">231        &#125;</span><br><span class="line">232        return result;</span><br><span class="line">233    &#125;</span><br></pre></td></tr></table></figure><p>dalvik下Full Search搜索defineClassNative，进入/<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/" target="_blank" rel="noopener">vm</a>/<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/native/" target="_blank" rel="noopener">native</a>/<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/native/dalvik_system_DexFile.cpp" target="_blank" rel="noopener">dalvik_system_DexFile.cpp</a>的<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/native/dalvik_system_DexFile.cpp#349" target="_blank" rel="noopener">Dalvik_dalvik_system_DexFile_defineClassNative</a>方法，如注释中所说从一个dex文件中加载一个类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">349static void Dalvik_dalvik_system_DexFile_defineClassNative(const u4* args,</span><br><span class="line">350    JValue* pResult)</span><br><span class="line">351&#123;</span><br><span class="line">352    StringObject* nameObj &#x3D; (StringObject*) args[0]; &#x2F;&#x2F; 类名</span><br><span class="line">353    Object* loader &#x3D; (Object*) args[1];  &#x2F;&#x2F; classloader</span><br><span class="line">354    int cookie &#x3D; args[2];  &#x2F;&#x2F; java层cookie</span><br><span class="line">355    ClassObject* clazz &#x3D; NULL;</span><br><span class="line">356    DexOrJar* pDexOrJar &#x3D; (DexOrJar*) cookie;  &#x2F;&#x2F; 将int型cookie转为DexOrJar指针</span><br><span class="line">357    DvmDex* pDvmDex;</span><br><span class="line">358    char* name;</span><br><span class="line">359    char* descriptor;</span><br><span class="line">360</span><br><span class="line">361    name &#x3D; dvmCreateCstrFromString(nameObj);</span><br><span class="line">362    descriptor &#x3D; dvmDotToDescriptor(name);</span><br><span class="line">363    ALOGV(&quot;--- Explicit class load &#39;%s&#39; l&#x3D;%p c&#x3D;0x%08x&quot;,</span><br><span class="line">364        descriptor, loader, cookie);</span><br><span class="line">365    free(name);</span><br><span class="line">366</span><br><span class="line">367    if (!validateCookie(cookie))</span><br><span class="line">368        RETURN_VOID();</span><br><span class="line">369</span><br><span class="line">370    if (pDexOrJar-&gt;isDex)</span><br><span class="line">371        pDvmDex &#x3D; dvmGetRawDexFileDex(pDexOrJar-&gt;pRawDexFile);</span><br><span class="line">372    else</span><br><span class="line">373        pDvmDex &#x3D; dvmGetJarFileDex(pDexOrJar-&gt;pJarFile);</span><br><span class="line">374</span><br><span class="line">375    &#x2F;* once we load something, we can&#39;t unmap the storage *&#x2F;</span><br><span class="line">376    pDexOrJar-&gt;okayToFree &#x3D; false;</span><br><span class="line">377</span><br><span class="line">378    clazz &#x3D; dvmDefineClass(pDvmDex, descriptor, loader);</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/RawDexFile.h#62" target="_blank" rel="noopener">dvmGetRawDexFileDex</a>，只是取出指针中的pDvmDex</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">62INLINE DvmDex* dvmGetRawDexFileDex(RawDexFile* pRawDexFile) &#123;</span><br><span class="line">63    return pRawDexFile-&gt;pDvmDex;</span><br><span class="line">64&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/oo/Class.cpp#1413" target="_blank" rel="noopener">dvmDefineClass</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1413ClassObject* dvmDefineClass(DvmDex* pDvmDex, const char* descriptor,</span><br><span class="line">1414    Object* classLoader)</span><br><span class="line">1415&#123;</span><br><span class="line">1416    assert(pDvmDex !&#x3D; NULL);</span><br><span class="line">1417</span><br><span class="line">1418    return findClassNoInit(descriptor, classLoader, pDvmDex);</span><br><span class="line">1419&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/4.4.4_r1/xref/dalvik/vm/oo/Class.cpp#findClassNoInit" target="_blank" rel="noopener">findClassNoInit</a>，首先调用了<code>clazz = dvmLookupClass(descriptor, loader, true);</code>对当前加载的类名进行计算查询，如没有则返回为空，对于第一次加载必然是没有的，接着进入<code>pClassDef = dexFindClass(pDvmDex-&gt;pDexFile, descriptor);</code>，即<a href="https://blog.csdn.net/m0_46204016/article/details/104579974?spm=1001.2014.3001.5501" target="_blank" rel="noopener">Android中实现「类方法指令抽取方式」加固方案原理解析</a>中选择的时机点，并通过hook掉类被加载时的时机，对抽取函数的恢复，实现函数还原，因此必然需要早于函数执行的时机，保证app正常运行。由于有些函数符号没有导出，就不是很容易进行hook，而在libdvm.so中的dexFindClass在IDA中是被导出的，方便hook。以上就是Dalvik下函数抽取壳的简单原理。</p><h1 id="ART"><a href="#ART" class="headerlink" title="ART"></a>ART</h1><p>Art下实现难点：dex2oat编译流程，dex2oat是可以进行脱壳，对抽取的dex进行编译生成了oat文件，后续的函数运行中，从oat中取出函数编译生成的二进制代码来执行，自然从dex2oat后那么我们动态修改的dex中的smali指令流就不会生效。因此如果希望填充回去smali指令生效要么禁用dex2oat实现阻止编译，这样对加载到内存中的dex文件进行填充始终会保持生效，要么保持dex2oat编译，但是还原代码时机要早于dex2oat就ok了，保证dex2oat再次对dex编译的时候，dex已经是一个完整dex，不会影响我们填充的代码，但是肯定dex文件存在完整的时候，可以利用dex2oat编译的流程进行脱壳，一般都是牺牲掉app一部分的运行效率，干掉dex2oat的过程，因为google本身提倡dex2oat就是为了提升app运行效率。</p><h2 id="禁用dex2oat编译"><a href="#禁用dex2oat编译" class="headerlink" title="禁用dex2oat编译"></a>禁用dex2oat编译</h2><p>回到ART下DexClassLoader动态加载dex的流程，在art下搜索<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.cc#616" target="_blank" rel="noopener">GenerateOatFileNoChecks</a>，该函数完成调用dex2oat进行编译</p><p><img src="/2021/03/25/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%BA%8C%E4%BB%A3%E5%A3%B3%E5%87%BD%E6%95%B0%E6%8A%BD%E5%8F%96/%E6%90%9C%E7%B4%A2GenerateOatFileNoChecks.png" alt="搜索GenerateOatFileNoChecks"></p><p>GenerateOatFileNoChecks中调用<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.cc#Dex2Oat" target="_blank" rel="noopener">Dex2Oat</a>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">616OatFileAssistant::ResultOfAttemptToUpdate OatFileAssistant::GenerateOatFileNoChecks(</span><br><span class="line">617      OatFileAssistant::OatFileInfo&amp; info, CompilerFilter::Filter filter, std::string* error_msg) &#123;</span><br></pre></td></tr></table></figure><p><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.cc#Dex2Oat" target="_blank" rel="noopener">Dex2Oat</a>最终调用<code>return Exec(argv, error_msg);</code>，<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/exec_utils.cc#91" target="_blank" rel="noopener">Exec</a>中调用了<code>int status = ExecAndReturnCode(arg_vector, error_msg);</code>,其中<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/exec_utils.cc#34" target="_blank" rel="noopener">ExecAndReturnCode</a>通过<code>pid_t pid = fork();</code>进行fork一个子进程，在子进程中调用了<code>execve(program, &amp;args[0], envp);</code>完成对dex2oat这个二进制程序的调用。整个流程中任意一个环节被打断，dex2oat将会被干掉，无法继续运行。</p><p><a href="https://github.com/asLody/TurboDex" target="_blank" rel="noopener">TurboDex</a>就是干掉dex2oat为了让dex在第一次动态加载时快速加载完成，因为不干掉dex2oat，art虚拟机就会调用dex2oat对当前的dex进行编译，编译过程非常耗时，可以很大地提升dexclassloader加载dex 的效率，该项目就是通过hook了execv方法实现。</p><blockquote><p>众所周知,Android中在Runtime加载一个 <strong>未优化的Dex文件</strong> (尤其在 <strong>ART 模式</strong>)需要花费 <strong>很长的时间</strong>. 当你在App中使用 <strong>插件化框架</strong> 的时候, 首次加载插件就需要耗费很长的时间.</p><p>TurboDex 就是为了解决这一问题而生, 就像是给AndroidVM开启了上帝模式, 在引入TurboDex后, 无论你加载了多大的Dex文件,都可以在毫秒级别内完成.</p></blockquote><p>接下来通过hook execve实现干掉dex2oat，可以通过爱奇艺xhook的GOT进行表hook干掉dex2oat，也可以用inline库hook。</p><p>36：00</p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
          <category> 加壳与脱壳 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> classloader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加壳与脱壳之一代壳dex保护</title>
      <link href="2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/"/>
      <url>2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="Dalvik"><a href="#Dalvik" class="headerlink" title="Dalvik"></a>Dalvik</h1><h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>虽然加壳技术有所不同，第一步依然是dump内存中dex，虽然安卓4.4后Dalvik淡出视野，但是影响深远。Dalvik系统DexClassLoader加载dex具体流程：</p><p><a href="http://androidxref.com/4.4_r1/search?q=&defs=DexClassLoader&refs=&path=&hist=&project=libcore" target="_blank" rel="noopener">搜索DexClassLoader源码</a>只有一个构造函数</p><p>dexPath：需要加载的dex路径</p><p>optimizedDirectory：dex优化过程中产生的odex的存放路径</p><p>libraryPath：当前classloader需要加载so的路径</p><p>parent：双亲委派中的当前dexclassloader的父节点设置的classloader</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public DexClassLoader(String dexPath, String optimizedDirectory,</span><br><span class="line">        String libraryPath, ClassLoader parent) &#123;</span><br><span class="line">    super(dexPath, new File(optimizedDirectory), libraryPath, parent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入父类<a href="http://androidxref.com/4.4_r1/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java" target="_blank" rel="noopener">BaseDexClassLoader</a>封装大量的函数，真正逻辑存在BaseDexClassLoader的构造函数中实现，调用了父类的构造函数，该类存在与<a href="http://androidxref.com/4.4_r1/xref/libcore/libart/src/main/java/java/lang/" target="_blank" rel="noopener">/libcore/libart</a>和<a href="http://androidxref.com/4.4_r1/xref/libcore/libdvm/src/main/java/java/lang/" target="_blank" rel="noopener">/libcore/libdvm</a>，说明在安卓4.4中已经开始引入art相关逻辑。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public BaseDexClassLoader(String dexPath, File optimizedDirectory,</span><br><span class="line">        String libraryPath, ClassLoader parent) &#123;</span><br><span class="line">    super(parent);</span><br><span class="line">    this.pathList &#x3D; new DexPathList(this, dexPath, libraryPath, optimizedDirectory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入Dalvik的<a href="http://androidxref.com/4.4_r1/xref/libcore/libdvm/src/main/java/java/lang/ClassLoader.java" target="_blank" rel="noopener">ClassLoader</a>的构造函数，将当前的ClassLoader的父节点作为传入的parent。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader(ClassLoader parentLoader, boolean nullAllowed) &#123;</span><br><span class="line">    if (parentLoader &#x3D;&#x3D; null &amp;&amp; !nullAllowed) &#123;</span><br><span class="line">        throw new NullPointerException(&quot;parentLoader &#x3D;&#x3D; null &amp;&amp; !nullAllowed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    parent &#x3D; parentLoader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>new DexPathList再初始化pathList实例，进入DexPathList构造函数，前面对参数校验，真正起作用<code>this.dexElements = makeDexElements(splitDexPath(dexPath), optimizedDirectory,suppressedExceptions);</code>,<strong>makeDexElements</strong>方法调用了loadDexFile返回的dex添加到element数组并返回数组。</p><p>loadDexFile中再度调用了DexFile.loadDex(file.getPath(), optimizedPath, 0)，该方法新建了一个DexFile对象，<code>return new DexFile(sourcePathName, outputPathName, flags);</code>，在Dexfile中调用了<code>openDexFile(sourceName, outputName, flags)</code>完成了对dex的处理，openDexFile中调用了openDexFileNative，其中又调用<code>openDexFileNative(new File(sourceName).getCanonicalPath(),(outputName == null) ? null : new File(outputName).getCanonicalPath(),flags);</code>,跟进openDexFileNative发现是一个使用c/c++实现的native函数，<code>native private static int openDexFileNative</code>。该方法处理类<a href="http://androidxref.com/4.4_r1/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java" target="_blank" rel="noopener">/libcore/dalvik/src/main/java/dalvik/system/DexFile.java</a>中，对应的实现文件就是<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/native/dalvik_system_DexFile.cpp" target="_blank" rel="noopener">dalvik_system_DexFile</a>查看方法Dalvik_dalvik_system_DexFile_openDexFileNative，其中调用了<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/RawDexFile.cpp#109" target="_blank" rel="noopener">dvmRawDexFileOpen</a>实现对dex文件的打开。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (hasDexExtension(sourceName)</span><br><span class="line">        &amp;&amp; dvmRawDexFileOpen(sourceName, outputName, &amp;pRawDexFile, false) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">    ALOGV(&quot;Opening DEX file &#39;%s&#39; (DEX)&quot;, sourceName);</span><br><span class="line"></span><br><span class="line">    pDexOrJar &#x3D; (DexOrJar*) malloc(sizeof(DexOrJar));</span><br><span class="line">    pDexOrJar-&gt;isDex &#x3D; true;</span><br><span class="line">    pDexOrJar-&gt;pRawDexFile &#x3D; pRawDexFile;</span><br><span class="line">    pDexOrJar-&gt;pDexMemory &#x3D; NULL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/RawDexFile.cpp#109" target="_blank" rel="noopener">dvmRawDexFileOpen</a>中<code>dexFd = open(fileName, O_RDONLY);</code>打开dex文件，<code>verifyMagicAndGetAdler32(dexFd, &amp;adler32) &lt; 0</code>对dex魔术字校验，<code>cachedName = dexOptGenerateCacheFileName(fileName, NULL);</code>生成优化后的odex文件路径，<code>dvmOptimizeDexFile(optFd, dexOffset, fileSize,fileName, modTime, adler32, isBootstrap);</code>优化当前的dex，跟进发现存在于<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/DexPrepare.cpp" target="_blank" rel="noopener">DexPrepare.cpp</a>中的<code>dvmOptimizeDexFile(int fd, off_t dexOffset, long dexLength,const char* fileName, u4 modWhen, u4 crc, bool isBootstrap)</code>,该方法中<code>pid = fork();</code>新建了子进程用于调用<a href="/bin/dexopt">/bin/dexopt</a>对当前dex文件进行优化，结果生成odex文件。bin/dexopt的main方法中传入的文件校验是dex时，调用<code>static int fromDex(int argc, char* const argv[])</code>首先调用dvmPrepForDexOpt对当前优化环境准备，再调用dvmContinueOptimization对当前的fd文件进行优化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dexLength &lt; (int) sizeof(DexHeader)  字节长度判断</span><br><span class="line">mapAddr &#x3D; mmap(NULL, dexOffset + dexLength, PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0);  mmap对当前dex文件的内容进行内存映射</span><br><span class="line">rewriteDex(((u1*) mapAddr) + dexOffset, dexLength, doVerify, doOpt, &amp;pClassLookup, NULL);  重写dex</span><br></pre></td></tr></table></figure><p>查看<code>static bool rewriteDex(u1* addr, int len, bool doVerify, bool doOpt,DexClassLookup** ppClassLookup, DvmDex** ppDvmDex)</code>方法参数有加载到内存中dex的起始地址，字节数。该方法中暴露出在Dalvik中脱壳点的相关函数，<a href="http://androidxref.com/4.4_r1/s?defs=dvmDexFileOpenPartial&project=dalvik" target="_blank" rel="noopener">dvmDexFileOpenPartial</a>函数中出现<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexFile.cpp#289" target="_blank" rel="noopener">dexFileParse</a>，参数包含起始地址和字节数。</p><p>以上即是dexclassloader在动态加载dex时Dalvik实现的逻辑处理，很多时机点都出现了加载的dex的起始地址，就是最好的脱壳时机。很多脱壳方法都是对**<a href="http://androidxref.com/4.4_r1/s?defs=dvmDexFileOpenPartial&project=dalvik" target="_blank" rel="noopener">dvmDexFileOpenPartial</a><strong>和</strong><a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexFile.cpp#289" target="_blank" rel="noopener">dexFileParse</a><strong>进行下断点或者进行hook，取出第一个参数(起始地址)和第二个参数(dex长度)，其实在</strong>mmap<strong>对dex内存映射时包含dex文件，对当前映射区域进行dump也可以脱下从文件形式加载dex，在</strong>rewriteDex**时也出现了dex文件加载的起始地址和大小，自然也是可以进行dump等等。通过Cydia、xposed、frida都可以对实现对关键时机的hook，取出前两个参数，拿到起始地址和长度，dump下来内存区域即可实现脱壳。</p><h2 id="定制源码脱壳"><a href="#定制源码脱壳" class="headerlink" title="定制源码脱壳"></a>定制源码脱壳</h2><p>对新的一些加壳厂商的产品依然有效，除非厂商对这些函数进行hook修改，或者参考Dalvik修改实现自己的逻辑。进入Ubuntu 1604x64_4.4的编译环境虚拟机，tom/admin，4.4的源码为hammerhead。通过编译源码的方式实现以下为部分脱壳点：</p><h3 id="dvmDexFileOpenPartial"><a href="#dvmDexFileOpenPartial" class="headerlink" title="dvmDexFileOpenPartial"></a><strong><a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/DvmDex.cpp#146" target="_blank" rel="noopener">dvmDexFileOpenPartial</a></strong></h3><p>搜索 <a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/DvmDex.cpp#146" target="_blank" rel="noopener"><strong>dvmDexFileOpenPartial</strong></a> 发现在/<a href="http://androidxref.com/4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/" target="_blank" rel="noopener">vm</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/DvmDex.cpp" target="_blank" rel="noopener">DvmDex.cpp</a>文件中，使用Geany打开 ~/SourceCode/android-4.4.4_r1/dalvik/vm/DvmDex.cpp，找到dvmDexFileOpenPartial方法，只需要保存起始地址和大小即可。</p><p>修改int dvmDexFileOpenPartial(const void* addr, int len, DvmDex** ppDvmDex)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys&#x2F;stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">&#x2F;&#x2F;新建保存路径用于拼接脱壳app产生的dex路径，对每个脱壳的app的脱下的dex单独起名</span><br><span class="line">char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line">&#x2F;&#x2F;当前进程的pid</span><br><span class="line">int pid&#x3D;getpid();</span><br><span class="line">&#x2F;&#x2F;文件路径拼接(文件大小，进程pid)</span><br><span class="line">sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_dvmDexFileOpenPartial.dex&quot;,len,pid);</span><br><span class="line">&#x2F;&#x2F;写入sdcard保存的dex,很多壳对抗内存dump将fopen等方法hook，可以使用系统调用当中的写入，避免使用标准的文件写入函数导致dump不下来</span><br><span class="line">int fd &#x3D; open(dexfilepath,O_CREAT|O_RDWR,0666);</span><br><span class="line">if(fd&gt;0)&#123;</span><br><span class="line">    write(fd,addr,len);</span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/dvmDexFileOpenPartial%E8%84%B1%E5%A3%B3%E7%82%B9.png" alt="dvmDexFileOpenPartial脱壳点"></p><h3 id="dexFileParse"><a href="#dexFileParse" class="headerlink" title="dexFileParse"></a><strong><a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexFile.cpp#289" target="_blank" rel="noopener">dexFileParse</a></strong></h3><p>搜索**<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexFile.cpp#289" target="_blank" rel="noopener">dexFileParse</a>**发现存在/<a href="http://androidxref.com/4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/" target="_blank" rel="noopener">libdex</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexFile.cpp" target="_blank" rel="noopener">DexFile.cpp</a>中，使用geany编辑器打开DexFile.cpp</p><p>修改DexFile* dexFileParse(const u1* data, size_t length, int flags)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys&#x2F;stat.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">&#x2F;&#x2F;新建保存路径用于拼接脱壳app产生的dex路径，对每个脱壳的app的脱下的dex单独起名</span><br><span class="line">char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line">&#x2F;&#x2F;当前进程的pid</span><br><span class="line">int pid&#x3D;getpid();</span><br><span class="line">&#x2F;&#x2F;文件路径拼接(文件大小，进程pid)</span><br><span class="line">sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_dvmFileParse.dex&quot;,length,pid);</span><br><span class="line">&#x2F;&#x2F;写入sdcard保存的dex,很多壳对抗内存dump将fopen等方法hook，可以使用系统调用当中的写入，避免使用标准的文件写入函数导致dump不下来</span><br><span class="line">int fd &#x3D; open(dexfilepath,O_CREAT|O_RDWR,0666);</span><br><span class="line">if(fd&gt;0)&#123;</span><br><span class="line">    write(fd,data,length);</span><br><span class="line">    close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/dexFileParse%E8%84%B1%E5%A3%B3%E7%82%B9.png" alt="dexFileParse脱壳点"></p><h3 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h3><p>搜索 mmap 存在于/<a href="http://androidxref.com/4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/" target="_blank" rel="noopener">vm</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/" target="_blank" rel="noopener">analysis</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/DexPrepare.cpp" target="_blank" rel="noopener">DexPrepare.cpp</a>的中，</p><p>修改bool dvmContinueOptimization(int fd, off_t dexOffset, long dexLength, const char* fileName, u4 modWhen, u4 crc, bool isBootstrap)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line">&#x2F;&#x2F;当前进程的pid</span><br><span class="line">int pid&#x3D;getpid();</span><br><span class="line">&#x2F;&#x2F;文件路径拼接(文件大小，进程pid)</span><br><span class="line">sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_dvmContinueOptimization.dex&quot;,dexLength,pid);</span><br><span class="line">&#x2F;&#x2F;写入sdcard保存的dex,很多壳对抗内存dump将fopen等方法hook，可以使用系统调用当中的写入，避免使用标准的文件写入函数导致dump不下来</span><br><span class="line">int fd &#x3D; open(dexfilepath,O_CREAT|O_RDWR,0666);</span><br><span class="line">if(fd&gt;0)&#123;</span><br><span class="line">write(fd,mapAddr,dexOffset + dexLength);</span><br><span class="line">close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/mmap.png" alt="mmap "></p><p>第一次映射到内存中需要将dex通过010Editor修正，删除64 65 78 0A前的字符。</p><h3 id="rewriteDex"><a href="#rewriteDex" class="headerlink" title="rewriteDex"></a><a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/DexPrepare.cpp#rewriteDex" target="_blank" rel="noopener">rewriteDex</a></h3><p>搜索<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/DexPrepare.cpp#rewriteDex" target="_blank" rel="noopener">rewriteDex</a>位于/<a href="http://androidxref.com/4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/" target="_blank" rel="noopener">vm</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/" target="_blank" rel="noopener">analysis</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/vm/analysis/DexPrepare.cpp" target="_blank" rel="noopener">DexPrepare.cpp</a>，</p><p>修改static bool rewriteDex(u1* addr, int len, bool doVerify, bool doOpt, DexClassLookup** ppClassLookup, DvmDex** ppDvmDex)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line">&#x2F;&#x2F;当前进程的pid</span><br><span class="line">int pid&#x3D;getpid();</span><br><span class="line">&#x2F;&#x2F;文件路径拼接(文件大小，进程pid)</span><br><span class="line">sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_rewriteDex.dex&quot;,len,pid);</span><br><span class="line">&#x2F;&#x2F;写入sdcard保存的dex,很多壳对抗内存dump将fopen等方法hook，可以使用系统调用当中的写入，避免使用标准的文件写入函数导致dump不下来</span><br><span class="line">int fd &#x3D; open(dexfilepath,O_CREAT|O_RDWR,0666);</span><br><span class="line">if(fd&gt;0)&#123;</span><br><span class="line">write(fd,addr,len);</span><br><span class="line">close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/rewriteDex.png" alt="rewriteDex"></p><h3 id="dexSwapVerify"><a href="#dexSwapVerify" class="headerlink" title="dexSwapVerify"></a><a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexSwapVerify.cpp#2829" target="_blank" rel="noopener">dexSwapVerify</a></h3><p>搜索<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexSwapVerify.cpp#2829" target="_blank" rel="noopener">dexSwapVerify</a>存在于/<a href="http://androidxref.com/4.4_r1/xref/dalvik/" target="_blank" rel="noopener">dalvik</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/" target="_blank" rel="noopener">libdex</a>/<a href="http://androidxref.com/4.4_r1/xref/dalvik/libdex/DexSwapVerify.cpp" target="_blank" rel="noopener">DexSwapVerify.cpp</a></p><p>修改int dexSwapAndVerify(u1* addr, int len)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line">&#x2F;&#x2F;当前进程的pid</span><br><span class="line">int pid&#x3D;getpid();</span><br><span class="line">&#x2F;&#x2F;文件路径拼接(文件大小，进程pid)</span><br><span class="line">sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_dexSwapAndVerify.dex&quot;,len,pid);</span><br><span class="line">&#x2F;&#x2F;写入sdcard保存的dex,很多壳对抗内存dump将fopen等方法hook，可以使用系统调用当中的写入，避免使用标准的文件写入函数导致dump不下来</span><br><span class="line">int fd &#x3D; open(dexfilepath,O_CREAT|O_RDWR,0666);</span><br><span class="line">if(fd&gt;0)&#123;</span><br><span class="line">write(fd,addr,len);</span><br><span class="line">close(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/dexSwapVerify.png" alt="dexSwapVerify"></p><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a><strong>编译</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;SourceCode&#x2F;android-4.4.4_r1$ source build&#x2F;envsetup.sh</span><br><span class="line">~&#x2F;SourceCode&#x2F;android-4.4.4_r1$ lunch</span><br><span class="line">7  选择aosp_hammerhead-userdebug</span><br><span class="line">~&#x2F;SourceCode&#x2F;android-4.4.4_r1$ time make -j4  如果报错直接make单线程编译</span><br></pre></td></tr></table></figure><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81.png" alt="编译源码"></p><p>生成路径~/SourceCode/android/4.4.4_r1/out/target/product/hammerhead，将boot.img,cache.img,ramdisk.img,system.img,userdata.img拷出来</p><blockquote><p>adb reboot bootloader</p><p>fastboot flash system system.img  常用的img有boot,cache,ramdisk,system,userdata</p></blockquote><p>安装<a href="https://onejane.github.io/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/#LoadDex">LoadDex.apk</a>，并把ClassLoaderTest生成的classes.dex放入/sdcard。在Activity启动的时候加载/sdcard的classes.dex的TestActivity并打印<code>I&#39;m from TestActivity.onCreate</code>，这就是一代壳的基本原理。</p><p>重启系统后/sdcard中已经出现一些系统中脱下的dex，启动LoadDex，<code>grep -ril &quot;TestActivity&quot; ./*.dex</code> 找到LoadDex中脱下的dex，gda可以看到优化后的odex的TestActivity中onCreate方法</p><h2 id="真实案例"><a href="#真实案例" class="headerlink" title="真实案例"></a>真实案例</h2><p><strong>a.apk</strong> 《百度》加固</p><p>启动后进入/sdcard , grep -ril “SplashActivity” ./*.dex</p><p><strong>b.apk</strong> 《爱加密》企业版本加固</p><p>启动后进入/sdcard , grep -ril “mvp/ui/SplashActivity” ./*.dex，内容都为null，说明用了函数抽取。</p><h1 id="ART"><a href="#ART" class="headerlink" title="ART"></a>ART</h1><h2 id="InMemoryDexClassLoader源码分析"><a href="#InMemoryDexClassLoader源码分析" class="headerlink" title="InMemoryDexClassLoader源码分析"></a>InMemoryDexClassLoader源码分析</h2><p>加载内存中的解密字节流过程art的具体流程：</p><p>在<a href="http://androidxref.com/8.0.0_r4/" target="_blank" rel="noopener">Android 8.0</a>中libcore搜索<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/InMemoryDexClassLoader.java" target="_blank" rel="noopener">InMemoryDexClassLoader</a>两个构造函数，分别加载一个或多个dex，<code>super(dexBuffers, parent);</code>调用了父类的构造函数。进入父类<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java" target="_blank" rel="noopener">BaseDexClassLoader.java</a>的构造函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">82</span>    <span class="function"><span class="keyword">public</span> <span class="title">BaseDexClassLoader</span><span class="params">(ByteBuffer[] dexFiles, ClassLoader parent)</span> </span>&#123;</span><br><span class="line"><span class="number">83</span>        <span class="comment">// TODO We should support giving this a library search path maybe.</span></span><br><span class="line">          <span class="comment">// 设置parent</span></span><br><span class="line"><span class="number">84</span>        <span class="keyword">super</span>(parent);</span><br><span class="line">          <span class="comment">// 初始化DexPathList对象</span></span><br><span class="line"><span class="number">85</span>        <span class="keyword">this</span>.pathList = <span class="keyword">new</span> DexPathList(<span class="keyword">this</span>, dexFiles);</span><br><span class="line"><span class="number">86</span>    &#125;</span><br></pre></td></tr></table></figure><p>跟进public <a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#makeInMemoryDexElements" target="_blank" rel="noopener">DexPathList</a>(ClassLoader definingContext, ByteBuffer[] dexFiles)构造函数，前几步对传参判断，紧接着对传入的so库的处理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this.definingContext &#x3D; definingContext;</span><br><span class="line">&#x2F;&#x2F; TODO It might be useful to let in-memory dex-paths have native libraries.</span><br><span class="line">this.nativeLibraryDirectories &#x3D; Collections.emptyList();</span><br><span class="line">this.systemNativeLibraryDirectories &#x3D;</span><br><span class="line">         splitPaths(System.getProperty(&quot;java.library.path&quot;), true);</span><br><span class="line">this.nativeLibraryPathElements &#x3D; makePathElements(this.systemNativeLibraryDirectories);</span><br></pre></td></tr></table></figure><p>传入的dex只需要看<code>this.dexElements = makeInMemoryDexElements(dexFiles, suppressedExceptions);</code>摘除核心代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static Element[] makeInMemoryDexElements(ByteBuffer[] dexFiles,</span><br><span class="line">        List&lt;IOException&gt; suppressedExceptions) &#123;</span><br><span class="line">    Element[] elements &#x3D; new Element[dexFiles.length];</span><br><span class="line">    int elementPos &#x3D; 0;</span><br><span class="line">    for (ByteBuffer buf : dexFiles) &#123;</span><br><span class="line">        DexFile dex &#x3D; new DexFile(buf);</span><br><span class="line">        elements[elementPos++] &#x3D; new Element(dex);</span><br><span class="line">    &#125;</span><br><span class="line">    return elements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#106" target="_blank" rel="noopener">DexFile</a>(buf)的构造函数中，发现将buf在内存中打开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DexFile(ByteBuffer buf) throws IOException &#123;</span><br><span class="line">    mCookie &#x3D; openInMemoryDexFile(buf);</span><br><span class="line">    mInternalCookie &#x3D; mCookie;</span><br><span class="line">    mFileName &#x3D; null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#openInMemoryDexFile" target="_blank" rel="noopener">openInMemoryDexFile</a>方法，分别根据条件创建了两次cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private static Object openInMemoryDexFile(ByteBuffer buf) throws IOException &#123;</span><br><span class="line">    if (buf.isDirect()) &#123;</span><br><span class="line">        return createCookieWithDirectBuffer(buf, buf.position(), buf.limit());</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return createCookieWithArray(buf.array(), buf.position(), buf.limit());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分别查看createCookieWithDirectBuffer和createCookieWithArray两个方法，发现是两个native函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private static native Object createCookieWithDirectBuffer(ByteBuffer buf, int start, int end);</span><br><span class="line">private static native Object createCookieWithArray(byte[] buf, int start, int end);</span><br></pre></td></tr></table></figure><p>在art模块中Full Search <code>createCookieWithDirectBuffer</code>,进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#218" target="_blank" rel="noopener">DexFile_createCookieWithDirectBuffer</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">static jobject DexFile_createCookieWithDirectBuffer(JNIEnv* env,</span><br><span class="line">                                                    jclass,  &#x2F;&#x2F; 静态函数 第一个是jclass当前类</span><br><span class="line">                                                    jobject buffer,  &#x2F;&#x2F; 传入内存中的字节流</span><br><span class="line">                                                    jint start,</span><br><span class="line">                                                    jint end) &#123;</span><br><span class="line">  uint8_t* base_address &#x3D; reinterpret_cast&lt;uint8_t*&gt;(env-&gt;GetDirectBufferAddress(buffer));</span><br><span class="line">  if (base_address &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">    ScopedObjectAccess soa(env);</span><br><span class="line">    ThrowWrappedIOException(&quot;dexFileBuffer not direct&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::unique_ptr&lt;MemMap&gt; dex_mem_map(AllocateDexMemoryMap(env, start, end));</span><br><span class="line">  if (dex_mem_map &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">    DCHECK(Thread::Current()-&gt;IsExceptionPending());</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  size_t length &#x3D; static_cast&lt;size_t&gt;(end - start);</span><br><span class="line">  memcpy(dex_mem_map-&gt;Begin(), base_address, length);  &#x2F;&#x2F; 对当前字节流进行内存拷贝memcpy，传入begin和length就是dex的起始地址，可以进行dump</span><br><span class="line">  return CreateSingleDexFileCookie(env, std::move(dex_mem_map));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>createCookieWithDirectBuffer和createCookieWithArray都进行了<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#CreateSingleDexFileCookie" target="_blank" rel="noopener">CreateSingleDexFileCookie</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static jobject CreateSingleDexFileCookie(JNIEnv* env, std::unique_ptr&lt;MemMap&gt; data) &#123;</span><br><span class="line">  std::unique_ptr&lt;const DexFile&gt; dex_file(CreateDexFile(env, std::move(data))); &#x2F;&#x2F; 根据传入dex文件在内存中信息创建了DexFile实例</span><br><span class="line">  if (dex_file.get() &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">    DCHECK(env-&gt;ExceptionCheck());</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">  std::vector&lt;std::unique_ptr&lt;const DexFile&gt;&gt; dex_files;</span><br><span class="line">  dex_files.push_back(std::move(dex_file));</span><br><span class="line">  return ConvertDexFilesToJavaArray(env, nullptr, dex_files);  &#x2F;&#x2F; 对该dex_files进行返回</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#CreateDexFile" target="_blank" rel="noopener">CreateDexFile</a>创建DexFile对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">static const DexFile* CreateDexFile(JNIEnv* env, std::unique_ptr&lt;MemMap&gt; dex_mem_map) &#123; &#x2F;&#x2F; 返回dex文件在内存中映射的地址</span><br><span class="line">  std::string location &#x3D; StringPrintf(&quot;Anonymous-DexFile@%p-%p&quot;,</span><br><span class="line">                                      dex_mem_map-&gt;Begin(),</span><br><span class="line">                                      dex_mem_map-&gt;End());</span><br><span class="line">  std::string error_message;</span><br><span class="line">  std::unique_ptr&lt;const DexFile&gt; dex_file(DexFile::Open(location,</span><br><span class="line">                                                        0,</span><br><span class="line">                                                        std::move(dex_mem_map),</span><br><span class="line">                                                        &#x2F;* verify *&#x2F; true,</span><br><span class="line">                                                        &#x2F;* verify_location *&#x2F; true,</span><br><span class="line">                                                        &amp;error_message));</span><br><span class="line">  if (dex_file &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">    ScopedObjectAccess soa(env);</span><br><span class="line">    ThrowWrappedIOException(&quot;%s&quot;, error_message.c_str());</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!dex_file-&gt;DisableWrite()) &#123;</span><br><span class="line">    ScopedObjectAccess soa(env);</span><br><span class="line">    ThrowWrappedIOException(&quot;Failed to make dex file read-only&quot;);</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return dex_file.release();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#182" target="_blank" rel="noopener">DexFile::Open</a>，其中又调用了OpenCommon函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;const DexFile&gt; DexFile::Open(const std::string&amp; location,</span><br><span class="line">                                           uint32_t location_checksum,</span><br><span class="line">                                           std::unique_ptr&lt;MemMap&gt; map,</span><br><span class="line">                                           bool verify,</span><br><span class="line">                                           bool verify_checksum,</span><br><span class="line">                                           std::string* error_msg) &#123;</span><br><span class="line">  ScopedTrace trace(std::string(&quot;Open dex file from mapped-memory &quot;) + location);</span><br><span class="line">  CHECK(map.get() !&#x3D; nullptr);</span><br><span class="line"></span><br><span class="line">  if (map-&gt;Size() &lt; sizeof(DexFile::Header)) &#123;</span><br><span class="line">    *error_msg &#x3D; StringPrintf(</span><br><span class="line">        &quot;DexFile: failed to open dex file &#39;%s&#39; that is too short to have a header&quot;,</span><br><span class="line">        location.c_str());</span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">  std::unique_ptr&lt;DexFile&gt; dex_file &#x3D; OpenCommon(map-&gt;Begin(),</span><br><span class="line">                                                 map-&gt;Size(),</span><br><span class="line">                                                 location,</span><br><span class="line">                                                 location_checksum,</span><br><span class="line">                                                 kNoOatDexFile,</span><br><span class="line">                                                 verify,</span><br><span class="line">                                                 verify_checksum,</span><br><span class="line">                                                 error_msg);</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenCommon" target="_blank" rel="noopener">OpenCommon</a>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;DexFile&gt; DexFile::OpenCommon(const uint8_t* base,</span><br><span class="line">                                             size_t size,</span><br><span class="line">                                             const std::string&amp; location,</span><br><span class="line">                                             uint32_t location_checksum,</span><br><span class="line">                                             const OatDexFile* oat_dex_file,</span><br><span class="line">                                             bool verify,</span><br><span class="line">                                             bool verify_checksum,</span><br><span class="line">                                             std::string* error_msg,</span><br><span class="line">                                             VerifyResult* verify_result) &#123;</span><br><span class="line">  if (verify_result !&#x3D; nullptr) &#123;</span><br><span class="line">    *verify_result &#x3D; VerifyResult::kVerifyNotAttempted;</span><br><span class="line">  &#125;</span><br><span class="line">  std::unique_ptr&lt;DexFile&gt; dex_file(new DexFile(base,</span><br><span class="line">                                                size,</span><br><span class="line">                                                location,</span><br><span class="line">                                                location_checksum,</span><br><span class="line">                                                oat_dex_file));  &#x2F;&#x2F; 创建新的DexFile实例，构造函数也包含起始地址和大小</span><br></pre></td></tr></table></figure><p>说明InMemoryDexClassLoader在对内存中bytebuffer的dex信息进行加载流程中涉及很多函数逻辑都包含dex信息的起始地址和大小。InMemoryDexClassLoader并没有对内存中dex信息进行编译生成相应的oat文件，这是与DexClassLoader的不同。</p><p>通用脱壳点：</p><ul><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#CreateSingleDexFileCookie" target="_blank" rel="noopener">CreateSingleDexFileCookie</a>的data参数可以获取起始地址</li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#CreateDexFile" target="_blank" rel="noopener">CreateDexFile</a></li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#182" target="_blank" rel="noopener">DexFile::Open</a></li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenCommon" target="_blank" rel="noopener">OpenCommon</a></li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#523" target="_blank" rel="noopener">DexFile::DexFile</a></li></ul><h2 id="DexClassLoader加载dex源码分析"><a href="#DexClassLoader加载dex源码分析" class="headerlink" title="DexClassLoader加载dex源码分析"></a>DexClassLoader加载dex源码分析</h2><p><a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexClassLoader.java" target="_blank" rel="noopener">DexClassLoader</a>只有一个构造函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public DexClassLoader(String dexPath, String optimizedDirectory,</span><br><span class="line">        String librarySearchPath, ClassLoader parent) &#123;</span><br><span class="line">    super(dexPath, new File(optimizedDirectory), librarySearchPath, parent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入父类<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/BaseDexClassLoader.java" target="_blank" rel="noopener">BaseDexClassLoader.java</a>的构造函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public BaseDexClassLoader(String dexPath, File optimizedDirectory,</span><br><span class="line">        String librarySearchPath, ClassLoader parent) &#123;</span><br><span class="line">    super(parent);</span><br><span class="line">    this.pathList &#x3D; new DexPathList(this, dexPath, librarySearchPath, null);</span><br><span class="line"></span><br><span class="line">    if (reporter !&#x3D; null) &#123;</span><br><span class="line">        reporter.report(this.pathList.getDexPaths());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同样的进入<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#127" target="_blank" rel="noopener">DexPathList</a>的核心逻辑<code>this.dexElements = makeDexElements(splitDexPath(dexPath), optimizedDirectory,suppressedExceptions, definingContext);</code>,调用了<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#makeDexElements" target="_blank" rel="noopener">makeDexElements</a>，其中加载dex文件<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexPathList.java#loadDexFile" target="_blank" rel="noopener">loadDexFile</a>(file, optimizedDirectory, loader, elements);</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static DexFile loadDexFile(File file, File optimizedDirectory, ClassLoader loader,</span><br><span class="line">                                   Element[] elements)</span><br><span class="line">        throws IOException &#123;</span><br><span class="line">    if (optimizedDirectory &#x3D;&#x3D; null) &#123;</span><br><span class="line">        return new DexFile(file, loader, elements);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        String optimizedPath &#x3D; optimizedPathFor(file, optimizedDirectory);</span><br><span class="line">        return DexFile.loadDex(file.getPath(), optimizedPath, 0, loader, elements);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>DexFile.loadDex(file.getPath(), optimizedPath, 0, loader, elements)</code>调用了5个参数的loadDex,进入<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#191" target="_blank" rel="noopener">loadDex</a>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static DexFile loadDex(String sourcePathName, String outputPathName,</span><br><span class="line">    int flags, ClassLoader loader, DexPathList.Element[] elements) throws IOException &#123;</span><br><span class="line">    return new DexFile(sourcePathName, outputPathName, flags, loader, elements);  &#x2F;&#x2F; 创建DexFile实例</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#99" target="_blank" rel="noopener">DexFile</a>五参数构造函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DexFile(String fileName, ClassLoader loader, DexPathList.Element[] elements) throws IOException &#123;</span><br><span class="line">    mCookie &#x3D; openDexFile(fileName, null, 0, loader, elements);</span><br><span class="line">    mInternalCookie &#x3D; mCookie;</span><br><span class="line">    mFileName &#x3D; fileName;</span><br><span class="line">    &#x2F;&#x2F;System.out.println(&quot;DEX FILE cookie is &quot; + mCookie + &quot; fileName&#x3D;&quot; + fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/libcore/dalvik/src/main/java/dalvik/system/DexFile.java#openDexFile" target="_blank" rel="noopener">openDexFile</a>中调用了native函数<code>private static native Object openDexFileNative(String sourceName, String outputName, int flags, ClassLoader loader, DexPathList.Element[] elements);</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">return openDexFileNative(new File(sourceName).getAbsolutePath(),</span><br><span class="line">                                (outputName &#x3D;&#x3D; null)</span><br><span class="line">                                    ? null</span><br><span class="line">                                    : new File(outputName).getAbsolutePath(),</span><br><span class="line">                                flags,</span><br><span class="line">                                loader,</span><br><span class="line">                                elements);</span><br></pre></td></tr></table></figure><p><a href="http://androidxref.com/8.0.0_r4/search?q=openDexFileNative&defs=&refs=&path=&hist=&project=art" target="_blank" rel="noopener">Full  Search</a>搜索art目录下的<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#258" target="_blank" rel="noopener">openDexFileNative</a>，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">static jobject DexFile_openDexFileNative(JNIEnv* env,</span><br><span class="line">                                         jclass,  &#x2F;&#x2F; 静态函数</span><br><span class="line">                                         jstring javaSourceName,  &#x2F;&#x2F; 加载的dex路径</span><br><span class="line">                                         jstring javaOutputName ATTRIBUTE_UNUSED,</span><br><span class="line">                                         jint flags ATTRIBUTE_UNUSED,</span><br><span class="line">                                         jobject class_loader,</span><br><span class="line">                                         jobjectArray dex_elements) &#123;</span><br><span class="line">  ScopedUtfChars sourceName(env, javaSourceName);</span><br><span class="line">  if (sourceName.c_str() &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Runtime* const runtime &#x3D; Runtime::Current();</span><br><span class="line">  ClassLinker* linker &#x3D; runtime-&gt;GetClassLinker();</span><br><span class="line">  std::vector&lt;std::unique_ptr&lt;const DexFile&gt;&gt; dex_files;</span><br><span class="line">  std::vector&lt;std::string&gt; error_msgs; </span><br><span class="line">  const OatFile* oat_file &#x3D; nullptr;  &#x2F;&#x2F; 出现oat</span><br><span class="line"></span><br><span class="line">  dex_files &#x3D; runtime-&gt;GetOatFileManager().OpenDexFilesFromOat(sourceName.c_str(),</span><br><span class="line">                                                               class_loader,</span><br><span class="line">                                                               dex_elements,</span><br><span class="line">                                                               &#x2F;*out*&#x2F; &amp;oat_file,</span><br><span class="line">                                                               &#x2F;*out*&#x2F; &amp;error_msgs); &#x2F;&#x2F; 调用OpenDexFilesFromOat编译生成oat流程</span><br><span class="line"></span><br><span class="line">  if (!dex_files.empty()) &#123;</span><br><span class="line">    jlongArray array &#x3D; ConvertDexFilesToJavaArray(env, oat_file, dex_files);</span><br><span class="line">    if (array &#x3D;&#x3D; nullptr) &#123;</span><br><span class="line">      ScopedObjectAccess soa(env);</span><br><span class="line">      for (auto&amp; dex_file : dex_files) &#123;</span><br><span class="line">        if (linker-&gt;IsDexFileRegistered(soa.Self(), *dex_file)) &#123;</span><br><span class="line">          dex_file.release();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return array;</span><br><span class="line">  &#125; </span><br><span class="line">    return nullptr;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DexClassLoader第一次动态加载解密的dex时必然没有进行编译生成oat，查看<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_manager.cc#602" target="_blank" rel="noopener">OpenDexFilesFromOat</a>,首先<code>OatFileAssistant oat_file_assistant(dex_location,kRuntimeISA,!runtime-&gt;IsAotCompiler());</code>新建了OatFileAssistant 对象，<code>if (!oat_file_assistant.IsUpToDate())</code>由于没有生成oat对象的，进入判断中的<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.cc#224" target="_blank" rel="noopener">MakeUpToDate</a>函数，其中调用了<code>return GenerateOatFileNoChecks(info, target, error_msg);</code><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.cc#GenerateOatFileNoChecks" target="_blank" rel="noopener">GenerateOatFileNoChecks</a>最终进入调用dex2oat编译生成oat的流程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (!Dex2Oat(args, error_msg)) &#123;</span><br><span class="line">  &#x2F;&#x2F; Manually delete the oat and vdex files. This ensures there is no garbage</span><br><span class="line">  &#x2F;&#x2F; left over if the process unexpectedly died.</span><br><span class="line">  vdex_file-&gt;Erase();</span><br><span class="line">  unlink(vdex_file_name.c_str());</span><br><span class="line">  oat_file-&gt;Erase();</span><br><span class="line">  unlink(oat_file_name.c_str());</span><br><span class="line">  return kUpdateFailed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>中准备相关二进制程序参数的相关信息，最终调用<code>return Exec(argv, error_msg);</code>实现dex2oat编译的过程，进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/exec_utils.cc#91" target="_blank" rel="noopener">Exec</a>中调用了<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/exec_utils.cc#ExecAndReturnCode" target="_blank" rel="noopener">ExecAndReturnCode</a>，首次进行了进程fork，在子进程当中使用<code>execve(program, &amp;args[0], envp);</code>执行dex2oat实际执行流程。</p><p>说明我们在整个流程中其中某个函数进行修改或者hook都会导致dex2oat流程结束，强制结束dex2oat流程，可以让我们在DexClassLoader在加载dex时过程变的很有效率，减少dex2oat编译的流程，要想实现art下的函数抽取技术，也是要阻断dex2oat的流程。当我们阻断了dex2oat会导致<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#258" target="_blank" rel="noopener">openDexFileNative</a>中 <a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/native/dalvik_system_DexFile.cc#276" target="_blank" rel="noopener">dex_files</a> 文件无法生成，在调用<code>runtime-&gt;GetOatFileManager().OpenDexFilesFromOat</code>中进入尝试判断原始dex文件<code>oat_file_assistant.HasOriginalDexFiles()</code>并通过<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#212" target="_blank" rel="noopener">DexFile::Open</a>进行加载dex</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if (dex_files.empty()) &#123;</span><br><span class="line">  if (oat_file_assistant.HasOriginalDexFiles()) &#123;</span><br><span class="line">    if (Runtime::Current()-&gt;IsDexFileFallbackEnabled()) &#123;</span><br><span class="line">      static constexpr bool kVerifyChecksum &#x3D; true;</span><br><span class="line">      if (!DexFile::Open(</span><br><span class="line">          dex_location, dex_location, kVerifyChecksum, &#x2F;*out*&#x2F; &amp;error_msg, &amp;dex_files)) &#123;</span><br><span class="line">        LOG(WARNING) &lt;&lt; error_msg;</span><br><span class="line">        error_msgs-&gt;push_back(&quot;Failed to open dex files from &quot; + std::string(dex_location)</span><br><span class="line">                              + &quot; because: &quot; + error_msg);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      error_msgs-&gt;push_back(&quot;Fallback mode disabled, skipping dex files.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    error_msgs-&gt;push_back(&quot;No original dex files found for dex location &quot;</span><br><span class="line">        + std::string(dex_location));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#212" target="_blank" rel="noopener">DexFile::Open</a>中可看到<code>File fd = OpenAndReadMagic(filename, &amp;magic, error_msg);</code>到此出现了第一个脱壳点<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/base/file_magic.cc#33" target="_blank" rel="noopener">OpenAndReadMagic</a>，此时dex还未加载到内存当中。紧接着开始判断dex魔术头，并进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenFile" target="_blank" rel="noopener">DexFile::OpenFile</a>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (IsDexMagic(magic)) &#123;</span><br><span class="line">  std::unique_ptr&lt;const DexFile&gt; dex_file(DexFile::OpenFile(fd.Release(),  &#x2F;&#x2F; 文件描述符，可以作为脱壳点</span><br><span class="line">                                                            location,</span><br><span class="line">                                                            &#x2F;* verify *&#x2F; true,</span><br><span class="line">                                                            verify_checksum,</span><br><span class="line">                                                            error_msg));</span><br><span class="line">  if (dex_file.get() !&#x3D; nullptr) &#123;</span><br><span class="line">    dex_files-&gt;push_back(std::move(dex_file));</span><br><span class="line">    return true;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenFile" target="_blank" rel="noopener">DexFile::OpenFile</a>函数发现通过MemMap::MapFile将dex进行了内存映射</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">map.reset(MemMap::MapFile(length,</span><br><span class="line">                          PROT_READ,</span><br><span class="line">                          MAP_PRIVATE,</span><br><span class="line">                          fd,</span><br><span class="line">                          0,</span><br><span class="line">                          &#x2F;*low_4gb*&#x2F;false,</span><br><span class="line">                          location.c_str(),</span><br><span class="line">                          error_msg));</span><br></pre></td></tr></table></figure><p>再进入<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenCommon" target="_blank" rel="noopener">OpenCommon</a>函数中，参数中也包含了dex文件的映射区域的起始地址，出现了第二个脱壳点。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;DexFile&gt; dex_file &#x3D; OpenCommon(map-&gt;Begin(),</span><br><span class="line">                                               map-&gt;Size(),</span><br><span class="line">                                               location,</span><br><span class="line">                                               dex_header-&gt;checksum_,</span><br><span class="line">                                               kNoOatDexFile,</span><br><span class="line">                                               verify,</span><br><span class="line">                                               verify_checksum,</span><br><span class="line">                                               error_msg);</span><br></pre></td></tr></table></figure><p>跟进<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenCommon" target="_blank" rel="noopener">DexFile::OpenCommon</a>中，发现其中调用了DexFile的构造函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;DexFile&gt; dex_file(new DexFile(base,</span><br><span class="line">                                              size,</span><br><span class="line">                                              location,</span><br><span class="line">                                              location_checksum,</span><br><span class="line">                                              oat_dex_file));</span><br></pre></td></tr></table></figure><p>至此出现了第三个脱壳点<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#523" target="_blank" rel="noopener">DexFile::DexFile</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DexFile::DexFile(const uint8_t* base,</span><br><span class="line">                 size_t size,</span><br><span class="line">                 const std::string&amp; location,</span><br><span class="line">                 uint32_t location_checksum,</span><br><span class="line">                 const OatDexFile* oat_dex_file)</span><br></pre></td></tr></table></figure><p>通用脱壳点：</p><ul><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/base/file_magic.cc#33" target="_blank" rel="noopener">OpenAndReadMagic</a></li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#OpenCommon" target="_blank" rel="noopener">OpenCommon</a></li><li><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#523" target="_blank" rel="noopener">DexFile::DexFile</a></li></ul><p>通过对比：InMemoryDexClassLoader和DexClassLoader的脱壳点，发现OpenCommon是两者通用脱壳点。</p><h2 id="定制源码脱壳-1"><a href="#定制源码脱壳-1" class="headerlink" title="定制源码脱壳"></a>定制源码脱壳</h2><h3 id="DexFile-OpenCommon"><a href="#DexFile-OpenCommon" class="headerlink" title="DexFile::OpenCommon"></a><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#480" target="_blank" rel="noopener">DexFile::OpenCommon</a></h3><p>修改/<a href="http://androidxref.com/8.0.0_r4/xref/art/" target="_blank" rel="noopener">art</a>/<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/" target="_blank" rel="noopener">runtime</a>/<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc" target="_blank" rel="noopener">dex_file.cc</a>中<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#480" target="_blank" rel="noopener">DexFile::OpenCommon</a>方法</p><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/openCommon.png" alt="openCommon"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> int pid&#x3D;getpid();</span><br><span class="line"> char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line"> sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_OpenCommon.dex&quot;,(int)size,pid);</span><br><span class="line"> </span><br><span class="line"> int fd&#x3D;open(dexfilepath,O_CREAT|O_RDWR,666);</span><br><span class="line"> if (fd&gt;0)&#123;</span><br><span class="line">int number&#x3D;write(fd,base,size);</span><br><span class="line">if(number&gt;0)&#123;&#125;</span><br><span class="line">close(fd);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="DexFile-DexFile"><a href="#DexFile-DexFile" class="headerlink" title="DexFile::DexFile"></a><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#523" target="_blank" rel="noopener">DexFile::DexFile</a></h3><p>修改/<a href="http://androidxref.com/8.0.0_r4/xref/art/" target="_blank" rel="noopener">art</a>/<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/" target="_blank" rel="noopener">runtime</a>/<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc" target="_blank" rel="noopener">dex_file.cc</a>中<a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/dex_file.cc#523" target="_blank" rel="noopener">DexFile::DexFile</a>方法</p><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/DexFile.png" alt="DexFile"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> int pid&#x3D;getpid();</span><br><span class="line"> char dexfilepath[100]&#x3D;&#123;0&#125;;</span><br><span class="line"> sprintf(dexfilepath,&quot;&#x2F;sdcard&#x2F;%d_%d_DexFile.dex&quot;,(int)size,pid);</span><br><span class="line"> </span><br><span class="line"> int fd&#x3D;open(dexfilepath,O_CREAT|O_RDWR,666);</span><br><span class="line"> if (fd&gt;0)&#123;</span><br><span class="line">int number&#x3D;write(fd,base,size);</span><br><span class="line">if(number&gt;0)&#123;&#125;</span><br><span class="line">close(fd);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="编译-1"><a href="#编译-1" class="headerlink" title="编译"></a>编译</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;Android8.0&#x2F;android-8.0.0_r1$ source build&#x2F;envsetup.sh</span><br><span class="line">~&#x2F;Android8.0&#x2F;android-8.0.0_r1$ lunch</span><br><span class="line">23  选择aosp_sailfish-userdebug</span><br><span class="line">~&#x2F;Android8.0&#x2F;android-8.0.0_r1$ time make -j4  如果报错直接make单线程编译</span><br></pre></td></tr></table></figure><p>生成路径~/Android8.0/android-8.0.0_r1/out/target/product/sailfish，将boot.img,ramdisk.img,system.img,system_other.img,userdata.img,vendor.img拷出来</p><p>安装<a href="https://onejane.github.io/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/#LoadDex">LoadDex.apk</a>，并把ClassLoaderTest生成的classes.dex放入/sdcard。并在设置中授予该app读写sdcard的权限。在Activity启动的时候加载/sdcard的classes.dex的TestActivity并打印<code>I&#39;m from TestActivity.onCreate</code>，这就是一代壳的基本原理。</p><p>重启系统后/sdcard中已经出现一些系统中脱下的dex，启动LoadDex，<code>grep -ril &quot;TestActivity&quot; ./*.dex</code> 找到LoadDex中脱下的dex，DexClassLoader加载的插件dex已经被dump下来，gda可以看到优化后的odex的TestActivity中onCreate方法。</p><h2 id="真实案例-1"><a href="#真实案例-1" class="headerlink" title="真实案例"></a>真实案例</h2><p><strong>a.apk</strong> 《百度》加固</p><p>启动后进入/sdcard , grep -ril “SplashActivity” ./*.dex</p><p><strong>b.apk</strong> 《爱加密》企业版本加固</p><p>启动后进入/sdcard , grep -ril “mvp/ui/SplashActivity” ./*.dex，内容都为null，说明用了函数抽取，这就是需要fart解决的问题。</p><blockquote><p><a href="http://androidxref.com/8.0.0_r4/xref/art/runtime/exec_utils.cc#ExecAndReturnCode" target="_blank" rel="noopener">ExecAndReturnCode</a>中调用<code>execve(program, &amp;args[0], envp);</code>,<a href="http://androidxref.com/8.0.0_r4/xref/art/dex2oat/dex2oat.cc" target="_blank" rel="noopener">dex2oat</a>流程也可以脱壳,<a href="http://androidxref.com/8.0.0_r4/xref/art/dex2oat/dex2oat.cc#2965" target="_blank" rel="noopener">main</a>函数中调用<code>int result = static_cast&lt;int&gt;(art::Dex2oat(argc, argv));</code>,跟进<a href="http://androidxref.com/8.0.0_r4/xref/art/dex2oat/dex2oat.cc#2943" target="_blank" rel="noopener">Setup()</a>方法最后会出现对要编译dex文件的处理，<a href="http://androidxref.com/8.0.0_r4/xref/art/dex2oat/dex2oat.cc#CompileApp" target="_blank" rel="noopener">CompileApp</a>也出现了DexFile对象等等非常多的流程出现Dexfile对象，都可以成为脱壳点</p></blockquote><p><img src="/2021/03/16/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E4%B8%80%E4%BB%A3%E5%A3%B3dex%E4%BF%9D%E6%8A%A4/dex2oat.png" alt="dex2oat"></p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
          <category> 加壳与脱壳 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dalvik </tag>
            
            <tag> ART </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Socket&amp;Websocket&amp;Protobuf自吐通杀</title>
      <link href="2021/03/14/Socket&amp;Websocket&amp;Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/"/>
      <url>2021/03/14/Socket&amp;Websocket&amp;Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><p>所有的应用层都逃不掉底层用Socket来传输,只要掌握了Socket，对上层应用就是降维打击。</p><p>新建HttpSocket项目，并在AndroidManifest.xml配置网络权限<code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                while (true)&#123;</span><br><span class="line">                    newHttp();</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(10*1000);</span><br><span class="line">                    &#125; catch (InterruptedException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void newHttp()&#123;</span><br><span class="line">        new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    String url &#x3D; &quot;https:&#x2F;&#x2F;www.baidu.com&quot;;</span><br><span class="line">                    URL urlConn &#x3D; new URL(url);</span><br><span class="line">                    HttpURLConnection connection &#x3D; (HttpURLConnection)urlConn.openConnection();</span><br><span class="line">                    connection.setRequestMethod(&quot;GET&quot;);</span><br><span class="line">                    connection.connect();</span><br><span class="line">                    int responseCode &#x3D; connection.getResponseCode();</span><br><span class="line">                    if (responseCode &#x3D;&#x3D; HttpURLConnection.HTTP_OK) &#123;</span><br><span class="line">                        InputStream inputStream &#x3D; connection.getInputStream();</span><br><span class="line">                        String result &#x3D; is2String(inputStream);</span><br><span class="line">                        Log.d(&quot;onejane&quot;,&quot;result&#x3D;&#x3D;&#x3D;&#x3D;&quot;+result);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125; catch (Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static String is2String(InputStream inputStream) throws IOException &#123;</span><br><span class="line">        byte[] buffer &#x3D; new byte[1024];</span><br><span class="line">        ByteArrayOutputStream baos &#x3D; new ByteArrayOutputStream();</span><br><span class="line">        for (int len &#x3D; 0; (len &#x3D; inputStream.read(buffer)) &gt; 0;) &#123;</span><br><span class="line">            baos.write(buffer, 0, len);</span><br><span class="line">        &#125;</span><br><span class="line">        String result &#x3D; new String(baos.toByteArray(), &quot;utf-8&quot;);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        return result ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="关键类定位"><a href="#关键类定位" class="headerlink" title="关键类定位"></a>关键类定位</h2><p>objection -g com.onejane.httpsocket explore</p><p>android heap search instances java.net.Socket  查看堆内存中是否有该实例</p><p>android hooking search classes Socket  搜索与Socket相关的类</p><p>android hooking watch class java.net.Socket  默认hook类的所有方法没有构造函数</p><p>android hooking watch class_method java.net.Socket.$init –dump-args –dump-backtrace –dump-return  手动调用hook构造函数</p><p>vim ~/.pyenv/versions/3.8.0/lib/python3.8/site-packages/objection/agent.js  输入:9211跳转到9211行，加上.concat([“$init”])，会影响objection的稳定性</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/hook%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0.png" alt="hook构造函数"></p><p>将与Socket相关的类添加前缀<code>android hooking watch class</code>存入socket.txt</p><p>objection -g com.onejane.httpsocket explore -c ~/Desktop/socket.txt  批量hook，如果崩掉，需要将崩掉的类从文本中移除</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/%E5%B4%A9%E6%8E%89%E7%9A%84%E7%B1%BB.png" alt="崩掉的类"></p><p>okhttp底层走的socket</p><p><code>android hooking watch class_method java.net.AbstractPlainSocketImpl.acquireFD --dump-args --dump-backtrace --dump-return</code></p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/AbstractPlainSocketImpl.png" alt="hook AbstractPlainSocketImpl"></p><p>根据hook的结果拿到java.net.SocketOutputStream.write方法就是socket写入时调用的方法，针对该方法进行hook</p><p><code>android hooking watch class_method java.net.SocketOutputStream.write --dump-args --dump-backtrace --dump-return</code></p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/SocketOutputStream.png" alt="hook SocketOutputStream"></p><p>SocketInputStream.read的hook结果复制到010Editor，搜索1f8b,删除前面所有字符，保存为gzip,解压查看结果就是百度网页结果</p><h2 id="socket自吐"><a href="#socket自吐" class="headerlink" title="socket自吐"></a>socket自吐</h2><p>实现http与https的socket自吐，修改url地址<a href="http://www.baidu.com/%E4%B8%BAhttps://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com/为https://www.baidu.com/</a>, 有这两个自吐，可以通杀所有协议层的收发包内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">function hook_socket()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;hook_socket;&quot;)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        Java.use(&quot;java.net.SocketOutputStream&quot;).write.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.write(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTP write result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        Java.use(&quot;java.net.SocketInputStream&quot;).read.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.read(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTP read result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function hook_SSLsocketandroid8()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;hook_SSLsocket&quot;)</span><br><span class="line">        </span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket$SSLOutputStream&quot;).write.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.write(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTPS write result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket$SSLInputStream&quot;).read.overload(&#39;[B&#39;, &#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(bytearry,int1,int2)&#123;</span><br><span class="line">            var result &#x3D; this.read(bytearry,int1,int2);</span><br><span class="line">            console.log(&quot;HTTPS read result,bytearry,int1,int2&#x3D;&gt;&quot;,result,bytearry,int1,int2)</span><br><span class="line">            var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">            console.log(&quot;bytearray contents&#x3D;&gt;&quot;, ByteString.of(bytearry).hex())</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function hook_SSLsocket2android10()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot; hook_SSLsocket2&quot;)</span><br><span class="line">        var ByteString &#x3D; Java.use(&quot;com.android.okhttp.okio.ByteString&quot;);</span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.NativeCrypto&quot;).SSL_write.implementation &#x3D; function(long,NS,fd,NC,bytearray,int1,int2,int3)&#123;</span><br><span class="line">            var result &#x3D; this .SSL_write(long,NS,fd,NC,bytearray,int1,int2,int3);</span><br><span class="line">            console.log(&quot;SSL_write(long,NS,fd,NC,bytearray,int1,int2,int3),result&#x3D;&gt;&quot;,long,NS,fd,NC,bytearray,int1,int2,int3,result)</span><br><span class="line">            console.log(ByteString.of(bytearray).hex());</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(&quot;com.android.org.conscrypt.NativeCrypto&quot;).SSL_read.implementation &#x3D; function(long,NS,fd,NC,bytearray,int1,int2,int3)&#123;</span><br><span class="line">            var result &#x3D; this .SSL_read(long,NS,fd,NC,bytearray,int1,int2,int3);</span><br><span class="line">            console.log(&quot;SSL_read(long,NS,fd,NC,bytearray,int1,int2,int3),result&#x3D;&gt;&quot;,long,NS,fd,NC,bytearray,int1,int2,int3,result)</span><br><span class="line">            console.log(ByteString.of(bytearray).hex());</span><br><span class="line">            return result;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function main()&#123;</span><br><span class="line">    console.log(&quot;Main&quot;)</span><br><span class="line">    hook_socket();</span><br><span class="line">    hook_SSLsocketandroid8();</span><br><span class="line">    &#x2F;&#x2F;hook_SSLsocket2android10();</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p><code>frida -UF -l hookSocket.js</code>  使用<code>git clone https://github.com/peiniwan/Ganhuo.git</code>  编译源码编译安装GanHuo.apk查看代码家栏,通过010Editor获取转换后的Unicode码，即为抓包结果</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/hookSocket.png" alt="hook Socket"></p><h1 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h1><p>虚拟机网卡切换为桥接模式:192.168.0.104</p><p><strong>server</strong></p><p>wget <a href="https://github.com/gotify/server/releases/download/v2.0.20/gotify-linux-amd64.zip" target="_blank" rel="noopener">https://github.com/gotify/server/releases/download/v2.0.20/gotify-linux-amd64.zip</a></p><p>unzip gotify-linux-amd64.zip</p><p>chmod +x gotify-linux-amd64</p><p>./gotify-linux-amd64</p><p><strong>client</strong></p><p>adb install <a href="https://github.com/gotify/android/releases/download/v2.1.0/Gotify.apk" target="_blank" rel="noopener">Gotify.apk</a></p><p>输入server地址<a href="http://192.168.0.104/" target="_blank" rel="noopener">http://192.168.0.104</a> admin/admin</p><p><strong>cli</strong></p><p>wget -O gotify <a href="https://github.com/gotify/cli/releases/download/v1.2.0/gotify-cli-linux-amd64" target="_blank" rel="noopener">https://github.com/gotify/cli/releases/download/v1.2.0/gotify-cli-linux-amd64</a></p><p>chmod +x gotify</p><p>mv gotify /usr/bin/gotify</p><p>gotify init</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/gotify.png" alt="gotify"></p><p>gotify push -t “my title” -p 10 “my message”   服务器向手机发送消息</p><h2 id="hook-okhttp3-logging"><a href="#hook-okhttp3-logging" class="headerlink" title="hook_okhttp3_logging"></a>hook_okhttp3_logging</h2><p>添加十六进制转换，在控制台中以字符串显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function jhexdump(array) &#123;</span><br><span class="line">    var ptr &#x3D; Memory.alloc(array.length);</span><br><span class="line">    for(var i &#x3D; 0; i &lt; array.length; ++i)</span><br><span class="line">        Memory.writeS8(ptr.add(i), array[i]);</span><br><span class="line">    console.log(hexdump(ptr, &#123; offset: 0, length: array.length, header: false, ansi: false &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用console.log(jhexdump(bytearry))替换console.log(“bytearray contents=&gt;”, ByteString.of(bytearry).hex())</p><p>frida -UF -l hookSocket.js  使用socket自吐依旧可以通杀抓包</p><p>pm list packages|grep -i gotify  获取包名</p><p>frida -U -f com.github.gotify -l hookSocket.js –no-pause -o gotify.log</p><p>objection -g com.github.gotify explore</p><p>android hooking search classes websocket  查找内存中和websocket相关的类很少，可以通过android hooking watch class * ,存入websocket.txt文件批量hook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.github.gotify explore -c ~&#x2F;Desktop&#x2F;gotify&#x2F;websocket.txt</span><br><span class="line">plugin wallbreaker objectsearch com.github.gotify.client.model.Message  获取内存中的Message对象</span><br><span class="line">pluginwallbreaker objectdump --fullname 0x2576  获取该对象中字段在内存中的内容</span><br></pre></td></tr></table></figure><p>android hooking search classes websocket  发现<code>okhttp3.WebSocket</code>,通过hook_okhttp3_logging脚本进行hook抓包<code>frida -U -f com.github.gotify -l hookOkhttp3.js --no-pause</code>，logcat|grep okhttpGET 查看可以抓到ok3的websocket包</p><p>android hooking search classes com.xabber.xmpp.smack  基于xmpp协议聊天软件xabber搜索包名并批量hook</p><p>android hooking watch class_method java.lang.String.toString –dump-args -dump-backtrace –dump-return</p><h2 id="hookWebSocket"><a href="#hookWebSocket" class="headerlink" title="hookWebSocket"></a>hookWebSocket</h2><p>vim hookWebSocket.js  综合基于hook和枚举的方式抓包websocket</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">function hook_okhttp3() &#123;</span><br><span class="line">    &#x2F;&#x2F; 1. frida Hook java层的代码必须包裹在Java.perform中，Java.perform会将Hook Java相关API准备就绪。</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;okhttp3logging.dex.dex&quot;).load();</span><br><span class="line">        &#x2F;&#x2F; 只修改了这一句，换句话说，只是使用不同的拦截器对象。</span><br><span class="line">        var MyInterceptor &#x3D; Java.use(&quot;com.roysue.octolesson2ok3.okhttp3Logging&quot;);</span><br><span class="line"></span><br><span class="line">        var MyInterceptorObj &#x3D; MyInterceptor.$new();</span><br><span class="line">        var Builder &#x3D; Java.use(&quot;okhttp3.OkHttpClient$Builder&quot;);</span><br><span class="line">        console.log(Builder);</span><br><span class="line">        Builder.build.implementation &#x3D; function () &#123;</span><br><span class="line">            this.networkInterceptors().add(MyInterceptorObj);</span><br><span class="line">            console.log(&quot;hook Build.build successfully !&quot;)</span><br><span class="line">            return this.build();</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(&quot;hooking_okhttp3...&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function EnumerateClient()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;&#x2F;Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;r0gson.dex&quot;).load();</span><br><span class="line">        &#x2F;&#x2F;const gson &#x3D; Java.use(&#39;com.r0ysue.gson.Gson&#39;);</span><br><span class="line">        var gson2 &#x3D; Java.use(&#39;com.google.gson.Gson&#39;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 加载包含CurlInterceptor拦截器的DEX</span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;myok2curl.dex&quot;).load();</span><br><span class="line">        console.log(&quot;loading dex successful!&quot;)</span><br><span class="line">        const curlInterceptor &#x3D;  Java.use(&quot;com.moczul.ok2curl.CurlInterceptor&quot;);</span><br><span class="line">        const loggable &#x3D; Java.use(&quot;com.moczul.ok2curl.logger.Loggable&quot;);</span><br><span class="line">        var Log &#x3D; Java.use(&quot;android.util.Log&quot;);</span><br><span class="line">        var TAG &#x3D; &quot;okhttpGETcurl&quot;;</span><br><span class="line">        &#x2F;&#x2F;注册类————一个实现了所需接口的类</span><br><span class="line">        var MyLogClass &#x3D; Java.registerClass(&#123;</span><br><span class="line">            name: &quot;okhttp3.MyLogClass&quot;,</span><br><span class="line">            implements: [loggable],</span><br><span class="line">            methods: &#123;</span><br><span class="line">                log: function (MyMessage) &#123;</span><br><span class="line">                    Log.v(TAG, MyMessage);</span><br><span class="line">                &#125;&#125;</span><br><span class="line">        &#125;);        </span><br><span class="line">        const mylog &#x3D; MyLogClass.$new();</span><br><span class="line">        &#x2F;&#x2F; 得到所需拦截器对象</span><br><span class="line">        var curlInter &#x3D; curlInterceptor.$new(mylog);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 加载包含logging-interceptor拦截器的DEX</span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;okhttplogging.dex&quot;).load();</span><br><span class="line">        var MyInterceptor &#x3D; Java.use(&quot;com.r0ysue.learnokhttp.okhttp3Logging&quot;);</span><br><span class="line">        var MyInterceptorObj &#x3D; MyInterceptor.$new();        </span><br><span class="line"></span><br><span class="line">        Java.choose(&quot;okhttp3.OkHttpClient&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;1. found instance:&quot;,instance)</span><br><span class="line">                console.log(&quot;2. instance.interceptors():&quot;,instance.interceptors().$className)</span><br><span class="line">                console.log(&quot;3. instance._interceptors:&quot;,instance._interceptors.value.$className)</span><br><span class="line">                &#x2F;&#x2F;console.log(&quot;4. interceptors:&quot;,gson2.$new().toJson(instance.interceptors())) </span><br><span class="line">                console.log(&quot;5. interceptors:&quot;,Java.use(&quot;java.util.Arrays&quot;).toString(instance.interceptors().toArray()))</span><br><span class="line">                var newInter &#x3D; Java.use(&quot;java.util.ArrayList&quot;).$new();</span><br><span class="line">                newInter.addAll(instance.interceptors());</span><br><span class="line">                console.log(&quot;6. interceptors:&quot;,Java.use(&quot;java.util.Arrays&quot;).toString(newInter.toArray()));</span><br><span class="line">                console.log(&quot;7. interceptors:&quot;,newInter.$className);</span><br><span class="line">                newInter.add(MyInterceptorObj);</span><br><span class="line">                newInter.add(curlInter);</span><br><span class="line">                instance._interceptors.value &#x3D; newInter;</span><br><span class="line">                </span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&quot;Search complete!&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function main()&#123;</span><br><span class="line">    hook_okhttp3();</span><br><span class="line">    EnumerateClient();    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><h2 id="OkHttpLogger-Frida"><a href="#OkHttpLogger-Frida" class="headerlink" title="OkHttpLogger-Frida"></a>OkHttpLogger-Frida</h2><p>frida -UF -l <a href="https://github.com/siyujie/OkHttpLogger-Frida.git" target="_blank" rel="noopener">OkHttpLogger-Frida</a>/okhttp_poker.js  抓包websocket</p><h1 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a><a href="https://zhuanlan.zhihu.com/p/60246563" target="_blank" rel="noopener">Protobuf</a></h1><p>直播/弹幕协议<code>Protobuf</code>逆向分析，<a href="https://zhuanlan.zhihu.com/p/60246563" target="_blank" rel="noopener">手把手教你使用ProtoBuf，通过gRPC服务在Android上进行网络请求</a></p><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><p>192.168.0.102</p><p><a href="https://grpc.io/docs/platforms/android/java/quickstart/" target="_blank" rel="noopener">官方教程</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service      </span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line">setenforce 0</span><br><span class="line">/etc/selinux/config 修改为SELINUX=disabled</span><br><span class="line">tar -zxvf jdk-8u60-linux-x64.tar.gz</span><br><span class="line">mv jdk1.8.0_60/ /usr/<span class="built_in">local</span>/</span><br><span class="line">tar -zxf apache-maven-3.6.3-bin.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line">vim /etc/profile</span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_60</span><br><span class="line">JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line">MAVEN_HOME=/usr/<span class="built_in">local</span>/apache-maven-3.6.3</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin::<span class="variable">$MAVEN_HOME</span>/bin</span><br><span class="line">CLASSPATH=:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib/dt.jar</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME JRE_HOME PATH CLASSPATH MAVEN_HOME</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">git <span class="built_in">clone</span> -b v1.36.1 https://github.com/grpc/grpc-java</span><br><span class="line">git checkout -b v1.32.1   避免无法连接国外仓库gg</span><br><span class="line"><span class="built_in">cd</span> grpc-java/examples</span><br><span class="line">./gradlew installDist</span><br><span class="line">./build/install/examples/bin/hello-world-server  启动server端口在50051</span><br><span class="line">./build/install/examples/bin/hello-world-client  通过HelloRequest发送Hello World</span><br></pre></td></tr></table></figure><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>192.168.0.104</p><p>git clone  <a href="https://github.com/xuexiangjys/Protobuf-gRPC-Android.git" target="_blank" rel="noopener">https://github.com/xuexiangjys/Protobuf-gRPC-Android.git</a> ，其中helloworld.proto通过<a href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noopener">protoc</a>编译生成HelloReply.java</p><blockquote><p>手动编译，idea中安装GenProtobuf将binary进行encode和decode</p><p>wget <a href="https://github.com/protocolbuffers/protobuf/releases/download/v3.13.0/protoc-3.13.0-linux-x86_64.zip" target="_blank" rel="noopener">https://github.com/protocolbuffers/protobuf/releases/download/v3.13.0/protoc-3.13.0-linux-x86_64.zip</a></p><p>unzip protoc-3.13.0-linux-x86_64.zip</p><p>as-Tools-Configure GenProtobuf</p><p>右键hellooworld.proto点击quick gen protobuf here 实现手动编译，生成的编译代码使用了大量的google的protobuf基础库</p></blockquote><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/protoc.png" alt="protoc"></p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/protoc%E6%8C%87%E5%AE%9A%E7%BC%96%E8%AF%91%E8%AF%AD%E8%A8%80.png" alt="protoc指定编译语言"></p><p>安装启动Protobuf-gRPC-Android，保证服务端和客户端互相ping通，可以通过<code>nc 192.168.0.102 50052</code> 给服务端发送数据，服务端使用<code>nc -l 50052</code>接收，如果互通消息就可以收到，否则使用NPS将服务端的50051端口服务映射到指定服务器ip的指定端口(需要在服务端安装nps客户端，在nps服务端配置该nps客户端)。</p><p>如果没有响应，<code>ps -ef|grep protobuf</code> 获取到进程id后，<code>logcat|grep -i 22916</code> 查看log，退出重进gRPC-普通请求按钮，输入服务端ip，端口及内容发送请求。</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/grpc%E6%99%AE%E9%80%9A%E8%AF%B7%E6%B1%82%E6%88%90%E5%8A%9F.png" alt="grpc普通请求成功"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">ps -ef|grep protobuf  获取包名</span><br><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs128arm64 启动frida server</span><br><span class="line">pyenv local 3.8.0</span><br><span class="line">objection -g com.xuexiang.protobufdemo explore</span><br><span class="line">android hooking search classes protobuf  将打印出的类前面加上android hooking watch class,存入hook_list.txt</span><br><span class="line">objection -g com.xuexiang.protobufdemo explore -c &#x2F;root&#x2F;Desktop&#x2F;hook_list.txt  实现批量hook，点击发送请求，从请求找寻找调用到的protobuf类相关方法</span><br></pre></td></tr></table></figure><p>关注打印出来的几个函数：</p><p>com.google.protobuf.WireFormat.makeTag<br>com.google.protobuf.CodedOutputStream$OutputStreamEncoder.write([B, int, int)<br>com.google.protobuf.CodedInputStream.readTag()<br>com.google.protobuf.WireFormat.getTagFieldNumber(int)<br>com.google.protobuf.Utf8.encode(java.lang.CharSequence, [B, int, int)<br>com.google.protobuf.CodedInputStream.newInstance([B, int, int, boolean)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch class_method com.google.protobuf.Utf8.encode --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/hookencode.png" alt="hookencode"></p><p>同理，makeTag的调用栈也是从用户代码中的writeTo调用而来。</p><p>frida -UF -l hookSocket.js -o protobuf.txt  通杀自吐打印出protubuf的包数据</p><p><img src="/2021/03/14/Socket&Websocket&Protobuf%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/hookSocketProtobuf.png" alt="hookSocketProtobuf"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker objectsearch com.xuexiang.protobufdemo.HelloReply</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x22ea  内存漫游的源码</span><br></pre></td></tr></table></figure><ul><li><p><a href="https://bbs.pediy.com/thread-259273.htm" target="_blank" rel="noopener">Protobuf协议逆向和仿真&amp;举个栗子</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/gMhztldG-0Xy_euX1wpZbw" target="_blank" rel="noopener">抓包+逆向app分析protobuf</a></p></li><li><p><a href="https://bbs.pediy.com/thread-262207.htm" target="_blank" rel="noopener">-Protobuf协议解析文档-某音弹幕</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Socket </tag>
            
            <tag> WebSocket </tag>
            
            <tag> Protobuf </tag>
            
            <tag> XMPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Cloud-Alibaba</title>
      <link href="2021/03/11/Spring-Cloud-Alibaba/"/>
      <url>2021/03/11/Spring-Cloud-Alibaba/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringCloudAlibaba"><a href="#SpringCloudAlibaba" class="headerlink" title="SpringCloudAlibaba"></a>SpringCloudAlibaba</h1><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。</p><p>依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p><ul><li>Sentinel：把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</li><li>Nacos：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</li><li>RocketMQ：一款开源的分布式消息系统，基于高可用分布式集群技术，提供低延时的、高可靠的消息发布与订阅服务。</li><li>Dubbo：Apache Dubbo™ 是一款高性能 Java RPC 框架。</li><li>Seata：阿里巴巴开源产品，一个易于使用的高性能微服务分布式事务解决方案。</li><li>Alibaba Cloud ACM：一款在分布式架构环境中对应用配置进行集中管理和推送的应用配置中心产品。</li><li>Alibaba Cloud OSS: 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li><li>Alibaba Cloud SchedulerX: 阿里中间件团队开发的一款分布式任务调度产品，提供秒级、精准、高可靠、高可用的定时（基于 Cron 表达式）任务调度服务。</li><li>Alibaba Cloud SMS: 覆盖全球的短信服务，友好、高效、智能的互联化通讯能力，帮助企业迅速搭建客户触达通道。</li></ul><h1 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h1><p><a href="https://download.virtualbox.org/virtualbox/6.1.18/VirtualBox-6.1.18-142142-Win.exe" target="_blank" rel="noopener">安装virtualbox 6</a></p><p><a href="https://releases.hashicorp.com/vagrant/2.2.14/vagrant_2.2.14_x86_64.msi" target="_blank" rel="noopener">vagrant</a>安装好后进入<a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">镜像仓库</a>搜索需要安装的镜像</p><p><code>mkdir centos7 &amp;&amp; vagrant init centos/7 &amp;&amp; vagrant up &amp;&amp; vagrant ssh</code>  创建并开启镜像，修改网络桥接</p><blockquote><p>如果太慢，进入<a href="https://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box" target="_blank" rel="noopener">centos/7</a>仓库下载，手动加载<code>vagrant box add centos/7 CentOS-7-x86_64-Vagrant-2004_01.VirtualBox.box</code></p></blockquote><p>vim Vagrantfile  修改配置并重启<code>vagrant reload</code>，保存虚拟机与主机可ping通，<code>sudo passwd root </code>设置root权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># config.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.10&quot;  host-only</span><br><span class="line">config.vm.network &quot;public_network&quot;  桥接</span><br></pre></td></tr></table></figure><p>安装<a href="https://npm.taobao.org/mirrors/node/v10.15.3/node-v10.15.3-x64.msi" target="_blank" rel="noopener">nodejs</a>并配置淘宝源<code>npm config set registry http://registry.npm.taobao.org/</code></p><p><strong><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">安装docker</a></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">sudo yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line">sudo systemctl start docker</span><br><span class="line">sudo docker images</span><br><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure><p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">镜像加速器</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p &#x2F;etc&#x2F;docker</span><br><span class="line">sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;3gki6pei.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p><strong>mysql</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v &#x2F;mydata&#x2F;mysql&#x2F;log:&#x2F;var&#x2F;log&#x2F;mysal \</span><br><span class="line">-v &#x2F;mydata&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD&#x3D;root \</span><br><span class="line">-d mysql:5.7</span><br><span class="line">docker exec -it mysql &#x2F;bin&#x2F;bash</span><br><span class="line">mysql -uroot -proot</span><br><span class="line">use mysql;</span><br><span class="line">alter user &#39;root&#39;@&#39;%&#39; identified with mysql_native_password by &#39;root&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>vi /mydata/mysql/conf/my.cnf   修改编码配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect&#x3D;&#39;SET collation_connection &#x3D; utf8_unicode_ci&#39;</span><br><span class="line">init_connect&#x3D;&#39;SET NAMES utf8&#39;</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">collation-server&#x3D;utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure><p>docker restart mysql &amp;&amp; cat /etc/mysql/my.cnf  &amp;&amp; docker update mysql –restart=always</p><p><strong>redis</strong></p><p>vi /mydata/redis/conf/redis.conf  配置<code>appendonly yes</code>持久化硬盘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis -v &#x2F;mydata&#x2F;redis&#x2F;data:&#x2F;data \</span><br><span class="line">-v &#x2F;mydata&#x2F;redis&#x2F;conf&#x2F;redis.conf:&#x2F;etc&#x2F;redis&#x2F;redis.conf \</span><br><span class="line">-d redis:3.2 redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf --appendonly yes</span><br><span class="line">docker exec -it redis redis-cli</span><br><span class="line">docker update redis --restart&#x3D;always</span><br></pre></td></tr></table></figure><p><strong>maven</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">    &lt;id&gt;nexus-aliyun&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;mirrorOf&gt;*&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">    &lt;name&gt;Nexus aliyun&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;mirror&gt; </span><br><span class="line">&lt;profile&gt;    </span><br><span class="line">    &lt;id&gt;jdk18&lt;&#x2F;id&gt;    </span><br><span class="line">    &lt;activation&gt;    </span><br><span class="line">        &lt;activeByDefault&gt;true&lt;&#x2F;activeByDefault&gt;    </span><br><span class="line">        &lt;jdk&gt;1.8&lt;&#x2F;jdk&gt;    </span><br><span class="line">    &lt;&#x2F;activation&gt;    </span><br><span class="line">    &lt;properties&gt;    </span><br><span class="line">        &lt;maven.compiler.source&gt;1.8&lt;&#x2F;maven.compiler.source&gt;    </span><br><span class="line">        &lt;maven.compiler.target&gt;1.8&lt;&#x2F;maven.compiler.target&gt;    </span><br><span class="line">        &lt;maven.compiler.compilerVersion&gt;1.8&lt;&#x2F;maven.compiler.compilerVersion&gt;    </span><br><span class="line">    &lt;&#x2F;properties&gt;     </span><br><span class="line">&lt;&#x2F;profile&gt;</span><br></pre></td></tr></table></figure><p>idea安装lombok，mybatisX插件</p><p>vscode安装Auto Close Tag,Auto Rename Tag,Chinese,Eslint,HTML CSS Support,HTML Snippets,JavaScript(ES6),Live Server,open in browser,Vetur,Vue 2 Snippets插件</p><p>git配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;username&quot; &#x2F;&#x2F;（名字） # 配置邮箱</span><br><span class="line">git config --global user.email &quot;username@email.com&quot; &#x2F;&#x2F;(注册账号时用的邮箱)</span><br><span class="line">ssh-keygen -t rsa -C &quot;xxxxx@xxxxx.com&quot;   进入git bash生成公私钥</span><br><span class="line">cat ~&#x2F;.ssh&#x2F;id_rsa.pub</span><br><span class="line">ssh -T git@gitee.com 测试是否成功即可</span><br></pre></td></tr></table></figure><h1 id="Nacos注册中心"><a href="#Nacos注册中心" class="headerlink" title="Nacos注册中心"></a>Nacos注册中心</h1><p>新建Spring Initializr作为provider项目jdk1.8并导入Web中的Spring Web和Spring Cloud Routing的OpenFeign组件，设置-Xmx100m  启动Application使用最大内存</p><p>启动<a href="https://github.com/alibaba/nacos/releases/download/1.3.1/nacos-server-1.3.1.zip" target="_blank" rel="noopener">nacos-server-1.3.1.zip</a>访问<a href="http://127.0.0.1:8848/nacos/" target="_blank" rel="noopener">nacos</a></p><p>修改依赖如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;spring-cloud.version&gt;Greenwich.SR3&lt;&#x2F;spring-cloud.version&gt;</span><br><span class="line">    &lt;spring-cloud-alibaba.version&gt;2.1.0.RELEASE&lt;&#x2F;spring-cloud-alibaba.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;dependencyManagement&gt;</span><br></pre></td></tr></table></figure><p>添加application.yml配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: provider</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">server:</span><br><span class="line">  port: 8000</span><br></pre></td></tr></table></figure><p>ProviderApplication启动类添加<code>@EnableDiscoveryClient</code>,启动后在<a href="http://127.0.0.1:8848/nacos" target="_blank" rel="noopener">nacos控制台</a>查看已经上线的服务</p><h1 id="Nacos配置中心"><a href="#Nacos配置中心" class="headerlink" title="Nacos配置中心"></a>Nacos配置中心</h1><h2 id="默认配置读取"><a href="#默认配置读取" class="headerlink" title="默认配置读取"></a>默认配置读取</h2><p>application.properties添加配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name&#x3D;onejane</span><br><span class="line">user.age&#x3D;20</span><br></pre></td></tr></table></figure><p>Controller实现读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;test&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">    @Value(&quot;$&#123;user.name&#125;&quot;)</span><br><span class="line">    private String name;</span><br><span class="line">    @Value(&quot;$&#123;user.age&#125;&quot;)</span><br><span class="line">    private Integer age;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        System.out.println(name+&quot;:&quot;+age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Nacos配置"><a href="#Nacos配置" class="headerlink" title="Nacos配置"></a>Nacos配置</h2><p>项目添加config依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>Provider项目创建bootstrap.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name&#x3D;provider</span><br><span class="line">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848</span><br></pre></td></tr></table></figure><p>Nacos中配置provider.properties，默认规则，取public命名空间的应用名.properties，类型为Properties，相同与application.properties时优先使用配置中心的配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name&#x3D;onejane1</span><br><span class="line">user.age&#x3D;23</span><br></pre></td></tr></table></figure><h3 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h3><p>配置命名空间provider，命名空间ID为f7d49148-09a8-4ca1-8a40-c52e9cb627b5，在该命名空间下配置provider.properties，Group为prod</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name&#x3D;onejane2</span><br><span class="line">user.age&#x3D;23</span><br></pre></td></tr></table></figure><p>配置bootstrap.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name&#x3D;provider</span><br><span class="line">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848</span><br><span class="line">spring.cloud.nacos.config.namespace&#x3D;f7d49148-09a8-4ca1-8a40-c52e9cb627b5</span><br><span class="line">spring.cloud.nacos.config.group&#x3D;prod</span><br></pre></td></tr></table></figure><blockquote><p>命名空间，用于配置隔离，默认新增的所有配置都在public空间。</p><p>1、开发，测试，生产：利用命名空间来做环境隔离。在bootstrap.properties；配置spring.cloud.nacos.config.namespace需要使用哪个命名空间下的配置</p><p>2、每一个微服务之间互相隔离配置，每一个微服务都创建自己的命名空间，只加载自己命名空间下的所有配置</p></blockquote><p>每个微服务创建自己的命名空间，使用配置分组区分环境，dev，test，prod</p><h3 id="多文件配置"><a href="#多文件配置" class="headerlink" title="多文件配置"></a>多文件配置</h3><p>在Nacos中provider微服务命名空间配置datasource.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;172.20.1.185:3306&#x2F;user</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure><p>配置mybatis.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      id-type: auto</span><br></pre></td></tr></table></figure><p>配置service.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: provider</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848 </span><br><span class="line">server:</span><br><span class="line">  port: 7000</span><br></pre></td></tr></table></figure><p>注释application.yml中所有配置并在bootstrap.properties中实现多文件配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name&#x3D;provider</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848</span><br><span class="line">spring.cloud.nacos.config.namespace&#x3D;f7d49148-09a8-4ca1-8a40-c52e9cb627b5</span><br><span class="line">spring.cloud.nacos.config.group&#x3D;prod</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.ext-config[0].data-id&#x3D;datasource.yml</span><br><span class="line">spring.cloud.nacos.config.ext-config[0].group&#x3D;dev</span><br><span class="line">spring.cloud.nacos.config.ext-config[0].refresh&#x3D;true</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.ext-config[1].data-id&#x3D;mybatis.yml</span><br><span class="line">spring.cloud.nacos.config.ext-config[1].group&#x3D;dev</span><br><span class="line">spring.cloud.nacos.config.ext-config[1].refresh&#x3D;true</span><br><span class="line"></span><br><span class="line">spring.cloud.nacos.config.ext-config[2].data-id&#x3D;other.yml</span><br><span class="line">spring.cloud.nacos.config.ext-config[2].group&#x3D;dev</span><br><span class="line">spring.cloud.nacos.config.ext-config[2].refresh&#x3D;true</span><br></pre></td></tr></table></figure><h1 id="Mybatis-Plus持久化"><a href="#Mybatis-Plus持久化" class="headerlink" title="Mybatis-Plus持久化"></a>Mybatis-Plus持久化</h1><p>引入依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.17&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>配置数据源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    url: jdbc:mysql:&#x2F;&#x2F;172.20.1.185:3306&#x2F;user</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss  # 输出日期自动转换</span><br><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      id-type: auto</span><br><span class="line">      logic-delete-value: 1  # 逻辑删除</span><br><span class="line">      logic-not-delete-value: 0</span><br></pre></td></tr></table></figure><p>配置扫描包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@MapperScan(&quot;com.onejane.demo.provider.dao&quot;)</span><br></pre></td></tr></table></figure><p>添加实体类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@TableName(&quot;user_info&quot;)</span><br><span class="line">public class UserInfoEntity implements Serializable &#123;</span><br><span class="line">private static final long serialVersionUID &#x3D; 1L;</span><br><span class="line"></span><br><span class="line">@TableId</span><br><span class="line">private Long id;</span><br><span class="line">private String name;</span><br><span class="line">private Long age;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 是否显示[0-不显示，1显示]  用于逻辑删除</span><br><span class="line"> *&#x2F;</span><br><span class="line">@TableLogic(value &#x3D; &quot;1&quot;,delval &#x3D; &quot;0&quot;)</span><br><span class="line">private Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>逻辑删除实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">UserInfoSerivce userInfoSerivce;</span><br><span class="line">@RequestMapping(&quot;&#x2F;delete&quot;)</span><br><span class="line">public R delete(Long[] ids)&#123;</span><br><span class="line">    userInfoSerivce.removeByIds(Arrays.asList(ids));</span><br><span class="line">    return R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分页查询实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public interface UserInfoSerivce extends IService&lt;UserInfoEntity&gt; &#123;</span><br><span class="line">    PageUtils queryPage(Map&lt;String, Object&gt; params);</span><br><span class="line">&#125;</span><br><span class="line">@Service(&quot;userInfoService&quot;)</span><br><span class="line">public class UserInfoServiceImpl extends ServiceImpl&lt;UserInfoDao, UserInfoEntity&gt; implements UserInfoSerivce &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public PageUtils queryPage(Map&lt;String, Object&gt; params) &#123;</span><br><span class="line">        IPage&lt;UserInfoEntity&gt; page &#x3D; this.page(</span><br><span class="line">                new Query&lt;UserInfoEntity&gt;().getPage(params),</span><br><span class="line">                new QueryWrapper&lt;UserInfoEntity&gt;()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        return new PageUtils(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@RequestMapping(&quot;&#x2F;list&quot;)</span><br><span class="line">public R list(@RequestParam Map&lt;String, Object&gt; params)&#123;</span><br><span class="line">    PageUtils page &#x3D; userInfoSerivce.queryPage(params);</span><br><span class="line">    return R.ok().put(&quot;page&quot;, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分页配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableTransactionManagement &#x2F;&#x2F;开启事务</span><br><span class="line">@MapperScan(&quot;com.onejane.demo.provider.dao&quot;)</span><br><span class="line">public class MyBatisConfig &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;引入分页插件</span><br><span class="line">    @Bean</span><br><span class="line">    public PaginationInterceptor paginationInterceptor() &#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor &#x3D; new PaginationInterceptor();</span><br><span class="line">        &#x2F;&#x2F; 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span><br><span class="line">         paginationInterceptor.setOverflow(true);</span><br><span class="line">        &#x2F;&#x2F; 设置最大单页限制数量，默认 500 条，-1 不受限制</span><br><span class="line">        paginationInterceptor.setLimit(1000);</span><br><span class="line">        return paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Feign远程调用"><a href="#Feign远程调用" class="headerlink" title="Feign远程调用"></a>Feign远程调用</h1><p>新建Spring Initializr作为consumer项目jdk1.8并导入Web中的Spring Web和Spring Cloud Routing的OpenFeign组件，设置-Xmx100m  启动Application使用最大内存</p><p>provider提供api，启动类配置@EnableDiscoveryClient后启动应用</p><p>consumer中引入nacos依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;spring-cloud.version&gt;Greenwich.SR3&lt;&#x2F;spring-cloud.version&gt;</span><br><span class="line">    &lt;spring-cloud-alibaba.version&gt;2.1.0.RELEASE&lt;&#x2F;spring-cloud-alibaba.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud-alibaba.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;spring-cloud.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">            &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;dependencyManagement&gt;</span><br></pre></td></tr></table></figure><p>Member作为consumer获取feign调用，定义feign方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(&quot;provider&quot;)</span><br><span class="line">public interface ProviderFeignService &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;&#x2F;test&#x2F;list&quot;)</span><br><span class="line">    public void test();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>consumer在控制器中申请远程调用，并在启动类中开启feign调用<code>@EnableFeignClients(basePackages = &quot;com.onejane.demo.consumer.feign&quot;)</code>并将consumer加入nacos注册中心<code>@EnableDiscoveryClient</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(&quot;provider&quot;)</span><br><span class="line">public interface ProviderFeignService &#123;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;test&#x2F;user&quot;)</span><br><span class="line">    public void test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在application.yml中配置nacos</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">  application:</span><br><span class="line">    name: consumer</span><br><span class="line">server:</span><br><span class="line">  port: 7000</span><br></pre></td></tr></table></figure><p>开启feign远程调用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;test&quot;)</span><br><span class="line">public class UserInfoController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    ProviderFeignService providerFeignService;</span><br><span class="line">    @RequestMapping(&quot;&#x2F;user&quot;)</span><br><span class="line">    public void test()&#123;</span><br><span class="line">        providerFeignService.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Gateway网关"><a href="#Gateway网关" class="headerlink" title="Gateway网关"></a>Gateway网关</h1><p>修改provider项目新增<code>server.servlet.context-path: /provider</code></p><p>新建Spring Initializr作为网关项目项目jdk1.8并导入Spring Cloud Routing的Gateway组件</p><p>pom依赖修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">    &lt;spring-cloud.version&gt;Greenwich.SR3&lt;&#x2F;spring-cloud.version&gt;</span><br><span class="line">&lt;&#x2F;properties&gt;</span><br></pre></td></tr></table></figure><p>application.properties添加配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.discovery.server-addr&#x3D;127.0.0.1:8848</span><br><span class="line">spring.application.name&#x3D;gateway</span><br><span class="line">server.port&#x3D;88</span><br></pre></td></tr></table></figure><p>在nacos中配置微服务命名空间gateway,ID为7601cb5a-a9dd-43d8-a1b9-a37952674df2，添加配置文件gateway.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    application:</span><br><span class="line">        name: gateway</span><br></pre></td></tr></table></figure><p>bootstrap.properties配置命名空间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name&#x3D;gateway</span><br><span class="line">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848</span><br><span class="line">spring.cloud.nacos.config.namespace&#x3D;7601cb5a-a9dd-43d8-a1b9-a37952674df2</span><br></pre></td></tr></table></figure><p>application.yml中添加网关配置，访问<a href="http://localhost:88/?url=qq" target="_blank" rel="noopener">http://localhost:88/?url=qq</a> 则跳转到<a href="https://www.qq.com/?url=qq%EF%BC%8C" target="_blank" rel="noopener">https://www.qq.com?url=qq，</a> 访问<a href="http://localhost:88/?url=baidu" target="_blank" rel="noopener">http://localhost:88/?url=baidu</a> 则跳转到<a href="https://www.baidu.com/?url=baidu" target="_blank" rel="noopener">https://www.baidu.com?url=baidu</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - id: test_route</span><br><span class="line">          uri: https:&#x2F;&#x2F;www.baidu.com</span><br><span class="line">          predicates:</span><br><span class="line">            - Query&#x3D;url,baidu</span><br><span class="line"></span><br><span class="line">        - id: qq_route</span><br><span class="line">          uri: https:&#x2F;&#x2F;www.qq.com</span><br><span class="line">          predicates:</span><br><span class="line">            - Query&#x3D;url,qq</span><br><span class="line">        - id: provider_route</span><br><span class="line">          uri: lb:&#x2F;&#x2F;provider</span><br><span class="line">          predicates:</span><br><span class="line">            - Path&#x3D;&#x2F;api&#x2F;provider&#x2F;**</span><br><span class="line">          filters:</span><br><span class="line">            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;$\&#123;segment&#125;</span><br><span class="line">  application:</span><br><span class="line">    name: gateway</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># http:&#x2F;&#x2F;localhost:88&#x2F;api&#x2F;provider&#x2F;test&#x2F;user &#x3D;&#x3D;&gt; http:&#x2F;&#x2F;localhost:8000&#x2F;provider&#x2F;test&#x2F;user</span><br></pre></td></tr></table></figure><p>在启动类中配置@EnableDiscoveryClient，并过滤掉数据库配置@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})</p><h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class GulimallCorsConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public CorsWebFilter corsWebFilter()&#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source &#x3D; new UrlBasedCorsConfigurationSource();</span><br><span class="line"></span><br><span class="line">        CorsConfiguration corsConfiguration &#x3D; new CorsConfiguration();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1、配置跨域</span><br><span class="line">        corsConfiguration.addAllowedHeader(&quot;*&quot;);</span><br><span class="line">        corsConfiguration.addAllowedMethod(&quot;*&quot;);</span><br><span class="line">        corsConfiguration.addAllowedOrigin(&quot;*&quot;);</span><br><span class="line">        corsConfiguration.setAllowCredentials(true);</span><br><span class="line"></span><br><span class="line">        source.registerCorsConfiguration(&quot;&#x2F;**&quot;,corsConfiguration);</span><br><span class="line">        return new CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="阿里云oss"><a href="#阿里云oss" class="headerlink" title="阿里云oss"></a>阿里云oss</h1><p>引入阿里云oss依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alicloud-oss&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>application.yml配置阿里云AccessKey</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    alicloud:</span><br><span class="line">      access-key: ***</span><br><span class="line">      secret-key: ***</span><br><span class="line">      oss:</span><br><span class="line">        endpoint: oss-cn-beijing.aliyuncs.com</span><br><span class="line">        bucket: onejane-opencv</span><br></pre></td></tr></table></figure><p>上传图片一般先通过服务端签名后前端直传</p><p><img src="/2021/03/11/Spring-Cloud-Alibaba/%E9%98%BF%E9%87%8C%E4%BA%91oss.png" alt="阿里云oss"></p><h1 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h1><p>通过自定义校验，分组校验及全局校验实现对Spring MVC入参的参数校验。</p><p>加入validation依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.validation&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;validation-api&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.1.Final&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>加入校验注解</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 品牌id</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotNull(message &#x3D; &quot;修改必须指定品牌id&quot;,groups &#x3D; &#123;UpdateGroup.class&#125;)</span><br><span class="line">@Null(message &#x3D; &quot;新增不能指定id&quot;,groups &#x3D; &#123;AddGroup.class&#125;)</span><br><span class="line">@TableId</span><br><span class="line">private Long brandId;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 品牌名</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotBlank(message &#x3D; &quot;品牌名必须提交&quot;,groups &#x3D; &#123;AddGroup.class,UpdateGroup.class&#125;)</span><br><span class="line">private String name;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 品牌logo地址</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotBlank(groups &#x3D; &#123;AddGroup.class&#125;)</span><br><span class="line">@URL(message &#x3D; &quot;logo必须是一个合法的url地址&quot;,groups&#x3D;&#123;AddGroup.class,UpdateGroup.class&#125;)</span><br><span class="line">private String logo;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 介绍</span><br><span class="line"> *&#x2F;</span><br><span class="line">private String descript;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 显示状态[0-不显示；1-显示]</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotNull(groups &#x3D; &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span><br><span class="line">@ListValue(vals&#x3D;&#123;0,1&#125;,groups &#x3D; &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span><br><span class="line">private Integer showStatus;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 检索首字母</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotEmpty(groups&#x3D;&#123;AddGroup.class&#125;)</span><br><span class="line">@Pattern(regexp&#x3D;&quot;^[a-zA-Z]$&quot;,message &#x3D; &quot;检索首字母必须是一个字母&quot;,groups&#x3D;&#123;AddGroup.class, UpdateGroup.class&#125;)</span><br><span class="line">private String firstLetter;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 排序</span><br><span class="line"> *&#x2F;</span><br><span class="line">@NotNull(groups&#x3D;&#123;AddGroup.class&#125;)</span><br><span class="line">@Min(value &#x3D; 0,message &#x3D; &quot;排序必须大于等于0&quot;,groups&#x3D;&#123;AddGroup.class,UpdateGroup.class&#125;)</span><br><span class="line">private Integer sort;</span><br></pre></td></tr></table></figure><p>建立分组校验类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface AddGroup &#123;&#125;</span><br><span class="line">public interface UpdateGroup &#123;&#125;</span><br><span class="line">public interface UpdateStatusGroup &#123;&#125;</span><br></pre></td></tr></table></figure><p>自定义异常注解</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Documented</span><br><span class="line">@Constraint(validatedBy &#x3D; &#123; ListValueConstraintValidator.class &#125;)</span><br><span class="line">@Target(&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span><br><span class="line">@Retention(RUNTIME)</span><br><span class="line">public @interface ListValue &#123;</span><br><span class="line">    String message() default &quot;&#123;com.onejane.demo.provider.valid.ListValue.message&#125;&quot;;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() default &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() default &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    int[] vals() default &#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自定义异常实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class ListValueConstraintValidator implements ConstraintValidator&lt;ListValue,Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private Set&lt;Integer&gt; set &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">    &#x2F;&#x2F;初始化方法</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize(ListValue constraintAnnotation) &#123;</span><br><span class="line"></span><br><span class="line">        int[] vals &#x3D; constraintAnnotation.vals();</span><br><span class="line">        for (int val : vals) &#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;判断是否校验成功</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     *</span><br><span class="line">     * @param value 需要校验的值</span><br><span class="line">     * @param context</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean isValid(Integer value, ConstraintValidatorContext context) &#123;</span><br><span class="line"></span><br><span class="line">        return set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制器层加入字段校验配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;&#x2F;save&quot;)</span><br><span class="line">public R save(@Validated(&#123;AddGroup.class&#125;) @RequestBody BrandEntity brand&#x2F;*,BindingResult result*&#x2F;)&#123;</span><br><span class="line">&#x2F;&#x2F;        if(result.hasErrors())&#123;</span><br><span class="line">&#x2F;&#x2F;            Map&lt;String,String&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">&#x2F;&#x2F;            &#x2F;&#x2F;1、获取校验的错误结果</span><br><span class="line">&#x2F;&#x2F;            result.getFieldErrors().forEach((item)-&gt;&#123;</span><br><span class="line">&#x2F;&#x2F;                &#x2F;&#x2F;FieldError 获取到错误提示</span><br><span class="line">&#x2F;&#x2F;                String message &#x3D; item.getDefaultMessage();</span><br><span class="line">&#x2F;&#x2F;                &#x2F;&#x2F;获取错误的属性的名字</span><br><span class="line">&#x2F;&#x2F;                String field &#x3D; item.getField();</span><br><span class="line">&#x2F;&#x2F;                map.put(field,message);</span><br><span class="line">&#x2F;&#x2F;            &#125;);</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F;            return R.error(400,&quot;提交的数据不合法&quot;).put(&quot;data&quot;,map);</span><br><span class="line">&#x2F;&#x2F;        &#125;else &#123;</span><br><span class="line">&#x2F;&#x2F;      为避免每次请求都判断异常输出，通过ExceptionControllerAdvice实现全局异常控制</span><br><span class="line">    brandService.save(brand);</span><br><span class="line"></span><br><span class="line">    return R.ok();</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 修改</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RequestMapping(&quot;&#x2F;update&quot;)</span><br><span class="line">public R update(@Validated(UpdateGroup.class) @RequestBody BrandEntity brand)&#123;</span><br><span class="line">    brandService.updateById(brand);</span><br><span class="line">    return R.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 修改状态</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RequestMapping(&quot;&#x2F;update&#x2F;status&quot;)</span><br><span class="line">public R updateStatus(@Validated(UpdateStatusGroup.class) @RequestBody BrandEntity brand)&#123;</span><br><span class="line">    brandService.updateById(brand);</span><br><span class="line">    return R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>全局异常控制配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">&#x2F;&#x2F;@ResponseBody</span><br><span class="line">&#x2F;&#x2F;@ControllerAdvice(basePackages &#x3D; &quot;com.onejane.demo.provider.controller&quot;)</span><br><span class="line">@RestControllerAdvice(basePackages &#x3D; &quot;com.onejane.demo.provider.controller&quot;)</span><br><span class="line">public class ExceptionControllerAdvice &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ExceptionHandler(value&#x3D; MethodArgumentNotValidException.class)</span><br><span class="line">    public R handleVaildException(MethodArgumentNotValidException e)&#123;</span><br><span class="line">        log.error(&quot;数据校验出现问题&#123;&#125;，异常类型：&#123;&#125;&quot;,e.getMessage(),e.getClass());</span><br><span class="line">        BindingResult bindingResult &#x3D; e.getBindingResult();</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; errorMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((fieldError)-&gt;&#123;</span><br><span class="line">            errorMap.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        return R.error(BizCodeEnume.VAILD_EXCEPTION.getCode(),BizCodeEnume.VAILD_EXCEPTION.getMsg()).put(&quot;data&quot;,errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ExceptionHandler(value &#x3D; Throwable.class)</span><br><span class="line">    public R handleException(Throwable throwable)&#123;</span><br><span class="line"></span><br><span class="line">        log.error(&quot;错误：&quot;,throwable);</span><br><span class="line">        return R.error(BizCodeEnume.UNKNOW_EXCEPTION.getCode(),BizCodeEnume.UNKNOW_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nacos </tag>
            
            <tag> feign </tag>
            
            <tag> gateway </tag>
            
            <tag> sentinel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>opencv实现盲水印</title>
      <link href="2021/03/11/opencv%E5%AE%9E%E7%8E%B0%E7%9B%B2%E6%B0%B4%E5%8D%B0/"/>
      <url>2021/03/11/opencv%E5%AE%9E%E7%8E%B0%E7%9B%B2%E6%B0%B4%E5%8D%B0/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a43caf74c80211a5b64dbcbed12add74a77e7109aad691556c66a611ad433ddc">473c51ad726b5f4bf51209d6cda9bf4699b276776b8f276d0ebe20abd2be65eef745512e1026111594b7c24ee43f717368f7b0a055a6e50d85df3d2dbc155b48efec7ce08b9892a899fda6a61dc412feeb9475bd5b021d2f62c858a122ffcfb0412e718b27f90fcff540e45293017fa2a57efbbc35fb77bacde0e1f5c87ed46125f522744b9c209aad898c1b7835b9fae4dacbda6607ffc02405e352b198a43e0a9a0821ab213d251257e3d1b9053dfb035bb7821acc49a9ceb3f5e243ed91f617eb10f5ddf866da8f143f08daca829d4ed62b8a68d75d213e521cdc06a3fdf7a1dc1ed00559cd88943a63f814a423076e0130006a5dd863d805cb2b83b3c1356ca2cd591e5f08dd31d74fa880d73e55d9a6a66bb999ab65c127ccc7bce50a8dc31eb4ff4d45e8b58727716c29cfdd42090130da34fc4eb0f1ac651c0848997e6e4c55d534c9b4f715c81afa6c94dd817ef199eb53e214a46cab7e8c5e7e38d26a95c16fed1a5d046bc20c85055dade712ec2635d852426743d533c7d910ae7f349fde2579a4c6fe26c979b4b5843dad84e80a5c7c02372bc166c62bfb9763ce778c44ed1862f029ed9406fab7139898f13eae97b66f3e9f987a6fa51a069ab6eddd50a23d58dc8dae8946710e70dba6b98cfe28122ec32ebf90b723308849b6e80286f576cc603a2ddc4ea8c815accdb45a9aa957da8355a9f74e3c088f06347f7635a01e2e1e464260578d31362b3930cb009e86d6ea3028b5ffac21609b500d4dd22a8c56a315590b4c45283ebda979f827d2078f57cc8ff97191626dc207b153d0ea16ce193cb4cb766dabb252d71591d149e6338d7234af4a30ad7efef31858cbd4c870cc060d209eeead47a6c7f70b002afcf5082e1db726b00d173aacba2898dd7c1cb18ed11f7ab079fb2e4b058f4503a2bc4f064a8e5fe86c5866c6a9e5b0d4b65f8f9e74e2e64b5bd23bba18b2ce90be28624ac763ce50565f60d4de7a0f04e822b2d423880a2e01d7a77249cb5bf067e7755c45f106f0fd6fb87b21e5084b3e4dde3093b3143f28e1d55249d5e2d4b30d7fb94d32ae831beac7853e1cab9f58f02163c4dd58c23647ad59a2309156673932502aa4f28e49921964bbf077af3fdb738353353b7b730596dd864a7768cda0a39a1dae9058c606e454b74b3f235811903f669ffcb821ce61aa0ffe1dbf2e3a726196b2e0c5902d7e03a013209f686c0114c4695323d4a1f89793a69b5d2f7f8e737a6ac7b236e198e92d711a58d18adec837b3a80356a04dc3f2b47a07249323d48686d3c6430d8cb4356090e04fa8c7c4c406144e43c3c40cabb47195c60b76442fca448ec591111276555481d627b9301ba57806356b3eca0746afe4336f9e07514460f63aedd92e106562c173db1db8c14eac5366c0a5c685105c6282526e0b0e82f307dffd21b977a1b1f8498deffba9c46e651cf95fe005c60f7ff760bd7daef3e209d5a28708616b14039dca794e514c026111e0561270b75c6a0e4fb06e491c7c8682647837a9669435d307f7bebe7695926c4df6499e57822679dcd2efc7c4acaeea924cd06bc507645a7a273af7ea75d80a5ce254ebbc617fafbb4d2167ac3f662d407f2676db7b1e49e7ed93b9229553ae055dbb848a1d754acf5b9a10d59e96d84583017cf2ddc297770ca71570851f149a722a2931f5cf3676d5ed2c419e25d94e51a59ea3478f5cb6078c4144c2f4c9572c767a61722ce83be6f1a3ab5627fdcd5d9f57be82748101a928deb7accbdec864b42a09bd8b1baedf6cdd5405fadbf89f9a96ee299906914f290a5991249707e5661ea73bb41d9923c1d5864639627cce81caf043b3878af995bcb7a6e8cf08ac5317414260c5abbd23c5d51321c1baec22ad9650617d88d54ec32694768e8e25217dd8dc205802439991bb72232e807a1f54010ea38b841514ecdaacffcefd9de9431f3ba78b461af0e29e05549f0abf715da2f9aafa38e9f1bfe36b2d2df1837ec1c81a1e0a203ea237a010d925f2fc26e487553b9b12675d07dbde27e4cae8c8ece3f747b8d08b3435b316971d5b9461cad4352fd44acc596448ed36689d1b3ba1050d600eb98d7646425ba7f723a857017df10ef8b67644c9710911b7db73c1d82420852cbd042ec41202b708b5f54a787d1dfbe21db3d448e65090dabce93d45676a1f5e17ac5452bd1e7d2034d8d370736a7eda8ebf36207f5e421603eb98e21364c7f9a8bc05204cec7a5aae64e1d03103cdd0984a66f2b4b7b242a95b6af9e332302685caec3ca077bb58855487599b18ea34eeab0d1bb57628c3a6ba12a3097d3cd9bb52b95f86dc1411a40d8f93d0bcb72e818129f0680ddec3299e453d6a9a7d926fea92529fe07b13a9e15307ce2a52c395d3b301fbcb910faad7a795ac46e1b68364d22d25f0a8a35a1a9c860c799a4f1fa9e7cdfbb10c2e3b774ac8cbe7da7ff535f4a02b8074faec22632daa939976677aa3c48ed4d8a0d44278323d41786aa78f56caa85e6559640c55add7201282b05d7596478bae0ceb24d1aa7c33dbe9894c835f725e116f77c456f91d508869ed46dc63127c63ebe811297ccfc2060b91ce5c9d87e9b9365e12981a76ae57e37ea51056a966dd3d9574efb68166ad7be4aba46ee09054209faa7d6b751a9c661a84bc3d7dbf22d59f1779787a63d0c1b3593578590daaeb9efde9e359368f90e4b70b84ae7556a22c9ca8a26c32fecfcd17a21c262dc64d9eeb226ad86c2cc1f1715d02a58b46631cc378535a2d2b3bccaca395328906c3eeb0a900db21260341d7a4fffeaa29af074149da93d30637a06a072f782d1d46a8b351f02f9e8ad8c74054e95190a7ed574dad6655aa2430ff3b409f886aed8dee1aa956c1eb1b9bc941c56e31ba9366ee05613bd5b1ca3b980c3d2804a8636eb936b9049e85bfcee80301c4226be6de5de199564d557114fe4613b2121a316811b8ae09949ddfbd417799f4ee3bbd3a79d33c88899420b33a1abb7ba9d60472d8a62394a6679d1cdc2025eab44b2bcc66ccc3843580ef4ade0747b604e803c7b324071c1a15b02f398f28d8a71ba3f8d99144b44ff623f71aa4cd3c02427a84dad0167a5e14a3336a72bbfa521955b9d033187af1d91520a58ed5f007332f95f14306f3d1034ac4147cdbbc3ef3f2f9205d3576c7bc8b041980e97c5f69f8c4f8fbdff2e2e1864cb62a5e8cd4617c217cc6bc86e2f98df27abcefb0c59a847c986875eb3b808ef5d313dd2d05bf3d2d57beb4ad039a92b3a416f174ece2f431fe0c892f1c6c188cb8f1885c85c6a76e571917fe2b1f38b2d2750ce347d452946942ea82da20377df80edbac84021a57370033cd3124581eb581358fb293f89b25c681a7cb183b6b2cbb695da79d7d865d1c92ec8d83efa2c7d7454cf1c922d130f77e72d33fdb29e364b660b69d045edf6b6dc43ec20f5724897bd21d81be4b25c4a0e74708c5c0ee25134a227067434d07d7a2e0f7e416c446ee8d91344d803c96d497143587998cf84204d9db4925a071492c2c86b260030b9cf4fcd7dc899d34ce47fb3e88096d062297d4c6a9663d72e2d3c868fd7b5ba8ad09289ff144ef9a8484608f431748a49f12d7ee1d016437654133657e4eb4e13f27314cda4ce937ad92445fe2aedaf045928f7bd7a95fc97bda38a3dac2b4c6c9befc7f52911b065b76fdec9a141e315d30c6aef9e2f918c7d212860d755fdac7f3c324f10f6efa44f7756dc85ed90ab694e7b31acc5f94e1a8726064272a73923dabef9fc0bc9fbdbdee430e7a85544acecc4e33735a091b401fd7bc4e2778edd5366a383f24e7444cb9779a7716a28dab1e96ca6306a99b483b53e17a84a78aef854bfff55f9bb83fcf14a99a4874490e6ce48dd67883b75c246009222df5e5305c748ef511eb3326b418d2f00de66630c5abf55aeb36154cd7d19140622b6ed64dbfcc7a685da78e6a09f8abf87e0e46224e4d2a9a232cfec21084ad3262f704d51383f350712d848fd6d27bc2546937ef7be092224bc0cdd5dc8bfd4f1a89a94201f3cea26eab960b14420b681c713084df85f0e2801229cab2fa5af839dde94f5ab28af133cb5f4ef2ee049e8ef5412316791cfac90119ab32fe2a608cf3e9bfa2eb194bf3a34b13d39fa66c2eec880766a47ded936d57dc1655988ee9bfec5e0bc97db0859aaba2c9e450534ce51606d3c63a2c6f9eaefff202fe6ab1d18a73a68bd5186324eb5539f3ed2c4b970f2ad4ca65bde9a56ed6ff611ce1dd9ff509d1f4d4eef6be28eafedae254d4e785d3da2814e91afc6034e441a49bd0c8592e6d5ec5b15a1a038e29ae0e2fb7f067f8bbfdcfadd51e60a4cee0e3ea7135b5c92870b6880757a4925a2003414c3e90c3fcb2b57cf090f5860fa043f3f0a114b85a359c8ffb67781363cd80e841081f2ebc46146b217f2474b5ab60727be1db197c3cab6262d705c4aa0ddf9689e3c9fc3deb9b51583257217da1212d62a2e34428fa4dd958cf8984a3afdbdd022a370ae142f38c29224f6992188d7a1cdaa386b0f3d5640ff84da0db79a88bf2b4535701ff1338a0acca62482a4dfafeda31ef00106a879c2bcc2beff6c16bed0847a32458fbeff6baeb27c05277ec9ae0ae443a184e05c7409c25d2916adde420a2944fe3323e42e75cb950cc0c77ed103a6805bee94b93714054853d0702a1b8ad31c0272fd4a4168549f14e1443c27edd90759064d7cbbc1fa1ada7b9e67ef2cd71af3b139f482ed36d4e549118cea15011b7982a6d0704f057ed3a624813bd564185dfd0e3fb9e9f11b781da3643334fc91bfef0664d13f034f0054a5b3aa0a69fd6a4ac1572ae5f21b00bc8e909a328dad37d0841306bfb0953199bdc15a7f39ee9b77ec110a57afe80e0d6e7e980867e584cb0fd2acb09bca643373b1989443e73ea4b76dcb08f57bc6f0feb7c791aa739e7d07f2e795dbe5fadf4f77095582583fcb4633a499f5f55b0fb6cda17a6311bea7d087d3e9bbea388c0f09ebabde523530d62d7219c58a016ae3df3435fc65e0a6ad81f6b266c34975e9318b0b92a847de5d8d761f6e9061d6853bc49a49890c1e56717b6b09a3335013756b5ffd008fac39772994ca398a7e03d3974e0cc510107a279b5fdd2c94aa988050240495c04e37cb953537266c018912ce15234331e46b506fd79f1230bf7cf15f5b74d341a03d29543b1cfa8fb2c08bc1de8838b8b191e0acd211c6861607e1aea3505081ac085dc53194379464c4d172b7602052d326dbcdb33fd52a4fc465adba9ec373433be9b5bcafa40f40b240baf9645b84f64276b18300a2aef1551ea853bc7fabaa45512d7f4558d2123a6bb48027cf69899dd9ad60059a4abfbfd18ae1041be0d0706432051ce4787ddc00f4db3a2ac35cf5826672330c45955c9ff9c6acf3d9069874002b50ccd89e5923f25d6861d5e13b3f365126093a0990766ce00ecf9e39a99fd41137af71eef7a7d80b546249666e2a45d7f9aaa558e4a9bf45bcdce8ae2b81d22a7e486ce3bfbbca74e5758d748fe87994d5952949107c7329cc7228344ca0208d8b513201941e56f84e04c3426ba55c9525e824a4c8cf7f3e0a32749a39dbfd2e2d6ac1fe5a9d10c82e121cc512fec11041ae3e9d65c331cc93213fb0548c8c2894c674dcbebf31b4aa3f35fee0f925c69e452a9cf4d6ac0432d8082ca46672fdd22771f6405852789f30e3e385e996ac6c31704e26858f00f3523cc1187eef13dabe5142a581033f83a0699701abc3b6e5f6f69cba4db0032a1751429f88dc8e53c45f6bf222e066e8e665a5c05417575dae3b8614648565a5c460e997da497cddd9fef6a6b2f484b4496a17af2343b2bb7640aff360c6137e676f4a26c40231abe9f590da573e4acdd9ca46e8651578fb60172be82c6117aa0c3103235e8390ee0a4edbc945e9537375e40f890fffa9c8bc41454e68e4e438e8602b023c940a5aa99c85f0b5e53fe46cdafa2cfb5dab7d93a1beffa7f0bb8ef26b6c24c758ebd78a5a55e248bdf372355570bb6d1ddaebfbcff15d661960f164ecbab610a4cae7797720c9985808e0dd77617977b26d250ccedd5b5ae0e5da582e771c8d2e7fc5ef184f8ca4f0d9eac548e7564be890eb58ef8a66c8e6e523e9e60ef7df6d50237c7d69352d56810ab74f6de7fef12272065af3f4f838fec8a953b7fb4206bc0ee70384ad808b33afd1a1589a09e9b80e8ef85e9306b11863051b9830077fa664724854da7120b728f3e8d6da31c5727bac043425a879edde1ecf96bfc66b383ce5f5529dd2050eea505dc01522a9651bc93eda47085ec176ced563d7339dc451bfbf589657c19f48bd1f5595325d6620a65758a6cc12c6d948fad59dbc167a76fef2640d33f411cf365b6dcb508205a8400a60674ffe30cbabea27c70c40daddac1332077fde54efcc1fa1012585b107bfacff8fabaee8c98d72f2d0c1d3c4eb506a94fb83544fbc42b678bc077e4ebbde0e3d29754e08a97629f5d711339209d2d7c2401af1828c17a5a8ba5c85cde6823bba4a9d5e8f4eb24a85d711b91a043026b6e1d63a95ecdc0814227754ea7ac25bc3c83487c4de51ceb2ebe14177634a613915af818c1529776d4181027e54d451c901eeea432eeca3a426cb02c40cb8048f3555ddf23000eebbec54b126e0f329929e74176e28c668a0e370a9e7c3acbe80e49ebb38756217faf2f8d7be3875ce923dfd9df6f8ce3d81c06827bc728677440adb13ab51e04657d481380584bbba13b36449f9c2369afa87c4f503a491a9d7f846d1ce2ba31a80c14f75573b6aea91ee9a90f522b70933ab2dc77f28ffcb6d8d2896a18ad7f4ee15d20d5791c2166382db834ec293f4df3703726ede4fea4eb87e6fcebf2e44c67c6b793905a9c530580fbe3c4b7b24d5a936e2473e27a948400584455345969e35b157f479963cdfc9ddd1e1574e13833ca4aa3af96c7374e3eea26c546d57a750e01f98bf5558b6731de4d6ccb9b91c7368995f907f6d5f8ab0e041432f38b63cbf120e4021a43f41c10c5d89f007632c4d43642b26388f9aa488c4e0d5d6f1b8643721eeaacf60e0aa200570d6601b5a57c38a662af3a8a234e0c1a3b5f244ae550de3a7875cb93f20aad66ffdca37522000fba8fe62681deb117191781a2d0d7518bfcadc900a33e332877bc75ea4f5cb113e8753cb967b7855c1edcedc83dbeb054b2628574167bfac70b501ded02a73d98d4770104f32162881d84c17172150cdf26a261c01ee199b910390b78fcd8678e62eb3f4a20970bfab0ac1e31c926ab5a3991250a40aa7e0314ef0fc66e727da9d14a6e1c690f15aa664e21952e4ac87289d464428d82857f1b8dafa021249e20075103fad4c46d9d958b59dafbd6f49ce7d9127fdfe0751da1873927068efab4cc7ac617adc84ac7554fba0bd1c3158b007b4387346fd08a3d3cbab8c6d96072a2f1b688d02994c08685cd01b07444f40084898d70daddfaba6f2e44ad6b0066a6ef4ad548b204c23bb8009bf3303cb79f854f9b85cfdaf0f3f72896d0a98c35362f35fe964c4d3830345735c9dfb75fbc7ae512f24c48b330e8e4e6e149578d0e54ee5ca873d7e6f939ec238bb7258298ac1141c1bbaed9d9c7315ed1df5267b4d8bafc8b821c0c4631c7facae8ecc955b17a8016c32653520dfeef5b6d39e2e48e484bc01c34c7ca5088699cefad1297a1bbbb75dc45ad05451238654f724de99e9accef9449d17cf3f645ffc51ed3a679a9ab084f4752b05bd906efd021096eb1b3dbb807081edf32c03546aebbf99b1bdfb5f8387bcde2c593d0410b03eab1c1c174034a379401d492d691a437f1dfeb92fd4df79e81cbd304d9890c45293de3f56a32c7c0cf4a27118bb63492f6f6263187d8141fdca280b41063bf98a9d6af66ad599f30004b03675b2f29f7d5a11a95ce6d284b84c24d83f92be5ebe720a3f57513b695fc5cb91fbc62a64172abb85012f42bd1aa2aa0b29061bf9753ee70168c26c9763d9a70eb9b99630c3bad76f137b32c901f5f32a1e765f43ee004c69951433ea2e6114d244d9e1a1c684e2d6ce29849bc6fa3ddabdeb6032527ead3129392c02d154923244d970a89bbd950e4d9e4e5dbce7a53c0e910d187e8ff12d8a3d63bc6023509a6e7c7c1fc70e0fcaf535ef565d64ea890b58964df31a4a41ea695b9b8f1a6484a48e96761e91faf5fcf37d96322ab88e86769b2df439525a720f3839bd9c934055ffb157d23bacee2c939bec2aa1c6fe4775489241cb0e2c48e06d2eae4ee4de49c6a2ec4530a6655a5925626b1ba6bc6e98f0ab3db76127ee85b2f9ace62775e53f1d6bd0dff606a50da091630987b176fdd5b2833be91631d9a4d0ac7bbb09e91834245efccf3d51a8dff0fa1aadaca9575724d1dde38fda454d23df9ea922a519c77c147228e7b6fbd646dea12e15b3f6ddf9edb3b178c17e1bb25473f762df2262f3f19974f23dac95e368293f807f4fd0e347836398b4ff394df6db52c89997fc00c3a20166273726974d2ff62bab53108a34f018e2c9c20dfeacfd846f454e66740c509997092ff983459a4f0cf3f2d24ba61f5eb153953c555094e3c7ffaf738b047d539c02e2baa2240fe06b58f8ce545c9d0e7fcec61c648d896c010297a6ac1de67409c1b940dadfcaf17397db60c766d84aaa6de792cf4dac894cd33b34dc7aec108bc4543f203599cb514a9a624f30ec80af180ca41e13af3dc0915423f03f6ebdb194b577f0b034010193b0699f45f63eb0fcda32d1e63fe9de3ca7fe0928dcca389eabe9ea058812ebdc05302b87430bf106d1fa8588e6c2f6130deeb8e9a96c27b88b3d29755adec9dd7f5f83ead5eaba69de14f6fe587422434791fcbc1c42674441cf5ae3f68b2f2583e5ed1b8a12ddf23af115176a68671b46c899cdceba626e9d3242c5ce2ec6fbf51db1a2debcca18292c61046ea11fddb4e5a62655ae7b6557165729d7bdb9052e7c96087b70bee041e8b9021428a8eb7c05fe98a7b61878b28149597334de054d31971eabd043c36a7885950173c88d1c6d40aa6ef5d6cd3d9ec60a11ab5e38661525ffafcb32b0b41b1a7321e3daa933daf3d4ea08d4f926118c80e879c1bb3b4b7b1a93da35cd4af1bd7e65042df6f16a268c84642681aef34ade7668dd743badf38f9a41b74f7ee901fa2066b83ee8b886ca7e0f44c43fd246cf64ffca3bfbe8ebc4829fb70a3135527530f7cfd314198d7b71318fce89aa61004d8dadff59c759166bc9efed4e6fc7efb4cfd799101c29e830894230886960f2e69a0f1d5d2b7c1b6b62d88874dcb20f43bd24f3767f5517cf40c6b9493d80d02e066fa7a5f50a3e07f39f14e2dba794a5bdc34b30ba28860d52a62f6a3f3f65c8b61b3cfe15b86d49909102c055e0272b5ce3fc43c242286a6fbc06916a466aa5d4d86144ebe91f13a5041128f7197f7fc336cfa1ab004b8363d71959e03b4e9e544bbdccc4c575d8ac9dfa6d427a69799c9ab907bcb84ea74122b0027ffac3f2d289601238bdd343f466889b23562a4f0c56c98c5d66f97d3a9af70a5af805b03bb0a0d3a2e36c252668667473bfe0abfc8237e6072a8b73e8a6ca362c0be9261ffed4062cb7f17db02c8e07c1eeb8668262735a08c51f1ce29f492b2ff8a2c986a6f6c068db3ae8ab340b02e0eafab1f38a7def85e9779db2ef94bf995a8dddc7e4cb98c04c5b593f027645a270ff6822c769445526e4d3cae5f9262c9a902b3d7518c4fe63e45831ff4f3271f6b4cf5229c458461f60cf5c3cdbac54f2043362777b87c30bc5e0a7fdbb75d24fd84d1524905beb50c6a5831e571a7d755996e30ad7bf8b2cb47e2767aa168b852f25a9293fb61928f352839d93c6d66546bad3b28d3ba0d785b6bb4245345f0551e059ddd646757aa8f0bceb94b9005b139eacd233fdf4ac29a2fdc46b093791ea77648868fe440d3de4e11379ccc49cd134cc20d89202e72864e6872e2f8da4a1dcd9cfb3e3bd7a200e218b2783041f45ae9d5655ddaf823674c3a4a2395b81bc9ed0623ee824405e52d521a6161b560a041848c8afdae7420625043af8291043be603599e96f9a1d737995a64ae7e985f210ce92a80100794451181311f7a56e424bb3d779d957e638d10b8d820e98224915d68c0857180902a05f829456db7ff273c5260a39df0c981fd0d619cffbc197ef2de7d338303d580e2f497da2781226368cfc8724060454d191715501d56f04720a597adcf59d07df762f6684d17d6ede9e9ca108fba57fac1e7f71ad91de0fe1953c4ce1a5572748c0ac2977f6fedf20cd863f992f20cba89244ad2ee86952a402006de5a57d67ceddbbd4a7a5b7645dfcd50853cf3fc148847ca8542deb80c1d80796a26c0e026258c4c47f3c1da8e4dc960cfb129010523e4ac824180d0f80fc443456cba58129d31f690519b3b918954f545fe70e1929276cdb8963bc0f86a4e2cdb6d09b991c17b6989ac2a196b1854454b5602f6d599592a8520472f3dd3293ce8376f56602774e80cf77d14bfb99f41a95d31a2585262a3640a24dd2c86f15b3d08dd884ce7fb9fda872b39b7074d7f2ead84a42668ca8cac7c9c600d8dc25f576403ed56ffa98181ae8bab061b7855756900b5b7d070b6a1f7c53f6e75c81260ac8bf772d710a16289407bdcc43933bffd59cc04a43a95cf18a8181c6b8bab23e1fc82359b96b3811a7ddf2d394fbc567b31399575795202701ed67602f7987c4c9245c5727d2b76ab740507760953417957f17af78bac3be135d1558b02e77b68c97f38e57aa597131eff894eaeb9499c9ed32b9c5ff87cbbb08548ea6681f261d82dbc0e9a1eb86cc3911a52ec4b63e69df9419465e64ac0c1c7c35386b9e0319e44875c840e93ed04031466de7004a5a5276d66e6c7a70464858ab700b7544af50c431f905334474a18b9e2cffae4e7487d81d0e41526c1ce578954064a8e4eba929e8dd19ca01bf3080c4e784569b50b4254b2b2546e6d4b78500c857f5064c6213471f37d2b32016443613d91e5a0687dbbda43c7e2e70b368b4d482c51f62e3b080580f91523ecb1cb0b3b6bca38873c28bfa2cdc5fd9e542e7a8d1060f0d644ddaa643d7533458ea3db8e48f3f99a9fb06e9e6727cd250c5cec30b78628990a5fe5853116d5f30f216401edaf8b03c8c3b5cc55516fd66512a7508f881eeb58ec5e775b5514f5bf98924be8414280a4cdc08ccac205e0d6d7429f270742db87b7c3dc2d5a2dd8e527ac9a3fda407194375fa82bda88684dca3d27001b94abb85bb031281c4622fa48713b0436306f97001de097767d89299325450de2e53c415a6f8d80899c2eaf8f61a782caa38f1d43ac8517ba948a38fb3415318db12f6ab2d004faf91238bf4e1a218b71eefbe4c78b55104f76d813f5751114d5c1989ed121759d403f76b69d6e252d2f8f789638533e66acca3a4e7c830688ae6a79d6f11c9780f29abb11e8baba1823004badcb0a351f309534d158fd3c1399ae84ddccd570235d61cf0eb8f6eaf6955fba39532edd2588312fa765f916d35317d72e76993f38f27c44a000897b7a5549daab0e6e43914e8b47406ad7637b8bcec7f0a599a82b17625fead203b278c4adb2638651e5b16002357fb728ff4e8de1eeee11b9ec8bc9dc108d4a2d1fa05185e87ed4a7f047bb0056590df0006550bc9f7d5cbc7d693e0038ca14b6f2c09af9203afb9605eda45dd4feb57acf54a3a1ca60a72e8ac329f468f673536e7db56008bf8bade94f99ddabdfad3be036263cf1bb391e354a3c6c99155bf67d84728fbfbb28226c6c6911234f0afa9f92ba269195afdb602b59502d1c68c7828a30ce21b2737c6bb86e90ad72433d0891ccc97aeb52a1158f38471b4fc50f2b7eab7f57a938ba2f696e443edda4b73aa2c149b90b775fc7476fb904c2a8724f7cbbe85cfb70363819cdd416dd8f5972e72b3cecfceb16f6ad3200fb03f4f6b6ad8d6442ac9f221dd6ca841c2ce918ec179635519582080e273a3bb5bd871d3d5405854d0c041bf8623237fbf1106ca3b6baef04118087ef80c522ab2abba625d228ed704139cd9303d6743afb305bc16aa644090406e93cbe17fbdff1815aa34eb135b0721c3626e6b5ff65f080ce5ed9c9d0e285bf3622af3a25d4c9e2ca66775e4723c5c128c5a1d47c9b28a09308accb958a14f66f1b8046ba8e9b680c4c4bd4e1eb63d4358037bda7135f2bd60ebacce6f8a037e87f49eaa51e210dc7cee9e8062b83f69fbcec6904223be5e1ccd80d25da850cd485631b5aedbabd43aad83839cfb6c1935015fb6e2b88ce7d5695ffcdad47ba3bcb2fc33c460bbad4f0a4f657590cfafb7867bea0671d9bc9af2dd6955012ac57d738389f7d95405ec01426feaeb657473a65b01cabe4050fba46d35396e41a1374d3d0f4bad025805d78a659d86952e64b4bbccb2a3939b8d30113c2fd195c9dbf2aa02cd2d7f261f0d9ebdfb6c64f5eb455ded4ada85426ea289df28486e268228c09ab1717fec266aa644fc0c397ab36978d8b64aa1b2742b317be9c4f33763316cea1f0eb8575fb4a1cfaf1795eb4f74cb06d9dacd664b7dcd8134a5aaae0d98a5fa35b84425112823b617c36d1019d5bccdaf75bdfee4d6867b2ea87a927d7ca1986efd1c6d821ef5ce78851b58d028c3f68131e6d07cf3f4211fb94ddc06cd3a1f1e2789397762b97b0386eaa88001613b1cda7564c96522c9087d7b2a21056a1fe416095559ee4de13cc72d53c9f36e047567ec3cecb99b39867d9de142e1509dd688915c121b2dd62ba6ad8aecabe96d54d9328bd8779b31a3017a15e6db7141047dc16e36da39da58f28730bab8a891148684adaac6a43d64e43d8b2c03cb7fd7efac7985092dd139d1a3c48a236bdf10c6720d669b41d9aed649fd629cba4fc8fedd5faea5ca6f965215feae5cc04d626317259c87651069837c9dfd37aa1e5515a60e9a0dd207d269632d08320fa484b2e3a53e04cab37a84008b392e5e1a158c225790562070e0360ce24658c9a2cfec0c6555cb81ca37ea9def495c52db0295975fc18e7baac456718157781d99a481bef18a2c674dcbefd3fc68fa6927641b0350d53eccd092e99527dac1895201e993eab4be8f471906500aa7541a061ee15a491944ae22e96e66a64c572c275eb5e2290b0a7ee75563b68eef7707552bf402be1f78520b9fba43f70eaf39f62ed7516881f249d0d472c17379ac73da4534db62287319ff37f8d24bf2e4a1ff9f690dd2226ac089412518002f9fa45e999ec080d5680bf1621aaecabe3283ab718ad8782d5461b51276e3af8c79ab3fd516ee15169a60361c96ad5ee96e11663c98f169a3600037dfd8019f7866ae40a2264ae0de5639a33aebe00539d4e18a42b2ca672bcffc12e6ae1fd4b46225713d5d12a8e9af9920011c083339110922e7dc93bb50cb007e0c9a3b2517279433781e5899f67815e20b1e91cd5145d5f0cbfe06fe203a1792154e0fd4543cb462cebb4505cfd4b343d26f95128da2114d7adbc19d4e9b9775d3a68aa5b5efd55fce127e8fe163b13141864cc16b4d9ea6d6e6c2de642094114adfcda610f9faaca1228834013e5fb812129a5deef4a7a6e523a4ddec795e82e8d972eb722626d8a4a475e6f9fc13e7ea9193c702409389bbc00ad2710f28181596b05be2a08c5c8a7bea72bdbc2aa896c316d46ab08d1ffaca186536bdb2f4e834470091537aa5213d8131ad4f98fa1dbb466da724b8de4e7c5c758b1f1a8ae790008c5f22b7d45044d8f327942e138cd58d63732a8ef6fc82f7f89b745421bd027e4f67759c0fc81967bd3243b9564a2a2c6e765a360414976614a5e84c031770e4773803b1f3fb105bd610ee1eef8288832fabb449c4a6593ca045fa87540a8c4641a23d12d153c54ea57686b12ca5ba0dc6e063a3a616c01c7e0b14d834d78e9a813e8ac356304512a55bfd9e990fffb6ae656802b20e6adc71789c20eeb10251de346fba3670e7bf4cc9fa88cf289390ef92f8c89a89d3766e17592a71c90a5c755df1ac1d3b13790051c0e8a361fd2bd3573129667da7e63aa451034498fd697dcb2f20c624622af64398ca663615f028bff3ce0fee340325997e593cbe38cf824e49996b6c0899c9b5f708f15104068c11a4640cb58d4174f1c6d56c235450c6720e868e9d8e87bd42a8e8d49f94182bcf9fa3ac875acae873120a32a22aaf7ec2bbb7c202fe2ef0612c9f89935e658576b6b885a04cabe4b162f002f1c4fbfc5f225cfe1e9bbb0f114c8d765a16a7f0c95a61161dd8f6d3c94d8a3c3aab91a820e8502b81148999361cf69732b083736da4512f67cc94fe1164ea7463ba2b595af66a47fd1e4f38679655739c461e91c9a548f88ccd884e879e7c6745df3dd1df8f4b2712e7074ce32a3dc24f52f5a0a754b5741b5ae04c4de8f1c1d0dd48922905fa9267612ed81c0e5c7ea81ccb56f829e72b4c346f0c796d7676af2857cc08d0596431e2dc1be2ba3e5995d0c674a746d81c4ec9addce7fc6d6fd0b269d77f670441949518c3f0688d35167557fe91eacc04b72b48c6df02ee10a796f060882c8898e4a23b1f9e8133f7cd644fd479220d768542888c6ac80844b047b4727c05a3ee6787848973267d8b1bce926a0ea599dc10d5bed1c12e0a2cfa0bf0bb3a1ea7811c4fca2235482888b5d5d9cda355f1e6aab2e6612128894d52c77d55968cf4910c0725be10fbf4ae90611828df08ff23fdd02f7ad39b7f9968fab6aaf7ec22b74b119ec5010fc35033af282c9b22364ce4819743ce834efdf05ad6d0d1a75ed2a3465b5f617c769569f58c8c0133df6bc7711ac234fb76fc9529f97ba43c3de0807fca83c344f1825768da188cca57cba9257b880648840437c6d78b6d2638f9f16e978ab56c7929076422200696672daaa9c82e5b936d7453bda69a6fdbb601eb6e8fd2d252cf74f43b5b97a1d3b00db87f2bdb212e4c3c6ff44aa53b147183b9a2d21e514c2d309719e97e28e0a3ee10dda88ea66ff92d987b16e43e2cac54de4930998eb53bdf5ef3636ed6343ba2d65a938f6ceb9742912bf2bf70851ceb72d173ce34fa71c18533300aa82c0da85bfb8745d7f65c67158b39cb145a88a0a169e0cd42bb2e652308d6764770b45821e1f6489c824b2c4dd7d74764490f12788b9320965b0b3d355ff233a6e614d3b0f73429c2eff48643ae299f4ca6fb023eb6fc42b7109a37e34b00928ef871977ac34da96bc3edd8e5a2081969ec1d4f6223c8d4ffb21f219b2c9ea1e762f2d4e36f8f404f0b1c5bc96a794732cd8adf8eb28154407abbf0abbd70e806ea964e7bff3263cc9ba933b47508cb78719fbe10a2b1ea0edc856c2f2f76f13630244c8b769df7f5bb7794d96b9e12435d04d8d1b7f1e00d7aacc486b3bcc9128e36771be262f593e44d1f01ae6242ff68082ffcbac915bc8d17171df6717f1ed979159073adc3ffc1f2f4ad5146e2ad2e90bf0ae9d3676cd9f8800861f4b93bb9ddfad1fb525a78c03f9368e3a025b622b0678811e6b2be77aee323a0e09bd1f69053ee36a74d52ea45aa32604fc6767dfe63fde26d68b99a24a4bdf188b17d2f24ac78276bf3463b99c2be32cd21010189716021234b315296399d8d6af785d6a7a67abbdf62b0f031163c30d8b59c7b609fb78555d9342be3dae893f96d76f612de6db75cd4522b99d9843992ffee8d2e0128d4d91437ea66fdad52d42f0ef55df939b99e7b0ba4cd0eb07465232341f185b699d626dbbcd2b9bd26dde8082fa8ce8785b748e5b1129e33415e43a66bee3c1080852ab6200b0bf6bacb13cf09fb7c72953accedc8321b356ae3a8e42f4279930a65fd08a2f0bf4482b438361623ad1f94b96e03102939b772b66d52ef28ece7de6f20458c9f5b415c31ff518fa72d2b9116fb29957388033f63d0de64aeafc4b543b71686be11449dcd86573c28078191e14475311acebc9326833afc843fd88b46afaf9a58abada27475b82cd846c1d5ad948ed2e66657e90fa244e61616cad7d373fdb28897c34d8fa0a484a8baea2c21b6296a272ed48fdfdce0c08b0f6c6c73c883f629b4ad10fc5c1014e872d708e01ca7e185142af1c88b10e285ed69934b5c1e59991298a6a0180368d8cdbe7014144deea12911e39cb9f8e9fa7c946ef5b7a98aa04bf7899eca802bdab1c640462eb891affb7bdcea4686c15dfb9eff488321c919516a07e680b28e9b56474ade4b2db1e9e259726d1a52a7a4821f16752671b22381b608911b3e0726d44bc17923fe8d28a8e05487e29d8ad7b7b05af3702dd37f8a6089c4f383654792c6c09c4b9c52f4fecf1490dd3cbf947360a0ad902078a984f625d42a83b24932942a9b7d05e5e0e504dcfa0a51ace9dd3cc79890f537eb9adea8d195a9eb3eba07f42b48e3950db297922d2985ef37ec47d84a441c5d63ecc09d9b47742ca8b3a09798c0c625e239b699b48adcc9ed1f495d301aea5263035d69de9b0068781005379ce136d9c6a13651d89447c5ce28e071a4aeb0787a01b39507e0a28ea325c3ea6b596e48a4525a7ba4fbaaaedcfe94fb763230e57cad08cc19e173312ab870e772699b8d6d1bb44359a0510b27dec34b9e0758f40aded644ce6481f1236194347124cf529ed35a1a4356d63b6e162a2303739237536c2501a36a68e0853b7a5078b4b3c231e85d14d6d83cf6f08e6b09e777a9b9c6a29b859762705d66cf4082dc479729d8a2ed613ee805061d5450659ccb991de5be9a2675d992921c229cfbd4c28d64ccd275563bc2d4f8e2e48e9b98899194fc0e0a5c25d911c051b27a4bbb86b4af5871a08aa60137770db389b9fe13137be2aaea8107b6cdb399f9db6e9e1dee029741e15f392f86aff65f13414e78a0e7195a2fdd205b8900ac4e35263ebf066f817dcf7e75a58590b100af999049dcfb72ef836c4a0c778e88682076b01413ee5baaabce7b9ed93c4fcefd147f54b5dd2795c8f376ebd34bbd0e9ebabe66f167fb4fa3f3a913439957f5fe0ee3dc482901ad97b76144c254f7c569608ec1484be6cd5d5e0292b889e7814abf09f4799b30f2be4930321ca16f2058e3076c4d79825c0584dd57afe938807ba4972c8326d961356c6566288b612e83fd38ef9a2e7940c8c205b325c83d023e3967c7e254d47a73d07a031cd42f8b6c66a62634837edce6fffd4d6f2b3c27f2b6fee0b1a88b8cfe7e85be5f6882fe435ba972249003245822a2fac7cb35e953ba81a3293a369188db9c61129b4a18fa533a02adf5963e6eb4d56a394fc33624f84f6f8a63abec3ea6b745568eda792b6b3085fffa0ea8b4b27bc6d812edc1bd33c78d087cbe6cfb59dc727e6400f952a8bb9b6cf51ace7482c4ede2c761969bd27b137f7a72f97a40e224ba0e9645bb3bbe747779696727d05cf2b51cea30b5a83b0d4a8b756d11ab868d5acc1a0f6a9df3609654d8e7b14bb00fe1ccdb011bf1323d3b851b8814f45f091176ad0ca4a86879bde27d7e3cf25a852ae28e1ec7415247b13c9a630910241351b95066541cdee3b993880a938fe734a333b1855b3d106b1cde0245f628b50fe78a02f6bcb35f6ca7379a274ef772033ce238cfa015e408e3018d9984d2b78e7310e0c27434874aa262b01a2341f0c6e08e3ded85d0aa54b160622111c77488ae1e8ecbfc42ebad27b5ae405694ccfffc55a42c9cc36f4f6d81e0795ac88700d8509ccd07630cd6df04dcc84bcbc1753d9ad76f9ee46e966000324398ac680b4048e2cfe6b2ca3ae5e1dee62be2a03d961fd9f0c1263a0001d7f268f20e3141bb3953400d875d484f1309b21e499203c249fba0404b0cde006b0eb85ee120745804b6df97799580c98db2fa7e1bff2454f9f67aba8f76497ce4fbb7cb7b6c3ca027e28ae2a22af5bf10bf0dc5a972fb744df263eab02b8ae6f7fd1a4092a7415c034e0ecca822de404e328d415b6a4dde43455150109b32e7c459eb1b3f2044c347d274a5d3a5b60e907697172b0572afa934e63f65190beac22821a102f93d2505fbf9cfaa9ddc2b440fbdad41186d647c0e610d547d1149ac574a35b2f47e5be15d7d9f7ab44aab8fdb7018e864c7f7cbf5864820a3aef234fa3976f04edce9ee54eebcb5b0f6ad3f350eaeec1223e5d9af4154485e2337ec1478693e38ceca1afafeabcdac15fa6dbe63c99b4fd0bed6e1159ed296397c6d98111bf1351648a3f51c01e139bea4750baff465a031bcd37cb7980a05b10ed92700a6fc1a3a18801744604adc7383335ff9a63fcd63f952dde0f359263c0a136c4ee759e15b3f5ceffa8922126b4c6c51e86ad9ae1567fe0e4b8f0233d6c689a0a2e62b8c67a35376f89bb96db168b184d44f34bb237b44afabac5331195f41c18e18405f5d131430a9db0ce62eee02742d792cdd52442dca812054a3b41873121e979fc6ee8ba30f399eb15c544a0c98fe80d5a9b192b997d33c0c08ccfbefdb789ad18f05b278080e99c4528bf8e841c8753a93908b2de5cd15f5866a1134492adda78fdb49704eaeda3de630d276a24bd31f90f247464c7e10f5375bfa10bf660e8b51699fdfb085010def99c3f0716693ec42e0eeb98caedc30743edf1b476ae1d8985550f01dd22b887f23f32034185cfd68299a38258b71a280d899a01d7a47a63a6bfe038c7fa187634011e13554da4a44518814fe99906b9eaefedc80e7d2799e2dde63a06c2509c9a9bc3ec3a994a1531edcf038088730fa81085d2009846f5ddf97cd865e1df4437ba07d7e08c3decc1762dd7de339982684981d6927c92dd817f4a61ca3cbd5d9ac2c782aab52e2bbcf5515b18ad33b735a3d03552ad3f7737c1c4c41d136159acc73be97bc215aefbecd147f81b50138cb5e015bf8c5ba0f278fe9ceae74020353044522b4de8641687d03c37e5966f443a5cbd75b45c98d929396fa4571a5b814f641b076f764bbc008e4b48f46ad58174cc6be9c5ae408cfbb65c25d7e56830ceae90caebc7cbb2e6ede208875821b4eb71153153762507f9f6fc298e004093728bd925112cb00dab1fe52dee2f2484cf6ff16323333e161c699ff42e625bd9dcaf424879369109f9f7e261f88e402f44f1e63f8b3f28301e22364e2b541db3a9cc056a6c19b2a38968b9038dfe1bf26bc14517945703be011f2cacdd8aae514025e307e2d487112900273cb5fb259a0e86923aa19c1d84567aaa56e3089f2bee5c094a04235887dad875fd881c2d18075515b322d93b6795b8a199c0d0370912681180cc3a3ebcdac703e28bc0d4aa6b1b3c1425fa45f8187005c4b3e1ac85f6c094f2d4630f8ab6f612d4bda9b5fb2604f2b879974dda1ee78ebb9f995f28d3789752c9ec70d6edb005be46ea9c14db16a486f36a470817fc201557ecfb36ea05f0a1280300ae2028b402ec0a0205aeeacc4e4001d73d55ea2776cea9b3955d7de3fae16760a4899345893758b100cd5cd2bd99efefd0da5cb47547f5c7d8061ce15bfa7e13ffddeb87b6fc2d68c78ef5473d879b892f7fe017a6b61b5dcb2bf50e6e40e76a1691aa2a5165633ae95b7fe856a02521685a702955d6f76bdc1bef875ececab0225fc9b23d99889154fb99ff2048246abd8ee89166be900e85ce96d3a6b7135fafd5b595d26fa4ff2c032a5940054b0f6936109dae2707e242fb06590a0cc3eb7c01aef180d9a51df6155183283857c639c5efb7d3a27e20394ea9c9790d70783b0f22502a6d2e8a6b9aeccc1147ab6396d613cee2be692ee16ca660e3e2559b3a054a8e587046bfc7f250cbce018d6fc813206e5c0ef883d52ca76fbe3b4235952b32d1917219fa3bb2aad1ab4b1e73d63d2ffe92ee544ddb0827739d3e278a086e07ca19e9e36c3108730f42486d960fbefeb58cc77cd91e1fbaf51e7ab4adf64998e3553fc15678ee088246b000c688cdd5bc60aa4f6c43b7fffddda84086774671b7213cc5625fda009ec960c1883fa1b9d42649d1af7aa69c26518d86b2c7da2826163ded6d37258d1d5972fc309610490c160643576fb6490d1bb1c2d17a39fa0e4bafccffd024252b0e185727c2ada6e6c287ec130d18f7784fd4f8f10492c58cafba3eb48c2e30f979f3795a3dd19a2b40c97d386a9c4093df6e9ce9448bbc1464a9d37b545f1eea0be3dfa5ba2a1a066a23de0eea3d04455e1a9d1d625b9f29cccd910125805ed68a60e8dcbaed2db573f91b7a8c73e6c7a5bdb99b659077cdd6450cf6a3b21efde1e801292ec4a445956dbf26e9e927fe831afa9311e518e7134d697ee3f17c93c563ca8940ec8bcf96eca13032b7bd86f69621fed05fd3ab93254af91a77201317b452bc1e3e02198312993a51040d4977af4f5478b909250092780cae5dd2e98867e9d91ddd7170c1e2203ce95fea58bc50f84c4607cf422f753d2b9f27e21dcc9a61d139f02d355f19818d14c6990cf08e5aed98859f8b21d5a43100d35014333e869e5ef4446d793807974c0d9f6acbf56f83444e360011b26aa4bbabe8e1eac1200876265af17acff2b7db87486c95e741c9c93d1a621704a78c9018c953d7a92c9d9ba5580978e3638f8c2eedf63b79e56314f32d3dc4a53477d33234094551bc105695efe5f627a19a25d92ad15b125635aed8345dea1b68a3a6d9a896baedc4211b3d7901d18d051681ddb866c1b2e3da2764eb30146d55cb03397ae5adc785f063e8890cac10e8d752165532bec1a177250c0975e806d8006ac25a19b2a56e0fd3d829e0bff69a2f19081c9f05bc4d585f4404d869bf296610c73d02ba84b97a95eb4f6d662545a0901e3f514969b15f17c52a6168effa78dd8bb7367f190dd087c37f84d7915f6a80a967bb3adefe2be136cd2a5331cb1148e1426fb5086cd3af2f7a72868c809519439dc0d4051be67d53ede8e36af119d992303af694d84fe1f4019214ef84fafcd4ea78bfa6c586fd75d08ec9a46ee2c9123e962440b7e60c7135edd7347764ea8984e965d213707907ab89618c6fae39ea69f6a138aec3725482cb09af6e09b1038651274c2526ee9c123de7df6125416a84dddde4f0b3300ac31a51dfaf9801cafb06644af66b0a5795325eb3248095208a40d08fb664fb6975f6fe79ca698cbde0a4f3a4658020bca3d61de7f94ef9cac180d750641e161a48ba34f03388f8a4b619e7da08ade61bd39fce052c1bfe92a1b6e6acf317b5410ec0e559710cb5e56b31b1c5ceb90609310995b3adb7c782dbd70b7b5e07c44112f3cf1e75d049a8db0feaaa66c28fe542a595c4adc330683a3d3241d7a947af477c5ab56d3885609a7de1afa8d52dcd1b415f3025a4e81c903acf3c0480b8a26f8f6a57fc970d944820f46a78a458596ea9ec917d7bfe0a419caefac4ffe1daca228727552addd2f8cd6e82ab3c89458b0dec390df5686e3edec90f52460c4d4243084bda018b771bfa5b71ee0919b10a6e0d7257910d46ddbb4f3e50ff647cd9b4b6bca17c050eb9e4675fb176a319158859ade2ed3ddda7cdaca5c6215f3ae2f43f77fadb3225ecda5eb71da1cc7ea133ca58f4b1e93895208ef08c35161ef3040d7d8ebee103c169390b70691295c4dee48e033bebba9d5ebff71fc4172ec10b15dd2ee17e09631a5d3a65a16affcc550b72b9ac476355016a9188cd8916faf4d2eeedc3978bec5a9f0da402a42bb939813bc72dd97d0fa23ebcf3012ac2eb8a1d9cd53bceda4a286a2468fe95e292c2ce10828393c42e99545599417140d5c0c711f882568e5ab90b99b36a6f27fb78193d81d0ed286c7826123745c7dcbd1ba37a5d488e860293b2d8dc6e57f57f7f6ccef7bbe3e9624ab1dc83d91415e7ca99335a0837effa7a76c81768d49c96a45b4f453fa6df340bf459243fc2850fca0cf97633f6d811e064334f5c3a0e4f3383b07f6ec44b92df06b476a0ad42b645d4f80183c4e43e6bb17a5a10866d7976bbeb827da073f8f3e74918f7262396af5aaa03991a282705838ece5d9ce65190eefc0dcdff7ae53acf9adfe32ddca7c3016f7efe11f89048a658b08abbd84be82d20eeeed3a50f0aa9b8191dcc2bbc38297369a3c0b5bea18931ef5cbfd3aefcc259456c36716c92391e1a1e89411a6bc41580e375de5220599f9a5ff8925279ee2a9167d4da4ea3e5a7770cbd9b1186d9d440e7cf0d20735fe569585092b42c9a2805404fa2b82eb383fee202103947f70103279341a199a51ebf93c66b1fb4f830f6d485418600ebc490ae6a4426bebedb2151a6edb5c69447a2be3498279c0c44a6608f14f7a7afe823cb7157ccf4af53d77db00c89c8a7a7fe447c2ff62ac0815f38a5bbbff5e8144d525787674b71b057fbed43e5a3964a86ca65d8ae1e057408b5718321610c6a9181b9f906eb174be0e523a798a90af6c10447c1c91a843680a27236125e70ef3ea6725c46dcac049a6c7e4592a6c7c0595bc6533154b7386a76992d0802adb138f889d3dc9547fd053e034bdbd89376300697658d3ea3c65a1a8e7e4536b152e8b3d4ba13a133a88646286cf2807136e8625057b8b4487a5251d811bf584ec5e1b06ae8b599ca89863f7a458c3bf81f8dfe3c01611a0ad66634e05e1f792d22d53144d163a3c0f2e041721d6209a2ed375c6a16ede16083c5d99f1d16d2c5737ebc770feadf94ff04ea419d6bbabe21756e0a3dba69c24a6dd6415bf1fbdc29702be654f6f701211d1e500b1513e4dfab3b22df35880c720b89ed272c6cd05884612e707a1a999c2ff079467928a8610bf7d1d0773b847286bdc70a9f9bb583b911a6a4825356fd9c80f46dd099fcb470a2ceaa94de14b9c3cbd9d841c2a540d611620250733684455804b027fb3b79b622799d41ff5e269c6105db5bfe3c2895795aa69736ac3266b122eb39ba0bbdda7fd1591dd6627a34547ec766d562d16979ee8599b135d4bc0220209ba54e35419f2e02376fa60458a80d5be86fc1a45e9dc9e2a59808385339a27031f9130d72ee69c6a2777e2bb4bdf005f8df394a5363e4b339c5712c478d074013aee164d052c452175d398a5a7d74db3c140075a5929bc380bfa222cac7dddce6182cfaa6800bda613b1f047c87a0ca3a2f05e263010d87b7c7dbd3862400b6c0fa11c4174d874ae1ed09a818f50bc6ce4972d9921c0759532d87f9172754a6a4b68ba1befdd6c26ec2cea8329f27b5e56ba4bdc5a04c75da8d921609233566fdf8c1ca75da02ea34ceb299682c1c2d26a2451a2061a1db4eb5a47dd26c482f1e6a215308c3c36dd7b9267d6c9e44490fc8ab30e12bf235101a3ddcfa6b000988dae5e8824f619dcbcf30f99d45a51305544eeacda2b6c4a2ad1b5111f11ea6785f50f9a87503616c29023883b8bf253a9483bf547073669703ec6cb338be4d5127c20572a9867a29f3d74f47aa5a66b3f72d2d4a33e0fc551aba46d8d0127a22ce6e9850c7e072947715871688734c7c5817753f0dc84460c3925635ac52e8d2d10bed3380d7432b2f7b5c81d8947e18c6e3ef03dc5411b84f555e15d17ac9b8200dadb22a34be04c444f8c5c4f842b087625b7d8e909c621d3c00a34c369fb77884e6a56e49b8ae7a00a76a21c63ba429760aa9baafbe2e54b2e997d424512f4e07b30f450c1fe30cc1ffc2bb451e2c31378995c3620222788081906e356c0bdecdaab46aa6ce7610fa502e8af1371ccce397953857281ada36f898f198853ef811d15522ce86c3ae6d38feae0c102e2d125ce8e026126012dbe65997b99ced8b9958a399f7209df3ccb1924ab9792e4165aa37e13b1c77ea1cf82d9548c9d21a295b05c328980bf0b54af0416052ef8aa410ebb14e3a81529a3b8e0528ece0b4d474544f38a8dba715ff8903a4a3a62e53793dd3e5d7ff72edb8ad570fe79c7bab199823901775e70998521ffca29a473fc6b00ad84b7c27e2eb27509ccc380d8f31ee860a723fb41a3f47f00cf962715d8c8ee3ef5516cc9cdafe8a90823d67d7367bfa9412804920a2ece088f536179033a4ddb5c45bd76fbaec39b2bcddd3b4293c342c611094e772219b674554a32011347b1cc33b757b07e9b715a3efc62c8e1f817e1a9aaab01850e4d7638969b88d8062a2afae0c34a749312819adf08cbe71f6c2981c323f3bbeab51fc5daecc5dc13ec7a7496a7ff01057034f56120b285841a83039616d5828692abf695730516f30af14885239fbb7f14c03bde8727311ca0bbcdce1722459c882d1b81aed7580cdcff1eff10220b8266b8b794d97947f47a71d378f670281e73efa151210e9021e4783466cc516a50a8d0d1d3daf3c2dcdc877934d2e9e5624de726077edc28081c55fee3f74365fe73b91a945adf985d609707a3f9e0b4a69d077cf6a1db75bda80eab363c568248e0172a09a9b8b7fd32c5c805e25cdc87e4083c232e0e4ad658aa1a9575286bfcbb63a8c33e033827fed95ec93d89330ad0a9c5299a6c446dc9050e442b14c16ce0a6c122c6f2bab52f35e90a53bc00f5295ef6792421a73e4b91e822b2e44b037f51ae82c1969dfa368f06ee00f919c57415a44a87099b316aa85548c395fef518094215c513b9eeb446bc00486042c9c576fc52f486938082a1000ba7f992796387f227813b06a1628665d830e2feb6af005f48285ba5f21f0a093fc8a41e368e44eea5e7d89056acb05f2b2217e530796692d61ffea09a71b02703278ffc4f25069d79a6da1881751985b05c56ee92c337f423d31f080dbc229f3d2a1b8c0bb7d63ca2da3d03812ea31f149800bc0f092878458c3c83ced401371494e9fd0ed3965f00e6fd34f14065b666321fc932e56734c318cb08bf45f1bfab2579ca12b1078c423e01ead8162f1bd51cefb128764596dbaf341e93288d2092e375eefea43ac87569d1d6221be9f8205a0af508251803a99064f992894fc4f03d08f3a3b623c0cb24a06f1a929e08049fa6ec7d7439bd73d5a7b1f09194486e9f3620e5d414911e6e3eae9dbe82194a0882fab583e43d9fc6bc0441c43e271fdf56ff4df1457a8d68f2224d68a6e8070ffd0b91805fca6c83e447cf1bf623f340df531d19b9838dcf1670dae2fb426da99ce7fdd79862ce02b290bb01858a6e9e0defa81d39b93815449cbc49d0c9e845a51b8f9a686927478c953b453f64d81486e2c264e9684ce0de922439e46c64203fb08a1fd3f41a69aa24cf090599c9e16aa6c2af41f8e57d58e3baed3f4c34211861a1c7ced9932d2dd14cde092db53d58b0d5639941c0822a13aca674f5ddccc97435e16f3616a46dcc3509a292cbc6183d24acaec26dafad22e00ca8bfd03f16f72a2aa5a8ac33af59db22d62dbc8285d5e45e001dce9f80fab86b60656f3d71ffe4042ab49c7f5e7599af367058b82bde186e2f73a04a34fd49e2719048030379d654bac1d478f4db00ebfafc0bb1516382fe6486cb086c296c7c4723c2506ad249e231b21fc158b9b81b0bcaade2223724321a2e67d74f69e457f7ca63cac72a6284ff3114019308384274d00182b22e08289910b718c0244aeda2479f5d362544349bc4426b6012aef94fc06748de02f253c4873fa2af2a09ba48803b97700dcc018010e3f377ad103b3bf9874dd7a155ec3c9b75cc3d0f179e4f01826f72a854be74a4394c14a75846b174b3e39d4d7fdf24b7ce929356e81de80a60507107c55cac258da933c1a2350438f5218f0c82f9bf94f6cf2576d9092bd7030c283815598781e235b52e94879dd99307246dd687755a04fb5e8ba4a91c2fb4aba0b5064cb3ac6eeddc30e5dff8cb85e444660cdf62bc3ba13e6a9f840adc653787adee6739803562e0e7cd2a22db995021ba326d5b89c18f8f0fa70ef7af5c649cce92cbd9dbfd8e722e5c790c5233c89c1ed970262a0185d8fdadf6ddad688758218e5ac399b08eb9c8419652dd755a474763521a631067e4f87b21e36e828a83e550399f1d213a85bf4342b4945540120e93890e8c133db000d2a00db109e519154c444ac3bf1dac5890efe519ccc7a0f4b389635055cb4c005f00a7b43b8157560fa453d3f1daea9e536fae9bcfe43d3a3eb00934ee8106c30656c20aa73181aa485329f0b9deb9d5c7012fe87af1d22f7e1578cae68756c9725860d2ecfcef72a317562bcb78e427aa861f850e67adba40d086eb1953e782a21cefd2ffb05296f782a9c3c7e7ab30a4a7f37c0381ceab287655656fab56a9ba166928dd83a630816aecad28bf26f50836ef301a472d327a9ae28b3a0eb62b54c6b5eba4a5700430674ed2c8d26a7c8bb5adae9ab0181fd0cd54f925967bb03e1fb909e90af2ef5c7c3796243c0e83e65ab13bd6322c6ab7f07c87b803e232a8c7c262e33060ce3c86661ecc37905219ad60c875f082ecaa339c44b37d8a5f5feaaca149f97d35cc7584c44097902a2733f2f0b6d133ee5ddd99b42f7c9430c8c4654158bbdbe6851b178425ff9aeaf0a206c54569326f35f8da826866c2edf1dac68e7e374f0467fc61fb36d7753f1d5b384da0186d454c9c028a4bc2e1026bfc1e656f53c07599c1d66203a550163e6445b3305826cb06bcfc93c932196eaa0a54084d4cb2d521a069c31b6d930e2c88e436eda165427b490a67c363ef84718ee8ffcea5b0c4cc64d38e3bd56be86a8f896d0c5d6ea6c15374cf10be68571e68cbc3a9531d55e16b24b2d97c7e47c5f1e6466b6b8c608bada31ea9651122dc81ca413987e3382cc28917977e25170016ba54ea06a8f8706b53f72376ab7792f3d43d955a1aa977d934eb53be18d53a1ee58219e6938d58e5c4923cbacb7345ece41ebc0e83b98439031ed04acaca2b9eccf10d142de2471ead43859e01ca71714121332462e09deda99f600f6d6597b511c5fc1bb67faaecf7783966d7f6de37e3de82cb0b8374efef6e6b727be82b64fac5895bec844b20ff57cbdd8e91e01d91182b02fd7148f732daedd8e069eca5f2b8be4959b18364ba86bfb1e824522f83688989322083c3a0b17a5e63c0cfc61621035d0f907a432b2060f5f6646e406c3370f51605bb179765cd0a57c4e865e01eaf662dfd48111417d2b88576182bd9e8b4c9629517ade22647b6a8a2f72ed061e5e8c629dab118af0b05d5aa5e25002c68d9e5224fbe745a27787e308f7135ce45c627422fd95832cc939310abb30640a1037c3d8cf414b152c45bf80ee858172d650d1cfcb15679a255b3d8a10adeb33670360c04229d8e9b9fcb8443208938577ec2519989ad9de52cee021832a12ad1eb3c2a123b5f24d736b1f2f3c589036527bb6fdf33ec8520680c36fbfa8f49651c8cef3537dec594d0e76ea7c0b923b40ab9f6f4b854b0a04c774cb7411976059971bdaf895173a47502f0a04d84fc2b23f911aaf5d987f5a21a89472fc163d6b013546147535aeced3cd9fce4de2a302f7435babb25e5b0baa86eef447d22947bafa898b5c1f4651ad73b8706ff0628a895ce358fc18f8bf90f27271f49f7a5eb78828bf732bda50be794973883f30508935e5e2637512ebff0816d6c4bb2649e06c92a3c74100e4cda0265d8e822f5acafa5e69e4eccaec721de1d0d6da860c762d7895654fd6e980bbc66de50403cbe06211f727d0cd69a3a2f594d15b5236d5b0ac47d1b605cd09f8605e91e6f73cedf08bf51a01e45d14f163a39d8aff8d8558ec5cae3acd1370419f62414b1986a8eae13d52d72d400e4dedcd7f6b807bd225006f98a31186dcfa10e67487d4142b87f3033a963993a7aa0cee7911578962d13200e61366c317b3a7a3c02a62988c3520920e5dbe47849115e86d3001086e79eaca320a284a0a6f5dd0693308b1cab8d3056fccc374a6140efdf1637de9a3de787b0b49e5971e73a06c8a45f928033afb845ff79ca8ffc0d0d3a97a3dcd3f5283a738f198b888689e9a18abaa99c9a821eb5dba8d328891d188f24967881d5813400f7ffd6be3b9af8ae7a80c0382f71e8c3c7cdf113d34ea18b342dc4d0cb87ff1090b7ddc8f51b7a7ffdebae53d99f164fc2904eabb95877d63745a8843dde1c567a72bf5a99c8caffa46d88f4477bd4ee18a4fd5a30ea94cd38dfccc06f30ef81a60276093bf2276c7cf555f83906dd6d81bbeecf5e6f39516cda86e16b9e9f2a845b5b1ec693d146df06584ae3758c708ea32a9c5fa5da4bf1ea793cdffe5235e4c890cafd2ae612639f085485e42238bac46273d26126ab3fbaa563b8af7152e94c7c1623298207e2f7cc7f2ecc8d7c345d32bb9c38bc16ea0a3bedc68ce758513b8b7dd11b624bf18f13daa57323fb114cdd601cf009509a4bbb9f1af549766459254d3a9b87f0515903285fce2ade17a6542cce9a7c0bfa3dd1daa13f2a52685c98727c68e71d4b8501c556fd2457715fcdc3339a37030cfc3686a3be5e59df4f2c0f0a8fc2d490d9f22bf5750ad2ddea512c62e57f4b7291ce09b728e5b8a9627be8fcd8460dd05261450a16ed81f741ff00079ae3932862a85e16cc345badb8e0f688fc4fe3835d9cfd584deff947bce234431da4d14c9252b47d0d7f1377b5d5705cfcd8e69b0e33137015169c85c2b09507e442105477389f024266b5f5e449e0a1ad87c4e108c2eba09d077213eec61c6cc072078fa34402f96bba184d6f6c928551a7c87b67ffa1ff0bfdcf1ae6bb50a16a7675fcc9c8b5e5613664439df3b11e3c98c997473e9bfdb5e518dcdee215c6e8aeb6fc3ec21572d0154e80871820124410c85274b087d3592ff61e5097843a5b32ca5d9cee48089a86a58b2ca925c9dfd2e8d29505dbd6023f45c50a36800d265bb1643bf1d9e230b767558d1aa2f577ae9615f06da4af40a9b416182bbec4ac97b0593d629108b466930772e6f165dc5076d424c4051ff6fd71f62ceb17f29e4ad1e8db74c0a162d52ec0377c580e34984aa5dcddecdfb8229a0aba86198abb7da0b69b110d4a11b3e5a0d6cbb443135fb2f875d9782c4a2cbc1ffa6577fd9bfc4acfea823fe68f4b57767476339555fcc1448614f48d9330e9ab9e441051d7816c37c4e0133778f61e5c878f4e927dc637d5f63170993b459d29638f253b0cb0a9363b5356cf2684624004c05a62bcc80b06662fb34cde0ab42908b21135a598efc096aca86fbde843ba17c7de42d9e3c989cdcca973eccb497c05c63a484159a45028324652abeb5c763aa0e163f5e6a23ce7a874c48dbcedbb7914cd952de8d2645b47a64b432e1a318f31b2faf898d27d03c12bd97df4f3a219b9ccaee09f50b2fb46b016bb4aae4c0c5df109e68640e43df816c605f65e9cdab55256f2126aa334a608ee54ec1b42176e9849ab7209c092e47e193ff1971706068f886084b31ec757c2c073b11acef6d5485bc1c8142315ce812508db13bd7505dd3afec116179b43256aebcd47b5c0bd0a606c120eba098c3295867fd4c4b14484cf956564c06fea7a5910ba29656e6d1d2c8e2898a1772acd6b435f6a043cf6972f47d5e7802ac67b33279e7050707cacde61a126a1e5847878a5b518b80537b8bbdd6b3c6bcb4006ad6742c70d927094eb991b25dd7f7e36e9718d8843df94d9a2f73363adbb04b9db9c4366ff2688575685d9827a57c933a8486c3e95cc2b91afbf8405979b974f62e89cad8a1da8019eafa9514a9b06019bc4392eaf33ed884bf6bc97807fec75e469e4b904c7e624d0893d989bb4cb01987a554c8b77fc4cf5529b8010d97b3c87e888f7c5dcc376bdff9811a5bc265bd3efcec170fd55657a08dc1672425ba352160199a1eb8c4cfe1bf23729a172c151906f68de6600d3983910ca2ff86f76a80e20e539922ef96d039099094af5ce05a23cf0afb47c727ff0866ba7ee4dbe37b341d003bd6eb4603286127f598f146b88e87423b09d1df3d9352ee90715b313034b631118bb5964bd33fa4393b38ff3ccd76a62db5b8a1fa157d8f35de1db64afa13988b7599f509af3132f76df52502fa2cafb481d07453a4d5c521a28a9c6f9e96b4ce19d96a72d3ef5fd86e375585967b5055ce6c6b611ef5c57a67935f88c43f1b741974377294eef8323838afb0948bea8cbe17f5148202e4822d3251c6b7c23a4b8b44e1d45e3cf09ae0e380b1d21c809b927cc9d56f201807f7eb8bf8933628de37d2dbebb16734552f854c5ba8a91ad75922cac3e2b4098641f91652f85ab44e5a97b13bbd3e3fa1995be06b2b1db7c14f6d9df32b9f4dfba640eaa8bdfc96be9ea34c5344c2bc0f83606a1626b044d59e040ea7228d1aae3b6ac00b832411049e5645212637c78dfc8a574f5082bf017ad317be7a86a9830e24d290f753dce3eb662f7d51eaa08816191aff60662767041bdb8546de055187522c9f263114cd76e4d06bf7fc99dbcd80bf30051efbf9302120da7164271a9eb147ec52aef913bbbe47409bf5fc7dbc7e8046fa404a21d7a0512d39381eaeb76cd12e5fb0d7390ad62202ef04da38c54021c7239f78cbb255312bbdfaeb75f4cdbbc093722f786f043eadc3efa8e5817303b0196e697d81e4af645d857298f8adb7f4ea374b6da9865ff1f83d39cc36cee717ad3447d536f4a771130a7b44bb4d1a753f81dbe795ee393ca99a0c7eaa9bee2ccb5ed07812c063ad7080e25a767acc221a83c461cf80919da47737eb50e69deff055ec0350a4476eab94ebda8c59f54f14fe0feba2dbc78601ee76c76f19aaac309a9ff4224d732c62b8e29091654bfda618128e2886266cda1c156904116247181004aa42b363a654dfb645e7aa47ad3fa52e2311601e1088e808c6875c771c62efa5fe697069c5ab4367541b5b767d9344f152820ec286dacfe1312b172f40022b6d7ac3060c08171e9b95870d6963420ef4fc55b3a0f104e8918e16f5fe3a5f20895941e1e61125882a0255a54cb1f7c093a044ed344ac27845c1a9bc72e4d35c4f2bfc179500a05b6c9d9a4cb722926ab1336fb5e8079de24019b165f162db7a461c9185a6527bdee3e0993d55d484a3a063e73a55a155f701ae79d2ccfd6e6c70456773b7982fd93c95c50943c5197ad473a9477d610f4b3acc07c4a9350d36a33946834e0d13acca90240ce0c73ed9ebfd4517f098747ba031cff77b412d552ec985dc6871a7a2ddb19f648314e389d934913dc60bb35080b13685e36a105f759693f153e7e95d0f38a508d905ecbfc7202e446bea00cb80f6f265d5cfe6c68d9bad3c241f4f1f5f1e7079ef3eaeed45a726bdbc99165d77a7e1d1e5d99529856524dc2ec28857be1273c0b4629784623cc1aa896b441eb4976117a5a49a21392247c21a62ed5a2f16397517625af1534e110a56af2159127b8f8000dc2506dd0a559b6c203467fb152fb68a9549bb135623ec5320deefa0104b9aa5dcfc1b67534fa147f4ce4a9c4ad6b102e6c21ee30229921e4f5ff6d2e03ff6e9b7ca0490f00f94ccbcea61b4371612627e3537508ed334b574d2cde65d806a779ed5295ed9dfa77935431c2954a3ffac9c916675abbda54651bf6104612172c225a7e9280062c3ad9c5d18354888cee2888c12b5aca9e9e822cba50d91345f5a691cc8243bcb6373b187b6065ea3a7e7ee0fb1476bfcda00eeaf1b3ae6f18c3ac8d509e5c17a5d2a0c19c7d08c0224ac4f55c5317e3031d99bcfc920c1f8dc6fdae5b5986f91c778d56e7cef4a1ad62a08750dbb8ef1da02125468109ecbdb679d761a4e12d411ec3ad58f36511e37506b06ddc88bcd0b9eb261a83032a48d4f8775dcc8e233391435770090ac8d26860569b7dff7f8ede96517459248a4ed10acd27ea2c7b4412c69e344011af100072afdefbe870f8a45207b4ebca9d45914f283be1ff333d2f55a3acee01bdbe99508563e0becaaf23d73c011a775f6360e64e43b7cc589a57542c15797d1fae41974c77e162698d7f3fcb8de59f299d6266be9eb0907d8e17d954eb997154d833ee2d03f57afe1252fab50d8c8034228bd9ab9ee4cd835c67782e4631b956aac1b10479a3f7aed9620e9c9ba9260481055203b388897c4310814da6d8db05cf0ed1118eac0ea1067f1d96448c826fd9083501439a216024845392b22634ba86cf270aaebbe326b605edaec13e092e46b51265e99c8a47c8d0913eb240b0d98fdca8c7940a19d68987a3d8737dffe15035689e13ca95258ec5b654a759630dbd10b75895a789a2ae57659e323a3af6e9f65a8a2b65992e3a443d8bcc5e5ca246e947254fb7315cb46f140b78607d446da4101a9885b63a116450b35a529b5521b2888b69a5dc49b36cb4dd5245f7ae06d103540165be460993c60e135ed953ef95bb3f1d063fad16370f9dc3c675d545ae7dd47caa993532599cdf5f960f0014afd4756c292abd68bfc149c27a5fe729fae88a0b02d92e806e9ac2bcea81e900e1807e76237c3f2cb4f0480788463a974228b719a9b6d0200eb9ad55e1a0042cd2963e9aac77a52798239d91388fbb9146409784964830d4e70db5938d0128478e4d4339d77f644a3e37ee10cd8d0a33d36eebf2edad6243272599caa668786284ead8fbd31f8c5137b5e1f43ba4ed7ede69819cfc653eb64904d7d5f3633a2dec7e460568610aacb60e079e439fc4479c8e2d1b946e39dd418d9298ec56839c679218150e554f41966a0faa5c5081d7c674e095101b7c1a29dc8799d435a58e990e3003bd912d597faf4f3eb0fe9cc0543dc649b9963e8b4fab6d830aa86c594f04b768fc084dc76808a732b9daf5ffc753d00cdca6c45700b8d6bfa068cff6eb7198f879941290876134dbae67f3efed325195c47eb7679adae77fe84ed16b983cb63babea2e6b8a7fe044b3a709635033dbf253c71f275f6c9aed105d220be1d5f23f2066fa49bb2aa36c9680f3edb825f0e267847c90a65dbacb603865f7817caff6b92dbccc92bb5a651fc665e0daab97116ee01f07c2933c08ba63b3a7112dcbcce19f774893d7292f65dc264e1bab3d6d790376cef82f0521daa621c5f8e4f57e929564d3453612335ff5632926ca7daa6e499f5d986da03069930e81fb229ae358349d840eb1dcd735c2c2ce40181364db230dfbc9f726b55497b6e0a77616a320e333e3fcca221c190d85f1c834d2e33c23e132ae0a9032a0f4f8cc9b09d5182bf6a70e40110c4e14a3c9ffbe53636552ac8d08d17f1171caa75cc6d66f228e8a8f105e0fc3051b8ba869993155453c5d3499377ef96083b24e630032f1bd8c6e1a6848f337dcaa8c8c25f44bf0e2fd5613ea8da7dbc23d3d31b4103f5ee2e7d5e259c9749502cb429f82c90d27c1b55d4e0fd17be0e20c28bc9d4281d47e9c40687f2f1dad388c54752b28188fa61625e7bc6910486f953f5fcd12b075a1cfaf4a8f835464c9f7d36a1e023c603b011b97ad2be6c69f67f6604cacaa442b7b8ac213d7bb31c1e81b4b68304e7e4b6a0ec47762ff06c7ed35ae5b2debc25b23e57852c4e6b614e00c0b1d1713f1dd7836c97909da4eca3bb3b4a4ac46a440ecb492442ebbcf4662a41f9f49e3ec42d3670d1503ccc85e1b6892792cca765aa6dbd1a52813cf39f78481e26242bc470fa83706fbdbb4e13c10717bdd5af2561ccb8f42af284316e1c4db979a18f7dd809bc45f0f3ae748d0484a058668a0fddd61cb22a1878d27a0067c3d925bc9fe9309499de0fceefe5502afe71d316add15f9599f186cf184e07e6de4e62276e3125082f7121044f5ed2b346f2439826b524b318e47ff8e5a560fa7dfb5f83156823aedd225ac80e630b8f2fa2507e241a9daad788020f945218a1ed75113aad02c32d225f282dcfce2d8e6aa488881c3e052689c62fcdc223874cede1bef7ffbee3ce38dd15af55bf6412c404906456f0a50bc454661c7dbc733b666552e6a0e32c7b99a6a895dd6f2213ae5bb7d95b6cf50f7ac4af8842312dd8559f90720a3e86fd421e21a3842f4551be4493dbeed012f06ac9e7a64c630a130d01779a53265ca0cacc0ef0bd65993d29445a9b223f483fbe54417ed2f239522536462053edabac9d46c5cacd6ec8e67b005c5094996206676e532b2f3f032cdbc1acd4c5839736247a5cb0f72f190b49b9e127a70d30d3928fc60b15323a606391e1e0f48f88b663106f53c4cba8d76fbcf82de09fb93ad9b291c0dfdc76892d8dc1c52e95e5d1cf64f573513b2b1dbd7285b47c71081143253107b8c2045584fd0a1804e5aef4d052a038ad1eeb4947e5bb1285f67137ee18bbab4db6647a24cad6fafbeaf812310810eb0a1888beb096b13a60d610ef1644aaf60afe954f65eb7e495425669db109062e2837954076d8c84858a20117fd4158d02c72b10f32aec917726adedc0f992e4051d4daa88c1177c24244d1a887c2bccc1f40d5cd7bd28ab35916888c5b8e0f3da870bfeb949301ea66f82f9948c78579bee727e2d5e2becdf4f5182a1980244d066966ae6e6c5231d0e24f3ed5af42b484f9faff3af4f66040dda6ed91b237e29be7a4d8a3f5c5634e9fdaa2b91c62d57f0f8bfd8bc206763e9323bf3a2eada242a41db602b015806e385cdeff9bb84a5fbdd19dffd9bf108701279f37813fc666c4461b28305e707927bd8048ebaf2419c432cc432fd3d1669bcb8206a024b43c798d69076138ad59a5f3c06990e36d357793818ef0599b08a5cd9bec06c439f21313ba0c9d0e3798f851b254c2caab285855a06367432388aa8d80453364ef1e49400ae3ec006a3115fb419a6c70315c3fd09c4f9c109b7187126e5787b56cf5fcdcf5bc7cc7920a53d9d78d1d48379c618df7371b5760898f4b24737c4a7ebe1c0b7f1d287212dd44548c67c0e4ffc32f37e20fe3d82bd6fef3a65d7f5b9ac4840508e8677a7165c18367280ee3147e63bd248a08692ec5daddb9f569bd167ec3691a34a4437452d0ce3a4e1a884edace3acab81cd6c4a5cb47d081fddaff13ff56f57c6ee10337e92d9f4a6675b30e7f51010c3e6aba4cc759fdce91f2d5d20a9e680b56e1b6e6d902939ed184b9410a20a91c1035c676a5c44568d85b06a8d462f23d2c913cf3f26499e381fb5123832f66a9ae4cb842e75f2809461910851b348ec2ce0d35833417594512c9e04dedc9b397d0b4d1bf4dfd81334970f532e7c31c5b263a232bbd7b4ff26ef07eb41b4976e9124e9cdaa22f059ad883f1dd03072bc43ac9d8c0b569c981735c193d541890f5d69e25b93fa72cda110a90b879bea8c8e4e3aec95052995622bae63bf5bfd54cca0b16075b54750a650efc72176049492a2554f783c8727e4682fa4a434da434ab7bf4a985ab0d923d5a4a9624b0e51be73a8f4565e4e057a5ee76adc6f958585bb13eedaeb8f35464dafac4929b534435bbb6547c31c9d0d52b944ff5f9e165ccc1e16ca5e04dc29e680a77ee0fe02a5261bc98377192d868a0407860c86f0202ceb30a366479f1fcc01b5a87dbda9da12bdb3ab075160aec6e73e152e20084855d953fe1101010e1fee7246f6097ba1a7741a23451ec40005dc3dded7f7f23ce768bcc8d3c2e2de6ad03728e9958ba9f046f5beb0a02442dc5866314fa611e72022862187f07005704b987f79575730a3b6291ab1aa30d39ca2d7f8fb52cfd8f3d2ce2be592d778286847302cdfbfcf6c1c1ef68b57ea0a6c7c3ae8f4ad56a28c69109d92aa58160eeedb08f589888ae6bc99cb7e44c8d5ad44c5af1cde710ce36be3caa2eedcf8bc994824dcf42c70429c1e9f7b068df4c4ec18108d0aab74a87b215a57aeeaa6169f3b05b1b3a81fa111482c978037ff7a5558cb856b56b7ed64511dc226667ff2f114e0d1261c88e8be45cc997c036a420f2461a729471c74f0aa216b03678d870c3d476854c5eedfc143ee0bc286192af6e4ecdd7620fdc1c0b33a66eac3767a269e729dfa12ff32478a69534c365835ede70e8718bd440ba7a6d0cbac76ffd6abac7cdb28da44e33c5a317e9cbcbbf618fca44a39408ea505c858190d38581d1ee38ce33d3106e550796038fa282acdc45b3927a4b84c6da890c6a49f7e8538b781acb1f871904a965460079a03df0f3220aa755e9070d78a9d126fa007f2664960e56a085800fea323e3278db0ae00a8c0a59c5f6508d0f2edeb9196f79577348c91aa542fdf1c09d9535d2b3b2afcc863b2f022bda341bff58e67e9036169dddffa96ffb0b4e708a73ba780598708b835470c3999a11e8877548256e40c541b2f8a6eb4d2ccf8460519fadd1cd1af356fb10cb470447af98da0891ea1f26c5269a111d7b6d5f34379de70f9dd87ddfa140855a37a979838c7b6b7c8db399f211213e5f7eef25aa4bc9937d962f8a96c9fd6c12a544fd49ac12efd9be268f1cfb1ddd61b3f6f255ea53a51e2d01464d5bee0fd28802168a93060613956b9160bec8686f4f884aa4b7ce8fa05636bf43e7800bf3db507229dc2ae3d3a4f46976a26016072c8a2867ffd0ab8a1f8da13faabab62ca8e0e60344ad09b060dacd17a579eacf4c230161929bf1d78473de1cd71819b16fd0feb9ae64a263ea233e929ae057bcffdca14a92ab135c6b8f5bdad7c68e24ee376a697c347b35677cca2a9b9f1c837bc9af783eb57316c3c707a5962290010beb3e9c03dc89a8ddace289fd5db767f2cfe8864dd2bd07100a7fb9de8f161e44f269b71fc86b1cd1dde22e47d91c16dcea2712d942de0eab85b0a0f2ce8bd6ebeff9f7729af509538afab8c01685860dba4a25187d1560296abdcff3021397cebe4b03b040f195678b3f56ba938cba6587e91d3b45efcf181db83035d98de0941c392674d2aa16a5486fbc0bed1ce1d3a2f193772a8daa397f4e725488e5ca56f8536810e1af02982cfc69c96ff82892d9d4dc329948eca270d3e10fc54258c0e99af9bbfd8626bf7ffaa5715e815b634b1a0645e3167b4a8bc55e8a7243a3e47756838b90c2df43bb3f5ab74e5b01d347625fc8d7892bcd8ae3d465dc80334c484cd23e01d88769ff1346785f04d139d7b7fdeeaba6c892ea2515ddae83e403249a1bd12bd47c82925d928b8fe22d83129c23d57882e653506c8bdc4676605d270cc722de303c0bddead97c15fe5546e485323ca09597984bb7cd7ecdfda8360c8a2afd75a8b4245f7440215df160455f7e3922cec2c176d13a6979a98cf4a93d12669552654c61ac09f5f8ef24bb83ce966bdc7560d6f0c65b22f30d9a5fa395aa1d176b4fe7230f4b7a0c80351c520bc37fe5823a2179c44846e9e5bf6ed00e3d11fefd9bb792095bfc18f2c7e68beb1c8bf796ac9bf3f5143c1bf2e8114e6a09961d64e662691aa576f512d354aa8363634ee2ed6516a888c8bcce506bd7a2237bcce9260fbc891da03df06cc58a3ba53144e071c2430644a72f594990b85269adac56810174c3213fb5a44cdcd5339687ad4e5dfaae9474d36411e16dd4d637b24cdad672a42ea01fdc1606491dace3fc914d5d2bf53e02ffb73d5848c21bd986175910e841b3af99d1fa9e97bd732515042437972439ec9074832088cfe4787103897ef45d083799bb9f195b0b1c79772daa3f09002d7ffdc1a4083c757a23f462642cbd0298351fd46e8cc47c2ee50a4e1bdba4a12b4766bb1b502c3e3460f5def0623613b6c3d6a4e011511641b108d678dcae06d1dd2df1d47562ea9fab8f1d467e619c174932f66b9dc2ce826e748490e6eecb39c53e9ee590ff0d329cbcac499bba3105a13fb9e8555e66e76f9e054e0075cc65c783655bff6fdfa4ecf295960742af47d19720c87554fc4129897848563d72812dda6448007fed1e270aac20c0fb9cb2e1081f8ed11617d81d004b20d17ac4b8aa1e8b42528140e63d70f73c1791480ff92c68c85081af2f8b494fd7fd8f34566ab463ccbd99f37b78e6661f36843bb6246bbb7607b922c86aeb65daff21602ec7e348754b1d90a80cf442adbf8c20c76fa9be9be9d496880acc2b05a7567dcb630a7a291638c9bd6e4d062fa8fb097c6745ab436dce39ca08894f98943c4fe0a5079b4a4ffb48a656986df109fdc60e9cfcd7cd651bf87b4e2749382c30c31e2d78ae517dd845d4e574c6e0b7f33dbc82c9d239dbed84c4c8f4493df7db27ac2d3244246dd1055e28d2738b5a3187d0570181bdc3511c742c049b62b4f462211b72bfe0541e19aca01b62a33f82f72ac25befd65656cc8ed031d10a1fee0db52f36452bc7d730f9cff739d2ff3f41450d7baa2842bad53e37c10a854dce5d0929d43a31b0916ca9db5a3a21e59ffdd4745b4ad17201a7f57b9ead2fa44a06ccf83e1f52758468582f594a22c3ff5faa56544859539eac38cc0fe47de3e24097bc2e08b85d93dd3bd6ef2858736f391598ec04d21afc21ac566c0df169e0a80587e2904a582f0ea0331c0e108cdab1555bb0713e257003e2f5a806f597a9e261d0a502d19ca494f6149fc587e301d82b9cdf34024617def39d5aaffb4e9fecc28e8cc7f836c5531a05d87154cbc3970156d9d23b17208dacd7072f54005b45767225597c5e730c2d057b4b138bb42cd68260a617a3224cfb3b5b822f50a1b56413586d91a9f3d1db19a690bd72607c35972c75db58fbbeb37f1c1826e644389675a8ff9b60e71bb40011ca9106d818956529330e7b5caf9ad7dbd785ebe7421c1bdfe439f2067924c796cb8fa6895b28aba70423167a147cb4f6cd482f0e4a53fe5d68069bc1c0f769e78cb238ca9ace415eded07a60095f33899d223fb52bbad2cbe8cfa2855443cdcc5c656d8adc9cc4cf28b2e0335923110d966b525ee33beabdb6eeb048a6986be5c2759f97b25a7db6c212ce736329d4df7f34c27ae925d2140a07290d1d7c6291901ffeb81a0fb2de858d6ab1e16b71aeba1b2c37f4aedb2c8b450bd7de6e4eae4b677052f2200bdf510b81df1840b2d5196ffbf1d034d86cfb242028b97c244bf53be9ebac55ffbe2dc5a6fd30942dbf08b3b881526a7bab1893ee454b0535b9252b251aac7085efb0459766619e93646132082a66cc82b09baea7bddf724dd837292958ffad862a108f67a0e387572cee46616443536bff6168c876aac6589085487d68f6bb8ba4be1231fc94ed0447cefc18b855431281da9b0ca0ba43f6ea3671315139b365281786d45cb6e93350099ed48bcc2feca8a78f2e3c4b1e76f888cf6a6dc5d5cdd93453918b1909956f4dd783bb9e6bab110ac4e209ae7b56a50c603e8d58d79fed892f768a0cb91d623570bd6b7a3d50533f60537377f404524d1aa6673bb4f3a4fdea3734cead69a38c4348613054efcd2b1d077ecc28543196be452a88837be4c9291cee9513ca8881ab0db926e1a23222af38ff9e9a0d2cf64e750097551b90434864f5196f25bd39fdd7d37e4f3b6b2c6379343c64fcedf267b59352273c7ee34acef2fa47a533c2ee09849171f3e60ac5f85365cb6e43f279d02cebfe4c69734338eb38702bdec232352f0c24683dbe2b48e343b55dd79e89cae495964dbe2a1993400a90194b2b2c3545b91af24ef66a913bdcd8a36883d77e6bf28ad46ed6eea4566e3ad5c449a42babf95ccaf939fad515ad89edfe1d41503c5cad588a7b054de128c6f129298e0aa4caf104ddcf37f20a454f9d2784834ecf40d07250cf496968dc78ef216e4ea189e8efa50bc236890ea14111eb9c159292b04d65a44ea9d7160d9c5d72aa509a47cc0815c68aa7f2958f1fc3d2c30cdaa626782e739e61cdeae2f6a2ab84510116bac1214ee7cbdcb1de88bfecc6407b749451b31dbf25d3205784a17fd722cf31b37d59cc7f0964d16922214774630a1ccf1a5b4f2b2f4f17ec222cda6773e16a5c4f06695f959975469d9298900ef384712f1f7f5409d3de2730ed77c39bdd243dbf324579ab421f8e83ad45a71cca45c951cb902097be344b021246fde0e497a79ff6ac9dee75a0147b5e9c18f28ee089844d9eb5ce6af993c78aa98a8684bdb2bc7afa4c3fe896fb30a5a1efead7adcb15a2c5942ebda031c7a280761cbd75ff77a639537103350b84a256711b115afd0966caba058ec281c30fa0119a06d0e08f97d87e74e2bae3376f8e85425bacbae9e5d113d581850a3adb42f3bc2206a3a7ca3fa60f27f46ac64a366f8643faa36621dcc80cf7ccb1192f81ec73995dd3c9d8a3eb3dcff4ae28121c0e9bbf7480fcc1461104565c29f9f18d48a11dc751f8445d68d3d67c06e8f5adb531dc2c18f8ce4ba5dae9aef1b723fd6623176bf94ad41741c9ac54fc05f81894d866c8344ee1e2ffb5f9ac31e3899a2123fcb8c00b000961fd501f44afdecf5081fe9c4e2f3c8ee5386b89d6cfbe35ce434c5472713174fab500671434fc423e17bbe285d55bb7bd955df96f93fae424f53d4d4bf4f83c86b0d19853587f8c6b7621010de5f4a1febdef5346382e084bad61d6553e979489c3ef75740deb03385b66570f7507ac98dc679ba04f1cb48fa72355d220ef806494d57599d29fa5d655406648e6f99f9e3b39e8271a60ac55320b3a0abed1e77d792bff7cabb29fd9b1e01c08511df6989c7136c2b6f6f9e29f7801e053b989f7c0f48ababbff6f7faa9d6e494e4ce5edf77456756daee155ef40ab606d38608a8f87f41741fb3bdabc6c5e32aa39656cf659ace93d1cbba793d75c469d35b9501d84c83000b40b423e6f98d4071320e9da801509665238a86a20aec1845d3870124144172b226ee138d6d64b76e32b6f259b96562b79dd6d6911ea44177cc5e1d25171cfc912fb2e795e49ddb1ee55be9bdcaddd4513452de4d5c2f38eb909512ab82a95b22d90b0c8ccd6f46d8510c3be34587d75be3647285b017a0ee8aafb0d1af0cb8608a7983870ed9c6f31c689e5d41e1752ff83cb4dae4b1bc526093dc133ef37a06807b00839b399b64681999e0d6d9e6442a5af17585b5f6e01ba92d3583aa1592389787310701b0fae21f5395c9787cc03aad76b191f3851a0be2668ad0d7560183c04710afda163f3d5e0a51507104fe9271864a8159bf58fa80197d6e0be11c615d821c2b6b17ea0b0a9d6f22b1a1a07b1917842154ca8932e41a119f6923228c05a63ea2b887465bba49a0400af9b44d57daaac09ed3ff7493c51817cf8cf75c9b79f88c017f475b289256202ec36085266a524251a73399cca0994d8224a8e6c46c8a44e9426c552919447eab8e55e52876c5ad34456d5558554bc62f30f1efb4dd91237cb6dc489026992713e3f5192c928987838adcb519c65f8df8370b0a0188b80594eb69701cc4586207991f8f6458d897e63e9cee5c3fd870df211dfb0fb6e06ffe976ba29756af19d95e80341d335df72d287259e9392d9ad0eb34b888e0de171f9c0e51249ac49b624296a2e4fc09680fe4563e69b4a4920f6c33bb6ab5746cbd9eccf7d53a637ac88afcef73e97295987de4da0e8d86ad6b51d2c39f5d166845f30c5d4b379545d9b527146938e4cd5f03c9476f373d9728532c2749dfd9a1da6d7660483848d1d1679de0ebd9003788e575402bf5a00b696ab554a2e9d4b918620730a30128cb8acf8971ae81d697055ddbe985179c09c9a7a50252b0fa4b6981ba22df0a529941486987c6b7bb4385bb9fa453dfc7e1d109e88050e4fd9b7f9706cc8f28accb6222da3cec8b3fe4c5d84f3d62b94c02ad2236bc19bd548cb2ea1bcf021dfb035f9233b91319fd7aef221462e23c376756d8334603d9623a54475b26162d30c67f89524f99d10f7f5176b323303cff33bea589ca96c9a06b8b91da24ae97f217f2eb4a2bad524dfed051df36278e9a43e5a42409e5d2e82356d1d8f24131300b565454adcee05d0566e5c8b2d67df73014341a8b417c82b16c71c8e477f42e8fa2ce49d755761fea81da23fc763857656ca8f39328971e081d4ff3436133feb84fa560d4867838b0f83acd8ce6221c1f6fc589797a6829fcfd2d42f535f6f64cd20b99598b8b77cadee5537362cd7907f80302734b892a2234e273f103263d945513c1d27e2fe07c71ea5f2d1c5030b60656f4d43988f5b77b260a16b894b490e46639345136698f679d35ac846a0bb7a11c3bcc46996397694d24ca2b229205fe5b49973822ee790a82f6b548d3ce9b6f0d190cb161af67ea6bfecf31d63f7abba5a2dba469933cb67083c96648a96a4849295943b0f9636603aad29c62de8046a6d576617badf12503fda9e245a3e205edd8ac41037b421b1245661ad88da94af7cff04330ec84e0878e0307f9d07433d9275ad4cd907bd742afef787339c36547656deb3632d65e9562e28dae0f73f85a9ee078380d029ca968e3887da54608e4579b59532a7cdea77607e5ea119ec639efc9ab9c0e2ae060a75a8e91059fbf5b80512015944508455af5d8bff00f608450211fb1359aa291963d102b4663fe0228e520ba9c4097df414dff799c3e8fd0232425005439ac2332898b127b116919945884a189788e7b17682ce1e6eb320765c64cca005278f1b47bfb03131796863dff8fbb2e84994d5c5a2856742911dfd14a3de23140942650c62862999328fc31c9b87cb7374b7d55da6ecff25d205335e9bb84c230123739c6894918b5d48749a1d99c91c1c19fa37df6399611e3879a9910b85a37e774bf140d65eb9faadb61e050ff249dfcb5cb198ecab1821ef8bb3dd68e0a1e0d86ff5ed04fb147305c48e8e2eaa44dfdbb03b26f1c1ef046e4e2e91c0c60c1873db4178892daaca2bc5dc93b101ea8ef30e86eec08f2aa7eef5da65533c7a0d348f1aa30d681dcaacea9dd6d9911e882207421a5227251165d9c9902f2a791fd394b3165341fc3c1bc0248bf74658ef0d44fcdefd0840435f1f2fa695074e0092a55592eeabfc06c0fd72a2a1fe64f187f0aa0fb9a8bdde23dbc00384210357ab05734b156b2443e18b99ede8e95063e9fe78057ff286c77bcd90ab8383e9732f885a5e39560d9a3f3302b85bd311d0e6bc949d29f507d4bbae6e9679429e6d3ebc7147aa861406ea368b0864ca297e9bb81ace2757602a8701e411e3afd2581fa3ccd4fada3b93e16a2da03aae67faf51b0391d0ef4e5dcb4e202735393f6a464e3890dedc203fc36655a2d5aad7432b8ca5650b9438b1352f0f8d326fcd8005a65ae4f7ccee75ce4badcf63fe19b5102c34468dac749970a74b7da70c8eb343d6f2fdfdcc1ef6af0a9514b61cf2c12033493900a5958c2170ee578dc472b62afa2deff40f86d414053c1c36bd50e617c0c45c322f19c1b52d56904b869c7caee15f883d2ebc1cfe32fbf34d3d2e8e2128b7a4bab6423fcf3c3c1ee554ca1af1234ed4f6792822b09f16953bb270057d2ae7d2a6b172c1ac19d8e149ec53cdaaa18102223b61347a8280f68d8cdb5c23c6acd96c4be29ba50ab1999d8a46abe263cbec34335941aeaddc938033884539831b0a81af07d54ec72bb1b1640dd0d13c106a7896046d9936d7324042142c40b45fd1f6bec6069e213f87f77632f9a067444e860bd0a1cd8cd0c6967187880c9fe6e0e44ddb450a00f524be36d5ba9294c319290e77b78fe41830d2a5a87566b1b3a50acabd1b589d8c1677334b0faa6b0c724f706c6ecf3149dbc48b01717dc733e5c71901e3954c526933ddc5455b289aef8bcdb493b15f1f795a810557f84c7551c0c7687bab802d13f2f98412e0c627f060ce54799d5776b44e9bb2484f0bc32f8eefdb9c270fe7cc03c473dfaab74650ad6faeb0a2b9db513115095ab901bf1426a41a93d87bffbe87f421cdb0515e3846d5bde4b0080c461cd15c1d09b9bdacf3d2641e0871ffeda7ea00ef37e85dbfbe1b5f9304ab21b3e22c870f1e6e1e631589e3698ad748a6450fb59f57faf5bc05fe8fd728f17e2c355fce7a3161db98113a04fa0075935c2401c0eb48a0f1004c856708c51de42165e23e95df378ce83fa0b98b74e6568c54173eedff8bc85bde3e450d555e26d22b1a13b516fd3a2080b28bd97bbfedaf809ed02577b40ad17f5248522f20d159eeabc69df5b320c5fd12fc1f38ea6b673871082e56c7621e27b73122ad32c65f4a6a98631c2938310021528739eebbec2057e081fc64d83de18426c1d92399b0831c0cb3fd7773eecfab05a11ad00529971dd38e02bcd6a718a5dfce6cfff76ed6e77880193e5f12f140b4cdd3001eace2388ab404a44670e4a25f07b33234813e0412ca513a5fdb1970c1ad641230cdd5f8a4e22da52d55d5b5fb9788b034ba4c7a904184d16aaf015d2dabb13aae33b9f2a36d2bea6c612301ba8a8063925955bc6fe2619c61c0d745f94600468ef5fdef21d56ae227b23b3f9c310c3d0ec0568a7afa6adc9540481f6bcc49d76f98121bd0c33fb98847ffa3e93e7de9dcb37aaf19a6ea2b5b675e9cf72ff42cfaa4f145fc35fedaa34288f8ec53d4b2cd2a03ce5c9bf3b09e67ed1682db64d4ac075755da2a1beacc27e88b760b3b1085b83ce3ef3d4d0d22696d56254d711070d902870df62b2979aa600414729a538eec7da5b0736dcfa8aae1c2d1a593265d086e5a1a81b42f1e93a93d8cfff72a962edb9a9036fb9a91bd15e42b9fa5cf1e96e9483351cd3113340832915b325e73fc27cc70b273154b5f3cda25f8af9da8078d117036f26ff82a8eadc9a286e78ed7046fbc2cb0b70035da278ddaab739486006371c32cbc6e29ed312a9af97c2e01dff5a921b0e906ab9c35254dc5d9808cdb94149d28ed4739b3bcd1fd33c4f63b85e4743ebdf50f323885f6f2cbec6ad28295eaca6dea0ea0c344648a4fb6156be4a799d422cd5beed24125feae165882cbd27e784917ec1fb99e8211369082b27d0065e8eef46eea798855a4c456b1fbc3fe4a0e9243af64bac4eb4df446f27e770f8270bdf3f39bb8d09763a67ba2bdd556a5dcdf8ff404ef4040b03c2584f2ce2d7a300bba20971c7d255c68a7a27b2a049056a21c8f1a5c1d49cdcd2db40e88a14a01dbc7666762129bfe7b30ed92e6b74e12aaee42da54685f3743ab121c13ffcbf4d1b6f54c72104ff51c614265afcebd252eb846511912b3056c20984ace65411b7b3afbdccda89e94e38bdff43fce7a342d215c684a28d469293aad10f12ad54ad2e0cbdb5ce31b88c1c66581bd8180ab26b2b58d22f8bf8d062d56979cf575ffdd0c0b04b08f0d66675e23dc3e0462164bb4756d6ebce98a266badccb6d60dd5aa981a96c38286b8b6975e75252a07260711ed67418404c972113df13c128ad31c57e7c809e64986b5f5de06e6ee186d09289f763e9049cffee6872f1db34fb177da268087f1df6534668838dd25a4840ea4cc1fd94621da6a29723d86ba2800b3e769ed51e1233d77b05a3a66811ac74d5df1132b2ff6e4dbfa819b3b050e6884548dd42b4881da447b0342163abbb29eb2b5b8b26940f52f1c32832603673e91592ca3dfd50a3ab27a1f487adb58b8413a0f89e80ac88f2065b354c674b7e4c1e0671b4c1b8eb598cfa770b261d12c265e47fa041de53ad2b46f1e17ec211f81b8d459f0141a320a3db54e0ce5aff2d897810ced92ec575233d1599774c9edf0d10baa4ccb5d5feb94d3bd2de618eef6be715f7b39315239bf5e90b66a01f0b4ecbdb95e13f6f65958619fff00889509b234ae3b6ba69c8da701d53f520031b6d78b58e1f04ddbb2701bdb343f2bfcfdb6a79791e654a84396b7c3f9e041059692deb101bf09a884248fb026a72ec4b980a20ac418b9b97cbc2349d29f20e6750262e8825318b68849e433da72ae6d0b719fe74c5206f0d400d411edaaf7ff06ca2b92d08c4d5871746dac2a309ce4e9839f77e697c611b0a53327d73ecc96320cc6756650b6f850b4cb14643a732baf029323f675490655c71570dabbe8185567aea7405388e0cab3e46c9ea3b102f9a91a8268cfa536e8ba0fd006f9e3aaf6b953461541cd416110a6af729875927d5076c3f530eaa9e038b986f0ebb66b97ba3c0a17213b9316912e11e35f7e2f4d2dcd6961fc96c877e50fe417cf442ff0eaca4e449c4ebf88015d847be957cac387dae6b663be39444a9f774ac9860f4fda2853210bde3a60142d63b1290976eb84ee9bf891038623e9d7bab165b2b80779039c135026203891ed671c1d7916dbdc28bbde7a889908a06d9d6e0ad00dcf8f5a0e707c830edf4480d1a8321fabbabeca0ce8be8afd8b89d835aac934a2c4382cc6352d0a4dafab8a27fccd1edf0c343356e24cc409665ae164b820c8f31b3538677260dc83c3867a58c3fa24c7ab6cc552105de84ed7ddf32f35f997a663fa9a873a58c134db1ed42b3048d6de9e739a56cc1e442c851d93f77c6023c95852c44737cc175b5d5ea6e900e6bcfb0d3bb37ebbf40375d811b136a4672a829cdc6364a4b53133340f2a8c376c5174c0e6d9ccf36dd6881ecf8ef8ddf2b086d8a137bc4d1c55b7215e4a1f07e9c3f992907c550a565e259830be41c74f081df386259a2ad31cb47b2fd8280785bcb498de6ffeb9321742942e0ab5104af056527c13bd9e36f905a9f1e53bd0ba96121d2bcec3315d73430260aaefe7723735fa2a0fcba17e512e1987cd765a2631fc8b339afd1133fbd64e515915298b5b2a26defb1615dd3de0f15ef7f2d70c312f7e6d446640a1e7ddd12844ac9841850d2a019090303ec665ce45d91934461ee37064ae6f1dbe4739d7924d49c80b91ea6c8b3433919ceaca49d88e7ec9fb4d71d601e3a31ad2d8159f0f42a73d8503884388b345903cab9e3c412354b499d42df60b087430f7ac1d3f9949b77b4fd74657f57ba520261f16e715b522b05d0b72ba3f478e35775306881cbd1ff4538f58c79aca1a0822d148ec62bc4357cf51dd71e25e1c7d6d1d227de1bf39ed52608273cbedf90afc005529e0819ebc8bfb2e822aad9d16ee436fe064812c4bee0bfb5ef88fc482d3da261e85a13468f100ad62585215ed16dd619c520376afb75edfd9034432936a9de960b69c8f9489f7ddb6bed527fa5e66768ab4d2ec1c31cda3fb5cab16363f5cace977054acf33b3cf63d71c0b4b7f7d3cb9772e579f635284fb30c130ba8af54720de21d595659213d719cae8b3debfc2fe519cec36d72c0ba2db28e36600248481855aae9d208dedbf908505c510eb8adc43e6a9b4a99a6339ddfe6bf74a58ffb4fcf2fee109378950c57049d3ad90e85c2839f2da3c992792d67e901df4b70c2c0413a12825dc6b86683b0ed1e60c47d2abff0c2bc0a7a9b341e096060f8c44fe00112742e43aa914f5a1b5d752833a0d059f1147dc54bd9f366d9b023377f60c26ced2fb19723c8162fc7c71dd8b2ac91634aea5a86b649d91493fa4bc5a96d7bb452bfbd854f421287d37e8b36cbc8af1714246ecf6cd42f74e106704283076251e276b1cde2d5c106d2a0c7dd1e8f7dd5ec17081aa15dc95dbb7379e0957accc5a3295d512fa007b9d9d3df163f716e9633c5d4bc7eecef7c7a1393a0bfefbdc2e9ef28ddb2c1ec6e476e72924b0def0d00cd2332dc7e0d4dac00c3ad462f06142975ab89548822e24f1979de036ce81f0eab71751b098585c6298b82da76ae822b46de45b537b685ab8bbf7c302862ad4f5ab5cbb76dcb5b4240c265646a9f6ccb2621d984573c59082cf58ab18f44c55fd5f2cff5e7c9f985a8969a72c4e7b0efd4b4f14c94e51a002381cfdcc694af991446370e7986ab24dfb6cc39d3b64a13bc45687f350d6aa092cdb9cb925115e29cc3b86af62e98a66264fef55a42c3e5aa46ef80729c69cee408b6b0bb9c436b2501fa9bdf6e1baea0b5c165b319462cde6dd2ebb3db52fb5c83dc355d4faa5d2819c3c191faeb9b88c7e034e99d5ab8d0bcfe7a62b1b084188868341e9c6680995da7aca1057faa466d09161bac9096f22fd057b0a0ea458f213e5802eb6cd067704667d5c6d269fa0860671e5429a368fc0aa003dec6bb26011aa041bb677cdff6e523e961fea55c51568ede8bdd2afd2b13b493ff30e0bc896b88fd628352f9f4dbd1513c75d136f7396499dbf891dc09d19d8dc7ee8834bf582de42eb44adc7c08b623bb1c3c87200cf75e9988bcfdc59a3e078662053094ab084f2426955a3246f3cc464544242cfcbc21e2b12f82d18fb48707ed1f97bcd5da81c6c6bc6c2e9c628f6533c77e3babb76b5c5e7e64bb0dd37bca808908bdd721d57953fd28151a9d748558c0fc71dcbb57282885c0e12e5fd90fcda1f44114879325a8009139ae75bc82ea67307168cb759ba829660b2c4b7c43083033406d29653fc00ec191092ac0bf88161bfc9039283c37e2fa14ff762547a4f99ddbe21d85a03130aae2256acd8ccd7c5001b68095fcbd74a402bd2af609e2d618719c513cd5bc78619bf468bc185bcaa3295681e1ebddc721701c62e6005d5a311f418c174a2de96917502fef6318b7e622a706438c4c925152ea9fee6b21beee02525bca65321dd250c2afe3f82f2e7b1280987d7be613cf79d1eb231f45e5ecde09f204e95efe1ea6daa86b8f0883ff868422466e425f6c27ec08ec5ecb6a3647be72bce441b4eebb6bfb5968aba9e543a738fa6a96df1ff5497e9bfe765009e79724d48f8d32d302df35978011f03b93f694df7d5efad36099e63506180b168ede582997716382beaef936c47de84d17cccf951a5c39f332696da4c4ff35e217d0cc29c565f34cf7eb666f73274fdd189d687838f1a577ff6c56fe08bae1012c8ea57f6d0405dab46d0fdbb8f6e07b3bc52d0d4384bb2e105eab68646737c423c77cc6b82357561207221701146a595b04e6701020bfbf467d3163dc9a5166d5a181a63d321cabca0b3b257aa278053e817e79d75c5f7b67ab758945567dd8d1d360320750dbc9d5df4ed353a284744fc6fb13e85466840285286e8bdbec71ce196f0eeb6e534cf76628e87f7cdcd4f4c86dc1fac4e41b51ddc19934cab10bcbd91fd89e836dd13856b2927f2987befcb811cfe946bc0c982aa65d767e5776db8ab3d0e097cee0148c6b196ecc5a341ed09e6bfa0b8498311d3adbdd6ab22cfb5874bbdbff4b597c71bffc8f10ed4d2a229f8dc622f31558a63ae966b711591813c7ec19e30e67a4bb18b9a705bf5daafe9c32b8fb15c2288066e7ea901df99a17e532b1d155cbf1bd9a6d0c392c03542cae044313553392b156f4f348b46c1cd99f075956f247d51bbd3deb59025aca325e4479d56f1c6f9874b63118792643a7970e560b4d1d2256a4bab15810398f2033a76013ca183344c595e1d610bc814ed95d74b2ab3630f946ba34bdce8465e80a0e35f763eb58b8758bca3d5a84bef085ad5b3dc3faf7bab69ada52a4d6fe62e5da322048bdbdd74bb0002c48efa733a00399e49d9ae8ef5ff73595a80b33e1bdd1c957671e6c7973563cd65effa9e9197be671866b1c4db0f7fe3fa834b4d6b4723c1bac4a419836fdb963acf73cda5c3630bb494d4182e4daea80d9bbdc1e03524614312b35c99a8b4d55af61710727ca8776885b262bd716509c41e887d7363bb356e02b9e2a3d093e6df4346a8c1622b149b2d1f28c711529ec5e0690b8c6fcfcf50d4423af96d1b11809f8ba324b595fc857a65fd59dc206e09827d78117ec44d45da452c457cfd48c2cf49bb10156119b37816615f725ffdca4373750990712be1ff34467063029b3067ba1898242826596d9178a486fd43218b18b2d5a3918a0ca1519182a3bc28006869a21f45408255e36db4a26e9830bf5a5d35b0f35849157915ace96e25c4f6959553590b8735fec3edac862065efc440c15536ed37601800760b3cfebefc3d3c1d4576c96813d3e6d4f693d4e2485147b53c7486c37819ecec3c7e850736a48ccb51e12ad12adf686efa37018d6becb427824eaec2d3e91cc459be8760b634a3a64314d32ad169923049715732c1f5df846d7ccd442e9495a2d6104f0a652d6972401152904ff89f6672015e3acb803f5f6a92a9760dafe6118b8100ba5c568f420ff369fab4be205e684f6b1c88d26f8ec98d5198ca86ed4a03a0ada029b0dfc02fdb272d36703fef83ade564ead36b3c403a84a33b8f7f837a5c839335b9699fa9e3e2d31117487647b30bdf1354645414f59b0943ccdd8b5f52027619e7591bf9266192b04054473e6b9edb4395fcb2f2dd88f958ca555d45b5c8c4f6783c65959d814f5e75713ebd062dbd330b0f2428b4b62e725cb2a8176706080cfc95d54e7d44155bbc2761f6f83c6af1f483cce3356a15ebfc2d06813c4b81ed6cee300b8816baf341d886217a6a6faedd15b68ec2dc1f8382fb3239f79d0abe2831548ecd3234be9b516dde44de30ec2c6b53af556355a108a44cb0a9bbad119ca955eaf5d81f24ca8ba10f625df29e1b527edfa47ea43b288a0b3d1c913af38e122607c96bb4319bde974f78632a6af34d952975aaa03f72816a8c9c0cc2541f81800dba28d7987bc671296519ee78f6e1a50891cf51d15681f88ef6b1f1d936ea68bbfd7fee98291b3c1ade4b8dc6f859969baa58de564995d95db674f70b3615a3088e5b8dc4617f9c6cd6586d9e3115d816c8a8923e80860971e05e9e27a9b4d7c0f8b9a5ebb651e91bc695ab3a8623d544fc7cdd1f252214bba5a3d3cec5a424cced8f72f6015a7484be9f43464b8451cb4e00c1630bfebdc337c993af06760f4ec3a4650abc858716ed8784b52ed9b6e1006a491777fe61b9cd7470635b25761888a4b286a32947ceb481a6bf69bfdb31fd23fab5189694fc4f8556e6b941564b8184d4662471268289e5b8927e5792412551970add4fe8bf58ccbde3b81fce0848f848739ce81b3a90c6d4ce2099e3126ae16caf1d10c0d3acf19696ce41b748a553420d18ca2b757d76d0f4d0a2e8dd202725a56231b90d50d325e38f0484847e0fb4be1e5b5101519ea26678f4baca733fbf99724da94a3711339a061426570d055cc09e62ccf7d6d72cf5cbb396ddc49324f8dde32a8a654fe08c20fc7f00ec6f7e1ae65ecab11c1b37b132da966d8f008c0930a4ff7e09be10abe9c99b64e34fd3f3b29a8a2a16525e44e4b945b00a2f31ea304d73733eee1cf4179f8ddae68f1b227396972af5b210f2ae481544f6c27df546e1f1025b1743a664bba94dc305be7eb5f68db38247e672d58f62e53e51d978c0b0ca1aa3e5c46b3843f44e40307aa768de3554790546faec8658af3a06fd095d84219b8d248618f9e0f5a1c4ff</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请联系微信：codewj，获取本文密码</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> opencv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HttpURLConnection&amp;OK3&amp;Retrofit自吐通杀</title>
      <link href="2021/03/02/HttpURLConnection&amp;OK3&amp;Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/"/>
      <url>2021/03/02/HttpURLConnection&amp;OK3&amp;Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/</url>
      
        <content type="html"><![CDATA[<h1 id="HttpURLConnection"><a href="#HttpURLConnection" class="headerlink" title="HttpURLConnection"></a>HttpURLConnection</h1><p>adb install -r -t <a href="https://github.com/aqi00/android2/tree/master/network" target="_blank" rel="noopener">network-debug.apk</a></p><p><strong>启动frida</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell </span><br><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs128arm64</span><br></pre></td></tr></table></figure><p><strong>内存漫游</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pyenv local 3.8.0</span><br><span class="line">objection -g com.example.network explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">android hooking list classes   查看所有可hook的类</span><br><span class="line">android hooking search classes URL</span><br><span class="line">android hooking watch class java.net.URL  由于hookURL类遗漏构造函数需要手动hook $init</span><br><span class="line">android hooking watch class_method java.net.URL.$init --dump-args --dump-backtrace --dump-return  hook构造函数并打印</span><br></pre></td></tr></table></figure><p>点击HTTP图片获取按钮，实现自吐第一步，并拿到上层实现类HttpURLConnectionImpl</p><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/%E8%87%AA%E5%90%90%E7%AC%AC%E4%B8%80%E6%AD%A5.png" alt="自吐第一步"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android hooking search classes HttpURLConnectionImpl</span><br><span class="line">android hooking watch class com.android.okhttp.internal.huc.HttpURLConnectionImpl  hook类所有方法并打印方法</span><br><span class="line">android hooking watch class_method com.android.okhttp.internal.huc.HttpURLConnectionImpl.setRequestProperty --dump-args --dump-backtrace --dump-return    hook类指定方法并打印出入参及调用栈</span><br></pre></td></tr></table></figure><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/%E8%87%AA%E5%90%90%E7%AC%AC%E4%BA%8C%E6%AD%A5.png" alt="自吐第二步"></p><p>点击HTTP图片获取按钮，实现自吐第二步</p><blockquote><p>plugin wallbreaker objectsearch com.android.okhttp.internal.huc.HttpURLConnectionImpl   存在多个实例说明每次点击生成新的对象且不释放</p><p>plugin wallbreaker objectdump –fullname 0x2972  打印其中一个对象在内存中的结构</p><p>android heap search instances com.android.okhttp.internal.huc.HttpURLConnectionImpl  获取内存中的实例地址</p><p>android heap execute 0x21e6 defaultUserAgent  手动调用defaultUserAgent</p></blockquote><h2 id="自吐"><a href="#自吐" class="headerlink" title="自吐"></a>自吐</h2><p><code>frida -U -f com.cz.babySister -l hook_HttpUrlConnection.js --no-pause</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function hook_HttpUrlConnection()&#123;</span><br><span class="line"></span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">            &#x2F;&#x2F; java.net.URL.URL  ($init) (得到URL)</span><br><span class="line">Java.use(&quot;java.net.URL&quot;).$init.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (str)&#123;</span><br><span class="line">var result &#x3D; this.$init(str)</span><br><span class="line">console.log(&quot;result , str &#x3D;&gt; &quot;,result,str);</span><br><span class="line">return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;HttpURLConnection setRequestProperty 得到各种请求头、属性等，不能hook抽象类HttpURLConnection，只能hook抽象类的实现类HttpURLConnectionImpl</span><br><span class="line">Java.use(&quot;com.android.okhttp.internal.huc.HttpURLConnectionImpl&quot;).setRequestProperty.implementation &#x3D; function(str1,str2)&#123;</span><br><span class="line">var result &#x3D; this.setRequestProperty(str1,str2);</span><br><span class="line">console.log(&quot;.setRequestProperty result,str1,str2-&gt;&quot;,result,str1,str2);</span><br><span class="line">return result; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Java.use(&quot;com.android.okhttp.internal.huc.HttpURLConnectionImpl&quot;).setRequestMethod.implementation &#x3D; function(str1)&#123;</span><br><span class="line">var result &#x3D; this.setRequestMethod(str1);</span><br><span class="line">console.log(&quot;.setRequestMethod result,str1,str2-&gt;&quot;,result,str1);</span><br><span class="line">return result; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">setImmediate(hook_HttpUrlConnection)</span><br></pre></td></tr></table></figure><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/HttpURLConnection%E8%87%AA%E5%90%90.png" alt="HttpURLConnection自吐"></p><h1 id="OkHttp3"><a href="#OkHttp3" class="headerlink" title="OkHttp3"></a>OkHttp3</h1><h2 id="搭建抓包环境"><a href="#搭建抓包环境" class="headerlink" title="搭建抓包环境"></a>搭建抓包环境</h2><h3 id="默认创建"><a href="#默认创建" class="headerlink" title="默认创建"></a>默认创建</h3><p>Okhttp框架帮我们默认所有配置，因此无法自定义添加用户拦截器。</p><p>as新建Ok3Demo项目，创建页面button布局</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:orientation&#x3D;&quot;vertical&quot;</span><br><span class="line">    android:gravity&#x3D;&quot;center|center_horizontal|center_vertical&quot;</span><br><span class="line">    tools:context&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center|center_horizontal|center_vertical&quot;</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;mybtn&quot;</span><br><span class="line">        android:text&#x3D;&quot;发送请求&quot;</span><br><span class="line">        android:textSize&#x3D;&quot;45sp&quot;&gt;</span><br><span class="line">    &lt;&#x2F;Button&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure><p>build.gradle引入ok3依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 增加对Okhttp3的依赖</span><br><span class="line">implementation(&quot;com.squareup.okhttp3:okhttp:3.12.0&quot;)</span><br></pre></td></tr></table></figure><p>AndroidManifest.xml配置网络权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 申请网络请求权限 --&gt;</span><br><span class="line">&lt;uses-permission android:name&#x3D;&quot;android.permission.INTERNET&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><p>创建异步请求线程，在RealCall.newRealCall()中，创建了一个新的RealCall对象，RealCall对象是Okhttp3.Call接口的一个实现，也是Okhttp3中Call的唯一实现。它表示一个等待执行的请求，它只能被执行一次，但实际上，到这一步，请求依然可以被取消。因此只有Hook 了execute()和enqueue(new Callback())才能真正保证每个从Okhttp出去的请求都能被Hook到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class example &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; TAG即为日志打印时的标签</span><br><span class="line">    private static String TAG &#x3D; &quot;learnokhttp&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 新建一个Okhttp客户端</span><br><span class="line">    OkHttpClient client &#x3D; new OkHttpClient();</span><br><span class="line"></span><br><span class="line">    void run(String url) throws IOException &#123;</span><br><span class="line">        &#x2F;&#x2F; 构造request</span><br><span class="line">        Request request &#x3D; new Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 发起异步请求</span><br><span class="line">        client.newCall(request).enqueue(new Callback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call call, IOException e) &#123;</span><br><span class="line">                call.cancel();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F;打印输出</span><br><span class="line">                Log.d(TAG,  response.body().string());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MainActivity中调用网络请求线程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private static String TAG &#x3D; &quot;learnokhttp&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 定位发送请求按钮</span><br><span class="line">        Button btn &#x3D; findViewById(R.id.mybtn);</span><br><span class="line"></span><br><span class="line">        btn.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                &#x2F;&#x2F; 访问百度首页</span><br><span class="line">                String requestUrl &#x3D; &quot;https:&#x2F;&#x2F;www.baidu.com&#x2F;&quot;;</span><br><span class="line">                example myexample &#x3D; new example();</span><br><span class="line">                try &#123;</span><br><span class="line">                    myexample.run(requestUrl);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="建造者-Builder-模式"><a href="#建造者-Builder-模式" class="headerlink" title="建造者(Builder)模式"></a>建造者(Builder)模式</h3><p>新建LoggingInterceptor类，实现Interceptor接口，这代表它是一个拦截器，接下来实现intercept方法，我们的拦截器会打印URL和请求headers</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class LoggingInterceptor implements Interceptor &#123;</span><br><span class="line">    &#x2F;&#x2F; TAG即为日志打印时的标签</span><br><span class="line">    private static String TAG &#x3D; &quot;learnokhttp&quot;;</span><br><span class="line"></span><br><span class="line">    @Override public Response intercept(Interceptor.Chain chain) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        Request request &#x3D; chain.request();</span><br><span class="line">        Log.i(TAG, &quot;请求URL：&quot;+String.valueOf(request.url())+&quot;\n&quot;);</span><br><span class="line">        Log.i(TAG, &quot;请求headers：&quot;+&quot;\n&quot;+String.valueOf(request.headers())+&quot;\n&quot;);</span><br><span class="line"></span><br><span class="line">        Response response &#x3D; chain.proceed(request);</span><br><span class="line"></span><br><span class="line">        return response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>拦截器是Okhttp中重要的一个概念，Okhttp通过Interceptor来完成监控管理、重写和重试请求。Okhttp本身存在五大拦截器，每个网络请求，不管是GET还是PUT/POST或者其他，都必须经过这五大拦截器。拦截器可以对request做出一定修改，同时对返回的Response做出一定修改，因此Interceptor是一个绝佳的Hook点，可以同时打印输出请求和相应。</p></blockquote><p>自定义配置所有参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 此为原先的client</span><br><span class="line">OkHttpClient client &#x3D; new OkHttpClient();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 基于原先的client创建新的client</span><br><span class="line">OkHttpClient newClient &#x3D; client.newBuilder()</span><br><span class="line">    .addNetworkInterceptor(new LoggingInterceptor())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure><p>将example中代码转移到MainActivity中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private static String TAG &#x3D; &quot;learnokhttp&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String requestUrl &#x3D; &quot;http:&#x2F;&#x2F;www.kuaidi100.com&#x2F;query?type&#x3D;yuantong&amp;postid&#x3D;11111111111&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 全局只使用这一个拦截器</span><br><span class="line">    public static final OkHttpClient client &#x3D; new OkHttpClient.Builder()</span><br><span class="line">            .addNetworkInterceptor(new LoggingInterceptor())</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    Request request &#x3D; new Request.Builder()</span><br><span class="line">            .url(requestUrl)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 定位发送请求按钮</span><br><span class="line">        Button btn &#x3D; findViewById(R.id.mybtn);</span><br><span class="line"></span><br><span class="line">        btn.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                &#x2F;&#x2F; 发起异步请求</span><br><span class="line">                client.newCall(request).enqueue(new Callback() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void onFailure(Call call, IOException e) &#123;</span><br><span class="line">                            call.cancel();</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">                            &#x2F;&#x2F;打印输出</span><br><span class="line">                            Log.d(TAG, response.body().string());</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h2><p><code>adb shell &amp;&amp; ./data/local/tmp/fs128arm64</code>  启动frida</p><p><code>pyenv local 3.8.0</code>  切换python环境</p><p><code>objection -g com.onejane.ok3demo explore -P ~/.objection/plugins</code>   加载所有插件，点击发送请求并开启内存漫游</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker classsearch OkHttpClient  内存搜索OkHttpClient类</span><br><span class="line">plugin wallbreaker classdump --fullname okhttp3.OkHttpClient  打印该类结构</span><br><span class="line">plugin wallbreaker objectsearch okhttp3.OkHttpClient  获取该类的内存地址</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x2592  打印内存中该地址的类结构</span><br><span class="line">plugin wallbreaker objectsearch okhttp3.OkHttpClient   内存中存在多个OkHttpClient,默认不回收对象实例</span><br></pre></td></tr></table></figure><h2 id="okhttp3Logging"><a href="#okhttp3Logging" class="headerlink" title="okhttp3Logging"></a>okhttp3Logging</h2><p>新增okhttp3Logging类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">public final class okhttp3Logging implements Interceptor &#123;</span><br><span class="line">    private static final String TAG &#x3D; &quot;okhttpGET&quot;;</span><br><span class="line"></span><br><span class="line">    private static final Charset UTF8 &#x3D; Charset.forName(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">    @Override public Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        Request request &#x3D; chain.request();</span><br><span class="line"></span><br><span class="line">        RequestBody requestBody &#x3D; request.body();</span><br><span class="line">        boolean hasRequestBody &#x3D; requestBody !&#x3D; null;</span><br><span class="line"></span><br><span class="line">        Connection connection &#x3D; chain.connection();</span><br><span class="line">        String requestStartMessage &#x3D; &quot;--&gt; &quot;</span><br><span class="line">                + request.method()</span><br><span class="line">                + &#39; &#39; + request.url();</span><br><span class="line">        Log.e(TAG, requestStartMessage);</span><br><span class="line"></span><br><span class="line">        if (hasRequestBody) &#123;</span><br><span class="line">            &#x2F;&#x2F; Request body headers are only present when installed as a network interceptor. Force</span><br><span class="line">            &#x2F;&#x2F; them to be included (when available) so there values are known.</span><br><span class="line">            if (requestBody.contentType() !&#x3D; null) &#123;</span><br><span class="line">                Log.e(TAG, &quot;Content-Type: &quot; + requestBody.contentType());</span><br><span class="line">            &#125;</span><br><span class="line">            if (requestBody.contentLength() !&#x3D; -1) &#123;</span><br><span class="line">                Log.e(TAG, &quot;Content-Length: &quot; + requestBody.contentLength());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Headers headers &#x3D; request.headers();</span><br><span class="line">        for (int i &#x3D; 0, count &#x3D; headers.size(); i &lt; count; i++) &#123;</span><br><span class="line">            String name &#x3D; headers.name(i);</span><br><span class="line">            &#x2F;&#x2F; Skip headers from the request body as they are explicitly logged above.</span><br><span class="line">            if (!&quot;Content-Type&quot;.equalsIgnoreCase(name) &amp;&amp; !&quot;Content-Length&quot;.equalsIgnoreCase(name)) &#123;</span><br><span class="line">                Log.e(TAG, name + &quot;: &quot; + headers.value(i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!hasRequestBody) &#123;</span><br><span class="line">            Log.e(TAG, &quot;--&gt; END &quot; + request.method());</span><br><span class="line">        &#125; else if (bodyHasUnknownEncoding(request.headers())) &#123;</span><br><span class="line">            Log.e(TAG, &quot;--&gt; END &quot; + request.method() + &quot; (encoded body omitted)&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Buffer buffer &#x3D; new Buffer();</span><br><span class="line">            requestBody.writeTo(buffer);</span><br><span class="line"></span><br><span class="line">            Charset charset &#x3D; UTF8;</span><br><span class="line">            MediaType contentType &#x3D; requestBody.contentType();</span><br><span class="line">            if (contentType !&#x3D; null) &#123;</span><br><span class="line">                charset &#x3D; contentType.charset(UTF8);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Log.e(TAG, &quot;&quot;);</span><br><span class="line">            if (isPlaintext(buffer)) &#123;</span><br><span class="line">                Log.e(TAG, buffer.readString(charset));</span><br><span class="line">                Log.e(TAG, &quot;--&gt; END &quot; + request.method()</span><br><span class="line">                        + &quot; (&quot; + requestBody.contentLength() + &quot;-byte body)&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.e(TAG, &quot;--&gt; END &quot; + request.method() + &quot; (binary &quot;</span><br><span class="line">                        + requestBody.contentLength() + &quot;-byte body omitted)&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        long startNs &#x3D; System.nanoTime();</span><br><span class="line">        Response response;</span><br><span class="line">        try &#123;</span><br><span class="line">            response &#x3D; chain.proceed(request);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, &quot;&lt;-- HTTP FAILED: &quot; + e);</span><br><span class="line">            throw e;</span><br><span class="line">        &#125;</span><br><span class="line">        long tookMs &#x3D; TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startNs);</span><br><span class="line"></span><br><span class="line">        ResponseBody responseBody &#x3D; response.body();</span><br><span class="line">        long contentLength &#x3D; responseBody.contentLength();</span><br><span class="line">        String bodySize &#x3D; contentLength !&#x3D; -1 ? contentLength + &quot;-byte&quot; : &quot;unknown-length&quot;;</span><br><span class="line">        Log.e(TAG, &quot;&lt;-- &quot;</span><br><span class="line">                + response.code()</span><br><span class="line">                + (response.message().isEmpty() ? &quot;&quot; : &#39; &#39; + response.message())</span><br><span class="line">                + &#39; &#39; + response.request().url()</span><br><span class="line">                + &quot; (&quot; + tookMs + &quot;ms&quot; + (&quot;, &quot; + bodySize + &quot; body:&quot; + &quot;&quot;) + &#39;)&#39;);</span><br><span class="line"></span><br><span class="line">        Headers myheaders &#x3D; response.headers();</span><br><span class="line">        for (int i &#x3D; 0, count &#x3D; myheaders.size(); i &lt; count; i++) &#123;</span><br><span class="line">            Log.e(TAG, myheaders.name(i) + &quot;: &quot; + myheaders.value(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!HttpHeaders.hasBody(response)) &#123;</span><br><span class="line">            Log.e(TAG, &quot;&lt;-- END HTTP&quot;);</span><br><span class="line">        &#125; else if (bodyHasUnknownEncoding(response.headers())) &#123;</span><br><span class="line">            Log.e(TAG, &quot;&lt;-- END HTTP (encoded body omitted)&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            BufferedSource source &#x3D; responseBody.source();</span><br><span class="line">            source.request(Long.MAX_VALUE); &#x2F;&#x2F; Buffer the entire body.</span><br><span class="line">            Buffer buffer &#x3D; source.buffer();</span><br><span class="line"></span><br><span class="line">            Long gzippedLength &#x3D; null;</span><br><span class="line">            if (&quot;gzip&quot;.equalsIgnoreCase(myheaders.get(&quot;Content-Encoding&quot;))) &#123;</span><br><span class="line">                gzippedLength &#x3D; buffer.size();</span><br><span class="line">                GzipSource gzippedResponseBody &#x3D; null;</span><br><span class="line">                try &#123;</span><br><span class="line">                    gzippedResponseBody &#x3D; new GzipSource(buffer.clone());</span><br><span class="line">                    buffer &#x3D; new Buffer();</span><br><span class="line">                    buffer.writeAll(gzippedResponseBody);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    if (gzippedResponseBody !&#x3D; null) &#123;</span><br><span class="line">                        gzippedResponseBody.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Charset charset &#x3D; UTF8;</span><br><span class="line">            MediaType contentType &#x3D; responseBody.contentType();</span><br><span class="line">            if (contentType !&#x3D; null) &#123;</span><br><span class="line">                charset &#x3D; contentType.charset(UTF8);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (!isPlaintext(buffer)) &#123;</span><br><span class="line">                Log.e(TAG, &quot;&quot;);</span><br><span class="line">                Log.e(TAG, &quot;&lt;-- END HTTP (binary &quot; + buffer.size() + &quot;-byte body omitted)&quot;);</span><br><span class="line">                return response;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (contentLength !&#x3D; 0) &#123;</span><br><span class="line">                Log.e(TAG, &quot;&quot;);</span><br><span class="line">                Log.e(TAG, buffer.clone().readString(charset));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (gzippedLength !&#x3D; null) &#123;</span><br><span class="line">                Log.e(TAG, &quot;&lt;-- END HTTP (&quot; + buffer.size() + &quot;-byte, &quot;</span><br><span class="line">                        + gzippedLength + &quot;-gzipped-byte body)&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.e(TAG, &quot;&lt;-- END HTTP (&quot; + buffer.size() + &quot;-byte body)&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Returns true if the body in question probably contains human readable text. Uses a small sample</span><br><span class="line">     * of code points to detect unicode control characters commonly used in binary file signatures.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    static boolean isPlaintext(Buffer buffer) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Buffer prefix &#x3D; new Buffer();</span><br><span class="line">            long byteCount &#x3D; buffer.size() &lt; 64 ? buffer.size() : 64;</span><br><span class="line">            buffer.copyTo(prefix, 0, byteCount);</span><br><span class="line">            for (int i &#x3D; 0; i &lt; 16; i++) &#123;</span><br><span class="line">                if (prefix.exhausted()) &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                int codePoint &#x3D; prefix.readUtf8CodePoint();</span><br><span class="line">                if (Character.isISOControl(codePoint) &amp;&amp; !Character.isWhitespace(codePoint)) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (EOFException e) &#123;</span><br><span class="line">            return false; &#x2F;&#x2F; Truncated UTF-8 sequence.</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean bodyHasUnknownEncoding(Headers myheaders) &#123;</span><br><span class="line">        String contentEncoding &#x3D; myheaders.get(&quot;Content-Encoding&quot;);</span><br><span class="line">        return contentEncoding !&#x3D; null</span><br><span class="line">                &amp;&amp; !contentEncoding.equalsIgnoreCase(&quot;identity&quot;)</span><br><span class="line">                &amp;&amp; !contentEncoding.equalsIgnoreCase(&quot;gzip&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打包编译后取出dex改名为<code>okhttp3logging.dex</code>，<code>push</code>到<code>/data/locol/tmp</code>目录下</p><p>编写frida进行hook,<code>frida -U -f com.onejane.ok3demo -l hookOkhttp3.js --no-pause</code>并通过adb logcat 查看系统log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function hook_okhttp3_logging() &#123;</span><br><span class="line">    &#x2F;&#x2F; 1. frida Hook java层的代码必须包裹在Java.perform中，Java.perform会将Hook Java相关API准备就绪。</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;okhttp3logging.dex&quot;).load();</span><br><span class="line">        &#x2F;&#x2F; 只修改了这一句，换句话说，只是使用不同的拦截器对象。</span><br><span class="line">        var MyInterceptor &#x3D; Java.use(&quot;com.onejane.ok3demo.okhttp3Logging&quot;);</span><br><span class="line"></span><br><span class="line">        var MyInterceptorObj &#x3D; MyInterceptor.$new();</span><br><span class="line">        var Builder &#x3D; Java.use(&quot;okhttp3.OkHttpClient$Builder&quot;);</span><br><span class="line">        console.log(Builder);</span><br><span class="line">        Builder.build.implementation &#x3D; function () &#123;</span><br><span class="line">            this.networkInterceptors().add(MyInterceptorObj);</span><br><span class="line">            return this.build();</span><br><span class="line">        &#125;;</span><br><span class="line">        console.log(&quot;hook_okhttp3...&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/okhttp3logging.png" alt="okhttp3logging"></p><h1 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h1><p>git clone <a href="https://github.com/peiniwan/Ganhuo.git" target="_blank" rel="noopener">https://github.com/peiniwan/Ganhuo.git</a>  编译源码编译安装apk</p><p>修改build.gradle,buildscript.repositories和allprojects.repositories添加google()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classpath &#39;com.android.tools.build:gradle:3.5.3&#39;</span><br></pre></td></tr></table></figure><p><code>frida -U -f ganhuo.ly.com.ganhuo -l hookOkhttp3.js --no-pause</code> 调用hook_okhttp3_logging()通过adb logcat查看后台log</p><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/Retrofit%E5%9F%BA%E4%BA%8Eok3.png" alt="Retrofit基于ok3"></p><p>git clone <a href="https://github.com/siyujie/OkHttpLogger-Frida.git" target="_blank" rel="noopener">https://github.com/siyujie/OkHttpLogger-Frida.git</a>  获取Frida 实现拦截okhttp的脚本，首先将 <code>okhttpfind.dex</code> 拷贝到 <code>/data/local/tmp/</code> 目录下，执行命令启动<code>frida -UF -l okhttp_poker.js -f ganhuo.ly.com.ganhuo --no-pause</code> 可追加 <code>-o [output filepath]</code>保存到文件</p><p><strong>原理：</strong></p><p>由于所有使用的<code>okhttp</code>框架的App发出的请求都是通过<code>RealCall.java</code>发出的，那么我们可以hook此类拿到<code>request</code>和<code>response</code>, 也可以缓存下来每一个请求的<code>call</code>对象，进行再次请求，所以选择了此处进行hook。 <code>find</code>前新增<code>check</code>，根据特征类寻找是否使用了<code>okhttp3</code>库，如果没有特征类，则说明没有使用<code>okhttp</code>; 找到特征类，说明使用了<code>okhttp</code>的库，并打印出是否被混淆。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#96;find()&#96;                                         要等完全启动并执行过网络请求后再进行调用,检查是否使用了Okhttp &amp; 是否可能被混淆 &amp; 寻找okhttp3关键类及函数</span><br><span class="line">&#96;switchLoader(\&quot;okhttp3.OkHttpClient\&quot;)&#96;         参数：静态分析到的okhttpclient类名</span><br><span class="line">&#96;hold()&#96;                                         要等完全启动再进行调用,开启HOOK拦截</span><br><span class="line">&#96;history()&#96;                                      打印可重新发送的请求</span><br><span class="line">&#96;resend(index)&#96;                                  重新发送请求</span><br></pre></td></tr></table></figure></blockquote><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/OkHttpLogger-Frida%E6%8A%93Retrofit.png" alt="OkHttpLogger-Frida抓Retrofit"></p><p><strong>baseUrl自吐</strong></p><p>Hook RetrofitUtils 中的new Retrofit.Builder().baseUrl(baseurl)的baseUrl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">objection -g ganhuo.ly.com.ganhuo explore</span><br><span class="line">android hooking search classes retrofit</span><br><span class="line">android hooking list class_methods retrofit2.Retrofit</span><br><span class="line">android hooking list class_methods retrofit2.Retrofit$Builder   发现只有baseUrl()无参构造，可能在app启动时就执行了baseUrl(baseurl)</span><br><span class="line">objection -g ganhuo.ly.com.ganhuo explore --startup-command &quot;android hooking list class_methods retrofit2.Retrofit$Builder&quot;  没有反应</span><br></pre></td></tr></table></figure><p>通过编写frida脚本实现hook有参构造baseUrl</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function hookbaseurl()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;retrofit2.Retrofit$Builder&quot;).baseUrl.overload(&#39;java.lang.String&#39;).implementation &#x3D; function(str)&#123;</span><br><span class="line">            var result &#x3D; this.baseUrl(str)</span><br><span class="line">            console.log(&quot;result1,str&#x3D;&gt;&quot;,result,str)</span><br><span class="line">            return result</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(&quot;retrofit2.Retrofit$Builder&quot;).baseUrl.overload(&#39;okhttp3.HttpUrl&#39;).implementation &#x3D; function(str)&#123;</span><br><span class="line">            var result &#x3D; this.baseUrl(str)</span><br><span class="line">            console.log(&quot;result2,str&#x3D;&gt;&quot;,result,str)</span><br><span class="line">            return result</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hookbaseurl)</span><br></pre></td></tr></table></figure><p><img src="/2021/03/02/HttpURLConnection&OK3&Retrofit%E8%87%AA%E5%90%90%E9%80%9A%E6%9D%80/hookbaseurl.png" alt="hookbaseurl"></p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> okhttp3 </tag>
            
            <tag> HttpURLConnection </tag>
            
            <tag> Retrofit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强大的脚本</title>
      <link href="2021/02/22/%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%84%9A%E6%9C%AC/"/>
      <url>2021/02/22/%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><h2 id="合并多dex"><a href="#合并多dex" class="headerlink" title="合并多dex"></a>合并多dex</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import os, sys</span><br><span class="line"></span><br><span class="line"># python3.7 merge_dex.py .&#x2F;file&#x2F; livedex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    if len(sys.argv) &lt; 3 :</span><br><span class="line">        print(&quot;start error&quot;)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line">    print(sys.argv[1], sys.argv[2])</span><br><span class="line">    </span><br><span class="line">path &#x3D; sys.argv[1] #文件夹目录</span><br><span class="line">files&#x3D; os.listdir(path) #得到文件夹下的所有文件名称</span><br><span class="line">s &#x3D; []</span><br><span class="line">for file in files: #遍历文件夹</span><br><span class="line">    if file.find(&quot;dex&quot;) &gt; 0: ## 查找dex 文件</span><br><span class="line">        sh &#x3D; &#39;jadx -j 1 -r -d &#39; + sys.argv[2] + &quot; &quot; + path + file</span><br><span class="line">        print(sh)</span><br><span class="line">        os.system(sh)</span><br></pre></td></tr></table></figure><h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><h3 id="排列组合"><a href="#排列组合" class="headerlink" title="排列组合"></a>排列组合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">productType = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">goodType = [<span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">energyType = [<span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line">productGoodEnergyType = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">6</span>, <span class="number">7</span>]]</span><br><span class="line"><span class="comment"># 多个集合随机有序排列,同itertools.product(*productGoodEnergyType)</span></span><br><span class="line"><span class="keyword">for</span> newValue <span class="keyword">in</span> itertools.product(productType,goodType,energyType): </span><br><span class="line">    print(newValue)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按组合个数进行无序组合</span></span><br><span class="line">print(list(itertools.permutations(productType)))  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> productTypeIndex <span class="keyword">in</span> range(<span class="number">1</span>, len(productType) + <span class="number">1</span>):</span><br><span class="line">    <span class="comment"># 单个集合按指定个数随机有序排列</span></span><br><span class="line">    productTypeTter1 = itertools.combinations(productType, productTypeIndex)  </span><br><span class="line">    print(list(productTypeTter1))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 单个集合按指定个数随机无序组合</span></span><br><span class="line">    productTypeTter2 = itertools.permutations(productType, productTypeIndex)  </span><br><span class="line">    print(list(productTypeTter2))</span><br></pre></td></tr></table></figure><h3 id="多集合组合"><a href="#多集合组合" class="headerlink" title="多集合组合"></a>多集合组合</h3><ol><li>拿到集合的组合</li><li>根据这些组合进行分组笛卡尔积</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def combine(big_dict):</span><br><span class="line">    # Cn1+Cn2+...+Cnn</span><br><span class="line">    # Cmn&#x3D;m!&#x2F;n!*(m-n)!</span><br><span class="line">    keys &#x3D; list(big_dict.keys())  # 获取keyList</span><br><span class="line">    combine_key_list &#x3D; []  # key值 排列组合</span><br><span class="line">    valueList &#x3D; []  # 将key替换为值</span><br><span class="line">    for i in range(1, len(keys) + 1):</span><br><span class="line">        iter &#x3D; itertools.combinations(keys, i)</span><br><span class="line">        # [(&#39;a&#39;,), (&#39;b&#39;,), (&#39;c&#39;,), (&#39;a&#39;, &#39;b&#39;), (&#39;a&#39;, &#39;c&#39;), (&#39;b&#39;, &#39;c&#39;), (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)]</span><br><span class="line">        combine_key_list.extend(list(iter))  # key的所有组合 以list形式加入列表</span><br><span class="line"></span><br><span class="line">    for m in combine_key_list:</span><br><span class="line">        # [[[1, 2, 3]], [[4, 5]], [[6, 7, 8, 9]], [[1, 2, 3], [4, 5]], [[1, 2, 3], [6, 7, 8, 9]], [[4, 5], [6, 7, 8, 9]], [[1, 2, 3], [4, 5], [6, 7, 8, 9]]]</span><br><span class="line">        valueList.append([big_dict.get(n) for n in m if n in keys])  # key所有组合转value组合 以object形式加入列表</span><br><span class="line"></span><br><span class="line">    param_list &#x3D; []</span><br><span class="line">    for index, value in enumerate(valueList):  # list转为索引序列</span><br><span class="line">        search_type_key &#x3D; list(combine_key_list[index])  # 根据当前值对应key</span><br><span class="line">        for item in itertools.product(*value):  # 集合中n个集合n组笛卡尔积</span><br><span class="line">            params &#x3D; dict(zip(search_type_key, list(item)))</span><br><span class="line">            param_list.append(urlencode(params))</span><br><span class="line">    print(param_list)</span><br><span class="line"></span><br><span class="line">d &#x3D; &#123;</span><br><span class="line">    &#39;a&#39;: [1,2,3],</span><br><span class="line">    &#39;b&#39;: [4,5],</span><br><span class="line">    &#39;c&#39;: [6,7,8,9],</span><br><span class="line">&#125;</span><br><span class="line">combine(d)</span><br></pre></td></tr></table></figure><h2 id="格式转换"><a href="#格式转换" class="headerlink" title="格式转换"></a>格式转换</h2><p><strong>转str</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D; (1,2)</span><br><span class="line">l &#x3D; [3,4]</span><br><span class="line">print(&#39;,&#39;.join(map(str, t)) if isinstance(t,tuple) else t)</span><br><span class="line">print(&#39;,&#39;.join(map(str, l)) if isinstance(l,list) else l)</span><br></pre></td></tr></table></figure><p><strong>转dict</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(dict(zip(productType,goodType)))</span><br></pre></td></tr></table></figure><p><strong>转list</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def flatten(li):</span><br><span class="line">    return sum(([x] if not isinstance(x, list) else flatten(x) for x in li), [])</span><br></pre></td></tr></table></figure><p><strong>字典key替换</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param_dict[&#39;area&#39;] &#x3D; param_dict.pop(&#39;ownerProvince&#39;)+&#39;-&#39;+param_dict.pop(&#39;ownerCity&#39;)</span><br></pre></td></tr></table></figure><h2 id="Mongo"><a href="#Mongo" class="headerlink" title="Mongo"></a>Mongo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import pymongo</span><br><span class="line">client &#x3D; pymongo.MongoClient(settings.get(&#39;MONGO_URI&#39;))[settings.get(&#39;MONGO_DB&#39;)]</span><br><span class="line">client[&#39;MUsedCar&#39;].create_index([(&quot;url&quot;, 1)], unique&#x3D;True)</span><br><span class="line">client[&#39;MUsedCar&#39;].insert(dict(&#123;&#39;url&#39;:used_car_url+urlencode(param_dict)&#125;))</span><br><span class="line">for doc in client[&#39;MUsedCarParams&#39;].find():</span><br><span class="line">    print(doc[&#39;params&#39;])</span><br></pre></td></tr></table></figure><h2 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h2><h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">param_dict &#x3D; dict(parse.parse_qsl(parse.unquote(doc[&#39;params&#39;])))  url解码并转为字典</span><br><span class="line">urlencode(param_dict)  字典转url编码</span><br></pre></td></tr></table></figure><h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="idea生成注释文档"><a href="#idea生成注释文档" class="headerlink" title="idea生成注释文档"></a>idea生成注释文档</h2><p>File =&gt; setting =&gt; editor =&gt; File and Code Templates</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: onejane</span><br><span class="line">@time: $&#123;DATE&#125; $&#123;TIME&#125;</span><br><span class="line">@desc:</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p>File =&gt; Setting=&gt; Editor=&gt; Live Templates</p><p><img src="/2021/02/22/%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%84%9A%E6%9C%AC/liveTemplate.png" alt="live template"></p><p>输入onejane代码提示直接回车即可</p><p>Tools-Generate JavaDoc</p><p><img src="/2021/02/22/%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%84%9A%E6%9C%AC/idea%E7%94%9F%E6%88%90%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3.png" alt="idea生成注释文档"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zh_CN</span><br><span class="line">-tag ProjectDetails:a:&quot;项目详情:&quot; -tag update:a:&quot;项目更改:&quot; -tag CreateDate:a:&quot;创建时间:&quot; -encoding UTF-8 -charset UTF-8</span><br></pre></td></tr></table></figure><p><img src="/2021/02/22/%E5%BC%BA%E5%A4%A7%E7%9A%84%E8%84%9A%E6%9C%AC/javaDoc.png" alt="javaDoc"></p><h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><h2 id="多仓库"><a href="#多仓库" class="headerlink" title="多仓库"></a>多仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url --add origin git@github.com:OneJane&#x2F;CrawlerBase.git</span><br><span class="line">git push origin --all</span><br></pre></td></tr></table></figure><p>git remote add origin <a href="mailto:&#103;&#105;&#116;&#x40;&#x67;&#105;&#116;&#101;&#x65;&#46;&#x63;&#111;&#109;">&#103;&#105;&#116;&#x40;&#x67;&#105;&#116;&#101;&#x65;&#46;&#x63;&#111;&#109;</a>:OneJane/picture.git   初始化后建立git库</p><h2 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br><span class="line">git reset --hard 版本号</span><br></pre></td></tr></table></figure><h2 id="大仓库提交"><a href="#大仓库提交" class="headerlink" title="大仓库提交"></a>大仓库提交</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config http.postBuffer 524288000</span><br></pre></td></tr></table></figure><p>不行就使用git替代https地址</p><h2 id="合并不同提交历史"><a href="#合并不同提交历史" class="headerlink" title="合并不同提交历史"></a>合并不同提交历史</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></figure><h1 id="Mongo-1"><a href="#Mongo-1" class="headerlink" title="Mongo"></a>Mongo</h1><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>批量将字段更新成字符串</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;alimama&#39;).find(&#123;&#125;).forEach(function(x)&#123;</span><br><span class="line">    db.getCollection(&#39;alimama&#39;).updateOne(</span><br><span class="line">    &#123;_id: x._id&#125;, &#123;$set:&#123;income_rate: String(x.income_rate)&#125;&#125;</span><br><span class="line">)&#125;)</span><br></pre></td></tr></table></figure><p>批量新增字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;taobao&#39;).update(&#123;&#125;, &#123;$set: &#123;&#39;name&#39;:&quot;taobao&quot;&#125;&#125;, &#123;multi: true&#125;);</span><br></pre></td></tr></table></figure><p>批量修改字段名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;long_link&#39;).update(&#123;&#125;, &#123;&quot;$rename&quot;:&#123;&quot;long_link&quot;:&quot;orientPlanLinkUrl&quot;&#125;&#125;, false, true)</span><br></pre></td></tr></table></figure><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>返回指定字段id</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;alimama&#39;).find(&#123;&#125;,&#123;_id:0,id:1&#125;)</span><br></pre></td></tr></table></figure><p>按照url分组查询并倒序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;conditions&#39;).aggregate([&#123;$group : &#123;_id : &quot;$url&quot;, num_tutorial : &#123;$sum : 1&#125;&#125;&#125;,&#123; $sort : &#123;  num_tutorial: -1 &#125; &#125;])</span><br></pre></td></tr></table></figure><p>模糊查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;conditions&#39;).find(&#123;&#39;url&#39;:&#123;&#39;$regex&#39;:&#39;https:*&#39;&#125;&#125;).count()</span><br></pre></td></tr></table></figure><p>导出</p><p>sublime 中ctrl+h 进行 {“_id”:.<em>:”(.</em>)”}\n  替换为 $1\n</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoexport -h 172.20.0.186:27017 -d jddmoto -c mbrand -o mbrand.json --type json -f url</span><br></pre></td></tr></table></figure><h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><h2 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT GROUP_CONCAT(a.n_id), COUNT(a.&#96;n_id&#96;) FROM &#96;motor_business_essay&#96; a, &#96;motor_business_essay_ext&#96; b where  locate(&#39;&quot;img&quot;:&quot;&quot;&#39;,a.c_short_vod_info)</span><br></pre></td></tr></table></figure><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="删除大文件"><a href="#删除大文件" class="headerlink" title="删除大文件"></a>删除大文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df -h</span><br><span class="line">lsof | grep deleted   查询内存中持续删除的进程</span><br><span class="line">kill -9 id</span><br></pre></td></tr></table></figure><h1 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h1><h2 id="新增复制文件路径-reg"><a href="#新增复制文件路径-reg" class="headerlink" title="新增复制文件路径.reg"></a>新增复制文件路径.reg</h2><p>UTF-8-BOM编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\copypath]</span><br><span class="line">@&#x3D;&quot;复制文件路径到剪贴板&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\copypath\command]</span><br><span class="line">@&#x3D;&quot;cmd &#x2F;c echo %1 | clip&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\copypathwithquote]</span><br><span class="line">@&#x3D;&quot;复制文件路径到剪贴板(带引号)&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\*\shell\copypathwithquote\command]</span><br><span class="line">@&#x3D;&quot;cmd &#x2F;c echo \&quot;%1\&quot; | clip&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\copypath]</span><br><span class="line">@&#x3D;&quot;复制文件夹路径到剪贴板&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\copypath\command]</span><br><span class="line">@&#x3D;&quot;cmd &#x2F;c echo %1 | clip&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\copypathwithquote]</span><br><span class="line">@&#x3D;&quot;复制文件夹路径到剪贴板(带引号)&quot;</span><br><span class="line">[HKEY_CLASSES_ROOT\Directory\shell\copypathwithquote\command]</span><br><span class="line">@&#x3D;&quot;cmd &#x2F;c echo \&quot;%1\&quot; | clip&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加壳与脱壳之分类技术</title>
      <link href="2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/"/>
      <url>2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="历代加壳技术分类"><a href="#历代加壳技术分类" class="headerlink" title="历代加壳技术分类"></a>历代加壳技术分类</h1><p><strong>动态加载</strong>是用到的时候再去加载，也叫懒加载，是dex加壳，插件化，热更新的基础，避免发布新版本需要用户全量更新app，快速迭代，提升用户体验。比如阿里的AndFix和HotFix，腾讯的tinker，美团的Robust等热修复框架的基础。动态加载的dex不具有生命周期特征，APP中的Activity，Service等组件无法正常工作，只能完成一般函数的调用。需要对ClassLoader进行修正，APP才能够正常运行，有<strong>反射替换</strong>和<strong>反射插入</strong>两种修正手段，这是加壳app必然要做的一步。</p><h2 id="第一代壳-dex加密"><a href="#第一代壳-dex加密" class="headerlink" title="第一代壳:dex加密"></a>第一代壳:dex加密</h2><ol><li><p>Dex字符串加密</p></li><li><p>资源加密</p></li><li><p>对抗反编译</p></li><li><p>反调试</p></li><li><p>自定义 DexClass Loader</p></li></ol><blockquote><p>由于是dex整体保护，在内存中映射是整体连续的，通过定位起始地址将app完整脱下来</p></blockquote><h2 id="第二代壳-dex抽取与加固"><a href="#第二代壳-dex抽取与加固" class="headerlink" title="第二代壳:dex抽取与加固"></a>第二代壳:dex抽取与加固</h2><ol><li><p>对抗第一代壳常见的脱壳法</p></li><li><p>Dex method代码抽取到外部(通常企业版)</p></li><li><p>Dex动态加载</p></li><li><p>So加密</p></li></ol><blockquote><p>首先dex整体保护，其次对关键函数进行抽取(dump内存区域中dex关键类为空)进行so加密，对抗第一代壳常用脱壳法(从关键hook点dump dex)</p></blockquote><h2 id="第三代壳-dex动态解密与混淆"><a href="#第三代壳-dex动态解密与混淆" class="headerlink" title="第三代壳:dex动态解密与混淆"></a>第三代壳:dex动态解密与混淆</h2><ol><li><p>Dex method代码动态解密</p></li><li><p>So代码膨胀混淆</p></li><li><p>对抗之前出现的所有脱壳法</p></li></ol><blockquote><p>对抗第二代壳的一个通用脱壳工具DexHunter(通过遍历dex所有类进行加载初始化，将内存中dex完整恢复),dex中method动态解密，指定函数只有被调用时才执行，dex在内存中始终不是完整的状态</p></blockquote><h2 id="第四代壳-vmp壳"><a href="#第四代壳-vmp壳" class="headerlink" title="第四代壳:vmp壳"></a>第四代壳:vmp壳</h2><p>目前仍然是smali指令级别的vmp，未来将出现arm指令级别vmp</p><h1 id="加壳技术分析"><a href="#加壳技术分析" class="headerlink" title="加壳技术分析"></a>加壳技术分析</h1><h2 id="dex加固"><a href="#dex加固" class="headerlink" title="dex加固"></a><strong>dex加固</strong></h2><ul><li>dex整体加固:文件加载（<strong>监控app访问文件的记录</strong>）和内存加载（<strong>对内存dex的解密直接动态加载</strong>）</li><li>函数抽取:在函数粒度完成代码的保护：<strong>dump下dex的关键函数体置空</strong></li><li>VMP和Dex2C:JAVA函数 Native化。<strong>vmp-&gt;逆向分析解释器找到取址译码</strong></li></ul><h3 id="dex整体加固"><a href="#dex整体加固" class="headerlink" title="dex整体加固"></a>dex整体加固</h3><p>dex整体加壳是基础防护，所有加壳的app必然都有，关键在于怎么区分函数抽取，vmp以及dex2c甚至多种技术混合的混合型壳。</p><ol><li><p>文件加载:定位解密文件是关键</p></li><li><p>内存加载:加载时机和内存起始地址是关键</p></li></ol><p>通用方案:dex打开和优化的流程以及产出的odex、dex2oat编译的流程和生成的oat文件等等</p><h3 id="函数抽取"><a href="#函数抽取" class="headerlink" title="函数抽取"></a>函数抽取</h3><p>获取到保护的dex后,函数体的内容是无效的,注意这里说的是无效,而不是无意义,有的app壳后函数依然是有意义的,但不是我们想要的。f5查看函数体全部为空，则表现为函数抽取。</p><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/%E5%87%BD%E6%95%B0%E6%8A%BD%E5%8F%96%E6%A0%B7%E6%9C%AC1.png" alt="函数抽取样本"></p><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/%E5%87%BD%E6%95%B0%E6%8A%BD%E5%8F%96%E6%A0%B7%E6%9C%AC2.png" alt="函数抽取样本"></p><h3 id="VMP"><a href="#VMP" class="headerlink" title="VMP"></a><strong>VMP</strong></h3><p>获取到保护的dex后,函数的属性由java属性变为 Native,典型的有数字的 onCreate函数 Native化JNI函数。vmp壳的核心就是dalvik虚拟机的解释器原理。</p><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/vmp%E6%A0%B7%E6%9C%AC.png" alt="vmp样本"></p><blockquote><p> 若所有vmp保护的函数都有自己的解释器则so必然很大，所以必然共享一个解释器，vmp化的函数注册地址一致或者函数逻辑相似。</p></blockquote><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/vmp%E5%8C%96%E7%9A%84%E5%87%BD%E6%95%B0%E6%B3%A8%E5%86%8C%E5%9C%B0%E5%9D%80%E4%B8%80%E8%87%B4.png" alt="vmp化的函数注册地址一致"></p><p>MainActivity动态注册地址在d3dec3f1,TestActivity地址一致，说明vmp保护。</p><blockquote><p> 参考vmp加壳方案之<a href="https://github.com/chago/ADVMP" target="_blank" rel="noopener">ADVMP</a>，vmp对每一种smali指令处理，保护了函数后函数属性发生改变，因为解释器一般是用JNI实现，java易被反编译，故没用java实现，基本由c实现，防止快速定位到解释器的取址译码和执行的流程会加ollvm混淆保护之类。<img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/ADVMP.png" alt="ADVMP"></p></blockquote><h3 id="Dex2c"><a href="#Dex2c" class="headerlink" title="Dex2c"></a><strong>Dex2c</strong></h3><p>获取到保护的dex后保护的函数属性有java变成native，dcc保护后所有java属性的函数变成jni函数，只能看到类名和参数。核心原理与编译原理相关，传统编译原理是编译器经过词法分析语法分析生成二进制代码，dex2c中生成结果是c、c++文件，经过ndk编译器最终编译为so,每一个函数基本编译成一个c/c++文件，ubuntu中编译最终生成一个so。</p><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/dcc%E4%BF%9D%E6%8A%A4%E6%A0%B7%E6%9C%AC.png" alt="dcc保护"></p><blockquote><p>dex2c核心对指定java函数进行语义分析生成各个不同的c/c++代码编译为相应so，自然dex2c保护的函数逻辑不一致，自然注册地址不同。</p></blockquote><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/dex2c%E4%BF%9D%E6%8A%A4%E6%B3%A8%E5%86%8C%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%90%8C.png" alt="dex2c保护注册地址不同"></p><p>MainActivity的地址在7ba61b17c0，TestActivity地址在7ba61ac604，说明dex2c保护。</p><p>dcc_out.apk在lib下编译生成了so文件中,jni函数静态注册都存放于so文件中，使用IDA v7打开libnc.so，搜索java就可以找到所有jni函数。</p><blockquote><p>dcc_out编译于项目LoadDex,新增FirstActivity，SecondActivity</p><p>MainActivity.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">static&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        System.loadLibrary(&quot;nc&quot;);</span><br><span class="line">    &#125; catch (UnsatisfiedLinkError e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">setContentView(R.layout.activity_main);</span><br><span class="line">Button mybutton01&#x3D;findViewById(R.id.button01);</span><br><span class="line">mybutton01.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View view) &#123;</span><br><span class="line">        context.startActivity(new Intent(context,FirstActivity.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">Button mybutton02&#x3D;findViewById(R.id.button02);</span><br><span class="line">mybutton02.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View view) &#123;</span><br><span class="line">        context.startActivity(new Intent(context,SecondActivity.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>AndroidManifest.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:name&#x3D;&quot;.FirstActivity&quot;&gt;&lt;&#x2F;activity&gt;</span><br><span class="line">&lt;activity android:name&#x3D;&quot;.SecondActivity&quot;&gt;&lt;&#x2F;activity&gt;</span><br></pre></td></tr></table></figure><p>activity_main.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    android:id&#x3D;&quot;@+id&#x2F;LinearLayout1&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;button01&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity&#x3D;&quot;center_horizontal&quot;</span><br><span class="line">        android:text&#x3D;&quot;FirstActivity&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;button02&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity&#x3D;&quot;center_horizontal&quot;</span><br><span class="line">        android:text&#x3D;&quot;SecondActivity&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure></blockquote><p>dcc_ollvm.apk 在dex2c过程中加入了ollvm，在ida中打开so，jni找不到。</p><blockquote><p>参考dex2c加壳方案之<a href="https://github.com/amimo/dcc" target="_blank" rel="noopener">dcc</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;amimo&#x2F;dcc.git</span><br><span class="line">pyenv local 3.8.5 &amp;&amp; cd dcc &amp;&amp; pip install -r requirements.txt</span><br><span class="line">vim filter.txt  添加.*onejane*. 编译函数名含有onejane的函数</span><br><span class="line">python dcc.py dcc.apk -o dcc_out.apk  加固app</span><br></pre></td></tr></table></figure></blockquote><p>VMP和dex2c是高级防护</p><ol><li><p>VMP:定位解释器是关键,找到映射关系便可恢复</p></li><li><p>dex2c:基础是编译原理,进行了等价语义转换,彻底还原难度巨大:</p></li></ol><p>通用分类技术:关注JNI相关的ap调用是关键,也是分析VMP和dex2c保护的函数的逻辑的关键。</p><h3 id="混合型壳"><a href="#混合型壳" class="headerlink" title="混合型壳"></a><strong>混合型壳</strong></h3><p>多种加固技术混合使用,比如先将原有smal指令流使用VMP或dex2c保护,构建object数组传递给jni函数进行调用，然后再经过函数抽取进一步保护</p><p><img src="/2021/02/21/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%88%86%E7%B1%BB%E6%8A%80%E6%9C%AF/%E6%B7%B7%E5%90%88%E5%9E%8B%E5%A3%B3.png" alt="混合型壳"></p><p><strong>区分apk保护技术</strong></p><table><thead><tr><th></th><th>是否Native化</th><th>函数体无效</th></tr></thead><tbody><tr><td>函数抽取类壳</td><td>否</td><td>是</td></tr><tr><td>vmp壳</td><td>是</td><td>native化</td></tr><tr><td>Dex2c壳</td><td>是</td><td>native化</td></tr></tbody></table><h2 id="so加固"><a href="#so加固" class="headerlink" title="so加固"></a><strong>so加固</strong></h2><ul><li><p>基于init、 init_array以及JNI_Onload函数的加壳</p></li><li><p>基于自定义linker的加壳</p></li></ul><p><strong>IDA快捷键</strong></p><table><thead><tr><th>空格键</th><th>反汇编窗口切换文本跟图形</th></tr></thead><tbody><tr><td>ESC</td><td>退到上一个操作地址</td></tr><tr><td>F5</td><td>C伪代码</td></tr><tr><td>alt+t</td><td>搜索文本</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
          <category> 加壳与脱壳 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fart </tag>
            
            <tag> vmp </tag>
            
            <tag> dex2c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>抓包环境与hook</title>
      <link href="2021/02/18/%E6%8A%93%E5%8C%85%E7%8E%AF%E5%A2%83%E4%B8%8Ehook/"/>
      <url>2021/02/18/%E6%8A%93%E5%8C%85%E7%8E%AF%E5%A2%83%E4%B8%8Ehook/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="fb7c39343c827011ae21cb7c69998542ef4ae4b3f237e96371f11584c082b5c3">33bf6092751dd6b0f94b158b3ebdba082968212413e44424cc10b25e464ec4040a1512a5a132fd382089b365979d3c8ab6eb05ff0a755c138e5e903e0c29353ef87a983f74bd73a71c80adcc0e8f28066c24cb727b778d2c6c7b21e92c6ebb2f48264c61a8c4bbdd8e0dbadbf62ebc69cd1da3a774566f043fdac80d12b1bf01abb2fe9412d54352779fd12f47807cf451706ed8ff8d719e65ebb7fe469c3e7ae5075f8b3418884440635a3667d31378bdba4b53590f5f606e547270f00c0a5a55668cfd3e82867257d70a6496d0bf7339814fac3e964e6a4357de654b1b7e4b75997d24976382a435b3c93a66d87fb6e80f6656ee206e79e1af94c30d40c671d02ac47f0b187d47bce42a0b76b094b070739e963010c8bb1264d5ff1d120c90bbe92e5e819ffbcab537a8a2b943be3e97bb8206e871fcf2d11efc385089c92559ec3ab5114628cd706f709b3288347753565ab0a1e974d9edc8ef62574d8572b53a0cb8342dc8ac187b322b284c7277629d5c64ada6703985ed274ee15cbbd2764a50a2085d2d498017853ab7062474fb5f3c826c613b8530e4d36af0345147d60b2fe83cca3c5f793bfa601d09898ce017da955b55740dff52fc79271828ec7d59571d6af499b90c73118df08b2eb7989ec9bc6a728597c35196e175c7c782f7eee740df891003f087f1d1cdb36c73fcc3dd9196becc89941d847f904fa8e70ec3f041d5f5e417024c0b0ff0889f61fbaf8c4ad62ddedc5dc6b102ea718b622ef21e85e2cba8b4a9158069e1b6ff143521d021648d613c9b49be7787afa2c1fbd9f4d8a720e9f8e6cd802dba40b5d3763c4e593853c3839efbce711226f353252aef703f1d2cde4691e42f25da3c3716ad95bb2ee0a13a1c0563be121843fd8bb5d80d210b7b9f2a2ce26998a8d5c84e79da28180c47f4eac2ad243154183d6bda4b673fa450fd2b537373af64711f57a831b17f05a0b397189dc343cd6d4b6efcc5875024782976802bf29b4831c8e6cf6b755844dbac689f451c4363cf2282dd8b7502faa026b6d354f299297778a950688481cc3a2bac851c85b4831e5d64f2356e18ffd5c1c8cc2378f94e62032b012dfb69c7c4f827c93c1709c1162a52944b6711de65ce0f7044dd7138af69e437832b406674d0f5ada088687f1784a63b069a67a65d5d61388a7f104dac00c5c910f0fd7a33dfa250ff7f4da003001dad7c115d386e654c3fce0d2e3a6cbb39f6427092360088db5e35fb859db0a6ec613597f2a804e79cc50b818038bdd9929dca8129e14a438a7e91078d200c7fbed4e0df29a6c8f7eaa017228de0548ce754b7d30c92778c65d6d339fa5a5da61e262967e5bc97cd659a23a56ceabacfd54290394f4427dab2a04e8cc15b7f0b1441bc1d59649e32e5a7251efec8e2633926cdc74670cd5d1dbc58be7b701e101a898986a2f7bb067e69cb7839e0989435a2b39bda67b4425c82b5a140413193173edbe24515e65cf2b7147f37070aa134ba52be32d038ff7c896c4d1b0b024a33f08ba8f8770ec4eec1420511d73b4c1042388a6a00664ecdc349a6648b8aa609ee994d5f39365d3f71ac6dd3b93a0e03842a6293f4a0bf0a38682944cb2fefcc9f081becf410c62d1b4fd9c94a4ab1fe8cb5ebe6648b647ca09f03fe11c995ecd01b23982c27fb7296895afccd07188ee86526d413a65baaabd25e5e89281eef2ac183d11aa6b06b441dd5bdf434f38010d306116b0101dbee086a63e55e4a0071cac44a91e2f4dbfb429a85d175f7326634efde3aebd41699e7cf340a831c3131ddd976d291cc604e555e1c91c5ec8a2c458b149683ed5382e8597090c33cbe9982876e652bd10a002bea33ee35e887515b631b2843337c564dcd19c869e3283b7bc86fc12cd8e1379e2cea33d90312a5f38705364e540dc4e4f0d672151b35a1ca71df51a9d7c06c11cbd5bee7c3ab2ae71cc4fdfb26b978a5ab86dccbb7f5d185d550d100361db8e9372083ed6ae8f2fd987c02911da6fb9ac7afe09351b2666b9ef5a51c8f775b1843f494271bcae4c8e4baeb80df1a7e8233321e32d25b38f1bc00007dcbcca0352278f5c2a7ce9688bc51313b4562cb7244fb8788d520f52cf92d540bd0b25ca4fc18ac43bcd26ea2c5627504b2011f7cdc67baf1a8cc61c90fca32e85aee4e950d37f0471fb2823f581889bc62054d8905c60e4dc5418e9172ac03f190e8872c135eb5306488706dc332ffd0478d2473a4aec22d25c32b39a4e5a7dabd02f11c77f5b64549f37b510db76e1dca70ac80fb6dd36cd87596eb3af7c3c2722cb73d6715af5d670cf7adea55cf3fc93f6c6862472f5b5fe867a30c0faa8bd71693cf932710a8b9dd0bc012843b45b8ed5a64db207e3ca202c7b033044ce731e48fa5332fd6140537eb23723f1d1bb258e71b5c809ed846c0c0fc170dee6bd6bc582dfd45d89b53e187ab2b4f239dd59ed79922f5db139798bc9306261c8c1459df173f70259afd88a0b0544771d1480fa7df9358ad3d64296363538243a2f1dd41403a4c6718bfa2b837f7ba9ce6627fb16461c846c63e9a4bc8098320dadd9b85a377f0daf627069108f37df3d07f7af06fb354143c6a49a7662180565710db0d93c6c8dbce4196f3ffe42bcbf74dfdd33a981c78eb5af31ba36c4c72e2d43168ac01138371da0a00281197d15a53f2544015307b008da9311738c13af5f8169c8161d80b237acec97099c9b0a341b1e92919fbd63757b0993115daffd6dae7fcf8267bf9498a6f49f3e40c3de596be2bec648e86ccc6ce1cda0419009e4c55baabcbc2140396aa8fad44aa711ebedaf4bc48f9dbea1e7d60286220200cc79f66100e51b92db6b43f8bedf3d84e6b464f6ab6cb522a82491bdf176802c0a2f131701da071ad49a7726df42ec0fd798e51548dddb515e42db284c58b5eecf33b46ff230641067e2d20496642876d47f0473305cb13d8b8e80c846725c52b86d568bd3181432e501f1b84d7c66037389eab72ed0acfb08cbd4163c79b9f7fe8a1b32dca0c8db9ca069417cd356e31316975bea0a2e7c40812e78083af45783163471b925ab2514c48e0d812dad0f18f85bc2cff75fd1156f73f25c47c9b5b19bfba41d181c6855df855f8ba0590db900917eb3bcc8a28d8134af8843369345ff52309d0a5dcbd930e31a9eeb9362f938c3b623008855e274084a4eac33d5246dd5190a4742997baf8a21a58217487501a23c7ddc9a96a71ac8635b3851470e32e092d93e040498ef3d4bd50213c82f415fd41d11c8e0ee30e1a9eae56928c1528b70fc0f1b617f33b5049de9af3f041d64377453dae1e0a33c020bbd467dc6b3aa985196038b81221aa44df3aab1ef35994fa3eb891c42cf1465573f92929aa8adc2ca69da044d64da650c21e240e13210167e6f4e0a5c84ee1604fe056d9d3262035845f1e3e4fe4bc3be389e2d5c9dd0cd5fa84286fddfbb0a0788589447dff815709e67b16daf9e700af1a7f2d566482b47d5418cdab74b3fbb5e369d75f52ada1bf70eeee73331b4b86167524ea6777a9dec6b13d8a4918a850965d82fb9b078e50fd2a7fe79020eb5dcc3e15bcffd98246638723b1517e3bc027aea5b575e2bf4c3418c77136b915e09d800189833c7ab822c167c3da56e921bb7c73e87012f8fd34d8c04304597b3a03537ad85c191d8ef2321479ca96a34a8bd2c085db0eded858869d76f23ebcbab7638df4362e331ab58816ec985ebd7a7201896312205b8435ed35e0259c9ab23f593097411dcb201b2d002db773dd2092ccac9eb32c46b289a017eb99ba4b2340a414adf2fe9232403ad99e02f5c2c009789841b4ce8d0469ff2376bcd405034a02fc3124bc1cc6756eb5eea269829d573a5cf5603e92d0c32a66adf701b3ef1b25629ad4bf2d73e97cb0103f35baed65c18bcd822ffd60701e6b41d1dd997b572d31c03a45d1922b26cee785a9d9636bfa100b29e20cbb64b2c6188832239d280a89c75c3e356f6da2c26b09a740ce5b43c7e94103c13daff1dab37848ff4cccd3ecc3a3e25e6974f50021507e713a677443b0d9bb70e88684a6c9fce9028bec68dab977b6cc3135b479991e7e10e2de32af362317ace406402944040d6e4b38f4d7cea97e1a1f9e113162a500dbf1506341f71a3a36d62673b28613a84dae7cf2365c5341ba1a991e916e78811e14b38910fd02fb81de7fdb40712aa98c75c65ca30c5eca635657805786031b115fa5c194dcccdc7266a9fa8c1d901983fb6613d0c4643f80c372d0d4b49986b91230d4946fce1cd102c54f86d9e5414fa6c64a88142301db6429f769729eedb7443c6fd0c0577b3ece7d611e80926c5cd26dafe34cc1709306f83a74eb69abbc970aa5f5853ed0b50d1bc3f3ff5a02f90643dff926a9adb538154f524868e2184211a8d479e2460e8fd69bb73340327e33f3fe250f6c03a100f776c3b02f1143a98b2daa1b36ccd3ee028f0538fe5fa285abbb4d7453823073018c397d61e28bf6223aa5ba275ba07e507f7ffcb482f543f492026f619d9a98a2e989025bfef3f2e26cbf6de2dacc33ed60e6653c6a134a0fc4cbd5dcfc8b7e240b874e74bc295d8cc9291f71e9bee553d490d11ad50564de90c0334856494fe4d27abded475979f410b67ad8bc27929e8343e91f2355c9d23c414d00585406f72c0aa83567011e10ea0c8fe17165a5624c7cef8868cce69cd61ac8321158a5188351631ea962574c18ba1de972cf02be35a5d1d057fc67b8dbd031f99f546b2afc611ff79b932080b600c1aff90e8441e99d3251e70cb5750ea8d6b05ddd1355e8f8388620eb0b19f13928bee66db1c8a169b114d77cd00a73059ac92e39f485b6911f00b1525c0d6ebb705ab9c17990d46d0eccf981222414b654312e3001522c4cd0ba30a6306719af4414ddf2eda7d4c35be75669b4cb8bb8f5d30b37da9625627050ea81b2c271581328ad86dcb4cbf35f527d446bbeb67f000a02cb94d6b3cde10292911bf7ca0663aaac800cbb8a62d6e3306abee412beb735758453e99f724902febc171ff975380ffec8ff9191f9f638fecd1cdd6fdee81a82efb8df906cee040068e5ff1c446e45da205761cfd125c41e741e4e930cd41eef18bd8183841ce536149d6e0387a09627f3d0f93c4413d2c4ce4ce013999db29f8f377333304b25f504b62aff6b30eb2eed7f85eaa2ee9880a1bc600f15cabead994fbdc5245e06f386954e86ce56c5e7e71658a765e23412611430da2d13b8f06b98480aecf6fde9e16336ccaa7b26e46dbf755e42568e7e1c327d2a4b95115f21c7fd57e4bd24ffd0805ca5f42770ef29721e49f5321af0f6dcfc42dc80acaa95503788ea10c2e9980dfc2a1fd0e713282775be222194970f0a3c817c0ee53a71e56002914de025b9aad8b81ca74268c55744db3177fc0e9dfa82f4826a0528449c5b2353150453077423187b69bc6c4400c22e8f09536502d6153fdcc7ac30414abeec08abdcffc74a8f1e0bfe9f86ffc4fc9f70c754ca96e4a44d3d7a9026148e86bee9317d1ef8b8c63ac2f1baff1b66c26cbcb5c129886b82675a18c4da35d5bd286c27da2d5545b2ab39ddb1ce65ee70472c802281cac97b4ba5ebe2494cf6a5bdf7b2e5032478489af73fab4ba42f8ff5c6b7757cc68473dbbc85d6bd168ae7f1c5fff3185667d10c49b70211aa3c0eb9b4bd51f5e8d03c506535eb1c44fa479e1bcaa26aef0a7bb55b063a0f4b45b4559641d330f4bdfa7e1b8eb494b7799f7d6a69dbc47cb8f2598020d24dad959b5637ee40f15d463b316e4313296cdb3c7b4eb531e6ab30d48a408ba48c98db95b407f7bcb1356fb13ea98583baa5479bd37d0a5a718d370c1eb1bac4d9df230acac03c0f20ce8a86341bac6cfc1ca08bbaf436989b072c335edd776daa3a136222a2953c22e5b82f9209dcb853094ec590a78eaad53f8d2156c4b8d1184d264c0b331f3033d8aebc906c33799c1369c20cd29b8d79b17f024f1cb91792d17e0869d66c6e69dababa9e4b1e56cae78311cde9cc2dfa075515782476aa8c251e7aa579ff640f702882bd1cc0f78d52f53f5b82167935f64c332cffc706ca127c3b8bc1d85060444450ceb76883a51c7edcba1d79ba31f307148feff30735cb0ea73e18346464699828bb69875a82e07afb7968a74b55494531629c3673fdb8f8b9690d2d5a628b7958174406ac80c696ff3b51dc914ae0c2b0c8dbbb65a5393334283e9cdca5c7750e40e9de98abe704c1fa50bee23dcdbba1ae1f88b0b3dcadd0dfa46d7446f884e476602cf98792044577347ad4ad86bbadd45e4f98b80f1551d01571f9e258905c90be65228a99366a89ec1b3d35568f696cae92a6740e11561b57ee1f61fcf6b2e938a88357ed74ae9aef415299c00288c66f6f69626772608cbc6014dbfb1e7872d21fecd33cb77593620794acc4468be095be4d39eb201491d0178a09f98d3e869369b5f2c392e1459a8d5acccfc4d321a49dcfffd1f0f77c7ed3e8c14f74627907923c8af383768bd03926642ec01fb04f6ac477c961999c29b1aa63964aa081e267306badfd7f8735a43f320d5f010fdbc134c3eb35c62e202ef0f6d2170b33abdeba8ba211eae66407e58dc3768a5bb14406593c8500b994e938df827f6fd79d4972a037ae965f433c938292ad07ae9b3bf46dc00690cfa70d877550e6eff8467f28b7b38f808f614c9b60ee5f666b81170ff94407e6ec1fe03479180e12bda35518562b1d1cbc7cd9c691be830582cc2a1a35df94efc5db85a1412c1818a721923e86f51b79e93a5f8da3d1290ca392cb923d7c76e9cf44bfdf9eaa1051bf7e8e1102e8f9ffbd4b1d4ba938566fb353b5afb0401947de30df9235aea1ba5452f06330f869de8036a923db1b0f34d5487becab72be88fad4cb56e733a7e2b1af9c13d47d090643d6471d4e8c20eb026146e5dad858c1ce8288ab691a35e3c7cc1ca4a5098b7ceb619911ccfc44a4a042bc31328269511c2fb51b567743b97d9c0f9b4175a08ce595db372282c817e5dad2531af490c73a801fc006ced33a55145674f5991baab68b4c00b791ff8ce437910127ae985ba2f3bccbac454f8fdd5c44295d46deb9ec1a2410b3b0d6817d16378e4d5d8af4ba30361c267c1e666e5e1477d7635f6a3a9cb4cacc677a5f1e64e70a5256e4ef22d3ad83e441e3d5a98c7435a8f15dcca85538d75215ed1a7e310d9a6d9d1652dab9b8fc381762678029066f96d2858565e6317ab783e11b93a546d774fd1986acd4ab3a5b67b7c466113eb0b73291324604ac1544ec0bc1cc154fbea8d3b36b82ee7239bc2bd40ab5220627a359fb935e210da1bf10bfaf3f2cc3be87b624d2e33e589f43d928d866a5c7e2d3040097ab696007599b485b3dd498f683e8d9d95956229b0cfe263c36c6d32f689e4e5d06a2600e3f85a6dfcd28b0ea47f2f9c5a50a58a7a6f8df52b01454d0bf217ca0a1032be385fdb34ced9082b8fc321b654e014e9543b9a872cbdcce5778460bc7203d8fded9f18904d20fc70810f4ab76cde5e3380311b530a8b93336d2126ce2b5d6eca71ddaf27fe2d1a317462dc19f6721e022dc9e3d0f0c8f90057f3575e41c8a4444ecfccf6c41d68137f8a555e8402dadd84250e32f6f973962af3300fb7ca06ae24d34c78be1eea4d09bb1568d34abc86d9ebc6a232251e8d4513dc91683ed499ad04edcec79e2efb1f343fb486e73eb04f0c22078a12d7fbbf9a6364864a925d97e4bc1eedad64f6215ee0a880ee01ea07a0d2b4e213e9e846adb36ca5eefe12ee6d8fb5074124784eb079f220fcf56a3666a30f3ad4efaad1b7dfc21605136dfe7402e4b06bc08478c5d569b414aaadd8d454760a83de60eb33f8b54e73052b3ed8cdf12f1b2bf0df41725920d4d8b00c5b3b5540b122f8c4caea1b5bba3fc9736f641ef3f93e8d328de4da915559e4d6396ffcbbe7af125f1bca4509587ab0d17ebca4b607abae50e764d24925966934ccdde9e6a7a29541c9810ec04d111d4427ab1e0d9fef36c0c6facf78e7cc1e3f30e453a079eedf90b38a5c414ea46b9fecdf1b99d449adc6f436aae437a4a63b4476a13053e81f56e7d249dcaa97c9997618e2518e79bf8f3992513673b12a76410f95b9b9c2801a27a0b76f53590d25da43331faa9545eb9e302654d4aae218de4eb6f80ddb5e7c2b46f90b9170c550cc9639eddae3200cc8c8abfe9607d25db31b8562bd3c2dc3f437746a817f5cd505179c8dfabe84135e5f4d33b66e5e2a4820fe89ec92676218d67dcb8b1a29dc608e57f55aea2d2bbd9309421c85a6fc39f3fb10403c50ed83c72112dd3bbcb0e01fdd08bd3aa289486f6464d4604a83f2622d69bca08d0c07e70f6f3dfac41a954f2b302bed34471ea49d8e8e92837cb33b640e1fc10da52a60b0180312dcebd57d912c1c77b1794f5f43130951ac3a3f4d3ea535538f91f5e5fe2298bb54a49ff085aa110bd5fec7cb8b3636e3d7d5f0d04218a13bf37a66d49039f0d1b7a2942adfa30eb6f50991f833c049d8782f315b8bd70fd1764b25ce8689e1740f15f45f04c9894dc73a7071148cb095880b31d1088109ee6da631e807b4b6ca8c0bec442974d8ceb3fde07e0e2c5182446636f43e7c889db95c961bc0117721772811c2d61c3f6dd870181611b90a12b9ef5ead257365c0eb85ae4af5ce22d24e3e55620301ffc943c2b31c6857c2fe388f1ea7936a35436f51f3c591fd0752ef40d5961730ac42ed62d963c08081f1660fc00e07cc92d81f829eb9d03167b19390c9523a524a5b543576607e8a2274a0e591694d209378ca4d283234867c953f972eb8a7c62299d1bd72ccbed2a7fcd2202b5793b8feeb81eef5131b054b06237c9d4b101d6d3bde5ab0991e1113eb94763304ee22b29cec5d1ea9f870b76ecfa68546c1bac38f38b33dc49ee12dad3da50ee286a0e8e7fbdccefb498d5400d14df3c973fbc9123079987a113f1b09a0a301f05662282c18c9a352ed29063cf40dc3b3231c0498502fe42ed965e3d94711c4e5015274142e055c10dadad1d54530934312568df77b7ccce457928f640b4456f664c853945f8ed8452e11c03aec93af7af40b352da46403c798e31c9f4f3710e8552ec6b85bd91cf099f3475e414281fdb339d21c8ca6a1c2c2f28f7ef5cee8178c6315017b88951f8e3401aa4e0152c4ae7b89b9d637de4e3b1d2ef70e8365a1fec3ffeeab565910e66dd52818d7629db42d4dda7595f44cea526092d17a98a0e6ad962e8a7a8077ea4bb95750aecf2a69f907771e2e3419782b2b48d62366c24d7f7e077423cab1195c3964b8060a59ffa3b4127938eb40d409d279e8d6af38193a3ab195bdef0e98f7656bc7864ae5c91b861b801f14be7c91e484f55400d3a5408eb6d57721ec5557c90abc0a86e9b3c491cd28a0f00900b4a729558055911ae11c505062404183843e7e8bae8f938bf3e15638f975daee9216d351cfed0974ed01a6ea19fc04bd203ead8239e30d5ce709c65112f5af02e07d6c6b3c784f369f17767adefa3b5b207248e0d69acaefa92e3558d4ba4bca3022f4e9f372385bb8194cc1b133770adb9d904612487996a0cb54b6def8501ade8f6f5f704934d3fc12a78ade6c8828c03cf8c2dd0a5031995cc09297859ea72fd271525133611811ba1649ca01a665457d1835c55537327bd662fe8e2374669f69c345bc04f805b889e6015f3685f104f2ca8c03ef67a2a704f041ce8f84085b0bea5ad5a8e96338cb797b83fbbe2b5dbfc5aa8f78f7d20c407f12b2d6f5c1b7749c6183ececf20f23868d037f442c25bd1d0c661604f482583d9e01f944fcb8bbfb07ae207464ff85eebe6bf667346ecc5a355505b1ff113e90d5c6e12ed8675cb0d852c989ff41193bbcff858c30c62601b243f27aecf0fd4494bf389614916559ca7e3a50eef5e396f5afd519743bbae72726cbcf803e615775fe52551b710e6f343b749fc2994b7fb751e50c6db1927260686d9ea8a1cfa280dbccb901d358d2a295fb9539cd6a0993129101e5e21bc2dbebf9fe43e63c77997e6696bacf68e4d81ae5b5e9e4d83142d52c38824917a9d43ec135ef32a35ac9fdde32b5b9ccc41bb1f0d2763e42e978c801110d23d1eb74d5f16f33cdb0ed28ac33551770f6db9f1202e0b60120057a9f90bc91c0c78ccc756599aba773621f27e500bd941cd5a6c7d99abc89c9a6d1af537ea38e8bf3d1019f5a2bc5f35a4d37773c9186b65c5e42872a8889813a5367d10d41dc4ab2e42f9c695e7422bcc655d10b63bad3b75cebf3115861bf75c45a7c9c3eb20a51d42145c422471aa9e14e557c6002914d0ad76484dbae785f992ddf9f07d7da5097c044a230784b68c2a0d3f4ab6a7ad60b34a008f0274eea2a1f59e76e5bcdfdd40e31e0bebc7d4b3f2c5fc4267e9ea845aba32d6464cf2c47b97f9af42276a9dd3527ac4a13373787442c8b1e4e7318e21245e2bb52087aef1924b76c8302936beb82346e85dcb93f94942e5794edf2e3e4886961996bce282faca2bbed10a3faa51a84474b0747c38ceb871da6a6314b223e8ff31eb84dea088ddbb85c46124173b2731c7b4fd207a97bba756d2b86f46ec0a1e8431e4092614e21a46c612b14e9baf5da4d47c793ceac7577058311aec6cc84951d7d9971c64ef19ba79ffb46daeebd0f0a7b7e46b1876d12e9da1522907cff50d6e83c8f1d1cd6a6130a35bfac5fcd8d4b20ae49431cf6494703c6353d014cfa6686051a4c845b1c6e64f52b70865963a5f700e3fe9ba012f0dd967b1579c6861cb70ded51ac3c26092fcd6a5ded8b77ec1ab14ba3a14adf3fdc627b9fdd206125a352b16b44067d4faab293e735150f0558292594b2c0fb4fe79ef9732f3ca04e6357e2aafa4261c64818a84e2366f60b3c0b1d3179cdc2d89efd028be3a59bebb11345c7838c25d151433522503498368a6bce226a459f995d0f9e7059b6a5c7e376943ccd79e5520205a4e95f478e4dc9859469e82912de8aa7dfa64eaf0955a8853100726df2d5ef32c3a2686f63c87fa78bfcd436eeee3d5c01fae7d322fe4a6400b3504949ff4c0b5f5b747762c20cb0c4452ce2454070020dadad58ee0090e24dfd77d4e2739577b37b44bb5fd56767b7989ab020afe197a5f35a22fd854b0b76938194f98166b9787bc6a3416bba98fcdb8de763eb5efefcc877b54168dfd303c396b5796965c244ab420bf1fd09bea05580d17e449a32f17aab8fd83c0997e4a7738b8b7a6c3d196454a4449832efb3f716e14038994e679ca0519a36750a003ad50b2fd29584067e6803bca5b124322dab142782a2ad27876f8028bfb5fd0676498a0b2cd109757329dbbad79c2a006a8601194f63e500502e4e15f18be75ad7c690a1d5019beabffadabf54c81a90ae3ec79e6c6b3a61b3fd7629c90ef6e81a8e9207ef9bfa4d49651c20ce5c3ce3d72ce3200fa1e6464ea853563550fa6a16a5eee853d0f8adcae1accfceae97aa536b95c8b8cde76b9389cb105ff0066b062d82abc47f3f6eadb6b1ae69c6f6bebc3e13f471cf91f2f5a6241cce86e9caec4b001e549037b2bc0ad1f3d5bf3f678ac7368fb07dcf5a06675c7f66e8dd45abd94491b0bc6209b70901fd91d6b350d6aa8416ac33e95048bd628ecc98481cb8c9087dbb5e4f61146c90674e8323c3e508d6ab0228bf6ba1c2124a7096c8d838c3c4d59fb425049b5ce6d36a913464494252cedf1a4f8e1834bfe88905f5f21ab0559e0759a8aed58666dfdff2b09ed879c005cd523939b721eb8abd452af792baadfec4bb206a0804b5b87043e4cf335cb175329a299bae0fafcbf10b4cc07147bc749658bda6b9400d729514402fb0b15dc1f9094c51a7b7f779c32998d08d71cd9b7bf545d4c42dc11a13ef4f3d7f198a80409c4ba2a2e2c3e08044ffe41bbc63bcd6bc4a777c35c42751b1e247f9e3d263f99c77b7a3b961ac567d23ab04d7dda2a3cb0352517a2e587126df94efeb4414e12ee26a2e9884c1ebbdd8fa83132249d145fa0209e8b6be3d81bbd14b0c290ee334e7bc51d4f1b244c3de7686dd4be2ddd3a1ee4f4ed78e2b6d2c955f0fcdf25d79d749c2d5cb9d18070f00386262f72e443e45bb4d9b175754b6c686f132e8a462bdf534023ebed3cb02881f3e3a87d16d7b0992bedba66d0888b9045161d0fd6bd792bd7391da079be90c965c434d60ca41d6c945566f6b750e25386602780f24edd72be1cfb843245deebd6af24e572fa34f9ff5213dfdc6d929603ecbc8c551c34ef69697cc7c558ea47149d3a0ea5416f8e6ccbaffc26075ef5dffeea2e85e9fc6fd4bc9485b022c7ee7e4c65f2ce02180c37afb78f03023b0f24fcaa4ad1e014bc2a80bc64cafef0920099ed21972a125769071fb7c2c352ee0f5cbf8119e1ecf8d5871bd24d6a53b1ce541300cae5eceba9da15532d9caa5eb033a3ec612b44e2d725bf08740c7f553b50b02ef8d581f82c0c69d10cfa0bc1e0f64e385e253f5f4c3f18e85646cabd652b6b643634cdbcd358fcec137f99f312f1257d063303a76cabdfbd86239ab2b46ca5ca3f38d361c414e2f518dc61f8dc3aa92854977198545c561c2b2b7abc2198c945d71e060b4a5c20fc7e1586d250902e390ee725cf9560715d534681d44221c2f393b3047c46fa2d2aacda39a688c4de3e30f7a7669486d70908cee95e1e5af0364f689762c751727459e8fb40782fcbeaab46c46c3f09795a95e47996e8dfbbdd6a9c4dd26140da48e925fc36d72f53d5b4a9071d92f28bbfddf5da7ceed1a41db21e8bad3188bd2a0bdf4f81bf94b52740a3c6d2352b7fdb9e1b3731153d198eda1990b1e0a1788b2bf9ffeefbe6097111cba54da6d5b243a03581d17846a5aae8824689048a19ff0d410b5ce495781464ffc270eabe192c669c1f2253bf88155dd02f0bcec8f36a9ec200a9a2047e2d03345d7d4523bd610f1dfefd2c370e2e81a18ae9d0ec5fec306bd8f7396f24a804533aa732eabd9cd8ddfb132000b5086c6921b52fbe64a1cd9e3d6e439503c3860b616f996e2137afe9430db2be2e2f887628fb7c22d4e777e46588d649f1c75372428e8af375d63273f5aa61efec288f51bc44de9f5d0e2cb90206dd07e70388fbb4f73a8057169d2064141067734a3e868adf2b1cb96f5614589ec914123e8700712793ab4b79eafebfc2a2fa80802d8bfa4575c52ccebc08d134c3c78994c7a32335ca01469f91d43939767fcc9d562f30a721c0236e3eda993f8c3b55b31685caf2026f955ce776ec2950105219869b00c92c87aa5f1d70ccb0bf243f13a7ee1e209bd7a7cb7bfc27537c8c6f8125aefdd876ba54ecdae41031c213b7a7ad14e4327ea0ed8229d687e2289eda024c49c2a1c1e75f894e6d853420cf943609c91590fd646593a127fc61968e840600ff85e8ff1a9c00d76380dcd7b0c478a3e492e15b2fd40a6351170b7f5c2746427e135cfc744ce7a54b4d605e9af03e05d2429d6b612bea02de39b08ab0f99c599c1703a53c8b5b7ab6b46c663454eb0057ac8c896fed5e51c81e2fec77bb6592e15a5574f6194a6e3da04b935743caf8e204a981c487abba9bf3f60de17f4f95a6ac03cd4719e515842bbd4e63ed63616a96691eeb5f1daed50a0a7063111d327a987ba0af2384165c20e903e48930fbe9fbfddc176ed3d53691880bc5293b20cbf52695e08a2b90b4c3b6f91d4afcdcc724e633d950f40f12a2fa71269769a93fc84a7408bbd97571472776b2fdea8b2f097bed6bf9edf6d70cd2611a278a5ca3e10d269ed3cfbf93e835f26724dd49a7be57e67af04e78455f69d8d737d6272b39127fcf8c18d32142dee108a19508db66a6891bc2004aa76fbb14786bdd637e1e4a8f896b2b80b12442178c4eafe608439fa27cd711206eba5d2efa1344ae0772a1af6abc5489b1700dfa98aa8d3576b6bb59d650f8e4b08df071da24431c20a6f88e590f32b3b3f32b7f091796c7d09526c1e91089fb422a3792d91ee1b577e7e6754e47ec7096b2d567504a4150256992c36315a41dca4a10515b45da213646233760d105fedb4a839fe27df22da7bdcc1cb7b177e4ef28c599a09fd78dd12f781de3806bff9ccc20dee893cef8aabeff18671ce519ec824a8d9a69e28da783a4081826cfe1174be53a420a4c72099d696eca0edc53dabaacdd4a13bad5b26e8c6d4531a5895ce8302d0faba07d774682ecf17f72765dcbe10b82432c12dd5084eb6f5b55d84f6d2ecad5932ac0af55a8009b4f1d33856c974c94a84050e39029e2271788452ffa2d93ee7dfbbcce6f46098b630f702caf5f9c6ccc90a6d602c3db7d7bf377aaa2a02288efaaf790bb330a216e0090488cd9b80ad201e426f0644c953d68ca27456964a240ba6884300677ff646b980c3107616f5be63454ff50596ff6fc884dd4b51e8d572d5afb37dbe9bfd0658595ef656c1807e406c4982591754eb161d2fff5d6d7f894fbd02f4bc13d3625eaea924003d8af650926d5bec093f94145c2d100a8e3354f6b1684b7eca560d83dd35c32efacad8450bbc00b7760b2b32d731ecc1aea685d243455f4217beca10aab775882aa61379b7c8d72696da217c002d3a9aac195fc63218b7da7861a340e9d31053d0cd0a18607ae08e81c2c69bde23c745fa50e92156d2bd2cfc73d5641d64889af9c97ee7e7d345c35a84b879238e11a1bc0c813b7a2eb77018fac014fca40e4e07721fc45ba8dc0fab202a67d8de77289d6d2c42d784d502e0b82dd9cff9f744ac3413ce1828c76ff6e7c8a1bebdb34331ba6637f29ac3eadee0642f824fc1aa42d92d3f890b5c5c6b1d8bdea2d98ef48cd3f5737296b23d325582aee22d95dedaf4d796189a10bf05da923797232084a945b9bb1a28088ff8f6a78fa6772ddfaa1121a78768cf000dfb9f7e51807973cd90b8465bce6d65de8e74da437c77e48f0a5aabaf95d3e6e58228f17d1346b13ce11811724ee4231553bf46042dcf77a03dc7928fbca9b84974458240d29aa8f9f13f446218720eb59cdbc0b85bb292746331aa83343683c49af4ab965a8eea608fa4251c4628ff8f5bf0d93dcdb580135407d8dd66f9e03aeb732921d9ee65a4f0e882f85d0094aeca887c35aaae54a5860baeca0c95168b1f07015b2f7b26cc7c4072df9d14e0a40a43d7f486aad06e61a4aa0c5db7bfb60e2fe3f58dd8590bf7e089ff5af9d68764c46bc7a6046f4e13196178d5172a3630bf48e5ac77eb1f0f84b0108b5e324e2888f2a40f638b63f9a91b57cba13f416089124a7f193b50b4c9852a13d1e021ffacea16dba200217e1f15713384052da18392ad8b70fefbd6fd6b101359858cd1e2267412dc868bee3dd6a2af3e6e91282b4dc8c36275a785cd7f3ba1efedac0b1285e6ed27de0fb16bacc5084526c70263d26d610d675debae40280e62b05d2cfa797a0164453aa91ce583362be8781dc9f97663a29f1e6fdd5fb40ec51794cb7253e96911d0fd9fb896981fa7fa8f16ccd45c6483275d9afe40623db693a086a85cdf3d2ef1135c40d8966a79043d74465dc97fd3d67f1c34ef6377aa03e5663b08113c9b4b8ce34bff6839fc56fa9ff4e4d59476da183cf969cc8ead40f144b897eaa630ae2dc2f5579a65e6d93925e30c5d7365fd5f3c519fd88008a6181c337ee74dde8fa95b6df0b6ddb48e68692a317a8bdb3e0025e0ae22a9c6ad4bbcd6ac00828e217f2ebd6aad4ed197f9873130f2e10d834e2bbd67d13c5cc264d3a84c298685465358e5cddf8e8f0c820ab3b3093e209c0eb1767719a65389ff6e6c3175fa5d1bc2bd89d038377f5bad235fad1b883646ba7d149fcdd2f815ca06f28724cc093d8a01dab5acad154a65c1800d3a01b94fc4b2d805ffae8ef894d05e4a8f52acf6287b70e0c81c744e8c7dc2673c49811ae804a7b5d71cf380fdea1f2033031c532da3ba01db06bc4a967d2d064405c56cdac7d895b5dd39e2c84fb5dc5f391a44b1d61c54856711546ad106a79d1509b444e7e31a8747c2aca2b0727059157939c96a77861e31d2e31f20dad3deb754a2c6bb1be334274f8ef4543596911a52e091c6e266a802d6c4d59335280a9cf5b30fdd0d96bbd5d4a2e7a9cfffe8b806b116554dedf156718c2244304392fdf600ef74534a7666afc0712d953855505eb8022ad58583437533712530c524eccede8157b027f9e27053f883bea63714d4704ba7183a44b4cba10ecd42f825977caf6c6aeed77d2bab82e4b9483ae0d9dcf1636607ccc1496a707acde8133b571343c5d82f03ae52dfcbcdcd03e5b209981ea492e644641b427df8517bbe08b7b0563aebbe35e418854586f9cb3f6d5e77fe07cc4ac38e6a207cea370ea7328058f0206b6a0a2efe8f8a837d73d76e2571c3a736c559d80f9e1331d0bb811657865cb8b4743c1f627a9df060d0dda9e532625dfb99564c691f6e9cc5f9baa0a1933a5df31c9efff0dff8f97e61f11da4d8902c711d67bd49f3a8dd7e7e54ca69c3e9fe2524acbc2396136aea4888addda051635f066191981fb232d9c8f6dd5822b2e9631e6bd52c638dc9bfb2fb7860e21d91c0b9cee27b96218e0bf36048eacfd22ba046747b595c92ab0695273692b4088ccce19e0e4f33063d0425d147a2582d43ed3a681244f723990961612ac3b576489fcf60c5a17203b617a095cb523b8bd747f962ea7171ba56c460ae13c7853e95bfa1b0abdac475e79cccc3dd7e1491eecd6635289a15631694ba6c0fddc5077eb1fecad33eb3baf5cb7673ca7521289d9a36f5a57572207f389ca38e3344867cf29523dbd550b76146c6d5e6a0fea92b0e12e623b44496b844d9afc9878d032f0b1f7ba5071d46f477451365fce7bbcdfc9ebe1a623c5f3bf3b0b7b88e9c242f60f67e7ec704276b3e17769bd5d431e9fa2b7dffe9eca72b14ccd8ef04e8f64e41a5a9dda880e01567660f76c7af021564b66f4f3d8fe0c49ba0158d151eb34848fce6a4354dbd2817d3f2cfe584c8c5775fd0ff8d39a5063b26ce6772e0cd9f2fc2851dd0ce76360042d129acb7eee4b8bafbb66d23ead07083478fc3776494837c7ed5d5cc90a26b8c1821a151b3a388b6d80a0b6f0d83a459c2ab1f0e2a0bf86a83f196be9b5212b0d11387ad8aa1f429bc3d5d8a94f4e7818c60a7ef672056fa2d9318dccc7383622b1bf1e7aa218bf8d831fdcdcc7fcbbad4343c2506b331dc6db972b4f4e00fa9ca9350ecd6c8c2638587ac11409a3918ffa0808ab6c77ba4bc2a1ba53062e115f69ed315e990b811612a30cdcbdf0561316d01f1cb990d12ae1fe3702d4198a04a86c25a64b6ab70b915158360b7c03a9f27bb4f43aa7d923b17cfc3fd42822d9d5b1101c9b134736a64881bb9a60d53bf9980bdfa583e5d084ee1b24b3c9efa3f131bf541f48516972e3cd5a76146792ce7851641c2bb93085005a312bc31fb329f3a60160f3387d4245e2e41d88d7c15b83a25ce77458bf8b180ae5544833c659db4665009272fbdf43ba3bd318bcf9b22f9cb3f96b0d95a45071ede2c0cb19cec8954800bfd11ad784bec3e78c6742b81ee1262547aa81dac2cae8601b88586137e1cb519019d45df1b5c20129ab31bf2c3752efba663889dc618f9e41a15b83579e4988ca047bae7a92161d9f2a6e242ce8681a72000bbde5ccb02392e25f96f3b46652a3f6ccdcaac87de43f3a5c0bdddc36be220152765d2e7d85dc1574a83b7c7f99284d8c212d829148a005b3b0e8c6a5d10fefd0118f5a422f54f578cde67600e5d764bec38119826be55a57b2177d68e19ff1a0206c4de3ef747986211354550b67ec6caca4f8702fa3737d4522f66d61309a46901c48814b59bfcb8820a789f9b5348860e42dfbca59dd6613b08ad09d7dda7c732033120349d739447f9e9d22467d6e0194189b6cd37f27b6f651f7191306dadc4701a145563db6a09f550a2ee7868e925cad758a7a23aa1304330d033710f36b826c96c3b9d2f3d5eb3f5b248e29afe88a9c7a304b360a016f27d92c5658da764ad2f7e1e1836e42ac5e41a147b20ab84b40675bd11fb58b0714d721cc6e9c148e9ef8b7ea553a0c3866df3ddcfd761db7c0ccceb9eca895e1e49fd5d4dd7bdf2de370625843ef5bb3dfd05f6e095ece886ee5e6cb4d712abda8c1845e345e5df7df5bb22cd07c3742760e978fcf665f346ab1b5f278a194c7d35324b3ea27c1c45460420149914b047f421903c9c0b355cc832c9bf23f04df4d6dd96b04f4c24877fc5a2d06979ee89469c791703eca91f086bffaaa1a4915df50613319e180c94e6c27f199bfd596c5d6fc972d20b51b695173eb4423fceced596561b1ab03797cbd2c9092c1560ba0ece6ad5c6e9058e0e678576a985aa80109f1dfea6d624a17d215dce58425c95438b315baabfd30104d89154bb6f4fd6a2dc7682bd7b34d84f5670d3117b8eaa704150028029d9754676359bcef7982d58fc5ddcabafbdf0c9c29e4cf850e65ab244a2d9b8e406eca7583e79f984f156c5574aa4e333068f3fbae8fbb1c32f16e9c5c0b6bb0009c6ae3b86eaf97cde3697b1b16ea2841415a70bb0f3e738634a5bd5f166f795846a5339c183a3e3f427155f53d7d27f5dd5a2ab23fbe643c670603cc1666a3ca7acc019c61eb843ddcb7a697e629091a3da6cd25dd8541eb399668ce0f73264e377b2a50e9d35ff94852a2fbe00f890f39c650784f62ee7fac21053b6510ff37aca5d8da3ebdf40ac99bcb8bea94129d652f1aac6e2151fae7cdfe6e8a1816e3d8e63e0ec1ca3213376aa002bd3ebd0b1375ef9136c4bf86c6be426a4e1c3b00b6e42118d4c3b891c559e4aa0b5a044653031b27b9384f1820350b4e7a9b6f5463286e096b921f37997584775f53331f1598d137256c086e1fdb70653591f39b512fd958b1078229a0ae674dbaf1e77a898f16f8277d5ad3461373a2d89cd5f27a2d26be0646db90e7f5a3b4b29f400bf4a424a19b0842873a52de96034a5b0c21b2ebaa832e3bd57fe1772fd5ea8d32fffb3c24ce9e5cb09e2c25b9dd66655feda3c145f6e2900c7632793dac4f7e75cf963f690e06dceb279c0e7b08937ebabb97237528b1d9b422934b0b08f9d1e0983d3d8183a0a423e42959c5bad26bf327bbb400b5e62612000d36dc5d09052753d737c80f418298cc0a1b5f6d28452d115c7e076e4f3bf6db139b5c12359ad5c22f4ad03b3a735c3847330b7d8f58ddfbcc934840a83f4dde6a9ba14e8c435fcc4081b359d48ce2c175e398f9937d0e898ce0db3ef94d9cf5c40970c9d7b0b96c42bfb7283f4d158d7bbed6937175aee1e8b4de713e61aa25a60fbca2c1c10aabf3b43d9bf223935abea5516658cae859d91aa7d85585ba34d17c18a2efbd986c5d9655ec6696d5c2c56387523ad6d9e876f54418681d4e286d57b90ee84c8a577d6d4f5b48dd7e8fc283be8617955190ef90661ce9f2cf1b993a9604951677acb8bbbb48e5175f5c612364b4fd8eb302fc8c51b52598a4980bbe7b8265721a9b35cbfc28e55e22d72a5fbe9d52660ad5ef92f1975c08eaaa4e2a1f7cf98b212b5a4543c30f69a051b380f1ef7af4274411a622078a3344d6a73252b93545eb689cfdeae589fc569365a358b2a6acca5fcf5bb0b780f2a065b89f66cd58ddd121ea0c721f142582bda6fd32bf9184f35bc3f540ced9c58da12e97056dcfa7e7d93d7f563dfe3dbad1c6d1c43b205a622852e679a7d69887d36e5013a33ef090ed0fa75a18e23f80f00626d6187439f226fbbbcff1713f1a22c277bdc1e24e99cac25ab7d27bb429e6cc94d84e0011afcdc5fd6ed3c1679e583b5f17b435ed5d0b3cdc7f8149b09a0a99df0c4242f6589ccfb7aaa27d96b9f97e3b8a66201befee8b5c7ca3d3f68e12f901768d9938a7fb1cfe2b8e1f86221e18b4878390b3f6b4ecd11704f0a871e6a50f6131bd66f3106e7e89714d7661bd804ba5af890ef3054590600a9d54e8bf3f49e3ef7b9a0e23ef74244b7235a87356e67b5588875f49cc54e016106218ec0b7a74e0213e41ef8c38f726d00af8b86143f921449a10772966fdc562d69b96915e92e55abf3a49fa74994b32dc05278fe5d1c32fd625a3ecfe65daa7e573b4ba9c89e2b07214e1865e43b0ba4cfc1cbd1ed4c92ab982f1e8b1be94b8ff2fb12f863d59f858c54f5fccb99ce2ff6a5af9ed48dabf8883a2eed6c5f109fa9776ed8d48d266d242910b8512267e4c66ed7313f79fe718b6efbe4eae65b96a5307aec26fcca648670a4781fc6882911c9bd4e52095e62ffae78452a0816e2c963e75ad6b0cf25e3b1b18951f340c0b7596a9c51874ff74041eafb9bf64252d2b41c34903b6dcb27ed7cf26c9eb1995260c6cadb4653e966cc8fcb260accf0b95d28df69636ebaf86e0b8fd3519aa4bbd49bec754afedbdba49baa6bc27d65dec2007f2c798b3c809620706cd0bc878af77e3cbfedc57735cd4045d6c609818c5ef175e70dd79971b34dda25c906600ca5e6089c4b0b07d2e73a85097d56340836dffd8d2d99d8f9865f12f44592e1a36fff80b73d8f459790d04cb16789c53c189e770045b48b40a1bcd99faef853af2762db39764945ef9c48f11a18ebeb2718b279d2c68aecc056a266e75ea33f15699f288f80b5ae635710efb89a23852d810c806018d2f794a1cb0b4500f78af8ed6111b0588dd4c68bf72390e616d4884821725258787cf03b1b60721ae12369aa4efa5269d003049cc874ae98fde03b1bdfa3e26a7b6d6842909806588625b3c86b376f6d1fb6ae8e9c312fc548da048e6f3dee7c0436d35eb3f0a385ff97540126525d702434d4aaccef01242517f2496da95a54c3b41d082d1f0c90be37bf5b14474ffb5d23b7ddfe13be4bdefbca69fd7d8516b3072b549d513e5070c4cd424ae4618cf1595dc8f1055693024e05322b6efd7330d925196b9471463c7448f9c9efdc343295ab85d70a8f795c375094254dafee3f9e12bf762f4ae1bd82bd4b1133c88e367e26f2600b35d8d2f0b76386ac2c552f1a121f210cd47e3770fc2172d530006d2736d98222764581e648b1a2deb61dbbaf0f6384dc5d1d3270b30ee4d1ba618af5f28668b95e78bf9077ef8d82fdfff8ef69402a499ee67cebe8c742c5f8cfcb4f28f43010b02271e8a6205f297caf0e7b5b0fd93c3b1e7f55dd89c7369095e302189fbfdb5f7ea377494c5344bc7a6a5c2e4ceca34f706704bd2f7a778e7a1d63a86dc8da30fcbb52f1c5e286749f3d970769467ec9931d67309822efa1674c9740f3add42bf6cd1eb84829626cccc74b09473a16dc79cc1682ea1276b7cb6e9997fee389c148d0da2d16e3a1fad5e8a5460282f46cf950cd26264e2dd1097d0879cdcbf5bb0b43a3bc42f97bc851a54718ea387e25ca5cac4413a504e32ff7b98ac3db1eadb9eccb220992b5c966d6e98e512692fb606cf66e6194d70069ffa68c95e4fe07861aa60c4928eed1beef07a436551d33f4fe5907c8e9c0a475e958334eb36bdbc7113589349092d5fa1eaf39e1a7704421115dae6abf5c7be59bfb109056a45bc88d674b7cebfbe5571614e9190c6fbd2a08ec18627bb6e8c164734cab28669a336348bfb6621ef973dc1d3a0a895d51d5222d5ca14031f29867521616918799f6045d7a21fb7fe9258ea436c16cbdf2a9dc3e2e8d47ae6943271204f669bfc732c2dbf0ec20b28d6b9b212ae1630f6dfb02919471057a5bbe616c7c2646ac59a14a2fb8819c971dc3069f8f97a8f6958a3a978621854a342590f69d7153144399b33b23d831a51f534c2af2f1546a3ef9637be4f732db0a2ff841121bca2b77b522d906e08f265ce550e5cc422914d2887275e4d73fe849b1c60b0f66765b495febdffc41b28acf39cbfe2c2df041f1c18365a2a1ff1f317cdece04348d4af8ace91dd2e7645ffc4917409a0474055c3d0f7ccd2c6c5b5670696de484c8cc56ae688e5c4cdbda0ea2f51237c90938a5e2533a924b8a676a112199bfe8929d0d90f84c6b5dacd690fda75041c0ecc8c50142e33139b4de4d39d7e2e78ca95131f6b1fcf56c7150a6b2c3a997b27564e6f90852668fa8eef1ad550352739064e8fe46199cfa91f803a1a94c79ff4a8b7534e2d034acc752e2beb5b0b37c323f7c6cda7076c9a19228adf5a6af69aaef297261442b867d9beb94e93a66f37b14ed31b1fd6dc16547d98c2bebc178a3184e9fbf4ede63204239aaee0ad075d0313bfb4d1e2b74dbc0fcfb5a3670a7347b818136789ca9f7f42b782e0a5e48596df200774f6adbf850d4fb0a35707f9405d3b950d83def76e62e0fc29b7e315a9b32f642bcb19f1f0ae732c79847fe6d9448dfb760883a9fae16c91a83d0149479f50c4adc21ecbbad7371e2486f8ed33de62be2c47807a070f57ad751e6c691e1141dae212bbdffa1d518263df045437770f268f6759f101734d61c74beff0283eab653f56c0a91d20140a7eeda091c87ba7c4c2e7d4efe808255fa068a1401acc1a60be02540ba9473db755602fd39d60cce1b4e132ec86e009b171abc95dc5992ac4eaf5caf255f5d5dd4207371fe765de80503693b712f44580cb98ab8259ed222077d1d04142d9e6df268a486b6f948daa7540a51692f246aebfee8875a6d0236e33a48406dc9bcd8c42cb27ef929b8c6790b2a8ac204ab0800b01a5f2f42a6e6805f8a1ba0bdd08583d6bdb4fdf015e5b9ec6460fa5715e8b7b45e30e278751b1c6432135889ba17c172fd6a1f49726b5adc9e40e929ca75f773aadf4e36b29ce17d133802c52d6666940dfc09e2103d1e3f407f824790405aa837c0effd0b0c5dac13e847dca3af1a304c5877bc4fc472f411d8ddcfb88ebfa30f804e9a6ada041d20c1780cda2a6712d8e1634756ba8db694863960a255dfdc01545fa9e348ccc126ba2c0d78c8a87549945952ef1d7258cd90f1523fb2a379502bf3a18293ef9b367812b5d0bb7d2beb5ba912e5a55a8b02df19c1050a31d304233ba16ee3a521823bb83d4d6619f7c846cc984a42fccfcaaa96a65f0e1c3917abc17e18e826eb36c77022dc8737b597e910f078fbfaf226722987b2e19cdf99ef7dc3b743ba2e64d5a3cec7e7fba0525e14aabafbd6dff8c527b1c5612f83d776f94aad8ef8190aff4ed9c7998039239b754af6ccaf8fc915687393cebb089fea12c7c478ede2caaa4e7dfa515e95825286fcc2a611c65fc19df53e7b6bcde1076f0e0332840cc1c7a13d6f47cf7e3abcb5fcdb5c764de3ce449577a1993bf5d55ada2a7798164a6ad31adbbf58b22596a23067f7579769b67d155c98825176b5b166fb78325644a978375819540f8fb50a1fb7500617ef9eb3ee4d2a0178ed135c0c71f455adf8f83cf0a3eefdaa11e94c0a116598241646ec429b43f847af40a4e5ef6829e74646b121a917936a5633bf5719a5af7b791930a9c71fc1502e489fde465a63e3340ffb1a9cc40ab3e9924d655fb0f6b99b7b6d1f65b0359c950ee22e7cc7024bb39fc827cfb1c5a7dff8e25a0bc3e5e6044bb88a8774876351e682a9f150c3891f30756be6f8e4ee4a80e6577942c5ab73e4d265d911fb506b6fddc4198a0706763b626987c6f6384080feacbc362449b4067e771e1fad989c73d4631db1e62783a79df2f5321e048b463cdbfd204254328116e18ca0f3d4e61a23a094d651195f388dbfc75a969a91fd317beb7928a2f38c6eefdbec98c1b87aaa85a985a4a078f993d76556d05ca74b34ff8a99d89dd5420e9b9a897d38300aebc26a422bbae20ea3f5ae6fc89e00129d6b7af17098136bdfb2bee0bb5b3ab96739a4ed68f64b32f695e647940b9ff88920e031cf6130d7afbe56520e908474c819edd8427f8c1d0419cb724fb929b886d04fb381d3812ff02000c2950db4c007fe6041a83c2f40dba706c597657171fc718c73efef572a8acce56cdaf4628f8a2814cdb29fbcfb3aac8aea803a99f5971113d8067d2f1405ba5aa4e8f69f12b459a354b5dcb7c0b957f39ab7c54ced6fa45dea89c27cfbb31905e8be6c66ceb01031d0eee76cef5354d029fa50fc2b16e59ce7d6b2fc583d3349c37de209362db2426a675ec472ac594cb23b0d38965a728da0c4f74ebcc89941ce30d866eedad1ec55a5d041f77802d5573f7f4e924c213241319a8c55385e9b732cb28cd6dbe3d2a8b088698c0a6d272a6343e6bc5d5b8a47fc2f894843d2289443dcf5434afe18a57972ba338e3bd4dd0b551ff90e9713b94d13b2406e0b2fb7811c1192e0c949cf8ae162a36d2ba2dbf12f45a44c5c7bca0996f1ae582c2ac71f40e098e16813403b471b97b9d5cad172a3d71b01e3792c1c351ec151f96e0dbe5a709f76be09e8e550ac13a5cf4c18bf49161153194539ae888cd78fcbcd068bb14b616983d8d6bd379030cf854997156abd371aee6288e7c3d65b96390b4f9c13a94e2c797faef5820774b3a4519cb9fd2b5efb103bd7587425f7659157a3d67d7c7f163710557504ca6aa3e7fe26c1669416088c56130e6aebf980318b30b45829f0cf3d508a50d36e9af0ef170ee0ef3418227b1563e1ddf8643e656a1f52f3e209489c743d7e290421a8320189b422fcc48b9cdc22c996104eb4e3d916386d801d6ef516b2a4a1658313ebe6aa9b7a00668493a577acb5fb40363471fb0530c6116ce74834279342b70ecb52e0a5a70ce645013436ab9e18f4a6d6ceeeaa39bdb14c5434ad758470cf783d2afd3dcd469d1daed6671f65d495968155dffb12ff995672f7a20504dba5936a5a44125407784515b30bcc655bd8d2e992490a7aa40a4971e92cc6a96755f985b69b24f12793ef3ace4081098b573e0dec7795d3073dd8820533d157cded65f173e3fcb60be7dbff92a72f4e92b9324c80cca2db32ca327b59c9e259515e29c24309397d29eb4ac4f9d74496a014d9e6fa7bdcb28721ac4fbb4096d1fccf55db547e6f2b55f84733ff487be3fe794c98e4214df763df59ac5d4598211f5701b8aa4275d6009584d6c29ca97d9a0321854f5a45d9daabb1097fcae5827a2b9fdc6a5b3e4fe026174c08d951d69e7e3841a45cd90ba9c7785f135e762d2ad5f62e7b11349e1b34409e17c0d240caf7d3b83e973fcdf51453119201bb130912ed758d15d66c1fdbc598e30fc178d31f923cb0fffe564a3adbaf64b25ae19b6e31761c23e4d2a00727d13a76ede9ea9d37004f95645b32d43ef4d3fe0346dc9250d079b1f25b984b012ffa9b0e7b4c51e0f44557d41bfdef97f623b56a88142ca6af6432d62eed6e817e185918b981b2bf11016601d0a02c647ce4490c015989f072367fe245b1c8432fc27e7c7b0e36d41f2a22366e7ad570ea858b5933f936f9fb227a71016629eead795fff344586191c951ebe2222bf33dcba21fbeca1ef1ee7f4190bcc293227fb67c9377cf231575bdf4705bf8b8f12615a9764491de890f7d3b2103154cafdcaa36b82306c367991b782d8d829575b078d99cfc8a8046cbf4b06df6ef3d2af3d5209bab2e0519348d65c055c84c7a9e4370f2e6dcf71dd751f162ffeaca19617732b3d4c1ee589bb92035a7404d239ee0b98515320f3b9f12b5c93535c188667e77566c9ddddae1bf860e720990edaada904b63571279917607578d583667ed5c546162c92305156abd994d291cbb0acad6e946658cb984fe5138966fce7095a1aac317b3721e83a3638dd900c2c1c3951fb19c672308bca9ba76edddb113e0e04150080b61067bfadc174b75e316b94457f6cc557ea1e05254cdb3f77ba35c5857ddac64844f7d8e01d3e7e24a75a4081a4d78e3caa36378395b0cad880310e2af7482b4f6eb25c584007515b6602303a3431f25e9d4666ebb64d36b4d7737e0360a7abaa55bb9df8b1363d9c4feafe07fb898b92df8f3122633096631aef727181fbbff827763f7982eeeabf1ebdc7bbe262ad8f75d20ff706bad0b3cac276bd2abe7717e318610e19d705ed082af64a1d214115fcf0cd007882a502653d03c11719f71b62ffe0fbbb2d7ef2151c6b5e5b1bb5622218e0bd272e9163a7a2ce3584bc754e099baa9fa04cfda152d76283faf584764a56dc6084d4a88364ca193bbbc9b0d1a6e963406d5f2157b44c3ee90982f317b6b56f4477489ca7ab24460d6f5d78c610305fe79904e9e4c67d7caf7c49eb39e5a269685a75c6650d3929230b65c60acb7c81909355d0ac11661ba73209a0dfe27660d3f48c19fb01eb1f31d358868496e552c547f4a80c2e3ab980ec2cf3c6ba182833679bff313f7197c412fa321771da0de4bb39e4c8e291d3fd684b601961751690ac8d1440460d05cc46a574f84feb7509adc74c93b5e93eef59e80f68d84fc970a6b73c53a35f3656d865b0d454a10b3de37b6451e791e8813aacaf999f0f1eef4d0e83719ef2877b0720be48bd63ecf3c24348966a684effcad35e10aa9c25cbbcb046d1df9b702f1acd2a9697de7b5c5338ae741b427840e08a50497031be63aea25cf970b3ddb9e37a1f6d19ee91b62195c9b1077e1449a1238cc0659d4ff5b8c748b2155f7865a00b8308575e8ab899416e265ea338b20b4086f5f7fe64851629d4d25dedfdb2c3a91034fddb48fa5483c682de7b91d78aee04cb117c44dcb64e614ea653f447e5c92352ae2ca71ceb1f12301bea49236a433648a02d8c567038081612ec7b750b3685dabd695021c86af7a66bbe42507e05563a28ee432b50478f83c9979438a0ed3a8e544dcf52696b6803b0a0dc767a0b2f4133ce6d1ab9290748eb2f49ef84d4ed8170144ca84b65da1668683225268abd1f763817ae0bedc34b24faa2c2acdf7e1eb568e2ea3483736793b0074669af435a7bd0bc23ee8fdad54efd9bb0e43f5ee286f42fc834265eca67e73ff2e49add91aa1aef297096a018cf3ba2d4f2add4cb507359ae31557fd61ac4067ce157d2b539218f056ecde05dc2ecdac8a28320f41c024bcd98aa0dfb69c510e4f7b2cd70b829fd5c08cc422039a6ac508e9c2ebf41a2f6c0deda51d5c2d70f2121144cb82b3216ad2f8104f9ed74282583e9a13f3d815bf32cf4dcc1c8e8a0d693f7b9cc3856c7680d95a830f7351aef7280dd15c8135dc9cbfc5971d0bfd4c4c08aca9a4fb6779e9d77ce87f0558db27627cee91246b65b538f9a1d7ee0bf1743a863fdc36552fb176740f1f302c7c9d005cda739019b1965f22f7e7a1a6c8fa3c15a62153fc3a5b61c6ccfd216e0f047ec4c141b10144f8ac21022cd726e381b994e1acd0ace4856f4feb277b4cbc53f42039c6375e605cd29072cbd4320f06bbfb677ba5922bb6cf826909745e3723b8a5331ec0ecfdeca02ccf30928a05e89fd2c9bd2432db5e18f30c63661f0edf347f7c53ff5ce7fecabee8d5980764db7c5d6ad235db2598d92d472f375cf0ad69dadbf6690b73321fd0d25da7666cfa78a88386897604f1b96e9764d5a40774c8c9deaa35862bb4efc14e799d4a6db77baf25c365d342bf95144ca738737d6041c57ad0f28a16bb3fd5c1254ddd9766fe8341446948f1f5afc8ea3989f3a7df963876d4639a8c650c3e5767b75896d2d0869ab9876e23a255fe8c3d540ae9ccda99d0ceb8ccb9872186260c6ef3b6cec7e20d10880b634339a95e9c2bc02c7bdf168c5da553dfd5766af345a95ee22cfef7a41389cf84aa0b21e467ffc5603b0881484faf9b05d3c77027b59ac133629a40a21a53eb5c19691632007828dc9fb891cc18f04d4406034c52cf255102c068fbadeb230527fdafedcc716f42b82d756c965391a203c13a1145e8e892a7d35378c776ccba8387d2e33cd971a2198c37f9c387d15310eb87810eed1b56721ce18a3ddb4f898eddfa67435e8828346e5cd71f77a0da41630ba6dcf7a0b3a80bee15f53a71c0c7c0e01cfe8ff9428d6b03433678cb0d16a971903d2a1ef633f208a6a5d2c5d3441706e526eb67656e008e63f920897241d4c52bb430ff89adb2480c32260e113e3b5a351563d9d5eb28603d537ca94ce02f5da2d3725d60c38bec95191ef6109b112bd211ce657fd4f9fca00ac9d5b868b2a06bf07fd1d4ad6f58119752f75ee002405f90962166b4b1df8f32d4733574e763bd18e7cda2fe8f355a07b40e072a52e85d1438a009463b7497afbc9da7ebd0389d873db221cbd326bcae27c6f0e481b20712d4884ee0874783c922da8b3f59343710f06503da81357f4a9e61eadf3077a09d135a09b7dd153d09404adffdf931a3ce2f74f86040e926a7e8ab0a243a5f05ae106d10720c94ad2f4aac57a62f4f5114cf44e72892a3e43b6342d72980642484ab66f96d79d627481c73f7064829a965af3849c00f5a3345bc6c8c49ebd9e7ba0221b01bee1b6b7e215cf7d2dfcf6f24432e87c3c35dc04d2e41b367029e1b9386b1c7870bc8f2d50bede7b590dfe1ddb602e2a711bde5414e6dfbad96a003604f6163f8133e91ff778b9b83ab58ecafdfcc93364367465c4b3523fe81090f6b6e19336b0d37123a30a6b98938b9dd0e39e9d56016ea4c24920b74667f6f436c50d582185db2aeb8b0b8c8d2581d5bd0013ed1fd9972b3d8896dbc936830a55486c57f6442591f89a56ebad1070099386fadc2f0b7c53889d64849e17fd15e04b61a08c738986972fecda41992082c62796d0ac0fe6ca0e552e04077181b9063c87f9866a7973e2cbb7adca2992cef5e01011dd4eb8ed1aff11dae554a6d819734bf57cf3fb2cadc4749f9c76078635a315d8808a44d26a450320e35c96932f7ef16cd781cc3dd2370f09485534e0e84374f3e4f8831dc1502e40cb359a272634f9494d68623dae303293bd1e4e7d9e7328fb7ebadc720b09d5a72ec62e30721417d69b13a809a5e74075e0f65853e4e959da57a790acea7632e5029491ddf3fe814ef764b60f4af3245e026c518f83fffbecce8164d29647659fa5ed8bbd70fb636e3c726040709de8922a2cdd33aa565a2c55d056a664aa218f73fabb8e6800de37c2efaad58a7d94c4e94c9e19dde76ee8b8d3a0ab17f04adafa6eaf02702013f367230f303ad8f7da18719880b095f5de5d490c882524581d257c3cf44571f46decd6a6545994473c36ae85714f98e82c104637b30fa8631abaaca9876430eef056b78ea7b06218b13f893d16055b4368d81dd14390c8748f21aa0abf5289a923558c7119e241c7793a100adea82ec4c3fd24abe7bb8b80b7be626cade5cfc89bfaa6aa9b86a04920310ba19c0b1d4f2d2843295b2d71d7979013a4da58d0b22ad25fc8c133fca30d4a8934997dfc058082ca1c60fe7a9833743050ae28de754d65da5744261fc7b469e8a41102166044f22512b08a8b6ed01658029f1262aeddee9c85049b4c149c21646934ef06b9e90f03d88967bb665b0072ef852902515967f3c3775a4d3a775e5920df3b60396e84baa334a5335580f045c15edd1169ddd4b0b10b37afbf70e0e4ac90648274151be4c557cfe3ae49240a9704f80a718ae7381c60c1da6c9ca3422e0c6396a5a1cd213f8290e2c49f0e2ec5d58c279b8287f80d29ae416d00dfbe900aafdd3fcaeb6f33e67152f026a78815390d74888e445d48ebba0e30ea7fa0a5a5d1d54c23c296e52c561aeb7e314ba9d936c0c2d163aaa49347eb02173b71dccbcceeb5399bef8591618973f057099cdd599a156ebd9a5b0baf05ef91f9dbb76cb790f4ad8765f3315715009add77d54f5daae4e18f10f42381cc72719755667bc528eefbb4c361708c37520f40c70ddae58a776b6f8673d33f656ed3be9b350aff1d2fdea98665f8165d645c6ee5e185db92e8bb0620f7b6c73fe2b347902886fb412a128d5c88f20b09074726308f94736c8bb5fc716f6b6cc8ca2bf9cf6fa8dc9c7a7a6187e036ffe37f846ac61014f9c40703109ee4d1d9d4bc064cb440eb15f4b380ee5ef737d8acbf95902fc61947a1cfc0d2c9ab04d0edd51b78ba83f6a8574d46f0ae9dd356aa13daa5556f4687f77131a585d1f9194bb990512cecfdcdfce91bec9e1fa1c66cfc8dbd463ae302fd25ea495c975ae22d8e294d6c14aae2af514d995b3da0a5ca8d3a2de376d633d1bf586a4b5f1a06192d1eef853af4f03866ed803199e84f9dda520872381d5902bca9b001c01fc1933d878ca6eec0908990e3cdab2438925865d11bf0a59d3dc050b99827ab45d03475746068254d5035f85e457d5c71915c6e78adc5e8c445d24d7e84b266ae8f6efd0dbd1ec7bb4397b464523557c7c1fa86c0c5627eb576fd42e40152ae6ea3b65f0d309575052e8deb1e77b32ed4fbfa936f1e4c4b60bc5322e115a175a732b16591ad12a194fe1c916085ca97cb3d285052d4c897ff7ea9030382e49e8118804080f56a1a231659b9cc8d22003198c9f8b38f0dbd53c0fb4e1d9137d8c964267d297d9f18163999473d4cb3511342928d7c2e9ade929083e392cc197aa26c28901d03dbaa456bde3d4d6806353d0ba62fc70998ac57b598e61fc37e588732a26a8c087f9ac821b20e9f7998c64649db14f59fac965620eeb3f0ec48626dd007dfba1edc70fd1b08baa0e79fa5be0dfc62693b63d1663844bd3100afdd23e87960ae677211d589307a506ed05554bd886150c79d2a066a96cd3b3a704d6ad2c79f756539b9eef85f72afdf24327fdff917a2ac3bdab16dac0dd23d3659a1a6cb0bb4a7f701b2eeab0e661503a4eaab3343515fdb665cffa9cbdd4e2f747468292751c08de91bbbe009c10d3b9b4f02afaadc599dea668fd2a2e0a198d40aba7b9cc595b6a27f3814c77165138c06bda7946401c52bae16527ee16e495df0ff11340d2d36c4fe92307770dccff1acde9f29f0c69ce792fe1fe100dd6552285ac527ea1359895c70403dc4867865960f0899a9f6c9007cbff15ac4d3c10389e15eb514ea7c6219e2270f1d816627e20117ad083c4b1188e6745824e80472ef9cc57fdd83b04485f125848dcf95f8204d35837544d40cb15f40d1b7e66460f37cc9936d1156d8c8ba6ec9afec8285578ba9e23193991a498342a63186a872b0fb4e94278b0f2ff11c08eedf882461441446a412f9b527cee8f989a153a8f9dd7f850fd80a94c687852df59cd9845ebf945dfd9a3f64bfd47cb03c6195dc474631c4534741c5524b8d808a0ee8ebaaaf6363c0ce8b41af4718eebb3c5bcae57e90ec5b4f348912a4aa8ad563b5e8dbd6bcaff2b77a7ba45765db10cf0a0025ba90e423f378a794932e2aeb02ffb81044cde9883083e6bafeee4ef68ad12eae0455b0dbd67c6db9e2bfe5904811cfa71d351c790a3ec1664b52e87db894553a7210c26bc024cf512c1a73f91f6ae32ad1572eb3b81e3765a1c6909478b1e91cccb1a8b98c9b35b6c214de7fab31986abd9b3ca7d0194a4749857b0da07088c47bf5bed452fdaf60de580ed1ef3640ebd687ff0fb043efe7ae46d1a8443ac662cf39688f710804f4fdade5673fa5e68e68ac77e20c61c481f4bc2c237582be1cf4a46dc2991ef231baf415ee66b6132c67670dff4004413c1e85b0e2e65dc4575053390fa0ab85e2b53e082080f67241393cea8df06ada2799bb0bb4cf37707f928b6b6ed3f368ab04a7ce357dac8b38aba9583a3c027695280bb18624d3a86e6ba354a4a3205b6821de766bb9ef54dbe7f085d68ee342d7708214f63eb03bb5b8ff7dc5eb9cb63aa7407027ece3eb68c082ec7db469d40453ed343e82ee6dfd491cc510d9417c789123c414a35d192c6303ef6aa21929c2270008be0fd9b3e206168042e31df2e01c905609e2276ff8afbb48a25988393813e6790e9897befeb5679b8c7fca5c5c6bfd5e95df5f3e21767125c71978103b2eb5fd25de1e2b636a5be6fbb1ee559d630a6703ce35c70f6e81ecf6c61863c5aa0e9066713a6670188e50ab54b7e1c34c350c9f53bbe5a2f2f0e15eb8397fd80985363db61cf7bcaca9892a8254c2403b14ac47390f3179f1d96bacac89ae6e87f9b1b8a91d5fee3cb52553012e471a0620b1fb145b50c26799b5e0a7d3043800e0056044faf27dd7f69a2c0b504c69e5c2d6ad24cb138951ae3eb6079f7e485b596193e7c8cb8202170880d4e3baba1f5b9cc577ae6f15d9f571947e9d1d6ae7ed2a468b493be236634cb7e26ce4c4c51accdee5c3e8d62f5c07958ab9ba23f995569ef4a78b5da49f2dcb1c2a5a749f5c15286d7afd59ae09cc25f5486011fbdb92ce4400e8e1f8f11f7f409de57a11a1316c05cd851d2fec340ae4b15813113ea34efe7e842744ccc09d6d6b4def91b4199ef90f616fda2746f496e18043a061af22ab28c7ff3dccdaa413ee3084f6b83c6ea258b4c13bf922f5948485230b571b034db400a523d28ffac1cfbe414864d08d4fb0aa373bced7b0f928d16f3a1ac62ebd06172a4121c41954882ec7e9b7e0a0a36d5af61385cf7a02b6f346e176bff010539dc292c213f9a26e12b2726de83a2ca4da5f85f6a750cdcd6eb0374ea53f73a3c4597dbd64e0f60f55bc5e57e327403b34e6270a3639c0381f81a6dedaf1537d39cef07bc5495570573cebc6018c15da9a1cf2a3b8ae5df3e58626ccaeeb152f9cc98cc58ea226b1345da9699a7ff1c717854b3d2783718594da7c9b5a49e46c6755b17bad5fd11640bcd5241c727beb6acdc614da708bd69ca916ad62b4fb3b81250f3d0e70fe5ec8450aa53ae791872b9eba8318f1b8d5c61c560492c508d7696232d160c3fff0d56a6664fe44e42d0e6b701b0f6ac60d5047daad2d1e8be6789c6871bcb2cf83fe831f461da8bbe97919ec04e84db4ef33fbb328f35f9c47a8997fea646ebc4ebedd22bb65c8511e0fd98db6246e88750ff1e31b0719fbf9ba3934175aa0e1e6c207a7a0299823de81843e17bbe9bb793639d7fbcf9edc7258d031f763c5e6e2ddbfae4b3e536109ea52b19ff125a5b3092de0d771bc23e21b54bdda1902337a344195df36330c5fcf92a44ac3949b840dba3312f18745547fe15ce12d72e25b3c8f20ae1e25add0bdcc600a134ec33ec3c7e5c868a97986559a85b5e2543e158c5d417eafc01068d58298769614e39672e40682969140ce07a7167a3d91b1ecb6d47afbe7de6fb453f7a35bbfa31279ef90e393c73d7ae53bc78d4f2025ae63e7ce8304504f1dc912355f5ebc8660a63c244314bbdafed6f7f2356eff115cb014e504b987b0b852daedb0d2bf15c60cd4188aa299190302cd50c1fe1c3bc644212441772c11369bc930c3c395c60a3758c79aa611c4abc9966ac14f7932f89aa6b4d136f73a8a37738284dab9160d5b60777bda643223cb3e76ba195e33d1eb4acb0205a1a275e440a2e3fc686f17a900ef427c97cd92ed904d4ad7120ca6ea875dc6d04fc29f863d046dff203fa30474c4410a3c83abb796521a6fc812578deab5fa28633b03d4033ac9a6a7bc597a1670d2b856679f40aa03c011d88800e72565633084c26ee16af49eb4b2ffcd14bb68bc6cecf32472f7dfa819e42a1f4bb25609380e63f87f38d7cca4485ea3860bddf1040d5c23de81eee2fa4c31a415f03b916f979f4789556a31947eb0a57ec3c7c329dc3f0049dfab084a3e65afebbd16a00a34cb5a5aa663ef82b2e4843c28a9fef7e9769b1a7c7f0cdec60288ca3b1d80c4ced9eb886f86532efcc1c4f91d7febc459462194437cd5e353e21ab3d4265af30b8b223152c4095032b90cb33fa0da60dd29e38f682636b65543b64cca9b16ab65a2f8e2deca58abe6da688e2475c4bca0ffb5efbbb838827e6148e8cc922133b8e27bee53c63505bd191c3fe7f6c321d978146008b7b58b7cfbf9b17490bb0dd2f1817c17e40534d946a7dfa16c20eb8dcb8155ffc2647748c109cab37233f79b74bf23dc6ab9ffaced7eda54051ede3bcd8455e4a68c11b2954892264bc86c7366c7a20999e6b379dd73b62af43fdbdb96447649d8a0acb5777aea36b3962a219a91f4afa9e859787758506b900e12b8b0b34acb69f31505fb328d0c70fe3f49a3667859b210cf455de57768cc9cfbaab21bc4332aa2509dfa2d43003938277e2a21d7aecf188d4592f1f28a20dab9d08a3fe99123fc55cf5443b1acec5c7ffeb766bbe33f2efacedb523b8427939c8be40d0023e31b9de870157228d1b5a5f94ae86e275da1510818b6af190db5d497fbe1f160c6d144ad697422313be0363b2c715cb2a466aa3147b20f95a2fddee5c084de317291ebfaac3003efbea1212e44e982af6839ce5b2ea653e3c062b23f5c7c55094f6a758c758b83e635c18a4e30d9b333071e0c75cfa73178233befc242b68f089110b4269eb1779ff18418c73cd5396005e8e3d5595a84bbd3dad26bfc23162f739f49718a6451887276c580a7a702080cf8a5d424b9ca58435bcc9b796fc0ee22224994edd396892aee2a7864f40a339df3f18294dca19611a312833b0263d6253c9668433b5370039b5bd19228f289f260678a743bc3f8cf363b3a5d015c889019e77abfb00d5e2dd6eba6eaa5e59b62e831a9df447a69ba5bba4eeec5ddca2f03e99a97464482965cb872d2f594449e65764d0cda3e571c2111ddb37dc97f3f40c643ebd09c3274a0872a8a3d8514837089d10fc302f06e25f84ad3cbbb7001b66601edbafe8d82f98824aec84abe5e34dfef677ed2bb7867a2dd731bd3f841522c8d608c8fea133f53e0df7b4776ab6d25e081faaf7c94f85a81cbcc70a79ea00d334aab7e5ba9f698185f8a137a7decbd4d2a8931e1c3508e4dfde00d28196279530fce2048289cf4d1fdacd52a9b27976de396e559d84b0a1bac297df173dc1f855b0fe70a935543a6d7e33f38ba68d29be4cbc11b84aeedb576b99754fe509154894517b49123b9401d0dd72732d2dcf61c45b50e693c937b37b1016e26b61ce1994d840e8f515d9d47a73547b649eef6a0dc055b53c704728fd0c97b6e1c01abb70e19cf80b051d8dff1aede692dae7bde129e06d98ca18f8d26615966f73439fc151476f793f646743028438b7b56143bb1105c32af2c79003ea69331848bfa2fe9cbd95929306a13bef7c1e21c605a1c53cee0510bb1b6a3f4f34f0f28053f63af72136471fd08f4935455bb0de65225b594f6a7b365b29277ac13453ed54b146c8aed39be935b71f16b186649161ee5f68ee2463876d3a3a70c2588c911aa820f0f2a3fb2c1f6768a9cc9e1457354a1667966d487ae017fba2fcb4a5cc72533a8674d51ae7096f4044349431f5f9799af3f6430d30534db20d031713f918d3000a45c433b0d1b42f777d3097679e03efbaac6887d5b8ab89edf8031f91c53178449da044812f7577a8cdfa5b6a8c82ea1641e4b80317c47385c0ba9bb960acfb70d98246e0974d940fd5dad21815cd5a1d442b5144b866ec0940e68e8d844399b51899d604c1f6ffc2729c7e670e3f0d1a56a1eb19786b7a019168184e472e32bd7c6365d725d95903aca807bcdb522c9f8fc0af7100b2f16bb64fab1cd8c82632f9052dfb01812a818898ed269c4e39e07dbe552b5c9c84127e07bf63ab95b2739792cb8e42a840a3754f0e67116dbc2188eb135e2e93133e99933032a3ffa4dd34d3ad0492cdc3534967d861014be93ab12e954bce49dbca41e3d83827424b5a11b945e81c055b17a61361f689fa6902123564392f86d4a28639811896fd20560389c4f0104af84a0f1ccaefa6e1964743b589de14c687c2e6f4fb274f068ec62d71a50c52b8d433251928ff25d88f1c3d3c5e602fa300c4e4aea234bfcb8acb5bb08ea2d3cff649ae973e6a0c15c80346192901dafa9caa335d20b942a6d751a7bf153e618a893c18c440ee90de67b613699d011959821cd95080bf60db360bbe8a1f33a263fa390d14aa7c4bb70de24a4132f167554e3c14e2c1dd043bfd8ff9c99472b73216aeaed940ecf0e896a6cf6d7ff36a5cd60ca8cff6a0445a655a26f93379f1c73d95a9d0f844b8899eb26d85d115423865b9e40d273c1e09c579c00c5d3cbf0e4a9da9ca1019c66a10436a8bd00a62b5f09bcfe0e2d07d0eb2e6bc7c4393f33c4cdaca5293c390e1c7e71031de10650d736615220138c037e8d538c1d9879882f9cb4ea923f90a7b066792b680ad3aa20300f327e3400ce36b456f1e6c37134c22519f5c68948de84a37dc967b248727666743188407c3d3085d1b13cc696263cdc151cdcc19ef5152a341e9655108631883b71ff9baf95c2f95bf6902f140cab9f106f105b39ca7cde42b6b99fb42d876614bccd5ed93ea5afe0bf9c415149ae71746255d309b9fea1437a2adc5a6bf792b84d65ff6478d5a38ab37f6cd6cb6e54c158e354f666289440e17dadd283a3ba2749795b7553d95690b27acc674f3d61655de67a38d5e1e7c0f6e1c63b6f11ad578c9c7b09980d3872eedbc0741cd1f1ef5b706b81f6cdbd59d11fb6f6190f6bc0b6654faabbb2b02fa7b04afb0dc78da6fb23b29293c312371155385a481b1235b8e574b0939396f70bf88d4886e1950c312b0461afaff31532956299c872e95fc58d794e5599f00741b98df7906ba583d7c254c8c4c566ed31d577840462269779d51b5f797337f4a0f30a3f580e30052b6006a242f5bad1d758a7a708bc2c00ec71e1bcb373c88163b8da0906d0d04b5c81931607015f6e1d59a8c4fa9b601b3772b50a094ea61055425d2cb25f799722629b926d0eaa342e082b9bf1136f560edbf0d4027a3e8e7efc8aa9c0c846489ae530b5edffcea6aeeb7e1a5bca4c69454de8c1b7638deea375395f1d9921e1484e9b116584f8bf32c34a87ae59e2e2a32bc965c2e70469637951bc2096da16c11312351c77942be5c10a689679afb19e9c4959e1dc518310692079f91b721e8d271e5dd12d28ea8f949598a42fdc534720894a124006ce525b76b069a154e731b78c0388d7f4a873549e0a19e4988970605da3616c40dd1518fe6b687dd91d741034f347c948ffb032f6756718f862e7686eac5e2248a1e48eebdda53ee53582e440a936cc870f60c63a157cc41789e356f83f17d52dce9a3a8fd556fbecc248fe9f7032b4cce876be4fe33b7fbfa626b12a86ce988841e276d31605ba1d4f2dc1306013ddd49af7701daa07edeecfc66997138a2d5c35175bb04c03a93b34fd6e63faf7c562db9912bb2d5257212a9956ed6f6126a212c3491785e7d2c2e464bf3d7e57a8fddb7a376244eb3b4e65048829c5978d861c041a881f5e46d65694db69aace291f1402267015834cacdf9166217bf4edc590cdad268170e7cca154cb9670b9b4157646fac18fb56b0e1724afe69f61c53bd8058ed44437f60fd66d28fbbe015b62c5a38a74f0d978d1e542ee74393aa1546df787893967dcc7198908f118b87ca47a68fadec6d9f97a95030aadf2ff9be31e637970354751dbc9122da621ec3aa4d79a6ec659f16d642fde76b00d8f6699f6fc5adb080263d0fa9b1b229bb3a499b7bb2f2d7ab3a93c20c3828fad4056898be2f390ab68797b0242020ce135ac6e993c31f74a7b5343873407682b28333dcaaaabb09a1ca9ecbe9ff87ac828233e1d76fc95bd9a6a0ed36f4135aa9e98db58d316228acad2e5eaa7040ed40bd2f7b6a02fa3d5a8e8f8a625902b6b2bd70f4ebea6cd6864d374c92c8660c996c9e5f4e617ec9f40924bf449aa23f8b8249a36aecb8a9e6728ae11bf61f30bfd86b389b63a99c6e0862725fe41d95138bc896b9718a9008fd6cb276e191e926a920ba98768bbd3598b22e84b74977643502e6e5b2ba0e576acb92b2abbfc12b98fcf07d14a126f9774f564f6021e584cd0d04cbd7a7f6a2339c403432f9464b08330d6b8c1944d187e37715260f695e25030564bb3c9395233ca021bb67f45df713a17c15206cd90488f7a87584565eb1711e653ab37bc58d536887882972f2475463faa27cd7927f50c49deab888439a347cb82124fe9428946694fa7e3d892acaf2a32e3267244e84ce7c66b596c93669192ddb318fca95b78c974f99e292beef50bc15c92a2b9e406fc3cce022ce4611711ee61521a5305fa1903149454682f4c3719c87ad751095bb39ddb8ca4b3e4df01cf0a6d4ac88caa136b128d022a00127b7d6e9ef9ceba9e9ed2e1a711864890534eafba41b3282870fdf3e5e4eb3bd16dff978edf4c3b2d43225ba9d9fa87067f867dffcd9d0fa46e2253f6859b921b78ba8c0dc02810da50bc50ebe1f035f6a243d1ea1b8f5c8af6e2f4c26e2fbdf6ea3797fd0c48ba4a6ca4fa5da67f0c01dd36047618209a8a28cc36d0de3f9a60cb2015606ae003f1b4a9e9f28a791bc388dd5c27ddf778e5d302fa7f1b4883bb523bdae115d6a8098491c9313e97ee7d8fc16d887f1c2a59b81e88730be72148b512b5d46f60c871d4f99ae723ee3e02992e69338fb9933ae675fe0be3901f0655be8379062228391381cf7f2ba84658766323abf28810b93579e9dd3c1b42c01224f135bd88b47448717347840c7fb7cec68e4405c9a07b95f168fa76d9da70c14a86f3f4d14e3fa09f98213e444cf17d43888b1d9483c3e30de289ab0a6dcea243b4683224c673c8a8a9b325ad4f0e3a6ea17c883342988cd34ee4cc5d87d65f92806f25cca36aac90d4da0598c534fcd14250d094063ac8fd0861904f3fdd846333070fa69986605e9538d105bd64dafcc189c796e9d10cdeea7d73e3c943153684685bd2b51ff8017c1d48dbca70f6d70975d2fade9cd620a1cfd3c785324ff6222f9579c0a7a745bc53527d0689aa05913e4c14d2a33689605e702854e66a3d789f2163beadd7c83c912d1b0edaec0750ac0654e3d28d82c20d058e9fc5202176b0486288e19e31be068c9731836058531bc489e4917db52576b319fbd9e15d970236446c9755a04860be25df60c310591b7a7515f215d2f2842ff6b05b377ee7339ff2a8f1bfa644b4c395406b4dcfeb0a406a4e3d419a13a759be9e5a3b0dca95a2bf5fdf5e10a53812e5410615a7a4cafa043f457afacd5222ee8189977d5f8ecddfd867020506ca6a9c9feaae2931f40223c0a91989d509bdfdcc511d81d640b98bdfa627212ff51620c2197db0460a5c9bd69c48c71fb99b23e6d597f6bd36f8fabc9c378ade7e5ebafe5e07603a1eb752b9a8de97b2a56aea09ed9cb10e6f61880869e7d186017201ea463c6f308b0855032a79701caa5fde989cea5ec4ba7bec92a15aafebd190c77135e4e1033d6b86cf5c3422b9bad4ab7f95143a73925ca59cc4debcfdc514a4617ff48c784890e085fc60af972b961ad581995a2d2707d3baf0ed6c3b0493ac84ba3d03b3bc2931bcd1c0b5e522b71efdc61c6558bb2f27c85271f0b723711188f809476375fe81ae7868f231856f65b6ee1a3009c94fc55b7c2f5df063190a3d00366a8e93f8233dc24178dba7548d8cf563c898f90d3ce1977d4ae520ea4e867fc807a457265845f3e486935ec933081dcf760580f759e80b430af6a92f77199b0b09a08c9005f2b5f79507c06fc465d63b00671800fcfcd313fadd5d061f51eb49c09fec51621d3ddb249ba121708b1ff1b897d3883f3bf3a5a4726dd1ab39d09de50062c809850b111e7838483298317281ab76aa26bf9d97b46e7b2356f441429368f2a09d0b348dd2a2e39868ae646b3dcb290250bcae2ff30e3281cd14174f3bd3a33dfb0ab1818408d529d3b1c25f543f9d060acea30144e629e631c6e8dd93d8e3b1ee2a10a4b2533fba4e4d8311f687b923ad0777f58b3f4f8db310f0465dee2e69283dbd5419306940b70ec7c17df448c1c67fbb666431203c35e5175c3d8d22220fc9a8b7d6b5e574314318e09baa9b68c8e17dda76476cb203256fd46a01cb50da3a05e2fe60b6d2d0f59003e139ec14725fbfbac65ffc32d066f4bc1bf805d5e7deb6476769938e5394ec44a9021d59f06ec8a6abface8f849e2021e96e19be45fed2ed74ddfdc64881d87278e7c16ce45caaf4511a1ed37c53c3a617e0ce01e3e6d115f7b2ae2f9647579d66224c38919186b6c7f5849342550253146d8a225c910604620b2e3e4211addce0518ab12a6354043fbdcb8fb32aaa1dd7ebc5adbb02ffdee4a50962f3b5bccd46112f24968f2a1d6481f4cb6d64de7c167a7931c3d076b407386f3ac6e3f5a29fdd3174732af03aa389f216dceef4d415d0badb46e47db1db35ef9c4169b873d1fb2d28e08d81f7bac3e49e1f2352348a19ab0a5ca56d5474e5d50b376fdb70bccbf933bf7b620e53ac59b43e8aa1695db4df416db403605997c3abe19babe251fd170fd392bb7d688498e66895d9c7427f272053a5a8591de7b5af80f59d4d9879c4b071e99b5406132008138a1259798d762acf9d66ab75aea91d453b97f3beb59c6f83b807e6eded8c65451b63c92ef8c351661ad2e60309c02ba036a8689b050e432a9f507410d1069477496d2c973b0e6d1012cc346fea50c3a9bc94837d84d7ee2f6000e7ec21d9cac128553e544e32fcb3359de919160b0eb762ba89eb6e463eb5fd108f24d003fd05575a9182d7fc71ab7ad193e5fc104682ce21d0e9729894df3b0cccc0000608f4dc63dcc0ae421cc1ac5afebd32c8addc086205994008ca697b6bf5ea4ac231f54591da55a185c4a3041783fcd0c89304beb3335f78f480ca1af3077abff80f66d567a3792be2d29b84218691e4db6a58e70842c53782359744b77483fe128c0f2f15f538940656f3c7e4404a2e43e974daf97edba0cb31219d4984b8e19e1f09543aef62dbd19ac5e75a50bf725381815af37855e3e36a7babea24712a95f6b7dcfb8b392ef4a5abb2a60897313559e0b01c938a37ec53c6517df0bfaab4f88a0594dca27af7959bb2218f4dc7e8c1df1869fa1eca5e6f235bb93d2fe3f74b48926bdd48f2f873efc9c4ffc3c7a556817a6768a96586649d145bfffef3e192b72ce19052f5f1d4562f2d1402c765a172ece6565fdee624e4a2385e832cd8401b40df316882430eb548448ba540eafd0e2f37f7c081ac9239a4951ffffc4ae70d5cd8a73293d10a444f5f8f6ec405fc82aaceafd73692a1236ff610c02423d32f54e69dfc22b32d55835e6db425dd1c1137ca929308723ed5f1dc83f11e2583ae564618d93c99a7224842c5da3f320dcb128162bff986e54470e4c6e4a857bc7d64ebde39f22f9aaf954e15063635727eba9e243f0a0febd0021bec00f97aa1668292aa2c59ca1886ba29b93124693593a105fd8dbebf4b972275c79ef4c65ee7da3d816495f973ce2216e24dea21997907fe906cd065237b7da9968c179092b7ed68a86c6222794618213ec092684ae8be9c8ea2d0a417a0677c58721ffe83b4c97f667e2177028e9f35af7d2a6742d416735370794b9b86c5156ecaab9ed80ce55b5edeb08151b5ae0650f67f99a7c59f0f00f5cc43d1b7b3610d312d707dad980ab2b45f56e091b4611003ff29418375229510f9b81ab774c21ad9db76df873a535e6b595d99c895bb341a76f539893b98bbb24d418e3ee293a6c3c7f523c164eeb3d970a28db915bbb63c91c1aef0071291683fca34832808f2145fe78a834c610c4ee34f110aec14bb44f46993541332fb21e9873ccf12c54b3a8b17181fe97a3a296fcfc932692017b3cda0ea80a35ba3024ce7a8ccf26dda76fc396422369780755f7d8b47f5529334cc1a14f795d26a34bb6f99ce163b80035f1d7987e997c304dcacffabe03405e478f8ced41dab089f7b4fc89300661bc06183b5be794290d734306a459d1ce08791204ee9deeb42baa675106202f87ea18296835a035d195690a6651dac0520c536227549969e36791bbaa264647c34c2a65b994d134dc47245ec72b35a424bc4a3a3b0bafb367771efba89944ec603f10b2a2756a9ffb0eb83e6b936d4b71f4efc93ea4b5d4d1e5a5b4e5d3a8572613ad3dd6f59bedbc613f017a9b71503b991cc0f7c305d09ee2875d7759340043f99a4a04bad316f256ab9e343fd89aeb31a20961168d7b39e63a9ffaf63c65eee9921b68c153faa3ea31c897c544053133f977913573f94818c91d95e5d3f2e23c96ace7cdf89cb3fddb85f76bc3afc349097be65d9b5567bb568d20b2d5d097866fb2f7ba5ec2d70ecaa0f23244386dfc00ddc2d15de60881f4fc72e6ddf1a5bad832cede1555efa5711583616a9bb8262cd3743fc0f582194b3c5197271c4f987abc48615b83954b4633ace75f3f4f18166fa0579a6581d734a5cad631d5b7b0342aac0f87e443f836dac0ecb42bd894a447da7071e092f7aec8acb816930ad1002f3f30fdd737476739268680dde2b91667aac6648c33a8319b122a8d56e07bcebedc897f6a82fe4b4122996b845836492353695952536b7a7d6747fb1883c2123148e1183b4abbd1f51f48b90dd64a7f4cd07b54df4b05dd20681b136ed45e3f04a1200540769caccf2ba1274416c66aada4213c9d1d1a1f943995a4e9c659d45fbb9d952f5964324ab69db118b4d8dabff6b8f5dacdb7cdebf1343bab55472daa3e95c3046b193159248626b27af5eb1c01f62e850ae039ee55442ca24ff5abf5ad2d3830ca50e29d96902cd5101585e0baf571063e55c424cdae98e92fa24eac10293663a2f19702ea3b7d76e381e1faba8351d5fef60dd9b9b7a807cc961b8cb67f25b36bb214227e5692cb9fe09279eb57d1f2209d5da256743e28f9219021955094cd6b5654796c936dd3cef5cff0c6fe997656b46b2d5c93ba9c86bb55c734e0f70dbcda2731ac01154653921561ee8aaf82a7bf1be9ab0275ef7803cdd684f9cc438b0e45537960b5a476b6884e67537966518016b033d792c3789df2a0038b5b8d8247f6a278b43e21a4f96e6b2e44367af845ae46f51a562c70d2147327e78c85f382287abd91c806ead3b73ea547cc4d9bd1d7ee195ae04e60cc392b731b2ef945711d8868d9ca635af4a053e52a071b180dac88e6a42db4687c22621a126bef8ed726a8bcebfda10abed7aa751d2ecef2500241e58ef200635171ba8f133432675e813bb2bbe378ee088738a2b26e112dbd842abb7aa7541e547ad649fd360c3c4685575d039956cfd2221d9da9c9f54aa66f4834197fdca363b4a7c9d2f1a0d30749f9a35516557b1c54b7b2b1e12ea1410f7d0dd0091bdc74723a1d7c941f58e4da35255533f70d7660e00b623027bef4f0fe27dbcf2290fd7a43b6a5d6b58db2f1f163ed8088b19174c7cfaefd08659fbe4626414dd0d48c517dbbccfb41c457aeee6e6d0a79cdfbf84bb9f9b82e75659d2d47af0bc211cb363a36ef12ad9b8a7d2eeb744ea80a2c3cdcf0f423c77a2543c8e639c545c8743db1c731de6c07de91b0224aae1ae09217717d1912a8e6926970a55a31e521d2ae42eda4f3c901b269557dc25187832b3434b15c6e4f5c72cf1b0482d9aadf0cefb703bf88a7ee99b37bfda7a6fb2809392feddf63acadab506106d81add626af74473ab062fe4ab992be6f3b6d039cb07c4e39f9d8de1dedbc6b07df8df32e01b9273c5a75bab05b0f9352c540e595b1059d0671066caf0acbd6e8854130cd9338b09f034716c64a3c63f6f06290a1ae8e5b374c87e587a7fb39e794fc18603eb5e6bd7cce2c225cec1c9e58185576866063d3ecf0ed064fbacd531d94ccd6702b432ec1722a91006736462b4ebb9a58c3a79a426c626e03c57e635408403fd271194b90719bc84463b61eec3248a0ef8ed186caa280e109ce95c107ba86fa64fec4e6c77b91c750b6bb88e01d38abd4a277099e1fdc1604585e10d6cf4512433194253745aebb1911ef5f0a7b57ac66387b41d7daed22df0b203264f3852f0d570f7ec3040576dc52d899aad41ab53b7c361065b03e2a8cc3e262f9fd5a3f55bf4aa6700816c2f613a3e113d98e21195b7ad8f59d4996867d90fead77cc65692e86b6c55ed312e6833d88777fad1b313848e62aec18b4f2eee3927c9c45079bd094e14f25c006ccddeac4e47cda196de430dc46f035d18be01a710a970a46c09cee3654de9b426c216684d7062f048bea6089c03d8398324bf450b917616f588abf6a2acb3d6ecd0b70be3532bd1ce2887e3f5667a370ebfa546a5b509fee222588cc032753d0a04f4a8c92b3805228941d25928d7de1a80c99b12dd103a22a2dab0461b3a16d4ece5710402341c4d97d0b745d1ee86a840e55467341ed87de009ff0d2906f19b054ecfac2b551cae762b2d79358f1c22c8ba1c8bb5d9391c3d16dd8b5017870b6ebe1039078169e5072858a57df0b273e7b20e4b1d9c9c5c84dfd48f45b33003ffec25d5e93a106c1a130c9c54c5579c9748dab88eb2942fcde820c5859d404b330254aaa26be12ff8a9057dec6245b4286d7504d5e10c69b038dfef443de36499731a33df2dc03bbfde609103d13698a8c792f693fa89705089189b44365033fa891553de0470ac1fed79a2dbb2a62d5e56f00803acff40e03662f7eec55f830d9fadbd8a9dfb88fff412d931af2c360735e7408523fa9c243061362048e7d2acc2b030a9578e81c3e4b92e68705f580878f12275924ba07568aa7c62b5e4c23e35a93242675d25bff5c82a7b07a040bcf6aa74671defff06e033a417b933854bbe748cd8e14214fd757026f3e55898e873e9f85d74ae4f700255473e143ccd1d76479bba6a7b31ad007c539019d8d28c57d5d4025d53160ba741582e2af739daf6c9ee5733230ae8e1e517cfba328cbadb276ada2476bfa6140ce67f15ea84a1cee81f2602bb83ae59441c2834ac302d2c58076068912be57d02bf87a7f910464432f84039bdaae28d5ee8908a5f0fed0d169813819bae2089f8d467e83c2a35ecd6ae243e99080d70496511cc83f4fa80c6112bbf94fe9ed83719e4bddebcc7da04407dd2b032cfef27834d87468a7e5dc758f34f425dca1d7967d39d119e48cb07287072484518a365d9974a8f68c4f49b0bc0d14ef13b76bb1f0735508b07bbe3f4c1f561ae6d9c80d739c0a32d533fab524e8064d017dc68291df5b739f8013a35f791d97edbe6dba4498e691f79645da5f904ab0a4ca8e745a8ccea4c639e47c89bf6b5185cfe41694144dbf622fe2c12df8596578aebd39d27de372ad424be72878aa9839c19eb1326c077f8f48f0ee93afca48d4ace664367573ef8621555ac5924dab10d1b73f2902739b8c495dd95756a56ad57e61504a837467c64362c1652cb2123e7dde07f0fc8e62da46d07b6d55686921d5c4e926732ca8889b82814ea7b78fcd42144124619a074e27222ef2c0aaefd2d117eb709f7db13ad1cd9df0b28c18dfdf628cec28dd95d3a24047ccc7432713604b8bbcb66875f7314ef10f43ceae5471cdca783c6a825a1dd96a3f88c6fd6e187615d5fb14443db8759d4970af2597a96b03ef304589e2e12dc5276a7e00a2c924250f42709a429ce6e5856a98421eb3f7a6261f515c61e847b56fa97da8f5f72ddc5c49f264ebbebbfc9fd2ca19e6b953859cceb65b40fc3206ced51b4cfba23ffe174697dab18f3063907624ef25b50088c8b81df1fce1468121a38766512b3b3f29e9b9aab2a4beb32e099273db6c4b1c05a015f13629aa826b0cc9eb95c192abe1560b1f9cf0c1f8351bc978afe0873a74f14b8ff5c3088583414eac319f178249e97aa57a4c83b08a4a1740c74e01b38e36bc31e4a87d1eafebe2745b9d4e5c726d6aa931803994696bf4bb9853fff57d9e424261488268b955b9cc4afec5322daf5cee1b65f495e1c3efacec265f56a157b75af7b37d31a1709a372b569d979031dec0933b73261fc635d351092460ed9f14d163f5e4244f42e66844a1b1ee2907ce0173154475ce9e14cd12f16d702730ab517f6e588e3e31089e59078409dec6ca74fad459cacace261d47b37273950d72a960434ddc760fa8233ecb5ba137d242ef70b33e8c778462cbc9f6bbb4a34aeb0c9df61ae7a2437be9ebca6043fabe27e319efea6ec7c85f8adb1cd23da677b9eb564a2f624d58983623dad6fe69223f5004405a9872c7064c786b0f70494ae3b372d6765ced4318ee91c597efaa219eadafcf6339546b645f31aabd8a23a5770aa33bc975028ed26b78d0d4b309ed3faf6b78c567dccd7c30514438cb43bc4718c83d6c94f7dfd859637b10d8cba2ad008ae9dbc1c01a79c455345d560dd6737798748dcfe85e299015a2bcdf6b07db438935205285c73b0809affad03ed8be33c1fedc32a8a5bee11213691ecbd50c45c97ed6e64c3c9e8f4869bad62e4d4a92c36a84a2a00b79c202405af00bcd6e8203607bef8c7966be865204c06269be00db314ec5e5e41a6f7834d2b6bc6aaa8cfb25da982b5d3d4b8f4b016145002574b327818a8b18b02e7fd346dc7d1644020d0d58f809f082aec277ff16cecd8db8643075022b29c767f7376dcb27695ff25e620da73181d6f55b648a8f33856c7c70b2519f7df8a437aa960e20d428cda2a01c0883478acd3ce44e35768f2989a4e200b93a1e76943dc352a1cecabf09702fa479695c4793bccade1da87389bb4785b6fceb50bf19573f8c5735dce736edbdc0e43ca3480264879ef8a4c936abfd20137474c61a2d353fa42472dd019220970b5810724eabc869b9a33858908a24f2c181703da44df04e3069c9fd42541d0ff498238b2b785bd96838ee9f4f351891a9c89c263d55617860e55d5cda77f198b32e60b11b5f212608ed4935eafd8c4739b6ed135b39f41a7ed3287b49b86a6212ef8372b065c0f2e6b355db27b8c2673d173b46a03f3a74a182d7e18a1d7d53327cb8948adfa5d9f24f1c224c81fdfb1fb080146f961d6e4fe8e578def6cd90c9720453b1fe5ab4aaf1081488dd2c341a1c41c6de17602bf40f131360eec5d0d4171fb3166e5c95740e71a4cd2732552ecc2ca21bdd3dcc81becb20ffab8b598d63f2a68b8fb84c702694523f4f60a3573db65ce51c26eadaa72659aaacc722cbe2b76cce88a7f050b792d4b17bb3a6ea02667234ef8ce3d070ab5e029a7c26e7f3a28b32bb82fe4c7b91e66981af111ec643aa9ce9c846d743a8e969670ba5a0b97ceae30f3170a339c902ea4b42bf1f5352486db298cb3407b3e77e83fcce8496f6282ae91a14ea23700b450539b403ac563116183699f45e05e349040fe36e663cf19b8f2e8253d7d600e6a42f41d76cf9b2d5bd56bc5e497528df8aff1ae4de43ada01c9ace50f1a032cd46246ece577c55d3783f7b71fc8fdf863f9dd94173d14c0ebb7aebe499ac7d71d94c9c09e8473d3f88e7e59ec75a0266f4fdff6180a40d2fd1b9fdb884e209059e70b01f09f21da70736bf268d096a03e0213331a1d1eaff6ec56192331cedeca44301d1efa4a02f0484bf9550d18f3d18b14e94bc41a13658b3ed016aea219189e5919f7f463bda3421a901d7811532755bd387789e6cec03a0c206a5b3a736dd69cdeb2bc1c94f8a73a21f3f700f58df6f0dd086e4d595f672d05806510e495ef51473d8188ef16d2bdb331c40cb5cae43788dee810bab6e7424ebb8275dab92ec17c48fc409eaca8ec3180251f376a8276196cf1755dac4288bbe94b82aa4546c42113066ebfcc79fa8395dcc39a5f6aff0ef96e1da760b8880aa910568d193c122838cefe456a8f161e6d929335e091f3e3d7205e47045ff1b8ec8f88b8cac10ac69b72a1e129dfb76e1956b140dbed82fd4c8603dd297ac48acb56a189b20941e825db590304d520a48dacfd16bb699508570e6804adc59385767a75d77884a864e0a1ff3a468e9bc06309f18bfea8ab1a0d1f0a587bbc0f3ce8403c92cfb020983dfa47e0d4a31f84eecd6c99ca396266001ae9df4fd30b7df9f6f573e8ef172b4b939cfbe423c3f1ce04b57d84b6846a92c10fc160865061a3020a3e99f10b709622250fdd9b8a79ab3f38adb7ea5c82fc8622a02091db4afff7ce28d136c79ad248b027fed5ec9bfae64453a657c0d7c321df71fe7860fa95e9dfbe3e0e8d9e3f4225a0fb0c83e5451b22be21a58e275db7bd84a4e6eaa137066896c8c1fa9a6f12980095a6b80a5cf1baeeb0180fa0c42eb3acbda42e6ab39073755e5f12c3858168833550fc960d15bcd0b9577951ecca7f54c6645533be5edf42700ba26b700760bbead3928e31db813301bfefe3f969a5bc9635ce5093183022bd118a23589e22441b58b7db5f78151cd988d2cd2f6dd97d7b76c877c3747082e7710d828817feeda3ce0087482122e38f090d567696283ccfc5af244ea002e8faeb2313648ec0498836e4d5c73cdc38751f576252e7e9c15ec9f3472a219880bb616b8bae7b057f7ec374878eea6daa99ffffda55a81ea3b9c706dbd13ede5c7a94cb134cea2dc05cac0769d2c00e657fc2a02e2f22520c18751dea25652c4b67e91f4319778bfede9a795ba7fc3afe80eebc713b4a3fb53f224bd7af94c27b282d3232d68edf9051a4e5ee835049b724b0115be4f5b76118958e9d93dfc29f7b25efb20880f18ad87f2c34f025012e3dbcd8d5beea90578a930dcb7001ea1725827886862d6e5d9c5dcef9121c2fdba0af08607b0f9a698c57202eb9f39804a196d3741f83ecc8143309dc1e994ef8808bcb5ae8012d50ec1f94daf1ca1436465a985a439d536e5dd6c298f1af00c02f8d12a82e5c7984784cbfdd0e55698cfd4521f14391e2be75a87ca67988a10b110ce5fe4d9d1db007637616e2617a1cb19c053a253c264ae5cf83db69dc2c4836b1e4ea96836895b5ad877a1fcfce727db1f25b5c96445975a96e76f2a0bf8e4a942a7e203e32e9e434732eb9d9807d14515a4368b980e15d4cbc7daf352c8bd79cdfea5ef99393022bdad8a8251f4fa4255a66103012caec40200e996bdd6cd7aa81d8e8d40f1dfd32217530f6ea862c15bdd1881e37be80c5b852666a4038f0162435f93e1056d07167a5374469497c1c919c4bc402fe87d2a290d34e58765c82f00d401fe7b5aa1c1a7adb7cbaf587027acdec87ee2a8d65ead3772953ddeb068ec84f827d2eea6cac28e621c779d860023a65c6f623f848a1b1f580327069082db01eb69c6304c24d8a266c2f82f2bc2ad2abd2ef3ea8801517d038bb6af72754008f68414f1f1345a00965998a9dc3b7cfd33021ed59471127c59b42e045b602498906916fb3678d4e60ebb2dd5f8f3508368e0235f7d17d892333b1745da7da7159ffa6f657f956257c913e5bf5b90fde1eb945ae2039ed2fad3c0bffa6170d3ef58d72852e8c5d5ee4df62a42ffe8fea14292dee561dc96f46bcf9660649958df82c43de26e71df3a1d0ba9a8a4f1bc6ef2cd1bd9064146591365f806093e9d1fddf4007fa95d733b188106c1c548f0cea20b5934ac912250dae7b5481d8ae6b4a44f96a7eb4e0f46db8b5ca8f3872cded6b7fd6498c5b104ae59d28d79a7f14751bdd4bb7237ebbff91ee07b24ea693113e2e05ffc15301b1c19ebff547c76c5b8d3bcbb25c047370db501ecd7b328789ed7abd6b4fb22b08bf04e78f9c29ae28f2c3af25ec611e25854ee2441dce2f4274a839418b092abb6fce1f3c4cfe515b818438cea7027962624c67cb6247d458d2359c0ddde4512bab4b9ea2ad3d193f495762fdfe9237288e91742a30c61adcfb5558cd164322476afb3ca7af617457f51fac45fd39a1ec9e36a3d5b75531037ed139c5cea39a2287bce91b2dd57f0ff172bbfc99b21268c7d9bb9313cf2a4359dfc2b9000caf9340f201092d5860600d166334ab33f01412ef32fff69f32537225aedbb46a5930372d8c6fc0f64c1154efa6746a16f7f3044de75d6898c3ef503af2111469d5f9000f336944453b20e8b1a5e1367fccb4509214511dd6dc8dff4a54c193476e9eb97f1176932cd5339188e4a4c9d2e1f2ffd34b7df92f0e798bf59599205ab65db390de8b7826713ee42891fb11ed3de323c758b813a788213c1184a335a343b898907f6f2e1560bcbb1d8dcc621ac90ea2eab20c17310e769b638d24b8349bd73967cb495ff4eef52339e19b0831c590d27e21af8655f1d296e3f986e29fe3e24b2cc12f57a92f620ba4f48d50243651a99b7b9a26d85c192095b9ad83e53a9dc8d2aec7328f23abc5db27707d8e67d92cb5cd2138babfa9e34e7f9f647f5ae85fad569e8ed70d4964f86ed2d0a1d3a3e6346118b052fee46c07cab7b5d85c6d96cc3d868fc49c811408658b17fe91b0d9699ef3af62d3c129040782ccf70416c4cd5cfa9a2bd3678016443e650c747280a99e2f866f9383f450757ac9214f8b9e836f374de61e52e8d8bdeebda2886ccda5a6ab9ebc2b116b259159d1717a9fcc65e4348dfec2daf14f10d98131b868abf0626161b9df223c7a75763092ce9efc0407df87908df2eb9e6384518655eb16f4d7606bb5d21e96a01cc36a86714a1e2049ce94a3832e7b724eef233d230c041f93301d8e9658d7a0f99b7cb2680c51a417afe7bf353a8936caae08b65bf6a0be3e5ab573670f637b5e02d79832b97284707387f2fe9ac16c64133c80f5a0c8a2db2161ebd16bca93b4b5a243772bb0233baacf1184a2463c4827ed4417e1ec0d2fcca51df30338eafb68c1de294eae843b20c218b4e1ab7bfbc4533b8b4650eef49f5acaa23266540572cbcd004af03fb0f88cabeb5b45effae1f02d8108564bdbfa90ececa95f294c01d98adf15975c1abed1baa5b092e7e69e19df7a34fc31316c4915f1b635beaeb12093e48f9088d342aa802d2f4026663bdf65be69142dd9dd23e238aee3d270ab4108f8486f1baf8cb6c674fc2b48307ec460e6be71eb70e929904a3600e71696d6715f64e5c7686ef2f456fc2ebac53eac642fe177eaaae87c74de26023a617d71a99a9b7e8046226f4de75169fa266c830c6423b40618835eab52cafa262e457529daccf8fc96a5f96aa298529bcb10015d51a5bc170ce6a49b70b69f4c6479ccf4c98b36328d87f84c1e4eb327af008a92646571b0f9467ee325f2a7e1ce7d743202cbb9af4e9964d981e26347ea9908dcece174319582102ce97de6393469b90934b4e590052153605e2704a6ad6ca62c4006437097d376705a692e17f7cf6b72ad6751534bdb6baa9c609d44e08c7ad979522f01a878cdfa9deaebeaff44bb4a1d300e5329dd11357f51381f6a42ff935462c620808ccd274161f4fa80254ece7543058b311aef63037c182d4c96e05713a263e756a38028a8eee965ea900c6dd5ac7ec2f785a58455ab104b09723b94333664151f7d7708cdee1076c521af2a5748026239ea24335516de66739e878fc35885c172a96831631f326f5abb3af91e8d8233b545757004011342ec9addcae4a7ced9f323f9a9aa19150bc88db27fc8a5320c7f0b83d58b6a3fd414f076134712ec7153d6b68119634fcc3390c87e2e27c18c9ef5cc21fef44307da6d77dacf69e42a889828d70cf2407c8d8e4332335fed019f36f82ae23753fa56b7594d334523d03a89834054520870b46255d964fa897c137e385a2a275445a315b185491e99ce09c0c9c667ee997d047edc65183c0730afbbe104cef65607a2cd3cff713f7805d79635d767fb86818f5a0d60e4f46b4aeb864c436d59fc13fe741d7478b5e2d4c09ee64ebd7f059850ca24bceabffb8271cc7252d1c2e3d34d2ec3aede30d5d698cb2d9af7b72ad55844ff836d7ba17ee667045cfd8978b8abccd832f3b81d9d523a6bbfa64e2baec565be0af9a339422526b7273d4ea81f7eb95422664f3d0ab43363038a9b5b834cc917265c627da7b9b71c31ebbc63d441ccea6ceaaad1bd14c936c78ec929bf7f9084acd45979fc3e0bf3517fc8f1f62258b4c2e4295464b79a32697e25e46cc541c4c543a9af167ae38e5f5152c2d06e91714e7f9267df38f8cdad4bbb7681d6ad874aee06b59b3accbeb3431854e20d16673aadc1b32b76e06066b23e15ccd8854fb09dc1190f44ac7c59474df611ee333deb39e6704162f6747195e7b9b0dbed80f81250e29e8868dcbf7b33e0f034550fcfb990dcc6931bbd08bd327c8e44ceac18e992538f042547bfd689a746de1fea4ec4d79e4099cd9421ff30f9c29e06bc5a612d5b600f0d726a3c96865bc333cda630990699cb2481e0d79506bff02753b09efb0585695480d19bbf36d08757d5a44aa27a565f2008cf99296975e8d700d10ecb0a0e3571a29f1fad7173b440579cf0b2ed635d1244299cc27129817275e2a5943ef181eb3a07fe4df2f77d5b1a97e0d63bdc528644ab9cd9dabeeaff7a0c378ef6b15e7863895e28e9880e9413ed7358c8cbd6d14f3b82b73a64d5105214664a838c2a8d4ae3fb9de0d0bf2a8d9414a7b6884f6fc5dd0ba690c1e4c090d9fc3b4cc7cf1fc03857cb45f774db3ad738f8e5aefa2bf78ad69fbaef764806c2264cf38cc112252b8e16eaeb1208ae9211d1b2d371c2ba9bfb94f69d43778e35c3c2116953ee2c0ee0c8334a49b7a9fb3e39ea8affa01005b12cac36bef151275d9fae69c9fbd48f5dacb4beda16ef1e075212680b40d83f3d38058f0741ef369e2d2d2418dedb88425090fae58775d4cdf6d4aa83a46a7758e51da5203f8b56795aa310b2d66579662e12e7e23a08dc0724e62cf715d78e697ccef87d0b562d749f0b47790828e2053bc0cbc03c2413b5c84d675f84703e57ae4221244e6e65d292bf7461e40c358aa979555900db1957102bc9739ed6f5839870f2164095130fe7497c5937ff7cef9cd882dc221c5bbbe1efe623e02ded82b96efba85574424b50745e6b55701ce802d92b67bedc4676e40678aaba0ae9b50a7ea9791b9b489972ad11c27e88189405e89c35e720824fcaa1ee34ec3faebab15d067182e9153a856149f3b659a8d7b3357f6004d980b8f651c51ad13c2ac6271db2ff24dfc436647dedb2d26b5b05af84367b1134b25e2c29066b49abfd95ef44e7705554db3984a1625bee81dbed05ea79f805fcba8aa4f9eb509ddfabf7d2256b9c1e78c20600c5248009bdc74fb9dc02f592f4e080a1ece7dc97957866ee341e05b45fbe26ae43ea96a25703664aeae71b4f246c31cf3a2d9d9a3fd400daeab0529136099db3bd4db79944a9879768d2f833fd0821cbb9c8353d0bc0d273413015f5f1e29b5b839ca4b529342d44948fad6cb7ce74d048cf05b83953bb4e0bc680469364c9755aef4258440223c65b406ac1b72cecbabcf07ea2b771dc904907ec2999199a57c413c5aea9d1d4bae99fd83dd286328daacf707c1a657d33988f1a7e77e3d4f50d9aa81eca09846b464a38233dff6b2c9636702dba029f2f1127989b5345d674191c70faebf760f1055a827b69f2a016022652ee02137ccf718ac1632052827a4c4b480d70913444e6ea1889171702e059d2942c6627682e76adb301082b4f01a457ce4cd309d1b05c7dfcbef4b79559dfbfde0f8f7e2e41519745fb92edc568f310b652b7c14c4fe0b7ab303081f01625bcc4eaba2b5db54cd69228b2084b2e1828688535441697ab8a6c6a63e9f9048139c1fabbd602cc087b733d43aa7dbc64de2376929eed379b1b1791f573db0fd2a85820e03754e3f61cb2d18e57d140f9ad3cc96deee9f4b8afde9c93cec0d1f91408ea60ca5764052b86153169efa4256df1ba02afc58f2a1ed4192f0b8af18c744974424b97b3f113131e1409e94104ee27df99f16cedfc64fe1d0cc05574fd06a3e4664321bf553744b5cb87c7efd7e1b1938cde443095c0188544e8321c43c48a0f7ec3891ae9ebf3b3bd17b816e9bf5d1808f18b2c03fc3954ebd3c4d77ec71eeda0cac26969b684f80660d9ca368792f651204112a17378e2bcfda5455ffda1045c2ec44d149da079a0c1e1230cc5dec305568fd36020cc650414f368a07c9889419cd179da612997ebd6ed330ffb256eb55eee02ac29786c1b67147a570af83c6d560e81c7ba2e5ac61597491064a36854cc80b7c8f32a78f75e6a02e2360d028008ca01e510a6238caefb8424ad2cedd8fa56ba52c8c762f5f6336fe66d3a2f03f2fbc6de4de93e530917c72440df12692e0fc976568d17bfe2dcbff27764c5e7bd7dde24630605412f6a98fe5df726f79623bb437d09281fc577d6d771f4578b2752c50f841cc56b93e68b9709ac99aabf3c0afbb57b34b38d6b9b9fc92317e8c35aecdd14fafeb9d3791e6d9cc8515ec316726d1a41f80291b23e6498f02546ef66fc18d8626a50b3c769d008c61a6d2920588167ff0e05</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请联系微信：codewj，获取本文密码</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> postern </tag>
            
            <tag> charles </tag>
            
            <tag> burpsuite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>主动调用java及native层</title>
      <link href="2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/"/>
      <url>2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/</url>
      
        <content type="html"><![CDATA[<h1 id="example"><a href="#example" class="headerlink" title="example"></a>example</h1><h2 id="frida-server-linux"><a href="#frida-server-linux" class="headerlink" title="frida-server-linux"></a><strong>frida-server-linux</strong></h2><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中rpc.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from __future__ import print_function</span><br><span class="line">import frida</span><br><span class="line">import time</span><br><span class="line">session &#x3D; frida.attach(&quot;mousepad&quot;)</span><br><span class="line">script &#x3D; session.create_script(&quot;&quot;&quot;\</span><br><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">  hello: function () &#123;</span><br><span class="line">    return &#39;Hello&#39;;</span><br><span class="line">  &#125;,</span><br><span class="line">  failPlease: function () &#123;</span><br><span class="line">    return &#39;oops&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&quot;&quot;&quot;)</span><br><span class="line">script.load()</span><br><span class="line">api &#x3D; script.exports</span><br><span class="line">print(&quot;api.hello() &#x3D;&gt;&quot;, api.hello())</span><br><span class="line">print(&quot;api.fail_please() &#x3D;&gt;&quot;,api.fail_please())</span><br></pre></td></tr></table></figure><p>7z x <a href="https://github.com/frida/frida/releases/download/14.2.12/frida-server-14.2.12-linux-x86_64.xz" target="_blank" rel="noopener">frida-server-14.2.12-linux-x86_64.xz</a> &amp;&amp; chmod 777 frida-server-14.2.12-linux-x86_64 &amp;&amp; ./frida-server-14.2.12-linux-x86_64  启动linux的frida server</p><p>通过netstat -tuulp可以查询被frida-server listen的27042端口</p><p>echo 123&gt;1.txt &amp;&amp; mousepad 1.txt   记事本打开1.txt,<code>ps aux|grep -i mousepad</code>查看该进程</p><p>python rpc.py 查看rpc attach mousepad引用打印结果</p><blockquote><p>python-binding里连接frida-server的非标准端口:</p><p>./fs1428arm64 -l 0.0.0.0:6666<br>import frida<br>device = frida.get_device_manager().add_remote_device(‘192.168.1.101:6666’)<br>print(device.name,devie.type,device.id) </p></blockquote><hr><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中<a href="https://github.com/frida/frida-python/blob/master/examples/bytecode.py" target="_blank" rel="noopener">bytecode.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">system_session &#x3D; frida.attach(0)</span><br><span class="line">bytecode &#x3D; system_session.compile_script(name&#x3D;&quot;bytecode-example&quot;, source&#x3D;&quot;&quot;&quot;\</span><br><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">  listThreads: function () &#123;</span><br><span class="line">    return Process.enumerateThreadsSync();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&quot;&quot;&quot;)</span><br><span class="line"></span><br><span class="line">session &#x3D; frida.attach(&quot;mousepad&quot;)</span><br><span class="line">script &#x3D; session.create_script_from_bytes(bytecode)</span><br><span class="line">script.load()</span><br><span class="line">api &#x3D; script.exports</span><br><span class="line">print(&quot;api.list_threads() &#x3D;&gt;&quot;, api.list_threads())</span><br></pre></td></tr></table></figure><p>python bytecode.py 查看rpc 编译生成的thread列表</p><hr><h2 id="frida-server-android"><a href="#frida-server-android" class="headerlink" title="frida-server-android"></a><strong>frida-server-android</strong></h2><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中<a href="https://github.com/frida/frida-python/blob/master/examples/rpc.py" target="_blank" rel="noopener">rpc.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line">#device &#x3D; frida.get_device_manager.add_remote_device(&quot;192.168.0.2:8888&quot;) # 基于远程ip的集群</span><br><span class="line">pid &#x3D; device.spawn([&quot;com.android.settings&quot;])</span><br><span class="line">device.resume(pid)</span><br><span class="line">time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line">script &#x3D; session.create_script(&quot;&quot;&quot;\</span><br><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">  hello: function () &#123;</span><br><span class="line">    return &#39;Hello&#39;;</span><br><span class="line">  &#125;,</span><br><span class="line">  failPlease: function () &#123;</span><br><span class="line">    return &#39;oops&#39;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&quot;&quot;&quot;)</span><br><span class="line">script.load()</span><br><span class="line">api &#x3D; script.exports</span><br><span class="line">print(&quot;api.hello() &#x3D;&gt;&quot;, api.hello())</span><br><span class="line">print(&quot;api.fail_please() &#x3D;&gt;&quot;,api.fail_please())</span><br></pre></td></tr></table></figure><p>./fs1428arm64</p><p>pyenv local 3.8.5 &amp;&amp;  python rpc.py 自启动进程查看rpc attach pid引用打印结果</p><hr><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中<a href="https://github.com/frida/frida-python/blob/master/examples/detached.py" target="_blank" rel="noopener">detached.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def on_detached():</span><br><span class="line">    print(&quot;on_detached&quot;)</span><br><span class="line"></span><br><span class="line">def on_detached_with_reason(reason):</span><br><span class="line">    print(&quot;on_detached_with_reason:&quot;, reason)</span><br><span class="line"></span><br><span class="line">def on_detached_with_varargs(*args):</span><br><span class="line">    print(&quot;on_detached_with_varargs:&quot;, args)</span><br><span class="line"></span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line">#device &#x3D; frida.get_device_manager.add_remote_device(&quot;192.168.0.2:8888&quot;) # 基于远程ip的集群</span><br><span class="line">pid &#x3D; device.spawn([&quot;com.android.settings&quot;])</span><br><span class="line">device.resume(pid)</span><br><span class="line">time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line">print(&quot;attached&quot;)</span><br><span class="line">session.on(&#39;detached&#39;, on_detached)</span><br><span class="line">session.on(&#39;detached&#39;, on_detached_with_reason)</span><br><span class="line">session.on(&#39;detached&#39;, on_detached_with_varargs)</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><p>./fs1428arm64</p><p>pyenv local 3.8.5 &amp;&amp;  python detached.py 自启动进程detach进程后捕获进程退出打印log</p><hr><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中<a href="https://github.com/frida/frida-python/blob/master/examples/crash_reporting.py" target="_blank" rel="noopener">crash_reporting.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def on_process_crashed(crash):</span><br><span class="line">    print(&quot;on_process_crashed&quot;)</span><br><span class="line">    print(&quot;\tcrash:&quot;, crash)</span><br><span class="line"></span><br><span class="line">def on_detached(reason, crash):</span><br><span class="line">    print(&quot;on_detached()&quot;)</span><br><span class="line">    print(&quot;\treason:&quot;, reason)</span><br><span class="line">    print(&quot;\tcrash:&quot;, crash)</span><br><span class="line"></span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line">device.on(&#39;process-crashed&#39;, on_process_crashed)</span><br><span class="line">session &#x3D; device.attach(&quot;com.android.settings&quot;)</span><br><span class="line">session.on(&#39;detached&#39;, on_detached)</span><br><span class="line">print(&quot;[*] Ready&quot;)</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure><p>./fs1428arm64</p><p>pyenv local 3.8.5 &amp;&amp;  python crash_reporting.py  进程运行中detach进程后捕获进程退出打印log</p><hr><p>当需要hook一个app的子进程时，调用<a href="https://github.com/frida/frida-python/blob/master/examples/child_gating.py" target="_blank" rel="noopener">child_gating.py</a>在子进程创建时创建脚本打印内容。</p><p>argv = [“/bin/sh”, “-c”, “cat /etc/hosts”] # 在bullhead中/system/bin/sh</p><hr><p><a href="https://github.com/frida/frida-python" target="_blank" rel="noopener">frida-python</a>修改examples中<a href="https://github.com/frida/frida-python/blob/master/examples/bytecode.py" target="_blank" rel="noopener">bytecode.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line">#device &#x3D; frida.get_device_manager.add_remote_device(&quot;192.168.0.2:8888&quot;) # 基于远程ip的集群</span><br><span class="line">pid &#x3D; device.spawn([&quot;com.hd.zhibo&quot;])</span><br><span class="line">device.resume(pid)</span><br><span class="line">time.sleep(1)</span><br><span class="line"></span><br><span class="line">system_session &#x3D; device.attach(0)</span><br><span class="line">bytecode &#x3D; system_session.compile_script(name&#x3D;&quot;bytecode-example&quot;, source&#x3D;&quot;&quot;&quot;\</span><br><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">  listThreads: function () &#123;</span><br><span class="line">    return Process.enumerateThreadsSync();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&quot;&quot;&quot;)</span><br><span class="line"></span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line">script &#x3D; session.create_script_from_bytes(bytecode)</span><br><span class="line">script.load()</span><br><span class="line">api &#x3D; script.exports</span><br><span class="line">print(&quot;api.list_threads() &#x3D;&gt;&quot;, api.list_threads())</span><br></pre></td></tr></table></figure><p>python bytecode.py 查看rpc 编译生成的thread列表</p><hr><p>DEXDump:js暴露3个export api(memorydump,switchmode,scandex)，在py层调用三个api进行交互</p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/dexdump暴露api.png" alt="dexdump暴露api" style="zoom:80%;"><p>Zentracer:使用替换js中字符串(MATCHREGEX,BLACKREGEX)将黑白名单传输给js文件，将js文件直接加载通过send将信息传输给py端</p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/Zentracer替换.png" alt="Zentracer替换" style="zoom:80%;"><h1 id="java层主动调用"><a href="#java层主动调用" class="headerlink" title="java层主动调用"></a>java层主动调用</h1><h2 id="pyenv-升级"><a href="#pyenv-升级" class="headerlink" title="pyenv 升级"></a>pyenv 升级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pyenv versions</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;pyenv&#x2F;pyenv-update.git $(pyenv root)&#x2F;plugins&#x2F;pyenv-update</span><br><span class="line">pyenv update</span><br><span class="line">pyenv install 3.8.6</span><br><span class="line">pip install objection  安装最新版objection和frida</span><br><span class="line">frida -UF </span><br><span class="line">Frida 查看版本</span><br><span class="line">Frida.heapSize</span><br><span class="line">Script  查看运行环境使用的是QJS</span><br></pre></td></tr></table></figure><h2 id="项目-demoso1"><a href="#项目-demoso1" class="headerlink" title="项目 demoso1"></a>项目 demoso1</h2><p>pyenv 3.8.0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.example.demoso1 explore</span><br><span class="line">android hooking search classes com.example.demoso1  打印包名下所有的类</span><br><span class="line">android hooking list class_methods com.example.demoso1.MainActivity 打印类下所有方法</span><br><span class="line">android hooking watch class com.example.demoso1.MainActivity</span><br><span class="line">android hooking watch class_method com.example.demoso1.MainActivity.method02 --dump-args --dump-backtrace --dump-return </span><br><span class="line">objection -N -h 192.168.0.105 -p 8888 -g com.example.demoso1 explore</span><br></pre></td></tr></table></figure><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210408082733062.png" alt="image-20210408082733062"></p><p>method01在native层的静态方法，method02是native层的动态方法</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210408113746342.png" alt="image-20210408113746342"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">var MainActivityHandle &#x3D; null;  &#x2F;&#x2F; 实例调用的性能优化(将instance缓存起来反复调用)</span><br><span class="line">Java.perform(function()&#123;</span><br><span class="line">    var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">    Java.choose(&quot;com.example.demoso1.MainActivity&quot;,&#123;</span><br><span class="line">        onMatch:function(instance)&#123;</span><br><span class="line">            MainActivityHandle &#x3D; instance;</span><br><span class="line">        &#125;,onComplete()&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(&quot;MainActivityHandle is &#x3D;&gt; &quot;,MainActivityHandle)</span><br><span class="line">&#125;) </span><br><span class="line">function fridamethod01(plaintext)&#123;</span><br><span class="line">    var result;</span><br><span class="line">    &#x2F;&#x2F; method01 是 静态方法，使用Java.use</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var MainActivity &#x3D; Java.use(&quot;com.example.demoso1.MainActivity&quot;);</span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        result &#x3D; MainActivity.method01(javaString.$new(plaintext))</span><br><span class="line">    &#125;) </span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function fridamethod02(ciphertext)&#123;</span><br><span class="line">    var result;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">    &#x2F;&#x2F; method02 是 动态方法，使用Java.choose</span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        &#x2F;&#x2F; Java.choose(&quot;com.example.demoso1.MainActivity&quot;,&#123;</span><br><span class="line">        &#x2F;&#x2F;     onMatch:function(instance)&#123;</span><br><span class="line">        &#x2F;&#x2F;         MainActivityHandle &#x3D; instance.method02(javaString.$new(ciphertext));</span><br><span class="line">        &#x2F;&#x2F;     &#125;,onComplete()&#123;&#125;</span><br><span class="line">        &#x2F;&#x2F; &#125;)</span><br><span class="line">        result &#x3D; MainActivityHandle.method02(javaString.$new(ciphertext))   </span><br><span class="line">    &#125;)</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210408085409310.png" alt="image-20210408085409310"></p><h3 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h3><p>主机中 ./fs128arm64  -l 0.0.0.0:8888<br>frida -H 192.168.0.105:8888 -F -l hookandinvoke.js   手机ip<br>objection -N -h 192.168.0.105 -p 8888 -g com.example.demoso1 explore 远程objection连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP 每次都是新连接 速度慢</span><br><span class="line">RPC 是 TCP流，速度快</span><br><span class="line">rpc.exports&#x3D;&#123;</span><br><span class="line">    fridamethod01:fridamethod01,</span><br><span class="line">    fridamethod02:fridamethod02,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rpc调用"><a href="#rpc调用" class="headerlink" title="rpc调用"></a>rpc调用</h3><p>curl -s -X POST “<a href="http://127.0.0.1:5000/encrypt&quot;" target="_blank" rel="noopener">http://127.0.0.1:5000/encrypt&quot;</a> -H “Content-Type: application/json” -d ‘{“data”: “roysue”}’</p><p>curl -s -X POST “<a href="http://127.0.0.1:5000/decrypt&quot;" target="_blank" rel="noopener">http://127.0.0.1:5000/decrypt&quot;</a> -H “Content-Type: application/json” -d ‘{“data”: “47fcda3822cd10a8e2f667fa49da783f”}’</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">device &#x3D; frida.get_device_manager().add_remote_device(&quot;192.168.0.105:8888&quot;)</span><br><span class="line"></span><br><span class="line"># 启动&#96;demo01&#96;这个app</span><br><span class="line">pid &#x3D; device.spawn([&quot;com.example.demoso1&quot;])</span><br><span class="line">device.resume(pid)</span><br><span class="line">time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line"># 加载脚本</span><br><span class="line">with open(&quot;hookandinvoke.js&quot;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.on(&quot;message&quot; , my_message_handler) #调用错误处理</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">print(script.exports.fridamethod01(&quot;roysue&quot;))</span><br><span class="line">print(script.exports.fridamethod02(&quot;47fcda3822cd10a8e2f667fa49da783f&quot;))</span><br></pre></td></tr></table></figure><p>python hookandinvoke.py</p><h2 id="压测http并发性能"><a href="#压测http并发性能" class="headerlink" title="压测http并发性能"></a>压测http并发性能</h2><p><a href="https://github.com/JoeDog/siege" target="_blank" rel="noopener">https://github.com/JoeDog/siege</a>  压测</p><p>apt install siege  <a href="https://www.jianshu.com/p/74c465ff136f" target="_blank" rel="noopener">https://www.jianshu.com/p/74c465ff136f</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">siege -c5 -r10 <span class="string">"http://127.0.0.1:5000/encrypt POST &lt;./iloveroysue.json "</span></span><br></pre></td></tr></table></figure><h2 id="nps-内网穿透"><a href="#nps-内网穿透" class="headerlink" title="nps 内网穿透"></a>nps 内网穿透</h2><p>客户端：<a href="https://github.com/ehang-io/nps/releases/download/v0.26.6/linux_arm64_client.tar.gz" target="_blank" rel="noopener">linux_arm64_client.tar.gz</a>  因为n5x是kali nethunter系统，chmod 777 * &amp;&amp; ./npc，启动npc</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210408115046329.png" alt="image-20210408115046329"></p><p>服务端：<a href="https://ehang-io.github.io/nps/#/run" target="_blank" rel="noopener">https://ehang-io.github.io/nps/#/run</a>  添加隧道，端口映射</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210408115216335.png" alt="image-20210408115216335"></p><p>add_remote_device  修改远程地址，将手机ip和kali主机ip暴露公网调用，通过siege压测</p><p>device = frida.get_device_manager().add_remote_device(“192.168.0.105:8888”)  手机ip</p><p><a href="https://github.com/ehang-io/nps/releases/download/v0.26.6/linux_arm64_client.tar.gz" target="_blank" rel="noopener">linux_arm64_client.tar.gz</a></p><p>device = frida.get_device_manager().add_remote_device(“118.126.66.193:58888”)  npc和frida都在手机上，新增客户端，启动npc，手机ip公网映射添加隧道58888目标8888</p><blockquote><p>siege -c5 -r10 “<a href="http://127.0.0.1:5000/encrypt" target="_blank" rel="noopener">http://127.0.0.1:5000/encrypt</a> POST &lt;./iloveroysue.json “  启动py脚本</p></blockquote><p><a href="https://github.com/ehang-io/nps/releases/download/v0.26.0/linux_amd64_client.tar.gz" target="_blank" rel="noopener">linux_amd64_client.tar.gz</a></p><p>device = frida.get_device_manager().add_remote_device(“118.126.66.193:48888”)  npc在kali上，新增客户端，启动npc，配置隧道服务端口55000目标5000端口，手机ip公网映射48888目标192.168.0.105:8888</p><blockquote><p>siege -c5 -r10 “<a href="http://118.126.66.193:55000/encrypt" target="_blank" rel="noopener">http://118.126.66.193:55000/encrypt</a> POST &lt;./iloveroysue.json “  启动py脚本</p></blockquote><h1 id="Native层主动调用"><a href="#Native层主动调用" class="headerlink" title="Native层主动调用"></a>Native层主动调用</h1><p>demoso1基于<a href="https://www.jianshu.com/p/0390f598c34c" target="_blank" rel="noopener">https://www.jianshu.com/p/0390f598c34c</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.example.demoso1 explore</span><br><span class="line">memory list exports libnative-lib.so  查看导出函数，静态函数直接搜索</span><br></pre></td></tr></table></figure><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210409090128175.png" alt="image-20210409090128175"></p><p>_Z8method01P7_JNIEnvP7_jclassP8_jstring 通过搜索<a href="http://demangler.com/" target="_blank" rel="noopener">http://demangler.com/</a> 拿到原函数名</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210409090231131.png" alt="image-20210409090231131"></p><p>或者通过<a href="https://github.com/lasting-yang/frida_hook_libart.git" target="_blank" rel="noopener">https://github.com/lasting-yang/frida_hook_libart.git</a></p><p>frida -U -f com.example.demoso1 -l hook_RegisterNatives.js –no-pause   查看原始方法名</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210410090140648.png" alt="image-20210410090140648"></p><p>修改hook_RegisterNatives，添加hookMethod01和invokemethod02</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">在hook_RegisterNatives方法中添加</span><br><span class="line">                    if(name.indexOf(&quot;method01&quot;)&gt;&#x3D;0)&#123;</span><br><span class="line">                        &#x2F;&#x2F;hookmethod(fnPtr_ptr);</span><br><span class="line">                        &#x2F;&#x2F;replacehook(fnPtr_ptr);</span><br><span class="line">                        method01addr &#x3D; fnPtr_ptr;</span><br><span class="line">                    &#125;else if (name.indexOf(&quot;method02&quot;)&gt;&#x3D;0)&#123;</span><br><span class="line">                        method02addr &#x3D; fnPtr_ptr;</span><br><span class="line">                        method02 &#x3D; new NativeFunction(method02addr,&#39;pointer&#39;,[&#39;pointer&#39;,&#39;pointer&#39;,&#39;pointer&#39;]);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line">新增invokemethod01</span><br><span class="line">function invokemethod01(contents)&#123;</span><br><span class="line">    console.log(&quot;ENV&#x3D;&gt;&quot;,ENV)</span><br><span class="line">    console.log(&quot;JCLZ&#x3D;&gt;&quot;,JCLZ);</span><br><span class="line">    console.log(&quot;method01_addr is &#x3D;&gt;&quot;,method01addr)</span><br><span class="line">    var method01 &#x3D; new NativeFunction(method01addr,&#39;pointer&#39;,[&#39;pointer&#39;,&#39;pointer&#39;,&#39;pointer&#39;]);</span><br><span class="line">    var NewStringUTF &#x3D; new NativeFunction(addrNewStringUTF,&#39;pointer&#39;,[&#39;pointer&#39;,&#39;pointer&#39;])</span><br><span class="line">    var result &#x3D; null;</span><br><span class="line">    Java.perform(function()&#123;    </span><br><span class="line">        console.log(&quot;Java.vm.getEnv()&quot;,Java.vm.getEnv())</span><br><span class="line">        var JSTRING &#x3D; NewStringUTF(Java.vm.getEnv(),Memory.allocUtf8String(contents))</span><br><span class="line">        result &#x3D; method01(Java.vm.getEnv(),JSTRING,JSTRING);</span><br><span class="line">        console.log(&quot;result is &#x3D;&gt;&quot;,result)</span><br><span class="line">        console.log(&quot;result is &quot;,Java.vm.getEnv().getStringUtfChars(result, null).readCString())</span><br><span class="line">        result &#x3D; Java.vm.getEnv().getStringUtfChars(result, null).readCString();     </span><br><span class="line">    &#125;)</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line">新增invokemethod02</span><br><span class="line">function invokemethod02(contents)&#123;</span><br><span class="line">    var result &#x3D; null;</span><br><span class="line">    Java.perform(function()&#123;    </span><br><span class="line">        var JSTRING &#x3D; NewStringUTF(Java.vm.getEnv(),Memory.allocUtf8String(contents))</span><br><span class="line">        result &#x3D; method02(Java.vm.getEnv(),JSTRING,JSTRING);</span><br><span class="line">        result &#x3D; Java.vm.getEnv().getStringUtfChars(result, null).readCString();</span><br><span class="line">    &#125;)</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> jni 获取类(jclass)的方式</p><p>1.需要new 一个对象时需要jclass.<br>2.需要调用这个对象的方法或者属性时需要jclass.<br>3.jclass 不需要释放.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">获取对象类</span><br><span class="line"><span class="function">jclass <span class="title">GetObjectClass_</span>(<span class="params">JNIEnv* jni, jobject <span class="keyword">object</span></span>)</span> &#123;</span><br><span class="line">      jclass c = jni-&gt;GetObjectClass(<span class="keyword">object</span>);</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">直接找到类名</span><br><span class="line">jclass long_cls &#x3D; env-&gt;FindClass(&quot;java&#x2F;lang&#x2F;Long&quot;);</span><br></pre></td></tr></table></figure></blockquote><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210410091647753.png" alt="image-20210410091647753"></p><h2 id="rpc"><a href="#rpc" class="headerlink" title="rpc"></a>rpc</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">    invoke1:invokemethod01, &#x2F;&#x2F; 导出名不可以有大写字母或者下划线</span><br><span class="line">    invoke2:invokemethod02</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>init.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import frida</span><br><span class="line">from flask import Flask, jsonify, request</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">def my_message_handler(message , payload): #定义错误处理</span><br><span class="line">print(message)</span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 连接安卓机上的frida-server</span><br><span class="line">#device &#x3D; frida.get_device_manager().add_remote_device(&quot;192.168.0.3:8888&quot;)</span><br><span class="line">#device &#x3D; frida.get_device_manager().add_remote_device(&quot;118.126.66.193:58888&quot;)</span><br><span class="line">device &#x3D; frida.get_device_manager().add_remote_device(&quot;192.168.0.105:8888&quot;)</span><br><span class="line">#device &#x3D; frida.get_usb_device()</span><br><span class="line"></span><br><span class="line"># 启动&#96;demo01&#96;这个app</span><br><span class="line">pid &#x3D; device.spawn([&quot;com.example.demoso1&quot;])</span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line"></span><br><span class="line"># 加载脚本</span><br><span class="line">with open(&quot;hook_RegisterNatives.js&quot;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.on(&quot;message&quot; , my_message_handler) #调用错误处理</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">time.sleep(3)</span><br><span class="line">device.resume(pid)</span><br><span class="line"></span><br><span class="line">time.sleep(3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(script.exports.invoke1(&quot;onejane&quot;))</span><br><span class="line">print(script.exports.invoke2(&quot;c6138f96658ce0cb845bdab0f9616273&quot;))</span><br><span class="line"></span><br><span class="line"># 脚本会持续运行等待输入</span><br><span class="line">#input()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;encrypt&#39;, methods&#x3D;[&#39;POST&#39;])#url加密</span><br><span class="line">def encrypt_class():</span><br><span class="line">    data &#x3D; request.get_data()</span><br><span class="line">    json_data &#x3D; json.loads(data.decode(&quot;utf-8&quot;))</span><br><span class="line">    postdata &#x3D; json_data.get(&quot;data&quot;)</span><br><span class="line">    #print(postdata)</span><br><span class="line">    res &#x3D; script.exports.invoke1(postdata)</span><br><span class="line">    return res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;decrypt&#39;, methods&#x3D;[&#39;POST&#39;])#data解密</span><br><span class="line">def decrypt_class():</span><br><span class="line">    data &#x3D; request.get_data()</span><br><span class="line">    json_data &#x3D; json.loads(data.decode(&quot;utf-8&quot;))</span><br><span class="line">    postdata &#x3D; json_data.get(&quot;data&quot;)</span><br><span class="line">    res &#x3D; script.exports.invoke2(postdata)</span><br><span class="line">    return res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>端口usb连接，主机连接adb, ./fs128arm64  -l 0.0.0.0:8888 启动frida server</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210410093320312.png" alt="image-20210410093320312"></p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210410093434378.png" alt="image-20210410093434378"></p><h2 id="脱离apk"><a href="#脱离apk" class="headerlink" title="脱离apk"></a>脱离apk</h2><p>7z x demoso1/app/build/outputs/apk/debug/app-debug.apk</p><p>cp lib/arm64-v8a/libnative-lib.so 到 /data/app/libnative-lib.so 并赋予最高权限</p><p>adb push libnative-lib.so /data/app</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.android.settings -l hook_RegisterNatives.js --no-pause</span><br><span class="line">objection -g com.android.settings explore </span><br><span class="line">memory list modules   可以看到libnative-lib.so已经被加载</span><br><span class="line">memory list exports libnative-lib.so 找到两个函数名_Z8method01P7_JNIEnvP7_jclassP8_jstring，_Z8method02P7_JNIEnvP8_jobjectP8_jstring</span><br><span class="line"></span><br><span class="line">var modulelibnative &#x3D;  Module.load(&quot;&#x2F;data&#x2F;app&#x2F;libnative-lib.so&quot;)  &#x2F;&#x2F; 加载so</span><br><span class="line">method01addr &#x3D; modulelibnative.findExportByName(&quot;_Z8method01P7_JNIEnvP7_jclassP8_jstring&quot;)</span><br><span class="line">method02addr &#x3D; modulelibnative.findExportByName(&quot;_Z8method02P7_JNIEnvP8_jobjectP8_jstring&quot;)</span><br><span class="line"></span><br><span class="line">修改init.py中pid &#x3D; device.spawn([&quot;com.android.settings&quot;])</span><br></pre></td></tr></table></figure><p>RPC（TCP） 远快于 HTTP,手机暴露frida-server，它是一个TCP，效率很高</p><h1 id="自吐算法摘要"><a href="#自吐算法摘要" class="headerlink" title="自吐算法摘要"></a>自吐算法摘要</h1><p>adb install HookTestDemo.apk</p><p>jadx-gui HookTestDemo.apk</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210505213048601.png" alt="image-20210505213048601"></p><p>frida -UF -l hookEvent.js  所有点击事件hook，发现所有触发类都是MainActivity</p><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210505213005214.png" alt="image-20210505213005214"></p><h2 id="普通方法"><a href="#普通方法" class="headerlink" title="普通方法"></a>普通方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">case R.id.putong &#x2F;*&#123;ENCODED_INT: 2131165291&#125;*&#x2F;:</span><br><span class="line">    toastPrint(Utils.getCalc(2000, 2000) + BuildConfig.FLAVOR);</span><br><span class="line">    toastPrint(new Money.innerClass(&quot;资源吧&quot;, 666).outPrint());</span><br><span class="line">    return;</span><br><span class="line"></span><br><span class="line">static class innerClass &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int num;</span><br><span class="line"></span><br><span class="line">    public innerClass(String name2, int num2) &#123;</span><br><span class="line">        this.name &#x3D; name2;</span><br><span class="line">        this.num &#x3D; num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String outPrint() &#123;</span><br><span class="line">        return &quot;内部类被调用&quot; + this.name + &quot;: &quot; + this.num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>objection探索一波，枚举不准的话，延迟加载，每个按钮都点一次触发类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.xiaojianbang.app explore -P ~&#x2F;.objection&#x2F;plugins </span><br><span class="line">android hooking search classes com.xiaojianbang.app  找不到Money类</span><br><span class="line">android hooking list classes  </span><br><span class="line">cat ~&#x2F;.objection&#x2F;objection.log | grep -i &quot;com.xiaojianbang.app&quot;</span><br><span class="line">plugin wallbreaker classdump --fullname com.xiaojianbang.app.Money</span><br><span class="line">android heap search instances com.xiaojianbang.app.MainActivity</span><br><span class="line">.&#x2F;fs1426arm64</span><br></pre></td></tr></table></figure><p>hook主动调用内部类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">var MainActivity &#x3D; null;</span><br><span class="line"></span><br><span class="line">Java.perform(function () &#123;</span><br><span class="line">    Java.choose(&quot;com.xiaojianbang.app.MainActivity&quot;, &#123;</span><br><span class="line">        onMatch: function (instanse) &#123;</span><br><span class="line">            MainActivity &#x3D; instanse;</span><br><span class="line">            console.log(&quot;found instance &#x3D;&gt; &quot;, MainActivity);</span><br><span class="line">        &#125;, onComplete: function () &#123;</span><br><span class="line">            console.log(&quot;search completed!&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">function showToast(string) &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">    &#x2F;&#x2F; UI thread 注入</span><br><span class="line">        var Toast &#x3D; Java.use(&#39;android.widget.Toast&#39;);</span><br><span class="line">        var currentApplication &#x3D; Java.use(&#39;android.app.ActivityThread&#39;).currentApplication();</span><br><span class="line">        var context &#x3D; currentApplication.getApplicationContext();</span><br><span class="line">&#x2F;&#x2F; 在线程上运行指定的函数  </span><br><span class="line">        Java.scheduleOnMainThread(function () &#123;</span><br><span class="line">            Toast.makeText(context, string, Toast.LENGTH_LONG.value).show();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function invokeNormal() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        &#x2F;&#x2F; 静态内部函数</span><br><span class="line">        var MoneyInnerClass &#x3D; Java.use(&quot;com.xiaojianbang.app.Money$innerClass&quot;).$new(javaString.$new(&quot;J&quot;), 666).outPrint();</span><br><span class="line">        console.log(&quot;result &#x3D;&gt;&quot;, MoneyInnerClass)</span><br><span class="line">        showToast(javaString.$new(MoneyInnerClass))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>frida -UF -l hookxjb.js</p><p>[Pixel::HookTestDemo]-&gt; result =&gt; 内部类被调用J: 666</p><h2 id="构造实例方法"><a href="#构造实例方法" class="headerlink" title="构造实例方法"></a>构造实例方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">case R.id.gouzao &#x2F;*&#123;ENCODED_INT: 2131165257&#125;*&#x2F;:</span><br><span class="line">    if (money &#x3D;&#x3D; null) &#123;</span><br><span class="line">        money &#x3D; new Money(&quot;美元&quot;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    toastPrint(&quot;money: &quot; + money.getInfo());</span><br><span class="line">    toastPrint(Utils.getMoney().getInfo());</span><br><span class="line">    toastPrint(new Money().name());</span><br><span class="line">    </span><br><span class="line">public String name() &#123;</span><br><span class="line">    return &quot;my name is xiaojianbang&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>frida -UF -l hookxjb.js</p><p>invokeInit()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function invokeInit() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        var MoneyName &#x3D; Java.use(&quot;com.xiaojianbang.app.Money&quot;).$new().name();</span><br><span class="line">        showToast(javaString.$new(MoneyName))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="重载方法"><a href="#重载方法" class="headerlink" title="重载方法"></a>重载方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">case R.id.chongzai &#x2F;*&#123;ENCODED_INT: 2131165233&#125;*&#x2F;:</span><br><span class="line">    toastPrint(Utils.test(666));</span><br><span class="line">    toastPrint(Utils.test());</span><br><span class="line">    toastPrint(Utils.test(new Money(&quot;港币&quot;, 7000)));</span><br><span class="line">    toastPrint(new Money() &#123;</span><br><span class="line">        &#x2F;* class com.xiaojianbang.app.MainActivity.AnonymousClass1 *&#x2F;</span><br><span class="line"></span><br><span class="line">        @Override &#x2F;&#x2F; com.xiaojianbang.app.Money</span><br><span class="line">        public String getInfo() &#123;</span><br><span class="line">            return &quot;匿名类被调用&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.getInfo());</span><br><span class="line">    return;</span><br><span class="line"></span><br><span class="line">public static String test(int num) &#123;</span><br><span class="line">    return &quot;www.zygx8.com &quot; + num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>android hooking list class_methods com.xiaojianbang.app.Utils</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function invokeOverload() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">    &#x2F;&#x2F; 静态重载方法</span><br><span class="line">        var result &#x3D; Java.use(&quot;com.xiaojianbang.app.Utils&quot;).test(666);</span><br><span class="line">        console.log(&quot;invoke overload result is &#x3D;&gt; &quot;, result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>frida -UF -l hookxjb.js</p><p>invokeOverload()</p><h2 id="对象参数"><a href="#对象参数" class="headerlink" title="对象参数"></a>对象参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">case R.id.duixiang &#x2F;*&#123;ENCODED_INT: 2131165247&#125;*&#x2F;:</span><br><span class="line">    toastPrint(Utils.test(new Money(&quot;美元&quot;, 200)));</span><br><span class="line">    toastPrint(new Utils().myPrint(new String[]&#123;&quot;资源共享吧&quot;, &quot;官网&quot;, &quot;:&quot;, &quot;www.zygx8.com&quot;&#125;));</span><br><span class="line">    return;</span><br><span class="line"></span><br><span class="line">public static String test(Money money) &#123;</span><br><span class="line">    return money.getInfo();</span><br><span class="line">&#125;</span><br><span class="line">public String myPrint(String[] strArr) &#123;</span><br><span class="line">    StringBuilder sb &#x3D; new StringBuilder();</span><br><span class="line">    for (String str : strArr) &#123;</span><br><span class="line">        sb.append(str);</span><br><span class="line">    &#125;</span><br><span class="line">    return sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>frida -UF -l hookxjb.js</p><p>invokeOverload()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function invokeObject() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        var newMoney &#x3D; Java.use(&quot;com.xiaojianbang.app.Money&quot;).$new(javaString.$new(&quot;dollar&quot;), 200);</span><br><span class="line">        var result &#x3D; Java.use(&quot;com.xiaojianbang.app.Utils&quot;).test(newMoney);</span><br><span class="line">        showToast(javaString.$new(result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        var StringArray &#x3D; Java.array(&quot;java.lang.String&quot;, [javaString.$new(&quot;J  &quot;), javaString.$new(&quot;you are the &quot;), javaString.$new(&quot;best &quot;)])</span><br><span class="line">        var result &#x3D; Java.use(&quot;com.xiaojianbang.app.Utils&quot;).$new().myPrint(StringArray);</span><br><span class="line">        showToast(javaString.$new(result))</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Native"><a href="#Native" class="headerlink" title="Native"></a>Native</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">case R.id.helloFromC &#x2F;*&#123;ENCODED_INT: 2131165260&#125;*&#x2F;:</span><br><span class="line">    toastPrint(NativeHelper.helloFromC());</span><br><span class="line">    return;</span><br><span class="line">case R.id.add &#x2F;*&#123;ENCODED_INT: 2131165218&#125;*&#x2F;:</span><br><span class="line">    toastPrint(NativeHelper.add(5, 6, 7) + BuildConfig.FLAVOR);</span><br><span class="line">    return;    </span><br><span class="line">public static native String helloFromC();    </span><br><span class="line">public static native int add(int i, int i2, int i3);</span><br></pre></td></tr></table></figure><p>frida -UF -l hookxjb.js</p><p>invokeNative()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function invokeNative() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">        var result &#x3D; Java.use(&quot;com.xiaojianbang.app.NativeHelper&quot;).helloFromC();</span><br><span class="line">        showToast(javaString.$new(result));</span><br><span class="line"></span><br><span class="line">        result &#x3D; Java.use(&quot;com.xiaojianbang.app.NativeHelper&quot;).add(100, 200, 300);</span><br><span class="line">        showToast(javaString.$new(String(result)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">case R.id.JavaMD5 &#x2F;*&#123;ENCODED_INT: 2131165191&#125;*&#x2F;:</span><br><span class="line">    toastPrint(MD5.md5_1(&quot;xiaojianbang&quot;));</span><br><span class="line">    return;</span><br><span class="line">public static String md5_1(String args) throws Exception &#123;</span><br><span class="line">    MessageDigest md &#x3D; MessageDigest.getInstance(&quot;MD5&quot;, &quot;BC&quot;);</span><br><span class="line">    md.update(args.getBytes());</span><br><span class="line">    return Utils.byteToHexString(md.digest());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hook类java.security.MessageDigest中所有的方法包括md5</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function hookMD5() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var targetClassMethod &#x3D; &quot;java.security.MessageDigest.getInstance&quot;</span><br><span class="line">        var delim &#x3D; targetClassMethod.lastIndexOf(&quot;.&quot;);</span><br><span class="line">        if (delim &#x3D;&#x3D;&#x3D; -1) return;</span><br><span class="line">        var targetClass &#x3D; targetClassMethod.slice(0, delim)</span><br><span class="line">        var targetMethod &#x3D; targetClassMethod.slice(delim + 1, targetClassMethod.length)</span><br><span class="line">        var hook &#x3D; Java.use(targetClass);</span><br><span class="line">        var overloadCount &#x3D; hook[targetMethod].overloads.length;</span><br><span class="line">        var overloadCount &#x3D; hook[targetMethod].overloads.length;</span><br><span class="line">        for (var i &#x3D; 0; i &lt; overloadCount; i++) &#123;</span><br><span class="line">            hook[targetMethod].overloads[i].implementation &#x3D; function () &#123;</span><br><span class="line">                console.warn(&quot;\n*** entered &quot; + targetClassMethod);</span><br><span class="line">                &#x2F;&#x2F; print args</span><br><span class="line">                if (arguments.length &gt;&#x3D; 0) &#123;</span><br><span class="line">                    for (var j &#x3D; 0; j &lt; arguments.length; j++) &#123;</span><br><span class="line">                        console.log(&quot;arg[&quot; + j + &quot;]: &quot; + arguments[j]);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                var retval &#x3D; this[targetMethod].apply(this, arguments);</span><br><span class="line">                console.log(&quot;\nretval: &quot; + retval);</span><br><span class="line">                console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">                return retval;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/02/16/%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8java%E5%8F%8Anative%E5%B1%82/image-20210505224433551.png" alt="image-20210505224433551"></p><ul><li><a href="https://bbs.pediy.com/thread-266021.htm" target="_blank" rel="noopener">IDA从入门到理解</a></li><li><a href="https://bbs.pediy.com/thread-266013.htm" target="_blank" rel="noopener">某加固系统运行信息获取frida 脚本</a></li><li><a href="https://www.52pojie.cn/thread-1367840-1-1.html" target="_blank" rel="noopener">unidbg学习笔记</a></li><li><a href="https://mp.weixin.qq.com/s/GCTPZ4IZlih7plHowoYADQ" target="_blank" rel="noopener">浅谈渗透江湖之细水柔情</a></li><li><a href="https://www.freebuf.com/articles/system/190565.html" target="_blank" rel="noopener">领悟Frida的精髓_0512newCodeAndProject.zip</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> rpc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于内存漫游定位分析</title>
      <link href="2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/"/>
      <url>2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<blockquote><p>三板斧：</p></blockquote><ul><li>先hook、看参数和返回值，利用命令行定位</li><li>再利用命令行/写代码构造参数、主动调用</li><li>最后规模化利用PYTHON配RPC导出结果</li></ul><h1 id="基于内存漫游定位"><a href="#基于内存漫游定位" class="headerlink" title="基于内存漫游定位"></a>基于内存漫游定位</h1><h2 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h2><p>adb install -r -t movetv.apk  移动tv  onejane/123456,-r强制升级，-t允许装debug版本</p><p>jadx打开发现com.tecent.StubShell加壳，找不到MainActivity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pyenv local 3.8.0</span><br><span class="line">adb shell</span><br><span class="line">.&#x2F;data&#x2F;local&#x2F;tmp&#x2F;fs128arm64</span><br><span class="line">objection -g com.cz.babySister explore</span><br><span class="line">android hooking search classes com.wrapper.proxyapplication</span><br><span class="line">android hooking watch class com.wrapper.proxyapplication.WrapperProxyApplication   该类在启动则被调用，attach将无法hook</span><br></pre></td></tr></table></figure><blockquote><p>Frida附加app的两种模式：</p></blockquote><ul><li>SPAWN：创建进程时就hook，有壳的话就不行</li><li>ATTACH：应用运行过程中hook，有壳也是ok</li></ul><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities</span><br><span class="line">android intent launch_activity com.cz.babySister.activity.LoginActivity  指定启动Activity</span><br><span class="line">ps -ef|grep baby  进程一直自动启动</span><br></pre></td></tr></table></figure><p><code>objection -d -g com.cz.babySister explore --startup-command &quot;android hooking watch class com.wrapper.proxyapplication.WrapperProxyApplication&quot; </code> 开启debug -d</p><p>由于该app会自动后台启动</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/attach%E8%BF%90%E8%A1%8C%E4%B8%ADhook.png" alt="attach运行中hook"></p><p>需要在前台启动时立即使用objection漫游</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/spawn%E8%B5%B7%E5%A7%8Bhook.png" alt="spawn起始hook"></p><h3 id="批量hook"><a href="#批量hook" class="headerlink" title="批量hook"></a>批量hook</h3><p>android hooking search classes com.wrapper.proxyapplication  枚举包中所有类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com.wrapper.proxyapplication.CustomerClassLoader</span><br><span class="line">com.wrapper.proxyapplication.MultiDex</span><br><span class="line">com.wrapper.proxyapplication.MultiDex$V19</span><br><span class="line">com.wrapper.proxyapplication.Util</span><br><span class="line">com.wrapper.proxyapplication.WrapperProxyApplication</span><br></pre></td></tr></table></figure><blockquote><p>如何使用objection去批量hook和trace？</p></blockquote><ol><li>把~/.objection/objection.log删掉； </li><li>到objection界面中运行android hooking list classes，列出所有的类； </li><li>对新生成的~/.objection/objection.log文件进行过滤，比如只关心http相关的。cat objection.log|grep -i http </li><li> 将输出结果保存到一个excel列中，前面补全android hooking watch class xxxxx，另存为文本文件</li><li>加载这个文件：objection -g com.android.settings explore -c “2.txt” ，这样一下子就hook上了几千个相关类的所有方法及其所有重载。 </li><li>如果trace感兴趣的方法也是同理，android hooking search methods * ，会打印出所有的方法。</li></ol><p>vim hooklist.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android hooking watch   class   com.wrapper.proxyapplication.CustomerClassLoader</span><br><span class="line">android hooking watch   class   com.wrapper.proxyapplication.MultiDex</span><br><span class="line">android hooking watch   class   com.wrapper.proxyapplication.MultiDex$V19</span><br><span class="line">android hooking watch   class   com.wrapper.proxyapplication.Util</span><br><span class="line">android hooking watch   class   com.wrapper.proxyapplication.WrapperProxyApplication</span><br></pre></td></tr></table></figure><p>objection -g com.cz.babySister explore -c “hooklist.txt”  批量hook</p><p>android hooking list class_methods com.wrapper.proxyapplication.Util  枚举类中所有方法</p><h4 id="Zentracer"><a href="#Zentracer" class="headerlink" title="Zentracer"></a>Zentracer</h4><p>adb shell &amp;&amp; top 根据负载查看包名</p><p>java.net.HttpUrlConnection</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore  --startup-command &quot;android hooking watch class java.net.HttpURLConnection&quot;</span><br><span class="line">jobs list</span><br><span class="line">jobs kill id</span><br><span class="line">android hooking watch class_method java.net.HttpURLConnection.getFollowRedirects --dump-args  登录发现堆栈来自于com.cz.babySister.c.a.a</span><br></pre></td></tr></table></figure><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/hookHttpURLConnection.png" alt="hookHttpURLConnection"></p><p>通过jadx搜索com.cz.babySister.c.a.a所在类，通过<code>android hooking watch class com.cz.babySister.c.a</code>进行trace类</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/hook%E7%B1%BB.png" alt="image-20210215230227148"></p><p>通过<code>android hooking watch class_method com.cz.babySister.c.a.a --dump-args --dump-backtrace --dump-return</code> 进行trace方法</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/hook%E6%96%B9%E6%B3%95.png" alt="image-20210215230705285"></p><blockquote><p>什么叫trace？hook多了就成了trace</p><p>系统框架是不可能被混淆的，基于枚举的内存漫游定位思路的含义是：怀疑你使用了什么框架API、怀疑你经过了哪个包哪处地方、就去那里埋伏起来，等待经过。</p></blockquote><p>针对混淆后的okhttp3,通过Frida实现的拦截<a href="https://github.com/siyujie/OkHttpLogger-Frida.git" target="_blank" rel="noopener">okhttp脚本</a></p><p>./data/local/tmp/fs1428arm64</p><p>cd <a href="https://github.com/hluwa/ZenTracer.git" target="_blank" rel="noopener">ZenTracer</a> &amp;&amp; proxychains pip install PyQt5  &amp;&amp; python ZenTracer.py</p><blockquote><p>报错：Could not load the Qt platform plugin “xcb” in “” even though it was found</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export QT_DEBUG_PLUGINS&#x3D;1</span><br></pre></td></tr></table></figure><p>python ZenTracer.py      </p></blockquote><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF.png" alt="报错信息"></p><blockquote><p>ldd libqxcb.so  查看具体哪个so文件为not found </p><p>apt install libxcb-util1 libxcb-xinerama0</p></blockquote><p>Action-Match RegEx</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/%E6%B7%BB%E5%8A%A0%E5%8C%B9%E9%85%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F.png" alt="添加匹配表达式"></p><p>Action-Start  启动trace,登录trace保存为json</p><p>thunar .  打开当前目录 查看babySister查看json</p><p><strong>极端情况</strong>：Match RegEx 填写com.cz.babySister主包名，trace所有的方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.cz.babySister explore</span><br><span class="line">android hooking search classes com.cz.babySister</span><br><span class="line">cat ~&#x2F;.objection&#x2F;objection.log|grep com.cz.babySister  拿到所有的类 在前面添加命令 android hooking watch class保存到classes.txt中</span><br><span class="line">objection -g com.cz.babySister explore -c classes.txt  实现批量hook</span><br></pre></td></tr></table></figure><h2 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h2><p>adb install xes.apk</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.xes.jazhanghui.activity explore -P ~&#x2F;.objection&#x2F;plugins  启动objection加载所有插件</span><br><span class="line">android hooking search classes okhttp3</span><br><span class="line">android hooking list class_methods okhttp3.OkHttpClient</span><br><span class="line">android heap search instances okhttp3.OkHttpClient  找到对象实例</span><br><span class="line">plugin wallbreaker objectsearch okhttp3.OkHttpClient   拿到ok3对象的地址，如混淆在jadx中找到ok3的类注释中的rename</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x37d2</span><br></pre></td></tr></table></figure><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/wallbreaker%E6%8B%BF%E5%88%B0%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E7%BB%93%E6%9E%84.png" alt="wallbreaker拿到对象属性结构"></p><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>adb push okhttplogging.dex /data/local/tmp</p><p>adb push myok2curl.dex /data/local/tmp</p><p>cd ~/Desktop/frida-agent-example &amp;&amp; npm run watch</p><p>frida -UF -l  <a href="https://onejane.gitee.io/picture/hookOkhttp3.js" target="_blank" rel="noopener">hookOkhttp3.js</a>  通过adb logcat | grep “okhttpGet”查看log</p><p>原生：离解释器更近：安卓原生就是dex被libart.so来解释、linux原生就是CPU直接解释的机器码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -e |grep -i chrome</span><br><span class="line">objection -g com.android.chrome explore</span><br><span class="line">memory list modules   发现dex被libart.so加载解析执行</span><br></pre></td></tr></table></figure><h3 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h3><p><strong><a href="https://github.com/hanbinglengyue/FART/raw/master/frida_fart.zip" target="_blank" rel="noopener">frida_fart</a></strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd frida_fart &amp;&amp; adb push lib&#x2F;* &#x2F;data&#x2F;local&#x2F;tmp</span><br><span class="line">cd &#x2F;data&#x2F;local&#x2F;tmp&#x2F; &amp;&amp; cp fart* &#x2F;data&#x2F;app &amp;&amp; cd &#x2F;data&#x2F;app &amp;&amp; chmod 777 fart*   加权限</span><br></pre></td></tr></table></figure><p>修改源码dex保存路径：var savepath = “/sdcard/com.cz.babySister.activity/“;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;sdcard&#x2F;com.cz.babySister.activity&#x2F; </span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_reflection.js --no-pause</span><br><span class="line">frida -UF -l frida_fart_reflection.js</span><br><span class="line">frida -U -f com.cz.babySister -l frida_fart_hook.js --no-pause  基于安卓8，生成dex</span><br></pre></td></tr></table></figure><p><a href="https://github.com/hluwa/FRIDA-DEXDump.git" target="_blank" rel="noopener"><strong>frida-dexdump</strong></a></p><p>核心原理：进程级别的内存漫游</p><p>cd ~/.objection/plugins/<a href="https://github.com/hluwa/FRIDA-DEXDump.git" target="_blank" rel="noopener">dexdump</a> &amp;&amp; python main.py  自动脱壳(前台运行的学而思app)</p><p>cd com.xes.jazhanghui.activity &amp;&amp; grep  -ril “okhttp3.OkHttpClient” *</p><p>du -h *  查看文件最大的dex使用jadx打开</p><p>objection -g com.xes.jazhanghui.activity explore -P ~/.objection/plugins</p><p>android hooking list activities  在jadx中查找到dex包含<code>com.xes.jazhanghui.activity.mvp.live.activity.LiveMainActivity</code></p><p>同理：脱壳移动TV，grep -ril “MainActivity” *,grep -ril “LoginActivity” *,找到唯一入口dex</p><h2 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a>案例三</h2><p>adb install 免费电影院v2.1.0_210.apk</p><h3 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3><p>静态：通过jadx搜索OkHttpClient,或者<code>apktool d 免费电影院v2.1.0_210.apk &amp;&amp; grep -ril &quot;OkHttpClient&quot; *</code></p><p>动态：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat smali&#x2F;فمضﺝ&#x2F;ﻙﺫتك$ﺯﺵتﻝ.smali</span><br><span class="line">拿到.class public Lفمضﺝ&#x2F;ﻙﺫتك;类名</span><br><span class="line">objection -g com.singleman.freevideo explore -P &#x2F;root&#x2F;.objection&#x2F;plugins   点击登录调用ok3</span><br><span class="line">plugin wallbreaker objectsearch فمضﺝ.ﻙﺫتك</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x2452  查看该类是否ok3Client，获取其中List&lt;Interceptor&gt;地址，用wallbreaker dump下来class为Collections$UnmodifiableRandomAccessList 即为OkHttpClient类</span><br></pre></td></tr></table></figure><p>在hookOkhttp3.js中实现hook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Java.choose(&quot;فمضﺝ.ﻙﺫتك&quot;,&#123;</span><br><span class="line">    onMatch:function(instance)&#123;</span><br><span class="line">        console.log(&quot;1. found instance:&quot;,instance)</span><br><span class="line">        &#x2F;&#x2F;console.log(&quot;2. instance.interceptors():&quot;,instance.interceptors().$className)</span><br><span class="line">        console.log(&quot;3. instance._interceptors:&quot;,instance.ﻭﻍﺫﻉ.value.$className)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F;console.log(&quot;4. interceptors:&quot;,gson2.$new().toJson(instance.interceptors())) </span><br><span class="line">        console.log(&quot;5. interceptors:&quot;,Java.use(&quot;java.util.Arrays&quot;).toString(instance.ﻭﻍﺫﻉ.value.toArray()))</span><br><span class="line">        &#x2F;*</span><br><span class="line">        var newInter &#x3D; Java.use(&quot;java.util.ArrayList&quot;).$new();</span><br><span class="line">        newInter.addAll(instance.interceptors());</span><br><span class="line">        console.log(&quot;6. interceptors:&quot;,Java.use(&quot;java.util.Arrays&quot;).toString(newInter.toArray()));</span><br><span class="line">        console.log(&quot;7. interceptors:&quot;,newInter.$className);</span><br><span class="line">        newInter.add(MyInterceptorObj);</span><br><span class="line">        newInter.add(curlInter);</span><br><span class="line">        instance._interceptors.value &#x3D; newInter;</span><br><span class="line">        *&#x2F;</span><br><span class="line">        </span><br><span class="line">    &#125;,onComplete:function()&#123;</span><br><span class="line">        console.log(&quot;Search complete!&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="基于Frida的Hook"><a href="#基于Frida的Hook" class="headerlink" title="基于Frida的Hook"></a>基于Frida的Hook</h1><h2 id="案例一-1"><a href="#案例一-1" class="headerlink" title="案例一"></a>案例一</h2><p>adb install -r -t <a href="https://github.com/aqi00/android2.git" target="_blank" rel="noopener">junior.apk</a> 开启远程调用<code>frida -UF -l demo.js</code></p><h3 id="像素显示dip2px"><a href="#像素显示dip2px" class="headerlink" title="像素显示dip2px"></a>像素显示dip2px</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">objection -g com.example.junior explore -P ~&#x2F;.objection&#x2F;plugins  加载所有插件</span><br><span class="line">android hooking list activities 查看用于展示的界面</span><br><span class="line">android intent launch_activity com.example.junior.CalculatorActivity  启动计算器界面</span><br><span class="line">cat objection.log | grep com.example.junior.util.Utils</span><br><span class="line">android hooking list class_methods com.example.junior.util.Utils   打印来中所有可hook的函数</span><br><span class="line">android hooking watch class_method com.example.junior.util.Utils.dip2px --dump-args --dump-return --dump-backtrace  hook方法并打印像素显示出入参与调用栈</span><br><span class="line">function main() &#123;</span><br><span class="line">    Java.perform(function () &#123;&#x2F;&#x2F;只要是java的代码都要跑在Java.perform里面</span><br><span class="line">        console.log(&quot;Entering Hook!&quot;)</span><br><span class="line">        Java.use(&quot;com.example.junior.util.Utils&quot;).dip2px.implementation &#x3D; function (context, float) &#123;</span><br><span class="line">            &#x2F;&#x2F;return null;</span><br><span class="line">            var result &#x3D; this.dip2px(context, 100)</span><br><span class="line">            console.log(&quot;context,float,result  &#x3D;&#x3D;&gt; &quot;, context, float, result);</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            return 26;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="分辨率显示setText"><a href="#分辨率显示setText" class="headerlink" title="分辨率显示setText"></a>分辨率显示setText</h3><p>hook用不上Java.choose的，hook函数时不分动静态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">android intent launch_activity com.example.junior.ScreenActivity </span><br><span class="line">cat objection.log|grep -i android.widget.TextView</span><br><span class="line">android hooking list class_methods android.widget.TextView  打印来中所有可hook的函数</span><br><span class="line">android hooking watch class_method android.widget.TextView.setText --dump-args --dump-backtrace --dump-return  hook公共方法setText</span><br><span class="line">android heap search instances com.example.junior.ScreenActivity 搜索activity类内存地址</span><br><span class="line">android heap execute 0x6f72 showScreenInfo  主动调用该类的指定方法，frida端hook自动执行</span><br><span class="line">function Screen() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        &#x2F;&#x2F; 重载</span><br><span class="line">        Java.use(&quot;android.widget.TextView&quot;).setText.overload(&#39;java.lang.CharSequence&#39;).implementation &#x3D; function (text) &#123;</span><br><span class="line"></span><br><span class="line">            var javaString &#x3D; Java.use(&quot;java.lang.String&quot;);</span><br><span class="line">            var newString &#x3D; javaString.$new(&quot;onejane&quot;)</span><br><span class="line"></span><br><span class="line">            var result &#x3D; null;</span><br><span class="line">            var realText &#x3D; String(text);</span><br><span class="line">            console.log(&quot;real text is &#x3D;&#x3D;&gt; &quot;,realText);</span><br><span class="line">            if (realText.indexOf(&quot;junior&quot;) &gt;&#x3D; 0) &#123;</span><br><span class="line">                var result &#x3D; this.setText(newString);</span><br><span class="line">                console.log(&quot;text,result &#x3D;&#x3D;&gt; &quot;, newString, result);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                var result &#x3D; this.setText(text);</span><br><span class="line">                console.log(&quot;text,result &#x3D;&#x3D;&gt; &quot;, text, result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cat objection.log|grep -i com.example.junior.util.Arith</span><br><span class="line">android hooking list class_methods com.example.junior.util.Arith  查看Arith类有哪些hook的方法</span><br><span class="line">android hooking watch class_method com.example.junior.util.Arith.sub --dump-args --dump-backtrace --dump-return   hook静态方法sub</span><br><span class="line"></span><br><span class="line">function Equals()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;java.lang.String&quot;).equals.implementation &#x3D; function(obj)&#123;</span><br><span class="line">            var result &#x3D; this.equals(obj);</span><br><span class="line">            console.log(&quot;obj,result &#x3D;&#x3D;&gt; &quot;,obj,result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function sub()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;com.example.junior.util.Arith&quot;).sub.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function(str1,str2)&#123;</span><br><span class="line">            </span><br><span class="line">            var javaString &#x3D; Java.use(&quot;java.lang.String&quot;)</span><br><span class="line">            var result &#x3D; this.sub(str1,javaString.$new(&quot;2&quot;));  &#x2F;&#x2F; 本质上属于主动调用构造函数</span><br><span class="line">            console.log(&quot;str1,str2,result&#x3D;&#x3D;&gt;&quot;,str1,str2,result)</span><br><span class="line">            return javaString.$new(&quot;10&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h4><p>运行junior的计算器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker classsearch Arith  内存漫游搜索Arith类</span><br><span class="line">plugin wallbreaker classdump --fullname com.example.junior.util.Arith 将Arith类dump发现有静态变量</span><br></pre></td></tr></table></figure><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F.png" alt="静态变量"></p><p>通过frida获取静态变量DEF_DIV_SCALE并修改值为20，内存中的静态变量DEF_DIV_SCALE即变为20</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function staticField()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var divscale &#x3D; Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value;</span><br><span class="line">        console.log(&quot;divscale1 is &#x3D;&gt;&quot;,divscale);</span><br><span class="line">        Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value&#x3D;20;</span><br><span class="line">        divscale &#x3D; Java.use(&quot;com.example.junior.util.Arith&quot;).DEF_DIV_SCALE.value;</span><br><span class="line">        console.log(&quot;divscale2 is &#x3D;&gt;&quot;,divscale);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="静态主动调用"><a href="#静态主动调用" class="headerlink" title="静态主动调用"></a>静态主动调用</h4><p><code>frida -UF -l demo.js</code>主动调用Arith.add方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function operate()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var Arith &#x3D; Java.use(&quot;com.example.junior.util.Arith&quot;);</span><br><span class="line">        console.log(&quot;addResult is &#x3D;&gt;&quot;,Arith.add(&quot;1&quot;,&quot;1&quot;));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>plugin wallbreaker classsearch Build</code>  搜索含有Build的类</p><p><code>plugin wallbreaker classdump --fullname android.os.Build</code>  将Build类dump下来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function fingerPrint()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var Build &#x3D; Java.use(&quot;android.os.Build&quot;);</span><br><span class="line">        console.log(Build.DEVICE.value,Build.ID.value,Build.MODEL.value,Build.SERIAL.value);</span><br><span class="line">        Build.SERIAL.value &#x3D; &#39;F123456&#39;;</span><br><span class="line">        console.log(Build.SERIAL.value,Build.getSerial());   &#x2F;&#x2F; 若app无权限getSerial()，换设置重新主动调用</span><br><span class="line">        console.log(&#39;sdk is &#39;,Build.getString(&quot;ro.build.version.sdk&quot;));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态变量"><a href="#动态变量" class="headerlink" title="动态变量"></a>动态变量</h4><p><code>plugin wallbreaker objectsearch com.example.junior.CalculatorActivity</code>  获取该类地址</p><p><code>plugin wallbreaker objectdump 0x1eea</code> 计算1+2=3后查看该类的动态变量</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/%E5%8A%A8%E6%80%81%E5%8F%98%E9%87%8F.png" alt="动态变量"></p><p>寻找CalculatorActivity实例，通过frida动态hook，通过修改showText值时内存中变量变为123</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function dynamicField()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.junior.CalculatorActivity&quot;,&#123; </span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance &#x3D;&gt;&quot;,instance);</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.showText.value)</span><br><span class="line">                instance.showText.value &#x3D; &quot;123&quot;</span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&#39;Search complete&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态主动调用"><a href="#动态主动调用" class="headerlink" title="动态主动调用"></a>动态主动调用</h4><p>动态调用有参函数，计算机显示666，打印666</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function dynamic()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.junior.CalculatorActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance &#x3D;&gt;&quot;,instance);</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.clear(&quot;666&quot;))</span><br><span class="line">                console.log(&quot;instance showText is &#x3D;&gt;&quot;,instance.showText.value)</span><br><span class="line">            &#125;,onComplete:function()&#123;</span><br><span class="line">                console.log(&#39;Search complete&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RPC调用"><a href="#RPC调用" class="headerlink" title="RPC调用"></a>RPC调用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import frida</span><br><span class="line"></span><br><span class="line"># device&#x3D;frida.get_device_manager().add_remote_device(&#39;192.168.0.100:5555&#39;)  远程连接.&#x2F;fs128arm64 -l 0.0.0.0:5555,可定义多个device实现批量自动化群控</span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line"></span><br><span class="line">### attach</span><br><span class="line">pid&#x3D;device.get_frontmost_application().pid  # 若双进程保护，指定pid进行hook</span><br><span class="line">session &#x3D; device.attach(pid)</span><br><span class="line"></span><br><span class="line">### spawn </span><br><span class="line">#pid &#x3D; device.spawn([&quot;com.example.junior&quot;])</span><br><span class="line">#device.resume(pid)</span><br><span class="line">#time.sleep(1)</span><br><span class="line">#session &#x3D; device.attach(pid)</span><br><span class="line"></span><br><span class="line">with open(&quot;demo.js&quot;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.load()</span><br><span class="line">input()</span><br></pre></td></tr></table></figure><h3 id><a href="#" class="headerlink" title></a></h3><h4 id="键盘操作"><a href="#键盘操作" class="headerlink" title="键盘操作"></a>键盘操作</h4><p>input keyevent 4 表示后退</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function subcommand()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;&#x2F; adb input api</span><br><span class="line">        var process &#x3D; Java.use(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;input keyevent 4&#39;);</span><br><span class="line">        console.log(&#39;subcommand success process is &#39;, process)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>循环调用</strong></p><p>demo.js中导出指定方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">    subcommand: subcommand</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demo.py中开启循环</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">command &#x3D; &quot;&quot;</span><br><span class="line">while 1 &#x3D;&#x3D; 1:</span><br><span class="line">    command &#x3D; input(&quot;Enter command:\n1: Exit\n2: Call secret function\nchoice:&quot;)</span><br><span class="line">    if command &#x3D;&#x3D; &quot;1&quot;:</span><br><span class="line">        break</span><br><span class="line">    elif command &#x3D;&#x3D; &quot;2&quot;: # 在这里调用，可以设置多个条件判断</span><br><span class="line">        script.exports.subcommand()</span><br></pre></td></tr></table></figure><p>输入2对当前进程持续后退</p><h2 id="案例二-1"><a href="#案例二-1" class="headerlink" title="案例二"></a>案例二</h2><p>利用nps实现启动了frida-server和nps-client的device的内网穿透，真正意义上实现批量自动化群控</p><h3 id="案例三-1"><a href="#案例三-1" class="headerlink" title="案例三"></a>案例三</h3><p>利用ssr通过nps内网穿透实现4G作为出口ip代理供request/scrapy调用</p><blockquote><p>objection和frida不可同时hook一个函数,</p></blockquote><p><strong>hook Non-ASCII</strong></p><p>对于有些混淆后不可见或乱码的函数名，可以先编码打印出来, 再用编码后的字符串去 hook.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(</span><br><span class="line">    function x() &#123;</span><br><span class="line"></span><br><span class="line">        var targetClass &#x3D; &quot;com.example.hooktest.MainActivity&quot;;</span><br><span class="line"></span><br><span class="line">        var hookCls &#x3D; Java.use(targetClass);</span><br><span class="line">        var methods &#x3D; hookCls.class.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">        for (var i in methods) &#123;</span><br><span class="line">            console.log(methods[i].toString());</span><br><span class="line">            console.log(encodeURIComponent(methods[i].toString().replace(&#x2F;^.*?\.([^\s\.\(\)]+)\(.*?$&#x2F;, &quot;$1&quot;)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hookCls[decodeURIComponent(&quot;%D6%8F&quot;)]</span><br><span class="line">            .implementation &#x3D; function (x) &#123;</span><br><span class="line">                console.log(&quot;original call: fun(&quot; + x + &quot;)&quot;);</span><br><span class="line">                var result &#x3D; this[decodeURIComponent(&quot;%D6%8F&quot;)](900);</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>hook Intent</strong></p><p>MainActivity中<code>Intent intent2 = new Intent(this, Class.forName(&quot;com.shimeng.qq2693533893.MyServiceOne&quot;));</code>我们通过frida打印Intent</p><p><img src="/2021/02/12/%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E6%BC%AB%E6%B8%B8%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90/%E6%89%93%E5%8D%B0Intent.png" alt="frida打印Intent"></p><p>参考资料：</p><ul><li><p><a href="https://mp.weixin.qq.com/s/tI89U6eht0F_KrMJXooo1A" target="_blank" rel="noopener"><strong>Android App 保护那些事儿 （一）</strong></a></p></li><li><p><strong><a href="https://mp.weixin.qq.com/s/DkpQ_71Gt-jkwOuRU1Mv0A" target="_blank" rel="noopener">Android App 保护那些事儿 (二)</a></strong></p></li><li><p><strong><a href="https://github.com/xiaokanghub/Android" target="_blank" rel="noopener">frida dexclassloader</a></strong></p></li><li><p><strong><a href="https://bbs.pediy.com/thread-260523.htm" target="_blank" rel="noopener">从三道题目入手入门frida</a></strong></p></li><li><p><strong><a href="https://bbs.pediy.com/thread-260536.htm" target="_blank" rel="noopener">Frida 入门小练习</a></strong></p></li><li><p><strong><a href="https://bbs.pediy.com/thread-260550.htm" target="_blank" rel="noopener">举杯邀Frida，对影成三题</a></strong></p></li><li><p><strong><a href="https://bbs.pediy.com/thread-247680.htm" target="_blank" rel="noopener">Null混淆</a></strong></p></li><li><p><a href="https://mp.weixin.qq.com/s/SRv1Oar87w1iKuDXS4oaew" target="_blank" rel="noopener"><strong>Android 字符串及字典混淆开源实现</strong></a></p></li><li><p><a href="https://github.com/shwenzhang/AndResGuard" target="_blank" rel="noopener"><strong>资源压缩</strong></a></p></li><li><p><strong><a href="https://bbs.pediy.com/thread-258213.htm" target="_blank" rel="noopener">Android微信逆向–实现发朋友圈动态</a></strong></p></li><li><p><a href="https://www.anquanke.com/post/id/207459" target="_blank" rel="noopener"><strong>微信朋友圈分析</strong></a></p></li><li><p><a href="https://www.anquanke.com/post/id/197670" target="_blank" rel="noopener"><strong>实用FRIDA进阶：脱壳、自动化、高频问题</strong></a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> objection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动静态分析之去弹窗重打包</title>
      <link href="2021/02/09/%E5%8A%A8%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%8E%BB%E5%BC%B9%E7%AA%97%E9%87%8D%E6%89%93%E5%8C%85/"/>
      <url>2021/02/09/%E5%8A%A8%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%B9%8B%E5%8E%BB%E5%BC%B9%E7%AA%97%E9%87%8D%E6%89%93%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ccc88f9e0a3c93dae2a1d4815f6f8c9c4f4aacf69c40fd42ef2c987746489b4b">bed62a02a779f7e345609aa4ca49afbbc43cab30019ebb9f2549355e5b4b78c29b1b86e383e3668dd684ad0b6db192cd941ac3b3525cb792c4df773e2520ce6abc1afeab155d30ece505a332561e46c6bd44eac28457a696ec0cc25a765b0b02c2e30e301d2d5dc1d442c72644677adce3dba6bf09ff88ee59433794542d3f77ae44e6d116b5a3f55542ef64d7822f2c1c0d2c903edd0ad568300a074dad77bab732aa0dee8b23d4a8c32d923ebd72bc7bcfa81cc7ccf61a1ed9900f84e9b69943ac586275ca4677c84d6dc331d04e750caf0784253166381d67b5a5eda1c17dc1836e223207fc282845a9b9f1af7b4811bef00362172a11f4cb85e879a757e8f7ebb744401d6de3a3b55cd0a50415f8f334e79c976f6f75d44cbe97cfc8144e2b44064bd9541934eba24f5f40a3059cb4259b89bdda525b098c1839926771410e4010056d22442bf066be4d15731caa925309f179d6cdbed2100cf822166d8f66f4050a8be731360d31ec59eff9924b5e517624e5e0a1b25d868b29ff052b77743aceca9db50957de077b93d0877392a74c3e114deef5b44c43b98dec24302a101864d371f7b53c7f662e306e15bcee7afea434ab8837ea7646d0b6bc4668dba6a434ca6124b71108df99da808f59253e6f53e10afc9b761fa6c5882c840bbc41012d7ff098948b2b55915fe2899e76ba2e9b31955c8db1c7e2c039fecc43f97546d19454091085bd41090f45b49a5c26a9df89ce8368c414c05d69fbad3090f0b610e39965f5e4af4daaad7906b0fd1ea27acac688b230d4b9344f5bcf198af3955b741afe19cd65256f1e6e1c7eb2eb6c8bc621ac0b2d05b5ec09937e8ff135e8b5c7a7d5d131654d1ba295a673ef4eaaf8454bf884a3b3eba1ec8c7569b97cf03e5538ed6f487c44e95da045e963129c78ca2274b76ccd2283238fe6523c5dc39eeff7879efa1f2572432c1580979118d30fdaabfabaee9e779759bab8bbff2274e5f9222c1d82d1166f2f1bb410a81fa9b065cfc86fe0f6ae554107debbeabdeaf27307d5aa49aeef5dab1ef45c185968451c77110b26c7b22e1702257646de4e1682bb429178e9a9da2da445b829cc0987e4e7013bbe99b4a712c83838acdc94762fc830891bde3430440ccb73150545ee6dd169b785dd0c19dafefc710cf31d633392a63bb5839650afc91185487f4ae81a25d8eb87291ed7f014f8968470819975a30cf4e326f15829414dfa51decab33f374306cb3e8bf4d3de3df6332eaf26bc1c2babf218884fdc499a20dda948c54281542b745f46be5eaa6da7cd58b2e384f93e9d095dbbeb39a6b23d2a22b775cf86d5e77b640b392a96ce4c4a9843c0a357674a3cae4cd09ae36e05ea28529fac30f3cb5e771b214fbc6b27ff8a69733b3b504ef7a58505e24297da1d9ed8e3bd7809b09cdffbe30e2aa8e5676a8760f2af10822b02bfd44e51bceda15633eff727c52ff2c2f5389a695a139471e0421a263a885fb0b2738217507595714943aaa375b099f2d34d9f657b698603bdaca5d1899266980a492e825172ac63239b15bb7f395433e8c24d8c53a8ae6e95ec4cbb7fe36d4d7f8a1de2d59f90aa3f441d9655a2505805058940b327d8f98789db5cec6632c1315ce312021622af1612a46bdefd46089e7a1e6e07cf96314a413de67b09f34a6763899d3afc973728b95d4e966c677f8224f8becea8572b146e088b6845de391b750b8cf68cc60ba12560d7d31ec94a722aa0542306d66957852108fc8767334804c651240a1bc075b6cb9f9ccf278d45ceff3f2dd0178e5791196bf2c73dd3fd82a70989495a4a4ebdba9323b5ea4c4c7e8d9e63595ecc6a2015f305fcc71d38955a9fdad4185a618b0e6551d2a280f64b5719dc67961be4f301453baec31b2e913296aebf72c09d2be6b9e96a0016039c1f8bad93944635048f3d094f82f698332d5ce05efdebf6b0a354ff0dc6363a2da25f4e0e8e20ffb54070a6b80ab716cabdcd5cedb7ad9a2544083394f2488554f7eb480dd506d6cd9c4e90b651a57744914b13ad192ae30a083281192e8351e3dd9dac125f39e29552c126c22f1fc51cc305477d08cde4205d9db33751bbf9a73184664757c5908b29d4a8597eafe55da192779e2167adef3a35a63d24fea819cc43118c6b7a3b4a7ccd81d1280a834b61b325773b76575652a79bbe1566826c7f49fb0e76d4fcc61fb0fdf96c849f9fc0f7aedd29173b0b315c187a2c1b6953ccf2833f20983863596fe7b101e5894c5507f75e5ae0687da8cb9629753b444a6bb4e076e0928e667beb8bd5a90156a0773adc43643cb7e7b950b5ca348db532d210ab53b47a1cec715425748c53413f5e77063410ea460c4c377bcf09f9550a00cdedfc4cf7bb4d8c82d9940a6a3fa174e283e3e746f63e78a9d86c787c0f0f6abd2f0ddf5a15b85a14d58c7bca6ccd1b1a6e27819ff5679ac6a6c6d909ccd84df2773759348f3e7c84aa2b92c3950c399e495bec19bf9cf20f546ef284819f4d0db77e99b3c6dfdbc778923d2ce4253d8ac6faec09430d651db583c5faebacc8ae0719648fc1bb481e478c26fbcc716ad60c582a66d90dcece697452608ce0e164ef3c6dfaae659f20fb8c61ac9e69a6a65f7407585933d2a2aa82f8366e4aaa02ac3b2254187908d99b756c851ddb98c1deab2c8bd28f77b360cf9c66c1068f70b638193a4a67083f2ba4ef838f8b934ece0dfd18b34bcec96b24940250b83763ef7ec6b3a9e80897e1754665dcbcc58b8ba6083dc4c5527c8e0fd1e6ffaa6418c7c55d99f9daae32ee42cc56eb4a4d74ea97c080a7896d64b6d96d886eeae6c04fe204116992a7a8cfe77e55ca616b4bfb5cde9e22776811fd5db16f9862b456b287529c963a221feb28640703c0318e7c1f39756d81a895d7ce124e4ee638f652855a37032fe5a2055667d681e60c69d6b6dfaa036b47f202e5e27af66c4de1fe971f879fe405f478847a0c255966420143b1aefd16241ca24c8c9516fe1ae2a96114023b8e6cf9e5815a86d5c78590bbf91e45b6cdf7977725ac762dcdfaaf02c3c75b6db8bace19c1cf3a0cea37c9caf6c290294729419986ed36ade1899868b9303d43ad3169b98e07aa1c495ee7e678159cc3d1b488bba21c5e97717505dfc479d3c0e999d10acdd17a545c536079d2291dfa0bcb9209d03fc3c47ac720a9420eec0abd0bd5957a8d9c1b2ab0df2ee8518e882cc3af586307987a892174ac68539f9ddc96249ab3ca3860ff87cf8ccf76806f46c2f9428f277e471261a30d01acdcf8d41970cc7d9a9e9411ab0a8af979b13e362d52dd6e6a4ca0df11dda03a35e2e9193b1ec588a9d6a9b375a33925f0e8b2baea57f77366e756998443d05105e541b731ba38dd2df500c6505c3c4e8c404cb8b67d4facf9209850a29504262624c94009225a217fb0a9d72ecef162135806a471e844cfc53c8e1ab1914ecbe616495e076f57680c6e8b3c860e20f481c91901307e5336a9c109b71cad5dc0c7dedfdbadc6011168410692e20c4f6085a7d26c598d3119e8021017ca61bb3ae5f8866260b85b577a9eb897ee954f7c8f7511408f3b1cfcc188336b6f819785b5560b55aee82627d3780b6a57165cf89550ca86fa02ed41737e9b200b2ea4174bc506443c0eee4e8c19e05b1b2f84f35bbc4ddfe52e18938c571433c57d8291dc0eec5bbed0a265031a17d5d7df2d9393979a5892341ccc0078e190c88c10cb19f43ff567ea18957b1aadf43f937a9df65fb32c81d86f496b82e34fad1e1fcbaca05c95fe25613b23686b39f6f892c79b788907a012597c75388fa1b337801976412e5d6aa0635de90e3145d7199a28edce77cdd5bbed36d89bf6dcf2545d71cf6717470ce4b4b8c642f37884792ee30ea26257857e84f8e5b204851bff0bf839eb5f325f69c4bf584cf4097c65878240da1eb16011d48df26aab452886eb31d6465bf11af0fc8e56e68b0a7524c9c67d437e3e9cb3acd436ff2853f621588db5521d0fa045fa2ffeeb3306a8e47245d937ace2a99c39978e2648ae790a794d1bccadb686401bc6b160cbccb9aad45d12e79c3dc3704953aab04c941563d3e87409f823c8ea91a72b538f5714f13d4cf722851a4e0533b71411e8d425e3734aff9a8e18602d7384aac8f827fc8a66163d81c42e4c4a61290154dd1e215bc00393bbd1fcc1ab5f1a685ad992d5958060f31491b5a22298c19bdc715fb5af052d3e70f60dac02d2510435b050e398dadb56b23c428681c50fe2d6e0e80ded3b67e4ba3b666f15406362e4c0338a312bee949a32759210800ace84fb0c874a48951fb166ca46cab6610eb24396674c24a7c2c3a860a8f80940ff061e749a3527b1de4ea47ea69470bd0eba9b38e50c73f2b00b842768616da5a5c79bc0d6a7d408981499472d6782e198838fa75a97e652a334cc9fdaa443c130ea9f6eed6fd16ee9b39cdf36ef3526d93925c6d855ed351fe5da263a523d7c988fbd155a0b222d996565ef97dc2434e77b80f8a60bae2583348b62af7180c725041ad2ad7befdcde7fd6d1e274583dbf38fbeb1f7b3ba8a95b4efcf3eb4c66c0f7320eef3a8aa1a2911cbf56cdb4630495d625201d6c067e3348c3127bf35961b1a02bef6d418e316673c6f460da49f2d5d4d48c7a3eaa311a92c28ccdbd37c230b2558c72faeed95882081ff5a30d5aedebcff7efc513f67c2b28b23a6cf553e67663fba912c87adba26300bda443f9c1c3f46406da41360d89bc86f4baeaad45d0ad9098860032e42a6a10a76ca8b3cc699c7db86e60c7f2cd91467d11e816aed6899c1ab20e41bc87a9a47d2894620e1563e3e821638cd14cd40600fac6057dfac9998cde084156af1cebb875ae43029c605b2d1aad71af0552de20df461c8d5187e1feea57affa1a79369960b83b2509284e484881de5cb7a7b6edff6e635012e68403eda7a41e3be5b3151a519af8f2c6e1ed2f5ee5bbacb4513b479be6a1b56fbb6654bf16d532580aea22ab7f1cc46e574e81f5ea00dabd0963e278b2dacf7fabc54e5e51c025c3d7c6709bfc484e23e9ad381eafa50f511ef3e65b86ac9086ede5a9ae7e87ba66887250a33ec7dace94153966d661d23f912534d4a3d945eca3083048a5ac4b848a4d5e813524596d5a5cc051f6ad04edad6218c1ae68a14206f104add82089e02eccc5171d886053ad483fb99bdde9b8373029c9a42384049bccb2a13c47ccae4918d3ade4ab7c4625823d01b106937ef53a192f510864cccab08143edcb8a4f5b6ddcc74534fdff6ac36f09ec851bcf0203e008bb33da10f0dcbf34a300b81b94f3eb89b647b4bef88b17765410dd4a084e17b59a7626a5a4236eba6b0e31cce6f07f56f8363926878cd96254cbac07daa445deeaf42f76382015088f2ef7cd9992a683cbdb39cf4917a5aa93e9708a368467b3c4f5f9209cb7133f4b002dc495b0fea4f523cba7d57a8e5c30f59fcb59296b7be0191a0649aed5788c55490abb38a467d1c925e50faf008df455daab4e10ebb27eba437319ce6dfc5d245f5a080d22566a5d36e87c67a64e48ed58ecd1a7223750b656830ad1c600c0d1e3acfc1fbc7872fb7726fa2b3429671c40f6104a3e051f103e1c4238ac3c1a6c297878aa8ebf9c26c5c8798b5f7d5d3de2f817c5f07a0d8b9366aa544a23243c7ec49de930ce1613f6b100bce94cea0173642bf6912e112a12f4a58b7b3282c3a73439c45d1db9020f7e2541ad46d13bae74061cc71181d27a599c8dee9398b039e5a3b3d941a0a75e74d7066fc99e9339bc0ae99a7c7a317bb05095416dc47a32e3580167af62a2fd1d49c04b5425d39d2eef185b4fd960866242c31bafabff0d154f917e1a47e7ec70e4f6fe2ad151cb2ab303fba2a5c8879ff05d328da1ea69d2c6d531e4ba24fe4c0d8fb55d53704c37556537d6f0d2d452278ff3476133ffac5304f70749ea6b7886da82b936edb5230d8ead435933b60d8ac4331318be4d51909d50dc5667ee7608550e229ebaad96c4f9da08e6c7fa11357aa96f18d0dd319e53a185fe2a2ddca38442c04dfa55c5495747e0492765258bc3d657895bf1fa04ea3a92889bd3de16294e16e4a38a8107541d9e8b752989b9583bfbaa9e22111d585c8028395d33e36a20a193ad328cdbac44e43321ba08c0ffebd8d0368f090a992b792d996674451499045d4aeb276117caa12dc9cd6d1db194c20c22799f928b39deef4f6745fd8152f78f295c004365db339f1f7c8cc9b9bfacf4b1d4c01aed2c7508b0adc5d786ea4adbf767832871def0024cc2019a995245284e7868c46abd2c7f38eeefc207479a8cda6db70d2887c89e8ea5eff5137d05d445bf2e48e0f4d56a4fc45e1c1b5c97a7f69a665e7a57918d053b19b2b117ab8bd03bcfbeda1bc0597530aea4c73aed31a813aefd6fc32afbbbce30c08f685b7815754b1a4cc73cf61b6ff0ae23b221f9dfd8f96d1a1bb8e3a76860ca0757e5cfc55ef48c1bc2bd0d7a1b9fced39adb732f466959544859fa05237041d31ef4d8ab5b801ba71fac0d29af7af4bf9c2c01f5267e5c49df94b6ba377b5057ce463eb23ae1c3cc0b1062aa62ad15f4d6c6b83e5e1086eaa318e82a1bbe085de5907a7d51e286ff43675068bfe202bd96c2274960b3dd4f8eb7849d10a482fbfeec4a486208d138c5966efc0b2b10283bcb6f835e83846b100a2b0e54f6b6df65deefba857e0d82c18a19f019a78149b1b83a4d11d25e3a9540c4494ce893b4ee0c202f1f6975c9ed06583ab56ef75b4e255a083ad6d582730a9f9d5fb0cb26ebb6efa5f1cd333ceaf492a748b25c3f97755ef8ca15787e9525fd0792a1c6ab7a3cdc23ef2211d807f46ff98f479b831661346adf877a1abb06e9c9280b41e4ec4faf98b35a9eb0492b20787115eab2c4c7ba90684dc8b6795c8a07c5802e2fa729839cc4d636d36058a4458567cb03bb40dc5864b15154aafbb07291cc084c64dfd9faec6fd503b341b8e3048f5037526312c858577e53420ea273e55e4e6f63e3213685e6bc1a196e3e0a3543a417b48bce72c3997cedb0b0dbfa46f4be86cc3d758bc9ac3be081274bff519df7865e53a021f3e3506490ed3b5e2027caba04096ac4efb4f7c6996b0fe46d6cd6c96ce689ef68495165ff744d14fb8a99d822d5f463e0b4e35b9b39e16639ea5115298e3f378e160f1030619269ad1dfab6ca866fc8ee2f983137919a66722660ac1bc2dcbb051c16ae306373057b659292c96ffedfb38a44c40fd97bfbf48c1ff7065fd3191d2ee79c2dbb06f61ac4e0cc6fd06e9d66d5ff5b3309240283869ee03fa96fc18b480b31a20178e43eef175609c8059fd09bc3a6f5f5259d2c5e5670fed674d3c3c4ffc069acaaf1d77ce6e57e68dc3786d9b2e2c60ec846e205be0b594817941a2b35024e8aad4814d30d4d6d34e5b7af1ac7441405f9e38d4a71421b00310704d69f9cec6a275e585f10de9d982bd96524240f06502e2c9a008105c9c7f825d1e74d4e43a1db46e5610bd2a7c425474159c751ba0e5907da75e1325da9008944beb2dd9b6b8586b1890325648f06728aac3361069786dd76e3d00651750120865683246cf20f1373bf1025cbbfdff1c6fb8deb63340f8435d0219af3791c60ea68e9deaf6216e14a9817d500aac1dcc41c5e3875be80a7d4ae501e1d1feb7ce4d4f0264e0d8dc66dd5bf0e5244383caf430e035892fec777192a994daf0288ea8b885a647c3d20e47a3949d429ffa9e54302eb14002ba6f0bc2f43d4c3b4ff782b939e648bbcc6305c3f5703e20b74b83949076f6627e2ab1071f84441ad562be9bc3cda78c8c53b89c01bc5de559f4299af2477a1f82f9dc2183a65237273e48b36e89ebb81579724327fd9c895e482b1c21fd6f7ef95c785c09bfae3e524cb40d7725e479f581fbe08a39a930ec3ffd3189ae5f1e58743127667dc3d7c20215f5194ffa08731a8167312c31e37323ae3da71b06794e75c4d37620f9e330fc29a2802fdecf2a4d3fb511adde4999a97eb6184a66a8bd3c99637649ba5b339b70fac40d753cd67a5a1022ec9d2cccf2019529fb7c8588894d0322da3109cb40f5cd4b8545edb9d227b93374100baf057ecfda0eb948f8f8a5f26484fcfeef6b61e4313196404c60a121cdd51d7643ae24a2464fc45981ff4c009f2dc2537d98d10ce1c633e3628b4feb5824ebb8985a3963d57e190b67a21904aad10d7124d92b0955118f4a8624218ca73ff3efc21ba46c511a96b8422c2a4c4e31439766a24bd9031487b7d4662f74e8499cc0304e8a12d8a0f13d9bbd6b7a38d02f138b308cc5eec4032e7123b9abfad063a0f724eebe3dc014c26670adb6cd57dc7b641f0e451c86bd540e6848be7d9ec191057866a717eab204ce7aa6a23334b5065432f15b974eae29a5022d8055b10b43e9215978fd81dd69a1f0174a74f73eb45072bd3e358a4e36853ce365ae8b56b8b457d0a9e2379c36b9ef1a11863e8502b9204444131dcde740c4cf908e9952d91c800aa7a3a31309a5d0f459244f17bd0f5433ea208f31ff2cdf21ca5df16e925e03daf242780de4000a8eb402d92c51cc4dbcd003ceb2370666feb3edd11dc119d93698a7a27b4a28d50bc9eafea7f711f6b5ee86388593d4a4f28055d3ecbece0905c37e8dd90a18f23ca3783f1a398cb028bafb761fb0b9bc64abca47316d8549341a1df7a3b5c235853b27726c81ff9ff640f48370037b9cb09cf09fced2be5950d1ab40576ec5a7b5d2b41c9dd8434de49c52c118373ea46e35ca4d8f40ec4266587f20c1b26d3ae791350472feedc27c0e3cc68e7afed61a0d1eabe37b18168029a5d448862a863bc71fc789e5c47597c699092964637917809db04a503938bb77ad25d2f5d9b38cdcbc5fd2256da47bd7753398fcc92e60c6c63485c2e022eef0af1e6521517a49e79c7684db6393e6a1416af06b86331fc024ab6a60517ca79abb8565e84d95ad4920542db25e34f26c9b2d7438af8f8c6a3d0eb8f237e643618d2619b39b09b5576f3d8bfee0265b6ea2a956d2b41c8afa5a5d3fe2babfec4ca95198d742e43a20ec6bc08e6a4d8c6c8660ae1e096440cfd4a3429dcc5f09db8e372a65f1cbdf426a62b9cd37669e5afbe1d95c727bbb425db99556de51ff11c3a365d568ddd714bb1989277af9fb0c0fb3d5f514318550c7b57219923da5a5015ceead7cdc56dac20555fea28e80a3d236b69172daddd9311b320eeb15dfedbe8f94ade1bc43e9ce226bb61e1f2ea1485836d417a76536cb9638e6229dac8d795e92f9ea972d3b3a6b30e3d43369c6b06253c17995b5936deb1051b420c080f4fa69830478cfc30b9ff628ca255711ee4ae9abd1f6a9a2444992cc98c813e8550928e1657815f14d37884473e30be749d4a20e66523b62a17e4f7426c246583d063e90d952f2382dc267884633e278c58169a46f027510391f34aaf1fc864ae1770bb561f8524e1d585a243daf8c57064d617813979c3aaaf8fc5c267da7f8981d92c1b3c493c080c3b24e3a4181392f1bb4dc8038b4080a98051667921475d7f7b202111c8048686c8b8a254b85ceae5d21df14c144230240f6f326067f4e3a2909be29c21bce25f27a5ea4031bf07a3facba17c68e33d74556a846c7295223bd65aea5544912e97d338dfb12b8ebd2cc6606ac59733bfc5e1979657c206361237f1c12de1ae7f02288d9711357a6e9d8eee95b3912cc2a26ff00616adc538a4b020b004ca8ecabf78df6714d390f22996d5b2f42cc94791beda18499d4a62a9d71f1771fa62dd091e4d7c0d5573dcafe0b7eb2261bf09cfbce0e2b817310051f2aae34c1e5752e847ffd8df78c886a80b38dbd081886e49f51757dad2db69b3b3a4d44392c16f3f19d62f978d8f09a03dd9eeb3a1f0948c03c9d5d9fbd13036838b0580c340964ba57c105d72081f1ff33d72fb1f7746cb2aac1280dd8e8f3f577e6dbf62e4f3621bfb28e21868edcf3e135e51fbd220d0237c10f8bb04d27240672ecfa2cb2a2ec1b522ee38b679f2b7d0126a58dacd0fa3569f9c977749a257ac022ca6daa79d51f50691d8c563eea4abe755ccbc04b05a790e7b6c0aeb970ba4bad8d6285bc9a4a0ac622fa8cf8cdc5dda24e4b57862de8620a430912c1d724065339e7bbc60e2d92844c0c37e6e43d4069547e67f5d70ac5c5fd9c73dd55c616aab73dbb0b43025289b765b0454fdc22f0e5c936627f76a715553fcbebd3390d969811f6ad502acb860728c89adbb0304fac53cdceaeb4d6ad8926044afd7242e9b33baa6479d7c51ad4d398f47922ea1f2118cf3d7397b667fad8d5d9daeae5822220a26ddaf909d532e8ffee0b0c4f51d87ad58634212589c90e0d015fa352c560a49a840d8409907da73d9453ef194a526f6925dc9464bea4184ba9b8e2e157365d5566c29c939f6fe4ef154cb22d8e0fb9330005c8df2d1ba68a1a376cde018172918d442bcabcb93727d13174c80bd71f5bc645cb0bfe106fbee6dadf78843372f5a8a6268fbe06dadeb740150f099b8bdc0f14c9df0323efee410668a724d89cf525dfe4b452df1d570d7398c8c9ad07248c2056731b7396f3e23a421508c9f99d8695077cceda9fab54a15df8857a409fbe82381a639069af2a82f07c4b3cb27f6168521faa580148eb96c60022ffbfcc9758db57adc8c29731b963b3c29d636fdb677cc122d5cd70106e17de970aca5a6900c741f552c14fe3c5e54d82be40d3d29c420e5c55bf2d5521d6dfaa62a944c470e1e4a21e89b1c5da21b2ff1ded38e60407381b1f9e660fa09f5f260bf20d9abb0802ad4cb015bd3c38a547fbab52a56287ac3e960a1ba64d4977c0dfeb4a6d4dd4f825206dfd989415fc127eb583dc5e9ab5ec844dca5c3fae0848707b96ed46c9e193e31167abf52ee3db132acd962f0c1aa41b0012474ae01a65f49c3184859b468b7956f75f955eed5123e820b25971f4e2ffc003a98073e1cf67a3a2314e737dc248dc4d346b63c33e29d0348d7d7520972c7a0ec43ce65a05debc7cff680cad0b0a885de03cebed5e2f2875a8bdb272cd4a446ae9fd0000e151b58da16d7e6c6c374604d00ea677bf23d9f5a7d0fad3390cde83d25ea965f1d95990d6bc17d4dc36d9d61c7956fadeb7ad99c89364fc567c48b813f59bd76889278aeeb44b42ff3ad9d59b36951f61295f0e20a58185c95a126a4140dd8fe13180982021d0eda45cc50dfaca461bcd94b00d126c74fe0b2a9962e1c332aeed68f0eb01a932e45f16fc89d9648822cf224a39a67d8f0240ac1a01c9349e851b294137065f14744551ae14f941d937107b5daa11a61de311cb2023c3758d5e3cff6464a886dae43047bb8f8fe6ceaebb57138d3ef3ba4d3763e4ed028fec5896e02d00e87d7f6a11c4426f2ce05f433caaa490e328eb6cc0a80a39de651de9132660d535fa3982c97ac7fea7f4a78298a4e61cda3caf80aceaf8ee6035cbd5b6dce21f4cf116627b14b098a8499876a537b2a8711824ffce76f62c9ca6aa89d3c8af96fc39120bf74f7f54f1b1594828c379aae577008691c012b3de5eb02f78f62548b3375ed6d3f3c48b105a1ff4f3e563ce6ad699349ad4af672581a4a5d95b45e6f752db8d62d333b28eadf007c98db75b89475eed9d26cb318501a89ea76c25797b6e7e54be048704edf69a55ef60c8e143670e4b8989257509ec5919aa0a1d51c1f4087f03c98e529b4c394d4eb2f3fcec967d4f9bec8bd346971519fe8a28c401aad91fe9947949d746f34fa387c7e5022145a2f44ec94b815f864f7402b16cb61f5461ff44d99785d4bf4f9a17eefaf270aca0691ef3a39ac853dc1db7501f8bfcfb9dd946a79982945cbb1b7f2eeaad43227ab4c291bf4c1cedbe298fcaa9d1104b226644f6b07c568e48a56cb43f5c18357167b44444834d51badd4890822bc340e572c2676b9cc565ee252b591281695ef216b2d1b742d06964cdb491205e5714dda7dacdde18c19c78df908b1028035a1858b7878bdad5b81ae453df45c66bc33d1d0f7d679b4421ea301b14a2f466d8657b3b5f84de3cb8944d9899706a4c5fd217502b5a508e5a0d832e768e9af080b252dff9a5142d1aaf6911db91225b1dae012c7ec2914a0d899a11f9162b0152390015cb3bc5991316b46327770564750ea86708063fe6b153789fe2d1782df72e9117f9adbb0d83caa330448d7b62c6b5b04a14263af0cc38f1f9ff656706e8bdfe9c0fc00dff0f83745c2c2d6ee50061e353d72a9890938ab994fdcef0c4a19c9cec429578cdccc2c4418a88e7845e61f43cd706922efe485419f1b0153d6b6dc11499169e6345ad795fa433ade7d5fd5439748a47a20aeb6c017a514b195766022ef6706fd6e83fdc6417ad5c972e9058983f7e5d9badbfd3e5e14252a3c2062acfd089fb46e332bb78bf54a66dbf30f4e475318a37e8d5baa7aafd8dd0f73093c8139d37cda7561982024f304e0b8656e1f260a8543b6fc82dea57947a107d54c0c77d01a6610e34b7aacde6f5d77a51de42064db6277babf2efca73b84cb9f8a007736e9af930dfdb1d6c71241d2f925e09499d83f101dc44ec4f966ae6670e9286b58007ccac92a214ae72a8ee9059ec7109961b7debc3a651782124155a3a06615f4ab763e913791bc17023301b498f8b50d64858c7146629d566346582d83baf74bc56f4c70f096959224fb350e58846cc8c57853279ab4c0d0e3a56805d1802de718e01b8cbde538f13739d417acf3bd4b1909fe099ca4c56c0481d618ae426f93e350248b76a13b314bcdc884e352193c72eb9a6fc7aa55f0bda1d1b068ec6afe839a4448efa83728bca870584bf78c486122a6f57d65f93c22b08634f4760250572a8d0fcda8dbf06d4c3b4362583e37c48c23ea283e170cc7bd930b85f9b75eca72d714c97cd2e20511d8baf82100cec0f65f2d61d3d74ea005e8409cb4c8bf0a8e9d0578750aba9853c5021085e0286836de24975971068793a7a0488597f206bce96e34bd97f7549d3b17cc3b94cc00a097f6cb873f3e5aed65f0f798ca7246eaf02b470ec76da03e64304a06f599ab27756fc54405e9bc984c82d6f49400c1dc6cad413017c124f2100bd49e136404514b0ecf293e911567fd47025e056465dac088140c4157f9414c82db368a8f5d9ee82ef7fb02ddfb21cb2705d9bcf4636cd8934a77370c72428f8202467fc8434c5bb83ffd5eeab5f5cdc8d0377731cfeef2e83fa3d5b3c957bb8bc4c4c08f15646647c44b10f489cb69c69255a4eb4b22844ee9c275658e0a6d61b9e84ca36411ccd227532b4dc52447309a1d65d31f4ad148311f0706515f92e2bf40c2fee9e4f07b372946c1d232a573097e567eddf31717b0e3fa55d34b60e5322d40a54d0c96f04f5a2bcabdf57e9f7cba1987d49246f2a2ef9e93efd392076a92f6a2ecd3e30d9804b5794391f3a8a476be5c4a441abae66ed5e563ec4dd06d62e9d2ed245404fef059291ae3cd1c7584f27b1a2e3fca4b9daf286bf294796c181c8ba64d21d55b2efe75616a1c86b88c2519cd7862c78183c38abe6cc78d122ec33b7e05baccd1338cf13494a8fd64f9a7b2ed4fd4e6dbb61bd12de2e349f7777462242f9daf792a9e7b7fdeab1a3e6099b6ceaa046c05771a0031112ee4e06af1681b72d17ca19e6c5fca35453d7552e18156decac1dccf1ec1a267e1f8f7959745adc8446561152137f1c060cb50d3ec843b632b65bb1d06b2f99e279d7278a86a97a542c3500392c564fef39da53cbc12e9ebf1e57532c1231e0c96055fce3dfaae41fb938c0ea576329b8cb51c3393b6bb7729d22cd7bf78bf7a759a59b6c40f6498dd78e22ffc51383b217d655797f030e8f44bf206e3b472b7ab5c34af0394044530b2136201590fb14bdca89157d824ee202e2e739639a0584d913da250b92c13af04a3a0b5539ec2f6a401c33ecd55ab7d50e43617c99c93a77060025d37eb6deb62636bc093c2b6f2f93378eb94f6058b32bddeef57400fde2550be88b940eda578474cc7b04fa8b4ef3e6e2b8769b452b63b5da1ed66b65f0383cee6258ce89e372b1c94af48411d086e2d75d72dadbb9ec0c6caa6d0f98dd88110db704e900f5f2761d51bfd096493b5c1edfdc51bc752f67c0bd382edfd1cd80f9a384feaa66f7cd21f264cbedecb87ad8e2d5c1a64062865be07323b6dc038a98c089cd69f3ef487790f2a09a1a571eb53508f3ad4fb4aefeed3b74f0956b68ee71f5dc63dd224fab72a498d8e28cdd8238cd2d1540fccef64614f4ec00ab0d37f44a3b5dc478f2dda73a857f345cc40640bd1db3bec37a29b7b423dbe7301fca9b19d475eca57ccd424912d8d846224faeaa3445a644aa7160cf74dc82832d5877c980bb2026cf797832c3904cc0e7af5a9e516a589ded914ee9f3297f8c0cbe9650c627cc7c49259fdb64bb781356b47d10cc3d2f2be3e4117752b3001df398c6116649ed3b756532a5e9eb44cbb0aabe3042e4946e595aa089d83de09f7cfb45b8b10026f25f16a7d54e482f8d7a9f879d3814ae59b5de9ab960adfc46937b54d27d1522e84b55d97e103d2cfb5d98f05132519ac314842a698bb5e8b44414ed342eb6a91f58a7acbb733e4dfb8f25f0c2a9f01ebc15480f810419239bf3485e2b1d6749dc7c1ef9ecf6ca9c219a4f97d761e41d6b4a5f01d15a591acbd8dd372f73a5b7b11fcfc4a800ccef804a950974e4797c0d11e26e220afd115b8e44212c71c97213bcd03a2c807748d18b20d3989b20f4195277f62558ed7167b136bc212b3c4c3a347c2e368097fd9cc51f3d37bb0e58a606cc97fdb44d322a4032e65bde0be92e87d9ed551a8f78897047bf3a6e83841466b4ed7513fe63ae298291ce9f9258f891bd49bd2136c3ee4829c4f33a9e4e6f8189ab83889b5525901a8e0976529582b9fd67237bb98ad9254947a1b2707e35c85d2411cd84a7b42738808827474b5b8aeab73cfc5a3b89baf67d1f39ea6bd89bd25123172afc74b2efcc1c0417fcc770cf8e766c36e3df3e331e2c4749d0a6911aa35ff9da6d6501a92b62d8d1cd70801e8972c07c3183206d2004dac8a1912ecec3a7b9eeb0fe94f0aa672c403f804c779eaff6ab7c8fc874ad3ed03aaf0e8033cc2fba3e0595249d2f83e1b50b264859c1c8ec11ad349fe119f72ac8ecb77dda25d270bcabdee87d68f693d7743ae280d82757f4a75ea1afe2fba03bf4f968c79c357049a6cf6d2dc1fdaea53fddd613d429286995d327b1a8a2fe34567f342b0c3d595f8fdd62cabe3a5c6f4e26a9071c64caf7e836201f9ee3c46816640e72ab5bd480889fe04d916474fb045544565b99f5152ac3db27b3d8ab1816299ab6ac3a9a77564e7d1930c31f3f73e6acf0a483f33f96f01e610ca7db150adafeba6f57daa7b91954389b75b1c428355939de025949b89b13a39653c76b01fd0104290d292f4ff9a61e51000e7f43f05d33617fe5afe7160ba7325c7330c521e0be7483ef4d1df4ee7136dba43ab8b6398baba83800ba387124eace6074fd0b9a01fd516bd005eaf9650493729b95897689f25d8007a8e42af3db7bd395a27d98346347a1b658a8af8c355e966493f4a358b289ea9087c9fb0e65d09c4a5c7d18a680fb72b166d293d35d34b328ab31c0fa28bf2174ca9046b03c2c7dd4b4e93c903b5e17f97dc6ab2e70a3997602ea869d91e9364ed0b885534c56d1fb3d62c6dc9091a502b71f92f2e186cb21c6a2d6b6e77b085d9e3982e85a473abcfe7d8139b7ce8f059ca50b3a9718492565ea35a225864f3e7de976d6d99aa4daf4c96b40848e2baa05a69a6dfb56a5c76cd4b16c3e78fc41833b8253bd5a3f9a1bec00e60ae8c7f4cbfc6fd94189d94c3c325631e916a7c71456d53d5949d5b41bee3f128510d78d915e25315feccc63d73676fba19d48981f11dafc86aa4e170ac9c8245be240b5332d59122b11c4854f5804dcca9c3a05e85f3df7e095f6847bc58384f35bd00ff3a8d845c16a8a61964832fe7cf9002454e8914ccac74ca20ad4290a3e6c5e2a3bdca829687481dd76094b5f3389d83b5d43714c66eda19516b99e433135f81cc23456e74bac4eabd2f8b8ec0e145dfe1fc6bc2b5d00b107e3d90c99c754a2ea2f399717493f2350683d01f092d13f5d49703484fcaae8f94997634189a51740cdb4e807fbedf86e129322f642a09581c96ce209551b6d2e92d706aa3f937a9cb0e2a3db7b2f466015d64d43090e2c6ce29b41bf8a94eec6e412cdce778dd742a2ccabb7f8165ebcc5f07b54517a93d91b796de87548644d6b63a943be77ff39b373b1c3ff516180464521a798106ec27ddaf1e12e7ae35a924161faee4a8f8f2f606a3871d8986c64a1fbbb1363c035cfe5405738795487c738ac55ee427e3728fda31a1247bfd6f135de3c03b23b5058cee2212b599594d48de2c7f3bc25d6e8e122ff7a7a181f5e34116cf92876e3087daedf2d5d4a62d06ae9876c238a76a6f7028b7648450e5b7cff8ce1113a6904fe4f92532b74128dd3390ee0568309f6d4fd284a3294af95882f74f7a36c210cd192bebfda67dda5ebdfd870762b93b2aeb00d004a371bd8963a503a3fb7bea4ff5e386c974b83fefc4320554bce0f6f4a2439091dba52c3d77438d8f94401d76a4fd6eff7f1f9231478d5f3ab22409ba52ae44ca3ee33f7de53b06b1961250c846a063fa419c0ab7b5a09faf34f97511553ad5b343609251c82326461c6130b2ec2f3a26a662b91e6cac8fad2367068ae4cc359f5ee1d2fd2770c2f6109cf0c0949a8d173d1f0848faca8895ca956b165b51474241d7f185887a60f4e7c60ac6fd2ea834b152aacdd1b9f646ed83d2cf351fccf4fd255409ebab461825ac02f32c8ca85200264a0c098699a241c036738bea42f3abe1a00f0909fa77b38efd74726e550f5d314a67ba506f7abf9bfd272c03168414ab535e993445242e79fbacf9839ab302a1d72d5609c887cfc38c8e6964a424ff45d3be856e292f5f73ef0e37171dc48e2da74cb8fc65e5f65adcb49da180487e6960920ab43b2dfd09f40b93e0467dbb4e5f0a4d44cb80d9e8b98b89838872c56c509daa1d361e2b2f5359823a153c00c4b8a2d34124a41f4d448d3c45d8fae5a3697a5953449f62d8d3c70b701a5f67ff4dcc43d6e3718f331d4684c6075632229776a6f8f46e3abcc54935a17171e17cbc87ea9243e67b7c12463c102b2cc8c5d6fb37ab8379accb95faad66987cb7303fa1057aca6d469f6c2828d5bf05b55649d41423d0dd3cf30f7399b3d8f311bf4814f34c4cf12087e2e048dc5354cd5db3b610ed2df7dd7286a2af536664f5e04dfb24f1671e66233c4ca1dd3945b3e83c04895c9116e48b60ec6a98eb7a65d76c18b9d2a5b6b1aefdd2a8c3cdbd030ae65c64842e9955dfbf33b443ded95f202db5c84c48dd026c6309fd9bed8f2a9a492010892208f5ce4bde822584a29573fefcc1c22ecf340d4a2166f71bf307c8fe38310c682b5f67678a9b884e70857b470f3932ca9a88b9516a4e8326786dd7b4676f4911488191c81eb1b4cae7ff55ad518e0ff96eed5c84a196f4344d8e8c7ebea4668a84e8c77356b7fdf114d274f40211f01a2850da8416e40967d67b9677c45ec8b2624f2a9e6ffdacc32e879dfd426bf96131a0da61455bfd71815e29350abf4cb1c8feea0e4ee2c0c58e787ad6385900e8e4410ccf1edc28d0b331ba60b9c93f2e71e051bc8cacf1fe3c3a70f6a8f311dfe728734cd8802cd2db4141a1228c48eef34d31d7ac0ff446c61b486f2eaba625d0c170dfea84ffb6f59e6bc2f9f6d398713b92ce33c1cff0ecb3b28a5c061d0a5bd69856982cf0600b0d498b99db01b2992fb3d39805425e05cd318f96faf92cce1a7b1f643941cdf7a3b1078892ebc1a980b5930fd648eda99ba9a0a28224dca3aaf333dc7a73ba57a5b5b212c19bf4fd533222307396f979e1ad157e6e9ec34f0945ae4d5b09642647203dea8b01263b5fed995ff77b054e155bbd5be9e5501af4d921a21dbfcdc35b115e5f9477daf0f1b075c87436c81bab8ea2d1e4b2f020a0f5e0106b107705f3b84ef8395119449e4bde4658ee34ff32a9b23593c4c6cc60d66e806be5a6eecfc87050e67b3aab18071664f0ec77ead88f4e096059142f11309e707f1186f4efb5492ce8c356902a5a900320582630f05428bd656ec5a2937de79762818fbbd52526c43c1ff42e6f909b8b1fc33b1c2a85e318d3c998378b1acc6811f4f742b1827c7f633b9ce5ce649b2383965036efa47773cf39d4aa573b8bbd0575bfd3a9244d5957f3babef0da1b977943b7592dedb0f5ca6a578602af0af21235ee4ba209cfc34d956ace543f4114398a8152d439432406c229342ad4154fe0333029041be8fd18547a94a0659531c19255efca3c63e673dc7102031d82d1689a7091f8b91b2f36fa8977ad410d94f4b80386666af0236ce99a9b63617b55daf4b19f5d0ae0bd31f6ab978cfbf02f44803240a3114626d537d08aa513ba813398e6082d1d6a5a1a0f6111802830a7131b8da26b86a126514ccc6977a6bb1076ffa9c7fd57866860a1a0422f622ee52dcd71da771ffa32d977ab6208f1e3f89428d3bb07b5bcf33e3ffe0ca891acf2bb0608cd9ac0eabf302e22001f7859a6ef74730a2186938065ecbcc0626fa08f7c8a7ad2aaccea0f7d19c955547b0776526d739911dc68a9eea080863be6b6bbf3c9e1bb4869a35551c685e8607c3d744bb3b393ec7e1616f079103df7927403b8ad9cc00f2ff4380da9e7dd5d7855c97439a443919ddc84e21dc003e39c58f1ae935e098fd5cac5a49f80d01e134cc319669a850ff441e9b978c3589b8de42b7a4e0a862b7eefc5a19db251ab5f1456c9bdcc001b6331242957e2cdb659c91652f13d25cbba83f18c30ae475cdedcba8472f6c19de51685f32af64f568826a1b9350a916d9e8e4c2fc5d096b27c2b0f27a4b4db340297f245f79894c235ab52e861e0226c34b332da5a1953c87b187e68aa93a85d3403666f0118bc69e7475dc93c09a7c5d3f5dad429df5a0eea82264ee4977ec7825fa43857be7b067aa2fd22b00bc1cacf6145fedeb4978fbd1d6f3d563e89589a40bc0eb228216569885b3ae8b7b5031a2220daa9cfbec7d73e0fe3c19335cfa1d023ff03d37bd9879239b38297414f0ad4d1b3ace147eed7de5237db21905c8f0119169d4f51c656ab2c81f0f25a9cf3f89d0419bf7d796e52fa7f95d1a9f90f201cc9b7efd6b30f1ce7f2869590f161746d6e047dfcf212ac64c4a0d6bfa6fe96ba6f8f618ea9c8943a611fc55aae84dda6cc1d37373a9f879296d937814dcdcf93a40c982f76afd529fe76a89535ef9cb50ae857a423a9421816877324ba413a55847491aa35718137e17b38600268beb65af130ee4ecd9871f05e7a7286d37d6b288e8b54e533b442e6e02cea03783b3d1adc43eda0395257076a15dd5908aa335b5b48dc7e25be7b12379ecfef424d49db7f5c548d5ee37557b8938c5ef5599e2dd297afd4f3c86507bfc11d89991cc4d8368d166f9e4d66bba6fa66c9f1987d89782a347f28e6da5d3b6e8ceb5bcd4d1ece78144128a1e00be94f6ac68125ed5dc4aa16bbb40546eec0984a24c4fe940f398d60ee374c32fe6f4fcf08461457cc0e799a6fbe75064c824a0a8d251c91177c9442df26b4a72ba0fe1b7adfcab89f13de07d5bdc384a2f0b932ca3da14c3a1311474df9d7cc9f59b3b6f2e765af746ec28974f8f8b2bc72e8b826d4799ff6c71ab3297e12f86ee28849ef5deb357dcb3bba52b8d141d4585e3b47766cde1146b12d168a954a874398fd9e8053b7acf91999f5128cb8eccc5673b26d078a5e41930bbf247d7d43b6728ebd84aabb6f75bc3e5272f4aa5d9a75210ea8cf513d4724c05d25b9115896e582230c1ff98143226211fdf81d64bedaf89c735b9f2d3d5be3d01dbd135bd44956ceedac67ff7dd211df7f55ec4baf2e3d1cb925ddc0045a1af0c26638059d6efe13a69dde2253d9316df6904c6b484969656bee1aeeecba667e0f848080f21bf03456dcd244e91a74cd0a1aa6ff43aed36298145004941e2d6d3a4812bb8b14809a31298bef9a826151f14bfa928c1a27a8a9d863113d036fd2382669b543f5bd9b759a3641ebc684b4eeb580e95c0e7012a74d8d176326532d9f9c7f91ad1685076084108d84f38fa6b99629ed89af21abc7efbe03d0d901be91750817956ab199055e572d3cc97fc8b0a2d81d87627d6de32020f786ad024c74c474e155d4502fa96526236336061ecedce2bb5c902ce41fc75bb323bfea039f83193d5edf982da73b2085e4eccfb6d93cfd3e194259101ae89c9905d9f1d7e52c508d07b7d50b93373a4940acf4f3bb723e2af8beb8a3110dba2c027dafe183d99f1cf99f2266118bb6194dcacd90312a23cb23ff89451a69c3cb1fa24e73b65a1e6c97fe6474e762cd3fa8eeb4fe2e7d2401e5d12504b8a860a539f336846a041a76aa7a70982e559bbc17aa7040fe0c2267ad73c0dccb9d962fb458ff10ffb7853352c1ee2a5e79957ce1961dc7986d9c11c7b5fc4d4693ec9983f5dc87c6a0a9248f5cf6959d1c209debc61e1d5bdb9b08984f6fa4fc584207c1864bdd746d0565d3b48d8cd036f075094b9a056f71797fbd9cd4382428cd2bbbd6a33f54da84e986ee2c198f7ca6b16d856cc1d99b90f302b59e4428403f2cb1264fbb8074c703720aec97b8f1a06f14fba3d7c430d0e5b26984a7dc2d92573ef09e035a90e7daef2e5cec5a22cab30259c02694eb78c0d4ba0b007b49470fc034443bcb370b2b7ea9fca7d1c20fdac8bb5539fd8f656a9ab25287b0707be19d73292df66ec6250693d1e1f4369f6f32a1f58813e793637aae28be030d3aafd5d73b0eb4b28fe137b2649cada29245310b8df0f5ead7f15e1ba9318b5b4af2ed494f18d6311f6bb24bfa8a89a8158ce7c952a824d9318dedd18c16663e1a2a78ff27ed3931a18a79a328d401ed59de46f44ea3feecfe956320a5dd71f21dc1934cfbf74f5c96e69f805bd625945d6230c711b99dcbbe93b288210f34c18e4da45d46ed48b14130ca0211b28fab17059934ed099e688257632be354f4ae276a683b82ecc2eac59326ac3b8187aea4c75371253ac11402453c7af3a7d157352a6a331e1d5819d75ea2dd860c3526dfa3a90847c4dce52d2f3a562b71cacf557f82e8585cc8337594ada650ea48b7a3f16dfa0f0b53f145b3eff35682356b08972b7688d6d2510b304f116fecf2bd0de721d413b619383f1cfb92a7cf64783a094a4e2a490998eb99bd1d550d989076df4bc9b4eb4022219b833f3e00a2aefcc750c41db9bc7680624798c3d588fbae52ec647c015d5b08c6cdcb806a532918035d0f1a9eb13e87588c77f349fe3a6c028f043e53cf756545d62471d59ae1835a756b9390ea543628372716e48ba901847440e089038bcf0da36de002630662638217bacf701ba98ed2b26b0575798ab4ab4696be47d58ee274a21684a96971d015e8b43a5624e4de182179f86014f15646f36346def6d2b3cb811af6f6f866cea222169a10b9dafe612377604aafc37c3ec0b151785fd5592b07b461ffdb004903fe7314aac04ef6576b5029208a7111a5cd5b68f43b3b045b0569657a426c9bdd121e065ac368fad9320c4932d7ef4bbabfd36bef30d81912f6d68498912de8a131ee6c6a1a1e34f5a77aac5936c6ac263991866994b2aa157d9c252245ee52fa9e13503de57be17e771c6739bb34426cfa9280afbcdff37158ad80e1c3b4f3e50dfca8e3befc7a9df55621bdef1066be04af125aef540dafcf4f0945f1c5f15aad07fd73ec779bf6dc41ccf7adfd168d68f42019d8eefa642b7ae5c866e65b957a673af932fd056bdc4891f23b09f3b14b9b73243c05b86fcdb6738d2142899341cdab1017a4e64d25b875e605ce09056561000a05e1f302fc263b95d40f5526c2dc9ffc6b635a4f04f70ce37a4c1a91e9a3a733c4dbe167090d506591cb894b8feb6fede1702ee74099e9375267dcf9be02f483ce87f5c0ab42dd73ad3b406b7feb91bd7e21dbe4021ad6a6c0e3810079077a796c22254e81e151abd9ce5b74532422fbdb1d11c278750b60c3ae7fd7ee4f1f740a48a562c0a8e84ef2599e85dab9f8516043178fafb277403258c76460a11bc011c4dee1ee129a56d722f32fd02bcdd0072e8a8633687fbafa4916642303551cf53d788831b5d33709b5113fe73303c23e21fc864d73cb28639e74274289dab7d1d1891f1d18bd85f5034228b27136f9b84c6cf77a1c6026f41e3ea7fdd778d359f6c470b533336eaa84c80f3ad90d4030525308c45e04b62e96b00cbf27f83e6158aa3caa197c1fd07308c480937dcfa0c2e9681f4cc7c34dc1e709237e80fd64aee99707ff112fb28063b7d1ca0fca63af8e29ba4e52c525b61b2c6b05f8cff224ebc82018da33e347d5b758df889c1c3a1ecb4af8667a1b4d4247ba808ca08b8fd8b4058deea6dcb05308cfc784f43a588bf95ed780c1148a9ec02d9a2bd0f3d6625da3f4321e725b5e7fae9098f0914fe2bf9884e480dd84bad0ec3b45341f95c6ee7e8cc24f99bb2efd8394fdef8dac11a371cffefca2f11c09beed3b14c418b3b0d8831494fef0e7261f007e0fcf72d7d4b6329e10e590de5dd76865ad79ea94c7466c73fc3dbfe6a1a4a930fb5acf51b12256c8fde95c7d4beb11d4e73897b565a454ac07f35f376d2b7d4e15c3b2af34a4b6d3918190a75f945db2823a489a7363fba59d7f586e72ff6ad6f3f84f3889d479480be967552393c0e6ebfc302d677c02993a53f4ee7477959283545a6a1bfa57d202fcae19ac8b4ffa0b1f47194ac5678c7f51c5c4996fe2c1dd9a6c258f579b588f60fef18089a5ec36b657bc530d147f04e2c92a17935a4cd37c06a97e172dba213ccb4ca7ee29dd2f2902b577ebbd35f7f798f8a08b6c1d8aee35973aa9ea12ce7f5524d48f29356e6df587d493f727b8a60e4e6bb07a25b37b950fc62c2b1c9e661fbd768dd4fc852461da281a2cd6188a70cad7c22f90c57b2710241dacb04040a649715dc26192c832413df2d5ecb55c6e6bf50e1203cb46f0649ee550aa7c662a87f47e6681ba62e180f8881a94cd7217dd149471186125e71e56e2fd32da2aa369c65c32a32e060412fa29f546eca9757400e9ddabff20064ccc5c8a3c623955082074f5e4ebf446d9c0ab0e746569329613dcc2ab02e0f93aa54d98ddea93e97912fa13cb1f7116418a2c5583efdc0f719062f46ecae23d637e7a466519bfb80b0f8953add85135da16e84bc31d63e7d90569e7de31c648965e54a8bac2a26a3e0cbd185514ecd1737506ac3532d32cde5575ab01aaa717969475f5e38413f20cd5882a2a9560a411e17bddc28d3814921383d892b7781efbf992114e38c23912c88ee0e273f5194665175c6f6f120edf6ce461de88020a2273a190408d13093dc04d85a404edd7b92d9f7d738f60b341cbf5420ad8104294939c9f9549d6eeb0c9102766a4132a6de8bf562cc4ccc894a3787463102c6c793c76f0b74e8d706f7197440f6f00997876def9cb17d4d14abe29e3d15b7192d782655f0a8c95138948053b020aae89d46c0e616ee1d09f2963847f6306523c04aeb01c643f37f481b615b45cab4b6a5197f126fb6488c81b9225a2ce9f7d08cfad5c50089697151b08db7f2c21da9dfafeb51093c11e68e47ee74fbda91887b57c8c95767c7721e243f371ae6fe846bfe5d211f94c66fdb62597a52ea18197eb23e369649afc0edee2e2f7045d6c23a5f3c9b256f6d17669ef2267cb59c8ad7321ee342a3aada6d6ff67b139ffff0798a6ae25933fd244a114635a8057e30da6588abdc445ddbe16c76c0311f3666612bbcabc2bf01a43c1cf159d4c9f1dd7df63ee47b3bb7a353ce9264f8f23e80fd10edd6f486905484fb97f8a574fedb3172832cd5bb5086e829e2b03ab19a5bdb34b0c01705286d2d96aa92a340b8d0cd176800027b9cb68e671c475b1547361a6e989dee1d4f19bdb4a0b8f846b1b2b89981fe9021b498ed61b4f6aee23d292dcecaedc201e10d3b001a75b04a1a8c2508ca63aa2aefcab58c9d6fdea0dcb143f1ac4d782fb8235c11298d846879f1fcb78c55acea444fcb7274e66d182efa8ce35692c89cc7a7b669cb0f3ec3463d169caf4fca4a832a31ab69884ccb0a818dff36d359160a5798c9ebd99be02af6a332da18bc9595f5e94ea6cf4835fc9c1937151bd0ba0935475725184cd9c6d64dbb3b45ccace2c97d054f1f812efebf18260716cfb80cc9248513d1c4360d130161cd00e24038597ce3597fbf69a72b3981771a45bae3ca5b974a39a26dbae56a89b72c77ffff3fee1ee81ab1d8553f521d8c4f75cebc3c5afc8d23a478a2141ea7029bd4a11607f9c747817ad23d07b14fe5d98c0144c6c95e267c5bfda28ae72beeb8243fb51eefa005cbb5e3b2b21f0a3577ed4baab4825ec1f9c56a945a71c57656871187d73c31ed19cff1c4b780b2d227467e0f1bd6b49b4b528b5c18238c585882c37218e4b6a46d43317b95e72757de8941f25b53572be4bb2cf7724003ee18d74a16e52a93cbc8af278040526b43cc2ea295828bffddeea8682abcb5ee6f8bf90e560c402048e43ccc8a133a0aeb019568ddc36b47bb5f1fcab6f7a5c24c2c1fc7cef4118b251b70e3aa556ad0f8b676480c50bf051667799f564acefd5ddadfae050b5dcdaf9315f95622ab9727eedc75e267ccf936e969f49b1711f435b0a8e4c081db233c7d7d02e46f75d88233b9c888b58763102232a02396c83f48569b3450a1d711682b9633b00c71efb235d8e65abfd01e948cb060076d2acddab695ec18396594661f44420d3c3e0b41104e8431f70a38d1fd4ba558aa75eabd59995cee839901dc51e6653135c26c6168764398928ed099af7b7f2227e15dd8e7af8a0b487e2ffbf9caaacd7f857a78d31b01c2b870a4164a8e59362df552af0911bb5cbb6d7e39da504c705cd3294a030a446267faf4a51b011ead35a6b86c2551a4b1fa1ec2d16a2c07dac66568fe6c23b5888f9d39ba5826525a66e02c2b5a82759df27be41cdeea53d5b40da7de69b823f806f0d8246daf943522f56a3dc85a2fe76fdc0fad279a45771111e6398cf71e6fc9f8cc867469eb964761a1808f25d99c6d9aab31c150883a9d83fdd67c102ad132e33c512c6b2bd59af55ce9d2cada083befb5af744507f8d6947a5a6b12836ec3bf6b8d42675a1056edea57373370d590eda14a1901238a55e1967eddcec6ecd0d63089d96e56ac354f1bcf3896b9994baa8df704f3950f764af0d1ad42c3dea8b03bb7486fe1c5d1ded107f9fd5edbdecea88a36c78badda2551bae4c849899dae5d55398c539061cb2c18ad5141150518005b9e3a5a5e45ead3ae6edf0b75a3704411353c1433b7af123bb25737ebf9fa32d177bf7ff8b0230bfb51f9d4ee3569fabd4fd1f64e129aba4cb54c11c8f6739ad107e5dd93d16bbe4c046e26a99d95219fa5734a0e1bf9c489b05279911dc4a5b9fa06b12316c1a7e5c74df565b1e6ab6859bfa360ffee1597fec710a5255018ee3644ce6f40d92335fcc3896438a8e5ab53bc44ff078bbe83fe3ca1489fd5338678a9e9538f70bd0db1583e6fe6d1c567d7a50ff79c4fbf981608af72c9ac6b1228ec078f9eb0b352ad50e84cc4f87a884ca7b4cec8551452886370bfb4aaf53f419a9a9ccd920b42ee86cc098d1621b08c1f07662343aa9d5cc42ba0f72c2bed65606e99125383279b34cdb5c6b38923ef371351f9c5ac984571752283e7c58aaf9cc69d67143facf64f29931382923497a111767d7ba01efed71182163132fbfcf55ff1fa28d266f794533e9019d425db9aa84d96d49c6853f6659a021a9d68ce6167040396c302ee62a37507f28d33640509a7de7f97150ece6ca3c0914bee9e7033209b7e294a350b1b001589fd78379723ce575857c19a654d207db058afdadbfd90d7c972938775de1139c5aaf78b382f24cdc255e80783b52fa8c49f97842f7d96710a549b4ecaeb19718bcf953927468bc72ccfe4b73ad6bca38064268b425232a8dc1e6c53a5a4fe91b018ac7dc369f510f3585a66d13d89cf996851d731b2f4179245a30c3b0d4d3b6629caedf3cc25c5bc7e2ad84fb558dda32affbfaf2a2551769cdffac7510910547e851174f3b7ba5a91281315f6bf34a344ba4f8ee213e9c4da1c7587a762a0144c368048361235251732780384542d9ab37cf7cd4937a9ba16d1b92d10fded67eebb3528d45a6516ae6db40aa0ec27796a6105db01a26fc7ce42ee34b4592cdeff35b520eeff51e86e416065085ee1b637b52f2472bee1afd5b6ba777dc7b1e544dc74c4be2d3985232dc6af459844ef45bd836fc90e4269100aa2cc5c737f1966921de36ae8c19b4c3c1a178d9de0de0ca8c5b98ad95896524e9d39bd63136d13f97215402eb4ce87194b51c2c29da445d18c355eb11b906f048e8bd9d02b33c27050e89315612d814623c79c6519224a2f3508d5c22001d6dba981ef4b2a2ef324c921493c3062ddaeaccc8e80c57df8a2c761032b1f5addfd28df9828e1c914a4950d574ec4f8f8ef55f7e33785c58fea5a22952d2f7d24e2b8ab6839dfc4c48926a9dae45967858ceae50100e93d890b730409b4b1e19ce1d86f1451db9c1407ef5df3c589d4630883d4b9d42856cb7bef1bd0e0b37573629e98360c9c7ea477b75129850edeb37bc5742c2e47e661f04a46416ec9beb155e13750861617de0eb0229e5c81b51b2191bbc7bd42813ace44f25ec48da61f113a6c5cd22958c5902bd6b35e06a3769991b9b33066922b6afcc3055859d5aa1c0942591448367317c52ca3749c13531868abec78b4e2e66e7d634b358374faa100ab3c250bdc42014c874977b15d237840962835a559eb506bff6a9b7ba9fb51ba2251bf42626e915deb333f5c759a08b91074ca3fd391c1ca8f5d0fd488c290d630b1c771979da5718531d0fbf851bbd9485dabd8a9d6894915ca79747fb148243ca1761acf0c674abbaa06acf01c495c48b7312bbfb37009ad5cb95a477113dd35e130689570df10acf4f8c6858a6bbf5d834212b7d99351902f7af996568ea55ae33f32b7dd5737e98679c03b20c32ebbe120e9dc3a43b069f8fcf46a934b9e3e861eb87b1c884b384b5587a40df42112f759c87b8b0fafad5260c1ada12975402e8d7517244b7ceb199692c665e5fe7a0b4a0d6206ccfe8e22926da4031392be9f6b0cffa2498a627fec318764f36feb3583909c3de05b8b6c99e28d2827db435cbb3b5fd9b4d198138aceda0484c3055dd1490f037cdf81f2799e818f4405874bdcb9425e2587d94a3f83ffffb30fa24f6d4cdf796da70deebf4cc109323ea34ef3bf54ac75478b1b47646654264d8922185068ad06826420ad3c0b595b315a82b341381646d8199db51bbd1d5815b34e73d71d87eca8c44d120d4c412935711dc72a70e008bee5036a77fb947ab1f4e748dd40ba13a3a597698ed3fe8abfab87c64581f9ebf9a2d20a454de3d797292c3afbfa462bd421e6f7075d997b53620f69d6d4fb0bd02d619632d6fe651dd31b4df9187c8fa376cf1a743c34faf4d599ebcb5ac75da6248f4762445457a51b48657c484b36bb12e9e696e4602015c5d6ba0aa2cee1ad2af557619cd19f25d23ac8b5c4a6c826814207ef21c7a11221bade6b14c8d659f91dbf18436e1a0134ee9d5acd5e368ef3d1f266202f1d94df0eed4aeb5bd4eef348cb2e19dfd7f5d0c745cc5a1d62fe7ea882374e363bbf416322cb9fbf8431e5d3bddfe4a0316664ed03e0e16c8793608ea2eb9e560187b8700cfd1d1dc386f0f1d4968ac6f67ab942a4c81374b7099aa3fb316d6a098faef8ef69fdd11ad88b2b9af05563e311aed837aa29784e46d7b6d9fbc3843bc2664f4245a87d23f2aeaefeb278dfea659cee0a50e1e63fbac1d92125e89e93552168f29f87b99c7d574535bb467b8929ca194831578172f4600d75927d9e094a85555d02e1b0a1ba0b0af6a36d481020259311747a73938f3d5c2771e7569eebbdf5fc0e5928a45d3247281f5c0a84c48168a05151b83f79dff337425673efc5f6613db52a8067909379df92c431edaa1a45365f5a44e53a4d0f9124c5d0e41d886850b6c8c76e652278e9f7165d1721139d07cce3d6782c0c327b39a27ecdbc8eba2e8551199c2e84fdfa880fe708f25a0207e9b37b30e708a242017a34736f18117320f729b06ce44412458bc0426e5b1b2ce3886ddfaf3b7531826d1f4bd01c8b4e7221f0c88e617590d2167a43a8d346a6f3cd9a14a5198b9ac82aabb4a06917f91b7c8f0feebb60443122364a8ad9184c5422c7188f6cf95be490d71618e53609b82322304227565747384dad79fa9620d6a9a383005ab3ee0b9c44a43d155500cf37c86c3d515eea887e263822e66be1f3a6654500ac7eac666cf990993b175b1fe4e0a76c147b3d6b65386ed63dab363b4dcb1f73b3f4049b642fc8c2e50ab7151d3a347573956113ed29f0bbb9c4c77360817489e34180892a2f791d4641e668c0301cf357b4b92c77e14e5b459f63d67b40c86badda6c4722b988e7849456d50aee6e7470bf8f7be38c3c773372d65f18bd8873d7b61de8249b8a8c7ab1f65d047f972f34437a5f2e8a21033a8b532ec146d940ce75b7e5b6da2e131f6d66d4f44b48e5aadc63c9c4b2c0ad490017ad9f5c6d088adf77eb6b8a91f69f28bac1cb700aa9926d36169336cd84808b424ec706135607b20b32de8e50975130bfd0fd64701121eceddf10bdbc72945851aaf3c6f851ef18737a213d5f6f0bd6953394aca410500227f91b0b1f38b2ac50702b8fed5207118004ce364b997e951fdea1675e9c7b4e3e39cec730f5ce7a11ee1ae6856358282071a156dd5e05bd792ae36b09d061525f1b3f6fbd3118f08a3145917ce84cd5c0dd837508b435fea1a549ed715d6199ec8507135a8213b9b1d93fffda66f397f1fa6eecacf6097ee68720f39d2d2f47a9b80bce310c8eed453223114d4b5c9412c4e7ef6ad9fb8a79b31bb7701866e3ad56d4e159a72dec39f5ebbd022861d6357fdc31173f503fb117f90e0901a8ecff1562667888a0c3cfb362ac5d42f2a27eed76b1bd06e0e21d3787e1ab5ae194ffeb129b1a829060d90ca955e985390f676dd822e6fce457f4b49fbdc4a926335737d422e7c5c2471e570969262eb9cec52831354f29ae5b9ecdd37bda44de9d2d22528145e3e8d1ac31090f8c90039dd976654ec11af7f9fafbc67a9eb120a1c226e749243b2581c4cdfbe3e2e98504cd3d66181c4e08acfd08adedfbffaa5e598c2b09c655f5ee71d06e61ec8de83df9f35b309d2b740ec51d1b0463d164a9d5fbc103ed9fc66b6003433b81942cea36911e114db32d6aa28067d1457f61aac13820dc703d0183bd3ae1749e3a58acf0629d6581ee376bf6c5a07c33fcab62daaaa5668946dc31cfbae3ca54678f896fc44d04d25dd1a98d91adc8de49c78c21f20a4b12a12e5aa1a710ed40e52404064ee8dd8d31d456b8668c4a7acbac534f83843872169f99453f4d7286095a37bc153d73263faf0bb673a20f8c763d29ae16a0d90fe92e0302e1325d6309ff3263a0ac949ad2e6560f5ed073d437278d3e5eca64448658b3d56b4b312f5e4bbac74453f6e00fe48e8a0f42e87ea79c8b8b820a20a5d3394005983127869852f8d2116c5eda080e6e349c7453c305a1d16696f84c42ddb2031dc6cd60ae39355534593eab84290cc817a9a5fd9186c049e6f40d89e45ecf0f15813ac7c0fe99dc81068688dd875063a01800f13dd3e3f6e1628f3fbf4d659c0451fa57bbdea5474a6d227e5c252f8b020adff7f640e66d5916988feaa93acbaf8ea6b08caad8d739eafd03768e51da2e0bf46579ebbb7acd222cf71ea057c25f37e85a9080f5b23454c0a81633361763298ed2aa9cef5555f21c45ccd3797190ca961cac06f7eb1aaf007103a36b516199772e7198f072d4deb72eb674a7a12cab8feb5b64ff160c71069f97448f39a44fa122a2672d6539028ef3c120a42f29ad0a83c60b38aa0842bd6e15aed870fc9207b92973ea0765612496c05823652a9a0664cee852f994d2541e5d90c840f02e5b770e3b67bdd363dfdbc0db6aff582092f18e86f9e1eeaf63674825c7c3788b994bc8b4a9e15c2545ae2be23e1f2b9ce7fece4495f75e3feeb2c4cf6726272408f7972342bfcea70d9bd586901f79e439426b117e2c29e23babf6991200367f6cfe6375a200bec2e3fe1aec807e0aadaf6414cdf1312f1745a9bd8e22bfd26526f7d25052ba9e28a6555fda36e52008597c7f8584b1d99a4aca17165b258acceacba536baa3162a1d128ed8c6e4d83b398e50d93280185d5a9b811fb2fca15cf2d3a9abb31280ef6ff1b8fd6d57216e6c19819041c4f254451f7015e3143b6437b834552d272fed61f4d4835eeeb75b5cffc3a81f4a76991fa0f40227b267e34f88a017391d8bca6a0ba56a35d12ac44f385721d9238ff68528f9a9e14d3b8b1fd8cd57ceef3ed6fecc1a6414af81f1cff413b0bfc94a67f8c53c5c3f82ec5f5b386f0354bfc10ca57eee4eb3740fa5224f86a6967356d63d856b135b13940cfc68bb4b855d26566062ec3f76efd7c67756907a534713e51e540d5cfc9182e5ac2b7b3e2610bfc1fbd93033816d429cedd7938b2e0c6340bdf2000851b214de69a571b607691ddb4cfea05e750025d0744182191a7b675e3fa84c5d7ce89f3a7cbcbbaa2f68439bdc08298c7cdad895694e72686802964d56451530e3574178d72c576a08fdbf1b076a8eda02e30c3f053a68bbeacfffe47779298289808fe2c9d6266052f6b8a7ec3f4d92640019cbbee5ae7cc10ccf7d8b515c1d6c41d31a1c713e93e40603a2ef7e4a1cf7ee0ed57a107c0bfeca0ad203b959f662b9f0cf9a5061815da8957f177750c42a9026fd535d7c54ef4af6be2ed3c388adad6e5d7f03e110c4079169d568a4b27f70bbe3da52ec34ad0f8180d8268cf6cbf34a5e4e95e12a610c27cd8050935c17b5a867e1d16705404943b71eec77014fc8cd0496435e88942933af5632a43de876bf0a1fbfc43f1f6a9c7b787fd7cf49176f1e5db0c78b6140a93cfff30c8798d8889aa2749e70d09d71abcf004117bc055e2e1bb279e6d90973b1ea0a5a758ae378c968d081492915a6732930bdd104b0c336503824068f095d9ebeaa630ffd8f12bf107678f1420f9b085d94dd53dad28bc94fd6ae33b1e23a569fa76b30d1a9c2c7cc1d2e65bd57eeea55aa7da599855796ebbbb80d222ea40c0eae96d0f6763ea43c508d5e250a275f4187a39db5cbe098600ff6fcde60f41b8ffc82468199fed18b6904324617ca32db304ae991b3959b74b5c10e8fcd2e2ec7a52e4bf71bf37b5faab4b82e421b6e5e6b973a5c204c515d9caee1f0ffa4c0f8e59b9d1ad2d36e59e64ca9d3c18337bdf75d1a60a0f9cfc767da3d0477e332383fd685245e5a2144eba56db4eff8d6b167f892445fc14c66f34f782658f70a28f4c1bee7ee4c5fb2d9b9b7c63fa8a934a648d8d0607fa71f2ee1194daffeb6a5a1fdefcbb0645bfb42fb28e27fca71a895259cde467c860ce6168ac69c9be7ae196725bdaea1cacc386c9cbc9afa6b8dd5af7e916700330a90106f5c0b8a00cb6eef6dafbd3c7e070d6ad97e8b295357b292c12867285b6ed2644bee4aa05ef37c1d7143c0788a72f7da67f0229c17f9044bb912c59306fec1bcac90c6a014da3940dafcaaa95a86469cfdecaa7cc147b85a3f71d96a273ff06b09a76c622250fd3622a79bc75ab7f62f255a1eafae41b5e45f9d256717fd156798ece560d431338c9ecf212b5688bbb28ef94dd17ac32ad2e6eb2b2b22404bb8948678b30d24b91d13b07463c4f72cadaae011ad3ed5a179df74f1771fc016ef2a801e40bc057de5af31b1dc8911db50b0273b3b92e1b41cb6b1520cdde941dae159366b06d58a24f4b71214385c8ba2ca882c6526ea1477a5b24b4fc8488b7a4d039f973fc6b25d45013aaae892aed21471d7b4e7248e40c3f993033d73fb873d40a2bcd662fd6aef9b72ccfb9b8963f94dd4f0befe84babad338c10969930cb0175d628f841ffdb1abfd614b7023e6faee6232c80c2ff7e5596868a97dad5b131ff76502530bc51ba9d9a7b01499f75e1446f4648474495c2d6c4da5e1ef404649a8a05569d34245b9e95221e01c7a80b3850fb02b953ac6941a8b6f30f14d7e893079a581fb119078c0e079e181003934544d9807f3aa99e3339c294391d0d8c6ee6588a24336d7a2fc20776e47503a178f4def82aa564fcb0626389273e2797491920e514e2e58a5ba2f0905d9387863e4c13128302ec942c8084095ff6c6d56cf31202fce278842fd37d8f16e212c599d4104fb9c91acd3a8c63440911ee40f40bac7ea0375df143390d9bf628f2aa0ddb5ddc9c45fa909eae2255acbf8509b3c2a68f2f11244d33516fd830454083bcdde63afc3d1f300f1781ee5a1d9cfb087f45942d6434a102b9e3a17b4623ecc8d59a371d7aa1cc2e5dd94da617648aac10fbf87f276b56b693facc4a9aa5cbb4ad777a28cbada08565af966fd045583d0265aae0b6e1a255733ddfdf53ee65936f3a6c946448ecbe891d709ddb5c5da38596750704d0d129988a93ef0df2dae53fc4e42b74ef22d6b33deae617579f6efafbe6adeda86553019c5be78983a42614ec2973f0a00d52b7cd2e3bb4f992285accfcb5e50c496b47251d33aaed82b9e3abcc64301a7b3e884fb68550a9bcb67c54f1bce5a75c89b5a2f83a999dec42d8e4c7609b5c9df42cc257b0e35cef8a473273602cd5a92805d4459cb3b7e6e309b5207720249c572011d06b42832e63b3125fd52b4ca6e4d48afd84be285d96b50802831a808f608fd303a9fb951c13fc21b65a61de44544e446bf05b2b27b8a86178587d68c3a0071892f7fa175af5938d403c8f35649b168ec7dd461dfba525b75b4d94399dcfcc2843b57c752a565bb5301b447bdbe47cf8ba3d2ca73adfa794d9f9834bf91569bf1dcc77265901f3ab35768eed658feffbd56b1d68ad9181abfd12d83227e34de4130c82c07811130f2861908088992adf486a63112e6ffffd9d163960118ecdea000ebdcc205935400e7d12e087cd4cdb67963c5377daa197b324798e16642397f200117c3517b5e01f92a47063e47428c8aae427dc87d7be6719993fa073dd1e71aa538b240381d8c3812527a7c89cdf0722a65c96ac672c859c5d670903639f8f25daf039c5bfeec52f8c73d6a1e84397e5944b0d5252f90e81ad8351ca6faf0b84eecf551aeab514d9b61474ad1781253de5b46ad4e4471b32e813f5ca2669688a1dbfef42faad409be8a164a7c6ec0fb188ef2990bb33e207bb1a3a4053e1bb623a85e0e7bfebdf2e7dbfe535324c52e6207dac3e558a0f4dbfad52907bc95c8bd9cd5a8c0898746260a643d21d7fb714e1d534f1ee69adab48cb6278e4b4f925a8f0d845bd381fbb2f790ad4c9d371ffa7a446e36e2cd95def323b657eda6b57a6812a54ec5bb2bff08a154da3d96bb3eae3b58e9db6e46aebbc13312d3c4c2ec637f18faf0740a6a034b4fa2f48bc44b3c6835ecd6a57b786345823afd3462acf0ffd821c5e0464d329928ef1640fef11d731442d4eed66c6b73c7872fa5eb76eba35b7ac1508a8f0020ab3ef5d887360b3e58fdc140496ab0112e9a8eb08bc94aacc38b537c2717a04ab32107d3ef1ff7f2c516bde3ddb5d61918accb7a2e65fec369174b52dcab5ef43cacc0ed3498cc7cf80dde59e83fbcefc8d27b51be10fb66ef8814600c8f0c852c8678d268f8c10fc15200f8d3acfb9645a8b066ae924bcb66b16e55cb961cf289a8ff195b6b6be8fc5ec851ed42063f633221735f4d7caf1ea5963bd9abae63cac2ffa88805a2ba7cb831befd23e5ea05f1216cbcaedd764943eec2b91d624f4270473af154d9884f6478c1effed8bf60711526c364db4f968db2654a905fe41a136d9cb63537e20d99ff3fe6166b9570e488bb126d09f8ed9622699794bfc4e197f1f6df32c14bbe64f5b671b62f2e9b9a2591044a0f138ce52325ffa56aa475f90c773ba849693bd16649bd124d0f926def5e43df2ce4e9b71c206a2b49cd6a4582e7b66daf9320e640756478f33eacc878becad1336f603303028d04d4b0ce9e6288507cc1e20292f6ead3d5f78a1152a7685c208062274e7ae44af7a7d8f383cf971f7d0417ce5fac6f1c8fd78f83dc8fdfb13be474c80d42af06cb716376e225d7b8b5e661dad8a7796f197d3eb15f5878c09bc2fe7b0950b8268fce6dc3f21785e430b749de049a4896be3996c35e07afe99e666d791a6b17d3d2754abbb12a9cb64897c8fb8ffadf7c07c2ad2cd79535b4cf8b8bb3f6d02f6d39e1381673c30ecc79df9655c4b95eecbd50e2d38bf347ba6092f7aa7ba173e592390cc0938eafe741577a97192c6fa97f965f6af3cde1876fb35c08879ddceee107036829d7b4ec021de6944619252fb5ea22b492046263daf63f406ff43d5c530cb99950f62e3fd0dd61160783b4f1c55b32b486366636a5ac21234860e65fc12307cf26e513003d10273544dcd324bed651ce5431497fbbc4e500c3d3e4d950b953ea1cb073d33fbbf1b3cec97aaab642e0e1ae5aa2094971c70e92da09dc92441a4a1923e5d8e7c3b2d2e5db0d96bceef72a3c3ac5e6edd3f6682364bbbda8bae60b0c1b144021d0f8d7ebec2cecd8948ddcde3e2f06aae0e880578ee9935f82a44e451d0504498d38b26ecb762f0f9e9af2b765e5ebd267caa594f78f36d2f00d43b9ce45da89b023313b4983870bd285cc08ebb4f4fa15f3e10ac48ab149f509bf47d7a4d94c588e8907ad8dabe112cc87c798eb56c3367b7a82774c0e012af7d6f94cbd4114603ac9df112dd3720f5ec32b01f1e4ca5c3159405e9ccd3047f83b8e50c743f3403b670b57cf2a6ffe9cd605c9ae2d1a08be7ae7803d7f71274f6dcc2ce7cbc8c2469bf63175c80cff52ba5073c848856012ab547fab0f3ce9c9c650fb3d88d31e80b137c1180e4b2088a8c647a9bf32502a5cbeedb92d6da766dadc165b6e8cd30ee6181ed509ff1514d5dfea8c9fa708dcc00dbaa3bd6678937053984cc219904a57c9c98f569c7a7aee49e82cab8b3eab5f5ec81fb247d447414d124a4444e4b734d337a87e3f9ce3f8a2b26c51dca7422c2ad57fcb971ff2e90d5ef159acdd48233c1d6920e5281570b9dd9d1171116fd6ac81a3cf29136f2e22c686130ba73d8b22a7a10e87378c66153133bb028c6f90d4e510bc428905be4d77eb818f89aac096e3a2f4e9b6182632090bae42558356c97db488d5c02c4a82aac5e654b0c9125a10054b7a861a36ef93b19a1bf2aa14a2e37b1da5bf50b5fe790cae6ba8fc1cc0b050ebe149e609114368f2a87066b9912b4f6a6fae5b1074d9302dfa46d1ec127dda8630bb17b3958f5b7e858bf503ddab443986a0f3deac33fe820a6d33b1564787bebdf9ca9bdaa9707faa27f15a28a2f3fc5dd95ab8b93567ffbb7800a05f4fd795c183ca4586510ce689e2ca5fa156dc1b5ac3443a25eb0262a9622413a14b0ab6ba4d07dee16f3bcf64f461048b0a689a2442f1418ab035f83acf6951ac240feeb7fd43520b484ab8c992a87935d5503fe2f75fc2a3df79504de982b353b52cb3f112f0ea98dc98d1daecd58cc1f14776cca22cf51feb4b03849253ab25efd30e205184d41c80c2eb821b717926efd35b5e17d27e58115b745161592c32cad9843cf55e0dfd109c56b0e8a2aa0297a247aea4f2f01f679c1afc395291375bf377b868b67889e387ad452c148b4a04086e554490598d7c57c0e03398a2fca6c5d70dec21fb8c2cbeaf67c8249fe8e4f45bf3abf6f50df0a1f7ac3988c573f9869dfda0337825ba72c739eaa40b6939740bf95d2afe3d69ef0036a141ba5155cf0faba1b11db432db83bb4488e653b3a9909053d023041795752ee35608fce491ce33a519ac820daa789b80fdf5e81b41fab2f4e963f1dfe855a255d9b33d95e5f647cb0393d035cb9edd6543e847253ed59a372bc98c5b4457a07d29e39de5f06d59e3be160257bb98b2bd250cd8cebe13f096c9074ee6775297f8a9465ba30211107b3c0adbb95211e7ef3e0c8ef1403bb40824f4eecc75657636c28326e483077a62dd429b9932882b71470d1fded23cf19e15c0554e5e4568f26a0f4c21984daf148eccb398d36e11154e9d9a4a5cabe21832a744b671dadc13a531e41702f619ea7a3720c1f35b5c5ef90a3b2713ff61b4226f35068bef354f6674ef28c84a794eb924ffa53ca1e30e73493ac0e17869bb58709242d073d788efae9cba1ff491b4b4a31f33396a330f5767593b29ba26ae32886fbeed0493eb4e6a4b4166021f962f86933a2671db12eb9f82d90558b65adf7964859948db5bc5de04ae6b041dcb565ef8d5c4daba47c0201242639ddb87f6751ca0928ff1e62eef3f74f29b3e06488d421a61426a7bcd3f62bfe3950f027e8ac3b6ad297d220dcddfe36c8bdbd3830863c84f82fef16663679fbd9d80af2b090cae44e6eef10be978f942f6fd717f877a970ee0a24c00a09dd7305a52f78da138d3661e31552eb34b966b7575bd7b08ab38138b86ab849473641f0d0286adce7b88a145ef1b2a823f20ff77fe8a37c50b52ad0d3a9fcb0378280a378a6af8183edd28b27bab9219af1166ad033fa29bfdb5f438911eb7ca9f6605d7ca70ce1a9a0b639fe8aa1d563b8ac1c5d213f50b03f47b7c6c6ccb3839289d2dddf745e900f0c85efac5a56a43458e48e477e275799eb1fba59691d28c7a4f4809919e52b33cb737ff25b287ef1277d84c92ac9a5c3dcf42e687b102d3a78856fcfea9f53c0ab9171eaff494cfde871095ee96e96ec64818e72f80fa7230a9a2e3e4c251e8eee3676900e6354a26ed828c286a2dc9f54b796d8ce018d50cba1d836e51b19eddd9df7a665057d44f518f236dd72d2957454de237840b486d0a73032470670abc3e5f622bd03f215bdec3ae69239e10b269ab299cd9c6da7950dd4f3bd918c6cd43f1ad0486258be6835c9425939d42c98cee77b0a7f687c265c16287bc44c9a640c2f2bdcc64db2b273bba61c75a464fa86e67a8ee0a59cec6985a3d2baced51ff72f1a5287ac4a5c87d4145e12728d9e6da1a34a27d8d2166c01f83b80a2e90c2309721f338248d7aef34e15560d3e0c39f7237681c09df741374015d3feb889c4c32dc54fd8b5d255ae8560bda7891a6882b7db08de01ba9571587b51c069ef10ce6c74e7a79e6c4eb8e05eebc8d113f2fa804e10f176bc74900537675c6cb42740adfd3727b0e4757e93adfc3f9be9d042ad424be30381b02a056e40a658e4179ee1fb3fc6b31f3a5160edb6ab9468a1593b16e07adae05b8deed4ed5fc404cd2cd488ab9d494d161f37f3a1d38e3d21678d687c829321ddfdb66a86691ab7f7ba0c68135325223cadc68fe2dc2fbf979d89bc0eb8784aeb7726f2212d658714b21db25748ad78839a4e039a9db230f73e4d96e9c108095217b4840c7f655c924dc0df97eab2dc2d91201f845bc9733e7f4a6282875d78e9f5f027e165cb8922e01496a2f3576ccdda07a29442b3bd86e36bf555863908b70f5ac5f257f2ae8f115b793a62882d0d7b5dea8f428546e70679ac52205f725ca2d23202f2017add560cc5870d168e5b116377c2e77a8393d9945bf8d751e5cd89800e8a97b29bc91f1e7768a38d71e5d8b31b651c48052010cbf6b9baa4c1663c63eb91ee45a303e93ee1454901df95840b69cac6c3405d12e2c77a61b5863633004e73eb2cf1d999d0b950940e99fb9ebb593259e8efffdf9f592b40e5da6a2e9a6da437a6d7605b373e7d57294f4e06cd6bc106b94a1b28ead04ad78d2ff1e269885c637f21c84d92928a2a5ccb0a791f6c6c671462b827b6205ec1af85917db19ec54c8006f1caa2fe004035b12f135c0a70e83a864485763856747da65825409116167042493802cc21e0deb8e32fe8390e930ae2402a4484303bff8d74290fa043a6fa7697651135a2435a12216121560c524842ff1ac553da91ee8463dfbca1bf489917f38bb799304c3e5bf2a912d2fe1b24b5ede61231ba47de1ea104339a02b44c5e30dab257156e62f1abb162f66a1de440ca53a496f61705cd4de914d8faeb3295cdf1176fea2696d0a3f1a160faa8171c9fbd06406c74e52b289dd779dc69157b27d8b18c65971879f0b7b8edc557804e332a2ad4a0a636ddecbcbabeba26d4b7bfbcc3c09809f4b3b8c8a7d23c7932cbcdd197a48ebc228a220dbd6a2c8c9b90984dc464e97247eb0799920e31c3e3764a2d2be76de3ffd6622f625d43e945ae105c98f8dfe589f4263ccb96c69044e34613df15ea6429709251eeb289a3d135542b260fb11847c5c9b4a9abf062c28f48ae94b652cdccf162d238ee02209eeac18e6ffc5d2eb5ec94aebad2ff9cc8b1dd41afba5dda0a88c4f141264d579ffe78f4b5053f5a9d01681922564698c26d268f28c948708a35dd62b711ee6aff635937edfca6e2dbba0d8edd910fa9131679eb9dc96927c545eaaf2d9f59dfcc6ae1108431cdf4730e26ba5e1f651e8a953774ade03bb300c25b2a60ff6b337958cacaff2eda378d6d6b97fc6b30b7d0539bbc35477286869b08c4a0254e2f3c6924ea59bcd55ca13c3dfa3bb29831ddee0c9144772fc4e8ce7abc7ce11bec6d5bd60db4104165d19e5e53abad87f07a027c29aec3f0d77e72f27486f895c6d2e6017656858d5d546844a8fdd12888e267778818b62cbf78ea67d0b1ff6e121aa37b033160d69f08f069acce3f3ad51d1012ecf9847df146b980b50a12c6da532a82be66902644844035f1a27485829829acc2d4d41cfbbffefeb782baffd0ba200e831e0fdb6e2118f2885517c0b9451ebf711382f41211de5d806ab96e058ec65525d6d421f46a771c50cf89a63607401ac6f17b0cafebe42741791449ddb143d99004e02a16a4f50855f2a06733ed7a5a651441f87a3d4691893fabffe3d0ed031dca839143b1800703c6f8c06a021397b2b621426849726f54fd18faa957b62eca1636f553e97845c0886a5dc8ce18fad89558bc93c33a74dfc0a9cfda65cb163e86a231e1c2bc4f7b97748b2d50bfcc653423541e78c0c4e79a112c9832614cd1b857e85bead8b1fb820fa264006c70b6ed78051e156892620051c751d285acb5563e6ff48805362f291153a1c0a4742932eeef326e03803500c3e800625dc13ee23e2345fc60228790591d039b6710a011b8ec4f5a5a7925a3e0b6de083358a3403654b9e1abca9bdc83c85f6ec83ba3cd461545db9da9ed48d761022e42fa442ea7da851d425ea46708b87e090ad0bcc30b09aa8fc48a9eb23fa06c5bb26c6df2da96e5436e284315ae92ec13fa1d10d150d83165f9643e8d15ce4cae38df91d377768f0d3d6cd5e64d3b9fa3b25f88ac3eaf664292dfd6cb38777651d80dc0d59430765dd63c33762834afd52be56a796074d7fd13d6cae71a1cde1dcadd8a636fec6a9ed2e2e18a3c58a3103ceaa77fc25f26f1492895d9471887cf8c009721ecb9c9a01015931513d3ecd25e348dba546cb81ed115905f482fbb1f77cd98be56d1a0e21c1809dd7bcfa9a4582ef874d4f821f4546956a05b756830ecfa48f17bc458a8bb4380fe092e5271a92d4db7e8f038d57ad61352549805f7c4d981b7797bbb0d5d305734b029edf605115989d9b66a89a0d699ab81a20e8b3417283f7a7cfa57cce1565ffcd3aa59f4aeebee69f3c8cd96ea1fbee14a0783b303651ad052a1ce532c42b0c30499f08c105d1a0fadfc36fc928758e900733078bf67cb53c4dfd7d6195664920b79210c84f9c0f09d0e422267e9455b2199de51d38a5eca237cc9c3f520671d77ef0fa62b1b2d223b0c5b61738ddd6d236f651ce2eb5ac3bdd49690d3b1a9d0f49f7bf33fceb0014e082224b6ad38d9357001d3e2c704be8aad90070f2d338e268372a0f22615e25555a890baf0384a828d214ce689e59abbb4c9f251431c13f8c5518c73c9a873ed6d036be673e24e0066b010f4a03953ef55010b3d789e9348c53592d8a03c42d476a34d772b3097bf0fc9918681683b3e004f0be0703e3d3a312c28961abb789d7b7c3499b77e16c4d591fa660c48216ead25bd8491b47c313d600acc419c7ae83c7aa8e79fd8a42f20ec766e3e99e76ce01d6208b81a645bc4d73d7a9ed39a7c4086f5e41de24991af6e5e8e686bd02adc30c25059f10fa944e1c5a8097a7093fcea3634651d5af103128aca0841425b0902ec1694dcdead2dcf83d1eeab8b112b965ec2be27dd6d05560221a38ea7df6f5b60d4099756238714fc7d10f3b03b527d1b82fe9fede0e221f338fc54000da24401adec54aedd17e61e72103070e3b659a5124940405a47210d49397990a12ec800c63074b481b252ed171dcc41b0b9bcc1345d4b1d61cde473a9e1817eac2b0b6ccaf7c181a70ad209d1d2fc81f034cfc245e7e24084e13726ab5da442802913009d180eb0323c647690cd4983a7554d7b5f8d5f82f2a63624071b4002473b870ce8d6dbb776e6aadc276c533d3aea2312d9b8655bf8965457cb6c6e3970843fc74df02bab05654348fabb5f5268f41e7d2a986921a6798b0be32f7fcd8b62a10637016dc426535a38bcdd4ac56d1d9a7f9e9be772adaf33ba819fdfb44d61bcb09fd16783022b567985e4d32e6b74c0176b730273270ba7f5e7fc6e1fa0f327d83806b683df8529396afb1b03ed7d5f21e883e117885bc507b95ec1d9f3f4ce64a25d6bc984d5557f1a3a7bd04fe6ccc6b51c9f20fef61358ac8e4b33c19317c455e883c1378f836110529164d8ef03e65be082dec19167453100d197b46d4e03d53300f2c9b146a4746e896114ab218cb43fb5318e1f0094c57019fe90d51be4589c7c7da539cdce04a470e06da1affbf92b3507c055eec89e5cd09563e8260b0a29c7c9670697ffe4d82a0198957f1f865a370d98a51f358b150e366e9872479fe35f466651798edb7d814be0af587241064d257593e7173e178c8447d6b9a998e515380ebdd8094ee2549d1db82be9b1f63c5709d8797d237f5fd4f1843541e5db3c590162e24b17fbb01e19f3d7afc9d23f5bdd7b184162d17b0fc04166912262b6bb2e7263ac016eaa1d8c48d1c268864bccca1e2ae96e8fe395c30ed6699185575bbc84902ab06b6f8e0ec7b140884c59aaf19d4336e53edb0abbe1cfe9c75cd6b9eb60aaa58898350e49cb74fb0eb2223123c67e9c2bb92bfb5f40a0c79674bc5947c45fe2999a38fec65537e83602406e095383cc3954d1817a4a0098f591b8f6c45e325388ecbeffdfd2481139aa6cd1755f2e95ffd562d1df52c6cd507675bbd4194f98d0b777f55349c99628244b6c98c006e6045f13f2ffd5881aadbd2ff861bf49620ebf9975fe1d7145128649c0406ecc210ab56c6ac652eb409c33a12c7f994a1b965a43a1617a514cc636328f4a3c65c43f144d4afd8361c0009833446d84880e70d66be24894011ca0af7fc3910b51d0c025c03270195c40f0a49b00e2047d10435df20530f974f72d0b233b5787d8b3b889d13c8d949339c0bbccbd8e0da96ee7d63f2dc32cdbfe4fb3b0c21afcf236787378dd9243207154def2eec8a4880bb821d0aa81ef898147687e79c117e42cc3c48fc83a8e2f57a85cf63104e68569c1b2a87312b1d282f6a45471cb3e56bc22dd3949f06ad8e47a2ae03c368a7aba42c90423b5281d1d8eddaaf2204b0ebc97d04965043420e8a925e238a3686663080d90fbf79e19be640404b47c26d3fd2dcef57cb430cfeea3ea0a274261cd6ce90c2ca7875c9b8f077a55af326644abe596bc9460e459cf7085c992f53da93caacea3787d9afb2ecf3ab76bcb3ff9daced232a4f58669eb29440ac4bc6aea459abdfccab843f543afd7d16db67c51f6001d7bbacb9dcd939ff4c3468e669a941e94dbfecac963e7eed6278a830396bbe7dd0772601f2dfff8d964747e164819d9eacff896a1baceb6eadd2eefbdd687acdeed57463daf8bb12fe4c9fcdc42bc51a69740018d305a228024957ab42329888472eb186abd289463cd87dc3d62c81b44fbbbf017e81decf80a00659b9f490be3bbc605e283767aa766729ff30acce2f02b144f5c55a7d8d2211c96c79462d16e97b19483698fbfecdd7153feaa8e5cb1188474f43e08bc1b00980422efd910d6d0d3b36859c76e98224d57a0daa998ada10c5a50b8a11dc103e31ed20fbfe032c20271dc865e7dc48cdbda5771ac965207fcbdb1457a4df87079382ed8c9a507a79b67827cedddcfa9f1303db91730faaf5f726c8dac3a219045b223dc93f6f5e342b82d8f18e7f8fd627c82f2d8c24ce9c2ebbac850ead27accc4bba189cf081fa01a125ed8c0e2e8ef1795cdf3f54c2c3e111991ff75fff3273ecff0e240d02f662f3b94623d2efe2bf821f50fd56f955c7f92a1941e1c8f28103953632ebb00635a52e10a8cb424a9e7dc850745714e3fc0d9a014e17c80333475cdc7fda2035b1c1761b3ac58d6c180ff958f3f5b80e866b11afd1ef481a51adaaca127be243185ba34f62fc4505184eee00784928f0ed08259e8a0429cb5719bcab4510029418fbd535e17909710b2a0492a5c575ff112403374d72bd142eb465c92f77a66afbbc4416e3b2a1b584ce7c75d3013e04faf0cc539d6f38ac51a8f87ce7934ddeacb5fbe4d384de80baa754ee177a3f164fc98130518a3700b1dc04839cb1cde0e20c8c6cad4086eb8c827496e8e74a369bbe00f42313f5f2fa7bd90fba8898ca44d6563f97b424a3d019e2fc8ca7c3a2bdde8ae72ea8de728ccdb5998cee7ebff6620836c98ae6da7113819ba50d554e882db40fd0650d3201d3a33557f98f1f8581d3b83805f017d93efff314aa4587c1772394b0e9bc3de72d386b7112094fd968245f2d0eb43afe8a80892054b8bc61cfa79b1cd50251a6e5a52378f9512360f87cbc5726959617ff14a4f13304731f347529c26cf8c6d129134f6512d1d1b7af6b2d6fe131117b66f5cb00007a041a848ffe8185195107e082f4e4006df775189e7d05a482b76ff0fd757498e02a8ac5a5d94f46f355cdd34bdce116841f2a307cbb76bd9a6505420c92cf6b8ab06003b19e34df4ebf4bc50feaff57fed270374086a905835133c43d07f6cb815b49895875a751e08792990a82584ff80a9de54e251ba135deea11150b87a69b26dbfbe8b2e33996718cb60c689e55491b41954366fa78c4be96706e438273fc5bd73de98935fbaabe4f81b6bc4a951c796244c34da77dbada868439280464df500aa02e10964af011dc73d15ac5dec92a966470a2e0cd7602200170141330053f8acd1a26dd573384b7527f12361918ebc9d2ddeb4de1f0bcd2703dd89c4ccd0df71bc47d70524874189518522e2a2da86ac2fe991b361e7396df9b9204cfee999634e4a098387fe42a790dee8878ef2636a41d0f900faa4ab48739bb5300e90e8fefc2c34a0ea4f2b10584fccfc94ae3b1b88060ac5cd294564a14a1181a3ab903934f1e02be0de4512108712acc35136a49ce52078a24846352e5581b77c97045b81756d0abc08bfe7d05c328ae60473b0555a94c2d1f34e704232781e3ebe2c0c3f8f6048dae9f8acebd79f2151cfb56c15ead54c0108bdde35ff8fcf62878b5eadeded85a46235dcc4316f105adeb6575a6a6caf449f7116dddfa52b69fa3f0ca6712cb384455af8b901b0eefc067cd5b0e020bcd386fb2f3b85c296a70cf6e66fee1d82035ba07b35e496f2de51515a7cdcd25431d8c3b4c2c23c1fa87cea1dda8ca87c65f6a7c9eb767e8967ae224fcad7f1e86a4ba64289fa881a8fc892ad84d4a6aea4e5e620684d637e2fcde1942886a97deab2434df1e1a01d0dbfcee2039c33a77f36a27d3cba1c97e7dc5554f0a02f8c6dfe56ef61827167630750c1686dc8175e12afe0814d5e6df0c2c1e81e152c287f791f0ca35d3d10bab97d863b9d8f8cc78db699b18a640a95d235b60d0b3465ea864b56311ca435df9d0733082f0c7cfdd0ca65e5efcdb7c012058cafb371fd30c4677441396130768d751c904c966c788dca05ea52b9796c08be4ad272f85413a80f33d095d97ff6a13466939bd2fd49490b98ec995a20659be77010bc69ccb3dbfeff092098d0548f14e29a840ba82488b73be540cbf5367e287036fc2ae9e281b181c5c5c63d20de12d765080853aa360fa82378604a7c57f90257aad527a2ffcb12510bae55e95b9ab29926cebbbbd48b211451336c890ad092ecbb62dcc5194b7c3c82a1950d6efa71309df5a460447d5e23da5d2844fa698660ccaca6732d13bce7dc1e83a8bde66f2ab34ec3e28449ed4a8e53ff91701d0d71f69b18136ec03b8d0e722cd631988f249bb55bffbcc1805ef557742d4fe6e4234661fc73bcdad3a913acffdf62f8bc5d3bab57c8d956caa331cb1ce8fa6a0ca8e56adfa25edaa804c0760011165cea5f417c476445f6fa45037204d128d8826f04359d29b816eb0109e153469e4ae96fe212de30298ddc96e947573105af0f37fbaaf75b5e9d4392de36bfe13b711e09550be67b75b060377eff5fc7a511a4158aea1b3a0a987dc5e80db02245b73bd70512d40a58695ffed3d8f460e4664ad2de8d74236d2fee46668b2339d470d594f76f7458e8ebb80212559b5bbcfc23c5208ae1f2a0355d4c006fc7dd3b6d9311809112d5d6c1224585a494b787b63c4e6272d164d6b874eaff686f367c1814efabd92e3c63864b8e6e71e731b5a1f10b330bd224973dd07b3701227f9a833cfb534b4841613fcc9525a67e44cbcb14a40afddf1e354ba7724785bcabd9fb0872b72e523a1ecf8837c4196597881390f8def6c22faac7b1ffb48c215d5a02a15e8cc24bef0f98d11391911848919abfc12d23e0809ce575bab88cd2710bd803d99afe69a60d771fe9ad87359a16a2a9ca6f55ace9c801330b3961e6f4068df7dd4c828b6a82dc735e74f1b12d1e88718a8097ef1f900dbab9d02bcb93bdac0c8d625018e02458c995dc83a1a4a7ba729215769ae45d25fa390464786cf7316683dec195c288e18b7a7284ea0c2b8e34666ced49bdb7fef3ddc7854ebea880dbb873d2bbee9b1fcd2cbe406335b82a2d8b90339992e1983bdd63d3c1d52ad3373a0396907500620d28c7069985db2f69d7e30c8a0c44973d4e101e8211651481d56f2b4b87baa1c2686caed4ffabb7424f39f9841868e968f88ac2a0626fd439c88bb00d7ce8e34654e2bac2f6a272263caf89c1eecb2c039656bde7cd35a5d49ea89351f7879e7c0db58050efcdc130dd4e4aeb604d37ca1387a19c6cc20c1d651c3eb5e468c2ab92c8c13729d6e8f6af5fd8900f170dd50b0d9e8f44c9f2e3865762af025b0ceb7c2d61bf0a4fef1eb63a04eab1db9aec16b9a7db2b6c8710c55df39a3e4f7fa7df4b2b2757a6ba03ffe00c99bb38eda77868d67466055f894c10b082edaf15dcb77a4381f8371c07d853c247365f32c15c10192e01b1c213f737355ffa9af6a57416780bef3452e1f8fbeadc010e0f2d31f53ff49a0f0e7f2f330cdb4c50618170f8815e26685dd95bada6768727fb59c657aebe3c6cee3a227490f6c7b5a42c445674de9359f6f4f71bbf36a1f2d0168cf1a38c91e5a847121c371ee448253a9402714c091faab58653def90941b05efe07e497cbada815ba202d4a8282973805e855bd80213f02b34b62d42a82664c707764ed8a75e13a923e8dfceb5e33ac62664e028df684405fb01dfada5c9159a368a0b51553fe73b2cd838c857cbfee6ca57328af208580d86e36f30bf48c0862eb6c0ef8fdffc0e636ba24e0678957e76896d472d316c8d06212cf63fa1c580b2a005b306f96e3f5dc1e37167b61dc27b89ff67933e51672b1f306f7971c492ca2a76db6c01faf9e3449258873ae00faf4919712d57091e5c7e1d6527e2eae8abf88a8ce8b4e1bd49e568652a1ffb7d146917d1b31360a6b3b2384e41416a118c8d009c9c6881fd96f1ef5e51ae41d5c40e19560a683d0b5a2fcfbb1c86f9e99d89f1526cecca4cdd8dafb87211c221dc5c29ec84ee2da5881716f5db1841f3a2508040d21766a1c44c1d072c8096c380c074aa46d02b7ff71d5b3b145439b091113dd1ec127d7b160ae8527b47d1d57e1d0d555f9b68503bc79c4d88b5aa99b2863b0184edef199b466f95e988a9472aaeb1e915ffa635aee5cc7ebda76b7f6d670ce3189c796f1fb121c026a07736a873a1179533777b31ae6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请联系微信：codewj，获取本文密码</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> objection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动静态分析之锁机病毒</title>
      <link href="2021/02/05/%E5%8A%A8%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%B9%8B%E9%94%81%E6%9C%BA%E7%97%85%E6%AF%92/"/>
      <url>2021/02/05/%E5%8A%A8%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%B9%8B%E9%94%81%E6%9C%BA%E7%97%85%E6%AF%92/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ac2d17fcb4494fb2964cff51e2777802b530fad2eb44cd18f7de17596123ddd3">c4c477ce173d904965f2203e9c23dbfa505149368ba894f3498cd4d9dff1fd7d36972586e1d9c570fe3724ebb3dd501c7b676010d0b7234a41d1fc24f15e23f8930cb7f9e362cefcaddd26c0df49f840a6a3e89bde4ec4f7605b4485961d89441ca1dd727ab59e6a3bb8f9d041502b3c5052b38131e8dc884e13ae37a60db5788209d5adf70c3c3f51a0ae1ec36f6ec74fbcbcf17070f20e8f8d57556110f7c949c3640c5344caeb5cbce4f8ac8692832f8756ac13a4199defd4d9e3e531c1135770cfcebc20fdb526457aa788f0f165976ee9c6dedc412981d60b6cff1cfd1f5f5561b8685fd39b16f5d2cf240021db65a1c4301c0c08e75f53808091a9b50ae71360f2789233b63a962c4c85187ec107aff9fd53b6fb58f559336d1d8cde5790b80e4fc7dec1079f6ea6b6f86ad07919c824ce4166c3ad53052af3a9c9d427b98adf001482a38ce3a9e8ee6389f4cd2f9b312ff037e5ce5d466242264ef9fc410fdbf1288e52c9933bf4c5768ea42aa1513a32b0b2e88b93772b0b243afbdeb15b320a6a16fbdb4d75548bb36f6e0200395bdd38f6e0884b0daf53cdf8c56668b76d765db138edb9fc3fe6cacb43a96ac420bdcea9b1e132827e72957711fcf344c2fa561339ccc8ad1ddf5f07bc0d67ad979fbb0ec815b6e5311d97770243c843b968c83b2b3c0dc915806496c0bd2ac3153d36f43838afec868d5a398979f0ac040fa3f3d68cbe069a59853139b4e2c4edab0b9486b37eb1f2752000ba559b3e1787fb0d3c9b304d99f99f54617de9f4029e28750140e4e24226af3a8a805579f2d56eb82730c4335fc9ff0291683678280c36a41b75ece744dc9d8d78823d2896786a87a0b5ace685ed2f5f370e89b966140e6cb1e98b504e05728955b71742c10639c0f849a20dc60b795fdf6c217509089ada781e85a64b7b02d30afdce3ff7697436dafbaafbdb2da22f31acc6bc08be87a375a637c247fb90da572ae7085b797e88206e9b07a2fb048aee51dcfe50bf8e376a002f5977ba3828e4779559086d4e4889cc692d2a2d90bf760717e440d72d3b4fe612f8dcabb9e3fa2b490a6a5e39f3659ef9cf8191cfea9d37b45027c632886a9bfe2943cc0ec507454d146209cbe41001ea8915e4eafb09f1b2a071833feaa67a03b311fc6aa2303dbdd067c75781d016537502772709a68bbcdb88fbd5468117b2a990f024657af3eb3a123050b5543a7c69624f16335c6478aa202104648ca10d410805a80cca8bde80369b43fafb9fc362665a8a97d995376e3337665e478bf2c076625cbef63b7d8774cb6d2157383086d2df77bb20fea0d37451dabbde780e6b6871ac6f41e36fb1e1bb89769185e48309cbf88538b7d02be7d0937d21d9e411b20b6fab6d77103a4c7b0e9b0833f0777d7a986f8fba7b77cb019f64a00b9d9e6fd5d35f1543c708850b4af93d901ddc384ef68409895859926986013c632d4c0a396e6a9ae350b8d47c7ce113ace7a7df09217e50e8698e856a34f1651f418cad6a30c32fcf2a306009fb0f5ffc196247a78642f1a6fb17e32a9e661e5eb03b490b946d5709fe127be54964ff3c90e5abdcf3e690ee84187bcf6f870cb21fa45cfff63fc77228885f65b599b7229101ee5cf8c85046718279f13a8b3e8f46a8fb39741d3377c7e91009e61251cc876de9ae0a4670cdbab4a0814f58b38699e05967c0b91aa30fc695f60374b5a10891e3dcee727de22edb982764f4e047908d090e29b11262fb78b4f6c266226f0078f5223def9b31aae67a94525caed9ec3823490bb5984e9c57c1df0ec92ddd304f088465eb57df83a9ce84c3fe9979abe2d335eb2011f9fbca26e99608c76791750f7f38006445dcf751aa45bcbe1d45c476e0e99041fca0c86e19863aab63c02a7866e83e42b237d6cfd008be945608d4e75712f9f1a362d6e02ae4b0bcff22a433e3b3f5c10b599139a3e52807199987bbcebcf420d7eb416fc2b5754c26ffece02fb1870a6d225d5fc3a877efd3a299fcc9a743e214f7a7085ca17b4528df38dcd7cc1bbe7925372d20593a63f3424e3d17f598977238f9a3f1380f79bdfb4c56e5aa35c418ec36e04c285b3812737d0ebc706a41c9e03675a73a5a9ef80dba10663d5ba7893e66d8bc8a74d3ed797b4a1b81cde4c76888fdf4073c9df1b1d3e0e5562ae47e234735517dfdb33f89e61dd25bf350af6d576504dab9a9fff1a77ee16f53e6deebe1b8c1f097812d8f2e7b95de479d5a90ac9cef5e1c439773239816b370abb04f17e5a8bbaaff298ef753601adca349960cb250a6d3e78d56feb01fdfd05430ec00443b65e0731a307a98035876e4357ace42cc63f7d81b2e0317b159a4039aa703299ef645f9d9905f0b099c8fd00fa1f18ae6e23752989f037c3525ec89aff1645c2e9336af27bf0c18290f69cb9d6bceaafa08593f1ae9e5bd03feb0a76dde53c061469abb1d180ae796a14e9c6bfd22ea2a6eea0ef9e2bd9391bc99049a06aa257655a8d22d9d0ff3e5f5cc432dab64f192834dacac6716d745d9baebc48f959608a713a22035ada60bdf17287b26de4c82512e04b93b4f00989965deb95c4a311a85734f963c071cccadc833f9f64cddae0441b4d7b088d4a14dd4a0d7b7ff64704b54440a360e05f99f6bfe251984d9dd7561a2db735bf1a0b6c2270ad08916b714fc2429fe58ad1e66f2e24d542c44f82224e0c9d39530c3e02d51575be70f55749b751638aeae00815e57b0596afab28c94351b63418d3c8995def6ffa2565adbefe330a55cbc70485a113683b1a680fdde50448623156b8657ebc74c00dca44a9ff67e1d17d2c5ca0d72423dfc876018b1c0086758e1aff608e094a5d7f3263891d4750169a8a8a745fb92ee7260b4c4c0ff0e8f91c34c52a6d3df9374b27e5c4df75e2e958d4a524d316a1eaa49da27f79d38623fe8855b146573daadaee3242a32a1711b3e8365eb384b11a4b1ff8a9d7a23ce9bf07848c38fab2aee252cd2e47ad908c6a6a5248b4c7ec3b9ce33adb1d89d16a4dd60fc6c4c851d61f3b63ba33ba8cb707c355b36a1e58793f5c345a55654dfa14af7fbd4eecc1ecdd8f844770013527bf961f6fada5662db0482579c44749ff3d4dae0e7902a67f0779f38cfc22195559d68385d0d13ffc35078f6d6932ea879b0957aad9d1338cc8136af0f451eaa5fb0b8963e49bfc9d15150030b4dc8849448ef85cbf8038bb4933fab4a5c6567f7e032b82113bf78defc48305c8c336dc15478585f831d355ebdf54976eecd0b15aeac60b5d76afc10492030b72dae60c81bdd7895895810896d2f9ddeea045710cad362382eae2cc2c3dd3885ed057745da1d6b824a904ca450dc42cc998f045a793ab59a8a1cc5dbe23a42e21d92a663edeeb0739faf70ba2150e113601985098a05eda65e28525f077c001c3624c3fd3a951310702565e4495f509711101f1a6bf386a26ffc8febf147a750a9e83c240a470e433ee95e562f8475c03e4a90505bbdc37bcc75346c5f617e261f8dbc9ca1b1ec6f8bdabe0ec6825bc6970afbf7809689076b74516e8223228d1905eb82d2e339975af1d645efd0cbb8e5a0e53ee821949aae890acbebe1c4d9c2265d15c799c625a6fb06aed4f7fa7cdd24cd80478d0b8de7c2888876e21531783c4eb1304e3e645c901dd867c52fda9c4b9eebbf756b256487b64f6a304dfb847d228e383b4508173aa3f77ae60d46bce8456c5c4c92298b937354d5301ff575db38c2c6bc0f9c10f9b185a5a21a40061850272ccbaf464e35d5436a276eead04fea262bdea4424d00c5fc8da0862ceb6eb24ff48471cef7c08e06e048e6d807a168b33210780ba89e92c09db0a54a69bd28aacfab2e7c0f5628f5f2a72aac33bdb71d0431d82ca99c61f7ff7c25876f79a6cfd5be5130de3e94a617692d2b948e7dcc8bd5ca7b5f1dbaac7ed3157d1ecf867435e782908616aaa37b30e008bf69deff8a20ee8cfa5d86d00a1c3833e7f2a6965bcc06aae24110259d339ee6ed91b6a5bf584d8f707166bac119f56264d9415aacba39614570b0aa65f34672a006afa009e63f82d468beb31c2959b456ca3acf5509ec25bc17542e24d1711a97b53684e0e728f81f51a2e17a29e057c470a13e155460dc7fdeef00175d63c6649ae03a3f6db768ffbf9a93b117c1a9692f6ef44468330c850d58b323ca68cf7b57e16759a1ac7ba2235af5b54a02a66dd13b3488b0c47cd346284393cbbd9c1b2f9eba16dc76fe0c93b0a04c98c0fbc865dc882e5c35ff30b581f883c69ce537b5a3b1fa9d656c000dc37d86401e15fc0f874310d5480abb008e17bb9bd570a403a3eca3a35214f8d223f80c8393f5a0586e1f60b0e676a51b87217c9239e1c2299dab5ad29389736b7cb4a4577983a281a659717df110904031f74cafbd89e00d026b709fc24fbbf571cc42c3e9f47f0fc6a1720a25f6060b40aeb95bf2b0f3fb2c38079e8208e787cf00f6e2affb8dab7e19dac0118d322c6cff0aa0ae7e38d84bb38c38c3de4b6a7483272f637402dc48df9a2f6a550ee55ade1009c30893b723bd7a24194e0c4822e40e531c2b091871aa3a863c52993a4253e7b980cdbb33416adfce25f236d20a459b1b32a7ddd7a8742f4d7a18fe8841cbca27f19e5e1adc7716817849b7260dd1c1d21b0c828e88e4b3280b12d15b1e9d3a60450d9ca4579a126909bb642ea6d2068067e57bf15477a07c6a4a023f03beebe3ac4efd74356e10c581d7725e1689a15c8ff69e053920bf4eda5867c6a3c3bf4652c414b57f4e5ad35534c61a3f1e78101512ddb8749509ba18af67735626ef44939e8583680e67bdcf40a2653b03e27fb6fb391bfcee2a82f2b134a6de4b56096c57ff75fdacc11a8d6abd941e285109cb6003fb9258b6f1477f9c76fc9e552c34d9af744c63d020f3e1c4e6054b7c1bd7085f1432e366465d6fb9642701b3db35d8a53c11789db161d6b6a5a828509d33b93a8127a388bc11fa44a82863f15e7b5bca48bb9c4eeb1febe50348a958a5e6839f7ff1292d8e96669fad351f71db3f2b86e7b57d1d907773f34cb4202dc5f3b152f3dff7c54bc9a59dbb3b807521aa5f723cb2fb968afe077a79d175dbd0ecbac59467af40abe7a1e3095a078b94e17548e5e41f364b41d405b856882d6ea1fa4b4036840e7df5968158ee7e40e7a6e6ba606fd7d928a7632f7a637b4aedf8b1d95f6a4a42d4ceb631b7d047a7adf5fa5cc7aef62e920ca7a639ed39ea0887851305c4e7e94d89b92144e25ed3c4e300ae84208fac926888b6091c1b07803f3cc127dfc19f41ad8ddd2ea761865700eba13afeca1682a350f50928046bbcb737f13a55e4013c73076ef020c359e22fc91970bb4b8ce0a6b12eb665af25026d931825af033661e22879c9670bdd10df5370d3fe2348306eafab37332bc4bc10d00db2303e1845b7c8bcc8fe6b7b79ef29307e155886e6789529b31d76518194bc5c97983220439290d90be68963f9c843d39ede2ef5337f09427166bd2c06337bb3c1b9c107d72619bf9c338a63b8f92636be2878924515576e5119d147c96f73390adc5be416fca247faf296f3e978a306e9095e5c83436c860313335dc1c150a4d975c34247356ae5afe1284312a0bea00498d5a71d733a65f070091f399c18ef106bf228b63e2d3591a96d5e77c5ec94ada65f1e5304e8f5a6603fd7c11c56d7a4fe50309770c2654c3d70eb62b1e53e48ef84fd1ea1582bb07a0cf9debaadf82a69a69d2c38465fc12cb2bdb054a5d9f77b80ab90a4028ea88e265e4d650c7678a520cec7a3fb3f2a97f91897284d417b182030cd917536e45b22e3c68b180b03f38cd3ef77e77789eaed9ee07d4ec286e2d5c3095d94c8d8686792ee29d9b6895238886f4641042b1627ba852431c482e6e47fb0d0fbfc9fc04266ccb9a651d7ff4935ca0c119657c34974af49563e807925973d2223cf10d3cedffb976be7ea2aeeae8532ef9f70fe7a17ef344b39f3a23785766fdbaa8ec381da704922bc98831b484b6d707e1e352c55a50bed7033f75da5bdc4d45a74b6f807221d3e9b63459f6f5e119251fe6e2ed0191c24745b17040534202a579016e2fe0bc175332444dcf8ea5e544d05e008ed41e7a184a1de85c1ca9e3e315f53dce307b73226aefe211c54144e6a8e18752b32b9246e917ab9c36301046708e08f7f910a3bbb6abea23bf0053cee625fc079ec8950199ed1a2d37981cd62e965c893716c7d13272d1f76a983eb0fa9a12835101f4974d9832b30775ded16e46110937c49d239c600756d7b13b005d1dd15cfa2d8388a61efae77cf773692d992e36364fd96f85abf8e9e801f18d95863702d5c714adc950666321ec3bde50c4beba297da661e6a3994654f774545f07e21a2f331dff9a17fc723bae5b68762d67979ad009a739960bd88644a733e5fbe5076d279e52dfca209559770d956395f8ad3539ed8d4c2f92501d8a40fed654038d6f18046c5beed81a43db4d2c3f18dbc7c5f96753a8f460f96d6e663b62ce126cd7d42c985b0438c0f4de7cfb1c4d9ae254b2c9c351fd9e67be422840ee77ee1094f9d349a03bc8c354a671940d78cb26b6f437d7102dc7942eba324442874d65164e0b7ba66e818c80d6faa32b4ec7c11c4b9039edcab1829ba032ed66617da629fb5fa621bdaf12a2c9d5483c06a235c6ad1816964e19c2f533b97b59813c62234dec6b020513a8fe1b3dffeb8696efdc7b4f37792420220ca121a8ccd1527ab999827fcacb8f9661985471962b95e37d8de9d18fbee88263ab7f837066660157e43202761feacddcb38524f7b72d76117272b847464655575deb1036d18f7cf76e240eecfeb9d0aafaa7609fe2aa46263c0af4fa87bc49f1a6252f71758b57597bbbe1dd60a5d8b59368e5f4defc7c9ac9ba3b64d122a951f9107a5d540ccf65e7af8f40c460ad536837234fe4924aa19e4765a14a8e706cc73b8e73b56cd02e5fe3ac603087beb8d9cfdc3404f5eaf42336d8fe86f8684e89b990999a414377cdd4de5b8995ff029580aa2dc0727d4421451b9cd28b6bf26127768976a1ea619e9ea358f1db8ac62f6511d5ef7cdcdb5c394b7ac5658ef865c4581ba18ddbd5631931c8c504f68bdd3d4ba9bcad8e8fcf02708cc1fe75cd57985454a303718995a88c542745c25758f34c9fbacbffa1ec2f256cf2a8cf07eb47476f21ba7cb129c78f6fbdf1e128602f22f6ddfb863f92dca0336c52228d5af102f0560ddf897c6558bf4bc47010a6674926b5e456c19534dc1bc851a51e263f5fa7eb5e8b8bf45ca1b8093e6949984daa45df31b797afba96576dfa50b2d6f032ef4d8715b434f927aa44e56036996914e9763de5833f0bf1c951ab836e653e9c445fe2aafe1defded27dc8d4d4f25dfee809ce0240d6839ee5f87a3902a00a16a76898018f614761207d3e91b3c0ef9773cc10816e7391f25e884ff2cc7bf5603fe71e6f9ae453a8d9456cb9331aed81a2a4c661067efca4d211b47af2e36e0223d941342f4a3eea9ce5b71f6816d6e1d86bff9e9eea19c36d98999b139fa41fc75e017fd890356e973642e4046f922df1b5854cab1adb7c63126db44761e61524aeb1c0cfc4394b0b45b81d41e501a07006d8513857a77288ca2781eb28661ac0f6531ad03ed2ab81168fbea4e466e3fa89fc70f49b3e2a653be6a4f7791d36f0c77c0cc711361bbac74411a8df1df0f31adb0ba7d9bf6b775ae4354aa9a7750e874d6965bc2b8a6d3f56bedec9dc5a0bfc05c8ced22601ba831f1b7210741f0398a40d7be76cd0bbfcb4c22861c7180636992d30e9b635b7f94ae91b3637bd90bf34ee7e6d519f274adb9bb7bde1b723994db73c80dc855b8d73186d9aa9ba944a4466012323d1693ba7cb0f403933090b446f746d7bbe3f89801d5663c7cf41ab4661e8f79d203b6f5aaf8215a3d212fc132ba2f742b366f40783343a4d92e5906e34b76948b5cfac3d21c7147ec810d1795de4902bf1f3f127dc1dc58f0fe424f7dad0fa096b9c10f6ca5311c825b57dfec171f3792bca52f903f0cdb85495c8a0279e764aa2198da2ea1194f50f09767ab41e2f3b846dc87f00ecea6c20c559f48d2c9480201605d0ccc0aeaae43a2a1b39303f09647be10003e1f1b92d0af26023f671978798acf2bc6fb5320c37563f92f40252601476df339adb33f499131c55e6964e6b3010bcec1231af60174fb0be65170dfb579ea4b8ff6b3a571668af97ab3a766781c482b47d32c2ac0f23f56bbca013f5ab7161c4b45fd14b8e4ac2970dde00b8f7099e94df84d8123d2312190046ab9a7a556410d045deb00db1fb8cb4da13546dd67be6c7c5a350e644436af5c737ebee70e8742e1d9af7a55545b647a5b379ac342878229b019cb4938c587656f4190a3a1db976388ece020d8b6d4f587c97e89cc36ca55730ad89b727b56e7e9f418e4e5abdbf4de66db651ce36bc79386efc5f7c699aa623295802c4a3f67ab6bb891a73fd99ee873b0b4392b90e28ae4767f64a402bad8fed04f5d52148b223776e9c92817142d79597b4d406895566fedb17609b81628644087b9ce45d52b1752aca8b8a1a8eb98c95f8db61685a9572d26d81a3783602193599ee0a87bb0f80ed8624af0c20f446013349270f52170355bbc9727461cb8881bbcba04042d26e449f430b46a36fe9a49f37cb6062030a7f210d05d2bc6a66ff50721a229db03eb9cf5344ed0b6464841276c37c0b454a16de702144a0a8ebe7842a0551eb9289cc0bd5205e9e2d8f72e61cf5082e16a563f58179799d97a3cd7a5f9aaf37aab36132a3bb1c25acab7b51a2c650ab1e773edb2d6c863491495867534c89054f0257c16655164de0732798b03070e093f56862fcb2885f259b8ed5e912572c8d85799b7487d26cba53996b155713066b5522eb5f3015dd83649c4b3e9db585d8130d3c2d748ffe11c2b41d7f001dc13106636eb08965d1d5c01592cbbeea48a3dfe040c97b374e5b86cd6e48d19a390ea58d97c127b7efd7b7cf9ae065d94eb7381fa6d421f37348174534e4b06952a5fff9f654151ce7b6b80417d4dc29e35dc284dd9fb0075c034a7a0fd729ca4a32a1a824f4e314f803e376c6720ed7fa7bcd60a693e55f28cdcb828b32c44e0267a2c7f484e6a39c832fb8f07ea29c1cf916990ec091d3a5849ab9605bca4626b8d1eda9fef02ef0a631071a61aed9ed0d0cc23c109e2b7d4223fb699226a080ab8fad24bed3e3ffe3b7c6c10a225756fe6b7b30cd302211879e87b9d1828d0e8a6760593623ac5b700be396b68efe285129774661a4494f6d9c8ad2a399bf3a4780837ab83ed50781eabe2b74042f5272a94d76ebed060d58f4d72542c35bd552adf9cd064e7c114e8adaece48bf38f432283cfb9afef919926b2cb8297f66736d3e0933e16e19abfd43198647e26119c517bd3535be365d6bcb9294a67a37c08743b30345d907ce7101b499e8700d1f60c075107b2894149c25a3bea83bd37b6d6d6f8f13295a47d6d48cc8ab421c8b79ddeabecc22b6890f377ab7f65a30d59b0ccb6dc7eb1f4e8dbc1a315b0ea0fc7e8b63113d68763551844cab9ac871eca96acfeba7f15ffddd9766c4799a50ed7b3c5336c0835d681eb4634237b7150e8d8eaa8fb520f01e0a3f2d1fb3dda867b5b4661c13154442cd690e14223178b849459b3c455b1eccba94db775303db39d8d13b56ede561b198459d86c13ad7fed82bf3527fefc98e5fdb580c390a7607b0a3ed33ab7d66119fc4b2fc78dd253fc911d6e871140724e797761d81d5d8dc4d26fdacf08e2d352589a559fcf0d6c5201408fd6bbae0d405201cc8c20f59ded191f22a94161ce33b9e7eda18a3dfa25647250e4e3765bf2623cf19062702fe9a1d445d9bedc2fac647d71dd718ec5777974c6d5631de42bdc769b7ab702f9275df07472b8ea5ae0b1ed2ea4d1c3a4a8b6e2978be7b4f8b3d2714d25ece63ee28b535024260e8049fc61bb5b13fe6aa527932884b9ed1e1b6189a96176466b84f9ee8429cbd6377ad374e1473b68ad52857e18bd9e96fd4d86c84362a23e694acd2d4ebfc3ceb3d7772c659124de4e69a1367a45085f8f4ededd584fa0f3f0cc9a4158bfa4cea76e56f4c04225fbbed0ea22a67e9733bd02c3692d557b9d3d840d4621d5964b80b80b5857ddf21f7a2e859aab9c9d19cf592362b6ed7def21b6b094ea17290915f9c91904525469cc7a13c76aa407af62cf9c89f832d632a335e6b05d11f3ecf1e4c0d6c6eae9f4a4754d9263d7b018884f8ed8de8cf33ff6b2d32dec53e058acbde9b67a657fda56b6d0fb1d71936151a4b33ccde7fc7ed15ee502f8d54366c84fc71bd3997cda16d95378532fd29c79d4ed4d4be63370bfb2cfed5368e20e571457648d732116828acc613f58a87029cfa56dbdfd7657ada1418dde8bdedf8ab4b0ac06972f6d9aa0202466412a5fb89532b0fa085cb9f21d58c8ff7496320245a6fe053e8634c4fa009624a453d2dc319e493960cc30de3d47e9db51f281ffd6d24a6f4b110dec4ac43eb0bca85e45964e6ff5817fe41a3856dc26d777986660da15bcfda8d38960953c2afc4f1f6e92384860f570913349c06f1094555ad8bc03801c61b450a11b535260fbbe4b99c55b66e29b537e0b88a97ebdaaba62189b7fd0b792371d92461cbc2fcb2b4506c7ebef49a5bb34341e034e0fd36c51de1cd4fc3fa2317407784d36ca2638de1a08a5a7096cfa9a37a8d25ff69e89678593e779312ef74bee695c19d8d046206bb579af85f2761b1e48bd68a15a959163b7d21914c0f3cc8c3c1b427015ab6082a9e66399a84eea9e0abf4a732ce8aab0157bbfc992f1a50a88cdb4c8cfbcbeef2323a65bddb59f20a5130bb47a66f394d666ee58f7055f110940efd54e57f0bbeaa949f490f64b34bf9eb3c2bb3956ca73610968307130ae2f1c62420668b14d7dbe780b5d5ce9c1b29d68fb0f19545da2df8544b176a823a57286915354879cbd6de2ba9ac6e1e1a0fcce55f1a932c7ff610aaccc8d0ecbcbd1aaa76bd4edd952d186c838593456789a8967953bd5e4981b5bef4fbe84933d9788a4098132642a123f94fbd0c8f2183d7903fe188c58abf374bc20582d0fb4f43879716a0affa7004850aea78dd30ed6c7bab62d11bdc5802916af74e35fc63bd09eae746be29fc5caeabc4860913e868c723b7e4ad520019654d12a1a0c5ebc5a0463eb24b069df1f9e7f0737515a8ef798d6e842001e7255510a83825bcdceb605f5e1102edc8118b80326305730baaba997d816a562bf29799a99d2efa831d507fabd01338a8acec22c2357b9e2582588b33b0b0caef44d0e89ef29a35cf72c7daa5eb87a2ddccb0a78c200ae7035a74544a1d22d153c8a962cca2bf9ff2d6f3ffea7a68fc738d54e9f9902e056a0d1afed6dc4963111a4c61ca140a4bce224fde645fe4182ac264b655cbabca633ff365477283bc80e61844ba201bb24251c12b8ae6a8a266ce167c9a442599785039f4d8e7b59ab0581628720814fe0b70036917c4b91db38b579d2946f7c1d4795682dd9f81afe934041d73c64aabae8cba627003921e27069bde904a89c5827e9b52dcc34cd0e9d00be134f782b1298c26ed1e0cc5392a150ec888f8adaa07087ea2bdd2fa8b8610d108baaf89f08b19168c11bf445066e2205964f7fe35a7edcb2ec772e59b3c8c2883acfa0f19be91f0852c84b12593ea541ca9507fe0c34ba5d1bcf6a949e4a6043d4b8af2743908c35ebe3155d56327988ae1722beaf8c9f8f00abe1a42d21c75d54d2dce47b8c55cb099e9c36c854e673800a1fd9a742ae25b630bea30fa00c19340158dad646721231ac5f0801362f2c8aa78c4c9a5c6c8a933ead65ac199ea7a9c756ed39d73d7a3ac2e0ca0c55ba37d4615689206fa059a81e48fd2b2ddf833f34e17efb2b7112d02894f7d0d7e8693848646fd3e7eba9606e540e8a7fdb79bea2ff58f600ef28444f309c96d84ab0049bc110e43bea957133c4d22cc00a638c9d9f7763e5622e1776df1781a6feef334f88d6897bc753a8717393ea75e805a3dc6b6e129f6cfc253a54bc197d075780c4c0dd58c0b17d1d7bd5ad503898ceb5cb7bf55d79ad5fbef1b43dcb8602b14a03a7e73a275f1f7cdad025712d0959fc939dce66fa7cf406a879a314ce773e12955fc3b6025e8e23af77c5e669284e1ebe1b6c7366f69de36d1e4d361f1fe183471393411736bb23088a3590c4bca77e33dd2efc9e199f66203b39f0c0d5ec0d690e89d3f00ab310aef4360bacbdded955e249354c5cec5e608826c47f3988576d90aa23f3e1a4001e87ff2366da8eaac2789f7842b1a0b0c458ac0c70118582cecd51ac019cd85ac40d9c00c0781c17c16a67dcfb1737e5dc6bebc570b335a8a2db3779009a690dacd16a6fcc4ff37cdc0689e09f7d17b814250caa9c45a138df9bd78ae96459fac3c70e33d7635d2685050d1aeee159c5e4a53587901061ba7dc988c7decf55feb2e553e2057bbeb71ad7d57045524466434429917f6f4525890849bc34ae3cd630f1409be42586383a6151258755dd2e59a28edefac976821779a2db1f45328f5353acce7e0687c1f51cb3a72faa42a30cc76910cf9942c25cbd93ed8fc6494ac3efdaef84c25162e3d4cab5ede7a3e69d0acc6a8b90cb18601902c0ea93b7e11371043eb2fb57f68bd88cf12638896f02f115554287961ada0f1e0861d5d77750db26eea8aec6a4d0744f3877058c0e79a80ca20ad8dbd6743e5c312cf5b6cec382629c824c57fe250da2a8436c806a8a6a3edf2830ee0e9a3a04c4b5a19b731428ef2e9ccd5b57c530dffea058755015d0f9d445fd442f9cc812b4296732ed698c69f5f3aac6a1554965927b5fc3675804415bcbaaa0fabfa8cb0c420f01c7127d7935cdefcfd0117f908bdba965d538a103745552dec5d45abad5069290c903906fb284de379a366d053e5a226b02b605f152bc0237a0b78c35a940bb4d5f1a13da1e1c7941c12c6d7dbab98249953f97c0ce8f21653cd133240403661faaae52a07fd3059a8a6f4b6330b19b486af4d0a4219b74e25619378e35cb9bf177db29ba6bc9d6796b381e335d10ef0687f57ce04ab2c7086baf62e9c1f9c00a55be255b53e22dce56111c2b7f9e359acdc3d4a7d68d7bb9a01d5f76fa1860261763dfdb153061d0d190d2004e23917d8d78a7f79ae68e2efd3b5853bff3c7ac4c756a36d0190ef6e43c1b37f39e31790c323b219c4dda97174e999d5d1556ff56781355299fd40b9b5c205cafb8f78acff991cc16915a76c369e3a09feb3b7a532be4f7928164ace2621661a1271a4144db2d87161ed80bb686d52f4b27359d78ab78767b0d442fba6a1d0c39141748270dceb702178247cec43621076a6ceb5cc6e3938f5b56a32d38e9fbc4d562fefa2a4c2bfe5c8c115d08434e809ccdfb933ebd5f6fde933b07a429e51bb27ba0e79811d437fd6d17de8bd7894f8d425d4b7f180a3c83650cbea15f58a4fd69687b2e1f4d57c4a0f12f04fee161cd1230913419a54c11b2f852d2913f9a9aaea76054c1a24358a1d8fb8ae49e0102a6444e8778331a96cb5379b1a977b708fcbc9b20cf1bf2bd0f02158aa2a3be18b41a835c4271a583c72d0a498dce3a1be1dcb09e16089c9a705dcd118fc7bdb8a1271a75ed127ba385b4761fd70817ff043813cfd56c6505e85441c22e257067a461d7120fcb89a25fcc73fb80111d2d17f31f3289cd8021ee72ed71a60189285b4584d62a83ae88c44600dcddda357713af723c2c74155ad1a298446b6a663d24dbe9d2b27636865668311cd50bdebcca6b5119517e7de1faf37df560854a8dee38b96f8e837ab5e617522e5e4be7eca2577752fc632dd9b9efed46335772f3dccad9dfbed773d91c99c0e13a195aeda389a39251c647e7dc19e13bc0306d872abf0c881f15fed88298bdfe3e0850693a59896e099a3b47892e41001ae6b6f54b5db251fe1eb4470214dce0c0fb677d61f8d0236b6b4309ddac1cf13117084bcc043dbf4411015048d26c16b04b786e448e0d29f7305dcb62f34cc5966f0eb167674f1d0c75f094ee29a938112d86026fecde0b82a9a10454ac0455c218eddce159560a0540abb52cd1c7abab512dd40c4eed14bcb98f5c11fd4af2c15a22fd730cb5c1424746cbf7b88cf07aa276d4247c88be3f9787384bbdf15de6798bec24f56a78121dc52741179197b862d700559b7a59efc7e53db6b4c77a162d1314048a2c0fe17424327e3dbe52b697ee86413107cbc2ece85a37582ac352839a65cea3c10c7c32eb98108d49b9384987e91ce2e649db0c7d265df7ac1e2780683eb340aed63f11714e197550e3df28fca840ea3667f85b9899a9a0d08087b457d7a86a781174055d8a366c171464c921b3120d891decdac1ad65d41901c8ab3709008968d00411bee9725395bc0d153b351546f17e47d3f36b56e52c546dfc04e0934ecd3297cfe4d20b67101ad30d448b90674350e743d98607bdf674f65c6afe52df4871fdba31c50b627f43c3b0551bc429e71527f8a277fda94f476ac97de2a7568c677c2372f3685b0866509ab16607e0965051e66064179c44b33a1e00e16e36513a25d7c6cdc0e5857cca009d64c3af0e9faf2e215751526d9b77aa79b04cf696d77bf64b8905e0e5019d63ffc28d525100aa4821645105fc83dc22f1e37f28ba0a646b5c08a84f9d9380615b598417c4ae25f4c8e5194464140db065dedca9187cccc90760e10fc3d28e94739674f2931403da1e678ad0044b1adeab13c9e962f89891012e79e1d017b9f77d7ab1be27f45989b169ea119992b7eb517bde34c76d72641680eabda4241c51643ee746b5e00bdd55a662e1ec97f7359d396c720a1970db50a3cccb0dd9e9a371cdf7e84f0e4a136d43621cf0a6a76df6a513e743c2d31d19196a7f818f48a6a908692b267f8637f550d67d161a204b5f8a9a5304a0c64c20e4f10adc3154972b6813dc51a47fe43974faba899d55e2f1febe9d17cf3816fb96d79f55a5dac65c6ec235eaba29f29e2884a3a0967a86557e68e3cca7f62c749b758ec626ec5c58afdae6943575fdc1bf01ff380730247307f3c4c040aa7b9259273adc4c46a515bf44c8e7ba2ce6450186b149508f2a03819f0f3b1ee333c103d9313d7cc97320da7e95fabeb0ceca67644e295eff9d6c4378774c1f51cd2d7f6271a33d10ca43b8522c4c13993a75176bb6777e69e0ee355d02c00fb1487247e0dedafdd7e62e2bb5dedd12e089efa65d6267bde05ba6102ba4f9f1b6f2092e14ad3dcc3a81b7cfa5fa4696c0eaf02568e08e53ae251c81b501e7b4480ce5a5fb7e928eb3c623c06d92b6d2c676b59a19f3c19103c99231334809687ae31a179dcc6485391a7541cc9ab53c65ee265a1a086681b0b1f9a84dd6f3cdec9bdfabbcae8288e985b508288449955ce7faf3df7a9d8b592e2e748258946f16cf8bf85ada18cc1bee5c2b9c66a5da60284c3941facadf6f29632b5963413f5cf7930b2f444453edf643a6b0affa9f6236b2666f875e81bb10c2b4bc4c6236bfe0f847fbe85f4f783d423aa376a6b854dc7f43cc6a91d575e59dbd3acc66a88b57bf0460d70e6bbaf2a7da4b10ca2a2db3df77b5b1e0839787221e8bea331e11d1daac0a077db7909638021af2f6e4916ede76a5454c3965f4094e2673aa6d663533d9e4192676d2585098b63818c461e8ec66aea48241757d7c05df7980fcc39f5817d3836649ddb1310404ab43707012782648f56ad88cc648d4ef2eacc3afe17e952bb9f137b3043a4c6148ffc25f53c3fb7edd75753f65629e4181e7e159caccfd0b62d88ca2861fbcb88ae8ae566b8033dd3120840b7673dd7dd9082021c0e35251f326310726795ed4ca76915a7e209646b31bbf87881f622a5eaaac2a40579844d6544c03827c6c7c69d67bb32a358a237d6b32f385924319c9a6d2818b5534d96fc6e6af43477990455335e922925d1c026b284359e8f1d02c5b730c83cee510c3c49275628c674854ed42a45f13833a8dcfaf8139f249a842382cb09642ad16f86f9f8b753dcfaded243ee38b07ffa717d9f3a07473de91002a04cb6ff6bfa2eeb99295c5132240b6cdd7aa751c5ca373bf45d49d4f8ee0f8b23d2fe07f4080efb6fb80e1d1f3e4de142fd3f0f5db3bd3bf35e2a8192b9b0c1093b71111f8e1447d34a579110857f5ab02af5a0e7d4bca0af0c4be1d44a11e9b8e118a579adb18bd0a38d4ddd6bd379fcaa9cfe6b27bb07c80600183dde29c388bafc0eb755d7aad9b40f5c1a921d9456d6260920412bd12cc58045e32775437bc7eccb8bb40db938abf5c622b7f5a28e8626b372b39fda6fb8418f647231c5a0cbff93fd656465f8677af775d91ebbf23e7e131ab15b1de04f7d8b1311a4ebee4fbd8315947e1bbd9e58aadde050c1b5ed1b2db90999af7d72fdc31b35b01454043cdd76e342cbd6148f216c12972304f006fae7c710f584da6e74768f0d5328b2e3466e72ca29f9ec4ca3c6c34c71d442a7c7a0c5406ecdff6e19c974985e964bf2aec9f6fe9a849504e5830433e3b3857fd2f55df5a91be02b37d6530679d4b95ea8a7ff8331a7530b50fecc410c03243177c7414478a48076de219539a5777785f1c20a772d29fe7a03af08e86a6423e001f16f42a6a16fe653a741d1bbc36d6e3164a5967b1cda3b40451dcb4f02299cba963c2e81f853128fb6a64c3810aa3c6d0de7279b7d09c3e469bc4c6ebf164a7070648633515e61f32048f9d2c9be79484042f9b584bfdb7e853e183fb93a6645b57214b836290e015da629e58e1b6153e5901534079191543cf79bc1af3254f9e0fa59691ec4194fb4bd3d7ec4fab0b76023194c31eab07fd282efcfeb42e7de6825e88620c2e13ea35f5eb7c4412c977e55920c106077cf25745a67b5fbd7d95c461a81367f0bb4eedafd0b2e27dfad28bf86b6dc1a0afeda93ed5e3daaef4781061a251efcf7c4b1cdbe9da8b86da2af85221f4210ef36f9317daa0e30c49f2ac94519123dfcad17e7d3edb1ad47b3c44f5d75f39357790b92c24ad6efcf339b856c54a9c8931ae7df3a032c85aa171e91d13874d314d85c18f23cd67c59072be83dff4f0af13a6d2dcad8da56bca817f288db2e930fb2535527f3bf73186dbe7062e3b4c47e88e0e0136273dbce619b5e2ba684549ddb27182983989d6848cc26c9f45c92409ce34938714025f9e0a7b48f547a75ebf42cbd6a21838ab96b0321650f18290fee56fec839133c4e49bae2312b5b7f6087c2377f3ae3c09531536dc4baf4e0682c9a1ee28ad747e24599d2e0fdef1dfb3d8e5fcb25725a7839f2bccf48c91d807596115e3ccaa82b686b772ee64c3d9851360e2d2555847b0fa2361c4ccf6f8f261da8b739425e0c9f42b66e5c3890329ad7bd2d87852eae5b8879f73e8f48411c515ecca0c07d98d4e7201a7a26d3b4bb389119a935e3296535c368f5993e9c5117520c0892acd7a0d3fa8829b229eddef46039d353a5d22d804fe794ee7736c17aa0cb8ac77b6a65592dcf9f01dc8bc7cb3678d2bc9b29f8befec1c1ab7847342d6365f4437ec4a7c94c612673cadb4d6c68a5d9e168425a96618615641baa240126ca4a20bccbf327322ccaccffcd771bc7ab15c17dc81b66fe19448ce5dff9778c2e1a78fadf372ad03e0a1ffc9ebff7503c21677e51cb4a90d7b81ab4608023aec190f1bd18e415dd9effafa1a2bf2afa8955b810d135e6191b27706b7d7af4320b15339b376a784b18433d3e6cd442e795d8e8c6a679741fb6e4907bad390ae19dcc3028b5b7fb6511027c48c31ec3d7a144c70144438540fe43a5a13165960379bdf809e4ee1a2d61ece9e5037ad3f4893fcceb25f28842263529e9e69e3b25fb1917d28338fb1eb5f3b317034523d75ab3e43abfb17567bacb27d5c46a32c96227162c07177cfe07b2d244001fa2dec8446d7ae16426e09b32ca458bba566c2a41aa2bc7d97ca85979edd53820c08eca290be5e708c421d0eda9ae722a83e56877a180b4400631d2d08b413d68791b508eff283fda9340e25926136a9ca2745f1c2ed2de4e3999887aa9b8ef15a53d139c26da9516ac8627d35ce0c8ba74aef51a73c2b745ae0d8ab574509fdbbbb8d12e0084bac3182595ad724369f0d5cacd15f07a59b1d8d0d38c5d97cb64efecd76d3e3aeef2351052290d52807ca9543614d49bfa60b7f989fcd3596a8aa428584c0311a66dc9fa9706d16c598ce0a95f7efa657974ab6cb08a5ace2fada69a2d54f26d7bbf5db9bca658c27d74368e4d968340187372e4ed59d4ff203c2825fedc6da8c4f5aa5e8274e102114422554cc466bbedfceec5b6fe7698cad98e9ad9d4f293dc0c3dc47430c12abd9b7df699c2b65de5764151b73f9f500ac21d2823455704f78459079f8be1ef1c12bdcbd33d7d13af9ef6df12326904d42c2a6df13f50121e1a313d7a06e83ef7e10784a0ab882cc1ab75ecbf90fdb281bf9a784ab30bc527f2b9fd4c7aed7ce40f131b8e848b69ad9a516b33b0c46ed3da1dd1b36b4eb89cb62209005605f691d1b4f9367532de6a128ec00e9107a57e2c325d12e17f22f568aa05bbdde9041208904ca051f1b4926bf4c5063bee49978691447856adb51ef824acf3c12568663e838d43aaa3c5d30a276d1d38648e94d874fb5e77cb23cb145ccbc517193501224b67d6433e0a33764a3958a4d39d7a706f59b787149a0846cdc56c5f2f6b3bb6ab8a5b3f7bba46b9132752e8808e08857b0582ee74c98468033d366927097197b4a88aa83eeb29aa7d9cd60e7b9460d0ca787acadbc896056aec51c86f4fb2a067bc6b587b10e72daf22d9d87b74a0cb2d7e81be86de15a91061e3bdbdaa49bb6df93a8fbb0b49eb17d370f8230824957342b2dc526673803767811076b2194a046d031e75f2db953e1c39b316d0282b12b332dd573b53aefcc26d73623a54d60565cc13905942964987bef6574c6de6f2d68cabb0697f38cfbd1a24f29637fc42e0da988ae76675d2a686a731075114b88db9bfdf4df786a51b0616f86e40ad60e85710bc7d29213c24561af90fa6fcebb50a135e4b2627f0cc3e0663cea0d00e4a229a4f06849fe69f0fedc02a3a2db57b3a00ea69a671203ce9e18ceb483fd05f376444eddeac6e4e8835ef8915f884ae4aad6eb32f7bf471a82e05404ee6dbbf56a63f437ac0bd96974638f05706c87c393fa0978daf02f100af65e734713d1fb6e6ae8997c767e514ac0a7d8ae1e92f9f762da2b0d50b1c1f95794f84d9fa64809a5e8316609e9fd6b44790c94a2525102ab916ee6efb51c8cfb337b3f48343f0cae261a2571c4bab9164be1b35499df62cef56aeb4bebafc78b5c9fe80a145de3042bc4146c0ed7cee88739c66699431ed56f7fb3ac5369c3693b5d466b0f6e751376847ff7ffc91bd29c2d283979763cb9f80c923e012cc2851f0ec85a21c40ac27f4095c438cac59e914ea744394e004a3bcaa7ab76830f47a670eb7fd701d814296369778e8932506b2e49a447d24f34b0826011dace71e61dae0d053637e2bff981354ee5d1b8b070eacb1e6b62c5426a833464fcb7ad88fb8502662e35e203320497a86012ce940405c9fc1bea96255da6b5821957a637c42cdcd172ac5cee07844067d9d55aa2ef6151a50d24e14020ffe5b1ad9925dc2e1681ce113185fab146f58bfda6c6bd2ebf7f81edfcbe852130ca299c4e79b0a406bbacce34359d1a02b664bb889df0c391e62b44676c580e5e7d569d7a64a040446d1bb1666acb65bebfb0fdb2c3c5b3fe3f1b2914cb570335d570d974c60e9b52614a302a6424589fcd791aba9a1430ad60722c4b86613acacca6f0bc97f430c89e3f4b04da5af182f25210b3fb7523f7f36abea55062302c0c4ef042ca0b6c02abfd7f7040a740b72ea7a925128396f4a32aa1411e4f44b5a8e5b0de96f944ad8f32a28ff00a7232af83ed13d0027aed22de2389ac18dffe94e429336a1c64c59792587a821cf4ceeeacf5d4aed49fbf2b3c86f370e95b1807816862f05a3513be43d3b88be107d3fc1ab526c74960fdd9ec376f1f41c44d3397a81ef9fb067ab93cfd59925ffe03633b4f167f6539a1a6f57a1eedf823f4281ffb8f78be161e994511995f583000797b2cdec433626d95c9f06b6c4560bbeee3571ecc2030406daf43755043805de4d585ff2280990742370f91536c01b97bcdcd229856018431712fbde48575ee85bfdbe6ba49a8ba9ceb94130d340c232740e129960b9420231df5c98258480c9e95273e3e8c99172742834c454c244ccf36c514735ee1fae28ee0b7d7d8e242140541baec402ebe78de1cc739be05d77820e99f630475c7ee77dbcb742b60e5773f3a77dc2529f5692f71aa2d383d87d1ff4ced1b7a676a852337a5bfd4f871083e7f5642a50f2da41ea5dfc55daf30a458e94eb05aaf27741da070cbbd1cc4836a711a45cc8fb3fd3fb7bb4b2b49a48906403a617ec5903560472df2457a76a6eaf18615414010d1a098dc90d37095298013452ef0d4d5eaeb363a5fd3ab57895eff65a77f29fa2dfd0963582be0b5668d079b6a8177de01017372021ea20d8915bbabb9288aee090e29f7db793484f4cfadc1ae1ee819521427f21d2e6c078f3817cbe7d0e964fe71ee2648e3c99d363dacbd10625ae7d17e1206a0443dfc52ada8e307defb413198cf5a16ce67ff0eabce85e54f0ef179618a3bb7c62efc97be7f67ca0c9ef0dc57d66edb5e15d2a333c62abde0e62f99a173df98d84bcb02cb877138c38fca819ae359d342617419f593b5e7a2dfc11b1f535fda59b8362c4060fff37548ea79e14fdaa7d12ca957f2a692f0a4e806a454387472168510aad0122b2b49c616bcae4785ba666c18dc1465855617001bf52f760e93b89677f770580e0f28b992e1080e09681dc5b0fdc31c4670f11d861c3d35b1322dfc08b243e14cb4fabc380e459070c4e55277c4c88c1d04982ead28a08fdccf049b122fac775d98a9d36c4cc59291b71e64d9a06afa986b41c8a4bf4d7240e668c69972ecdaf3fb114eb062ea5b09748a2fa4b2182dbbeeff651e106a849b2b52ff59c6426b6c8ba0baf33b01ea0a9f0354d4a2295b280793c9fb8c9c964b41954e2ce4eca14052d4e3ac80ad22acebcf33d2dbb283fa0447c29bd4ec31b165a2c99f9db5093a68f4b861469930438c45cfe5db51f76cbee159b327b1d706c421f2964127ff5c843949b2d39ce6d7ccfba0bf3692d7b846a9f2b53fd213dfa51fb7513ecd23d8125c83ebf183445ecae3891e0b8e987c1034c4ec20678cbdbb44db7da4b21ce6bfe68853cf1507e9094ca505563f4152282dc0a5d4586673e76acdaf710420693feabb12e0816867e1fcf2dbfcac2c61a944e55230c2b9a34377707a9c905879ad5677a2392d7014b14535134a4752e312c1edca58dd882397b2b75108f6bf934df738a384e4f83363b0651d7977a018ca242823a8bc8858f376bdb36385d62a6b8725f075af18f98f18e39b42d5d3304adde3b6790ffb6ee5e369983e2c2e01c3aa2167e178e63475ec76d64eae4ebc4bb966327b764bef17979bb43485f8e9335dcc7aa38580c7b568f7f7ee743e30a0d3db89bb1d2c591943efedb26e0d7f32d46f20718d6b78923c32220fdc25a76318c853dce914cf787c0f4736e9f9bf8771cdcb7d44b11edd086f5c8c48522e0c0aad77173b2eca211e2dce8e91c617b5ed70dd78d09749dfedb5ed1f5018be9d6c45fbf22163ce39f3e8c2ddbe5eb2e871c4a754351d6896e85167bb60cfd0ca2e7e7cc88622e4af277fb2713259dd4ef386122c068d4b6cfa8149de67a07051c61ae9edca4c6bff570de87c1a36c31524e2945c3adbaab2619e0d425cbbe66c03f84f50d4ab752c486ca34fa9fd3ae1066d9355cdc634890524b6178d8bbd890b7dd6f4b7296516cfed5fae8e7af0e296164653755f773cd1dfe8a5baa336e62e44fd071bd5ee5a0c7dd20f7d902d9999efb5904a635a8f220d1e18bb2a9c681fe7154db043d8b57c1ae5ecf597488358c3e0ad019e6851be50796cef13bfdb994e7efb47cc2fafa7ac0af00001cf9fb4190f7a5cf83c95b7ec346e6099d1c70563e9dda5bb340c94692b2289937b3e5c6f74b702a21dd6ba3d6541f3f831186a12fc750c2437742cfbdfa64ee92d9547793b0800a5be9e15fa377475cb408b38673d87aecfdb6b39ff31ac6dcaf715a7e8ad20051cfc9323b97818a887e31deae264afcf57a4efb965a6dfe3c52a7b50dd4a40be54583420ce90c09d24f0552306fd3ab3887ece84ab21f91246bfa126e98c7625d83b9df86fa2ca136e56d5bd7df9adfc18ab6ac45b16b11fc679b8037842f48dc4ed64b42e87ed7af12860cc1ddfc623957b3b78ef456ef622bd18475ed3235c23a763989715791df893f0a53f7c89f13eb47cb5af8c81b633eeaada23c8913ee041b67dafd4e70e05e349b2e2774172f2ab0d9ed7b007ab4f4382d18bfaa7316b68f72e72c3db909e188a5a2d7ed40318d1b4c1e4dfb573723f240e9d642a089893314c6a7e9e4f4d13322f358e14ff33c1f9d98676fce172cf9466099a57a789eaeb849b45c7f23c719c1e46b08cf02a24431b23a8c6344d0efcdfc196baf94f7f7087344457c1c68282d76cd16cb6e36facb77e999448939b3f77b8459eee92a2992e8f349845d01cef7be14e43fd70479c586e47a9ebd7db9cdf4069e1cf58581e26138897b65f663bf793f339615e90eb56af43fbafdb4d761c07c8a04204955eed84cae1c81724b4339a14195b9105a26a7203cca05204b39df749707f4ff1f3e612a3b4e86cfedb88df5772433db8657c7e05a6d7193d21a4453b5a51a16b97c4a910dc4a08134d86ebc4c6f4f86422964b860de38cd9873706ec049775f57947f84ce1b99e87433d89dd415837b6c66913fe8e67b1200cbc56aafc5a6f357c040ef4bb5f1385ef04317fccdf7185881a73803b4ff4a56f6249ad6e40f9a1a6484263d24b058c5591b25d25077fef98f052c11109e1d9bb7181e4c2d6727ce1a8f9ad6d655e57c799c4680c475b2e4b0686ace79f225e4a46aa1292fa739c09262d0c161e6a9fbe5b43e65e5e9d8e3c49d7776b89809e3c1cbb514a14152136e6616bfc8c6c62ca77d454f8232aa0cb5d00e50e4edec636f0231dfb4dfb80ae4f58caf4d6e384b95e6a53c5164ffd58e3d404a02904360c156388e15bb4577b91aee218b07ed77bae01550db4f833be589312264ce908ded8ae74a808d384b88349d79d44c6a9b0b19116c4323141c19fb879ee244db790bcc8e107b4d0a76fd0a65c4188314161290eec2ba55fcab756443fb09dc0ee02ea512e9992cafc66daa891b2e92f91ed5f103c6676fe0b05c3253fd886035aa110deae7df91da51104b935f0fc6f71dfb7734f2297352bf9627c9e67b218b230f3896847f02f4b62a576855eb3f2576004245a06ecb788b231e62a34a9f64ad20daa3e6e1cb70d6524aa2c33425a7dd9f84c096d3129a274cc74d689286df204007d10227b3a35ef8b9aa297494c2266bfa93ad090b1a00d4507ac0a134d8e87b3242af7d242532d5752b56f589cb8214fa013c3bb59d9846c211f18fbc4bc6c526f4a815ea814ce793c5d3042d6445979853cb620775bd7bf8c9a97740968fe9b9086e4b116d9b8bc8f99a71b1838e6eca9e6c1bacbe5b802814a3467e83c85b32bcddc101d1ab6036b0c915e151ad0ae42e6fc66943c48ed09e481606cf4372641750d8398cd79a4b6f7384fab18f04e15565db98f08e33af9e8544b2769af2d95360dcf29681df978747889e66b08589e57c8a1e9c511469dfa42d63341df8ca524c6654bc1bc4f0776446ceaa9d152c538b6f1748f3d4094f34d28b1f07cc26870074f75465021584d5860ac9c85119c5c0a3c4fa4b4693ba75b3a6a247535a7984deba80e80c1dae31215060147592bc0a3645ce56f52ef0d5fd49e376d01c37cfc3ba0a32ce50829cdcd715a2604c2fba1fa6c8e9da6a89fd7c2391b7569de39cc8af029df364925737cdd84cca2bbd5f5f4fa43b00320165454b5a77e6fba533fd8baf0076167b4e5dc55e8406a0e62782d023f0b77506ad381ef4c55161b4c65794f8fec61f5f8de9ac54fce6c7995cf859a3403c7928b62010a1d9e1ddd6f68c35a9afb8b799cf144c1379250bff7757165dbfce310b89263a02beb83ced2482ff96edfdeee991006e2cdba858e51439d323c41c80f3ea6ae52411da90e67bea9e4fea66f7261437d467360eaa4a58f1ba15132b96fdfe2f10dd79df90a4737e800ca0b04bda2c4beb286d91cfc47d5884f042a38fae7cbeaaef33138696797bb749b9141abb671f2be6b48dc9cec36b83dc70d094b1c80d93ad0740fc61a78bbe5a63cf4d677af14fdde236798f09a49b32ca574ca02227b54f2d55e3a6e9769fa7ea4ab06ef83b8d4765697afb0db77e8fcfa0285deca7e1228338d202bd77b9c7a2ae64532d7718112db36c285db63bd8c688f160ba352bfcd0e1c4ba18799b8265f75b73420859fa5ca4c6d01a89ee4be8dae319041cd19d67833be7fe391f13c22ff22b4aa3f4b6313d71a0c219046a6fa8adacb124b38141d0bd499f97a31b612a2f5962c38f5275425c5793d99af88b5fb706551736d12ab3b4cf209417757f02f4463aea1fc1bf0ac1b1a0e65f5bb8db46096cc85f94938b7e9bfc47ac57f23f8f73087c76627018c72179e3b9afbc0b968a56e00e4042c7bafff6c6756d6be2fbf561ba27ffb3632b21722dc08576bbf9c3ab2459fedb2e86f5c966778fe59a6646b82b5e1dcb32ef1d241f3f18236d9db225f23a2e3269ff6baeadedae0b361355fb510de497f5abb370c8a7dc26821e1c08fab3b134282402b54ae47a43681e38cf4f3e960bbc57303ed4ec6d54a51d1f880d36361be48ba2984499c28a818333cef7a600a10f595a5f68e87916f9fab0556d4bf4b416f8809221b8c362498d68e65cf87cf77f82f31453fb2671e935f205790ab93065fbe11a1cc1b945ae5097b41424e5eb5c39d9d284e9cc0a087e69d474637f7a7b6887826e2c15d73071c1919037cd4873b629909f29b8b62a0cb3fc4bcbda9750cec9daabee913887afbb13ff43052397add12f4d7208f627cca04b0b690ab19bb9353047114f03b7d2f54fc279fa15e0a83db7019da40b42675a66c7eab349c41c479d9767a294122037bd75fbdaf1b6ca0e5ab73f7df63f4734fb2816e488941cefa40d0382cba977eb8d5fe73c245d675d0cf29621af739ff36dec6776191abfb0948265e1d70dc097521e54636c0dab615fd7e900dff0652ecd007afee6b816648bca048f416ac1cc61a1dc83fbc3968f613e2fce1b2ca9615f7cb0a8504d3bd384eb35bc48bae9ac2c835eea681c27ff2d6cd0c21bde5391e02b646e28c4074a22993934fc8ef5f645a76a810cebcfb7545295cd2396fbf974138c80b9e91eb034f753291c9992398765055ed795e274b220f5d5068fef160e44652e3ff9422154dd0b055ba8abd1343381103d1f20ab5001d185986043d289eba873ab9f5e6cbc2d383c7d4395453840e84965cd7193cab2ca7df89fc28c9bddd712cd5b930fd5b2534edece74b3b8a24caf03a64c7a409b562043d899d8b3f9e37b01f2db5c116e72840922f81911b3e2168fc6d8be519acf4f9b57ed29bb5f6a8b04927f1bafac587d395d4ea7151f63f3c2f79210312f63ea3d22f80368bef7d36fe7452a6df0aed45a5f1b9d3c625447a992df1317c002b12bff8b1656d165b83a33ba3ceed5b6b954d7cd23ada4fadabd986ae1d89de643d410cfe186bb7b9c94f8352cf52e1868d3617fef73a463daf1720a708b8aaaf45580b02c883189a653c411923f67cef4c4bd8ad838990ef2d6a12dee88f37f14d3e7c0ed87e03b4cd8577557acc88e2c9deb478d045c7f466f5b339b9656e5308a22b97f14c31a3e0c7a31370074b2288a1c50bb6b4516cadd31d5064cbe8a8f8fab82ede4062962420382cc9bcf99acf5fb72518451afda2a380875779c75fb548ff02444f3aa0948092d09cef10197827eb15f869fd2142be9aef19e5ac02705f3687b4de3315cdebbb1d7ede1d0b46701f19f864dfb9d1f30c70dd0ca6eb31920453a73df22fcbddf8b0dcd3b196637ebcfbc5f6cb4c9ea91a1fde6d393f5c79f4eba66ee71f1d7c725fd2d6ef9fad6c2de909ced5e37cf499d062e2d4eed0c43f7ef65f9a8bea34382d4f551aa30ca8d2d21282161c4e2f8e24bb975169b1555b9d1c2f10cbc0d65980499940bfe5d54e5df67adc7a9f3a60b3364a4890f70c6474266483c675433e8d9b10136cc716033de03c361cb21e3c4a34926a0e694e6fa016310d21574ec2448e67860d4b77b5f4e854d71b47e39bc53d7e35dbe20e243dcea7de21cdfa9c01eb1c98082939eff0ef82629b04609afad9656947db368c6a40ef5b4f068a4bcea822a8cb654be2992d61e9f4568685b65dba32a61a47f38588decc05889606b7cb960342617d4b1396392b8510c81fa8996d88c3d523890d3f1ed3ec7be66e51a92f1439d3d3731c98ad4fad09d63b24d514b6f2519af998a19d1311d6bc5118c694f5b49f302d1a3cb8a2d69febfe47dfcfc518eebcf102614c4b523a06ae292c6f561417547d3c55c0a2241c52b941a5c5e6f6335a19e6aed78e03a150bb43341694300cdbee270e96b687ab9221238dbf18c9c735d44f51875242ef787d4712ad6840248c61708140acf489445c3aa1a7b75147695a49822dd07a49cd87bd53cd283c59a2cb60a3b01447e0286abef9c079d7fb935f9145b6e9fefe3524013c37c5ea9503a4eec03a040138e6f00c434405b8a4911f638ce529ac3766eeb440a0c02622429c88c2fab5a709ec42364ba40a2bc8eeebca98cd60f2b017c364dcbfec4617051ddcf7a5908d753bb3a06878eeed967f45b265ec8157c21e52a5bb85267dd232b04ec8d372ba69863456c749abb665a76bc7d1f988e994b2763f94cd69a6c9ff5932918a220a3bc5dc72a5f849852e826ba7d6715693bfc8177b6d4fe0bd390cb060d7252d7dc4a9ebcb8ef69ec75dc16c1994788bc644d18817f7e538dbedeca3431fd30d841009fa9d9a8024296e7a7651856acef475d99c6c219da77b43d1e6e79108e2f305914568fe2fc84f2ad671622f5ed50433cd261ebdb489722b29f7ea0b5ecc92832957a0d743ca05c66a7d70808f22fabdbc4c12b019f99dd83987235371e5161df3470e7f9ffa8ab94085143b364832605ad6a1528db1d211bafbcc388d726b7b4adbdedbf692b7c47ba2c80a3466d1f9039e206daa99de21826182eeb946ef09a75f2089abe2244481d4bc70062d5c0a822ade08e98cc3f8ba63a0061556646bbb86e4b0a52fb089f2eb082cae25174247397c442a2ab1ca08f45c438b29b00200cd8450da6834d778bf1c5fd5980c29640383c7f7e6b1286125a1b43c117c8516010fe59bb3aa80ab2a49b45c28ab01c392d421a541195f25f10cdf2ec4737ebda881c552c3629744db872301478992f789ea87d09851bfd39f452ebf35214668805d01c1d1f27f8a597b8f6ed1cd24de40db3b110363866da0f84216765f69d636a78ac34116196668bdfddf42e7740427787847deba20c19f08af12984f9da0e16344ccea6b88bbcdc537831d77438b63479630842b4829eedf831d01a28862cffcd71ad3ab8115856fb11e59e3739d112d774b162bdc6e40b2c055e987f8a9303289f5baf6bf6d227c2fd7f3eb238eed16e261f26d72710304f74eebd2df739e784755bca4ffc5c36768b9b7163df246df6e136ac9a26c56000cd409db16aedc573f448db77e61f94b468d7141f02f1d27e4bb216fb341d4774816ccf6dba0af11be9904d4fb697dc03b45bfbd42534472fa6f999182f33ce880a81af400ae819adc2fe68af6d82592de84fb9ea28681c83c70f38cf2568615c07eb6760544d22af7aa92b3acbb1aa283d6b6f08d34f82bd4a76afd4de149cfd0b5c5bc293cde388dd569a1d0e951b497abeca237f8bac915d34a6a6a152acc10f3396c33adaf983a4fa0e67413c0c4adaeb213550dd84341611a45a058ff7d9e59fb3d6b95968b2785a5622a274c11b55be0c01a98bfd0a789fa2d8f38f8ef72b1e4ea9ded00a48db981fe942916ff8443cdf438a0f4e41973ba5788e5ca3ed155ff8482b255b8b2653d636b94c991db70d07173cfa01dc63b8502c6f5799ebf4fe9c69568d06111b8bbef4f5ca3b6c9bc94928d5bcca30c3df314e6f0993799d339bf4ad230a496552ce673da0a50945789009baa86f71b8d9726c16d1f5bd1096ff1e0ad0e197c991c361fe91e899d6b25b3b794414a56508ed6489b82c9f3d823252ac162db2f60a341eba9a4bfe94046d14f373f0a2c675a488706e3d39781e04fc7639b7843c7f0b187818f1985420771167cb156fac91c2279042da6d5a04446de10b75d08d3a0bb4fd0caf330b07704ad0f6ac74a407d2b32943854b52ba60d70b7b6c59db701b921c9f894840bfa4d69c1529ab2050edfc3c08c1160d214882b993aaa2ef6eae5c421795ddfa226292747bc6e5770967497bdbf11837ced0156b5b5edf6797ca94fc80502687941a608639bdd22caa27b558c60443d1e406607bf65468a29522d4594fa1f73d996660b34de7800b1f895b81c5cd5ba0f333b11b3687b3c68f0243d293b70b82ea35a5c37103a1bb2696e462ae12d22c1371c8b1f29a912151eb03eb4dbded678ceda2189661820a1b672aaeeab85dc7cbb6bf05e1d146f428994ea44c0d9472ca95788d7b7e447eaca64b20421fc9be31ad8822356ef1544e9d095f45919dd64d1a918418c47ab8700a422587bb5c655085890a98071fea1610f1fb50c9aaadfb15a730ee87a9670ef6d9a99f71c2534e36c1d76888e039206a53bb9b5213a03f2a61d0f8e3c8e4a0cf7d9640cb914163371dfc2af0f10f4b9a7276e2477cbf30d37c957ced6b065b78521626733058f41f73ecc29c1e9742441c799dc4631448013215a8cc3f64f6094a1261a2faf12fd30ff121cce101ad9b7c5c31890b186b2bbeea61c48511b11a6d71263176ed385ba9d408cce6f211f3bd368653103f4da5f73ddc8f0d63bc8ba9bf0829419ec94e4015632d7b4a378dda54fa2c3668da6d8962069160e21b0ca6829060cf7b4e12b1ee1dbe826f35cc49642a737efec860fd6b8155054c554ef64ac36ac1c0a95335b6ee65f10f82a1d2543cbbd48433053c046195f50c161ff80e0b97fd85914beb275e0be54f57268c637a889c3b543009e390e8cfad60d5553c2784ec84af8c93afa8073e0f63396c3812a8f95d55eb8fc0afba6e2cba3dd1600a81f0031c32097f7686535020d1a52a2956580be1117070486608530c3ee7b8ab0461fa96e5393d4a762a2c67592f5519e91d6474054f81fd092e591451639775bd44affa999785b7758092b1df60d39ac2a4f2374cc9c5009ad9629c6b8756c97e8b6ba61db79d9b9dd7b57535ee861196cccc2f50698664b37ede3f12938734fe53ccb0e7139076650930568c45648b28e7817f029fca29aec2397e00968a79f5c38439f7115007fd8d9c902660f4ea3d3ac27a72c6ace56656bcdd93dd1d9b59aaedf294ffeb0690d6fe745fdafedcef9b643eb0ddd366403597325896db5a3089cdb788cab45c618d08af2b9b67762a9cf8da5606223b41adfe1922d09323e83f90e7b3ead2d4562107a7006894c93c938637299fb84b2edfafcdaa101c5b2996f4eb288fc1a4e344c25775c021acf905470e5c5427861bcd52ccd49317ec287b24cb3eb1a0afd7884ff5e1704395a9bd532024809b295b2512ce3e983d1ba6db4bde770b3e31f5d0f83884597583243295b31a646b72e0a53a5a8d529d74a06543b07ffc4d3747e00e7d6248eee6ebc40dc2a470830e768228ef0132aa8a76e861f0dadc33cb069a99ea1a6adde4c8ab7356f2af08c12fcc07e43491ca51fd5db354850acf3f887d3d22d01adc58c4f7924f93cf83f4e54f03c0b4e1564e83996b47f048c9db039ce919b3e95d7fdc875909d939bb0c923a77c3ff008d29fa16b2d9cd0cedbc97c82636274fe060615454a2a17893cdc72034d3bdd7b3fb48ab2c6641df5ce8a0cfeb375f0f4ce651a721d56d1b3e778e6d93a763188c14f9fcc40d77cb4a407b03f5b1b3b9f48aa6f69e5f4d823b5bb345f055e88767bccd9781b0dff30d1756aae50315a828913393ca575fe2d6fad0becf540dd889e4673ef13434ef16dc72980061a64781e17cf42c0bb14308422ea7da9911fce507a5dfc302a42358f3d501b7c47b42ca82f7e1aa41083afd99ccc609e38e36e00daeb4ecf2493622d3a6eab774ee683c41bf2c2f21c0b557ff500896c05e1bed0d8386d1beca99feaa1e927576194c6b681b84e2fff9693c7eaa49a9d719466993f9ece51eb0456248fabd2d154498611d1752ab13fd0abfc5280efe8fe15e312a03b14c2b23aab0d638b829a889c46266e1f8b44a00c272789e69a79f8179c8dda733b5dd389a4510364b4b8267f5a1d2fa83766134728c0b3be83b31b5f07de72afb0e91bc988afb0e1d9c206f0b65587a4215bb25bf66d4f1e98b517116d29c5cf4f86b701913da5dd15600c9c5cf161492a0ec8c961e802fcf3ea13e5a3187d8fcc7f0f6a3f924fa5696c9ffc5c673e8afbe97959bfc45e303b55ac1da456b851dd4cab2f3d963e585efbe18702002c2d5b5eb642c8c6ea0e4c61e003f5f040e9f7a855abca854930616ee5af536c3dee160d2cfb33ff39a01645daead021c72a08d3833fc6a0535735d551ec89e1c2ef803447f638b84fc0857a40a5b66d7c94ff355f85fbdd5b8cfb37f4f8bb7e39fa24afb528c19e2f164f9ca5896048b7fa8cf328d1f11662339d75cd7e27dd617c2618a0f46df52cdeb8f57d13ae39b61b5884f797ecd6a43be990be485927eef0bafcec1ece860c5cd4972fafd44ddc3ed4b730402c7e332b7497de01f14081dea92f4f85b4997691a967555ac233b3de4c1bed18f7d7dea533a1539a893213f2515acf5441de03d7708904981105636d2744988f61b0f7e80fd0d12729d1edeac5311d53d1082a26d4ce8cd1676b95ad0e2d687fe024b32f6c497b1782569ecaad75de70c873d9ea757050fcbab26d11e8ffba48db0fefe8b7e81b9324daafb59415fd8c07033a642ceb5bcbb4e5b2c95711a0da0efdbe106b4cfb12682fd99cef9b15652acc9a0f46b86d4dd196de254f28b623c8dfe62b61bee6834c68cf37471e22ae18d3a7f80f5454244c814ee484be57abda907508ca1fd24c521662f5d57885d1aca64125f721b2e6a776a59130c40c79331ae437e44cea7805bce8355319fe331ef93329e616d3da763a06006efe9771a31c980357c8a188895d369cab784654afc1861c4d71effa2a28cdc1669ac2ffeedf8e6bee0589c56b7b1dbf20114e6742ffe8e5d731051b23e559aeb80cc2725b6ce8def43e9d6e0ebe6d534e6859d064b803ffbdd71614f7fe9b77e2a251cb920b58af346fc93570435d25a14abc68e4cf990f3c1f69fe32394a149e9df5cdd020bcc2e8a2bf4446dbc555ea69ee87d37d5a69ce73ae7c4175d871f0d7d866eb4acb9ef23a55bec32328eb4115ae20f937e6b75d996ccbe19c9fa14ca2597e702ac501b41ee2c12f4e67b3ef511c5c64853e4e3ba9d8217b94cc0c2f3725b95f9d46a25f4464e151ab2dde6279065980a08423db98c4fd55ec156e567664c615b77c12efe7d6d27a8482f996a689e3218f21c9627ac32b1c0fe8b70b278e2ef455aaa3fee2a45d06d08b9f3fdcc49b7c9cbe826b9f70a309e6df3e35a02aff866c06c4b2a8d7c467894c027c5556070fe1c1f44c260979edfec9ccf41dc9f5e7bb5fe08c8618d483ca0a6f71fd25364a84a3771e87f4888dadc927f09022092c4ffe12c331a0a86d6abda2e8bfb52e1a7594a9d348d567a865133efecb32e6fb7f490fb4379716d8355296bc462cc7f116d603a58b0910945812987f6d2e9284bb179c348e5be8ab997dc7d07c8be05c03d34741211e74cc5ba8561b72605ae07910b9b4e91a0ddec7e9fc6f4881d412b796ef1dcdc749c583a4e8b00edb2102a69bfc88f6116fa14135cf1782bf7f33fb1cfb1a946e71c5692ff3c8d6b934e075536dc992775bb128b1743793ce828180b43976d03521b0e5dfa4781294203f27ec2c8c2aa1a0bf5e282275eed28cb192a86c5556550cb7816abd7bb23d8614a679370c45ecc6f4f79af66d2fc43c830b6d8a1ecabe249e7e8d95cc2344ca8b0b8148b0f861ef6f0072bfc35478740c79243c1cc96ae733b925312f0333f93fe36da01c490ca1c9336975f90beaa843952c5d55f95e277baf5260bc8cc1d72c1a4af9bb4d69a7b4eca793d60fee9dde06a96b7dfef347183d2863322431ec0c510b4f3ea0e999819fb38c9390cc5a21bdcbd4365165897f9b3fe287510e570433c5a4cfde0ab70703ce93901aba4213131d72cf90a7eb0fa22fb536aa5807c3553ca7b6ebd77b4d6506c3ebfdd030a6aae4a15bbba5d8c416b6c03030ebf096d2ad95aeb2cc39085ceb925e8f671388cdc93832a020bed1209d90a563e7d1e079026d213d8432615a9bbed51d68f4a30a9640a44eeff8eaf215738542ecf72fd781094018d3caadc5073d4cbadcb47c7080b8c30ca5b84596f7649d1987b79743e2e5aaa3292440f83a5d41258e7aec40e7990f7dbf83967fdd45b80f4e07af6821c721a6de0793b0c02aabdf5ac5b3c8c6cabc6880f186949b9e908c859933ed671bd27c4c07d76f2138ce771eb77d5144f2521c1936c74ec50d0c782e05667103528928c4eac097c82b1efc68b63eca7a6d02666d34f68df8888b15c20453ee1fee8c8e1de873fad19aa8d108f9d7468fd1d5a6fd1b0d18f4cc47e0062b49da0fe529fb3e2e38f2e0caf94b3ba4d39fe6a86987dd41abe548e277bad5c40c6c0a3a8fd165382102b016e6e946e1c729bc0caadf58614439b3d6c8d9dfe9f7be6f6bbf6f1a10de5601d06180fe2952c19755e247179106caa30e0859a4fe9864295b10887c821195bfed881a733c3bebccee0a7d125b07c573b8953161931fb98449b6a2450ab5a6cb2afd28848c2ace6fc7af15e99cd0765d6a7225c05bb62cd26bfd0ed54dd1dc9fe47e052ff228f94eeb8e71e6809fe1a4272621f9f8b88ee9e6fe09b67ee49bba0dad2422bf7cdd772024c1232a876ba92df934a1ed78586c63938e5cba3d0b3b5393b24bf2685091081071f430072487b6f9499b7bbfa231275bf509e8bb50d7655286a93ea5a7c736f29546f45aca30583ac90dd321a6ed5fee4f8365464da9ae6a150078dbff65b9ff526c17d55f63995f16cbe875f15fcb2dda2847149a12d7a289099f805a192b3a71317325dcb1c8c8e701831c534cfd059f998dd207fbbee2ef408ae40cd86f6a50925a56a3c009c570d4736b8f29bf680a1740afe4eece7d67ca15675ad79a5a78d0ad542fd7c36c245532d08aa77eb23a399fdec5a27486900f943e73a8669815f514faa9c9f95eb915c357707fb13a2d51074c109e29167c9ca15c6f60ca4439ca99e2670e269b57f2df6256ce38789355520ec55d57082038c9eec5b56bd5d3188669e3aff228eee98f2f237e4ea7a46fb3edc1a1cbab6262ca9fdfd4f1ef5ec722704ae774e81f65f07d26e2b9ba9dbab8cd11c06aae106e3910671399b1aab56fe367be3f8ed5aa09595b5d266f484d0e3ca10e761c530d9e136659866b63146598d11d7122d3ddb992a9c549530d59511877361281bee8015a83f0d3ed5b41c31b3d5e9dc7811b0a8d0c5203508435d64fb8a15bed5011c5725f7b410d77bd93d07e8ba9d4395f9b12bbc6112ce6d75d7763e00f36396f5256f41a07935c3c99cb5d24559fe89ef9cd2d938d664725bb65a1ea329bca5a3d58d39a542d132a7b164f8a29e1450c13d5fa23a2226c758140a534ed32c8f6f3ed00c34e2e2d5dba8c95eecffec2e997027a4206dfbdab2203768245056e95cb22760519c7ff7a457171fbad2e8359801cdcca0fa88a5a735e54dcca49a8bdbdfab80381ca112e5bc35e25cd2a9954be95adde4cba5fa79a663712dd234e67a85a12d34e2e8601af0126618ce48f550691133d1f857044642fab7264e584a1ba0f422353ebfd128fc1527e0cd7d0752a3df4e47c78a8fa150e0cb87f2e2d792b62b78303fb7563a1c347de22260215527eef8ab5826d0bde786007180ff6636498294e824fb304675250aa310082751df90524b0f723a7d3e0d914abb54e0658f5feee9f45a7d0b79566bc0a52d6e0a46d93737018fe531c18f7a31bc1afdd6cd5d77c21f7ba96fb92be962b798ab9a80b86edef0eefa96db540a38aee7a9a1053357457934c8adc228fbfdff15594cbf3e03c23f329a2876e2e1b6a73cc5f5483c832a298a538bdf53ae7b1197ea489c0ae29f59c6c418a1c96c4c7ffdb18b4efb820201e0b854451454ede0eacfbb526ff625538d275508fd2303b2d32aaee02131872ad8a3a86aedf5c82f802fe45a47832160c5f2484b8b94fa290bb2c2527cdeed530e6d244e6b94c2a4d5dbe91573c654e18a2503556b410f246d0dddbca8f8341b6b17eba71d5479c41c4db2c4d3d1e19335e744de28787feccd5544bfc1da3a2422e719c3651cd8d5026aa18725b499194a40b235348a7520e041a5ecbe3ce8f5adcbc4bea341bd435ecd59b5be93feef44ffc95a7ebcf0092e9c7fdb23821958567c40b6394718ee74c8b7d0b98b330fdc839ebdfed2abd76a134e81570fc26a4b6fa71c2a460096ad969ec04350e6084be760a56009ec0d7c0b39360cf6d17d38681aaafe36ddd410f29fbdf65b660569802d3cbaf881902bbe2dbb66e9a9a97ca819842e9db8e4d8828eb8806d011f9f6be0e2a423c45ee97bcdc7cd757f6f98a8ae0e00db24cbc5e1d2bed10eb802efe0e53c407f53949aa5043adac805651f61d94616deebffd51d44a1e533bd6e37c968d12bc2a5844c06dd37b54592d162bd8a6a11a73b8deaa7127e000fd1ff913fbe47de609a8080afd347ae9c204471917a635e700eacdb8538f57ade96f66474db0f62bde2757261451da87ff1f446ea706dcf38a751158713ecdfb97e7f52f05fb5ab16c50f00a843edc83cf5ba27635dd89831649510651ad7f8b6c0fdbcc95e5447bea73654d4e28834e63d72cb163b273eef22bdf23249e95bed95b8dad0349605d6fbf5fdd4163f2adf5c3b29c43270df107b9025ac573e6f446670cb330cc51ccb07f53076e4cfe5bf576509a8a27fc0955468203f415b9674584f9ee67c7bc588b7bcb6c390c889b0bc90e6716124b7d0528a390777759477be7bf0ec693a9c962be8804ce2ad9ae959a4eb51d48e4c44b0cfa19fdbdca8cbc71e32c8fe8833a01ab48043f24b5e4f235add2233e8f579574b22a949010004c9f7f15eca845580944ab9f83bdcc1f8679f78a3766ad85d2d2199a7920457cc3d3cef559d1374594a275cddfa01f61e66df081a971350d536c7471b5bac38d5a535118c10b609508c78ca2b349f2405b6c732a952f35d4a139036329ac92ca7ea947aa1d648c4293addd5c5326fb586d7eb6bb6fa05fdcca6eb27a7757adcd8055c443735eaf0b589a203aabec099f3f2e23af8e8c236a26fe1f55c1b436c8b320d3cd61b3671488c023b17e346814110631759a9c200907c145dedae062705bf385c788007691c2bb08666084aef40486c676a743c1391ef8a69a8f6627b8a19b05dc1dbbde3a6d473b770f938c519a7588b166eae12bebfbba195d4c0faf720871c36dd1cee9898596708df78494707c76585cd1f31600fa2e1e3d445e31cc8287e311e4255163569fe55d071b36bbf62614277e77137e0b9dfa03e6872867694560ceb435db6b2cb3ac79287d742d13c62ddbe5d2a0bddda470948272301f061af1e2f96f431d0922c18a571098f4bbbaf9d16b753eba98fa3c8b903edbf4e17bb396d9c888df83288c84f3923847d71de7ee4f3f7c4252e535147f9097c8518b0ffdd83d411757675aca976ef3e1a5194dac121069e501f8e2f9d9f31c896d1f56d1f28eba66c55ceab10dc6fa39e654512236640bc2bc5a5d36fd0e10de14a5a867ec3c47a8861cdd83640d6c568035d472932af0b032b91d6560735018cd946694ad45cb77c179976f88ac6be18709f414ca7584419134ae7f9cc0a6803fb8c31284141ebb2e5c8c22784ce02faa6315e67776bedd38491809d8e8ed20985a8ca1e144d877e52a8e16936e6bb55b48d562aafb482b0f12f62a7b8f4c5f2965c334c006daf7c557459cf1f9d8ec60c6366fd8a55be40cae03e01c0905eed02a0fdf2ee39de27b8898cce5be349e2e38ab00970319e1e2216dad25319f006b415c2b3afa3eeb5de03519ab3b2900accbfdf55e808d68e2ff4afaca2f4835ba21373c2d70c7860951723831ed5566fc2871937182cb480b0d8d4e5b9fbab8a1e7e3933b190ed51f96ecf128a91f41845f05d47b5910ae509bea45891c0f4f47ddcc31bcc548095e2cabf860c084bd011b988e4430814ef5b0a98d27ad4b0afd711bccc37f788483eb6ba3fca07d00959a747c290c6510235ab860ec8b30aee4fc98ea39930da67bed490313d93d69ab00c9591681e405751a8b445bd531696849e757748de66b31da09df2cf1adf9ce75bbfe72b9ccb28ae6ecf974a9c43ab4bda30dbc847098bb8c9c17b7cea159455f4474f2f8e58bfce6d18feaeb5d09602de069f78a3b2316059d0166a23ee382654f707ee35af5b21ab33830fccf5aa4e7d5e2166d0dd3bd4fe36405b149bd0f74fc80734f1b0305220974c9116c6d11c05fdb4671d66b3ef60a2064fa91628ba8d3dd2a1b2d5875538afdbac115b87390e59a82518e7c90228e6c434d3847c393081e3fc4e14ce893668d4df1c9cdc459d60019438a91fe8ff73f37f3fbf450360f7942d9e055dac6388cd24a76a26236052b92dc8f2141f44914f3394354898f4f05aa0808f9cdd40bf73e2986ecd6ab03437b996aea28d946a46d2d7d538c99ac1406ac81b142a62ee2d88b7895591818292f7ab4b08c9804be88c53fcf17e633aaed06c2c959cf90a8495d9c0a010b68bc684b9f16135d9aac6123bcc234741da01c0a52408a2f8397f1f0930ff2abc221e5d3fa7b4c22d01d68786dd68350d73c18a9bc7c46cbbe344727a1ffbe2c3bab1b86964827368b6d2ebb4760bba759191fe19b0702b07e3d7a27858405500c28823d3955738f41385c4ea0911bb197cf980f3ab2bff2aa95eecc3f819ce710ba8c4f88c7261bf5324cb819a7d233678c2934a65fcaf28a663ffc96fc0fd4ba17c6969f3ab00aaacb216c58630a7b11c30f0175cf7e6341ae00e1f095321568a1f273a9ce4876249c5f8c0eec7e3d07ead568eb9bbfc877e597c16215f1e527547e99dd4a6ee26f26ac8a2df04ca40647b09a94bbcd3a53dccebfe4ed41580ebd295fb2f64e96eddc9dc944ba758b26612b5c54f7701b1c1eec135bdd427257edc37c0585303002b93e2d83ae8de234e0f4359eb48d72c772a35ea90f4afb023cdcabad386106b509ac981a83ab40a6e716a8cbbcfe65e53de96fbb880523f03b3ef96720e375187e39afb05348eb09e50ea9ed04dc8bdb260add61aacfdeae36e8275ccc7a5b404097f19cda16a69d57642ab545fb19d06f3b6eb0f60d2c358f48d059dbb24b5fc3c415340e1338a335598185c8ae936f4e9e5a7c977522873cb5de97cf65bec19734aabfa45cfadc40dbccdd5e23b4698b010aa70efabfcfc996ca742b293ca1c26ac7a51bb5621f87644d173c0e5a45f6eaa29eb267200c84e281214ecef553d94c70ec8e3ff0909020bf755b8b3e93d7907bcd625110f47ddadf14482296717d59cb113ca1a8fcecb4552ea127e41a16232549b78a23bd668a031b9e4f596608ed8b848de44bd7f6259756be085a328b866b45139aeacd5c5eb2fb00c4ba85e18c1dbfccd876a00675ec156dff1329f8ba84d8b79570a1c807a930131dac8048b1e85d8b0b807c9b1d4b89195582f0288c178470ca8d14561dc031f6aa657d9e2594c7634d1ce57a64038984347ce211a323d12afd99f08fd17f73906017ff2a363a3137c5673cfca079e6f00a8c2d36c9ee8b5b063f37ab9e835e2aba6c5efe5fd0c5365f71cec6cb05dbdb908425d35fb5f0d2b0553624f79661eadee76765e5fd738450ec786d24f2de4c1e70f25249503985298e3d50d324f00e2811cdfa4eca470e9de7807d3be1d47ab5eaf35514ee005df7db5982e8abeb800152e8d64a242f7b813cd804f0193f5967cb878c822dc7deaafdb82f0e79d18f062ae9f71f5313361d710691959c632016d68fc3cb16e158f1ad0abc2bf4489f42ffdec8bf761154fcb56311b40874b88b072af0c3fc0e5badc4effa91052dbfa5a2f888751b1154e8466841bbacdfdde86667eccf7f47d60dfb4a77a6ea8a7276b11a348e5aaf4a51a76f0c3feb688a011dcf50c290083bb56c19bc13bd02f8a09f6a21df066010df342666a8b5b75d7d2b230e295e99e2e55322bb9326e6e323b42a7ee149a9294b9272d1e8b3192651ab95751d08336cb0bf4ca312d36082bf45a36bad489b9b10b6f88f9d1bb16356558b59038acbc5efa3007d95d57526e2b24e3ffa2fb78fd36851fec951100388604c921b8c63de7687ae7049c11b90a1b99ab3573d2599301d956ad803d54a4bb141086a4986b545f3187a219d32cf42767b8156c0e16861f1b24b109e6bb1b632cf124917bf8944f532f3189d3d14669ee17c77cd31dbe4f7b479307c7002b1ae5158fd34c1979b4081ffff6d4d004f563b569191b225e304a62642c2efdecfcc88f85bd55bdee0d09a8d78973c9e4f07a8fc5da13cdba2ab7f32310d00a8a0f5cf29cacf025d7b4d9b280b7e6ef214034d53189302f2fc61e6a3c0b69609f0220965f50c061aa17e010eaf7a77fa89784b2a33d2a65e9986e175d2a0ec65e58e12a0afc84f6028f7d07c1c4fb6cdf4f01f57a417f8a9f948b104afff6216f97b00e99e251c26e0ce9ae7f9b4c4cc6b83da3b42eaa2bd757f45ee4ac498b9a310e70f2dad97792bf4b45f180abdad49a276db12cffea01bf8e534321a84745017aa81695d9d1593a74ffcc08ba9f52cc286b4bec4130aa7f0515e8d333a7b44d20a843ae3a54b7ef05b82d9d2b244dcec2e2eef34e87956c056aa33c5b91fb6eda0cb28da571e3e174e228912f356051601be4f383495728b22487d14873e8aec7d625f2b720658fba380806a1d4dfa86157e2e92863ab2240df5b87acc7731212d602a444c3aeb4998d192200062ab754ba92ea54123c89c6619c7e55bed22416b353729316bcd3c94e15294ed2d4e4c80efc1ffdb676ca98d8d3dd801fd500d04bfb3f78e700bc7165144c83bee3cde70b13017947440bf06b8e0ed1cdb69b7ef3466fdea6e609ef49d5035b4f8c25d39614043102229ff4111460fa489461d3ac70824f5a56f18f91a8020e9762401c18f78fb3333f2905bb05a0887d448959824869182ee599f6bcf1636f1ef51d78c41c7bae6dd4db2bf92c68906156b192bb8ec2705f054014b831c1bf6da7e6957eb1e2c6187b0d958995a38a219967c6722c9c7086781770b7a6a262a86261e25c793998696defa5c95f9218d128e591227222558f548554c673d3f95edf28179b40b50b71f8e34253d4d2055e1aa3c3c125d58cb0f033b3d8784c8d242aabb3d3e5fc1a2681855b58681b7f8a712b72b011f31ab91d80316ed48cbc83a97b4e51494050a9640726ef19079c17e75c66efe48521d4140aa4b2090112d45c5310ff7206e2098a4f6e25c04adc9afdb1d22493547b96a98a5d18802ff2afd12487adf8667549d99e334b8cd3600634052c1287ea46ac1d1fbb4f0ae41cc0b46bb655e34fc788d80cf80456f72914391c5c996f17c32edde4237bc330c359e15dfc23e0b2291bbb5c0c01f556b35d5b6076eb29d941e122195849eabd3ec22fecf14bce3567e9f4f3b7c830fef07dea6a1694571a7bd828f2a47d5e8a49f311229dc474cd531ee29517694460ff424da0c9d7190a7d9ccb55b2633272c50cc356c63a21608198b8bdb97020b9b1af183450c9838a0c304489b5a54120242fac29d2984f704e2de7df15f893add80ff2a063a240b6cd05657798498f4fcab495afadb114fb0e993855ba39a81cbe1496815eef7c2ece92994a850c2dcf45e0283b5621d545c46b4d1a19bff3603f96d6e585145c39be41cd613bdc2eceb46b917ed47c0b8347a034944ef3787c0b65459a31c2a3bcb5cc9797ce55f8f78ac1968896d10d6a71c9ed3734d163d2eebc56eeb99758b2da4559cfc2df10b80f3c8061fd27ed44a723acf7f1279e50638545998fb0629d89e0ba73c428038d238ee1a6b89c4173ca1efe645798da206d8d41bc167b96a1c4fbde7a6adcb65c7f9f7a50fbee3f81c0eed1a6c761e5536054b22095c1fedea98da5e48a441c941a72196c946c7abfc30bf3d6fe80b75e548704627f3861431d6b9e7011cf3028232ea2b58d750cf1bc865acbfedd78d1ca2e3a8d62b7b195de0245c2c9a00a7e8e23e5ce8c3509273fc8a3cfeec58724109af3ca972785153d136c49bd28fb125fb84436d1b4128be3cff488bc09749d584869a0c545863adb317f0c2b0af132a5e77c73211bfd813a4bfae1a574df0591d5209764a650a45f6022dfa4fe64932ce082c9d3047a171e5988f30abcb1cd19d69bbede4231cae3521a17a9aee56ac139c75e71707aac1a86d074c886e57e6760a7d5d9c8f044120030ca6c80469c8b6739f77234a38980e60d703fc98dc37010bce135a058a2adf87e3ffcac8777166a5698de6d157f4d6c5ea84825f40a9fadf9c80f2d4a0f00a870be1e5e1ae9a1ed75b0eae655f23ad97b28ea2bd2e26feda1d6f58b73959cba8679644a3f3fb1745a11e0dca531fc9bc853bd3d9e2bdf4e550b0a7ef99761f64c00a009e992ab8b9d56b5ee1b879408cd510cc0144c8c7449be136a4f55d81bca6498a7eb6f555111df7a8b1e5ee12b2ffd6595d9439f17b1e1adddf2a4c1821395693e502242b78627589a0d5635c9ee2f552e650b8b17b9044e801147fc144fecb74f8d1e8126eb463b7df5df8e216d3809c4bfcce699414abc61490db10a551ce8b146990912b4dde37ec1dc7e3b07b4322bb5f4461470ecf790e066157c1559df7c845ffb37cd73d7333def3d84d8b359493824b2fbbca5e809aa87e5ec35dca7d4a616e4560f47109e266fc58925f9beb96a91df340d808be2a98545f6023b0006ac11a877311d09f5b0ebb659d1b9a782cb0e537539d4c62a649a5019140c5590bc599dea20db5bffa7a9d2308b09dd09bd3aec5187aeabba3a1f86fba0653a7ef3f59b41eccd04769365f0fb8a5aaf20337279c2d453a9ad30e8af50a6204400ec74a00d8da1e5e96729c2db447bdc44ba641181c1acc1d44e4ee7111dc3957aacb3a9dd2b240e651b175bb3762cbe169ba0cf5aca31e6741ec4432b12c928fff0fc3e9d4f86559e02fab86e8f5ebfe318d1236313be1e0bc60337e48a88d0d43d25b5bf45c0d5d4e504e861ebe7fdccdb0c0b6e0d3d8c747dea89537588e9345cf69794a41b2005f2590af9d2868d1942eeff844d181e5d4382532b1ff5683fb2772797f9a34247c26b771e27f46e0b5fad048de62b33124aaa115d471a8135182603cf2904c9311789032c6e8e291317382d93a3104fe6b36b1bd9f1b7b05a9c000de6ae38a8ab735384b82cd40cb90df7343db7408dbcc4be9999191bea0b7e6a7b0375f3c5e9c22c4d363e388febc8969b95b92cb60674fad388607758fa6c23063b4f219beb317ee3c8fa900c38131281937a6e2e050d5a32dd0c912cfc042bd4b906594232b5f5dbbbe474320a7e1b015341f2be3f94b89b35bb99c43214a10a2a71c18e19965e4384ec82a77dd98f6c9fb750cdf8d0c6adc98e7548c2b80320da007b96dd22b760993ed56abbfcdb35c4204280462ccd516e1478850cef587add70cde6f656af735fa7c064d83bd6984c388844107b568fc5193471ae0f98bd56f3b92e87d6b21d2c299e6bb6b241351f11968ff0d1d456c5a6b1feef6abb5f11c8fb000ae5f004fe0e582271dc50eb09c1aa9310a5bd8f91f4951e392e94df60f068f92c69446130a2eab12bcadeb8496a1eb959ae1a009074c5e9ee79cb59c570a71ac0e4d84b7edf888c524d9f40cafeda624d36428c1526c706e73259e4bf2e7d661aa8d2b35de393b277ee496f8a4bd3b5fc2eaa6f5cb0766c7f72d2c54b61ac30c271baf5f546f0f349a3a8645eb9087525db079a008cf53145b979c745202a2f30e3f49aec4aae89546766b4f30de0cf097c4d124a490e0b183ca9341710f622eb029ea77e079719c266665d70ae777670dc088fe9b62284e91d5321c109f3ea69823c525a6dcd148a77b0e5dd23a0f75453d5f8325dd9fa44e1a39fe32346d174b39f92c30b373a6ae81b9591cdc2c16827e438cd3cd0bd495a10894e1d1736e17be7abbad3ea82a0f85ffd1e178dd2a343dad94a356fe78aae2664a05f5e134690fcb263bc549d89f5ed3de3a08ade18b365c45de5248b9b96577a5f1a590849594de672b91082da636a56bf3dec9ddc3b7c418ec5510ad7557c8667d3ab74ebc5144094071bbe484d822701d6686e5d169cb2f4fa47f2727e81e1c8ed147e411b2bff7f763d279e26836efb5f73b99425ffbffb79dd3dc38ba4a0be48da1054f500e94c1387315e227f51a666f5461547c2d522461748904946dc3700214c247a126263fb74b4716834f4476ae45280067dc3157a1ed86314baea349763c073766dbf2de4128876b38adca18c829a844c7671b6256f989bd7f5bb3c1f0626880edcaffe172607e1bb10a7f4aedc6b9dd0125d782bb85b940aed52390d5a6565d700b18ff8781a9094cc9e34b4bd2593dc5d4b82bb3a103482244725d41f7cb265abe3e0467dcd8ac6194d1b1c213e333e1e3884fa7f3017abb2f6bb969ec398c618ae0a044d9a65098418f190164bb5eaee81aa8ea065ab9e97ca495781bdd009291f7b495bd6404b18e8135089ea276b86ef957ad179232030a8745aac482e1f15bcc9f24f13ecee3b2d2ed22428fdb0c5022be3b1069f636f933ea4f40d3a003222c6ed04a9c2b9d4daec3c55c3e5c0c815c2b64e56943806e3faabf8a0759a808dff00e9c89f8715208f2be5c73578764d2864c7ff8731063161694e3c2eef65179c50bdf8cd980c9a045accf780a64de37d020f03ab67f05dae491815fd4306f866767b6757a21f7614f857b6f847c3ed3ea329456fc3b047d5f6ee6b6cbdfd9ec36425c331b20091d6d17e7e3430fb8268b956f54efbeeb664fc2789d30179014b82eeb085cc4ac66d564166f8de1d1b4b40099f4fc80703befc56b3062885d65e32afdab04424d1a5534c48c2f284ed2c432e1136e2232a6f9f497b2be9fae4c2293d7556a0deda3a164a10aa9b21c643c222459bb033e68e2c82789ff1ea8d761d5d9fce13c3b6bd6c401df5a3af6d518d30d7a36f87c2df6fc9a3b585ed88eaee65b3322240e6b7fe8ba5eb25c5e5d390ec7f18de27e4de8b03491f8e5696ce67c0ad1ca82b9a5a732a624768e2a6c216b93bfeec2bf0a9cb747bc20667b3466c63f724f248f6e27790249ebf019ffc49b2166ae1b979063aca492714386cce47f9895bba97ba1470274312b8d576d91d8a537cd4c7c627b5ccdd467518f5283c77b54cdabc475a15cae8bd2b8e4296868adae97c26ec900168e234ade7700e555904f8956571e9f5c17e0682a0744cadd20d1e60c24a30b03da945e870950c3feb027e61342dc9bdc68e7579043ed2e35630d014cb2b90d7767639630ae8f2741ca6c68d84993d165c48961ed6ca2f1e10411ddc47c338ff799890e9b83e9cf516b88257ee022fafcc161dc1a84d1cb9dd0e53edbad1088f244e2f27e70744cf74207621abc8882b847119c54e3b02615c7fd5cc06bbca44fb1ccf6a11155268915fe422bf9b1f081ca9c4fe046ef533985f77a9aa5008eea9776cb9b6aa6d606fdfe4b88ccaf85024d0d262a596c7d37db4e9a750eb70246a3825284cae7575be0f45dfadb9ed6d88430953cedc38a6616800e8dc06f2ff80022257116e87e543ec2d332540383f08424cba9910f605d98111ee18876dd4120658c2f5003ac9f86226efb2b5df47099e9bfcae42c3898a1a7fbb677026be356bae98637c3e4147ae8e0a1a2735d7bfc002ff3c0c226fdbea051783321a1cd8dc0f68a0fc007c7df9d5d6828fd7c2f49e9682185fc20cf0cffa18666ef3f3869c13cbd66fdd7d6d87738bec34b27ab11482a2e27a51af133931a4edf445fc3ed4ef60121fa5698a058491384141b3732314a0d82b8dbab252821e6efa0e5dcfaa1378be66ff8e3106c6281d647e4463cb6eefa1cbe9970f5837ce00a9432c5834dc15309ee29d20dbbfd51926db42e7b746cf686ef5f650679753f96e7683adc5620dfee0d385ddc3c3a1be030e212e2c32050dba140731626ed0478010699bf329a9bc2d170efb75ec9a03385d11a618e39870b07f6a2dee7cd98353891ac3d053c150dd577b64886ffb1cc3cea4e540a3a9d71cf9000cf7d71a40c2f166def8351fa52b81cd46e6f7816fc5df099fc0aa8062d08a7d1281115f8f4ceee96b1c96683d42eaede528e5edcbbcd8495ec6bfaea51773b30a718c49f255a73fa8cf553045a168afcafaef4969311be1d52875484b6be9b5e864914fc3be28a5a01fadc7c6cf0776bc2bf5f4619058656238e4e57431cfa9b9e06fe39e0ffe053dd5a704e1a50999417e587f2eab3d2b4b046b14c33f073fd201e26127a0ba02636603f5ec942f95549bac6a78558e767a895a51a56319f07fda6caa948d089b7ff5045eb17a31349b6c5b9032ff2c92c91af33958fc36f1c395fae2aed982d04adb985da37b1759f3ca2764a9d811ab580c302a0d92d856c6a934aa7c9e4666783561d5697f4ed67701642fc862b5f577cf7bab6f41eb08e8d116b1978c6e396595a1940ff4f587d66610312fb3558511664d61d903a5bd0097015e7f8e3efb5d43c4b87127e8bd8b719db70d3528a74618dc0f59ab661264b85ece3bcd75dd6a4814a1b6473ad914cfa5a8f3031d48acba5db6f967f8e1214ebf9656b9cc84fa429dc39dc6877e387d8c66a1bd790bb86ba3a23c6acba247a3b993792e4a8e490738a55b68305cf1fc09866726004314a5a862cece6976b8a6115c23538b7e221bd86602a7a871abf4c732a3a6ddd53e49d960243fd9b115230b4d9f27ea577ab5e8bb320cf855ca2361c0c510399af8816de855f0e653c8dc38a2fa79e9a3a92ce7dded7b9e0c327ab87aebcd9ac33948fd5b595e32be753c090c3128395d7aee890aaea9a9c8395cf2789e947df93edb44742092b7ab9eeab7d8b6c674a44415cf328369b29929d96dd0f7534d16ce305bc9aceacceb18d7a2149dfc87e7084c0be87239f91685afc1d17dc2f3ce009e0e894634d43008294696efe59a5e72ab19d91e17438a42c47577a9f64f96f2efc65ec87d0def3083c72c77eb82b53fd3a9c0bcab8daf971259ce30ebc9e37896e4d5e1dd84559c2e23b12c4ffa653b44a627e52d7c19519f57e02577c398beb740770e734f6f64b3902ab2051700eb4d7a051eca61ee29f319d581e52837c655870758cdca0cb41838eed72c6494a5f168377188ff631d693dd3cad9698d97e33746719cbed0e3f3cd23fa16e35dc5bd9fe4db61790c9259c55a4f715085a97ef2207f4d7b0256added5eefd4e0b04ad15f24f87e00d403ca5c25f75ba4224243e533853aeb01f3916c3ed592f93b74e0063a2e2e75ef97135ed83a96a04bdd4eac65666a34f381f88c026f56c1b492b95c42b9ba7d37628aa06f43fd2551b71b0301818a175c46b34a8f6a96984f2b327c3d53ea6699c16a471d634299223e6c24ed3e9ca09ea2f829ccbf3725bba5cd410ad3af9cda743cfc2c6c774f86a9fbfa73924d22fc58ff69ebe6d8dfabb9c5c91bc55d396473b0b7a0e90ff6a701cbf7fba2911ceec59e953e24fa2c85d5e2e1d3eadaa1a48009a9f90729a6571b8037d65b0d895435d52c2a9af2d468251bb6b34a4e2902f46d0b6631b44438086a2160dac83532181e23f9c1288999d432689932c5bc918c7aab7189286d0283ef4a7d5b47889975c8afbb79ae85fe032b572e02463c4a47d19ceffad001a78d4692d748606c8e31a7cbaf3979ffbab6d052504760380fe2e55218bbf3767edaf0dde4b93bcdaea077d9cc98d74a469aff4be93608e7a22e32212074e210ff044ddbd67c333fcd42736e98a7ea5a6c11cba95368f79ae1b5ca6c456d4a0cfa7a4c99a34b00c38ed6736d4a2a5299cfa39c5e8673725660ba153129df1c6fe1ba68fac1b43361e148f6ea107d8e4810ea625e4f74931add531bfecf5748c09f871c314763e1c3c4fe173356ea0db6cde6d77bb43b0a03a3c365efcadd4e7f9bb780e7ccc6243b4cc682596b9575bc527f3c8fe7bebc8a80b3145613fdd534dc7c72d05482190b39b0e2cc8f90e1d54243da8078130c4acd44d05764c2b1800b248b38d32dfbb8eba89db7d67486c785f834d62bd84a6f4898ab1c1f4809a0e3c88ee14382ceab4d25601d6ee677504151011c14c13ee6428b4239fd9d531d4457604cff3ccbfe813a9c1827baf02997d3abe0f5481d080dc8e7b6522e3bb1c7f0c647f6266e06a5c1dec20815bc51236e0cbe2ec8f6af9c2a13126c0f5533f1d0d3299d0fdc80429f79a23cbdc3864cef623ebaa4c57b3f6a0629fe2f127ae30b99bc5cd49eab0edd0099f45baf624bec1de31ba1e8775117a99e72756629be52a31fe1e039548e25b8e53a25f20f9514bfffa5c25c5a06c951bac48cc87782e8bf5e7e1fe4e5dab096fc0acf08cd070950b6862a391d1639423ec3660b841d1e4b3426a48ab6781ff2588203308d4be57a4726dfea0075c0d809269cc8534ef2b0a2edde3ead783a6cf3a05a160fba11ac467921e6c97ed93554d2783725b6c14ccbbd66a1020387837bd1d19ee1c8c4e692cfada040c961b69ff5294d34391f3fa951907a247a65172e610dbcf1d1ce9ffddcfe4f6737ce6e21ab5051f941e072203556a1148b46e32be9de0cd3e0d1f342bb7a3a5c323fbcfaafc182ea2d18fb6c39a47ecefd765ac78d95125fd091add3c1e7aff25a08600f409b44868616ab34111cff4117ef41eb2e25b0b5fb454c338e29e63fc479a5c44f14cfbbf97e040bb66a9a891ce63279178ae06fd35e4ffa569be1ed3396a1c6628001d105e4f9fb1228c52376284829a1fc96ddd839b00159711f3b366a4095ca346faadbde63f75e9ec6730f7e8f7a6d5cca8b4ee548695f6b4dfd4634532b1a528d9673762f8a6aacf2ed0ba7458ab1be5ae9bdb70cb940b91230cab81bd8491d1085f1dac8944c25f9c5635a26031026627fc680c92abf33286a07c8fdf7a6fffef123f245979ddf3672c43899b3ad7a89161fd2e772a0ba008660228fa833dbf56e49a0a18b5e8c69f9db3771466d45bfb59b72998c3a66f0af115405209ff45abc9a420d098fc4bf575b4f7b22115f3ad920452b98ef0697cdb2d3f5631064af36ae0173a22ec45c6450fe66facc99239763dd0ca87baeb60111b5ed21e1e48871740b71b55f8371e8b317e4ce36ad0ee5615fc989d9ea867ee6ef1f73efb081c0f2f59962f1c071db52ae33c47bbc12dfb27707625aa824aa53000f00a970a3a8c38926c512213669c60f9c875c83b9e2a171099ac0de6830188cc94959ca96337ff76786158827c9e427b2fc641fdd1499bd2e498c6935c32b7d09a3d8989cadd805b88eca44741c5de0a2169ae33946b279226f92068317e2fc1f015da9391464698fb99fe54978d1e48f3817d6956c0c7027ccbbead3c9c23d37fc89c5efaf0d29de3f3daff5bed497b8d81861d1cf8a42ac38ea9b5c9e0bf78ad08ad58e3cbad98e4ce8f1f3cf949975e492e474ec6de40304f4c89994d0fa3c301039a40565d290869dd772cd2e12d4645d47afa26dd15f1dbc5baef4d694c60ffb8a0bd181390cfca083d05041287fbce2501c9f884e73fc4f74bbad11f87f952043f396b7cf039e69822fab24aea9a54b2a5a4caed1cde899aa1c31cbfe84020fb40599809965811bd0cbe015c36d610de12a7c78f0d76a7fbd6b206fe2dac0009fac9b301236067a43df5db5dc9d2d0f795aa879dcfb544c2b1c9a90d99c4a212e2d9e2fe9a857c0039cfcc2507a71d9c5c69d1a2f858f41d5eeab864ec01e94b5c66aa35e4a0602327b42110bd91a28f3171ee969c4fa5d1a3acde6094ba47edf3759e1aec40315b7bf089be0c482b54150ec522b2cb2ac476721a42d16d30f37a178d11dad868397677edb3a0218625bd6539a32bee4126a9c95862dac1f5798d2a6e62f94301b5e1bac9c68ab40b5d0a93dc8d9a78cf79781670e2b78d4bb878830757b9dcc674f10c9ae3c498ecd591b8209821cb3034913af4853bebd1b1404709963962bc0e24b91eef54d87cfb12de6dae4af3f8474c64a285d9ae94a0a719e49053f3702e4fda91ffc6052bb3b0bb054db9df7a80a4f9c086566fa35f1199ffef8b1ac0cf261093a9a43c43a977f0eadf0a62b72c94e40011f71f0f2d89f095999c2ba86a83b77304f43781fe312d6eb382188281fa0c5bf71b9499025bec700bfddfa3fb6674ca374a42b11c0067a26f0f3e7696b7a7e0f0f72dcffc78c925bffc91243742fe23f28e86915767962185faa498d7403a7ad0e284748d8e33a2d900ce4cef18b29b986f3c5ae452402ce03dff893d29c58bacd78ddc480c83efb6d4bc8208317da8a34f63932f3ac7d703f1c8a320fba63ca1a6be35c9cc6e89ab8a1984f7adfb707412e299b43c872b7e2123a721e39e4b798e9b19e662379e794a4ca641f6d50b4ad0f5ea576c8f52b19d57ab41b31cec5f6a0160d11d4a83ae7154af6ba78245ea7556940c640adbb36a33dc4bf3ddfb4db5d38f699d1f9573370bd6af31e17882e4e18649565bad82d163b7f73036d239f2961ed3e3576c8c34e83c9d291b21ac108f3879ede20f4dd9bb0a4b3755964ef55b4b734e8d14651084fd639f483c36190a9129ef0f96aeb749503efd70586ec8a60cb6a0af13724950929c56c9c4cecab87263596e2f9dca4d02b4f918e3829239d5c6a4ed4932281ae572c74944a465e94e82d1190a2be10bfa120d91e24f78b0573fa72a90bf6a80b9a3ef93b1bbeed7364491f3204f899294e010f347179ff8a93e26a9900b82773ef53d70508aee40f6ffae5a8ee0111b22b8177399082ef16a02260202d99f24df0172afdeeadd6ae0e795c4e0ec31d3c79510b942455de63a1ae84eeb701bf6b60a7723ef4281e4a9678d72872c8eee2ceff867370d0efc1fc3cce8bfbbf51af800ffdbc69949b4d0402a546bab7d1ab8605b9c40f64b28200a86aff5d0326dcb9c2ff9c18580a8d169f870b8e45777cecaa144666fd4045ff9f632de5bc0a442dfec2c9c455884009acea7eb2fe772e4e055e0ed352e6e8e4017aac5c3a533ab458f64beed85db62ad2789c8e857f93320045ff86ae36aaa17d5c51dd2c44f41efd57eb34b7b30e18f38a618d83314c7c85495ba5fb9af5a5c3992c0a1386e202f22826913fc5a4e63b33311f954b544604e0168dc0537455bc4c43e63d6da5f00109433f17d9379aee53790fb371a0755c24f53e029066d149f021b9d062120f091f19002c61578c488b79e10152a1b98838df65b88db14984a3cf3a8f7651edecd8a9e741013b40517a5a2ef29850e8c917dda0de54788ac2137bab84f2e40d7013a49a67d678b3716d6f1026d0bacf0948a2c7e9e0d756877218a18d81354cd7135409101a5f1069b823b34c59e9581d4e648a48bd484eb705e429ba95b4fbedc024e2152fd0ad9a7b9eb2cc35a851da41fc318eb9b2a154eb18b3daeae9bf55de4b78614f024aba37fb2e8924c7d6de5c627fc97124fc68f3c29698c2c51bf1f943be91e13a3cb27c5c18d0bc53728dada97f095a54cbd2c4b9d630d790df010729b48e2483df2c45098ceecf082987cb1f31f2f029aca33c8dc49961121c06035bae6e5dd281fd87e530234af23229943515f3c1243509eb1741c623554f5e2c308c34e9465b08472bf3a110341b8a5b455fea2c49d02b9cefdadc1b5767412af934292b09f673735938e6a62f4e6c431d61240e3f4b93803e1711ef686b76f2ddb473a820e0ce6b354628f40b8c0f428e1aacef37d0e5691b6fca6ec684bf3d829cade09fa67cd9facabeb2e248a288b12c55b534f4076cb46660bb340a34439787d06a04f9baa3039d578b92b9cc2972e6c0c58aec54065d25493e4aeaf92781439eef19ec5219fea2ff4c901d4f816ec3c8e7ff9d4a95fc518d1c6a759bbd51e35d307970709e69867c336479084495db958726da53f9919521d207385b17ac4bb9fa8fe05ce3f7a828b4bee7f42d9490e9507cc87c41d3bccb713bfdc1afcdd030e48eb6653cb142d2258b1ba300db66a3e25a09df05478713e5df28159ff11752afba90b125215b001ee4d80d946f9ec49b7f5c7383e865ad6b62cc0dd4c4fc00289eedabd20ec9b58496a64504572cd1d165bacd493f9e354cf576c95d3add0217aafd1a63a8ed214d95c76b3613ed583b380501833e3c20a65ceafba82345c97dc61f666f994ca02fb7116850ba767d517bd9d10ed88ce7fee0a2a30cea1d2b0a9ce6bb54eba9ab3b079821d2ac03e7f471eefceb2572715546c9fb9f0a3f83a79664838adb957d4e1f29cef2d44beabb54d7017bfe6d88b782928c017e914af5e384d81742f2e3bf499a9bfb04a6cfb04c316b113065c09bad4192cd298478c4f7e4bf65a3649439f8680e8600d296861f7bf05d6d4ced9bbeef4447a1e45dc052a9460d2790da2b21f3bcb6b79ccf05ec49c1c1d54708a085f96f5c8453a2db5b61bb994528fc08e78b8abd4a6b64fdab130f32b227589cd554affd7057c7bb01b67e8d368f17e700e9b9923d0511db48ca2babd1ef2000ac4ad10c04b29736e6acb8a5d6baa2a0d79e5d845a5831f82afaa1f3e91948d8c2565528c16f2715198e5d83f69b5399804988de501309e8c9cc1acc2b00ffcdaf3b47bb80bda393f24c5dda4980d4afb013b96d7c995267c775ca2e211e68d51743ec482a71be3a68ef71f41fcf0fd9676f1c95e0d02adaa48769fe5a5dd6d39842c1757bea66e3a2919a973d9d3a043e3c3b51f371b733f250e9b4ccdd8df0c7c2adeea1055f5d615a4304ba2f414e83efb6453fa512428ec10185ddf2f1094189a771b38bfcee5b3d2144322bd0acac53073f6da122864b63456038b146953202a508a3a639cfd61fb9cb7e6c0d367ef2ced418efdc61ae822aa1d647a84efedaae1b41a2e883ab799dfd876fa3fef647c7e40079b67125df76ae218442515fd56b8a2ab52b4331ca7e7cc7fb42b5ba43ca910628b405637845eaa21080f8ddc28e860aa25c5e1c77278791a953685412d4eed61a9348e9881c77ad4ca9ccde0e06351fb0827247eeb4499e5885ec4577900521b5a027f7e9c65cdc146724c9cb9690be561c92f4ebb3ef4aa4249a130d187d74ba2173219ede6c6c3ecc884dcd2c3c38c551f211173c81afb4ca1dc4d259cd88271e3f0c74b70ae99332ca41e95a64379b6a777f21d917684893ea30182507709fa4f4435ffa791443d21dcaffbd877e26cb7c1edc1a3c830e77eff3ba6f86dda084d9d7a77c0be090765954ca2582101d28051c0070767431426a2c1a567a3650074012e8916bd9ec1911a1e8ec3b6a6b32294f7920c073fabafa2251d57632c283cb0d5c310b9b8fd02e65535d7591c57975d8ef82f1c67fdc90997b53102d38a64fb7bc37e20d5d84fef9bb96e79be85a1aad59c12af08982678fc60fca0807438d087962d95341413d243b8128161b0dbb18266539ab25fb595c48553547b535420b640de7d02517d1d0efb2e7de18006dbec88398f0fdee6f428b5d20ce5ae51016919e4718b506896097774dc62a971d12b1a6228f1c9d1d979bac5484cb1b10bceb659f78a0bbf9d7eb7b5044b4355020d6c1709359d7f3f33047bd28c55b1ca98490edd1de7d5726ef585cc7f3d18c32341f59c764177183e12bd71e1fb5ae40b3b4ebf4f5f2a2d523b3fcbde03ce0cb70aef9bcc65efa97e0d7794afb2aa2bb14bb695e1224f16ab402240a992f19c19cf693738f0c608a22ab4a9190675d8a6dcff22d9c7b66f5906489c55a8329212c66a31963c97fb0dee05e32f96244f262b16fca011c28fa02eb16dda36c330a0cf95c2a3fe8270cb73fb716f2ccdd9b79ee9d871d8bc62406f16539f478f18aeaef26371c1c7996eed73617baf0712ec41179c04eb07d3828abf03c3da831799d759a7405d340b0f0de90f04a74729ed2021b9b1e5949ec9b4742f0c5ecba0a0bce471486b645749151559db1a2b61454ef0d222e3606a955ccece2beabf5fedfe330bdf90c6293b92536faa5007a3f9be2fa37c459b1369902feac0811142bf4b04861d53ac150ec728a48a2936b8fd9e43aad0e4be34ceb60a91e5a82335cf4ad34e33285817e3493492c07fd27fd859d6579d2cb1fade9e411904ebd4801a0939d8b347dde6e9c2cdf0e52444dd3b9be52648dfa87bbbc9fe79947acd9672b8a1b5bda3a6e1553083005a13b3378ab1298572deede63b96c3d4d8d2674d87e74705739a62d037e560053ce49321f48f52389b11b33427e569605b14f0779a06a71c4ac81c35fd7f5a5f43712369ca235e53500378fa6eb4aa0a66f53577096275ea7536491e5c15c39a42f64e4d9aca5c41fead5747684ce2010410135aded7bb902de0b22698dc07749133c48afec58d6aacea0bd9137a8b37cd5e631557b9a1a032dfe4092e837ef7da93b71f6acec5de92a0c792a77c90ea9ef68de7a7071d60a2326ee8a74ad3d3457e64d5e44a09aad648c00f21536fff74e124b5d3449b75c5db1528950fadbcaf495bb45e39052aa5a377855f639a62f720e7fc086c0d671a2b4b2569d12fd303b0e352a4d725656f77a856b06799160c5204f666cc3eea2529770c80bf60aff4f96d752e8c2ce1e9ef53b60c9ea60c52002b7c88d599ca9432134713325ba7fdcbb8bc9900bd1a2f03f79009ec32900ee5cfae1e695da46bd3a351e7277fb22b35776879e394f7357f49bd5ce8e300d1bc154cf12362d7c17ca6384d8de3bfd93f05e0b71e20094989b7a038f2621d5ca28a22e9401215a65f46658948b0f0c76482f9b616256aeebe82b8e66adf41cc5bdf0c89b12eb7a39fa3ddd0053aa7ef0b29492b5026b025d0628b973708a20715f5b401d9beea592d0e52d1498a4f099685d0b67986b5d28165d877294d4830109737e3ff0fa438612e4d3f1c6a8dccd999d75eafee91efa20262f55db27c69859b5bb8d818cc57ca420d3cd7a4ece2284d31571ac5eb0949c3aca4272b043cf3b19a227173059cd7449b60a801e7efcec7a11bdfa796bf315967a7c5f007bd0d7f0cf209f232f81a5cb2d9b474a043aa6d11f9f0d007eb088eee18c410d4b7a49b7c88b34aa9ce97144f3307b6580e39f186288b618b5acace8e39e2322c41a2a4c37c5ee5eab1c5065653da1864d79022d3aef62433816ef605b2bfded96159d1ca2824ed0f340e3ce12b96353c2cdf57526e75dd1b53a9cd7af038467900e67166de64786f722e5f3e719ef3a1e3ef4ca103f9e1555cafcd6646f6a897bfa4a4a60cfd71a43c1bc39fb79de4274eeef13ff964116d6ac1306b5e9622a295a901b366689c7006e830c6c10c09756e98562af9a87712e0a7dff7201284a400113f3c4fba4d7d2c6e557ba0ca0fe36e4a5c0bea9a13308590183473d6a76a5c38c774029cb258780e496d46ac2eea3682bde6e9f074afcdc0e99664dd64afa539732c71d8ca8a64cf80eae1d26a8139abe3f7254859aafe80e0cb49e1c57b2813f3b7af3a76ba4097b7b1024eb1acda87989cde994083d0ee820a3fa35596ed801b05ffcbf5cfb55c6f2ae64869bfcb07056dfa351140cfef62634f400585ca2c3519a84ffb8153682edc2955a8347c31847dfb5bb2d3001bea42c11d18971d99bf31caa35a1194e19da52c36ed018293d659d82a70fd85d25f1968905a4ecdf226b5ee459b1d17ba94234f8d827761a8ce0f6a6a277114468bb5f9be7934f7d8f90f88b92349489e2e2870dd55428a7bc608a460d48346f071fdd8c01a54cbc7d964cda1949bd7c7e8684725edf5f142c9a12b8572e20031604fc533ae9c90ff6b06f9074a34ca85e9a81651eb7bf2f415d1efaf7778f3491f3d72e11b31f77a80da578f45a0ac770a938a26f5fe497c4dbd6ac0d440967871d30ba562c5759363d128f318e8b702dca7aa055de00336fe90c0c7baff4f4dcd08ae0d4a9b08ff8d1a2802927ab0852b8ce81acc7bb0806ee81872435dfd56a402b2e845641270fa6e48d76eb4135e7f631e3cc8a3de819471effbc58a3b3d8c5ec582cfd0230a6f67f7ef26c648a24be6dcbbe135427d861a5ad3ed1d1501e9a10b9a452344795318be391d10dc42acfa25260730a2a569f1eba52e4f636c2b06287eeacbe7badc09758a1d1c2bf7df9ba99a9836e212c1546162913471f327e64f696f0bdadb4fa7ecf7815c77e86d648340181e2de6c9ba5a25581829f9fb4303a8e0d156a6d3d376d5a01f52ed4a955d3a6c0178d8359fe7c4fb0b65a45eaf63e2faa08a8d9a318311d7923ebcc11a1ccb622ef18f91009dbaa3820aa5f2897219068316258686c6d70b8ede1b913253bfdc2d28d235ea86cb60b7e612c0c588a6cb136df571847dd649f2d81a60ced0c2c6555aac2969fd896ae61116c91740aea5756204a512b48c7ad632f6d03838a6b787cc6c25fbc8c56114d849d26eaecdb6914b026bcacf8317e4cdbadc431fd58acb79955fa484f2259b96d404ece5373e3c165cb8153cbc9b909f25b41ae2d3c38a1a3005505f05bc9c181c1f82875b929b13936fffc739744061e945b250a978f7a21d3a4987da20e84c3b9896dfdee83f7a09385e15775e6c252c48b15b642aabac4bf6ccdb939a69f880589474553339a54ea7e47980d178db8607b0b5df97450b4495571f5471feee6bd97c30fa5b7cc3d498c11ecd0a677f9b7a884efd7b03e7d6662bf4ddcfbb4ac5cf68a52f7be6dcba020872e4e8d23fa8b42d8b69ac0a1ceea8d38de2629142300db79bb0128f33cc229e88bc66728042fb0a803a9789ff75b500922522cd203afe26013f62634bb5f71d28124a5a6597adea3a995c9faf342dda644826728650e89a4b5a49626843e0c47d67074843fd519f9ba57d1202dd29499e57c876e54b4009010ad429710a719b524bd2750a52d6edf47e19282f8b9fca31259db202077ba268cbc3dad1fc3a5a985bb6e381927740614b21f9ecb6d1ed9439cf235a4b9c8d12f8ec6ad00c6cc1d050e2ce5b977edca7ca4d1ad1afecf55832c8ac192ae758a9a6150b837d8644e1bf09daf73f81bd0ddf73f2edc910348cd9d1ca205d7ef2a043e09c5c7d798eed4e143feb7ba16449819e0165ffb6fae8b88635163840e36ba9a6b6408014e9bf52d6f312e98d930201b4e304bc5ab24f76b29555a5d2abd0fedf7d801587fc52d575c4b8fda6727e5ef2e5af793667b43f82f0334eb3646fb40038e90298885d4c1f72b36868c3ddc369af1dc11c0c5a2b248db84a5f483157c4e44c5bacd3129fe33f328ee253347881e17d10906382dfaea7784c8be7cc923ae3cab2011b2fa16396b146924945b3d669df870166636e1638fc13b29e4bcc2f6328748a4c74a0cb472ac80d4900d628e6c7b4d150ae1608def61313aea3606109843179c8ace56d9490e2caff6b568e4b61685d99c0c3bfe1da8a2790a79bd579c0e0aafbd39b6d580f6bf98ef60f3aeb8ded7f8a9ff8bb0876b489849df6f615edd75a1eca3564895fcbf65547644f70524ce3d710f9df78c8aeb1a6cd35c930b1e6b73a15ba6689a2e12fe9529ca1ffd030694ee7561fe58dcbdde85d248b4f45445eb03f3476465097d0faf7aaf30e5c947d1be93068b6b14c2207ad4c72f8bd51a0b0ea9d55be4a25c0f6f72093b3474997ee08d4a793e98643d560abd7b8061ba7622eefe8bbd5b9fe3eca7baa930d639937e52fb14e132bd3f3ee68f980860059bfafaa7422d2f56e74d9349e5d1bb8ff43bc993738b62879db346aa899471cccff1542b4160d9cb962cf1ba8f28faa7ba950a830a15664eca5b2a287d10c090cfa8249f84979f50de0382ef9fa4677dd211d6c5426b9a6087a4fe753e4a5d1773ffeb7b5c6ef2f9dde969421bcbc9884d9ed7fc9df404d39b34834a8ebf0221ec4ac6df99729f27916073c7587642682722bddf0388a660c277732ef54fb7ef2ec1543cda9a512451b348396871700c542da2f172825ba93e5eaa1f0317436a30c9a1c1a822e6aaf5e457ad8c585c6efbfd8dabd1e207b582ed73cb65429308606d4f3a6818b510b59e18c5d2e313a06b1fc91f10d64bdb450dc850dd1c0543d34f94f979885de0458eff14bc14982adad86a3eb1c616c688d48fd7c86fcaec6ebd1d46204ec5291e5b5bf845829ff09a7e87b709e10d266e2b1f9301c2b9f41e4825369d0dc00f1559ffe7fff1cc0d4908e3ed29ffba61c52c94f2cce1166c138b7e10a8423a9ad27a994687ddce50d6712ea6a859b79d0d1a5594f9c1c9bb69e22a3d3391c5fd3af31549b737b101aa0640d617135a81dac8fcc5a6a1b01443da4d73c80e821a7ab429e0ee1b67202366aa85c45cc6e7fdfa7322d980884a9f0e7f8938f8e0618153e41533c292d098c5052520c68edf34922094ecc4ad3206e767689157af2343c034d9324236ac86d68e5a37088c69f3a6c5ae989e1c8ff1f6813dd3a30963530c9a3cb79e85a5683ec0b41be62d68784d6bae87f991e9d68c3bd919cd869bd1bfa02c056898f31ca6f9da536bfe7ba5d753a2951211d6895377a5c9366a27b4e38ecd3006ef0864fd6b4359a29b5949f575849e8ebfe6a746efa19f7f3c87a713725873d904a3adf6cab808ab07790540b4293f2c74beeec157ee786dd5d8ad7b181f905dfe714e9c571c4a7929b9b746ed5c7beec330c1e7b53c4ba1fa1f871bbdb6cc1ca9fc2a7e09bc91070d355f066879cec47ab0b85e83fda81f121225b297dab90d7b2a81641d89b0555d14379813726c38f78f5488610216c13e40fe83966c919aa120d59d012ff8d8e0af3b638057f7458441be9081de4f89c6e354b43a6a3456293f6dcc25a7e6341d04cdc54d946fcae3a8f7e9c42a9eab22cca5c70c673ba321e85d04221869555b96baf454f96aabbeb86d4aee2248e860b81d6be6dc27bb8b26f5e29941881e2dec7447edce5a7c40d87703b66a596e5f0937780f83ffc703b976f63a149478aa56d8e443283aee3c8f8b57b1bbebaa9f0693a454f12119c7be8d16fa5f4df64bc27e4aca33fb94a6bd372b9cc008ae4fce3702806f95e9b6efa5d22e8713c024f01b9373978cabdcd9fe80bea43a5f4c97825d97091df93ded7b81b6ba34fbb4833e819d5a48c6624e9f2829c29c0898c07e74a6309fe999f44d88f6478c8365f53320088a337bd2edfa7efd95f2741371d784bbb2c78304949c1749e3fc97acf1b1128a0319c4c0695cefb84b2f5d3b0346b789bf9fec472cc012ddc0e14e41eceb5630c336ccce039e6ac15db552a89b5849603aeea832f6eb5a9fd461faf5e486b077291ad3b562dc25789ddcf9caaeabcee33b1114b66f1621abdc6b138fac96db85387e036af6fdb69eb4c96cf68859b5dca5bfa7da8cb0c38c1aaf7585f9f5d5a9524817df4501a934dd62874b9b26c3d789f69c87838c5b6cd02211615e58c294f790f3d47262c359ca4aeeffd15e31695364e6aa75316f09c93149678d51463a9337f62884f6ae54987438197ebe7a256906fca77cbb22db7550c9bfb433af7f9d652375eb26c05013e68538084a33978df4f261153e14eeb344ad1e1f2426ffedb0f6118cc7adfa3b09a8907e382d09fbf94c881b8bbc0eb17fa726e7b90bdf325558ba56226e46f7f8a22b501d384a70f2fcacf7b3ea5f7c9a4c53b41a325b2a4b4f504d4db4958bc472ca2feb8cd7917c847dfad69a1f2c545a42ccd18d6549aa08f80db487c0db4c2c0e253b402b72c3cd9d8bc45488e3ca75576eaf18387468b75120bcf72be8e1a83405c6b89fa9a289edb78d5575e5d9d1011e18a685eb00ddacf4e0cce1fbbde3543d9b58a10149a0529dd379f541c77a4cdcbc403a5880b1d11a810987064f1c2bbb59753b2d97e8cc94bae63f1acaa18fd58307c8c7282c662fe27aa3404cd435bcf329e412d9a62212c7f77116439ef918befeb6e10dea86aa18b3d86f5c158feae2484c9abb557d07ef81b795214d1248b13e42468c6435808d5c9294d2e18cb782c9066d30e6de0153e843ced05a42edcaa679548728618f8e571f1dceb6996869ef328bd4339a8b86cc1cb61a93db43f8e16828e4b36fbda508fda86dbd540baff69ed37d75d62e04c62df34ba0f5a9efeecfc830436f2d7e551ab314a2d15a6ee6dfb0dce09cb744412d7a25870f1068424eba69f88bad0af5cefeddd20c77c9d0b8e8294b731ed5d121c70c50a0aa446290383f6a325e04adcc15fd9d4937af41bf61618d392c52d1331cd08f489226e9ad6f3ecd44292f0d781065584d1129addcadc8a1cc7f05372324d6531452d8f11445adabf490c14bbf5f27e784c58d837fd140465fc38139300c33fef05485c7befddcf4dff90b273c31425f9cafc92df316cbc41607934a04b88ebb406948984369d162195984609b196c1f2e617cb6dad26662b82ae4efac920c87743d18dec5c91a7aeac8f63fdea3c051711695f1148a09b26e406a244bf060cd553be0486d17566d75a8dd9b489b2a2030e395cd5a01a6ce96bb9ec58eddd3f9fabad747a28d99463e7ed33c6ea9707106dd74440091ebbfd7443b57f9c2587778377665cddf57110eb84b22232fb924ee5571af36f48491b6b577a300e0d1c0386887679709a3a0f3b525788b9cbc367c1220749df94a3fba561d4a6cb3d1db7a77844501ab267572c18a6d11708ff343d918c6636aa184b096da00a6c06f0be98f7bcda6bb5b31dee460b6ca3bf531fda3126dc7da4641007b341bfc061358a7ce402587ee5939eb3d27ef9177b690487ca817a2eab090b31bbf2bce2ce82cddfd20fd3e9c62e5a331b328c4483681065c6d5b27b482d72b99b07baae280170dde4c879baaea0bbc1b909f40c5b5b85f37f87ac0d4e71c86e91d8a1c92e01ecb3690b972b31e3465df2113039a74cfcae99e091bcb8b1a6eef4c7e33b916dfe4076b3e15a59da7034850fdb1147969e975e042fd69ff678c77cdcdb8720c5153f8f0a1d122d5e051026c16e289b24c6e0318564666712480dc349178054c5b09d5c64d8160537b0a87ab52eb7a0559839f4d0fefaff0d3a1b58f00f1decd107348e693b48c4a48f4b96a6a33c1fc3bc8ae69acaec02c5235b4afbc62fb87175ad289338b4c5cf4252173bc8494ec1d30218d02173ecd0765895f530d2c3a7a565eae3cc17f9ea26c008637f8fb5faee78ec7f05f950b3822d9f78201c13a852d63b568c676c683c2a32e2920583977a4b5022b5d63ddb5f3219ca8f41645916dd36e1f9029abfdb66ca3a04b14f9e3b06e877d917a53d9d8ae982aa7b4da72bfaffd37151b18c6271a898964ce344d99614c3de887c4191335ba3880fbb245cc76abd7eea822f17767fed3e053e9c987d59c4092b5c4c6cb5cc8c5a76462c1c44078e6c8e6ac4135410e061457243f30c0cb3d73ddef4eced8885f6569a6e2a13316f4b7f0839f9cca3f648ae678d2937f310c3922dfdfc9ee3023085b55612a985a7727765ed540c5e77b0466650930ee4c77d5600f14be8aba0dd3bc5244a9ea3e7e90729baba4a02a92933406f37fadaa3733efcbd863ec6980d15404936ac1e0ab3c9ea9d9af3e3991a71ccffa16cca1284939fd2c86fd2c8f4a3018053b10ee25149a387e775b219528a3ac14197a9e839ee99b6b6821f5bb33e8433e858649d399f08a5a0891a5614ce8ec40bb4d525340762269243973640530d4a504460f813ab8b484a106862126562f42f31d906df0a60dc7674c443d77b437c8410af6a621f6be999bced355f6c21d2a9f650854caf57860f3f20ef5d28776264c2ef9736d4f33b4a14de0ab20ed5f2f6aa63e658f1eeebb27a369f08a49b0b64f9884483d72127ffc40d1ca1ba63c43e7be54bb5c242704bc4b0040ab4ada29b72258a66d9138aceaa40751e20e1802716959f72e6797837f08193a944ebfe8da7541914e22e640239b98f38e5b18123df3b532612bb1b7338e314ec4e20341dc09b39e02688b2bba34aaf136b392ccbc32721901082a0889063aa091980db32a86c1b910d1c7fa216fad4aef649f58385829e7ffe213ce8b04e269622156c2e408dd5cc3a23fb0b87c1bf230931246ff51f965795b10f48838244e81719f38ae46fdf1a7ed9cc1dfe4036956e4bae79a738a56b8d9ded7dc4e6a26e3f5b44e704d58b91d133a10e3390a5a9cf0391b3f75c816c2b08a50b59d0a629e0f0649cc8c2b74dd0231b4bc444248c357dbefd472d61e4fbda16935fd06c08b3a3820c4e0af19655ee5b251158f4d746cc5dde48bfb90e037e76faf3e9a52b901cb41d071fb2f80cca3d9b6453649929a771d10286aa5b05a7365ca6427ed09b4af97d8c084b7254757c1efec1d9ddd6e86fad83aede1c6b851297d9f7a4d4dbdf68df3284ff75e7c019e2d94d599fd525161073738addc9ddaae39804aac40479584e7491325788acb03d8789301b6306229522e77ebc6bd9c9b9921d0286fccfc9fed9e34bfad9aff155275338bee493326e726ad2c19faabc93b610c960411d13b3cfaa12c94d3ad8ebe35ca2b034f0edc788a86fded0b286b72f972ff238698d00a0be9cf4049467d315c4d45777b9f62eed162821ac0d55a76e85c8676f4e4e15a03185985df81a1137ead9368725440649f5392f41c0dae73ad8120673ef6ec04bb7feb00e2bd7b9a6f888461016d4da8373c0b90dc5223eb847a8f4666d306a405b86e7918472ff0e374d76e1043127ef14a7366d2553b512577565c996e0189f45feb771453496a202683c9581c8ee6bc3c46b108da9b5976702cbd8f764d09d1606e169c05d06c3aeced3843308e7b9842e0636bdcd9fa01e7c62942bd6e1622c9f7ae74ffb2c80b88b70e506285bf5ea7cafd194470189730f4c91a7257ebadc7fc8a5a53cd705baeb24fa19895fcc7a617f1f48d27f09ce1503e189df03fe9c857e293aee5eb49c0a5dacfcbafa8274da9505180807c7ee15a06f68cd86912421502479bd7abffe34b12a3fb2205f5626a4b28b0b9e4aec22e7488384b8756b44859b2b520924f72a2803a7eee4dfb10c655e1b945238d601ab8f165f5dce1e1f561970b9a40003d12f9920425baf75bfd7e3c2c89abbeb9c81637e67bb94e37afbc83f30c51a9c409e42b961dc0e9ed8b4800cce377f7a2ede9fd5b612c3a86e30eb9ca63f99ffcc0db64fbfdb798806dee2bfd830ee31b11c7cb3c4ccd9f1c50bbb931e6a17c0b24b897d35c5d1de2915eec79ed78c5d2034b98ba409012dacd3b43a2409d7cf8b3bd0053b226142a28efb00a88c32f7e22db3ee25161e71a7f40fe8c08af1cedd181e2c9addd535fb88d972c9a4cbb9e674b39839cd2014245e42eed352da8a77f0f23af6bea37cfb72b098531220bffcedd96b6e317313a4173d2f22dd7b32ea67aeec8ae6c844dc927ce7ebe0b2fd0de226ed929de44e68d377acb992c501d7f250a663b0c7fb870e869fc107afbc26e5e06951d582f240efb010fa73c6730d3d434a746023b83a725122614bb45d391301048bae46c725bd7e0cee53a7d88d93aeb1eab09d08d7c93ed8d629c089250c0bc0c81757a3475c127e0c3918a08d176b2272194dcc731ece2338671fb36e22e6a16df14676cba9d00089314eab27382a67cf900484ada78be2dfb8ef8f4e4f8a58501d9efaae4b8b065a4d76ee6c8971119b256d46059bd858a04c6dcbc69839ccc1f1296e41977e261b7893eb064b5673e0bb1bfc99e313bce76f84f8a7f588eaa366dd9e7eebeb85aeeb988138b4b9ad813eec88e9ebe11aa778240eead10141569ba086ab0dbe204afa99e5970009014dc9854a4fcaff75eab55389f74a7e573cdc42b65d8d49ce9814048104846b64cbbd5d341dafc051f649fd4acf91375e910c11206942952b6c4d95a0f3ce7989711a7e3df9f1b004c31d1f340a7591ab7800925c2a853849c5666baac2165cadcbd172aac90d0792b97f9c7476e6e24c06ffaca738c5b4c5151b5bbfa8f9296175e40f0cecd25d8f0b9ec51b48af98ea6fcee634329791f858570f4623300dac74c31b9d4334719bd80fb8915a9f8597846accace2ed896e9106f9e51afcd44216d50ef3f76739eab3a38d6b392dbe4313ce70895e1e204c067c70a282f4ff5f27d1ed82443dab893e8ed24eb6483bb2b7c62b6b74173227e987a164ae89d31a95abc4e9a947ee6b3b50fb5e9dc1961a74ea5e58049eb792fd847f5b27f2fa2f3e95d66fafa0e784465d956a9804aea95600937bdabceae2f4bd0209c5bf0ce395c3b859c007d20b24be85467dab75b9d79a50bcf2e9c5aed91a86fb4dcc578cabaac5ebdc8f142e853d7923e5a6adaecbbbf5780471390bfdcb255953a95b62b3aff8002d699e6d18223e3e5ea5b32ab5ff91756e6bc7b3c397419545123667e07a1ef871fa93890a37d771ada063078bfb313ead94ba61c1d73953cee829f6411f09b7b45abc335dcc04402295b6a6a1b739d1ba37456b2524ce504ffffcd7052507094e6917a0f1ae86624c8851affcd58fc2c9451bf36f1a234d40b488eeb4954a8bac94b19584f54cb0ff185e59c4126d3fdefa077352341b1af48504da989281a4bbbbd564fc31171d25d3c691ba29080dcc45cf92cfdb5b8f43858e974ba5e617f8aa9f6742068473553e266ea08b2a8e8f1c3d67a6eed05d700e63a3c408a20de1dc6dcbd86a9fdd163721a69f7b313863df800979b16d15763a28fa6a52b77fccaadfc97b335b5dd533256bffa59230852ca15b5ab0f336008893d55e4c383e091c3374cd29da9472e34c4c9af70cc39f931364eb22191e4ca22def3f7873008eb5f161c6e615d6c993845564d08ba12190c285e65da4751019956b9faac50bfc424f6bcd9a3a3b14c6aa3bcb60a05956fbab91cb7d3f325089b319223157a90f412e44f59b7f0d83ced8f4d837a17875060e8372291a525e557d428d5ca3776fc0e2e9151d9be033b68cf0de25b9c228a1db579b16abf1c8cdf6f9ace75f6e3844afe9386e844b564d0086bb99f7c16060e5c9e79c6105787ab4dd09890e35663f23ebdd92bea515bcf5891cf86fda2b65a5c191f86b902dd615fac5fd2da8edd3b08544bd0a51c15475efe55e2146d615649e65eb1d5eeafc20ffd281b1777c3a1809f7042a82eda30cb10b73ae873f5cb2343bdae657998373fb6f0b9ff1795752b8d4c8f256e51e4495a5b4886bfe593fe724edb0c581564e6016a5de6330c07e263a11cd4a3fa684dfa5964562857fdb94983bbbbac73795601a0f5c27ad0f4e99172842ecaa257d4f22df69f4d258fe17d6106d9316d96c667471a28c65615cecad807eab9463468ab10cb064801d3def26d4f7df921ac2495456b391487eab58f37d33d7734a3ff993912ad1ad65ed5bba3dad84b1035623fa832f723a936113c4394bb2db1346332de8cf6a0848da4c88d24e14060eb1533164f7d8dff862c0b3405c53fa86ae298b9da7e412501a0d6cbc1025ee60c0ff508166acc5b400e4a730779a83255eeec1ab3108b9d049eff2546dd2340a318b3a5501a9e4237ba0db0d418c653d86c0aadb742fb7539b8620f27c38198d75820226a3750a12bb18e699124a8861b811954cd9065b78323201eff3c16a5e317d8e3a8cb91cc517c9f9d33d9d46ebeafbfa81d4d2393706feaf26e5e74ffc493d234b2e3135b809489d0e35eea4d1e9d96eed250514f7f104db2c91d5c77d0f23fa950d0aa3362feb0a7720a509315e4f1f08566d117339a60e63f2a6ba0a9b994bc1a4b58dd52db7b3ceac0c2f4ea7f52f0e7ca6a30b58e35b6974e6a03127e8ece2ffb70cc25cf6cd385652052854a531d7f067f13c270b483ed072f1ab444ebf17f95966f9b745014557620f478cdfc6957fbe6405b22b4b51de6d711fcab122df2f8e3041886d49d7777df4c9715ae95e20041c814a5ab77928ff5b261341186bff2f6d1f536dc286716a9e9f19160d81749e3113c7cdce9d404fadcb05a5cb84f3c964e2d2e413605bf69cf0540431e1f28c5be8c01e8dec9b26246705fde031df1d43f696601390768761bd0a8d0a987542f368e85eae0097c8c7e3b3266fc7f67754e2c6f4b4d6ab0bdc9a932e01b85fe25efc2832f40816cf0676fb681f0bf343c09a26822e9c8d019e8f5d3a611333ea5ab67e6324231f37cbdfa60a3f140f2a9c97ef4e1a383919467d689008a954f0460871819c5c8294ed13591b05e0ba12591431248736e09548870a1e8476f0b13a81d75cf2815fac840664d9ae79bfe5f5bd29f646bdf2dc473766aa0af3bc48b9b3bf4999d79f32261915db9ad3f8fd020d47061546ddaab99f33a0e2bbe7959ebd64baa1ff15b0b5a8deedec77c8e6141c65bc3fa8069ef0e1b75643189853110872ab7b63351a40c691fe9344e48ed43e7ba61936dfc9685bcd1b4a15ffe44223ca3749d9e9406927b2f11254d9af93e3707c0577a27bc2d951fd11127e54885154d725361be5c15595094452fde3ed4a1a9bd2302db5e18a189a1018fdd447b63cfbbf9f22925ed896ef482859fae6efed417ce9afe429269d997f263cca9f64ab130845fab0313c9ca2473593d2b31adc4b98dfe972d125dc1511572355c5ffdaf246045b0b568b30f7ac950fdcbd53f1b2363809b19c3944be8dbe8415e9297f724798a614c06ed33643009127c49a0ee8bead59b8b4ab7bbd9eccfe501287c57fb8c1f5653e1ab6111b1b86ba65ee6a2802d5406797523bbb4f2dd0ce061dd2a8a85db4d85d3cd266fc6b4b6b0dab402c373ef6f40a3270b2f42350e5e51073e37514576f8e406c68fb73aa7eed28ad6d2e5abc5c5fa447177fb41fe3549848bf2c293cd2bac7e39e0fae0e062277753d6cb26f2da5645d6ea4094fd072b17a6804c0dc1edf4d61f129fcea49fe162bdddca3a66a69268eabffdf7732160ecbe66cf173ff072e65d7a55fc25356d5ded7ea3a029373ddf56e07864f123fab5720fab530f12f0f70705584eb04563c78abc7c69489d9b04bf5132e509380116556239c99a319f12c240e2d12b002c9a5cbb1baee7cd491e57ffd54cb57b0ebfefa7b9919382646db8ce8661f10f5052243e60bc2ecfb760a01307525cd9640f0ed79bf25008d086c7908f4b884cb3b125b5730c2ea2a1c4ee5c76fce4b5da4584403e0b0c2a41adfa161216eb9882d0f6bca67c0a288438b4fe9db7691daa06daf68fb541a49f3d98f7dffa27b61d1e85ede6516507f1288747cf927ef8238fe13b8ec458de8335db72609f2ab22c1b6249e2e1921fa7659a6e9c2eae49452463a256f8cbf30b2796aef8e0e8a87fa073cafa2061c164cd59e3ee24e036b66530c635792cb46c885b37f462a0bafe646cf9de428667ebcbfdfe8e32402339065d4a5b2ad83be66c136fa1bc963accf63370f45947df4b3da8021ddb4bc7d7e1e33efa6877834163a1531096e7eb2bfaebb97910b4fe63341bf8de0c3e3806c04e2bedb01cfd1b29511fbcbadda137803a57df381458eedc6eeda659bd0a2ed455e4bc773d71db0fc7149a2ead7e049c97b9c2b2fd81e5d52f77f6acddef18c883d3d6a68872a4d7ecd1cd387e3f17faf42f9647dbb3a190199d5436079dec4bf37f24ae512ed9333f40e76f08a1cc72b99391b47c99207343a01fbaedfc3dd4b96275c60210391785b566708abb14bc7740a04536b51cc2f429796e196b5631efb8310b20d1335467d250ca700ee72de04de15b5f42dd07a3979258b07edf2f90200d7290d553ad70bc1fe5077581d403279d38e5144720baa2501ec3ec5312a160d5a33e0661b1d13c653b5a6200aa8a6b64fbeeb63c4820264db445901dd5510e9d383dce7249286e68749c395bf55b5cd15f962ac91659dd4c3eee5d6148b6da8832269921d796c95a3293776c49782e7bb8fdbc024a0dee81a55613313ed0045c9e32cff5f45e5aee9ffaeda7736ed46e60607ac38b7c7aa64edf2b08323d410ea30bf618dd901b1e49c4edf2e9d4648756c5223e67c763ed78e40d13cfda2572fbd5859540b6d1c95e5804f69e7bd9e80abe659a81fde62f1b90ff9cb3efd8e34ddc8a66401781cc37ad6060808c74fcea0bd4216439853a1f630f113d2bba3bc599ec606e38c0d24d738931e1b6d6fe0c0b300ebd706a197ad0c7bcc7ca8c2bdb7e3d392c61b952f5b0519f432f2c82ba8660dbc274171229b3f0a77f7762dbc5dfec923543f0fe0028d74bf5ef4eabdf4cc48f97326e8a963f2a42ba6ed75a16f6b5b57eb7582e4f220b85c51228f19492739a5aa48fcd09d6b77a3c91320eda845f797c9566a9c8d75c92e5afda9b05da647892f414701274a8b1090dab90132c008031dc93f652c022a908461a2f744b004e5845a2ec39fa0715444b60377aabdd218fe055ab7c8e068946cd08018435ed069130b8e91e632ff060411f15e166288deba6f8f336d987df297fd3aa61b2523b4c20be8dc1c1a19b2d002eeba1d95951749c5cb85ae0d3b725bdb26576bec9d948fe7816206ffdbbdb85359215b0f81eb3b451c5b4c0ba93c73844d6ec40f610899e0f92ee126747409a8ed61e1fe2f9cdf38aef3bffe7d6940b0755a0f02af9796157b3e93cb754c38c40a2af2dbcf2c56bc423cddc56113d6068069e7b3b6794d8fa858525f6d70c6f1f557e74aaa9e23321e95196400fc6c5aee12d88fb736dd5816f07ed7cf40ac3170abf87b8966599e7b6dfdb36c2387d9a67a4ef65158129aeb61ef43b33b30255e8cc4cfb581e86a7be1e122019c325c2aeca43ce2b38ac1612a03d8def347a87f38fd4f86d373583b759cd53dc5c40319ab4e7b11e5003ae06ff6f20a52e1ac94b0f026bad61021af3bb24879bb40aa9c4838757ea1c31c768d09f2edd2c3f5d98baaa5ea09b122820b24ac606baaaf94f98dcba7efba93e32fef6c133126e2742f2086c9bd570f3192f60342c814fafcc0d125e5a2c1182e65e12c05c44ab7a7a0f36971a3572008abeac08b83ec173ee91c1f055a2aad4237f92bccacb1ecff0c6a6eeabed861fc45e0b09127edf00ceb0e9073bbf39fbc65ee6bb50226143e002330f62bb063950669042d61d94f8cfb9b419567e53ebfd2a75d5e36ecb240cba74e7ecf1ca61bdb72053fa774bfdcd924d9c9e24153e8af29b6d35e9556710d0406d1ffb919e74cfbe9480eb718b7a0d706603d38fc9655d79777b8c25241b8f218d75dff4ab44a9d979e7e568b2292f6b78407ab92b16aad69b4600b15debada14936a677fab6f5aac72785cbb1dca472c5f0d30c5f7cdca8ec0c632fe047bb8f31464820b707244dd1dee76f283bdfe1f8aac8eaab58af6326dffa8a01312e448c18c42314cd22cb24f1dbf437a84ac2743af714d97d58f13ab9d4e9f293b716da4de1773b642b282c14cec98b6da0180fb1286a4e4cf0814e9f76be8bf032d916145915b9540454c158b917f3390478b552f1304da62b51edf8de599f0308f74a0c28dbfa4c43a115c5947f9c314e57e948d9f6a37c3f6e59b15ebfa1f9dc64d3020c09ba237a0bcdf2248d373f3e31a9ff08eaf86f18dd2f1c51b884f4a48c750aa98ecb0c1ee9381f11def8044501f385e9e2a0eff0fb30f1067f5897fb6f33632ecc21847c0388afbb4a3786587a9897f32d65707068621c969bd931ee1dcfdc2dbda58937cf0a9abacb9cce3774a9887b2c0f313c62b1013d247ac26da23646b3d803405c656a03ef667ef9c9641ce8ab48d04242ccc25d273b209fee2cb4b5b9364c836b290efb36bc7b4e1dc9905bf704900536d4a9307f6e4f6816078619380c82fca0d38aad0b2ce3da987f9824e7772062cc679f6e26c793e3300f94cf8386030c85b5666a85cf97095b42bd2253f3bf130deaf076068d14fec9aa9ebc657742d963056c53d327c62ba1fe6630363a43d1f4f79ab1e43d75e1b05430c5aa3342ffda15b53fcab36349e82a57a7680860530c819c7f1d8b22ff1135f6b054c6faf8e1a66a2eda4a52654d85067c75c51446a065d447150827e18d4f66aa705b9754556326b02514375a042dc4749a2b4649f605bd9b3ad64e6fb345e7a16b59934d6a3b624fec9151b9b7eeebd267aa7956ab73c24a4ab8503734a52195764648197956a9ff29a84086c7eb13a46909f8e70b129f5c994c87fae2beb1a86c9aa678652f00d5d7feba69ca11444be6ab2217e33f7ba32862025850e255c93136356ca6f419dad8dc85fefca8c5915e77e4d997a56288ad9d4f2872154a84064f37263814fd8023bfde72f5fee465eb1a8d45b4a08195714648876ad8f3ccd67fac88c7addef1ac3249f12a03950552742d3ac2b32306470c6361fa93e92d7e65f880e46dacfd5e2bf82549eac22045285d0e96e99d561c1df573dd91921f1a9ac7baa05df188559e9ef07570ef5572800b4995de6c349e2797a157d1274b6923425c58da5cbc51431d25f4f92ccbb270f1bb8a30bf01200700eecdc69e3fde627f244912324bf99109ed1af5bdf56cb1c3b32b32b5cb343b62fd0a6d78d55e54cadd5951fba5cb512004812a914fee1965c9c73ce324f74a175363a542e29e629d3b1933972520300608f30f1ae6b649fc8418f2cbefdac734a711e5edd465366e035c9e062983fdd99707c60f22f6185ccee8243b3a68d0330082078a1f29e8a3248f3b23592e1377259f1a13ad1ba60255f2f8cb0453d68fe7cc71158ad6fe55c77728b8b504146ba2c3ba6a28e4abedcfd4af0ba1c3949d10c247c333447bd27841931253e195d8f53b3a58bb41601874a219b317628fd4515c100f26a420a6c1784301221938b444593322bc0e52bf2a1ee76df72fab2bcc4f8084efecfdc6cbedeee2e2fbc7724e23060ed3f6383037f0d4722a5f91b4915a206de2c9c414b7b2a1084e3904f5b85cea551c3dd3b9a1d0a9fe441cf234d837f9a8daa31ec036fe03dc8390241c1b19802f577b403c92e85f56b110aeb176a52d834890653146c08facbaa0aa1bd8ab7d10c0ac90d0246b9e2f5d64b3c20002a74178a3fc4f0780edea943316f6840e6f5803c54ae0afe7266abe944037a62853affb509c6899c2b86301df6ca3436fec1bb28a5470195f5485e635c5e14b490ffe6a51fb872701600d804eac84476a4989b981d0dc05c80fbdd732f43317965c9f575e50fc3e76035c6a48ced51b48f18545b5c1eb225e71be640ebb518b4cdd86dc6f3c599384d6c8ab6e3c7a8e4fd76af9b21e8899712432258e2afc29bc44ab50008f0b501a825883c10a5854df6bf01ec464254a5106a859db1286da3e121aa5ca9b96bae723933b5f741afce727f5dde927ace041d3fb24cd0a7b0b0d53a2cd1fcc66d39f552f14d337123607a3a88d6896a4afb5c36d5841fe4dd4657b8fab15b0d7f72f0dbcf52cfa316088f405259390c81fda663d314f98dcc3cca1910f57c5ef96bf1390c50362a9d2531fa0cb20cfdc4978dcc1a6c69209c69cfdc1d2e8aa1b854ebc2c677ffccbd568df685191be4a6ac53e02d2e68c067cf227f38a0d46c4cb877bf340f5f867dde6e0b440ba7e1b24b125eb03b1ea9f630df3886f07d792c476a07dc29cc5566a32171ddc6f5130ce1f0d43e5f27ab7b65e55b4af879525d4eea62f76b373152e13bfe2f923a1ba6677116308cd175647246d895f7d04a58f20b1eada6e5513e44fe6d280be46f29c54991f6d046c1e08f1523c3f8f7df3f9da1bcff2944fc7ead97e66249e0ec288eb91960a0a0e0cc21742917194c83fc7077665f8861e66995e1bef94b4015e6649b222a36dfbe8b51f590ef426ce14cb6acce81a8aa1b3b0122a3d363c9687737ca418398d1b521faaff8e63622d7df85ecb7b513fb71810c807578b6b263ddf21355fcedd08ac5ee1a7aafbd1257cf79573dbd516bdf639e274a401cc3dd22258d9adb9e0d171430021ab3d33f4122a82d77274407b5d5b6d454d197cba5ba8cd1da6c6cb720112617d8e14b252e1469680dfb9215788a65562f7f7e2ce0c8547b2247900a2e4f684a7ca4170b213913fadf07013874970c461c4bf2e95f74b7d655d3112534eddabe23a1466277c7b332447c5da04560b546bae1b754b7043d1c5f58db03a6078a71ced1489717ed519f6bb8fd3295706f6eb352fdfb8c403a283b87d28fa22dda878184ad196e1006fb8ea02a49cb81de68b5e6ee5941b5306785326106e02dc15ee449d7cb6eb981b37bb5a7d91455341360ba00fb4c16a067e7cfab7c34ee9ba841fae7f008b075968c6d50623b4773adfbc778269646008dd9f1aa059697f659aa1f43d87e6f127543aeca3b037d2bfd26f2b8c66427b7bf9e2205886fbc78c0f0fca3e7c1088a46eaa5397dd203c89d58debe71c34bd85d31ebefcd82946538766d5833056343e3550fde57ba9b54b4334ad29c8341340135e2307d9be1807bec0633fffa14a64526473e021e1d26f98d1fa6b6354f7bf7ef7869d04f025ee570a813680cf3655981ebbd6efd0616158cd8e56ebcecf44cca6e9a914ce050f2570886087f7bec2f3ae364a9fee2553cdf74b8e952c22408d5a1622dee342003a50b29499d6b00fc2617c85a3abe15f6e89315d9a465f2398e9c3098ecbcea1dba745fa3a14e3a2a00f5568fc015b04c534f008faa680a3d8c416df30d087f966d21cb4a18c5ffcb1d5b63344efc2b2fb9ab2bac55ab12f32b41e28be0db6ccf8763c930b7bb67472cf44dcd36e7b7696924b5d06bbd46b0b157c4928fea9f3d94c9cc347186d2c58198aea8b4decc80ef07337a9a55a9f925b6e7863086ab41fd3f8058f0346e9b97a2013918c4ea14ef8134ed7139945093dab29eafaa88f004a0d21d2407c7fbecadf1067dd3f2c3cf0ef91c5c2f9bc956b6c21699ae25d9baeb24bf53bb697b24a35989659e06ce83664c2fc2c682a250d7d91e9cd515252f46e5403c3ba56e27cfa86367f9d649c9684b7bd98125ca494b71914f4ea1d53fc24f93e14890fab059a8934a46b5011f10030c790b51de6240a62cc60e701c7d01f09c5e8310c55385a6b3f1aac85190c271aae89a7927e9157a5566be404154cfac66bb35beb926d698432694894328a2f983f049c2520c9d6af1fcd569d7a773ffc577d13c25f3b4470d1a63bea552a70db47cec66fe8d89c9a9fd9d568312756da16b84abcf5701f94156445ae2b61eb2aab571d8d6e3a42ca53e03a14701a9918846e3f24e39b6c5776ee082a44cc062ca7158450892d48b1962801b7e1d067b368010d629645e1e0ad709401dee5e00edd22b312c570803908ba420b7ad8c3db6e77363c93e2888ce1efd8d2a8d4710ed9801057cbcc52ac4bb988dab3ba75bc6a9355eb64eb9a7ab7b621dc4317904cbf572919fe809993d7715ff82513d8fd0a0d68c3d4cb906bd8fab7e5654732445207f703ba9e53bf46d0e2bf827350f281a28c09ee675fc8fe4ae913849cc350ee415ce080486dcfa78270d31f7096c780bc6e6df54c1c21772cb5713e83bef4d3482d457eb7f5adbed4627324c43a701f55d2b2034caf1bde6124fc9afff5f4fc5921d6f8422e103b9fc8fa787df1d442037b9f802ea643db5e20ec2de7addbdd4fcfa829f6b310dd531a21e41d158f8d1f2a70697aab846e124664322448af32f39f57f8f13917468cbaf1ecdfc79a9607ad8a21546bae2b9980ccd5c24e0f774f60eaf80a1f632c420ae2d2a01a63ffbd5179fe9d42d21705d6753ec866c1cbf27adafa9a5e427247366a7e5f3cd7597eb8399378fbba900322a83664a82c4d3a96f7f864334643a66308bd508ea87acf3167a6d21a8388a2e9aef37891df8018af2fbdaa3cb26c4fc673c5ded09ad55d136594a6406a637d44486a170d5918706b560efe6dc5918aa4157bcde2d5540460b8f1698065df0ac572376e41e15d555898769ebd39a923d9b5d6d3905645a17a364e37c93aeb3125269515b54fee1b27d982d9f8f068612b64d498e04a563adc1edd833877727bda2ff9370a7f0728384578547abb81e2e92b06737b4ccd27fc054bd492b69591b86e8c1f934251473d6d2b8f2af0138cdbc16649b394b10b1259a84a0c64098b7de828855495761c965d187fa521eeda9bb2cf01477e48f048b13d7c07147c148bbf04db2a618bfa56eb6a6a4f454e49f199f877e799e990afe4a22b85f9b6035e35a27adc6ffdcecbc132d8598f5d7811695fb57873f781dd4c62af1b9f8e43f519f8657739ed071890975d103bb993b7032bd45d5b83d039a6ff718e043335eda633d06a6c8afc8a1d9777c1035df949e264c00be0ee6cb028566e135cb43ba2806ff86564e5b4c681120ce58ecfb689791e6397945487be6a698440bd8a41f4ed82bb919d2448a9174188e86433cb392d5fe3621c611467b8ea792be779911f2b7b670361179ca9e3c620f2326c31bef6064dea1fe298818a8f21fa41338883dc5672078a8ee42ca16da11b8d3bba37c0f36693076b4a9ce9dee6ed2a5e880daca63355963faad4d2beaa76de60ba3078cefe1f931495913028832008c6898ad86bed4c2ad5cda75f0956c39b3f7bab25bac24f4f05bcb5944c3fa31c89138c93d7d4c3bf683af3dd4214be9f1e4ade071e463253924b667836645da52996cc050cdf03a8e097b12dc12e00a2c6874c665e05465d1c23929f6fb4d6cf3a7bd130c54cb8be1cbdff05bfcdb178f56464da19f0e7ff630c0d797ec937a5c14f9b0210feb5411e536d7220c384856bd72af5e6dde85064ca59cd362e960c654fb66a9d94412c3bc7cf1db1845ba6ed15e71b6b28c295f21fa437de6a09aed28945e443062c798caeb321b7895c1bf3a642bd46e725759e73a0d51a1fc25a4a1c4777178ccac96d93b4008a7600e3b7af7453243db7edf194f849257f3b9f48d93aa6146e7fc2df0a96161c3862ec9dea5018348cabb4ad1d15934f7339e4b54765b07dd0ef03b16d5f2da556d0449139d4ddfa3817579e526f08aa7e579c005787ddbedd2df2974f06e7b2e3e8a9103a8ef9e1e447d57dd341e7961a7c3cf29f44b490da9d12e5f7fdeea57b629a5664a3bae3917564311de7ee03f894b773d5bbae33ffa5146100195acf0b2638ea33324c760e8982c0d06e5b7f6032b3c481444d181730c770028e45d4280b8ad3ddbcc65f4aba5cb82130d8a738f3a1f060bba387498dc484776fe69f14dd83153ebe0c1cd3b3c713ecb53b5033b385545172140207672233b74680fff327690458849df4478269c423b10ca4f12ebf040c38bec36e9ff7d102f925da9e09a0aa5bd687edb4ea1a57ddfff030accd2078f7a66f29845f51599bd4790bee5febb6e7ba08a66be9b0c60035ea63afc6e7d5a7246d22901565e7067317044fe5b2f43dcecf7b97f981229920375ed0e4012a65130d7d7430ccec9c797ce5f95c2b65dcda24edfb7af9798536e82f2b27001b9b6d6319b820b6fb2c81574cdf7244dfad2ab8546554b34e216d5cad23acf2f23ddb84eccc599e1a506b398552bb160085e7ede9f1bee2caadb5bbaff03aef1936dc8cc7090ffe2c2db426c19089c0b6a70a359d169642a9a0184ebe5a83f7c0cadf31d760886231d7ca28d410eb0e4b49741e92e9436944fe8a3a64743464f0254d62c36742273937f5236939b2b85fdcaaeb1aa9962c2c379ca11e64785195cb71cf9aa8c30cb61790d68f995c1729f1d5b048b748292bc94afd54abb955246140a9ea18151a9c2d8172513581e60d2c21b126ed494def51135514c0ae29945f749cb6c9a80a63acd1a365fe721c27226bc1af1f0ccbf5f082c43c4d1b2270a2a43f8d4af4d7d70d9e0f060c75cc671c55900c5cea8255db6c35555c4d5890c749c8cc79830db0e50ce76eb94118c315dd62143518f0b565dcf04574c08675e2e5e74a544d200b18e933b8177b5086162054dda5ba294b06dbd51e1fb703aacd65e37276444aaa7436df50973dc0a988a4567c2f49ddb377ce8d6f5e6df4b61402c2631cff08b46b07e12d7575e83d70f1765878b6cfbaef320e6fd8c073ffaae3f0d13aee06c8fc54e17d7ba1d2c15a83b380e1efc30aeebaa782fc60cfb74ce3c74e2a6888192557ca1eb580df078f690d7aad445bcd2a3db7981413ac531ada481f74a54f7e2b2a746b25c497af96c792da681507a5b9e9452731c37a1e321068660993243a9941ae4a238d7228eb8da45322958edfc6cd16c84ab0adc906f6d9bd9e72ce97f6cf2815c246de82682bc2f3c38220410b94407a6816e0f635758be30f3f82962fac0e0248a5f0ccfed3c75c2ea02e30cfeadec50dd77b19f9476b3c6567f311d13700107d5850106a215d516cbebaf42f3118db42a2fa4f5cda727b9d8ca4cbeba189a55165539ce0b32d43745c576f104020ea1522f09c8107b34834e99ce0fdca99b7526218ecde4739ba5e7fe7c67db2891496dcfb9e5957a42c6ae8abd31a81aeaff0d47a747ce07fc3bd528790f79ba1914eb3368fcdf6db5f2c9cc520d954f8a801a7b8e9d4804d217d65b954467df659ef2e037b7f552328ea34e74f77dca602e4c3cacc1b6b046eb609654557ff3c8ce0b7aa1a0d0165ee7c306ed4a32f6b9fb66dfecda93acae0faeae491289640eb8c66673ecf283e1d10015b3dd2fd1e63d9a791391227f4713b6db0e247a223c3be57e0d4053c688b0621ae2e5162b0f9cd10d7869121fe5d6f8cb809cd27c199adf16a0edce181a1575965798345194c662400db4da613cd5121406c6237d006e6e0c96b89b86363eefa64dac86a6464cbd16f96666d9e958b99ec14ee82286ebaab4fabbd4a6419c58c8578a47c20f26d0290d7fc35b97c7e3c6d8fa7b722e7b6800a6cddf848f8a935d2ce06eabffcbbb612a436837390c5f5334b0af43172090f0b13f59d926c133a1371c6f43952c17b76a6de2999a92c8e85c757a4e3c9b34179640bd1f99540df0ae02f1c7ec183c25e0672b9d5555a99ff4e0affaf30342b0edd4751c1146400f4246353371e5a97dc3f4956b87a6dbc68bbf618d57f1d39a612e8ee6fd2558aa126aad69c243ccd2149a57a4bd80450be451667aabfab792b896da48c69129957ca272a3c5ae6ad673b3478f156fc8b3d2c931fb3c2cb2a594fd5bcdb3aff3b59957d421e1dfb3a3ef0b05f502afce53889847f6a855f169eeab0211c0289757bdcce7671104d51b22f8f7b2c5292956f464e29cee44e27bf8b5486fa1e1e56c0d180b9c18598a9273f503eea8d14330ef1032f1f776ff9765f22c24ea078771ceb9cee5cf8d461bc4387aed1bd89cb31bed03ec6980aaac3f453674ea5d0c1a14ab55054f29faf73adf83d9d99c23b6874780ed71e60c642c545ceb888681c80dbe948137beef920b33b551364206c4e97ac08f105035382b99790adf20259abb78ad7c483ffb30cad595d62fe0f60372e494cbb61923a0b9e69f7e4ef9a0a1bec6cf13fc243c4d408e3de40656c01fb29fc07b559f9dea1ad3e3ce2480ab8895f7f56f6494e7ba312ed47b85ed52d1e214ecbdfa3470f937035f10602275da616b0fc1af423cc214a22cd583183a7bcea5a3a349f31fa71b62938c72fb9974b16ae84d7bee04c053f8e18968091cc46eceba11cd2f6f11b848570b1e10f8b9283b466a4db0840497e4ffa56eda6582cf635db40d8a85ce7eba391e2369c3315755c9b5b1cfc4dbd492cbe3748d3832895482701b6a49fd02390d6cd5637043e7898215fe25b352e8c3b3cf8875fa4eced93005e90888967068f0ae4463aea5657d22e43eb7fee4ff19a3a0282138997e3153d82b53285e018f9a6dd5a8bf20f65d697cd1fea883e25cd0eabcc7199cb902d0ed6305da400b1c6cecf50c9990d0dbaad7d82e90a2411264ebb500bfbcb4bf228e742c16016e82c59468858d75d762f682d993fb7c3abe93904858342054d191a32ca0efff20225f9b1c69a51ca3b851c388fd9bed1d6fd8a306bc57f8043d8d297475a7928186690a3961ac19ea96a5b8c9f62c4dbd54ee72da6bc9e3ae969a307923c15df75c29323fef33d99ab34e007681ae68be3b5fa981d319b0f08c157feddcf61a226ae7c7e67ba2120719731b7f7ba2a24c88b8a18a5598b0a8ad5634f6922f37c43ce75555520e3d0d368e18ec40811dbdfc21bba1a36c8a78c2b89b9657740a6e6ba2b77fd24e6d4aab6d8d12aec1e372a59b9c60a4bdd1933a4c7b53a00fb75f69acc97af2adff99fa6d3befb98be8e4287136b7f3d9fbe4ca1a0cb5e5735f46fcc7169bf86ce410c6507f3403e161132ae7119a7c2bf8d016d6e599cd32d7eb002a325f80fca38bf868f631ca7f9f11463e89e8c041dc27c2551b24e5f8408d63fd7edc2e09ef8c81196e22d1e4e3d504722172ab9809faad5b2de7fea33e21fcfc674b47bddbcae451047d98d3ab48d94e4bf269dbc90ec375e59ab5c158fa22d6db3f1e4333ea1a3c032b6712ce78a17ef20f87b0f49c2dc7933f7c6efbd22423ce0ad6373e4948bd1128b37804b45dafeaa957b9a7dac0ec2308710de80288778ed02a4cb8f6d14c302ed3eeefb5bfc39084455c9041b2cf0db430ec8bcba36c76f03482c21d22cb362854d833f2d6aafe0a298bfbf99090d66d019d70075a2b5f21f73b17308d59ebb376c1316029efd1df24b1f620b6123046ae6a18bdaa86829dfb49f5dcce10a9e102f6da9f71e3370e821912dd6f81c41343d968a165d7ffdaa354c628d736e0facc631762c51f8b2208752ffe97c01a733246194bb9e8e083077b210831191a8f965f8a09abb303d5fe5ece1cda73ea055c44d50d00bfb3fde7cb4bdefdd8d1d521afbb7a5c49914492e37027cad97427457a35fe352db00b7195905b999b7647faca1619e29f97afde043eaceb209c76a80ca33db231078987e41e73d35515ef8a786d28afc5af4e3ee98359cd4e4233beb6604052a4e70a2dc77365c558e35f75c4ce26e4bf97db2b5f951529c3b5eadfdf99151f69336a51bdf734f83ae01dc4d86a595c59be5a281f1b80f173ae49b3af735a3eb8bb17f38a560bdd3bb35805c38bae8570031a40bd480c65a5df9d855bed8a2ccabadcde43403b39c1609ec60304830d21b6247ff4753d3a77d1019826a019679394e18317dd8b0327d7cefa630015c048ac2a1aca1773218fca933a2e1ee2bfb3bec97d2549821c63434f49248864ba6c18efc3dd53738cf1e1acb97d28f6018f0ba2994061423ca71bacc8f929a390d9cc6f524ee0bcd2df0d6e6daf7bd3d571b72cd039e9db61ba04d63d11c52bbf83c99fa99c8a146496a63313c26309bcb9b778c846eb68ae41b631eca578afcd438d21b79938991acae34dd4e493d2b09c46827ee8e0b85017502e87d718f9de60097503e32a4a4776a34f6cb99135b8e9d4565a5b5dbd14f10a3cd17a5005af0641ee070a80449f7f3d5618a9025664c59e399745bd000699a3aaec0df82ba7d069c4fbaf45d5781d569d21f31d03b5c5cf417cef0b3029338b57c958e1d2f2e1ac13559b3058571e08f80f34b5bff1f5c9dc1daedac0532404f6781a8aac5943abb06255981b2d055849a246dccecdd6081a33eb7f7eadfdb3732a1ca2063f535c6977be9a9ef7dc2033acff9c11085a40e2266239c302c38074a7fea948aefed50712ad4977cf65670944a6d61ec94e5293a626bd60e0378241188fff8046f3186bbda90ea992b6fa68d55ca07c5615d89a7c0c6ffb70c253a8830a90c23dcc6f4c6a22dc2049c349ea45e10c65906fd992debf39d6ded246ffc4b11b8e21639f557def79fd43cf5bbc035388a6ba453271d0d830aabf49c28d526d2b7a2e8d8047d3bbeb8270140fffa7e851b0fa1c97459bb8340295304d796c7aa88222a9760bb991e79bc8ac2e7da46358133b3a427f16bc9d157ea24d9cb45041b14dc041dfd9e8fd4637aff89e90733845ee0f2e1f8f776555d637e86c000ce7dc8a58313873e8a2d966abe52952ef2bf5e848dbe89ca8fec42f86ebd00df52ff6ff0a39e9dbb1a4894510d6a5b86d9506fda51fda79c05e791fb8707367819cc6e24580d1ea636653a766b8078a4210c694da1e74f879b3362cff8880c5de6eb921256a4b59682e6af3d7c57006a4140c3578eb1a3bd26cc4dafdb232211eb16a3b83ad93002e00a2a70b96779e09592cd6ed8ceec45eecccd1726129142045e1cec93345b68e538a9ef892f7afe9c878100ec752b3bc9849796df24efc47cb7cae4129cea550aa3e9e9607ce3eeb54c852244bbc9d96eeaeb8778eb10fb7567829ffcc5f3c7e8b0f5143f180559bf46f34c9c7ac2798322217ef88890708dcceb5163f344054b80703c015955334474c3baa81f3b46ede8871954730efda3ac424cb36ce5c988a96e54126c9e84bc9986bf7e3fc8dabdce008f356bebb71a7a09a34d0f4f58d2d91261842966d8b09dcf11e9c649c07353380882ea4a35002eb12303002ceaba44582a334027c91fddfc5b09c551ffc82a2520e38e449dfc09e18a3d41623108a53fbabc4003ac37d56acb3e0264c050306ac7a7f92491d5df0a1b91186ee039327772e4fb830871a1d2c94d4ad119a85d51e464010b34b3d686241eaebf8e99c8ca48cc212d84ce3b31fd8fd58dbdcaf14e80c0fadb262777d084f209d37ff04be1f6cdbcb2df657fbe044fa6ad3b3394b07d46661d51055c97a3b60a0b65a44d4e54d8d9d472e0a90be66a1324dac7bfcbff3d379386d14f4d3e64feeb965a65d6941d942efdfa9b3f22c3c8629b982a1927fe2344d121be4164e7098fe4600c33b3c35afdce240069a2488ef43618c2408c0e3d9235b641355d2ce8d3d35e50a63042e1317714fe0c1b2ebae11590f95b572ce3aeb19b08f4f1ca17f1e0944b6a6a97b826a75492c088bea34afcfdf346c8fee65b81f298f7d7acdd8f21402b162e0a58ffd3c1b1de94f4cc9c48ef05f690a0b3e67a482efc1e7b6cb80ebf9b389b1814fe636d33309277571cf22591670c5e96ffd1dc9bdaa11858adb939afc82fa18dbf5947a3123b260e723a1fcd42817d78bf7a328bfdc8adf8fd55ac144698fef55a6c3df3e4ba281f989030f0f1a5e582c579b86f91f8b60527825427ebe9b994557fb382682a3dea3a9371bc19691242e43408f9a01ae6cecf748c87f803c931d3ff6076cec28e111d154008d131d36140f9670b585999b5820b8f82e40cf603bfeaf2a78e23c8ef6d2d2248a2c420be841f41ec6b689af6a9d3e8cfe2853b7ba2b45f1030bfa5a0ee2d3d9ddaf6b75412ba5bcd28872d8542e44f3b1d74b3fe41827fe5a87cc79c0b559fa50211a89b14e6b4d4d513fcbf3074cffa694e856802e2ca80bb8e613c3e683ecf81764ee645a4339c813147d4c7d246b6d63089d1e275335df106a672b42428d67e18da6d15b697dc3748a0ed3d4f0b2ee0b972da2b74e33cea775bfa3306b12fc98d784f5e3a499d8d49a56206cceb9aae91c3cde079bc750bcd9f9d1b6ae5359a4d333a3678f246780b7ce283ed7d3d3569d08f9071ea1d30cdee8b3faf5bdbbb680e995668d24070ae57b564e5056339ddf9ac96f02c84958aecbaf55917a822f3d212972c7a9904428cfe4f0715c995238e6f72b4ce3de2f52d34486a1e128f3351a5180c3c7bed65fc33af59c965c0bd292bedb1ff1903670bdaf992beca0994c8688b20668edc0080a37c8e3ea93e43724ff7d2ab9e3b58b985ff31006c2deae642fe010c25a8c8dfb867fab37d15161a595b569e33c6d4ac13574948850373efecbc177d61ef27e684faae8824224028928afa25efbab57c8f560a7b4fa43a268713467f678c9b7fd29fac0b5c98a23d9a70d0163294bd6883c3dda45de727ed280a15d57e3f4d9e1c153a61de095ca6a7f6b2195746e27d856a1d9d6aaf594452225b212532e3ca9de9b60ae29ef49f42aa9c4374498e970b0eb27d1f1d04f4e05ff1341efe28402853ce408f1d860a736f5f51f98082376d8bc5e07a5cdd7160f358792b42338d16802b72c2244118e4a6b2cc143fe79c7975e154a147f0f7b3a23a8edf6ced107ab4976d93a767c5f39cf77eef90f30645da64ec5c2dd7f4282fe5196c6f699cca9a1e73a11775b16b054918882cd2d9d9d4953a17096b2b2d91f86cd5bc8d190092bcf4d0c79f8f79ee922b390c9b1bed05e663cf9ae3b7d8858e306ce2a632537386abbd605707e999d62dfb4696d4b99d2d921e4e0ef0beb51da1f550b46ec8f82f5bdcbff1262b41ab2b0ff875f87c4fca87d66d89e464a004e06fb08573be10bd7b535e6c0c730e3148d06b15fd8bc070d380f734048a281f993e06d52067b3e8a30801c3ac0fc0bf184d4984a7acb4118a7c9420a8b1384173cd4d0c0ce7658b81f4837b3ce4f65ef2170d208f1a2b40b514d4d776d177ddb7a0874aa5599983560b74d096a1f797ebca8d5ae1abeb96e075dd0733a2a25244bd06be06d85e5f7b84f9c457d467ab1b82840524e181efca06fa5e68522bb2149418f007578461cad7d23dd02f61f0165f23a061fdb3530fd77ae93ffed6674864b3d04cdc01a72b4eb78639e6a66d35581a6ec7984e33a4e982ab0545f71ef1d06aaa93e7c5702516a66ecd003e2e8fcc47bc0559a951542b3fed23d6b8e683896070184e5c7e8cae91ccc562e8126609f2874c33d24380c2a6c949df8ddd510995ebda028712a89ede1508a85cb44e9e66bec2d4d0bf662e9098887832765f17605ebb604e535d91f0617482e065b75f4e57493a66f42ce59663b7b374e90bf11ad80d58fb53bfee57287ab1636782297afefba329814af419dd5015df87fea9391171db2cfe67cc9f2dcd3431591bfc9c5511ee18582ef82ade9f76ea7bdfad240</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请联系微信：codewj，获取本文密码</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> objection </tag>
            
            <tag> kali </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>加壳与脱壳之基本原理</title>
      <link href="2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
      <url>2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="逆向基本流程"><a href="#逆向基本流程" class="headerlink" title="逆向基本流程"></a>逆向基本流程</h1><ol><li>使用自动化检测工具检测apk是否加壳，或者借助一些反编译工具依靠经验推断是否加壳</li></ol><p>GDA3.85 或者 常见so文件</p><table><thead><tr><th>《娜迦》企业版本加固</th><th>libedog.so</th></tr></thead><tbody><tr><td>《娜迦》免费版本加固</td><td>libddog.so</td></tr><tr><td>《梆梆》企业版本加固</td><td>libDexHelper.so</td></tr><tr><td>《梆梆》免费版本加固</td><td>libsecexe.so</td></tr><tr><td>《爱加密》企业版本加固</td><td>ijiami.ajm</td></tr><tr><td>《爱加密》免费版本加固</td><td>libexec.so</td></tr><tr><td>《通付盾》加固</td><td>libegis.so</td></tr><tr><td>《360》加固</td><td>libprotectClass.so，libjiagu.so</td></tr><tr><td>《百度》加固</td><td>libbaiduprotect.so</td></tr><tr><td>《阿里》加固</td><td>libmobisec.so</td></tr><tr><td>《腾讯》加固</td><td>libtup.so</td></tr><tr><td>《盛大》加固</td><td>libapssec.so</td></tr><tr><td>《瑞星》加固</td><td>librsprotect.so</td></tr><tr><td>《网秦》加固</td><td>nqdata</td></tr><tr><td>《国信灵通》加固</td><td>libnqshield.so</td></tr><tr><td>《apkprotect》加固</td><td>apkprotect</td></tr><tr><td>《几维安全》加固</td><td>libkwscmm.so，libkwscr.so，libkwslinker.so</td></tr><tr><td>《UU安全》加固</td><td>libuusafe.jar.so，libuusafe.so，libuusafeempty.so</td></tr><tr><td>几维安全</td><td>lib/armeabi-v7a/libkwscmm.so，lib/armeabi-v7a/libkwscr.so，lib/armeabi-v7a/libkwslinker.so</td></tr><tr><td>UU安全</td><td>assets/libuusafe.jar.so，assets/libuusafe.so，lib/armeabi/libuusafeempty.so</td></tr></tbody></table><ol start="2"><li><p>如果apk加壳，则需要首先对apk进行脱壳</p></li><li><p>使用jeb，jadx，apktool等反编译工具对apk进行反编译</p><blockquote><p>如果反编译工具打不开，使用010Editor把文件魔术字修复前8个字节</p><p>64 65 78 0A 30 33 35 00    dex.035.     再使用jadx反编译</p><p>grep -ril “MainAcitvity” ./*.txt 找到对应dex前缀名</p></blockquote></li><li><p>先依据静态分析中得到的关键字字符串，关键api调用等方法快速定位需要分析的关键函数和流程</p></li><li><p>如果依据简单的字符串，关键api无法快速定位，则apk可能使用了字符串加密，反射调用等手段，此时可以结合hook，动态调试等</p></li><li><p>定位到关键函数后，再根据是java实现还是jni实现进一步分析</p></li></ol><h1 id="类加载基本原理"><a href="#类加载基本原理" class="headerlink" title="类加载基本原理"></a>类加载基本原理</h1><h2 id="JVM类加载器"><a href="#JVM类加载器" class="headerlink" title="JVM类加载器"></a>JVM类加载器</h2><ol><li><p>Bootstrap ClassLoader（引导类加载器）</p><blockquote><p>C/C++代码实现的加载器,用于加载指定的JDK的核心类库,比如java. lang、java.utI等这些系统类。Java虚拟机的启动就是通过 Bootstrap,该 Classloader在java里无法获取,负责加载/lib下的类。</p></blockquote></li><li><p>Extensions Classloader(拓展类加载器)</p><blockquote><p>Java中的实现类为 Extclassloader,提供了除了系统类之外的额外功能,可以在java里获取,负责加载/lib/ext下的类</p></blockquote></li><li><p>Application ClassLoader(应用程序类加载器)</p><blockquote><p>Java中的实现类为 AppClassLoader,是与我们接触对多的类加载器,开发人员写的代码默认就是由它来加载, ClassLoader.getSystemClassLoader返回的就是它。</p></blockquote></li></ol><p>可以自定义类加载器，只需要通过java.lang.ClassLoader来实现自己的类加载器。</p><p>加载顺序：Bootstrap ClassLoader-&gt;Extensions Classloader-&gt;Application ClassLoader</p><p><strong>双亲委派</strong></p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/类加载器.png" alt="类加载流程" style="zoom:80%;"><p>如果一个类加载器收到了类加载请求,它并不会自己先去加载,而是把这个请求委托给父类的加载器去执行,如果父类加载器还存在其父类加载器,则进一步向上委托,依次递归,请求最终将到达顶层的启动类加载器,如果父类加载器可以完成类加载任务,就成功返回,倘若父类加载器无法完成此加载任务,子加载器才会尝试自己去加载。</p><p>1)避免重复加载,如果已经加载过一次class,可以直接读取已经加载的class</p><p>2)更加安全,无法自定义类来替代系统的类,可以防止核心API库被随意篡改</p><h2 id="Android类加载器"><a href="#Android类加载器" class="headerlink" title="Android类加载器"></a>Android类加载器</h2><p><strong>加载时机</strong>：</p><ul><li>隐式加载：创建类的实例，访问类的静态变量，或者为静态变量赋值，调用类的静态方法，使用反射方式来强制创建某个类或接口对应的java.lang.Class对象，初始化某个类的子类</li><li>显式加载：使用LoadClass()加载，使用forName()加载</li></ul><p><strong>加载过程</strong>：</p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/类加载过程.png" alt="类加载过程" style="zoom:50%;"><ol><li>装载：查找和导入Class文件</li><li>链接：其中解析步骤是可以选择的<br>（a）检查：检查载入的class文件数据的正确性<br>（b）准备：给类的静态变量分配存储空间<br>（c）解析：将符号引用转成直接引用</li><li>初始化：即调用&lt;clinit&gt;函数，对静态变量，静态代码块执行初始化工作</li></ol><p><strong>ClassLoader继承关系</strong></p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/classloader继承关系.png" alt="classloader继承关系" style="zoom: 67%;"><p><strong>ClassLoader</strong>:抽象类；<br><strong>BootClassLoader</strong>:预加载常用类，单例模式。与Java中的BootClassLoader不同，它并不是由C/C++代码实现，而是由Java实现的；<br><strong>BaseDexClassLoader</strong>是PathClassLoader、DexClassLoader、InMemoryDexClassLoader的父类，类加载的主要逻辑都是在BaseDexClassLoader完成的。<br><strong>SecureClassLoader</strong>继承了抽象类ClassLoader，拓展了ClassLoader类加入了权限方面的功能，加强了安全性，其子类URLClassLoader是用URL路径从jar文件中加载类和资源。<br>其中重点关注的是<strong>PathClassLoader</strong>和<strong>DexClassLoader</strong>。<br><strong>PathClassLoader是Android默认使用的类加载器，一个apk中的Activity等类便是在其中加载。</strong><br><strong>DexClassLoader可以加载任意目录下的dex/jar/apk/zip文件，比PathClassLoader更灵活，是实现插件化、热修复以及dex加壳的重点。</strong></p><blockquote><p>DexClassLoader方法参数</p><p>dexPath:目标所在的apk或者jar文件的路径，装载器将从路径中寻找指定的目标类。<br>dexOutputDir:由于dex 文件在APK或者 jar文件中，所以在装载前面前先要从里面解压出dex文件，这个路径就是dex文件存放的路径，在 android系统中，一个应用程序对应一个linux用户id ,应用程序只对自己的数据目录有写的权限，所以我们存放在这个路径中。<br>libPath :目标类中使用的C/C++库。<br>parent：该装载器的父装载器，一般为当前执行类的装载器。</p></blockquote><p>Android8.0新引入InMemoryDexClassLoader，用于直接从内存中加载dex。</p><p><a href="http://androidxref.com/8.0.0_r4/" target="_blank" rel="noopener">http://androidxref.com/8.0.0_r4/</a> 搜索位于libcore中的Definition的DexClassLoader 、PathClassLoader、 InmemoryDexClassLoader查看源码。</p><h3 id="ClassLoaderTest"><a href="#ClassLoaderTest" class="headerlink" title="ClassLoaderTest"></a>ClassLoaderTest</h3><p>新建项目ClassLoaderTest验证类加载器的加载顺序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        testClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  I/kanxue: thisClassLoader:dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.onejane.classloadertest-8BzVJE0RmCd4VMY0V2ZBAQ==/base.apk"],nativeLibraryDirectories=[/data/app/com.onejane.classloadertest-8BzVJE0RmCd4VMY0V2ZBAQ==/lib/x86, /system/lib, /system/product/lib]]]</span></span><br><span class="line"><span class="comment">     *  I/kanxue: this:dalvik.system.PathClassLoader[DexPathList[[zip file "/data/app/com.onejane.classloadertest-8BzVJE0RmCd4VMY0V2ZBAQ==/base.apk"],nativeLibraryDirectories=[/data/app/com.onejane.classloadertest-8BzVJE0RmCd4VMY0V2ZBAQ==/lib/x86, /system/lib, /system/product/lib]]]===java.lang.BootClassLoader@232d58a</span></span><br><span class="line"><span class="comment">     *  I/kanxue: root:java.lang.BootClassLoader@232d58a</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClassLoader</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ClassLoader thisClassLoader=MainActivity<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,<span class="string">"thisClassLoader:"</span>+thisClassLoader);</span><br><span class="line">        ClassLoader tmpClassLoader = <span class="keyword">null</span>;</span><br><span class="line">        ClassLoader parentClassLoader=thisClassLoader.getParent();</span><br><span class="line">        <span class="keyword">while</span> (parentClassLoader!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            Log.i(<span class="string">"kanxue"</span>,<span class="string">"this:"</span>+thisClassLoader+<span class="string">"==="</span>+parentClassLoader);</span><br><span class="line">            tmpClassLoader=parentClassLoader.getParent();</span><br><span class="line">            thisClassLoader=parentClassLoader;</span><br><span class="line">            parentClassLoader=tmpClassLoader;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,<span class="string">"root:"</span>+thisClassLoader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LoadDex"><a href="#LoadDex" class="headerlink" title="LoadDex"></a>LoadDex</h3><p>通过DexClassLoader实现一个<strong>动态加载</strong>的dex插件</p><p>在ClassLoaderTest项目中打印log</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDexClass</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,<span class="string">"I'm from com.onejane.classloadertest.TestDexClass.testFunc"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过build生成ClassLoaderTest\app\build\outputs\apk\debug\app-debug.apk, <code>apktool d -s app-debug.apk</code>保留并抽取出classes.dex</p><p>adb push classes.dex /sdcard</p><p>创建LoadDex空白Android项目，加载调用位于dex下com.onejane.classloadertest.TestDexClass </p><p>在AndroidManifest.xml中添加读写权限</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br></pre></td></tr></table></figure><p>新增application配置android:requestLegacyExternalStorage=”true”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Context context = <span class="keyword">this</span>.getApplicationContext();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Android 10 sdk30 无法获取sdcard权限，通过获取当前app的cache目录</span></span><br><span class="line"><span class="comment">         * if(!getExternalCacheDir().exists()) getExternalCacheDir().mkdirs();</span></span><br><span class="line"><span class="comment">         * testDexClassLoader(context,getExternalCacheDir().getAbsolutePath()+"/classes.dex");</span></span><br><span class="line"><span class="comment">         * 再将TestDexClass所在的adb push classes.dex /sdcard/Android/data/com.onejane.loaddex/cache/</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 若sdk30需要sdcard，通过requestMyPermissions动态获取读写权限</span></span><br><span class="line">        testDexClassLoader(context,<span class="string">"/sdcard/classes.dex"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestMyPermissions</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>,</span><br><span class="line">                Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">                != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">//没有授权，编写申请权限代码</span></span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.<span class="keyword">this</span>, <span class="keyword">new</span> String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, <span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">"kanxue"</span>, <span class="string">"requestMyPermissions: 有写SD权限"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>,</span><br><span class="line">                Manifest.permission.READ_EXTERNAL_STORAGE)</span><br><span class="line">                != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">//没有授权，编写申请权限代码</span></span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.<span class="keyword">this</span>, <span class="keyword">new</span> String[]&#123;Manifest.permission.READ_EXTERNAL_STORAGE&#125;, <span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">"kanxue"</span>, <span class="string">"requestMyPermissions: 有读SD权限"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可应对app热更新bug修复</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDexClassLoader</span><span class="params">(Context context, String dexfilepath)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 存放dex文件</span></span><br><span class="line">        File optFile = context.getDir(<span class="string">"opt_dex"</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 存放依赖的so文件</span></span><br><span class="line">        File libFile = context.getDir(<span class="string">"lib_path"</span>,<span class="number">0</span>);</span><br><span class="line">        ClassLoader parentClassLoader=MainActivity<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,parentClassLoader.toString()); <span class="comment">//PathClassLoader</span></span><br><span class="line">        ClassLoader tmpClassLoader=context.getClassLoader();</span><br><span class="line">        Log.i(<span class="string">"kanxue"</span>,tmpClassLoader.toString()); <span class="comment">// PathClassLoader</span></span><br><span class="line">        requestMyPermissions();</span><br><span class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(dexfilepath,optFile.getAbsolutePath(),libFile.getAbsolutePath(),MainActivity<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>())</span>;</span><br><span class="line">        Class&lt;?&gt; clazz=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            clazz=dexClassLoader.loadClass(<span class="string">"com.onejane.classloadertest.TestDexClass"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(clazz!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method testFuncMethod=clazz.getDeclaredMethod(<span class="string">"testFunc"</span>);</span><br><span class="line">                Object obj = clazz.newInstance();</span><br><span class="line">                testFuncMethod.invoke(obj);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用外部dex下发热修复bug，用户无感知更新。</p><h1 id="APP启动流程"><a href="#APP启动流程" class="headerlink" title="APP启动流程"></a>APP启动流程</h1><p>由发起进程通过binder进程间通信告知system_server进程启动指定的app，system_server通过socket方式与安卓孵化器进程进行通信，告诉孵化器进程启动指定app，由进程fork产生新的进程真正进入ActivityThread.main()，在此之前一直处于安卓的framework中。</p><p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.png" alt="APP启动流程"></p><p>ActivityThread是单例模式，在app整个进程的生命周期中，只存在一个实例，<a href="http://androidxref.com/8.0.0_r4/" target="_blank" rel="noopener">http://androidxref.com/8.0.0_r4/</a> 搜索位于frameworks中的ActivityThread</p><p>调用静态函数currentActivityThread获取当前进程中的ActivityThread实例，进而可以获取ActivityThread的重要变量,如mPackages </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static ActivityThread currentActivityThread() &#123;</span><br><span class="line">    return sCurrentActivityThread;</span><br><span class="line">&#125;</span><br><span class="line">final ArrayMap&lt;String, WeakReference&lt;LoadedApk&gt;&gt; mPackages &#x3D; new ArrayMap&lt;&gt;();</span><br></pre></td></tr></table></figure><p><strong>其中LoadedApk中有加载app组件的PathClassLoader,即mClassLoader</strong></p><ol><li><p>通过反射获取app进程中单例<strong>ActivityThread</strong>，其中的<strong>sCurrentActivityThread静态变量</strong>用于全局保存创建的ActivityThread实例，同时还提供了<strong>currentActivityThread()静态函数</strong>用于获取当前虚拟机创建的ActivityThread实例。</p></li><li><p>反射拿到ActivityThread中的 <strong>mPackages</strong>的ArrayMap，通过当前app包名<strong>获取LoadedApk</strong>。</p></li><li><p>最后通过LoadedApk获取<strong>mClassLoader-&gt;PathClassLoader</strong>。</p></li></ol><blockquote><p>PathClassLoader:  app运行过程中用于加载四大组件类的ClassLoader</p></blockquote><p>**ActivityThread.main()**函数是java中的入口main函数,这里会启动主消息循环，并创建ActivityThread实例，之后调用thread.attach(false)完成一系列初始化准备工作，并完成全局静态变量sCurrentActivityThread的初始化。之后主线程进入消息循环，等待接收来自系统的消息。当收到系统发送来的bindapplication的进程间调用时，调用函数handleBindApplication来处理该请求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private void handleBindApplication(AppBindData data) &#123;</span><br><span class="line">    &#x2F;&#x2F;step 1: 创建LoadedApk对象</span><br><span class="line">    data.info &#x3D; getPackageInfoNoCheck(data.appInfo, data.compatInfo);</span><br><span class="line">    ...</span><br><span class="line">    &#x2F;&#x2F;step 2: 创建ContextImpl对象;</span><br><span class="line">    final ContextImpl appContext &#x3D; ContextImpl.createAppContext(this, data.info);</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;step 3: 创建Instrumentation</span><br><span class="line">    mInstrumentation &#x3D; new Instrumentation();</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;step 4: 创建Application对象;在makeApplication函数中调用了newApplication，真正执行app代码。在该函数中又调用了app.attach(context)，在attach函数中调用了Application.attachBaseContext函数</span><br><span class="line">    Application app &#x3D; data.info.makeApplication(data.restrictedBackupMode, null);</span><br><span class="line">    mInitialApplication &#x3D; app;</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;step 5: 安装providers</span><br><span class="line">    List&lt;ProviderInfo&gt; providers &#x3D; data.providers;</span><br><span class="line">    installContentProviders(app, providers);</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;step 6: 执行Application.Create回调</span><br><span class="line">    mInstrumentation.callApplicationOnCreate(app);</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 <strong>handleBindApplication</strong>函数中第一次进入了app的代码世界，该函数功能是<strong>启动一个application</strong>，并把系统收集的apk组件等相关信息绑定到application里，在创建完application对象后，接着<strong>调用了application的attachBaseContext</strong>方法，之后<strong>调用了application的onCreate</strong>函数。由此可以发现，app的Application类中的<strong>attachBaseContext</strong>和<strong>onCreate</strong>这两个函数是最先获取执行权进行代码执行的。这也是为什么各家的加固工具的主要逻辑都是通过替换app入口Application，并自实现这两个函数，在这两个函数中进行加密dex释放以及执行权交付的原因。</p><h1 id="APP运行流程"><a href="#APP运行流程" class="headerlink" title="APP运行流程"></a>APP运行流程</h1><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/app运行流程.png" alt="app运行流程" style="zoom:67%;"><p>无壳：PathClassLoader加载自身app自身dex，包括app声明的Application及所有其他类信息</p><p>加壳：PathClassLoader只加载壳自身代码，不包含app自身真正代码。首先进入壳的application的attachBaseContext，解密原始dex，再完成执行权的交付。</p><p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/%E5%8A%A0%E5%A3%B3app%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.png" alt="加壳app启动流程"></p><p><strong>DexClassLoader加载的类是没有组件生命周期的</strong>，也就是说即使DexClassLoader通过对APK的动态加载完成了对组件类的加载，当系统启动该组件时，依然会出现加载类失败的异常，因为插件没有组件相关的类，如一些activity或service，若只用DexClassLoader进行动态加载，系统PathClassLoader无法找到相关组件信息，app将直接崩溃。所以如何解决动态加载dex中的生命周期成为加壳厂商首先需要解决的问题！！！</p><p>在项目<strong>ClassLoaderTest</strong>中新建TestActivity ，并将build的apk中的classes.dex取出，adb push classes.dex /sdcard</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class TestActivity extends AppCompatActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        &#x2F;&#x2F; adb push classes.dex &#x2F;sdcard</span><br><span class="line">        Log.i(&quot;kanxue&quot;,&quot;I&#39;m from TestActivity.onCreate&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在项目<strong>LoadDex</strong>中，配置AndroidManifest.xml<code>&lt;activity android:name=&quot;com.onejane.classloadertest.TestActivity&quot;&gt;&lt;/activity&gt;</code>,在MainActivity中新增方法，并启动运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    Context context &#x3D; this.getApplicationContext();</span><br><span class="line">    startTestActivity(context,&quot;&#x2F;sdcard&#x2F;classes.dex&quot;);</span><br><span class="line">&#125;</span><br><span class="line">public void startTestActivity(Context context,String dexfilepath)&#123;</span><br><span class="line">    &#x2F;&#x2F; 存放dex文件</span><br><span class="line">    File optFile &#x3D; context.getDir(&quot;opt_dex&quot;,0);</span><br><span class="line">    &#x2F;&#x2F; 存放依赖的so文件</span><br><span class="line">    File libFile &#x3D; context.getDir(&quot;lib_path&quot;,0);</span><br><span class="line">    ClassLoader parentClassLoader&#x3D;MainActivity.class.getClassLoader();</span><br><span class="line">    Log.i(&quot;kanxue&quot;,parentClassLoader.toString()); &#x2F;&#x2F;PathClassLoader</span><br><span class="line">    ClassLoader tmpClassLoader&#x3D;context.getClassLoader();</span><br><span class="line">    Log.i(&quot;kanxue&quot;,tmpClassLoader.toString()); &#x2F;&#x2F; PathClassLoader</span><br><span class="line">    requestMyPermissions();</span><br><span class="line">    DexClassLoader dexClassLoader &#x3D; new DexClassLoader(dexfilepath,optFile.getAbsolutePath(),libFile.getAbsolutePath(),MainActivity.class.getClassLoader());</span><br><span class="line">    Class&lt;?&gt; clazz&#x3D;null;</span><br><span class="line">    try&#123;</span><br><span class="line">        clazz&#x3D;dexClassLoader.loadClass(&quot;com.onejane.classloadertest.TestActivity&quot;);</span><br><span class="line">    &#125;catch (ClassNotFoundException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    if(clazz!&#x3D;null)&#123;</span><br><span class="line">        context.startActivity(new Intent(context,clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动app将报错ClassNotFoundException: Didn’t find class “com.onejane.classloadertest.TestActivity”</p><p>说明组件相关的Activity由mClassLoader-&gt;PathClassLoader加载了，<strong>虽然获取到非空TestActivity，却无法找到启动的目标Activity</strong>。</p><h2 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h2><p>反射替换，替换系统组件类加载器mClassLoader为我们的DexClassLoader，同时设置DexClassLoader的parent为系统组件类加载器PathClassLoader；</p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/反射替换.png" alt="反射替换" style="zoom:67%;"><p>修改LoadDex项目的MainActivity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Context context &#x3D; this.getApplicationContext();</span><br><span class="line">        startTestActivityReplaceMethod(this,&quot;&#x2F;sdcard&#x2F;classes.dex&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void requestMyPermissions() &#123;</span><br><span class="line"></span><br><span class="line">        if (ContextCompat.checkSelfPermission(this,</span><br><span class="line">                Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">                !&#x3D; PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            &#x2F;&#x2F;没有授权，编写申请权限代码</span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, 100);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Log.d(&quot;kanxue&quot;, &quot;requestMyPermissions: 有写SD权限&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (ContextCompat.checkSelfPermission(this,</span><br><span class="line">                Manifest.permission.READ_EXTERNAL_STORAGE)</span><br><span class="line">                !&#x3D; PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            &#x2F;&#x2F;没有授权，编写申请权限代码</span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.READ_EXTERNAL_STORAGE&#125;, 100);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Log.d(&quot;kanxue&quot;, &quot;requestMyPermissions: 有读SD权限&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void replaceClassloader(ClassLoader classloader)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class&lt;?&gt; ActivityThreadClazz&#x3D;classloader.loadClass(&quot;android.app.ActivityThread&quot;);</span><br><span class="line">            &#x2F;&#x2F; 获取静态函数currentActivityThread</span><br><span class="line">            Method currentActivityThreadMethod&#x3D; ActivityThreadClazz.getDeclaredMethod(&quot;currentActivityThread&quot;);</span><br><span class="line">            currentActivityThreadMethod.setAccessible(true);</span><br><span class="line">            Object activityThreadObj&#x3D;currentActivityThreadMethod.invoke(null); &#x2F;&#x2F; 获取ActivityThread对象</span><br><span class="line">            &#x2F;&#x2F;final ArrayMap&lt;String, WeakReference&lt;LoadedApk&gt;&gt; mPackages &#x3D; new ArrayMap&lt;&gt;();  </span><br><span class="line">            Field mPackagesField&#x3D;ActivityThreadClazz.getDeclaredField(&quot;mPackages&quot;);  &#x2F;&#x2F; 获取ActivityThread对象的ArrayMap的Field</span><br><span class="line">            mPackagesField.setAccessible(true);</span><br><span class="line">            ArrayMap mPackagesObj&#x3D; (ArrayMap) mPackagesField.get(activityThreadObj); &#x2F;&#x2F; 通过Field获取mPackages实例</span><br><span class="line">            WeakReference wr&#x3D; (WeakReference) mPackagesObj.get(this.getPackageName()); &#x2F;&#x2F; 从ArrayMap中获取LoadApk</span><br><span class="line">            Object loadedApkObj&#x3D;wr.get();</span><br><span class="line"></span><br><span class="line">            Class LoadedApkClazz&#x3D;classloader.loadClass(&quot;android.app.LoadedApk&quot;);</span><br><span class="line">            &#x2F;&#x2F;private ClassLoader mClassLoader;</span><br><span class="line">            Field mClassLoaderField&#x3D;LoadedApkClazz.getDeclaredField(&quot;mClassLoader&quot;);</span><br><span class="line">            mClassLoaderField.setAccessible(true);</span><br><span class="line">            mClassLoaderField.set(loadedApkObj,classloader); &#x2F;&#x2F; 将LoadApk(mClassLoader)替换为我们的DexClassLoader</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public void startTestActivityReplaceMethod(Context context,String dexfilepath)&#123;</span><br><span class="line">        &#x2F;&#x2F; 存放dex文件</span><br><span class="line">        File optFile &#x3D; context.getDir(&quot;opt_dex&quot;,0);</span><br><span class="line">        &#x2F;&#x2F; 存放依赖的so文件</span><br><span class="line">        File libFile &#x3D; context.getDir(&quot;lib_path&quot;,0);</span><br><span class="line">        requestMyPermissions();</span><br><span class="line">        DexClassLoader dexClassLoader &#x3D; new DexClassLoader(dexfilepath,optFile.getAbsolutePath(),libFile.getAbsolutePath(),MainActivity.class.getClassLoader());</span><br><span class="line">        replaceClassloader(dexClassLoader);</span><br><span class="line">        Class&lt;?&gt; clazz&#x3D;null;</span><br><span class="line">        try&#123;</span><br><span class="line">            clazz&#x3D;dexClassLoader.loadClass(&quot;com.onejane.classloadertest.TestActivity&quot;);</span><br><span class="line">        &#125;catch (ClassNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        if(clazz!&#x3D;null)&#123;</span><br><span class="line">            context.startActivity(new Intent(context,clazz));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h2><p>打破原有的双亲关系，在系统组件类加载器和BootClassLoader的中间插入我们自己的DexClassLoader即可</p><img src="/2021/02/04/%E5%8A%A0%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%E4%B9%8B%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/反射插入.png" alt="反射插入" style="zoom:67%;"><p>修改ClassLoaderTest中的TestActivity类继承自Activity </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class TestActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">&#x2F;&#x2F;        setContentView(R.layout.activity_main);</span><br><span class="line">        &#x2F;&#x2F; adb push classes.dex &#x2F;sdcard</span><br><span class="line">        Log.i(&quot;kanxue&quot;,&quot;I&#39;m from TestActivity.onCreate&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改LoadDex中的MainActivity继承Activity </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Context context &#x3D; this.getApplicationContext();</span><br><span class="line">        &#x2F;&#x2F; 若sdk30需要sdcard，通过requestMyPermissions动态获取读写权限</span><br><span class="line">&#x2F;&#x2F;        testDexClassLoader(context,&quot;&#x2F;sdcard&#x2F;classes.dex&quot;);</span><br><span class="line">&#x2F;&#x2F;        startTestActivityReplaceMethod(this,&quot;&#x2F;sdcard&#x2F;classes.dex&quot;);</span><br><span class="line">        startTestActivityInsertMethod(this,&quot;&#x2F;sdcard&#x2F;classes.dex&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void requestMyPermissions() &#123;</span><br><span class="line"></span><br><span class="line">        if (ContextCompat.checkSelfPermission(this,</span><br><span class="line">                Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">                !&#x3D; PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            &#x2F;&#x2F;没有授权，编写申请权限代码</span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, 100);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Log.d(&quot;kanxue&quot;, &quot;requestMyPermissions: 有写SD权限&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (ContextCompat.checkSelfPermission(this,</span><br><span class="line">                Manifest.permission.READ_EXTERNAL_STORAGE)</span><br><span class="line">                !&#x3D; PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            &#x2F;&#x2F;没有授权，编写申请权限代码</span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.this, new String[]&#123;Manifest.permission.READ_EXTERNAL_STORAGE&#125;, 100);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Log.d(&quot;kanxue&quot;, &quot;requestMyPermissions: 有读SD权限&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void startTestActivityInsertMethod(Context context,String dexfilepath)&#123;</span><br><span class="line">        File optfile&#x3D;context.getDir(&quot;opt_dex&quot;,0);</span><br><span class="line">        File libfile&#x3D;context.getDir(&quot;lib_path&quot;,0);</span><br><span class="line">        requestMyPermissions();</span><br><span class="line">        ClassLoader pathClassloader&#x3D;MainActivity.class.getClassLoader();</span><br><span class="line">        ClassLoader bootClassloader&#x3D;MainActivity.class.getClassLoader().getParent();</span><br><span class="line">        &#x2F;&#x2F; 设置自定义dexClassLoader父ClassLoader为bootClassloader</span><br><span class="line">        DexClassLoader dexClassLoader&#x3D;new DexClassLoader(dexfilepath,optfile.getAbsolutePath(),libfile.getAbsolutePath(),bootClassloader);</span><br><span class="line">        try &#123;</span><br><span class="line">            Field parentField&#x3D;ClassLoader.class.getDeclaredField(&quot;parent&quot;);</span><br><span class="line">            parentField.setAccessible(true);</span><br><span class="line">            &#x2F;&#x2F; 设置pathClassLoader父ClassLoader为自定义dexClassLoader</span><br><span class="line">            parentField.set(pathClassloader,dexClassLoader);</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ClassLoader tmpClassloader&#x3D;pathClassloader;</span><br><span class="line">        ClassLoader parentClassloader&#x3D;pathClassloader.getParent();</span><br><span class="line">        while(parentClassloader!&#x3D;null)&#123;</span><br><span class="line">            Log.i(&quot;kanxue&quot;,&quot;this:&quot;+tmpClassloader+&quot;--parent:&quot;+parentClassloader);</span><br><span class="line">            tmpClassloader&#x3D;parentClassloader;</span><br><span class="line">            parentClassloader&#x3D;parentClassloader.getParent();</span><br><span class="line">        &#125;</span><br><span class="line">        Log.i(&quot;kanxue&quot;,&quot;root:&quot;+tmpClassloader);</span><br><span class="line">        Class&lt;?&gt; clazz&#x3D;null;</span><br><span class="line">        try &#123;</span><br><span class="line">            clazz &#x3D; dexClassLoader.loadClass(&quot;com.onejane.classloadertest.TestActivity&quot;);</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        context.startActivity(new Intent(context,clazz));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上都是基于文件形式的外部加载，Android 8.0引入InMemoryDexClassLoader实现从内存中直接加载字节流，更加安全，不能通过文件监控形式达到脱壳目的，需要从进程内存中扣出这块完整的dex实现脱壳。</p></blockquote><ul><li>部分app在AndroidManifest.xml中没有声明application，加固厂商只需要添加一个application，在自己的application中完成classloader的替换。</li><li>部分app在AndroidManifest.xml中已经声明application，加固需要一个代理的application，壳的application不仅需要完成解密dex以及classloader相关修复，还需要完成解密dex后原app的application的attachBaseContext和onCreate函数调用。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
          <category> 加壳与脱壳 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> classloader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>猿人学之访问逻辑罗生门</title>
      <link href="2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/"/>
      <url>2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><a href="http://match.yuanrenxue.com/match/3" target="_blank" rel="noopener">http://match.yuanrenxue.com/match/3</a></p><p>抓取下列5页商标的数据，并将出现频率最高的申请号填入答案中</p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/%E6%8A%93%E5%8C%85.png" alt="抓包"></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p><a href="http://match.yuanrenxue.com/match/3" target="_blank" rel="noopener">http://match.yuanrenxue.com/match/3</a>  请求原始网页后请求一堆js/css,并没有携带cookie和特殊的返回</p><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/%E5%88%9D%E5%A7%8B%E8%AF%B7%E6%B1%82%E8%BF%94%E5%9B%9E.png" alt="初始请求返回"></p><p><a href="http://match.yuanrenxue.com/logo" target="_blank" rel="noopener">http://match.yuanrenxue.com/logo</a> 每次请求页数的时候都会先请求logo并set了一个cookie，说明cookie是从服务器返回的</p><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/%E8%8E%B7%E5%8F%96cookie.png" alt="获取cookie"></p><p><a href="http://match.yuanrenxue.com/api/match/3" target="_blank" rel="noopener">http://match.yuanrenxue.com/api/match/3</a> 请求返回页面json数据，携带logo返回的cookie</p><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8B%E8%AE%BF%E9%97%AE%E9%80%BB%E8%BE%91%E7%BD%97%E7%94%9F%E9%97%A8/%E8%BF%94%E5%9B%9Ejson.png" alt="返回json"></p><p>没有带cookie不能访问<a href="http://match.yuanrenxue.com/api/match/3" target="_blank" rel="noopener">http://match.yuanrenxue.com/api/match/3</a></p><p>使用请求头加引号.py 将fiddler的请求头包上</p><blockquote><p>请求头加引号.py</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">old_headers =<span class="string">'''</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string">Accept: application/json, text/javascript, */*; q=0.01</span></span><br><span class="line"><span class="string">X-Requested-With: XMLHttpRequest</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.70 Safari/537.36</span></span><br><span class="line"><span class="string">Referer: http://match.yuanrenxue.com/match/3</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Cookie: sessionid=7ly07o9fclh1llfsposkhh9jqvujxkth</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">pattern = <span class="string">'^(.*?):[\s]*(.*?)$'</span></span><br><span class="line">headers = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> old_headers.splitlines():</span><br><span class="line">    headers += (re.sub(pattern,<span class="string">'\'\\1\': \'\\2\','</span>,line)) + <span class="string">'\n'</span></span><br><span class="line">print(headers[:<span class="number">-2</span>])</span><br></pre></td></tr></table></figure><p>加上cookie使用python请求抓取返回一堆js代码，因为cookie是由服务器生成的，所以这一段返回的js没有意义</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line">    <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'yuanrenxue.project'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'http://match.yuanrenxue.com/match/3'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span>,</span><br><span class="line">    <span class="string">'Cookie'</span>: <span class="string">'sessionid=7ly07o9fclh1llfsposkhh9jqvujxkth'</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'http://match.yuanrenxue.com/api/match/3'</span></span><br><span class="line">res = requests.get(url=url, headers=headers)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><p>规律：请求完logo后再请求api则正常返回，同理请求第二页</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</span><br><span class="line">    <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'yuanrenxue.project'</span>,</span><br><span class="line">    <span class="string">'Referer'</span>: <span class="string">'http://match.yuanrenxue.com/match/3'</span>,</span><br><span class="line">    <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">    <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span></span><br><span class="line">&#125;</span><br><span class="line">session.headers = headers</span><br><span class="line">url_logo = <span class="string">'http://match.yuanrenxue.com/logo'</span></span><br><span class="line">res = session.post(url_logo)</span><br><span class="line">print(res, res.cookies)</span><br><span class="line">url = <span class="string">'http://match.yuanrenxue.com/api/match/3?page=1'</span></span><br><span class="line">res = session.get(url=url)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>猿人学之js混淆动态cookie</title>
      <link href="2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E5%8A%A8%E6%80%81cookie/"/>
      <url>2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E5%8A%A8%E6%80%81cookie/</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><a href="http://match.yuanrenxue.com/match/2" target="_blank" rel="noopener">http://match.yuanrenxue.com/match/2</a></p><p>提取全部5页发布日热度的值，计算所有值的加和,并提交答案</p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>chrome无痕模式通过抓包获取所有请求</p><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E5%8A%A8%E6%80%81cookie/charls%E6%8A%93%E5%8C%85.png" alt="charls抓包"></p><p>第一个match/2不携带cookie并返回一串js代码</p><p>第二个match/2最早携带cookie并返回html页面，且并没有在请求头set-cookie,说明cookie是本地生成，而非服务器生成带到前端的，那么第一个match/2返回的js很可能就会生成cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie m&#x3D;dd5572e825610043a17c791d1eadc601|1607590427000</span><br></pre></td></tr></table></figure><p>第三个api/match/2携带cookie返回页面请求json数据</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>使用<a href="http://tool.yuanrenxue.com/decode_obfuscator" target="_blank" rel="noopener">ob混淆专解测试版V0.1</a>反混淆第一个match/2返回的js代码去掉script标签</p><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E5%8A%A8%E6%80%81cookie/ob%E5%8F%8D%E6%B7%B7%E6%B7%86.png" alt="ob反混淆"></p><p>将解析完的js放到notepad++中进行js format，查找eval，setInterval，document等函数或者cookie等关键字符串。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">V</span>(<span class="params">Y, Z, a0</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 空参数  </span></span><br><span class="line">    M();</span><br><span class="line">    <span class="keyword">return</span> Z ? a0 ? H(Z, Y) : y(Z, Y) : a0 ? T(Y) : U(Y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Y=X()时间戳，Z无用</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">W</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取cookie  </span></span><br><span class="line">    <span class="built_in">document</span>[<span class="string">"cookie"</span>] = <span class="string">"m"</span> + M() + <span class="string">"="</span> + V(Y) + <span class="string">"|"</span> + Y + <span class="string">"; path=/"</span>;</span><br><span class="line">    <span class="comment">// 带上cookie重新刷新页面返回真实网页并发送ajax请求获取json数据</span></span><br><span class="line">    location[<span class="string">"reload"</span>]();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 时间戳</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">X</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Date</span>[<span class="string">"parse"</span>](<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 最先执行js</span></span><br><span class="line">  W(X());</span><br></pre></td></tr></table></figure><p>查看W和V中的M(),都没有传参数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 只定义函数并无更新值</span></span><br><span class="line">    <span class="keyword">var</span> a2 = B(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> a5 = &#123;</span><br><span class="line">        <span class="string">"JLTiy"</span>: <span class="string">"return /\" + this + \"/"</span>,</span><br><span class="line">        <span class="string">"uynWF"</span>: <span class="string">"^([^ ]+( +[^ ]+)+)+[^ ]&#125;"</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> a7 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a8 = a7[<span class="string">"constructor"</span>](a5[<span class="string">"JLTiy"</span>])()[<span class="string">"compile"</span>](a5[<span class="string">"uynWF"</span>]);</span><br><span class="line">        <span class="keyword">return</span> !a8[<span class="string">"test"</span>](a2);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> a7();</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// 未传参 未改变全局变量 无返回</span></span><br><span class="line">    a2();</span><br><span class="line"><span class="comment">// 未传参 未改变全局变量 无返回</span></span><br><span class="line">    K();</span><br><span class="line">    qz = [<span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">110</span>, <span class="number">101</span>, <span class="number">119</span>, <span class="number">32</span>, <span class="number">79</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">102</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">32</span>, <span class="number">40</span>, <span class="number">115</span>, <span class="number">41</span>, <span class="number">32</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">119</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">40</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">102</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">40</span>, <span class="number">105</span>, <span class="number">61</span>, <span class="number">48</span>, <span class="number">59</span>, <span class="number">105</span>, <span class="number">60</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">59</span>, <span class="number">105</span>, <span class="number">43</span>, <span class="number">43</span>, <span class="number">41</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">46</span>, <span class="number">112</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">40</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">105</span>, <span class="number">41</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">91</span>, <span class="number">111</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">79</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">93</span>, <span class="number">39</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">402</span>, <span class="number">32</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">32</span>, <span class="number">123</span>, <span class="number">32</span>, <span class="number">91</span>, <span class="number">110</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">93</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">39</span>, <span class="number">10</span>];</span><br><span class="line">    <span class="built_in">eval</span>(L(qz));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (global) &#123;</span><br><span class="line">        <span class="built_in">console</span>[<span class="string">"log"</span>](<span class="string">"\u4EBA\u751F\u82E6\u77ED\uFF0C\u4F55\u5FC5python\uFF1F"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>[<span class="string">"log"</span>](<span class="string">"\u4EBA\u751F\u82E6\u77ED\uFF0C\u4F55\u5FC5python\uFF1F"</span>);</span><br><span class="line">          <span class="keyword">debugger</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (a5) &#123;</span><br><span class="line">      <span class="keyword">return</span> navigator[<span class="string">"vendorSub"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>通过WT-JS查看L(qz)，并没有对cookie进行影响</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">L</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a0 = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> a1 = <span class="number">0</span>; a1 &lt; Y[<span class="string">"length"</span>]; a1++) &#123;</span><br><span class="line">    a0 += <span class="built_in">String</span>[<span class="string">"fromCharCode"</span>](Y[a1]);</span><br><span class="line">  &#125;</span><br><span class="line">   <span class="keyword">return</span> a0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/02/03/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E5%8A%A8%E6%80%81cookie/L%E5%87%BD%E6%95%B0.png" alt="L函数"></p><p>navigator[“vendorSub”]放到console返回””,得出M()结论不返回或者返回””,也没修改变量参数</p><p>去除无用首行(function $c(k) {和尾行})();</p><p>去除最先执行W(X());</p><p>去除W内的location<a href>“reload”</a>;</p><p>将document[“cookie”] =改为return </p><p>去除无用setInterval(M(), 500);</p><p>去除W函数无用Z,M()为null也可以去除</p><p>删除无返回js，因为会报test未定义</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无返回   </span></span><br><span class="line"><span class="keyword">var</span> a2 = B(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a5 = &#123;</span><br><span class="line">    <span class="string">"JLTiy"</span>: <span class="string">"return /\" + this + \"/"</span>,</span><br><span class="line">    <span class="string">"uynWF"</span>: <span class="string">"^([^ ]+( +[^ ]+)+)+[^ ]&#125;"</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> a7 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a8 = a7[<span class="string">"constructor"</span>](a5[<span class="string">"JLTiy"</span>])()[<span class="string">"compile"</span>](a5[<span class="string">"uynWF"</span>]);</span><br><span class="line">    <span class="keyword">return</span> !a8[<span class="string">"test"</span>](a2);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> a7();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 未传参 未改变全局变量 无返回</span></span><br><span class="line">a2();</span><br></pre></td></tr></table></figure><p>新增var navigator = {};</p><p>使用鬼鬼调试工具，执行W(X());</p><p>核心js如下2.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> navigator = &#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 未传参 未改变全局变量 无返回</span></span><br><span class="line">    K();</span><br><span class="line">    qz = [<span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">110</span>, <span class="number">101</span>, <span class="number">119</span>, <span class="number">32</span>, <span class="number">79</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">102</span>, <span class="number">117</span>, <span class="number">110</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">32</span>, <span class="number">40</span>, <span class="number">115</span>, <span class="number">41</span>, <span class="number">32</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">119</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">40</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">102</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">40</span>, <span class="number">105</span>, <span class="number">61</span>, <span class="number">48</span>, <span class="number">59</span>, <span class="number">105</span>, <span class="number">60</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">59</span>, <span class="number">105</span>, <span class="number">43</span>, <span class="number">43</span>, <span class="number">41</span>, <span class="number">123</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">46</span>, <span class="number">112</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">40</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">105</span>, <span class="number">41</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">125</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">91</span>, <span class="number">111</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">79</span>, <span class="number">98</span>, <span class="number">106</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">93</span>, <span class="number">39</span>, <span class="number">10</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">61</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">402</span>, <span class="number">32</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">32</span>, <span class="number">123</span>, <span class="number">32</span>, <span class="number">91</span>, <span class="number">110</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">93</span>, <span class="number">32</span>, <span class="number">125</span>, <span class="number">39</span>, <span class="number">10</span>];</span><br><span class="line">    <span class="built_in">eval</span>(L(qz));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (global) &#123;</span><br><span class="line">            <span class="built_in">console</span>[<span class="string">"log"</span>](<span class="string">"\u4EBA\u751F\u82E6\u77ED\uFF0C\u4F55\u5FC5python\uFF1F"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>[<span class="string">"log"</span>](<span class="string">"\u4EBA\u751F\u82E6\u77ED\uFF0C\u4F55\u5FC5python\uFF1F"</span>);</span><br><span class="line">                <span class="keyword">debugger</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (a5) &#123;</span><br><span class="line">        <span class="keyword">return</span> navigator[<span class="string">"vendorSub"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">V</span>(<span class="params">Y, Z, a0</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 空参数</span></span><br><span class="line">    M();</span><br><span class="line">    <span class="keyword">return</span> Z ? a0 ? H(Z, Y) : y(Z, Y) : a0 ? T(Y) : U(Y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Y=X()时间戳，Z无用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">W</span>(<span class="params">Y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"m"</span> + <span class="string">"="</span> + V(Y) + <span class="string">"|"</span> + Y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">X</span>(<span class="params">Y, Z</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Date</span>[<span class="string">"parse"</span>](<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> W(X());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(page_num,param)</span>:</span></span><br><span class="line">    url = <span class="string">"http://match.yuanrenxue.com/api/match/2?page=&#123;&#125;"</span>.format(page_num)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Host'</span>: <span class="string">'match.yuanrenxue.com'</span>,</span><br><span class="line">        <span class="string">'Referer'</span>:<span class="string">'http://match.yuanrenxue.com/match/2'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>:<span class="string">'yuanrenxue.project'</span>,</span><br><span class="line">        <span class="string">'X-Requested-With'</span>:<span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">        <span class="string">'Cookie'</span>: param</span><br><span class="line">    &#125;</span><br><span class="line">    resonse = requests.get(url=url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> resonse.json()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_m_value</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'2.js'</span>,encoding=<span class="string">'utf-8'</span>,mode=<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        JsData = f.read()</span><br><span class="line">    psd = execjs.compile(JsData).call(<span class="string">'request'</span>)</span><br><span class="line">    psd = psd.replace(<span class="string">'丨'</span>,<span class="string">'%E4%B8%A8'</span>)</span><br><span class="line">    print(<span class="string">'this request parameters is :'</span>,psd)</span><br><span class="line">    <span class="keyword">return</span> psd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sum_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> page_num <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">6</span>):</span><br><span class="line">        res = get_page(page_num,calculate_m_value())</span><br><span class="line">        data = [__[<span class="string">'value'</span>] <span class="keyword">for</span> __ <span class="keyword">in</span> res[<span class="string">'data'</span>]]</span><br><span class="line">        print(data)</span><br><span class="line">        sum_num+=sum(data)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'the answer is :'</span>,sum_num)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>猿人学之js混淆源码乱码</title>
      <link href="2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/"/>
      <url>2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><a href="http://match.yuanrenxue.com/match/1" target="_blank" rel="noopener">http://match.yuanrenxue.com/match/1</a><br>抓取所有（5页）机票的价格，并计算所有机票价格的平均值，填入答案。</p><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>打开控制台开始抓包，出现无限debugger循环,可以通过Never pause here或Fiddler过掉。</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/debugger.png" alt="无限debugger"></p><p>方案一：在第2行选中右键Never pause here</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/never-pause.png" alt="never-pause-here过debugger"></p><p>方案二：通过查看该debug的js名为uzt.js，本地创建uzt.js并修改其中的jsFiddler的AutoResponder下，选中Enable automatic reaponses 和Unmatched requests passthrough</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/fiddler.png" alt="fiddler过debugger"></p><p>通过翻页获取请求参数得其中1607516709为秒时间戳，即time.time()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page: 2</span><br><span class="line">m: 3ddf4f4e72bd84562a0e0104d425a791丨1607657864</span><br></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>查看网页源码，搜索丨中文竖线，抠出js</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/yuanma.png" alt="抠出js页面源码"></p><p>通过notepad++插件进行js格式化后得到核心代码</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/hexin.png" alt="格式化源码"></p><p>修改得m的计算方式</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timestamp = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="number">100000000</span>;</span><br><span class="line">    <span class="keyword">var</span> m = oo0O0(timestamp.toString()) + <span class="built_in">window</span>.f; </span><br><span class="line">    m =  m + <span class="string">'丨'</span> + timestamp / <span class="number">1000</span> </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>扣出oo0O0方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">oo0O0</span>(<span class="params">mw</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.b = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = <span class="built_in">window</span>.a.length; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">window</span>.a[i]);</span><br><span class="line">        <span class="built_in">window</span>.b += <span class="built_in">String</span>[<span class="built_in">document</span>.e + <span class="built_in">document</span>.g](<span class="built_in">window</span>.a[i][<span class="built_in">document</span>.f + <span class="built_in">document</span>.h]() - i - <span class="built_in">window</span>.c)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> U = [<span class="string">'W5r5W6VdIHZcT8kU'</span>, <span class="string">'WQ8CWRaxWQirAW=='</span>];</span><br><span class="line">    <span class="keyword">var</span> J = <span class="function"><span class="keyword">function</span> (<span class="params">o, E</span>) </span>&#123;</span><br><span class="line">        o = o - <span class="number">0x0</span>;</span><br><span class="line">        <span class="keyword">var</span> N = U[o];</span><br><span class="line">        <span class="keyword">if</span> (J[<span class="string">'bSSGte'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> Y = <span class="function"><span class="keyword">function</span> (<span class="params">w</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> m = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/='</span>,</span><br><span class="line">                T = <span class="built_in">String</span>(w)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">var</span> A = <span class="string">''</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0x0</span>, b, W, l = <span class="number">0x0</span>; W = T[<span class="string">'charAt'</span>](l++); ~W &amp;&amp; (b = C % <span class="number">0x4</span> ? b * <span class="number">0x40</span> + W : W, C++ % <span class="number">0x4</span>) ? A += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; b &gt;&gt; (<span class="number">-0x2</span> * C &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    W = m[<span class="string">'indexOf'</span>](W)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> A</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> t = <span class="function"><span class="keyword">function</span> (<span class="params">w, m</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> T = [],</span><br><span class="line">                A = <span class="number">0x0</span>,</span><br><span class="line">                C,</span><br><span class="line">                b = <span class="string">''</span>,</span><br><span class="line">                W = <span class="string">''</span>;</span><br><span class="line">                w = Y(w);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0x0</span>, v = w[<span class="string">'length'</span>]; R &lt; v; R++) &#123;</span><br><span class="line">                    W += <span class="string">'%'</span> + (<span class="string">'00'</span> + w[<span class="string">'charCodeAt'</span>](R)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                w = <span class="built_in">decodeURIComponent</span>(W);</span><br><span class="line">                <span class="keyword">var</span> l;</span><br><span class="line">                <span class="keyword">for</span> (l = <span class="number">0x0</span>; l &lt; <span class="number">0x100</span>; l++) &#123;</span><br><span class="line">                    T[l] = l</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (l = <span class="number">0x0</span>; l &lt; <span class="number">0x100</span>; l++) &#123;</span><br><span class="line">                    A = (A + T[l] + m[<span class="string">'charCodeAt'</span>](l % m[<span class="string">'length'</span>])) % <span class="number">0x100</span>,</span><br><span class="line">                    C = T[l],</span><br><span class="line">                    T[l] = T[A],</span><br><span class="line">                    T[A] = C</span><br><span class="line">                &#125;</span><br><span class="line">                l = <span class="number">0x0</span>,</span><br><span class="line">                A = <span class="number">0x0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> L = <span class="number">0x0</span>; L &lt; w[<span class="string">'length'</span>]; L++) &#123;</span><br><span class="line">                    l = (l + <span class="number">0x1</span>) % <span class="number">0x100</span>,</span><br><span class="line">                    A = (A + T[l]) % <span class="number">0x100</span>,</span><br><span class="line">                    C = T[l],</span><br><span class="line">                    T[l] = T[A],</span><br><span class="line">                    T[A] = C,</span><br><span class="line">                    b += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](w[<span class="string">'charCodeAt'</span>](L) ^ T[(T[l] + T[A]) % <span class="number">0x100</span>])</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> b</span><br><span class="line">            &#125;;</span><br><span class="line">            J[<span class="string">'luAabU'</span>] = t,</span><br><span class="line">            J[<span class="string">'qlVPZg'</span>] = &#123;&#125;,</span><br><span class="line">            J[<span class="string">'bSSGte'</span>] = !![]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> H = J[<span class="string">'qlVPZg'</span>][o];</span><br><span class="line">        <span class="keyword">return</span> H === <span class="literal">undefined</span> ? (J[<span class="string">'TUDBIJ'</span>] === <span class="literal">undefined</span> &amp;&amp; (J[<span class="string">'TUDBIJ'</span>] = !![]), N = J[<span class="string">'luAabU'</span>](N, E), J[<span class="string">'qlVPZg'</span>][o] = N) : N = H,</span><br><span class="line">        N</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">eval</span>(atob(<span class="built_in">window</span>[<span class="string">'b'</span>])[J(<span class="string">'0x0'</span>, <span class="string">']dQW'</span>)](J(<span class="string">'0x1'</span>, <span class="string">'GTu!'</span>), <span class="string">'\x27'</span> + mw + <span class="string">'\x27'</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于返回是个空字符串，则oo0O0(timestamp.toString())=‘’，m=window.f，查看源码得知window.f只有一个，那么f作为全局变量可能在oo0O0中被修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(atob(window[&#39;b&#39;])[J(&#39;0x0&#39;, &#39;]dQW&#39;)](J(&#39;0x1&#39;, &#39;GTu!&#39;), &#39;\x27&#39; + mw + &#39;\x27&#39;));</span><br></pre></td></tr></table></figure><p>atob是解码使用 base-64 编码的字符串的函数，通过console中获取atob(window[‘b’])</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/b.png" alt="获取windows的b参数"></p><p>通过WT-JS加载计算f=hex_md5(mwqqppz)</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/WT-JS.png" alt="获取windows的f参数"></p><p>报错未定义，mwqqppz可能是被其他地方替换或者加密来的</p><p>查看J(‘0x0’, ‘]dQW’)方法返回值，在console中执行J方法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> U = [<span class="string">'W5r5W6VdIHZcT8kU'</span>, <span class="string">'WQ8CWRaxWQirAW=='</span>];</span><br><span class="line"><span class="keyword">var</span> J = <span class="function"><span class="keyword">function</span> (<span class="params">o, E</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/clipboard.png" alt="调用J函数"></p><p>拼接得到<code>eval(atob(window[&#39;b&#39;])[replace](&#39;mwqqppz&#39;, &#39;\x27&#39; + mw + &#39;\x27&#39;));</code></p><p>搜索\bmw\b,发现mw为function oo0O0的参数，即时间戳</p><p><img src="/2021/02/01/%E7%8C%BF%E4%BA%BA%E5%AD%A6%E4%B9%8Bjs%E6%B7%B7%E6%B7%86%E6%BA%90%E7%A0%81%E4%B9%B1%E7%A0%81/mw.png" alt="获取mw参数"></p><p>所以f=hex_md5(timestamp),在WT-JS中添加js，atob(window[‘b’])获取window.f</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hexcase = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> b64pad = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">var</span> chrsz = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex_md5</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2hex(core_md5(str2binl(a), a.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64_md5</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2b64(core_md5(str2binl(a), a.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_md5</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2str(core_md5(str2binl(a), a.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex_hmac_md5</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2hex(core_hmac_md5(a, b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64_hmac_md5</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2b64(core_hmac_md5(a, b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_hmac_md5</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2str(core_hmac_md5(a, b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_vm_test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hex_md5(<span class="string">"abc"</span>) == <span class="string">"900150983cd24fb0d6963f7d28e17f72"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">core_md5</span>(<span class="params">p, k</span>) </span>&#123;</span><br><span class="line">    p[k &gt;&gt; <span class="number">5</span>] |= <span class="number">128</span> &lt;&lt; ((k) % <span class="number">32</span>);</span><br><span class="line">    p[(((k + <span class="number">64</span>) &gt;&gt;&gt; <span class="number">9</span>) &lt;&lt; <span class="number">4</span>) + <span class="number">14</span>] = k;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="number">1732584193</span>;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="number">-271733879</span>;</span><br><span class="line">    <span class="keyword">var</span> m = <span class="number">-1732584194</span>;</span><br><span class="line">    <span class="keyword">var</span> l = <span class="number">271733878</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0</span>; g &lt; p.length; g += <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> j = o;</span><br><span class="line">        <span class="keyword">var</span> h = n;</span><br><span class="line">        <span class="keyword">var</span> f = m;</span><br><span class="line">        <span class="keyword">var</span> e = l;</span><br><span class="line">        o = md5_ff(o, n, m, l, p[g + <span class="number">0</span>], <span class="number">7</span>, <span class="number">-680976936</span>);</span><br><span class="line">        l = md5_ff(l, o, n, m, p[g + <span class="number">1</span>], <span class="number">12</span>, <span class="number">-389564586</span>);</span><br><span class="line">        m = md5_ff(m, l, o, n, p[g + <span class="number">2</span>], <span class="number">17</span>, <span class="number">606105819</span>);</span><br><span class="line">        n = md5_ff(n, m, l, o, p[g + <span class="number">3</span>], <span class="number">22</span>, <span class="number">-1044525330</span>);</span><br><span class="line">        o = md5_ff(o, n, m, l, p[g + <span class="number">4</span>], <span class="number">7</span>, <span class="number">-176418897</span>);</span><br><span class="line">        l = md5_ff(l, o, n, m, p[g + <span class="number">5</span>], <span class="number">12</span>, <span class="number">1200080426</span>);</span><br><span class="line">        m = md5_ff(m, l, o, n, p[g + <span class="number">6</span>], <span class="number">17</span>, <span class="number">-1473231341</span>);</span><br><span class="line">        n = md5_ff(n, m, l, o, p[g + <span class="number">7</span>], <span class="number">22</span>, <span class="number">-45705983</span>);</span><br><span class="line">        o = md5_ff(o, n, m, l, p[g + <span class="number">8</span>], <span class="number">7</span>, <span class="number">1770035416</span>);</span><br><span class="line">        l = md5_ff(l, o, n, m, p[g + <span class="number">9</span>], <span class="number">12</span>, <span class="number">-1958414417</span>);</span><br><span class="line">        m = md5_ff(m, l, o, n, p[g + <span class="number">10</span>], <span class="number">17</span>, <span class="number">-42063</span>);</span><br><span class="line">        n = md5_ff(n, m, l, o, p[g + <span class="number">11</span>], <span class="number">22</span>, <span class="number">-1990404162</span>);</span><br><span class="line">        o = md5_ff(o, n, m, l, p[g + <span class="number">12</span>], <span class="number">7</span>, <span class="number">1804660682</span>);</span><br><span class="line">        l = md5_ff(l, o, n, m, p[g + <span class="number">13</span>], <span class="number">12</span>, <span class="number">-40341101</span>);</span><br><span class="line">        m = md5_ff(m, l, o, n, p[g + <span class="number">14</span>], <span class="number">17</span>, <span class="number">-1502002290</span>);</span><br><span class="line">        n = md5_ff(n, m, l, o, p[g + <span class="number">15</span>], <span class="number">22</span>, <span class="number">1236535329</span>);</span><br><span class="line">        o = md5_gg(o, n, m, l, p[g + <span class="number">1</span>], <span class="number">5</span>, <span class="number">-165796510</span>);</span><br><span class="line">        l = md5_gg(l, o, n, m, p[g + <span class="number">6</span>], <span class="number">9</span>, <span class="number">-1069501632</span>);</span><br><span class="line">        m = md5_gg(m, l, o, n, p[g + <span class="number">11</span>], <span class="number">14</span>, <span class="number">643717713</span>);</span><br><span class="line">        n = md5_gg(n, m, l, o, p[g + <span class="number">0</span>], <span class="number">20</span>, <span class="number">-373897302</span>);</span><br><span class="line">        o = md5_gg(o, n, m, l, p[g + <span class="number">5</span>], <span class="number">5</span>, <span class="number">-701558691</span>);</span><br><span class="line">        l = md5_gg(l, o, n, m, p[g + <span class="number">10</span>], <span class="number">9</span>, <span class="number">38016083</span>);</span><br><span class="line">        m = md5_gg(m, l, o, n, p[g + <span class="number">15</span>], <span class="number">14</span>, <span class="number">-660478335</span>);</span><br><span class="line">        n = md5_gg(n, m, l, o, p[g + <span class="number">4</span>], <span class="number">20</span>, <span class="number">-405537848</span>);</span><br><span class="line">        o = md5_gg(o, n, m, l, p[g + <span class="number">9</span>], <span class="number">5</span>, <span class="number">568446438</span>);</span><br><span class="line">        l = md5_gg(l, o, n, m, p[g + <span class="number">14</span>], <span class="number">9</span>, <span class="number">-1019803690</span>);</span><br><span class="line">        m = md5_gg(m, l, o, n, p[g + <span class="number">3</span>], <span class="number">14</span>, <span class="number">-187363961</span>);</span><br><span class="line">        n = md5_gg(n, m, l, o, p[g + <span class="number">8</span>], <span class="number">20</span>, <span class="number">1163531501</span>);</span><br><span class="line">        o = md5_gg(o, n, m, l, p[g + <span class="number">13</span>], <span class="number">5</span>, <span class="number">-1444681467</span>);</span><br><span class="line">        l = md5_gg(l, o, n, m, p[g + <span class="number">2</span>], <span class="number">9</span>, <span class="number">-51403784</span>);</span><br><span class="line">        m = md5_gg(m, l, o, n, p[g + <span class="number">7</span>], <span class="number">14</span>, <span class="number">1735328473</span>);</span><br><span class="line">        n = md5_gg(n, m, l, o, p[g + <span class="number">12</span>], <span class="number">20</span>, <span class="number">-1921207734</span>);</span><br><span class="line">        o = md5_hh(o, n, m, l, p[g + <span class="number">5</span>], <span class="number">4</span>, <span class="number">-378558</span>);</span><br><span class="line">        l = md5_hh(l, o, n, m, p[g + <span class="number">8</span>], <span class="number">11</span>, <span class="number">-2022574463</span>);</span><br><span class="line">        m = md5_hh(m, l, o, n, p[g + <span class="number">11</span>], <span class="number">16</span>, <span class="number">1839030562</span>);</span><br><span class="line">        n = md5_hh(n, m, l, o, p[g + <span class="number">14</span>], <span class="number">23</span>, <span class="number">-35309556</span>);</span><br><span class="line">        o = md5_hh(o, n, m, l, p[g + <span class="number">1</span>], <span class="number">4</span>, <span class="number">-1530992060</span>);</span><br><span class="line">        l = md5_hh(l, o, n, m, p[g + <span class="number">4</span>], <span class="number">11</span>, <span class="number">1272893353</span>);</span><br><span class="line">        m = md5_hh(m, l, o, n, p[g + <span class="number">7</span>], <span class="number">16</span>, <span class="number">-155497632</span>);</span><br><span class="line">        n = md5_hh(n, m, l, o, p[g + <span class="number">10</span>], <span class="number">23</span>, <span class="number">-1094730640</span>);</span><br><span class="line">        o = md5_hh(o, n, m, l, p[g + <span class="number">13</span>], <span class="number">4</span>, <span class="number">681279174</span>);</span><br><span class="line">        l = md5_hh(l, o, n, m, p[g + <span class="number">0</span>], <span class="number">11</span>, <span class="number">-358537222</span>);</span><br><span class="line">        m = md5_hh(m, l, o, n, p[g + <span class="number">3</span>], <span class="number">16</span>, <span class="number">-722881979</span>);</span><br><span class="line">        n = md5_hh(n, m, l, o, p[g + <span class="number">6</span>], <span class="number">23</span>, <span class="number">76029189</span>);</span><br><span class="line">        o = md5_hh(o, n, m, l, p[g + <span class="number">9</span>], <span class="number">4</span>, <span class="number">-640364487</span>);</span><br><span class="line">        l = md5_hh(l, o, n, m, p[g + <span class="number">12</span>], <span class="number">11</span>, <span class="number">-421815835</span>);</span><br><span class="line">        m = md5_hh(m, l, o, n, p[g + <span class="number">15</span>], <span class="number">16</span>, <span class="number">530742520</span>);</span><br><span class="line">        n = md5_hh(n, m, l, o, p[g + <span class="number">2</span>], <span class="number">23</span>, <span class="number">-995338651</span>);</span><br><span class="line">        o = md5_ii(o, n, m, l, p[g + <span class="number">0</span>], <span class="number">6</span>, <span class="number">-198630844</span>);</span><br><span class="line">        l = md5_ii(l, o, n, m, p[g + <span class="number">7</span>], <span class="number">10</span>, <span class="number">11261161415</span>);</span><br><span class="line">        m = md5_ii(m, l, o, n, p[g + <span class="number">14</span>], <span class="number">15</span>, <span class="number">-1416354905</span>);</span><br><span class="line">        n = md5_ii(n, m, l, o, p[g + <span class="number">5</span>], <span class="number">21</span>, <span class="number">-57434055</span>);</span><br><span class="line">        o = md5_ii(o, n, m, l, p[g + <span class="number">12</span>], <span class="number">6</span>, <span class="number">1700485571</span>);</span><br><span class="line">        l = md5_ii(l, o, n, m, p[g + <span class="number">3</span>], <span class="number">10</span>, <span class="number">-1894446606</span>);</span><br><span class="line">        m = md5_ii(m, l, o, n, p[g + <span class="number">10</span>], <span class="number">15</span>, <span class="number">-1051523</span>);</span><br><span class="line">        n = md5_ii(n, m, l, o, p[g + <span class="number">1</span>], <span class="number">21</span>, <span class="number">-2054922799</span>);</span><br><span class="line">        o = md5_ii(o, n, m, l, p[g + <span class="number">8</span>], <span class="number">6</span>, <span class="number">1873313359</span>);</span><br><span class="line">        l = md5_ii(l, o, n, m, p[g + <span class="number">15</span>], <span class="number">10</span>, <span class="number">-30611744</span>);</span><br><span class="line">        m = md5_ii(m, l, o, n, p[g + <span class="number">6</span>], <span class="number">15</span>, <span class="number">-1560198380</span>);</span><br><span class="line">        n = md5_ii(n, m, l, o, p[g + <span class="number">13</span>], <span class="number">21</span>, <span class="number">1309151649</span>);</span><br><span class="line">        o = md5_ii(o, n, m, l, p[g + <span class="number">4</span>], <span class="number">6</span>, <span class="number">-145523070</span>);</span><br><span class="line">        l = md5_ii(l, o, n, m, p[g + <span class="number">11</span>], <span class="number">10</span>, <span class="number">-1120210379</span>);</span><br><span class="line">        m = md5_ii(m, l, o, n, p[g + <span class="number">2</span>], <span class="number">15</span>, <span class="number">718787259</span>);</span><br><span class="line">        n = md5_ii(n, m, l, o, p[g + <span class="number">9</span>], <span class="number">21</span>, <span class="number">-343485551</span>);</span><br><span class="line">        o = safe_add(o, j);</span><br><span class="line">        n = safe_add(n, h);</span><br><span class="line">        m = safe_add(m, f);</span><br><span class="line">        l = safe_add(l, e)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>(o, n, m, l)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_cmn</span>(<span class="params">h, e, d, c, g, f</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> safe_add(bit_rol(safe_add(safe_add(e, h), safe_add(c, f)), g), d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_ff</span>(<span class="params">g, f, k, j, e, i, h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> md5_cmn((f &amp; k) | ((~f) &amp; j), g, f, e, i, h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_gg</span>(<span class="params">g, f, k, j, e, i, h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> md5_cmn((f &amp; j) | (k &amp; (~j)), g, f, e, i, h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_hh</span>(<span class="params">g, f, k, j, e, i, h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> md5_cmn(f ^ k ^ j, g, f, e, i, h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_ii</span>(<span class="params">g, f, k, j, e, i, h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> md5_cmn(k ^ (f | (~j)), g, f, e, i, h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">core_hmac_md5</span>(<span class="params">c, f</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = str2binl(c);</span><br><span class="line">    <span class="keyword">if</span> (e.length &gt; <span class="number">16</span>) &#123;</span><br><span class="line">        e = core_md5(e, c.length * chrsz)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">Array</span>(<span class="number">16</span>),</span><br><span class="line">        d = <span class="built_in">Array</span>(<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; <span class="number">16</span>; b++) &#123;</span><br><span class="line">        a[b] = e[b] ^ <span class="number">909522486</span>;</span><br><span class="line">        d[b] = e[b] ^ <span class="number">1549556828</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> g = core_md5(a.concat(str2binl(f)), <span class="number">512</span> + f.length * chrsz);</span><br><span class="line">    <span class="keyword">return</span> core_md5(d.concat(g), <span class="number">512</span> + <span class="number">128</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_add</span>(<span class="params">a, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = (a &amp; <span class="number">65535</span>) + (d &amp; <span class="number">65535</span>);</span><br><span class="line">    <span class="keyword">var</span> b = (a &gt;&gt; <span class="number">16</span>) + (d &gt;&gt; <span class="number">16</span>) + (c &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (b &lt;&lt; <span class="number">16</span>) | (c &amp; <span class="number">65535</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bit_rol</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a &lt;&lt; b) | (a &gt;&gt;&gt; (<span class="number">32</span> - b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str2binl</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">var</span> a = (<span class="number">1</span> &lt;&lt; chrsz) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; d.length * chrsz; b += chrsz) &#123;</span><br><span class="line">        c[b &gt;&gt; <span class="number">5</span>] |= (d.charCodeAt(b / chrsz) &amp; a) &lt;&lt; (b % <span class="number">32</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binl2str</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> a = (<span class="number">1</span> &lt;&lt; chrsz) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; c.length * <span class="number">32</span>; b += chrsz) &#123;</span><br><span class="line">        d += <span class="built_in">String</span>.fromCharCode((c[b &gt;&gt; <span class="number">5</span>] &gt;&gt;&gt; (b % <span class="number">32</span>)) &amp; a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binl2hex</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = hexcase ? <span class="string">"0123456789ABCDEF"</span> : <span class="string">"0123456789abcdef"</span>;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; c.length * <span class="number">4</span>; a++) &#123;</span><br><span class="line">        d += b.charAt((c[a &gt;&gt; <span class="number">2</span>] &gt;&gt; ((a % <span class="number">4</span>) * <span class="number">8</span> + <span class="number">4</span>)) &amp; <span class="number">15</span>) + b.charAt((c[a &gt;&gt; <span class="number">2</span>] &gt;&gt; ((a % <span class="number">4</span>) * <span class="number">8</span>)) &amp; <span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binl2b64</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>;</span><br><span class="line">    <span class="keyword">var</span> f = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; d.length * <span class="number">4</span>; b += <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> e = (((d[b &gt;&gt; <span class="number">2</span>] &gt;&gt; <span class="number">8</span> * (b % <span class="number">4</span>)) &amp; <span class="number">255</span>) &lt;&lt; <span class="number">16</span>) | (((d[b + <span class="number">1</span> &gt;&gt; <span class="number">2</span>] &gt;&gt; <span class="number">8</span> * ((b + <span class="number">1</span>) % <span class="number">4</span>)) &amp; <span class="number">255</span>) &lt;&lt; <span class="number">8</span>) | ((d[b + <span class="number">2</span> &gt;&gt; <span class="number">2</span>] &gt;&gt; <span class="number">8</span> * ((b + <span class="number">2</span>) % <span class="number">4</span>)) &amp; <span class="number">255</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; <span class="number">4</span>; a++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (b * <span class="number">8</span> + a * <span class="number">6</span> &gt; d.length * <span class="number">32</span>) &#123;</span><br><span class="line">                f += b64pad</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                f += c.charAt((e &gt;&gt; <span class="number">6</span> * (<span class="number">3</span> - a)) &amp; <span class="number">63</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_m_value</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//var timestamp = Date.parse(new Date()) + 100000000;</span></span><br><span class="line">timestamp = <span class="string">'1607657864000'</span></span><br><span class="line">    f = hex_md5(timestamp)</span><br><span class="line">    <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上获取m=window.f的值</p><h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><p>pip3 install PyExecJS </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span><span class="params">(page_num,parameters)</span>:</span></span><br><span class="line">    url = <span class="string">'http://match.yuanrenxue.com/api/match/1?page=&#123;&#125;&amp;m=&#123;&#125;'</span>.format(page_num,parameters)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Host'</span>: <span class="string">'match.yuanrenxue.com'</span>,</span><br><span class="line">        <span class="string">'Referer'</span>: <span class="string">'http://match.yuanrenxue.com/match/1'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'yuanrenxue.project'</span>,</span><br><span class="line">        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">        <span class="string">'Cookie'</span>: <span class="string">'qpfccr=true; Hm_lvt_c99546cf032aaa5a679230de9a95c7db=1607556997,1607557857; Hm_lpvt_c99546cf032aaa5a679230de9a95c7db=1607557857; no-alert=true'</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url=url,headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_m_value</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">r'1.js'</span>,encoding=<span class="string">'utf-8'</span>,mode=<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        JsData = f.read()</span><br><span class="line">    psd = execjs.compile(JsData).call(<span class="string">'request'</span>)</span><br><span class="line">    psd = psd.replace(<span class="string">'丨'</span>,<span class="string">'%E4%B8%A8'</span>)</span><br><span class="line">    print(<span class="string">'this request parameters is :'</span>,psd)</span><br><span class="line">    <span class="keyword">return</span> psd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    sum_num = <span class="number">0</span></span><br><span class="line">    index_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> page_num <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">6</span>):</span><br><span class="line">        res = get_page(page_num,calculate_m_value())</span><br><span class="line">        data = [__[<span class="string">'value'</span>] <span class="keyword">for</span> __ <span class="keyword">in</span> res[<span class="string">'data'</span>]]</span><br><span class="line">        print(data)</span><br><span class="line">        sum_num+=sum(data)</span><br><span class="line">        index_num += len(data)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    average = sum_num/index_num</span><br><span class="line">    print(<span class="string">'the answer is :'</span>,average)</span><br></pre></td></tr></table></figure><p>1.js中获取param的函数如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timestamp = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="number">100000000</span>;</span><br><span class="line">   <span class="comment">// timestamp = '1607657864000'</span></span><br><span class="line">    f = hex_md5(timestamp+<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">var</span> m = f;</span><br><span class="line">    m = m + <span class="string">'丨'</span> + timestamp / <span class="number">1000</span></span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客搭建</title>
      <link href="2021/01/31/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>2021/01/31/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">https://nodejs.org/download/release/v10.15.3/ 安装node</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">npm config set registry https://registry.npm.taobao.org  </span><br><span class="line">npm install -g hexo@4.1.1</span><br><span class="line">npm install -g hexo-cli@1.3.0  </span><br><span class="line">hexo init blog    </span><br><span class="line">cd blog     </span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><h1 id="Melody"><a href="#Melody" class="headerlink" title="Melody"></a>Melody</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">set http_proxy=http://127.0.0.1:1080</span><br><span class="line">set https_proxy=https://127.0.0.1:1080</span><br><span class="line">git clone -b master https://github.com/Molunerfinn/hexo-theme-melody themes/melody</span><br><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus</span><br><span class="line">cp themes\melody\_config.yml themes\melody\melody.yml  通过git pull 即可更新melody</span><br><span class="line">npm i --save hexo-wordcount</span><br><span class="line">npm i hexo-deployer-git --save </span><br><span class="line"></span><br><span class="line">使用git bash</span><br><span class="line">npm install --save-dev gulp@3.9.1</span><br><span class="line">npm install -g gulp@3.9.1</span><br><span class="line">npm install gulp-imagemin@3.1.1 --save</span><br><span class="line">npm install gulp-htmlclean gulp-htmlmin gulp-minify-css gulp-uglify --save</span><br></pre></td></tr></table></figure><p>blog\package.json</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">   "build": "hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d &amp; git add * &amp; git commit -m 'deploy' &amp; git push origin master",</span><br><span class="line">   "test": "hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo s",</span><br><span class="line">   "dev": "hexo clean &amp;&amp; hexo g &amp;&amp; hexo s"</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>通过npm run build 即可自动打包上传发布<a href="http://onejane.gitee.io/" target="_blank" rel="noopener">http://onejane.gitee.io/</a></p><p>新建Onajane公开项目，hexo d后启用服务的Gitee Pages</p><p><img src="/2021/01/31/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/gitee_page.png" alt="gitee_page"></p><p>新建picture公开项目，上传图片后启动服务的Gitee Pages图床服务，<a href="http://onejane.gitee.io/picture/avatar.jpg" target="_blank" rel="noopener">http://onejane.gitee.io/picture/avatar.jpg</a></p><p>blog_config.yml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">title: J</span><br><span class="line">subtitle: '朝花夕拾'</span><br><span class="line">description: '逆向,爬虫'</span><br><span class="line">keywords:</span><br><span class="line">author: J</span><br><span class="line">language: zh-Hans</span><br><span class="line">timezone: 'Hongkong'</span><br><span class="line">url: https://gitee.com/OneJane</span><br><span class="line">theme: melody</span><br><span class="line">post_asset_folder: true   # npm install https://github.com/CodeFalling/hexo-asset-image --save 上传图片到博客</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo:</span><br><span class="line">    gitee: https://gitee.com/OneJane/OneJane.git</span><br><span class="line">    github: git@github.com:OneJane/OneJane.github.io.git</span><br><span class="line">  branch: master</span><br><span class="line">  message: gitee</span><br></pre></td></tr></table></figure><h2 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h2><p><a href="https://leancloud.cn/dashboard/applist.html#/apps" target="_blank" rel="noopener">https://leancloud.cn/dashboard/applist.html#/apps</a>  新建应用获取AppID,AppKey</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">valine:</span><br><span class="line">  enable: true # if you want use valine,please set this value is true</span><br><span class="line">  appId:  cWLsquGr5PNi33OWXNhzerep-gzGzoHsz # leancloud application app id</span><br><span class="line">  appKey:  S35phfCSbm8dAG9LpOc5rjm3 # leancloud application app key</span><br><span class="line">  notify: false # valine mail notify (true/false) https://github.com/xCss/Valine/wiki</span><br><span class="line">  verify: false # valine verify code (true/false)</span><br><span class="line">  recordip: false # whether record commentor's ip (true/false)</span><br><span class="line">  pageSize: 10 # comment list page size</span><br><span class="line">  avatar: mm # gravatar style https://valine.js.org/#/avatar</span><br><span class="line">  lang: zh-cn # i18n: zh-cn/en</span><br><span class="line">  placeholder: 一起来吹牛逼好吗！ # valine comment input placeholder(like: Please leave your footprints )</span><br><span class="line">  guest_info: nick,mail,link #valine comment header inf</span><br></pre></td></tr></table></figure><h2 id="分享"><a href="#分享" class="headerlink" title="分享"></a>分享</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sharejs:</span><br><span class="line"> enable: true</span><br><span class="line"> disabled_sites: google,facebook</span><br></pre></td></tr></table></figure><h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><p>本地 npm install hexo-generator-search –save</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local_search:</span><br><span class="line">  enable: true # or false</span><br><span class="line">  labels:</span><br><span class="line">    input_placeholder: Search for Posts</span><br><span class="line">    hits_empty: "We didn't find any results for the search: $&#123;query&#125;" # if there are no result</span><br></pre></td></tr></table></figure><h2 id="头像"><a href="#头像" class="headerlink" title="头像"></a>头像</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avatar: http://onejane.gitee.io/picture/avatar.jpg # 网站 Logo</span><br></pre></td></tr></table></figure><h2 id="导航菜单"><a href="#导航菜单" class="headerlink" title="导航菜单"></a>导航菜单</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br><span class="line">修改source/tags/index.md</span><br><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2018-01-05 00:00:00</span><br><span class="line">type: "tags"</span><br><span class="line">---</span><br><span class="line">hexo new page categories</span><br><span class="line">修改source/categories/index.md</span><br><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2018-01-05 00:00:00</span><br><span class="line">type: "categories"</span><br><span class="line">---</span><br><span class="line">修改_config.yml</span><br><span class="line">menu:</span><br><span class="line">  主页: /</span><br><span class="line">  归档: /archives</span><br><span class="line">  标签: /tags</span><br><span class="line">  分类: /categories</span><br></pre></td></tr></table></figure><h2 id="自动节选"><a href="#自动节选" class="headerlink" title="自动节选"></a>自动节选</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto_excerpt:</span><br><span class="line">  enable: true</span><br><span class="line">  length: 150</span><br></pre></td></tr></table></figure><h2 id="顶部图"><a href="#顶部图" class="headerlink" title="顶部图"></a>顶部图</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">top_img_height: 80 </span><br><span class="line">top_img: http://onejane.gitee.io/picture/hacker.jpg   在_config.yml和文章中使用</span><br></pre></td></tr></table></figure><h2 id="打赏"><a href="#打赏" class="headerlink" title="打赏"></a>打赏</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QR_code:</span><br><span class="line">  - itemlist:</span><br><span class="line">      img: http://onejane.gitee.io/picture/alipay.png</span><br><span class="line">      text: 支付宝打赏</span><br><span class="line">  - itemlist:</span><br><span class="line">      img: http://onejane.gitee.io/picture/wx.png</span><br><span class="line">      text: 微信打赏</span><br></pre></td></tr></table></figure><h2 id="广告-音乐播放器"><a href="#广告-音乐播放器" class="headerlink" title="广告/音乐播放器"></a>广告/音乐播放器</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adv:</span><br><span class="line">  enable: true</span><br><span class="line">  info: <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">frameborder</span>=<span class="string">"no"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">marginwidth</span>=<span class="string">"center"</span> <span class="attr">marginheight</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">330</span> <span class="attr">height</span>=<span class="string">86</span> <span class="attr">src</span>=<span class="string">"//music.163.com/outchain/player?type=2&amp;id=572547816&amp;auto=1&amp;height=66"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Follow"><a href="#Follow" class="headerlink" title="Follow"></a>Follow</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">follow:</span><br><span class="line">  enable: true</span><br><span class="line">  url: 'https://gitee.com/OneJane/'</span><br><span class="line">  text: 'Follow Me'</span><br></pre></td></tr></table></figure><h2 id="友链"><a href="#友链" class="headerlink" title="友链"></a>友链</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">links_title: 友链   # 配置友链的标题文字</span><br><span class="line">links:</span><br><span class="line">  OneJane: http://onejane.gitee.io/</span><br></pre></td></tr></table></figure><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">toc:</span><br><span class="line">  enable: true # or false</span><br><span class="line">  number: true # or false. 版本v1.5.6新增</span><br><span class="line">  在文章头部加入toc_number: true</span><br></pre></td></tr></table></figure><h2 id="页脚"><a href="#页脚" class="headerlink" title="页脚"></a>页脚</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">footer_custom_text: Hi, welcome to my <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">http://onejane.gitee.io/</span>"&gt;</span>blog<span class="tag">&lt;/<span class="name">a</span>&gt;</span>!</span><br></pre></td></tr></table></figure><p>配置成hitokoto则是随机的谚语</p><h2 id="点击特效"><a href="#点击特效" class="headerlink" title="点击特效"></a>点击特效</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fireworks: true</span><br></pre></td></tr></table></figure><h2 id="彩带"><a href="#彩带" class="headerlink" title="彩带"></a>彩带</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canvas_ribbon:</span><br><span class="line">  enable: true</span><br><span class="line">  size: 150</span><br><span class="line">  alpha: 0.6</span><br><span class="line">  zIndex: -1</span><br><span class="line">  click_to_change: false</span><br></pre></td></tr></table></figure><h2 id="阅读密码"><a href="#阅读密码" class="headerlink" title="阅读密码"></a>阅读密码</h2><p>npm install –save hexo-blog-encrypt</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文中标题填入</span><br><span class="line">password: blogJ</span><br><span class="line">message: 请联系微信：codewj，获取本文密码</span><br></pre></td></tr></table></figure><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="baidu"><a href="#baidu" class="headerlink" title="baidu"></a>baidu</h3><p><a href="https://tongji.baidu.com/sc-web/10000134724/home/site/index?from=3" target="_blank" rel="noopener">https://tongji.baidu.com/sc-web/10000134724/home/site/index?from=3</a></p><p>新增网站后，获取hm.src = “<a href="https://hm.baidu.com/hm.js?***&quot;;%E4%BD%9C%E4%B8%BA%E7%99%BE%E5%BA%A6id" target="_blank" rel="noopener">https://hm.baidu.com/hm.js?***&quot;;作为百度id</a></p><h3 id="google"><a href="#google" class="headerlink" title="google"></a>google</h3><p><a href="https://analytics.google.com/analytics/web/#/a111479568p260655414/admin" target="_blank" rel="noopener">https://analytics.google.com/analytics/web/#/a111479568p260655414/admin</a></p><p>创建媒体资源-显示高级选项-创建 Universal Analytics 媒体资源，创建好后进入媒体资源设置获取跟踪ID,UA开头的就是谷歌id</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">baidu_analytics: ***</span><br><span class="line">google_analytics: ***</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向环境搭建</title>
      <link href="2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="Pixel"><a href="#Pixel" class="headerlink" title="Pixel"></a>Pixel</h1><p>玩逆向必备一台真机，那么非谷歌亲儿子莫属，模拟器缺失native/so层，属于精简版系统，故还是真机香呀。 </p><ol><li><a href="https://developers.google.com/android/images#sailfish" target="_blank" rel="noopener">官网</a>下载pixel 8.1.0<a href="https://dl.google.com/dl/android/aosp/sailfish-opm4.171019.021.d1-factory-e2315135.zip" target="_blank" rel="noopener">镜像</a>，建议刷OPM1.171019.011版本安卓8.1.0</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader 或 按住音量向下键和开机键 进入fastboot状态</span><br><span class="line">cd sailfish-opm4.171019.021.p1-factory-0bcf4315/sailfish-opm4.171019.021.p1 &amp;&amp; flash-all.sh 开始刷机</span><br></pre></td></tr></table></figure><p>设置-关于手机-版本号8下点击-进入开发者模式，进入系统-高级-打开开发者选项-USB调试 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb push Magisk-v20.4.zip /sdcard    </span><br><span class="line">adb push magisk-riru-v21.3.zip /sdcard/Download 使用magisk模块安装并重启</span><br><span class="line">adb push magisk-EdXposed-SandHook-v0.4.5.1_beta.4463.-release.zip /sdcard/Download  使用magisk模块安装并重启</span><br><span class="line">adb install EdXposedManager-4.5.7-45700-org.meowcat.edxposed.manager-release.apk    安装xposed</span><br><span class="line">adb push MagiskHidePropsConf-v5.3.4.zip /sdcard/Download   </span><br><span class="line">adb install JustTrustMePlus-debug.apk  用于结合xposed突破SSL Pinning抓包限制</span><br></pre></td></tr></table></figure><p><a href="https://dl.twrp.me/sailfish/" target="_blank" rel="noopener">twrp</a>作为第三方刷机工具，刷入Magisk，nethunter等魔改系统。</p><p><del>fastboot flash recovery <a href="https://dl.twrp.me/angler/twrp-3.3.0-0-angler.img.html" target="_blank" rel="noopener">twrp-3.3.0-0-angler.img</a></del></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line">fastboot boot twrp-3.4.0-0-sailfish.img   进入recovery mode</span><br><span class="line">install Magisk-v20.4.zip</span><br><span class="line">adb install MagiskManager-v7.5.1.apk</span><br><span class="line">settings put global captive_portal_http_url https://www.google.cn/generate_204  去除wifi上的×</span><br><span class="line">settings put global captive_portal_https_url https://www.google.cn/generate_204</span><br><span class="line">settings put global ntp_server 1.hk.pool.ntp.org  修改时区</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><blockquote><p>linux下载最新的platform-tools刷机的时候，fastboot会报各种unknow command或接近的错误，把fastboot文件替换成随着aosp一起编译出来的即可,使用自行编译的fastboot即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm ~&#x2F;Android&#x2F;Sdk&#x2F;platform-tools&#x2F;fastboot</span><br><span class="line">cp fastboot810r1 fastboot</span><br><span class="line">fastboot --version</span><br></pre></td></tr></table></figure></blockquote><p>通过wifi连接adb可实现群控<br><code>adb -s 192.168.0.104:5555 install com.ttxapps.wifiadb_2.1.3-810031745_minAPI15(nodpi)_apkmirror.com.apk</code>  安装apk</p><p><code>adb connect 192.168.0.104:5555</code>     使用adb连接手机</p><p><strong>termux</strong></p><p><code>adb -s 192.168.0.104:5555 install com.termux_92.apk</code>   adb被禁时在app端使用命令行操作</p><p><code>pkg update &amp;&amp; pkg install htop </code>   在app端安装管理进程的包</p><p><strong><del>xdebuggable</del>  &amp;&amp; XAppDebug</strong><br>启动EdXposed,搜索<del>xdebuggable</del> 和XAppDebug模块并安装开启debug apk(需要借助ssr科学上网)</p><p><strong>ro.debuggable</strong></p><p><code>adb push MagiskHidePropsConf-v5.3.4.zip /sdcard/Download</code> 并通过Magisk Manager-模块-下载-安装MagiskHidePropsConf-v5.3.4.zip</p><p>reboot-adb shell-props</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1 - Edit device fingerprint</span><br><span class="line">2 - Force BASIC key attestation</span><br><span class="line">3 - Device simulation (disabled)</span><br><span class="line">4 - Edit MagiskHide props</span><br><span class="line">5 - Add&#x2F;edit custom props</span><br><span class="line">6 - Delete prop values</span><br><span class="line">7 - Script settings</span><br><span class="line">8 - Collect logs</span><br><span class="line">u - Perform module update check</span><br><span class="line">r - Reset all options&#x2F;settings</span><br><span class="line">b - Reboot device</span><br><span class="line">e - Exit</span><br><span class="line"></span><br><span class="line">See the module readme or the</span><br><span class="line">support thread @ XDA for details.</span><br><span class="line"></span><br><span class="line">Enter your desired option: 4</span><br><span class="line"></span><br><span class="line">1 - ro.debuggable</span><br><span class="line">2 - ro.secure</span><br><span class="line">3 - ro.build.type</span><br><span class="line">4 - ro.build.tags</span><br><span class="line">5 - ro.bootmode</span><br><span class="line">6 - ro.boot.mode</span><br><span class="line">a - Change all props</span><br><span class="line">b - Go back to main menu</span><br><span class="line">e - Exit</span><br><span class="line"></span><br><span class="line">Pick several options at once by</span><br><span class="line">separating inputs with a comma.</span><br><span class="line">Example: 1,3,4</span><br><span class="line"></span><br><span class="line">See the module readme or the</span><br><span class="line">support thread @ XDA for details.</span><br><span class="line"></span><br><span class="line">Enter your desired option: 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You currently have the safe value set.</span><br><span class="line">Are you sure you want to change it to 1?</span><br><span class="line"></span><br><span class="line">Enter y(es), n(o) or e(xit): y</span><br><span class="line"></span><br><span class="line">Do you want to reboot now (y&#x2F;n)?</span><br><span class="line"></span><br><span class="line">Enter y(es), n(o) or e(xit): y</span><br></pre></td></tr></table></figure><p>getprop ro.debuggable  即可查看1,开启全局可调式</p><h1 id="Genymotion"><a href="#Genymotion" class="headerlink" title="Genymotion"></a><a href="https://dl.genymotion.com/releases/genymotion-3.1.2/genymotion-3.1.2-vbox.exe" target="_blank" rel="noopener">Genymotion</a></h1><p>安装全程开全局代理，安装nexus 5x 8.0<img src="/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/nexus_5x.png" alt="nexus_5x"><br>network mode选择Bridge或者在virtualbox中修改网络为桥接，如virtualbox网络连接里没有桥接网卡选择<br>修改D:\VirtualBox\drivers\network\netlwf\VBoxNetLwf.inf<img src="/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C.png" alt="桥接网络"><br>settings-system-Languages&amp;input-Languages-Add a language-简体中文</p><blockquote><p>adb 无法连接genymotion怎么办？</p><p>修改genymotion的settings，Use custom Android SDK tools为本地android sdk路径<br>adb kill-server + adb start-server 重启adb<br>安装wifiadb后即可，默认可以连接192网段，配置桥接，可adb connect 192.168.0.104:5555</p></blockquote><p><strong>arm桥接</strong></p><p><code>uname -a  i686</code>  查看cpu架构为x86 32位  不支持arm，需要安装<a href="https://github.com/m9rco/Genymotion_ARM_Translation/blob/master/package/Genymotion-ARM-Translation_for_8.0.zip" target="_blank" rel="noopener">arm桥</a>，直接将 Genymotion-ARM-Translation_for_8.0.zip拖入nexus 5x 8.0, 进行安装<br>adb reboot 即可安装带有arm的so的apk</p><h1 id="Kali"><a href="#Kali" class="headerlink" title="Kali"></a>Kali</h1><p><strong>别用Windows了，鲁迅曾经说过，他在逆向生涯中超过一半的苦难均由Windows赐予</strong>。</p><p>vmware<a href="https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.0-14665864.exe" target="_blank" rel="noopener">安装文件</a> 秘钥：YC34H-6WWDK-085MQ-JYPNX-NZRA2</p><p>kali-linux-2020.4-vmware-amd64.7z<a href="https://images.kali.org/virtual-images/kali-linux-2020.4-vmware-amd64.7z.torrent" target="_blank" rel="noopener">种子</a>，使用vmware打开vmx文件，配置6g内存，80g磁盘存储，网络适配选择桥接到本地网卡(虚拟网络编辑器)，默认账密：kali/kali，sudo passwd root 修改密码123456</p><p>重启后使用root登录，android-studio-ide-201.7042882-linux.tar.gz<a href="https://developer.android.google.cn/studio/#downloads" target="_blank" rel="noopener">安装包</a><br>~/.cache/vmware/drag_and_drop   定期删除拷贝的文件缓存<br><img src="/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/vm%E7%BC%93%E5%AD%98.png" alt="drag_and_drop"></p><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt update;apt install htop jnettop tmux iotop</span><br><span class="line">dpkg-reconfigure tzdata 选择Asia-Shanghai  </span><br><span class="line">apt update 更新自动同步时间</span><br><span class="line">apt install xfonts-intl-chinese 装中文字体</span><br><span class="line">apt-get install ttf-wqy-microhei</span><br><span class="line"><span class="meta">#</span><span class="bash"> nano /etc/ssh/sshd_config  开启sshd</span></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta">#</span><span class="bash"> /etc/init.d/ssh start</span></span><br></pre></td></tr></table></figure><h2 id="常用软件"><a href="#常用软件" class="headerlink" title="常用软件"></a>常用软件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar zxf android-studio-ide-201.7042882-linux.tar.gz</span><br><span class="line">cd ~/Desktop/android-studio/bin &amp;&amp; ./studio.sh 启动android studio</span><br><span class="line">ctrl+shift+t 当前窗口新建终端</span><br><span class="line">vim ~/.zshrc</span><br><span class="line">export PATH="/root/Android/Sdk/platform-tools:$PATH"  加入环境变量</span><br><span class="line">exec "$SHELL"</span><br><span class="line">dpkg -i code_1.52.1-1608136922_amd64.deb  安装vscode</span><br></pre></td></tr></table></figure><blockquote><p>as若报错<code>To build this project, accept the SDK license agreements and install the missing components？</code></p><p>执行/root/Android/Sdk/tools/bin/sdkmanager   –licenses</p></blockquote><p> <a href="https://gitee.com/Barryda/QtScrcpy" target="_blank" rel="noopener">Android设备投屏</a></p><p><a href="https://github.com/nodesource/distributions/blob/master/README.md" target="_blank" rel="noopener">NodeJs</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://deb.nodesource.com/setup_14.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">npm install --save @types/frida-gum  frida代码提示</span><br></pre></td></tr></table></figure><p>jeb-pro-3.19.1.202005071620_pwd_ilbtcdnwiuypbzeo_.7z  运行./jeb_linux.sh，输入密码：ilbtcdnwiuypbzeo，进入界面点击Manual Key Generation中间按钮获取LICENSE DATA，运行<a href="https://bbs.pediy.com/attach-download-206890-a05895160896cb2ba9fe470bca2ad5fe@m8o0Rv6sZiqL_2FTphB9Cmgg_3D_3D.htm" target="_blank" rel="noopener">jebKeygen.py </a>获取license key后输入到界面的key中，continue</p><p>Kali Linux里的as4的DDMS启动失败，原因是要用as自带的jre来启动，直接./monitor用的是Kali系统的jdk，版本太高了<code>ln -s  /root/Desktop/android-studio/jre/ /root/Android/Sdk/tools/lib/monitor-x86_64/</code>,然后通过~/Android/Sdk/tools/monitor打开ddms</p><p>vim ~/.bashrc   &amp;&amp; source ~/.bashrc</p><p><code>export PATH=$PATH:/root/Android/Sdk/platform-tools</code></p><p><strong>jdk1.8</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove openjdk-11-jre-headless:amd64</span><br><span class="line">apt-get remove openjdk-11-jre:amd64</span><br><span class="line">tar zxf jdk-8u191-linux-x64.tar.gz -C &#x2F;opt&#x2F;jdk</span><br><span class="line">vim ~&#x2F;.zshrc</span><br><span class="line">export JAVA_HOME&#x3D;&#x2F;opt&#x2F;jdk</span><br><span class="line">export CLASSPATH&#x3D;.:$&#123;JAVA_HOME&#125;&#x2F;lib</span><br><span class="line">export PATH&#x3D;&quot;&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;ndk-bundle:&#x2F;root&#x2F;Android&#x2F;Sdk&#x2F;platform-tools:$&#123;JAVA_HOME&#125;&#x2F;bin:$PATH&quot;</span><br><span class="line">source ~&#x2F;.zshrc</span><br><span class="line">update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;java java &#x2F;opt&#x2F;jdk&#x2F;bin&#x2F;java 1</span><br><span class="line">update-alternatives --install &#x2F;usr&#x2F;bin&#x2F;javac javac &#x2F;opt&#x2F;jdk&#x2F;bin&#x2F;javac 1</span><br><span class="line">update-alternatives --set java &#x2F;opt&#x2F;jdk&#x2F;bin&#x2F;java</span><br><span class="line">update-alternatives --set javac &#x2F;opt&#x2F;jdk&#x2F;bin&#x2F;javac</span><br></pre></td></tr></table></figure><p><strong>nexus 5x</strong></p><p>安装流程 twrp-&gt;SuperSu-&gt; nethunter</p><p><a href="https://www.offensive-security.com/kali-linux-nethunter-download/" target="_blank" rel="noopener">kali nethunter</a>下载nexus 5x <a href="https://images.kali.org/nethunter/nethunter-2020.4-bullhead-oreo-kalifs-full.zip" target="_blank" rel="noopener">nethunter</a>，使用投屏可变成一个迷你的linux渗透系统，通过twrp进行install ，<code>sh userinit.sh</code> 同步时间<br><img src="/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E8%BF%90%E8%A1%8Cnethunter.png" alt="运行nethunter"></p><table><thead><tr><th>tab</th><th>smali与java代码转换</th></tr></thead><tbody><tr><td>ctrl+b</td><td>下断点（注意这个必须在smali代码界面才有用）</td></tr><tr><td>esc</td><td>回退上一级引用</td></tr></tbody></table><p>activity_main.xml中配置的view组件：jeb中以十六进制存在于代码中，利用计算器的程序员模式转为十进制，jadx将该十进制存入resources.arsc，gda有APK入口直接进入MainActivity，同样以十六进制存入代码中。</p><h2 id="科学上网"><a href="#科学上网" class="headerlink" title="科学上网"></a>科学上网</h2><p>dpkg -i electron-ssr-0.2.6.deb  卸载使用-r，查询使用-l ,失败缺少包，经过<a href="https://pkgs.org/" target="_blank" rel="noopener">https://pkgs.org/</a>   查找所缺的包并安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt --fix-broken install</span><br><span class="line">apt-get install gconf2</span><br><span class="line">dpkg -i libdbusmenu-gtk4_18.10.20180917_bzr492+repack1-2_amd64.deb </span><br><span class="line">dpkg -i libindicator7_0.5.0-4_amd64.deb </span><br><span class="line">dpkg -i libappindicator1_0.4.92-8_amd64.deb</span><br><span class="line">dpkg -i electron-ssr-0.2.6.deb</span><br></pre></td></tr></table></figure><p>启动electron-ssr的pac模式即可<br>vim /etc/proxychains4.conf   通过右键复制SSR服务器订阅代理设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http 127.0.0.1 12333</span><br></pre></td></tr></table></figure><h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><table><thead><tr><th>getprop ro.product.cpu.abi</th><th>判断系统cpu版本 虚拟机一般都是x86</th></tr></thead><tbody><tr><td>dumpsys meminfo pid</td><td>查看进程占用内存映射的信息</td></tr><tr><td>cat /proc/pid/maps</td><td>进程加载的so</td></tr><tr><td>cat /proc/pid/maps | grep -i libart.so</td><td>所有java代码通过libart.so解析，脱壳机的关键</td></tr><tr><td>dumpsys activity top</td><td>显示当前的Activity，显示View Hierarchy，看view的类信息</td></tr><tr><td>dumpsys package com.soviet.hook4crawler</td><td>查看运行包信息</td></tr><tr><td>pm list packages</td><td>查看所有安装的包</td></tr></tbody></table><h2 id="pyenv环境"><a href="#pyenv环境" class="headerlink" title="pyenv环境"></a>pyenv环境</h2><p>对python不同包(frida,objection…)多版本管理</p><p>全套安装最新版本：<code>proxychains pip install objection</code></p><h3 id="3-8-5"><a href="#3-8-5" class="headerlink" title="3.8.5"></a>3.8.5</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ctrl+alt+t 新建终端</span><br><span class="line">git clone https://github.com/pyenv/pyenv.git ~/.pyenv   安装pyenv，python全版本随意切</span><br><span class="line">echo 'export PYENV_ROOT="$HOME/.pyenv"' &gt;&gt; ~/.zshrc</span><br><span class="line">echo 'export PATH="$PYENV_ROOT/bin:$PATH"' &gt;&gt; ~/.zshrc</span><br><span class="line">echo -e 'if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then\n  eval "$(pyenv init -)"\nfi' &gt;&gt; ~/.zshrc</span><br><span class="line">exec "$SHELL"</span><br><span class="line">apt-get update; apt-get install --no-install-recommends make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev</span><br><span class="line">PYTHON_CONFIGURE_OPTS="--disable-ipv6" proxychains4 pyenv install 3.8.5  使用代理访问，不然会报错you can specify "--disable-ipv6".</span><br><span class="line">pyenv local 3.8.5</span><br><span class="line">python -V</span><br><span class="line">pyenv local system  切换原系统pyenv</span><br><span class="line">pip install frida-tools</span><br><span class="line">proxychains4 pip install objection==1.9.5</span><br></pre></td></tr></table></figure><p>针对指定frida版本的objection，通过<a href="https://pypi.org/project/objection/#history" target="_blank" rel="noopener">pypi</a>中查找frida release日期稍后一点版本的objection即可<br>7x x <a href="https://github.com/frida/frida/releases/download/14.2.8/frida-server-14.2.8-android-arm64.xz" target="_blank" rel="noopener">frida-server-14.2.8-android-arm64.xz</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-14.2.8-android-arm64  /data/local/tmp</span><br><span class="line">mv frida-server-14.2.8-android-arm64 fs1428arm64 改名fs1428arm64,防止反调试</span><br><span class="line">chmod 777 fs1428arm64  加权</span><br><span class="line">./fs1428arm64</span><br><span class="line">frida-ps -U</span><br><span class="line">android hooking list classes</span><br></pre></td></tr></table></figure><p><img src="/2021/01/31/%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/objection.png" alt="objection"></p><h3 id="3-8-0"><a href="#3-8-0" class="headerlink" title="3.8.0"></a>3.8.0</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PYTHON_CONFIGURE_OPTS="--disable-ipv6" proxychains4 pyenv install 3.8.0 </span><br><span class="line">pyenv local 3.8.0 </span><br><span class="line">PYTHON_CONFIGURE_OPTS="--disable-ipv6" proxychains4 pip install frida==12.8.0</span><br><span class="line">PYTHON_CONFIGURE_OPTS="--disable-ipv6" proxychains4 pip install frida-tools==5.3.0</span><br><span class="line">PYTHON_CONFIGURE_OPTS="--disable-ipv6" proxychains4 pip install objection==1.8.4</span><br><span class="line">objection -g com.android.settings explore</span><br></pre></td></tr></table></figure><p>7z x  <a href="https://github.com/frida/frida/releases/download/12.8.0/frida-server-12.8.0-android-arm64.xz" target="_blank" rel="noopener">frida-server-12.8.0-android-arm64</a>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-12.8.0-android-arm64 /data/local/tmp</span><br><span class="line">mv frida-server-12.8.0-android-arm64 fs128arm64 改名防止反调试</span><br><span class="line">chmod 777 frida-server-12.8.0-android-arm64</span><br><span class="line">objection -g com.android.settings explore</span><br><span class="line">android hooking list classes</span><br></pre></td></tr></table></figure><p><strong>特定版本frida</strong></p><p>按照这个顺序，在装objection的时候，就会直接Requirement already satisfied，不会再去下载新的frida来安装了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install frida&#x3D;&#x3D;12.8.0 </span><br><span class="line">pip install frida-tools&#x3D;&#x3D;5.3.0 </span><br><span class="line">pip install objection&#x3D;&#x3D;1.8.4</span><br></pre></td></tr></table></figure><p><strong>frida开发环境</strong></p><p>pyenv local 3.8.0 &amp;&amp; ./fs128arm64</p><ol><li>git clone <a href="https://github.com/oleavr/frida-agent-example.git" target="_blank" rel="noopener">https://github.com/oleavr/frida-agent-example.git</a></li><li>cd frida-agent-example/ </li><li>npm install </li><li>使用VSCode等IDE打开此工程，在agent下编写typescript，会有智能提示。 </li><li>npm run watch会监控代码修改自动编译生成js文件 </li><li>frida -UF -l demo.js    usb连接手机保存将自动调用demo.js 进行hook <code>Java.perform(function(){console.log(&quot;frida hook&quot;)})  </code></li><li>frida -UF -l demo.js –runtime=v8  使用v8引擎 <code>Java.perform(()=&gt;{console.log(&quot;Hello World&quot;)})</code></li><li>frida-ps -U  查看所有进程</li><li>frida -H 192.168.0.100:5555 -f com.ttxapps.wifiadb -l demo.js –runtime=v8  远程hook,-l指定脚本</li><li>frida -Uf com.android.settings  -l demo.js –runtime=v8   –no-pause 经过usb主动启动应用调用demo.js,-f是spawn模式,–no-pause直接加载应用，没有的话需要%resume启动主线程</li><li>frida -UF –runtime=v8 -e “Java.perform(()=&gt;{console.log(‘Hello World’)})”  -o /root/log.txt  直接执行脚本写入文件</li></ol><p><strong>远程连接</strong></p><p><code>./fs128arm64 -v -l 0.0.0.0:8888</code>  指定端口启动frida，默认端口27042</p><p><code>frida-ps -H  192.168.0.8:8888</code>   指定-U表示usb,-H表示主机ip</p><p><code>frida -H 192.168.0.8:8888 -F</code>  指定-H表示主机ip，-F表示前台应用，输入frida即可查看Frida信息</p><p>cd <a href="https://github.com/oleavr/frida-agent-example.git" target="_blank" rel="noopener">frida-agent-example</a>/ &amp;&amp; npm install &amp;&amp;  npm run watch &amp;&amp; frida -H 192.168.0.8:8888 -F -l agent/demo.js  远程调用js脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(()&#x3D;&gt;&#123;console.log(&quot;Hello World&quot;)&#125;) </span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;hello&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p><strong>远程调用</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import frida</span><br><span class="line">device &#x3D; frida.get_usb_device() </span><br><span class="line">print(device.get_frontmost_application())</span><br><span class="line">#pid &#x3D; device.spawn([&quot;com.onejane.demo02&quot;])</span><br><span class="line">pid&#x3D;device.get_frontmost_application().pid  # 若双进程保护，指定pid进行hook </span><br><span class="line">print(device.enumerate_processes())   # 枚举所有进程</span><br><span class="line">print(device.enumerate_applications())  # 枚举所有包名</span><br><span class="line"># device.resume(pid)</span><br><span class="line"># time.sleep(1)</span><br><span class="line">session &#x3D; device.attach(pid) </span><br><span class="line">with open(&quot;demo.js&quot;) as f:</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.load()</span><br></pre></td></tr></table></figure><p><strong>plugins</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxychains git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;FRIDA-DEXDump ~&#x2F;Downloads&#x2F;FRIDA-DEXDump  脱壳</span><br><span class="line">mv ~&#x2F;Downloads&#x2F;FRIDA-DEXDump&#x2F;frida_dexdump ~&#x2F;.objection&#x2F;plugins&#x2F;dexdump  在plugins子目录插件下必须有__init__.py</span><br><span class="line">proxychains git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;Wallbreaker ~&#x2F;.objection&#x2F;plugins&#x2F;Wallbreaker  内存漫游</span><br><span class="line">objection -N -h 192.168.0.8 -p 8888 -g com.android.settings explore -P ~&#x2F;.objection&#x2F;plugins  远程连接批量加载插件</span><br></pre></td></tr></table></figure><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><p>pip uninstall frida</p><p>pip uninstall frida-tools</p><p>pip uninstall objection</p>]]></content>
      
      
      <categories>
          
          <category> 安卓逆向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frida </tag>
            
            <tag> objection </tag>
            
            <tag> xposed </tag>
            
            <tag> kali </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
