<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="SO逆向之小红书shield"><meta name="keywords" content="frida,ida,unidbg,frida_hook_libart,unidbg-server"><meta name="author" content="J"><meta name="copyright" content="J"><title>SO逆向之小红书shield | 万物皆可逆向</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.2.1"}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#抓包"><span class="toc-number">1.</span> <span class="toc-text">抓包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分析"><span class="toc-number">2.</span> <span class="toc-text">分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unidbg"><span class="toc-number">2.1.</span> <span class="toc-text">Unidbg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建框架"><span class="toc-number">2.1.1.</span> <span class="toc-text">搭建框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initializeNative"><span class="toc-number">2.1.2.</span> <span class="toc-text">initializeNative</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#initialize"><span class="toc-number">2.1.3.</span> <span class="toc-text">initialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#intercept"><span class="toc-number">2.1.4.</span> <span class="toc-text">intercept</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unidbg-server"><span class="toc-number">2.2.</span> <span class="toc-text">Unidbg-server</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">83</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">66</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">万物皆可逆向</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">SO逆向之小红书shield</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-24</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">3.4k</span><span class="post-meta__separator">|</span><span>阅读时长: 19 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><div id="vip-container"><h1 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h1><p>安装charles证书</p><p>安卓8</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added&#x2F;</span><br><span class="line">mount -o remount,rw &#x2F;</span><br><span class="line">mount -o remount,rw &#x2F;system</span><br><span class="line">chmod 777 *</span><br><span class="line">cp * &#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mount -o remount,ro &#x2F;</span><br><span class="line">mount -o remount,ro &#x2F;system</span><br></pre></td></tr></table></figure><p>避免SSL Pinning报错网络错误，也可以通过frida过掉SSLPinning</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224214105777.png" alt="image-20220224214105777"></p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>jadx搜索shield，没什么实际结果，大概率不在java层，<a href="https://github.com/lasting-yang/frida_hook_libart" target="_blank" rel="noopener">frida_hook_libart</a>对libart进行hook，其中<strong>hook_RegisterNatives.js</strong>动态注册jni函数，<strong>hook_art.js</strong>对常用Native方法hook</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224215953511.png" alt="image-20220224215953511"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;fs14216arm64 </span><br><span class="line">pyenv local 3.8.2</span><br><span class="line">frida --version</span><br><span class="line">   14.2.16</span><br><span class="line">frida -UF -l hook_art.js -o xhs.log</span><br></pre></td></tr></table></figure><p>由于在 <strong>NewStringUTF</strong> 函数中处理了这个shield签名，添加定位地址，修改hook_art.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">if (addrNewStringUTF !&#x3D; null) &#123;</span><br><span class="line">    Interceptor.attach(addrNewStringUTF, &#123;</span><br><span class="line">        onEnter: function (args) &#123;</span><br><span class="line">            if (args[1] !&#x3D; null) &#123;</span><br><span class="line">                var module &#x3D; Process.findModuleByAddress(this.returnAddress);</span><br><span class="line">                if (module !&#x3D; null &amp;&amp; module.name.indexOf(so_name) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                    var string &#x3D; Memory.readCString(args[1]);</span><br><span class="line">                    &#x2F;&#x2F; console.log(&quot;[NewStringUTF] bytes:&quot; + string, DebugSymbol.fromAddress(this.returnAddress));</span><br><span class="line">                    &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;xhs&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">                    if (string.length &gt; 50) &#123;</span><br><span class="line">                        console.log(&quot;[NewStringUTF] bytes:&quot; + string);</span><br><span class="line">                        console.log(&quot;xhs---------&quot;, Thread.backtrace(this.context, Backtracer.FUZZY)</span><br><span class="line">                            .map(DebugSymbol.fromAddress).join(&quot;\n&quot;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;xhs&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        onLeave: function (retval) &#123; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224214326592.png" alt="image-20220224214326592"></p><p>IDA打开libshield.so,G跳转到0x93fa8地址，看到该位置处于函数<strong>sub_939D8</strong></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224221418951.png" alt="image-20220224221418951"></p><p>F5反汇编，X查看<strong>sub_939D8</strong>方法的调用处</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224221553187.png" alt="image-20220224221553187"></p><p>可知在Java层的<strong>intercept</strong>方法，参数**(Lokhttp3/Interceptor”,0x24,”Chain;J)Lokhttp3/Response;**</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224221725263.png" alt="image-20220224221725263"></p><p>搜索<strong>intercept(</strong></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224222142075.png" alt="image-20220224222142075"></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224222423752.png" alt="image-20220224222423752"></p><p>开始hook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 干掉 Android SSL Pinning</span><br><span class="line">var array_list &#x3D; Java.use(&quot;java.util.ArrayList&quot;);</span><br><span class="line">var ApiClient &#x3D; Java.use(&#39;com.android.org.conscrypt.TrustManagerImpl&#39;);</span><br><span class="line">ApiClient.checkTrustedRecursive.implementation &#x3D; function(a1, a2, a3, a4, a5, a6) &#123; </span><br><span class="line">    var k &#x3D; array_list.$new();</span><br><span class="line">	return k; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; shield</span><br><span class="line">var shieldCls &#x3D; Java.use(&quot;com.xingin.shield.http.XhsHttpInterceptor&quot;);</span><br><span class="line">shieldCls.intercept.overload(&#39;okhttp3.Interceptor$Chain&#39;, &#39;long&#39;).implementation &#x3D; function(chain,j)&#123;</span><br><span class="line">	var result &#x3D; this.intercept(chain,j);</span><br><span class="line">	var request &#x3D; chain.request();</span><br><span class="line">	console.log(request.toString());</span><br><span class="line">	console.log(result.toString());</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; okhttp</span><br><span class="line">var OkHttpClient &#x3D; Java.use(&quot;okhttp3.OkHttpClient&quot;);</span><br><span class="line">OkHttpClient.newCall.implementation &#x3D; function (request) &#123;</span><br><span class="line">    var result &#x3D; this.newCall(request);</span><br><span class="line">    console.log(request.toString());</span><br><span class="line">    var stack &#x3D; threadinstance.currentThread().getStackTrace();</span><br><span class="line">    console.log(&quot;http &gt;&gt;&gt; Full call stack:&quot; + Where(stack));</span><br><span class="line">    return result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220224222851531.png" alt="image-20220224222851531"></p><p>这也就意味着http的请求和shield的生成都在so层完成。</p><h2 id="Unidbg"><a href="#Unidbg" class="headerlink" title="Unidbg"></a>Unidbg</h2><p>打开libshield.so，搜索java，没有函数说明都是动态注册进入JNI_OnLoad</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226104042957.png" alt="image-20220226104042957"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jint JNI_OnLoad(JavaVM *vm, void *reserved)</span><br><span class="line">&#123;</span><br><span class="line">  return sub_1027C(vm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="搭建框架"><a href="#搭建框架" class="headerlink" title="搭建框架"></a>搭建框架</h3><p>调用callJNI_OnLoad</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class XhsShield extends AbstractJni &#123;</span><br><span class="line">    private final AndroidEmulator emulator;</span><br><span class="line">    private final VM vm;</span><br><span class="line">    private final Module module;</span><br><span class="line">    private Headers headers;</span><br><span class="line">    private Request request;</span><br><span class="line">    public static String shield;</span><br><span class="line">    private String commonParams;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public XhsShield()&#123;</span><br><span class="line">        emulator &#x3D; AndroidEmulatorBuilder.for32Bit().setProcessName(&quot;com.xhs&quot;).build(); &#x2F;&#x2F; 创建模拟器实例，要模拟32位或者64位，在这里区分</span><br><span class="line">        final Memory memory &#x3D; emulator.getMemory(); &#x2F;&#x2F; 模拟器的内存操作接口</span><br><span class="line">        memory.setLibraryResolver(new AndroidResolver(23)); &#x2F;&#x2F; 设置系统类库解析</span><br><span class="line">        vm &#x3D; emulator.createDalvikVM(new File(&quot;小红书v6.73.0.apk&quot;));</span><br><span class="line">        vm.setVerbose(true);</span><br><span class="line">        vm.setJni(this);</span><br><span class="line">        DalvikModule dm &#x3D; vm.loadLibrary(new File(&quot;libshield.so&quot;), true);</span><br><span class="line">        module &#x3D; dm.getModule();</span><br><span class="line">        System.out.println(&quot;call JNIOnLoad&quot;);</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        XhsShield test &#x3D; new XhsShield();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226110431367.png" alt="image-20220226110431367"></p><h3 id="initializeNative"><a href="#initializeNative" class="headerlink" title="initializeNative"></a>initializeNative</h3><p>对jni调用java方法的一些类进行初始化操作</p><p>进入sub_1027C函数</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226104430970.png" alt="image-20220226104430970"></p><p>发现函数有很多，在IDA View-A中alt+t搜索上文中的<code>com.xingin.shield.http.XhsHttpInterceptor</code>的<code>initializeNative</code>方法</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226105749125.png" alt="image-20220226105749125"></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226105807738.png" alt="image-20220226105807738"></p><blockquote><p>.text 程序代码段内存区域<br>.data 已初始化的全局数据、全局常量段内存区域<br>.rodata 资源数据段，#define定义的常量<br>.bss 程序中未初始化的全局变量的内存区域</p></blockquote><p>直接看.data数据块中的汇编，initializeNative地址0x94288+1，intercept地址sub_939D8+1，initialize地址sub_937B0+1</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226111556828.png" alt="image-20220226111556828"></p><p>g跳转到0x94288+1，查看initializeNative函数，n重命名</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226150010437.png" alt="image-20220226150010437"></p><p>在XhsHttpInterceptor类中函数执行顺序，initializeNative&gt;initialize&gt;intercept</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226112824885.png" alt="image-20220226112824885"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void callinitializeNative()&#123;</span><br><span class="line">    List&lt;Object&gt; list &#x3D; new ArrayList&lt;&gt;(10);</span><br><span class="line">    list.add(vm.getJNIEnv()); &#x2F;&#x2F; 第一个参数是env</span><br><span class="line">    list.add(0); &#x2F;&#x2F; 第二个参数，实例方法是jobject，静态方法是jclazz，直接填0，一般用不到。</span><br><span class="line">    module.callFunction(emulator, 0x94288+1, list.toArray());</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    XhsShield test &#x3D; new XhsShield();</span><br><span class="line">    test.callinitializeNative();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226113553005.png" alt="image-20220226113553005"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; callStaticObjectMethodV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;</span><br><span class="line">    switch (signature)&#123;</span><br><span class="line">        case &quot;java&#x2F;nio&#x2F;charset&#x2F;Charset-&gt;defaultCharset()Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;&quot;:&#123;</span><br><span class="line">            return vm.resolveClass(&quot;java&#x2F;nio&#x2F;charset&#x2F;Charset&quot;).newObject(Charset.defaultCharset());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.callStaticObjectMethodV(vm, dvmClass, signature, vaList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226113820208.png" alt="image-20220226113820208"></p><p>通过objection内存搜索，是PackageInfo的一个实例变量，该类获取AndroidManifest.xml文件的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -Ua</span><br><span class="line">objection -g com.xingin.xhs explore -P ~&#x2F;.objection&#x2F;plugins</span><br><span class="line">plugin wallbreaker classdump --fullname android.content.pm.PackageInfo</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226115809498.png" alt="image-20220226115809498"></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226120639081.png" alt="image-20220226120639081"></p><p>也可以通过jnitrace获取versionCode,<code>jnitrace -l libshield.so -m spawn com.xingin.xhs --ignore-vm &gt; xhs.log</code></p><blockquote><p>jnitrace 出现app闪退或者黑屏解决方案</p><ol><li><p>更新版本pip install jnitrace==v3.0.8 ，frida==12.8.0</p></li><li><p>修改jnitrace-engine</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(dlopenRef, &#123;</span><br><span class="line">    onEnter:function(args)&#123;</span><br><span class="line">        this.path &#x3D; args[0].readCString();</span><br><span class="line">    &#125;,onLeave:function(retval)&#123;</span><br><span class="line">        if (this.path !&#x3D;&#x3D; null) &#123;</span><br><span class="line">            if (checkLibrary(this.path)) &#123;</span><br><span class="line">                trackedLibs.set(retval.toString(), true);</span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                libBlacklist.set(retval.toString(), true);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220228190245812.png" alt="image-20220228190245812"></p><p>python -m jnitrace.jnitrace -l libshield.so -b none com.xingin.xhs</p></li></ol></blockquote><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226120720392.png" alt="image-20220226120720392"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public int getIntField(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature) &#123;</span><br><span class="line">    switch (signature)&#123;</span><br><span class="line">        case &quot;android&#x2F;content&#x2F;pm&#x2F;PackageInfo-&gt;versionCode:I&quot;:&#123;</span><br><span class="line">            return 6730157;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.getIntField(vm, dvmObject, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226120944572.png" alt="image-20220226120944572"></p><p>获取静态变量，frida一步到位，<code>console.log(Java.use(&quot;com.xingin.shield.http.ContextHolder&quot;).sDeviceId.value)</code></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121315768.png" alt="image-20220226121315768"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; getStaticObjectField(BaseVM vm, DvmClass dvmClass, String signature) &#123;</span><br><span class="line">    switch (signature)&#123;</span><br><span class="line">        case &quot;com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ContextHolder-&gt;sDeviceId:Ljava&#x2F;lang&#x2F;String;&quot;:&#123;</span><br><span class="line">            return new StringObject(vm, &quot;145b5374-b973-38d1-8299-eb98f9d950ce&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.getStaticObjectField(vm, dvmClass, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121408631.png" alt="image-20220226121408631"></p><p>同理frida一步到位，<code>console.log(Java.use(&quot;com.xingin.shield.http.ContextHolder&quot;).sAppId.value)</code>,或者jnitrace</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121616078.png" alt="image-20220226121616078"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public int getStaticIntField(BaseVM vm, DvmClass dvmClass, String signature) &#123;</span><br><span class="line">    switch (signature)&#123;</span><br><span class="line">        case &quot;com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ContextHolder-&gt;sAppId:I&quot;:&#123;</span><br><span class="line">            return -319115519;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.getStaticIntField(vm, dvmClass, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121711912.png" alt="image-20220226121711912"></p><p>jnitrace或者frida一步到位</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121744091.png" alt="image-20220226121744091"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean getStaticBooleanField(BaseVM vm, DvmClass dvmClass, String signature) &#123;</span><br><span class="line">    switch (signature) &#123;</span><br><span class="line">        case &quot;com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;ContextHolder-&gt;sExperiment:Z&quot;:</span><br><span class="line">            return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.getStaticBooleanField(vm, dvmClass, signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226121902850.png" alt="image-20220226121902850"></p><h3 id="initialize"><a href="#initialize" class="headerlink" title="initialize"></a>initialize</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public XhsHttpInterceptor(String str, a&lt;Request&gt; aVar) &#123;</span><br><span class="line">    this.cPtr &#x3D; initialize(str);</span><br><span class="line">    this.predicate &#x3D; aVar;</span><br><span class="line">&#125;</span><br><span class="line">public static XhsHttpInterceptor newInstance(String str, a&lt;Request&gt; aVar) &#123;</span><br><span class="line">    return new XhsHttpInterceptor(str, aVar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在XhsHttpInterceptor的newInstance查找用例找到b函数，直接传入的字符串为”main”</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226135417525.png" alt="image-20220226135417525"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 第二个初始化函数 public native long initialize(String str);</span><br><span class="line">public long callinitialize()&#123;</span><br><span class="line">    List&lt;Object&gt; list &#x3D; new ArrayList&lt;&gt;(10);</span><br><span class="line">    list.add(vm.getJNIEnv()); &#x2F;&#x2F; 第一个参数是env</span><br><span class="line">    list.add(0); &#x2F;&#x2F; 第二个参数，实例方法是jobject，静态方法是jclazz，直接填0，一般用不到。</span><br><span class="line">    list.add(vm.addLocalObject(new StringObject(vm, &quot;main&quot;)));</span><br><span class="line">    Number number &#x3D; module.callFunction(emulator, 0x937B0+1, list.toArray())[0];</span><br><span class="line">    return number.longValue();</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    XhsShield test &#x3D; new XhsShield();</span><br><span class="line">    test.callinitializeNative();</span><br><span class="line">    long ptr &#x3D; test.callinitialize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226161022449.png" alt="image-20220226161022449"></p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226161050578.png" alt="image-20220226161050578"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; callStaticObjectMethodV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;</span><br><span class="line">    switch (signature) &#123;</span><br><span class="line">        case &quot;java&#x2F;nio&#x2F;charset&#x2F;Charset-&gt;defaultCharset()Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;&quot;: &#123;</span><br><span class="line">            return vm.resolveClass(&quot;java&#x2F;nio&#x2F;charset&#x2F;Charset&quot;).newObject(Charset.defaultCharset());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.callStaticObjectMethodV(vm, dvmClass, signature, vaList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226141612842.png" alt="image-20220226141612842"></p><p><strong>Context.getSharedPreferences(String name,int mode)**获取一个SharedPreferences实例，name文件名称，不需要加后缀.xml，一般这个文件存储在</strong>/data/data//shared_prefs**下，mode指读写权限，从jnitrace中查看jstring为0x11，jint为0，断点调试jstring就是”s”，DvmObject对象是Unidbg抽象出来的一个JNI交互的对象，给他一个这样的对象都不会报错，这个值后面要用到所以不能newObject(null)。</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226155632734.png" alt="image-20220226155632734"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;</span><br><span class="line">    switch (signature) &#123;</span><br><span class="line">        case &quot;android&#x2F;content&#x2F;Context-&gt;getSharedPreferences(Ljava&#x2F;lang&#x2F;String;I)Landroid&#x2F;content&#x2F;SharedPreferences;&quot;:</span><br><span class="line">            return vm.resolveClass(&quot;android&#x2F;content&#x2F;SharedPreferences&quot;).newObject(vaList.getObjectArg(0));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return super.callObjectMethodV(vm, dvmObject, signature, vaList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226195613330.png" alt="image-20220226195613330"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ???为什么main返回空，main_hmac返回s.xml的内容</span><br><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;</span><br><span class="line">    switch (signature) &#123;</span><br><span class="line">        &#x2F;&#x2F; android.content.SharedPreferences android.content.Context.getSharedPreferences(java.lang.String, int)</span><br><span class="line">        case &quot;android&#x2F;content&#x2F;Context-&gt;getSharedPreferences(Ljava&#x2F;lang&#x2F;String;I)Landroid&#x2F;content&#x2F;SharedPreferences;&quot;:</span><br><span class="line">            return vm.resolveClass(&quot;android&#x2F;content&#x2F;SharedPreferences&quot;).newObject(vaList.getObjectArg(0));</span><br><span class="line">        case &quot;android&#x2F;content&#x2F;SharedPreferences-&gt;getString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;lang&#x2F;String;)Ljava&#x2F;lang&#x2F;String;&quot;: &#123;</span><br><span class="line">            if(((StringObject) dvmObject.getValue()).getValue().equals(&quot;s&quot;))&#123;</span><br><span class="line">                System.out.println(&quot;getString :&quot;+vaList.getObjectArg(0).getValue());</span><br><span class="line">                if (vaList.getObjectArg(0).getValue().equals(&quot;main&quot;)) &#123;</span><br><span class="line">                    return new StringObject(vm, &quot;&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                if(vaList.getObjectArg(0).getValue().equals(&quot;main_hmac&quot;))&#123;</span><br><span class="line">                    return  new StringObject(vm, &quot;hmLDH4NVbddu&#x2F;qNZWZj80kqBVKWrexc+1w3zCF0FCNQ03x3a9o9RsHcP2e1LwpK0gPbC4nHeU9dU2d0hyOhPElbIBZlNMjj9HRCCNMmb0uRWywu1tq3IvjogrlLosRl5&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return super.callObjectMethodV(vm, dvmObject, signature, vaList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202103259.png" alt="image-20220226202103259"></p><h3 id="intercept"><a href="#intercept" class="headerlink" title="intercept"></a>intercept</h3><p>该函数中完成了请求与响应，所以必然会出现shield的生成。</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226140519884.png" alt="image-20220226140519884"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 目标函数 public Response intercept(Interceptor.Chain chain)</span><br><span class="line">public void callintercept(long ptr)&#123;</span><br><span class="line">    List&lt;Object&gt; list &#x3D; new ArrayList&lt;&gt;(10);</span><br><span class="line">    list.add(vm.getJNIEnv()); &#x2F;&#x2F; 第一个参数是env</span><br><span class="line">    list.add(0); &#x2F;&#x2F; 第二个参数，实例方法是jobject，静态方法是jclazz，直接填0，一般用不到。</span><br><span class="line">    DvmObject&lt;?&gt; chain &#x3D; vm.resolveClass(&quot;okhttp3&#x2F;Interceptor$Chain&quot;).newObject(null);</span><br><span class="line">    list.add(vm.addLocalObject(chain));</span><br><span class="line">    list.add(ptr);</span><br><span class="line">    module.callFunction(emulator, 0x939D8 + 1, list.toArray());</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; jadx中分析调用initialize得到的结果作为参数传入intercept函数中</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    XhsShield test &#x3D; new XhsShield();</span><br><span class="line">    test.callinitializeNative();</span><br><span class="line">    long ptr &#x3D; test.callinitialize();</span><br><span class="line">    test.callintercept(ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226200725718.png" alt="image-20220226200725718"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ??? request哪里来</span><br><span class="line">request &#x3D; new Request.Builder()</span><br><span class="line">        .url(&quot;https:&#x2F;&#x2F;edith.xiaohongshu.com&#x2F;api&#x2F;sns&#x2F;v6&#x2F;homefeed?oid&#x3D;homefeed_recommend&amp;cursor_score&#x3D;&amp;geo&#x3D;eyJsYXRpdHVkZSI6MC4wMDAwMDAsImxvbmdpdHVkZSI6MC4wMDAwMDB9%0A&amp;trace_id&#x3D;3eb910d5-a037-3076-92d3-739e2d02e3e0&amp;note_index&#x3D;0&amp;refresh_type&#x3D;1&amp;client_volume&#x3D;0.00&amp;preview_ad&#x3D;&amp;loaded_ad&#x3D;%7B%22ads_id_list%22%3A%5B%5D%7D&amp;personalization&#x3D;1&amp;pin_note_id&#x3D;&amp;pin_note_source&#x3D;&amp;unread_begin_note_id&#x3D;620cc5700000000021036137&amp;unread_end_note_id&#x3D;6203bff30000000021039a28&amp;unread_note_count&#x3D;6&quot;)</span><br><span class="line">        .addHeader(&quot;xy-common-params&quot;, &quot;fid&#x3D;164554128510caadf802049b8d38a1ca58cbf294b8d2&amp;device_fingerprint&#x3D;20220222224814dd7db8705f0befea0b24b13732c811a70164bde096a4c7f6&amp;device_fingerprint1&#x3D;20220222224814dd7db8705f0befea0b24b13732c811a70164bde096a4c7f6&amp;launch_id&#x3D;1645664833&amp;tz&#x3D;Asia%2FShanghai&amp;channel&#x3D;YingYongBao&amp;versionName&#x3D;6.73.0&amp;deviceId&#x3D;145b5374-b973-38d1-8299-eb98f9d950ce&amp;platform&#x3D;android&amp;sid&#x3D;session.1645766627567507884448&amp;identifier_flag&#x3D;0&amp;t&#x3D;1645784087&amp;project_id&#x3D;ECFAAF&amp;build&#x3D;6730157&amp;x_trace_page_current&#x3D;explore_feed&amp;lang&#x3D;zh-Hans&amp;app_id&#x3D;ECFAAF01&amp;uis&#x3D;light&quot;)</span><br><span class="line">        .build();</span><br><span class="line">case &quot;okhttp3&#x2F;Interceptor$Chain-&gt;request()Lokhttp3&#x2F;Request;&quot;: &#123;</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;Request&quot;).newObject(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226201514098.png" alt="image-20220226201514098"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ??? 为什么url为request的url</span><br><span class="line">case &quot;okhttp3&#x2F;Request-&gt;url()Lokhttp3&#x2F;HttpUrl;&quot;: &#123;</span><br><span class="line">    Request request &#x3D; (Request) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;HttpUrl&quot;).newObject(request.url());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202124581.png" alt="image-20220226202124581"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">case &quot;com&#x2F;xingin&#x2F;shield&#x2F;http&#x2F;Base64Helper-&gt;decode(Ljava&#x2F;lang&#x2F;String;)[B&quot;:&#123;</span><br><span class="line">    String input &#x3D; (String) vaList.getObjectArg(0).getValue();</span><br><span class="line">    byte[] result &#x3D; Base64.decodeBase64(input);</span><br><span class="line">    return new ByteArray(vm, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202629238.png" alt="image-20220226202629238"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;HttpUrl-&gt;encodedPath()Ljava&#x2F;lang&#x2F;String;&quot;: &#123;</span><br><span class="line">    HttpUrl httpUrl &#x3D; (HttpUrl) dvmObject.getValue();</span><br><span class="line">    return new StringObject(vm, httpUrl.encodedPath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202740592.png" alt="image-20220226202740592"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;HttpUrl-&gt;encodedQuery()Ljava&#x2F;lang&#x2F;String;&quot;: &#123;</span><br><span class="line">    HttpUrl httpUrl &#x3D; (HttpUrl) dvmObject.getValue();</span><br><span class="line">    return new StringObject(vm, httpUrl.encodedQuery());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202824235.png" alt="image-20220226202824235"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Request-&gt;body()Lokhttp3&#x2F;RequestBody;&quot;: &#123;</span><br><span class="line">    Request request &#x3D; (Request) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;RequestBody&quot;).newObject(request.body());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226202933455.png" alt="image-20220226202933455"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Request-&gt;headers()Lokhttp3&#x2F;Headers;&quot;: &#123;</span><br><span class="line">    Request request &#x3D; (Request) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;Headers&quot;).newObject(request.headers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203025309.png" alt="image-20220226203025309"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public DvmObject&lt;?&gt; newObjectV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;</span><br><span class="line">    switch (signature)&#123;</span><br><span class="line">        case &quot;okio&#x2F;Buffer-&gt;&lt;init&gt;()V&quot;:</span><br><span class="line">            return dvmClass.newObject(new Buffer());</span><br><span class="line">    &#125;</span><br><span class="line">    return super.newObjectV(vm, dvmClass, signature, vaList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203137691.png" alt="image-20220226203137691"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okio&#x2F;Buffer-&gt;writeString(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;nio&#x2F;charset&#x2F;Charset;)Lokio&#x2F;Buffer;&quot;: &#123;</span><br><span class="line">    System.out.println(&quot;write to my buffer:&quot;+vaList.getObjectArg(0).getValue());</span><br><span class="line">    Buffer buffer &#x3D; (Buffer) dvmObject.getValue();</span><br><span class="line">    buffer.writeString(vaList.getObjectArg(0).getValue().toString(), (Charset) vaList.getObjectArg(1).getValue());</span><br><span class="line">    return dvmObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203345411.png" alt="image-20220226203345411"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Headers-&gt;size()I&quot;:</span><br><span class="line">    Headers headers &#x3D; (Headers) dvmObject.getValue();</span><br><span class="line">    return headers.size();</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203445936.png" alt="image-20220226203445936"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Headers-&gt;name(I)Ljava&#x2F;lang&#x2F;String;&quot;: &#123;</span><br><span class="line">    Headers headers &#x3D; (Headers) dvmObject.getValue();</span><br><span class="line">    return new StringObject(vm, headers.name(vaList.getIntArg(0)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203601107.png" alt="image-20220226203601107"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Headers-&gt;value(I)Ljava&#x2F;lang&#x2F;String;&quot;: &#123;</span><br><span class="line">    Headers headers &#x3D; (Headers) dvmObject.getValue();</span><br><span class="line">    return new StringObject(vm, headers.value(vaList.getIntArg(0)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203637038.png" alt="image-20220226203637038"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;RequestBody-&gt;writeTo(Lokio&#x2F;BufferedSink;)V&quot;: &#123;</span><br><span class="line">    BufferedSink bufferedSink &#x3D; (BufferedSink) vaList.getObjectArg(0).getValue();</span><br><span class="line">    RequestBody requestBody &#x3D; (RequestBody) dvmObject.getValue();</span><br><span class="line">    if(requestBody !&#x3D; null)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            requestBody.writeTo(bufferedSink);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203830675.png" alt="image-20220226203830675"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okio&#x2F;Buffer-&gt;clone()Lokio&#x2F;Buffer;&quot;: &#123;</span><br><span class="line">    Buffer buffer &#x3D; (Buffer) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okio&#x2F;Buffer&quot;).newObject(buffer.clone());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226203908813.png" alt="image-20220226203908813"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okio&#x2F;Buffer-&gt;read([B)I&quot;:</span><br><span class="line">    Buffer buffer &#x3D; (Buffer) dvmObject.getValue();</span><br><span class="line">    return buffer.read((byte[]) vaList.getObjectArg(0).getValue());</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204002902.png" alt="image-20220226204002902"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Request-&gt;newBuilder()Lokhttp3&#x2F;Request$Builder;&quot;: &#123;</span><br><span class="line">    Request request &#x3D; (Request) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;Request$Builder&quot;).newObject(request.newBuilder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204058455.png" alt="image-20220226204058455"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Request$Builder-&gt;header(Ljava&#x2F;lang&#x2F;String;Ljava&#x2F;lang&#x2F;String;)Lokhttp3&#x2F;Request$Builder;&quot;: &#123;</span><br><span class="line">    Request.Builder builder &#x3D; (Request.Builder) dvmObject.getValue();</span><br><span class="line">    builder.header(vaList.getObjectArg(0).getValue().toString(), vaList.getObjectArg(1).getValue().toString());</span><br><span class="line">    if(&quot;shield&quot;.equals(vaList.getObjectArg(0).getValue().toString()))&#123;</span><br><span class="line">        shield &#x3D; vaList.getObjectArg(1).getValue().toString();</span><br><span class="line">    &#125;</span><br><span class="line">    return dvmObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204204774.png" alt="image-20220226204204774"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Request$Builder-&gt;build()Lokhttp3&#x2F;Request;&quot;: &#123;</span><br><span class="line">    Request.Builder builder &#x3D; (Request.Builder) dvmObject.getValue();</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;Request&quot;).newObject(builder.build());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204316786.png" alt="image-20220226204316786"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Interceptor$Chain-&gt;proceed(Lokhttp3&#x2F;Request;)Lokhttp3&#x2F;Response;&quot;: &#123;</span><br><span class="line">    return vm.resolveClass(&quot;okhttp3&#x2F;Response&quot;).newObject(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204342442.png" alt="image-20220226204342442"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">case &quot;okhttp3&#x2F;Response-&gt;code()I&quot;:</span><br><span class="line">    return 200;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204517704.png" alt="image-20220226204517704"></p><h2 id="Unidbg-server"><a href="#Unidbg-server" class="headerlink" title="Unidbg-server"></a><a href="https://github.com/cxapython/unidbg-server.git" target="_blank" rel="noopener">Unidbg-server</a></h2><p>经过一番getStaticObjectField补环境，终于拿到了shield，保存在静态变量中，引入unidbg-server</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value &#x3D; &quot;xhs&quot;, method &#x3D; &#123;RequestMethod.GET, RequestMethod.POST&#125;)</span><br><span class="line">public String xhsShield() &#123;</span><br><span class="line">    String url &#x3D; &quot;https:&#x2F;&#x2F;edith.xiaohongshu.com&#x2F;api&#x2F;sns&#x2F;v6&#x2F;homefeed?oid&#x3D;homefeed_recommend&amp;cursor_score&#x3D;&amp;geo&#x3D;eyJsYXRpdHVkZSI6MC4wMDAwMDAsImxvbmdpdHVkZSI6MC4wMDAwMDB9%0A&amp;trace_id&#x3D;3eb910d5-a037-3076-92d3-739e2d02e3e0&amp;note_index&#x3D;0&amp;refresh_type&#x3D;1&amp;client_volume&#x3D;0.00&amp;preview_ad&#x3D;&amp;loaded_ad&#x3D;%7B%22ads_id_list%22%3A%5B%5D%7D&amp;personalization&#x3D;1&amp;pin_note_id&#x3D;&amp;pin_note_source&#x3D;&amp;unread_begin_note_id&#x3D;620cc5700000000021036137&amp;unread_end_note_id&#x3D;6203bff30000000021039a28&amp;unread_note_count&#x3D;6&quot;;</span><br><span class="line">    String commonParams &#x3D; &quot;fid&#x3D;164554128510caadf802049b8d38a1ca58cbf294b8d2&amp;device_fingerprint&#x3D;20220222224814dd7db8705f0befea0b24b13732c811a70164bde096a4c7f6&amp;device_fingerprint1&#x3D;20220222224814dd7db8705f0befea0b24b13732c811a70164bde096a4c7f6&amp;launch_id&#x3D;1645664833&amp;tz&#x3D;Asia%2FShanghai&amp;channel&#x3D;YingYongBao&amp;versionName&#x3D;6.73.0&amp;deviceId&#x3D;145b5374-b973-38d1-8299-eb98f9d950ce&amp;platform&#x3D;android&amp;sid&#x3D;session.1645766627567507884448&amp;identifier_flag&#x3D;0&amp;t&#x3D;1645784087&amp;project_id&#x3D;ECFAAF&amp;build&#x3D;6730157&amp;x_trace_page_current&#x3D;explore_feed&amp;lang&#x3D;zh-Hans&amp;app_id&#x3D;ECFAAF01&amp;uis&#x3D;light&quot;;</span><br><span class="line">    String platformInfo &#x3D; &quot;platform&#x3D;android&amp;build&#x3D;6730157&amp;deviceId&#x3D;145b5374-b973-38d1-8299-eb98f9d950ce&quot;;</span><br><span class="line">    XhsShield xhs &#x3D; new XhsShield();</span><br><span class="line">    String shield &#x3D; xhs.getShield();</span><br><span class="line">    Map&lt;String, String&gt; headMap &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    headMap.put(&quot;xy-common-params&quot;,commonParams);</span><br><span class="line">    headMap.put(&quot;shield&quot;,shield);</span><br><span class="line">    headMap.put(&quot;xy-platform-info&quot;,platformInfo);</span><br><span class="line">    return httpGet(url,null, headMap);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226204843128.png" alt="image-20220226204843128"></p><blockquote><p>objection hook构造函数的方法</p><p>1.9.6版本以前/root/.pyenv/versions/3.8.0/lib/python3.8/site-packages/objection/agent.js的9211行</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226173411982.png" alt="image-20220226173411982"></p><p>1.9.6版本以后/root/.pyenv/versions/3.8.0/lib/python3.8/site-packages/objection/agent.js的20238行</p><p><img src="/2022/02/24/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%B0%8F%E7%BA%A2%E4%B9%A6shield/image-20220226173319019.png" alt="image-20220226173319019"></p></blockquote></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"25827-1638538754631-918",name:"万物皆可逆向",qrcode:"https://onejane.github.io/gzh.jpg",keyword:"密码"})}</script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2022/02/24/SO逆向之小红书shield/">http://onejane.github.io/2022/02/24/SO逆向之小红书shield/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">万物皆可逆向</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frida/">frida</a><a class="post-meta__tags" href="/tags/ida/">ida</a><a class="post-meta__tags" href="/tags/unidbg/">unidbg</a><a class="post-meta__tags" href="/tags/frida-hook-libart/">frida_hook_libart</a><a class="post-meta__tags" href="/tags/unidbg-server/">unidbg-server</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/02/28/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%94%AF%E5%93%81%E4%BC%9Aapi-sign/"><i class="fa fa-chevron-left"></i> <span>SO逆向之唯品会api_sign</span></a></div><div class="next-post pull-right"><a href="/2022/02/07/SO%E9%80%86%E5%90%91%E4%B9%8B%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84cx/"><span>SO逆向之大众点评cx</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>