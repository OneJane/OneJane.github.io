<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Xposed二进制补丁插件开发"><meta name="keywords" content="xposed"><meta name="author" content="J"><meta name="copyright" content="J"><title>Xposed二进制补丁插件开发 | 万物皆可逆向</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.2.1"}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hook"><span class="toc-number">2.</span> <span class="toc-text">Hook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#构造函数"><span class="toc-number">2.1.</span> <span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动静属性"><span class="toc-number">2.2.</span> <span class="toc-text">动静属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DexClassLoader"><span class="toc-number">2.2.1.</span> <span class="toc-text">DexClassLoader</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一般函数"><span class="toc-number">2.3.</span> <span class="toc-text">一般函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNI函数"><span class="toc-number">2.4.</span> <span class="toc-text">JNI函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#主动调用"><span class="toc-number">3.</span> <span class="toc-text">主动调用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#加壳app处理"><span class="toc-number">4.</span> <span class="toc-text">加壳app处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SO函数处理"><span class="toc-number">5.</span> <span class="toc-text">SO函数处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#32位hook"><span class="toc-number">5.1.</span> <span class="toc-text">32位hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64位hook"><span class="toc-number">5.2.</span> <span class="toc-text">64位hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主动调用-1"><span class="toc-number">5.3.</span> <span class="toc-text">主动调用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#指纹检测与定制反检测"><span class="toc-number">6.</span> <span class="toc-text">指纹检测与定制反检测</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">84</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">66</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">万物皆可逆向</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">Xposed二进制补丁插件开发</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-04</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">7.6k</span><span class="post-meta__separator">|</span><span>阅读时长: 43 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><div id="vip-container"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>Xposed是一款可以在不修改APK的情况下影响程序运行(修改系统)的框架，基于它可以制作出许多功能强大的模块，且在功能不冲突的情况下同时运作。在这个框架下，我们可以编写并加载自己编写的插件APP，实现对目标apk的注入拦截等。</p><p>原理就是控制zygote进程，通过替换/system/bin/app_process程序控制zygote进程，使得它在系统启动过程中会加载Xposed framework的一个jar文件即XposedBridge.jar，从而完成对zygote进程及其创建的Dalvik/ART虚拟机的劫持，并且能够运行开发者独立的替代任何class，例如framework本身，系统UI又或者随意的一个app。</p><p>4.4以下Android版本安装较为简单，将root后的手机安装xposedInstaller，不过官网不再维护，导致无法直接通过xposedInstaller下载补丁包。</p><p>5.0开始，谷歌使用ART替换Dalvik，xposed分为两个部分，xposed*.zip和XposedInstaller.apk，zip文件是框架主体，需要进入Recovery后刷入，apk文件是xposed模块管理应用，主要用于下载，激活，是否启用模块等管理功能。首先完成对手机root，并刷入recove(如twrp)，下载对应zip<a href="https://dl-xda.xposed.info/framework/" target="_blank" rel="noopener">补丁包</a>，进入recovery刷入，重启手机安装xposedinstaller并收入root权限。</p><p>Nexus6前arm32,后arm64</p><p><img src="/2022/05/04/Xposed%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A5%E4%B8%81%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/image-20220504174619207.png" alt="image-20220504174619207"></p><p><img src="/2022/05/04/Xposed%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A5%E4%B8%81%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/image-20220504174958428.png" alt="image-20220504174958428"></p><p>安卓8以上安装<a href="https://github.com/ElderDrivers/EdXposed/blob/master/README_CN.md" target="_blank" rel="noopener">Edxposed</a>，对于Xposed官方不支持的较新的Android版本可以先安装magisk，接着安装riru模块，最后再进行Edxposed的安装。</p><ul><li>Android Red Velvet Cake (11, sdk30)</li><li>Android Queen Cake (10, sdk29)</li><li>Android Pie (9, sdk28)</li><li>Android Oreo (8.1, sdk27)</li><li>Android Oreo (8.0, sdk26)</li></ul><p><a href="https://github.com/topjohnwu/Magisk/releases/download/v24.3/Magisk-v24.3.apk" target="_blank" rel="noopener">Magisk-v24.3.apk</a> 实现root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EdXposed-SandHook-v0.4.6.2.4529.-release.zip</span><br><span class="line">EdXposed-YAHFA-v0.4.6.2.4529.-release.zip</span><br><span class="line">EdXposedManager-4.5.7-45700-org.meowcat.edxposed.manager-release.apk</span><br><span class="line">magisk-riru-v21.1.zip</span><br><span class="line">Magisk-v20.4.zip</span><br></pre></td></tr></table></figure><h1 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h1><ol><li>拷贝XposedBridgeApi.jar到新建工程的libs目录</li><li>修改app目录下的build.gradle文件，在AndroidManifest.xml中增加Xposed相关内容</li><li>新建hook类，编写hook代码</li><li>新建assets文件夹，然后在assets目录下新建xposed_init，在里面写hook类的完整路径</li></ol><p>app/libs放入XposedBridgeApi-54.jar</p><p>app/build.gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class="line">    implementation &#39;androidx.appcompat:appcompat:1.1.0&#39;</span><br><span class="line">    implementation &#39;androidx.constraintlayout:constraintlayout:1.1.3&#39;</span><br><span class="line">    testImplementation &#39;junit:junit:4.12&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.ext:junit:1.1.1&#39;</span><br><span class="line">    androidTestImplementation &#39;androidx.test.espresso:espresso-core:3.2.0&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AndroidManifest.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;manifest xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    package&#x3D;&quot;com.kanxue.xposed01&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup&#x3D;&quot;true&quot;</span><br><span class="line">        android:icon&#x3D;&quot;@mipmap&#x2F;ic_launcher&quot;</span><br><span class="line">        android:label&#x3D;&quot;@string&#x2F;app_name&quot;</span><br><span class="line">        android:roundIcon&#x3D;&quot;@mipmap&#x2F;ic_launcher_round&quot;</span><br><span class="line">        android:supportsRtl&#x3D;&quot;true&quot;</span><br><span class="line">        android:theme&#x3D;&quot;@style&#x2F;AppTheme&quot;&gt;</span><br><span class="line">        &lt;meta-data android:name&#x3D;&quot;xposedmodule&quot; android:value&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">        &lt;meta-data android:name&#x3D;&quot;xposeddescription&quot; android:value&#x3D;&quot;第一个Xposed插件&quot;&#x2F;&gt;</span><br><span class="line">        &lt;meta-data android:name&#x3D;&quot;xposedminversion&quot; android:value&#x3D;&quot;54&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class="line">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;intent-filter&gt;</span><br><span class="line">        &lt;&#x2F;activity&gt;</span><br><span class="line">    &lt;&#x2F;application&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;manifest&gt;</span><br></pre></td></tr></table></figure><p>Xposed01.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import android.content.pm.ApplicationInfo;</span><br><span class="line">import android.telephony.TelephonyManager;</span><br><span class="line">import android.util.Log;</span><br><span class="line"></span><br><span class="line">import de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line">import de.robv.android.xposed.XC_MethodHook;</span><br><span class="line">import de.robv.android.xposed.XC_MethodReplacement;</span><br><span class="line">import de.robv.android.xposed.XposedBridge;</span><br><span class="line">import de.robv.android.xposed.XposedHelpers;</span><br><span class="line">import de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line">public class Xposed01 implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;Xposed01-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.example.test&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName);</span><br><span class="line">            XposedHelpers.findAndHookMethod(TelephonyManager.class, &quot;getDeviceId&quot;, new XC_MethodReplacement() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected Object replaceHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    return XposedBridge.invokeOriginalMethod(param.method,param.thisObject,param.args);</span><br><span class="line">                    &#x2F;&#x2F;return &quot;this is imei&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(TelephonyManager.class, &quot;getSubscriberId&quot;, new XC_MethodReplacement() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected Object replaceHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    return &quot;this is imsi&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>app/src/main/assets/xposed_init</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.kanxue.xposed01.Xposed01</span><br><span class="line">com.kanxue.xposed01.HookConstructors</span><br></pre></td></tr></table></figure><h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><p>java反射或xposed的api属性修改</p><p>HookConstructors.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">public class HookConstructors implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;Xposed01-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhook01&quot;)) &#123;</span><br><span class="line">            &#x2F;&#x2F;XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName);</span><br><span class="line"> </span><br><span class="line">			&#x2F;&#x2F; 无参构造函数</span><br><span class="line">            ClassLoader classLoader &#x3D; loadPackageParam.classLoader;</span><br><span class="line">            Class StudentClass &#x3D; classLoader.loadClass(&quot;com.kanxue.xposedhook01.Student&quot;);</span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student() is called!!beforeHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student() is called!!afterHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;    public Student(String name2) &#123;</span><br><span class="line">            &#x2F;&#x2F;        this.name &#x3D; name2;</span><br><span class="line">            &#x2F;&#x2F;        this.id &#x3D; &quot;default&quot;;</span><br><span class="line">            &#x2F;&#x2F;    &#125;</span><br><span class="line">            &#x2F;&#x2F;       public java.lang.Object thisObject;</span><br><span class="line">            &#x2F;&#x2F;        public java.lang.Object[] args;</span><br><span class="line">            &#x2F;&#x2F;        private java.lang.Object result;</span><br><span class="line">			&#x2F;&#x2F; 一个参数的构造函数</span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray &#x3D; param.args;</span><br><span class="line">                    String name &#x3D; (String) argsobjarray[0];</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String) is called!!beforeHookedMethod--&quot; + name);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String) is called!!afterHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            &#x2F;&#x2F;    public Student(String name2, String id2) &#123;</span><br><span class="line">            &#x2F;&#x2F;        this.name &#x3D; name2;</span><br><span class="line">            &#x2F;&#x2F;        this.id &#x3D; id2;</span><br><span class="line">            &#x2F;&#x2F;    &#125;</span><br><span class="line">			&#x2F;&#x2F; 两个参数的构造函数</span><br><span class="line">            XposedHelpers.findAndHookConstructor(&quot;com.kanxue.xposedhook01.Student&quot;, loadPackageParam.classLoader, String.class, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray &#x3D; param.args;</span><br><span class="line">                    String name &#x3D; (String) argsobjarray[0];</span><br><span class="line">                    String id &#x3D; (String) argsobjarray[1];</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String,String) is called!!beforeHookedMethod--&quot; + name + &quot;---&quot; + id); </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String,String) is called!!afterHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 获取属性</span><br><span class="line">            ClassLoader pathClassLoader&#x3D; loadPackageParam.classLoader;</span><br><span class="line">            final Class stuClass&#x3D;pathClassLoader.loadClass(&quot;com.kanxue.xposedhook01.Student&quot;);</span><br><span class="line">            XposedBridge.log(&quot;StudentClass-&gt;&quot;+stuClass);</span><br><span class="line">	</span><br><span class="line">			&#x2F;&#x2F; 使用java反射修改属性</span><br><span class="line">&#x2F;*            Field teacherField&#x3D;stuClass.getDeclaredField(&quot;teacher&quot;);</span><br><span class="line">            teacherField.setAccessible(true);</span><br><span class="line">            teacherField.set(null,&quot;teacher666&quot;); </span><br><span class="line">            String teachername1&#x3D; (String) teacherField.get(null); </span><br><span class="line">            XposedBridge.log(&quot;teacherField-&gt;&quot;+teachername1);*&#x2F; </span><br><span class="line">			</span><br><span class="line">			&#x2F;&#x2F; 使用Xposed的api修改属性</span><br><span class="line">            &#x2F;&#x2F;(java.lang.Class&lt;?&gt; clazz, java.lang.String fieldName, java.lang.Object value) </span><br><span class="line">            XposedHelpers.setStaticObjectField(stuClass,&quot;teacher&quot;,&quot;teacher888&quot;); </span><br><span class="line">            String teachername2&#x3D; (String) XposedHelpers.getStaticObjectField(stuClass,&quot;teacher&quot;); </span><br><span class="line">            XposedBridge.log(&quot;XposedHelpers.getStaticObjectField-&gt;&quot;+teachername2);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;public Student(String name, String id, int age, String teachername, String nickname)</span><br><span class="line">			&#x2F;&#x2F; 5个参数的构造函数</span><br><span class="line">            XposedHelpers.findAndHookConstructor(StudentClass, String.class, String.class, int.class,String.class,String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    java.lang.Object[] argsobjarray &#x3D; param.args;</span><br><span class="line">                    String name &#x3D; (String) argsobjarray[0];</span><br><span class="line">                    String id &#x3D; (String) argsobjarray[1];</span><br><span class="line">                    int age &#x3D; (int) (argsobjarray[2]);</span><br><span class="line">                    </span><br><span class="line">                    argsobjarray[1] &#x3D; &quot;2050&quot;;  &#x2F;&#x2F; 修改值</span><br><span class="line">                    argsobjarray[2] &#x3D; 100;</span><br><span class="line"></span><br><span class="line">                    String teacher&#x3D; (String) argsobjarray[3];</span><br><span class="line">                    String nickname&#x3D; (String) argsobjarray[4]; </span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String,String) is called!!beforeHookedMethod--&quot; + name + &quot;---&quot; + id + &quot;--&quot; + age+&quot;---&quot;+teacher+&quot;---&quot;+nickname);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param); </span><br><span class="line">                    Object thisobj &#x3D; param.thisObject; </span><br><span class="line">             &#x2F;*       Field nicknameField&#x3D;stuClass.getDeclaredField(&quot;nickname&quot;);</span><br><span class="line">                    XposedBridge.log(stuClass+&quot;--nicknameField-&gt;&quot;+nicknameField);</span><br><span class="line">                    nicknameField.setAccessible(true);</span><br><span class="line">                    nicknameField.set(thisobj,&quot;bear&quot;);*&#x2F;</span><br><span class="line"></span><br><span class="line">                    XposedHelpers.setObjectField(thisobj,&quot;nickname&quot;,&quot;chick&quot;); </span><br><span class="line">                    Object returnobj &#x3D; param.getResult();</span><br><span class="line">                    XposedBridge.log(thisobj + &quot;---&quot; + returnobj);</span><br><span class="line">                    XposedBridge.log(&quot;com.kanxue.xposedhook01.Student(String,String,int) is called!!afterHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="动静属性"><a href="#动静属性" class="headerlink" title="动静属性"></a>动静属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class HookFlag implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;HookFlag&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;HookFlag-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedflag&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot;HookFlag &quot; + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 修改静态属性</span><br><span class="line">            ClassLoader classLoader&#x3D;loadPackageParam.classLoader; </span><br><span class="line">            Class Flag1Class&#x3D;classLoader.loadClass(&quot;com.kanxue.xposedflag.Flag1&quot;);</span><br><span class="line">            XposedHelpers.setStaticIntField(Flag1Class,&quot;length&quot;,8);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 修改Flag2的flag动态属性为123456</span><br><span class="line">            XposedHelpers.findAndHookConstructor(&quot;com.kanxue.xposedflag.Flag2&quot;, classLoader, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;go into com.kanxue.xposedflag.Flag2()-&gt;beforeHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;leave com.kanxue.xposedflag.Flag2()-&gt;afterHookedMethod&quot;); </span><br><span class="line">                    Object Flag2obj&#x3D;param.thisObject;</span><br><span class="line">                    XposedHelpers.setObjectField(Flag2obj,&quot;flag&quot;,&quot;12345678&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DexClassLoader"><a href="#DexClassLoader" class="headerlink" title="DexClassLoader"></a>DexClassLoader</h3><p>Xposed不止可以实现对app自己试下拿到类构造函数hook，对于系统框架层的java函数可以进行hook，Hook所有classLoader包括加载dex中的，并打印这些classLoader中的类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">public class HookDexClassLoader implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;HookDexClassLoader&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;HookDexClassLoader-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.loaddex&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;public DexClassLoader(String dexPath, String optimizedDirectory,</span><br><span class="line">            &#x2F;&#x2F;            String librarySearchPath, ClassLoader parent) &#123;</span><br><span class="line">            &#x2F;&#x2F;        super(dexPath, null, librarySearchPath, parent);</span><br><span class="line">            &#x2F;&#x2F;    &#125;</span><br><span class="line">            XposedHelpers.findAndHookConstructor(DexClassLoader.class, String.class, String.class, String.class, ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object array[]&#x3D;param.args;</span><br><span class="line">                    String dexpath&#x3D; (String) array[0];</span><br><span class="line">                    String optimizedDirectory&#x3D; (String) array[1];</span><br><span class="line">                    String librarySearchPath&#x3D; (String) array[2];</span><br><span class="line">                    XposedBridge.log(&quot;DexClassLoader beforeHookedMethod:&quot;+dexpath+&quot;---&quot;+optimizedDirectory+&quot;---&quot;+librarySearchPath);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param); </span><br><span class="line">                    DexClassLoader dexClassLoader&#x3D; (DexClassLoader) param.thisObject;</span><br><span class="line">                    XposedBridge.log(&quot;DexClassLoader afterHookedMethod:&quot;+dexClassLoader);</span><br><span class="line">                    GetClassLoaderClasslist(dexClassLoader);</span><br><span class="line">                    &#x2F;&#x2F; 指定classLoader</span><br><span class="line">					XposedHelpers.findAndHookMethod(&quot;com.kanxue.test02.TestClass&quot;, dexClassLoader, &quot;testcontent&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">						@Override</span><br><span class="line">						protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">							super.beforeHookedMethod(param);</span><br><span class="line">							Object[] objectarray &#x3D; param.args;</span><br><span class="line">							String arg0 &#x3D; (String) objectarray[0]; </span><br><span class="line">							XposedBridge.log(&quot;beforeHookedMethod11 privatefunc-&gt;arg0:&quot; + arg0);</span><br><span class="line">						&#125;</span><br><span class="line">						@Override</span><br><span class="line">						protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">							super.afterHookedMethod(param);</span><br><span class="line">							&#x2F;&#x2F; String result &#x3D; (String) param.getResult();</span><br><span class="line">							&#x2F;&#x2F; XposedBridge.log(&quot;afterHookedMethod11 privatefunc-&gt;result:&quot; + result);</span><br><span class="line">							param.setResult(true);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="一般函数"><a href="#一般函数" class="headerlink" title="一般函数"></a>一般函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">public class HookJavaFunction implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;HookJava-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhook01&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName); </span><br><span class="line">            ClassLoader classLoader &#x3D; loadPackageParam.classLoader;</span><br><span class="line"></span><br><span class="line">            XposedBridge.log(&quot;loadPackageParam.classLoader-&gt;&quot; + classLoader); </span><br><span class="line">            Class StuClass &#x3D; classLoader.loadClass(&quot;com.kanxue.xposedhook01.Student&quot;); </span><br><span class="line">&#x2F;&#x2F;            public static String publicstaticfunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                String result &#x3D; privatestaticfunc(&quot;privatestaticfunc&quot;, 200);</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2 + &quot;---&quot; + result;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;			公有函数的hook与修改    </span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, &quot;publicstaticfunc&quot;, String.class, int.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray&#x3D;param.args;</span><br><span class="line">                    String arg0&#x3D; (String) objectarray[0];</span><br><span class="line">                    int arg1&#x3D; (int) objectarray[1];</span><br><span class="line">                    objectarray[0]&#x3D;&quot;changedbyxposedjava&quot;;</span><br><span class="line">                    objectarray[1]&#x3D;888;</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod publicstaticfunc-&gt;arg0:&quot;+arg0+&quot;---arg1:&quot;+arg1);</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    String result&#x3D; (String) param.getResult();</span><br><span class="line">                    param.setResult(&quot;changedbyxposed-&gt;afterHookedMethod&quot;);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod publicstaticfunc-&gt;result:&quot;+result);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#x2F;&#x2F;			私有函数的hook与修改			</span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, &quot;privatestaticfunc&quot;, String.class, int.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray &#x3D; param.args;</span><br><span class="line">                    String arg0 &#x3D; (String) objectarray[0];</span><br><span class="line">                    int arg1 &#x3D; (int) objectarray[1];</span><br><span class="line">                    objectarray[0] &#x3D; &quot;changedbyxposedjava&quot;;</span><br><span class="line">                    objectarray[1] &#x3D; 888;</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod privatestaticfunc-&gt;arg0:&quot; + arg0 + &quot;---arg1:&quot; + arg1);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    String result &#x3D; (String) param.getResult();</span><br><span class="line">                    param.setResult(&quot;changedbyxposed-&gt;afterHookedMethod&quot;);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod privatestaticfunc-&gt;result:&quot; + result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#x2F;&#x2F;            private static String privatestaticfunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2;</span><br><span class="line">&#x2F;&#x2F;            &#125; </span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, &quot;publicfunc&quot;, String.class, int.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray &#x3D; param.args;</span><br><span class="line">                    String arg0 &#x3D; (String) objectarray[0];</span><br><span class="line">                    int arg1 &#x3D; (int) objectarray[1];</span><br><span class="line">                    objectarray[0] &#x3D; &quot;changedbyxposedjava&quot;;</span><br><span class="line">                    objectarray[1] &#x3D; 888;</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod publicfunc-&gt;arg0:&quot; + arg0 + &quot;---arg1:&quot; + arg1);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    String result &#x3D; (String) param.getResult();</span><br><span class="line">                    param.setResult(&quot;changedbyxposed-&gt;afterHookedMethod&quot;);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod publicfunc-&gt;result:&quot; + result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#x2F;&#x2F;            private String privatefunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 指定classLoader</span><br><span class="line">            XposedHelpers.findAndHookMethod(&quot;com.kanxue.xposedhook01.Student&quot;, loadPackageParam.classLoader, &quot;privatefunc&quot;, String.class, int.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object[] objectarray &#x3D; param.args;</span><br><span class="line">                    String arg0 &#x3D; (String) objectarray[0];</span><br><span class="line">                    int arg1 &#x3D; (int) objectarray[1];</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod11 privatefunc-&gt;arg0:&quot; + arg0 + &quot;---arg1:&quot; + arg1);</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    String result &#x3D; (String) param.getResult();</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod11 privatefunc-&gt;result:&quot; + result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#x2F;&#x2F;			内部类，匿名内部类$1,$2...			</span><br><span class="line">            Class personClass &#x3D; XposedHelpers.findClass(&quot;com.kanxue.xposedhook01.Student$person&quot;, loadPackageParam.classLoader);</span><br><span class="line">            XposedHelpers.findAndHookMethod(personClass, &quot;getpersonname&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod getpersonname-&gt;&quot; + param.args[0]);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod getpersonname-&gt;&quot; + param.getResult());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#x2F;&#x2F;    public static java.lang.Class&lt;?&gt; findClass(java.lang.String className, java.lang.ClassLoader classLoader)</span><br><span class="line">            &#x2F;&#x2F;Class StuClassByXposed&#x3D;XposedHelpers.findClass(&quot;com.kanxue.xposedhook01.Student&quot;,classLoader);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JNI函数"><a href="#JNI函数" class="headerlink" title="JNI函数"></a>JNI函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class HookJni implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;HookJava-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.loaddex&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">            Class MainActivityClass&#x3D;XposedHelpers.findClass(&quot;com.kanxue.loaddex.MainActivity&quot;,loadPackageParam.classLoader);</span><br><span class="line"></span><br><span class="line">            XposedHelpers.findAndHookMethod(MainActivityClass, &quot;onCreate&quot;, Bundle.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod onCreate-&gt;&quot;+param.args[0]);</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod onCreate-&gt;&quot;+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            XposedHelpers.findAndHookMethod(MainActivityClass, &quot;replaceClassloader&quot;, ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;beforeHookedMethod replaceClassloader-&gt;Classloader:&quot;+param.args[0]);</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;afterHookedMethod replaceClassloader-&gt;&quot;+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h1><p>对于类中的静态函数，直接调用即可。对于非静态函数，需要先得到类的实例，才能完成调用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">public class HookActiveInvoke implements IXposedHookLoadPackage &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;XposedActiveInvoke&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;XposedActiveInvoke-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhook01&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 主动调用</span><br><span class="line">&#x2F;&#x2F;            public static String publicstaticfunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                String result &#x3D; privatestaticfunc(&quot;privatestaticfunc&quot;, 200);</span><br><span class="line">&#x2F;&#x2F;                Log.i(&quot;Xposed&quot;,&quot;publicstaticfunc is called!&quot;);</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2 + &quot;---&quot; + result;</span><br><span class="line">&#x2F;&#x2F;            &#125; </span><br><span class="line">			&#x2F;&#x2F; 反射调用 </span><br><span class="line">            ClassLoader classLoader &#x3D; loadPackageParam.classLoader;</span><br><span class="line">            Class StuClass &#x3D; classLoader.loadClass(&quot;com.kanxue.xposedhook01.Student&quot;);</span><br><span class="line">            Method publicstaticfunc_method &#x3D; StuClass.getDeclaredMethod(&quot;publicstaticfunc&quot;, String.class, int.class);</span><br><span class="line">            publicstaticfunc_method.invoke(null, &quot;InvokedByXposed&quot;, 100);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; api调用静态函数</span><br><span class="line">            java.lang.Class&lt;?&gt;[] parameterTypes &#x3D; &#123;String.class, int.class&#125;;</span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, &quot;publicstaticfunc&quot;, parameterTypes, &quot;publicstaticfunc is called by XposedHelpers.callStaticMethod11&quot;, 100);</span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, &quot;publicstaticfunc&quot;, &quot;publicstaticfunc is called by XposedHelpers.callStaticMethod22&quot;, 200);</span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, &quot;privatestaticfunc&quot;, parameterTypes, &quot;privatestaticfunc is called by XposedHelpers.callStaticMethod11&quot;, 400);</span><br><span class="line">            XposedHelpers.callStaticMethod(StuClass, &quot;privatestaticfunc&quot;, &quot;privatestaticfunc is called by XposedHelpers.callStaticMethod22&quot;, 300);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 反射调用静态函数</span><br><span class="line">            Method privatestaticfunc_method &#x3D; StuClass.getDeclaredMethod(&quot;privatestaticfunc&quot;, String.class, int.class);</span><br><span class="line">            privatestaticfunc_method.setAccessible(true);</span><br><span class="line">            String result &#x3D; (String) privatestaticfunc_method.invoke(null, &quot;privatestaticfuncIsInvokedByXposed&quot;, 200);</span><br><span class="line">            XposedBridge.log(&quot;privatestaticfuncIsInvokedByXposed-&gt;result:&quot; + result);</span><br><span class="line">&#x2F;&#x2F;            private static String privatestaticfunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                Log.i(&quot;Xposed&quot;,&quot;privatestaticfunc is called!&quot;);</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">			&#x2F;&#x2F; api调用动态函数</span><br><span class="line">            Object StuObjByXposed &#x3D; XposedHelpers.newInstance(StuClass, &quot;StuObjByXposed.newInstance&quot;, &quot;500&quot;);</span><br><span class="line">            String result1 &#x3D; (String) XposedHelpers.callMethod(StuObjByXposed, &quot;publicfunc&quot;, &quot;publicfunc is called by XposedHelpers.callMethod&quot;, 125);</span><br><span class="line">            XposedBridge.log(&quot;publicfunc XposedHelpers.callMethod result-&gt;&quot; + result1); </span><br><span class="line">            XposedHelpers.callMethod(StuObjByXposed, &quot;privatefunc&quot;, &quot;privatefunc is called by XposedHelpers.callMethod&quot;, 130);</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 反射调用动态函数</span><br><span class="line">            Method publicfunc_method &#x3D; StuClass.getDeclaredMethod(&quot;publicfunc&quot;, String.class, int.class); </span><br><span class="line">&#x2F;&#x2F;             public Student(String name, String id) &#123;</span><br><span class="line">&#x2F;&#x2F;                this.name &#x3D; name;</span><br><span class="line">&#x2F;&#x2F;                this.id &#x3D; id;</span><br><span class="line">&#x2F;&#x2F;            &#125; </span><br><span class="line">            &#x2F;&#x2F; public Student(String name, String id)  调用构造函数获得对象 反射主动调用</span><br><span class="line">            Constructor StuCon &#x3D; StuClass.getDeclaredConstructor(String.class, String.class);</span><br><span class="line">            Object StuObj &#x3D; StuCon.newInstance(&quot;InstanceByXposed&quot;, &quot;300&quot;);</span><br><span class="line">            publicfunc_method.invoke(StuObj, &quot;publicfuncInvokedByXposed&quot;, 100);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;            public String publicfunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                String result &#x3D; privatefunc(&quot;privatefunc&quot;, 300);</span><br><span class="line">&#x2F;&#x2F;                Log.i(&quot;Xposed&quot;,&quot;publicfunc is called!&quot;+&quot;---&quot;+arg1+&quot;---&quot;+arg2);</span><br><span class="line">&#x2F;&#x2F;                person tmp&#x3D;new person();</span><br><span class="line">&#x2F;&#x2F;                String tmpresult&#x3D;tmp.getpersonname(&quot;person&quot;);</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2 + &quot;---&quot; + result+&quot;---&quot;+tmpresult;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">            Method privatefunc_method &#x3D; StuClass.getDeclaredMethod(&quot;privatefunc&quot;, String.class, int.class);</span><br><span class="line">            privatefunc_method.setAccessible(true);</span><br><span class="line">            String privatefunc_result &#x3D; (String) privatefunc_method.invoke(StuObj, &quot;privatefuncInvokedByXposed&quot;, 200);</span><br><span class="line">            XposedBridge.log(&quot;privatefunc activeInvokeByXposed--&gt;&quot; + privatefunc_result);</span><br><span class="line">&#x2F;&#x2F;            private String privatefunc(String arg1, int arg2) &#123;</span><br><span class="line">&#x2F;&#x2F;                Log.i(&quot;Xposed&quot;,&quot;privatefunc is called!&quot;+&quot;---&quot;+arg1+&quot;---&quot;+arg2);</span><br><span class="line">&#x2F;&#x2F;                return arg1 + &quot;---&quot; + arg2;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;Student cstudent &#x3D; new Student(&quot;xiaohua&quot;, &quot;2020&quot;);</span><br><span class="line">			&#x2F;&#x2F; hook 构造函数</span><br><span class="line">            XposedHelpers.findAndHookConstructor(StuClass, String.class, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;Student(String,String) is called beforeHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;Student(String,String) is called afterHookedMethod&quot;);</span><br><span class="line">                    Object cstudent&#x3D;param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(cstudent,&quot;publicfunc&quot;,&quot;publicfunc is called XposedHelpers.findAndHookConstructor&quot;,666);</span><br><span class="line">                    XposedHelpers.callMethod(cstudent,&quot;privatefunc&quot;,&quot;privatefunc is called XposedHelpers.findAndHookConstructor&quot;,888);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;            public String getNickname() &#123;</span><br><span class="line">&#x2F;&#x2F;                return nickname;</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">			&#x2F;&#x2F; hook 普通函数</span><br><span class="line">            XposedHelpers.findAndHookMethod(StuClass, &quot;getNickname&quot;, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    Object obj&#x3D;param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(obj,&quot;publicfunc&quot;,&quot;beforeHookedMethod publicfunc is called XposedHelpers.callMethod&quot;,444);</span><br><span class="line">                    XposedHelpers.callMethod(obj,&quot;privatefunc&quot;,&quot;beforeHookedMethod privatefunc is called XposedHelpers.callMethod&quot;,333);</span><br><span class="line">                    XposedBridge.log(&quot;getNickname is called beforeHookedMethod-&gt;&quot;+obj);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    Object obj&#x3D;param.thisObject;</span><br><span class="line">                    XposedHelpers.callMethod(obj,&quot;publicfunc&quot;,&quot;afterHookedMethod publicfunc is called XposedHelpers.callMethod&quot;,222);</span><br><span class="line">                    XposedHelpers.callMethod(obj,&quot;privatefunc&quot;,&quot;afterHookedMethod privatefunc is called XposedHelpers.callMethod&quot;,111);</span><br><span class="line">                    XposedBridge.log(&quot;getNickname is called afterHookedMethod-&gt;&quot;+param.thisObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="加壳app处理"><a href="#加壳app处理" class="headerlink" title="加壳app处理"></a>加壳app处理</h1><p>类不在classLoader中，在自定义的Application中的attachBaseContext和onCreate中完成dex的解密和classLoader修正。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">public class HookJava implements IXposedHookLoadPackage &#123;</span><br><span class="line">    public static Field getClassField(ClassLoader classloader, String class_name, String filedName) &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Class obj_class &#x3D; classloader.loadClass(class_name);&#x2F;&#x2F;Class.forName(class_name);</span><br><span class="line">            Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(true);</span><br><span class="line">            return field;</span><br><span class="line">        &#125; catch (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object getClassFieldObject(ClassLoader classloader, String class_name, Object obj, String filedName) &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Class obj_class &#x3D; classloader.loadClass(class_name);&#x2F;&#x2F;Class.forName(class_name);</span><br><span class="line">            Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(true);</span><br><span class="line">            Object result &#x3D; null;</span><br><span class="line">            result &#x3D; field.get(obj);</span><br><span class="line">            return result;</span><br><span class="line">        &#125; catch (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object invokeStaticMethod(String class_name, String method_name, Class[] pareTyple, Object[] pareVaules) &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            Class obj_class &#x3D; Class.forName(class_name);</span><br><span class="line">            Method method &#x3D; obj_class.getMethod(method_name, pareTyple);</span><br><span class="line">            return method.invoke(null, pareVaules);</span><br><span class="line">        &#125; catch (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Object getFieldOjbect(String class_name, Object obj, String filedName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Class obj_class &#x3D; Class.forName(class_name);</span><br><span class="line">            Field field &#x3D; obj_class.getDeclaredField(filedName);</span><br><span class="line">            field.setAccessible(true);</span><br><span class="line">            return field.get(obj);</span><br><span class="line">        &#125; catch (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalArgumentException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NullPointerException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 获取当前classLoader</span><br><span class="line">    public static ClassLoader getClassloader() &#123;</span><br><span class="line">        ClassLoader resultClassloader &#x3D; null;</span><br><span class="line">        Object currentActivityThread &#x3D; invokeStaticMethod( &quot;android.app.ActivityThread&quot;, &quot;currentActivityThread&quot;, new Class[]&#123;&#125;, new Object[]&#123;&#125;);</span><br><span class="line">        Object mBoundApplication &#x3D; getFieldOjbect( &quot;android.app.ActivityThread&quot;, currentActivityThread, &quot;mBoundApplication&quot;);</span><br><span class="line">        Application mInitialApplication &#x3D; (Application) getFieldOjbect(&quot;android.app.ActivityThread&quot;, currentActivityThread, &quot;mInitialApplication&quot;);</span><br><span class="line">        Object loadedApkInfo &#x3D; getFieldOjbect( &quot;android.app.ActivityThread$AppBindData&quot;, mBoundApplication, &quot;info&quot;);</span><br><span class="line">        Application mApplication &#x3D; (Application) getFieldOjbect(&quot;android.app.LoadedApk&quot;, loadedApkInfo, &quot;mApplication&quot;);</span><br><span class="line">        resultClassloader &#x3D; mApplication.getClassLoader();</span><br><span class="line">        return resultClassloader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; 打印classLoader中所有的类</span><br><span class="line">    public void GetClassLoaderClasslist(ClassLoader classLoader) &#123;</span><br><span class="line">        &#x2F;&#x2F;private final DexPathList pathList;</span><br><span class="line">        XposedBridge.log(&quot;start dealwith classloader:&quot; + classLoader);</span><br><span class="line">        Object pathListObj &#x3D; XposedHelpers.getObjectField(classLoader, &quot;pathList&quot;);</span><br><span class="line">        &#x2F;&#x2F;private final Element[] dexElements;</span><br><span class="line">        Object[] dexElementsObj &#x3D; (Object[]) XposedHelpers.getObjectField(pathListObj, &quot;dexElements&quot;);</span><br><span class="line">        for (Object i : dexElementsObj) &#123;</span><br><span class="line">            &#x2F;&#x2F;private final DexFile dexFile;</span><br><span class="line">            Object dexFileObj &#x3D; XposedHelpers.getObjectField(i, &quot;dexFile&quot;);</span><br><span class="line">            &#x2F;&#x2F;private Object mCookie;</span><br><span class="line">            Object mCookieObj &#x3D; XposedHelpers.getObjectField(dexFileObj, &quot;mCookie&quot;);</span><br><span class="line">            &#x2F;&#x2F;private static native String[] getClassNameList(Object cookie);</span><br><span class="line">            &#x2F;&#x2F;    public static java.lang.Object callStaticMethod(java.lang.Class&lt;?&gt; clazz, java.lang.String methodName, java.lang.Object... args) &#123; &#x2F;* compiled code *&#x2F; &#125;</span><br><span class="line">            Class DexFileClass &#x3D; XposedHelpers.findClass(&quot;dalvik.system.DexFile&quot;, classLoader);</span><br><span class="line"></span><br><span class="line">            String[] classlist &#x3D; (String[]) XposedHelpers.callStaticMethod(DexFileClass, &quot;getClassNameList&quot;, mCookieObj);</span><br><span class="line">            for (String classname : classlist) &#123;</span><br><span class="line">                XposedBridge.log(dexFileObj + &quot;---&quot; + classname);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedBridge.log(&quot;end dealwith classloader:&quot; + classLoader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">        XposedBridge.log(&quot;HookJava-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">        if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhook01&quot;)) &#123;</span><br><span class="line">            XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName);</span><br><span class="line">            ClassLoader classLoader &#x3D; loadPackageParam.classLoader;</span><br><span class="line">            XposedBridge.log(&quot;loadPackageParam.classLoader-&gt;&quot; + classLoader);</span><br><span class="line">&#x2F;*</span><br><span class="line">            01-09 05:26:25.678 29011-29011&#x2F;? I&#x2F;Xposed: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file &quot;&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk&quot;],nativeLibraryDirectories&#x3D;[&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;lib&#x2F;arm, &#x2F;vendor&#x2F;lib, &#x2F;system&#x2F;lib]]]</span><br><span class="line">            01-09 05:26:25.679 29011-29011&#x2F;? I&#x2F;Xposed: start dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file &quot;&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk&quot;],nativeLibraryDirectories&#x3D;[&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;lib&#x2F;arm, &#x2F;vendor&#x2F;lib, &#x2F;system&#x2F;lib]]]</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.Configuration</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.DtcLoader</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.QHDialog</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.ᵢˋ</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.ᵢˎ</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.qihoo.util.ᵢˏ</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: &#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk---com.stub.StubApp</span><br><span class="line">            01-09 05:26:25.681 29011-29011&#x2F;? I&#x2F;Xposed: end dealwith classloader:dalvik.system.PathClassLoader[DexPathList[[zip file &quot;&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk&quot;],nativeLibraryDirectories&#x3D;[&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;lib&#x2F;arm, &#x2F;vendor&#x2F;lib, &#x2F;system&#x2F;lib]]]</span><br><span class="line">*&#x2F;</span><br><span class="line">            GetClassLoaderClasslist(classLoader);</span><br><span class="line">            ClassLoader parent &#x3D; classLoader.getParent();</span><br><span class="line">			&#x2F;&#x2F; 将当前classLoader双亲委派模型打印</span><br><span class="line">            while (parent !&#x3D; null) &#123;</span><br><span class="line">                XposedBridge.log(&quot;parent-&gt;&quot; + parent);</span><br><span class="line">                if (parent.toString().contains(&quot;BootClassLoader&quot;)) &#123;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    GetClassLoaderClasslist(parent);</span><br><span class="line">                &#125;</span><br><span class="line">                parent &#x3D; parent.getParent();</span><br><span class="line">            &#125;</span><br><span class="line">&#x2F;*</span><br><span class="line">* 01-09 05:05:34.284 24462-24462&#x2F;? I&#x2F;Xposed: loadPackageParam.classLoader-&gt;dalvik.system.PathClassLoader[DexPathList[[zip file &quot;&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;base.apk&quot;],nativeLibraryDirectories&#x3D;[&#x2F;data&#x2F;app&#x2F;com.kanxue.xposedhook01-1&#x2F;lib&#x2F;arm, &#x2F;vendor&#x2F;lib, &#x2F;system&#x2F;lib]]]</span><br><span class="line">01-09 05:05:34.284 24462-24462&#x2F;? I&#x2F;Xposed: parent-&gt;dalvik.system.PathClassLoader[DexPathList[[dex file &quot;&#x2F;data&#x2F;dalvik-cache&#x2F;xposed_XResourcesSuperClass.dex&quot;, dex file &quot;&#x2F;data&#x2F;dalvik-cache&#x2F;xposed_XTypedArraySuperClass.dex&quot;],nativeLibraryDirectories&#x3D;[&#x2F;vendor&#x2F;lib, &#x2F;system&#x2F;lib]]]</span><br><span class="line">01-09 05:05:34.284 24462-24462&#x2F;? I&#x2F;Xposed: parent-&gt;java.lang.BootClassLoader@6c4cdad</span><br><span class="line">* *&#x2F;</span><br><span class="line">			&#x2F;&#x2F; hook壳的onCreate</span><br><span class="line">            Class StubAppClass&#x3D;XposedHelpers.findClass(&quot;com.stub.StubApp&quot;,loadPackageParam.classLoader);</span><br><span class="line">			&#x2F;&#x2F; 获取该类所有函数</span><br><span class="line">            Method[] methods&#x3D;StubAppClass.getDeclaredMethods();</span><br><span class="line">            for(Method i:methods)&#123;</span><br><span class="line">                XposedBridge.log(&quot;com.stub.StubApp-&gt;&quot;+i);</span><br><span class="line">            &#125;</span><br><span class="line">            XposedHelpers.findAndHookMethod(&quot;com.stub.StubApp&quot;, loadPackageParam.classLoader, &quot;onCreate&quot;, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.beforeHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.stub.StubApp-&gt;onCreate beforeHookedMethod&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    super.afterHookedMethod(param);</span><br><span class="line">                    XposedBridge.log(&quot;com.stub.StubApp-&gt;onCreate afterHookedMethod&quot;);</span><br><span class="line">					</span><br><span class="line">                    ClassLoader finalClassLoader&#x3D;getClassloader();</span><br><span class="line">                    XposedBridge.log(&quot;finalClassLoader-&gt;&quot; + finalClassLoader);</span><br><span class="line">                    GetClassLoaderClasslist(finalClassLoader);</span><br><span class="line">                    XposedHelpers.findAndHookMethod(&quot;com.kanxue.xposedhook01.Student&quot;, finalClassLoader, &quot;privatefunc&quot;, String.class, int.class, new XC_MethodHook() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                            super.beforeHookedMethod(param);</span><br><span class="line">                            Object[] objectarray &#x3D; param.args;</span><br><span class="line">                            String arg0 &#x3D; (String) objectarray[0];</span><br><span class="line">                            int arg1 &#x3D; (int) objectarray[1];</span><br><span class="line">                            XposedBridge.log(&quot;beforeHookedMethod11 privatefunc-&gt;arg0:&quot; + arg0 + &quot;---arg1:&quot; + arg1);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                            super.afterHookedMethod(param);</span><br><span class="line"></span><br><span class="line">                            String result &#x3D; (String) param.getResult();</span><br><span class="line">                            XposedBridge.log(&quot;afterHookedMethod11 privatefunc-&gt;result:&quot; + result);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    Class personClass &#x3D; XposedHelpers.findClass(&quot;com.kanxue.xposedhook01.Student$person&quot;, finalClassLoader);</span><br><span class="line">                    XposedHelpers.findAndHookMethod(personClass, &quot;getpersonname&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                            super.beforeHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(&quot;beforeHookedMethod getpersonname-&gt;&quot; + param.args[0]);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                            super.afterHookedMethod(param);</span><br><span class="line">                            XposedBridge.log(&quot;afterHookedMethod getpersonname-&gt;&quot; + param.getResult());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Lebo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">    Log.i(&quot;Xposed01&quot;, loadPackageParam.packageName);</span><br><span class="line">    XposedBridge.log(&quot;HookLebo-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">    if (loadPackageParam.packageName.equals(&quot;com.f0208.lebo&quot;)) &#123;</span><br><span class="line">        XposedBridge.log(&quot;kanxue &quot; + loadPackageParam.packageName);</span><br><span class="line">        Class StubAppClass&#x3D;XposedHelpers.findClass(&quot;com.f0208.lebo.MyWrapperProxyApplication&quot;,loadPackageParam.classLoader);</span><br><span class="line">        Method[] methods&#x3D;StubAppClass.getDeclaredMethods();</span><br><span class="line">        for(Method i:methods)&#123;</span><br><span class="line">            XposedBridge.log(&quot;com.f0208.lebo.MyWrapperProxyApplication-&gt;&quot;+i);</span><br><span class="line">        &#125;</span><br><span class="line">        XposedHelpers.findAndHookMethod(&quot;com.f0208.lebo.MyWrapperProxyApplication&quot;, loadPackageParam.classLoader, &quot;onCreate&quot;, new XC_MethodHook() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                super.beforeHookedMethod(param);</span><br><span class="line">                XposedBridge.log(&quot;com.f0208.lebo.MyWrapperProxyApplication-&gt;onCreate beforeHookedMethod&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                super.afterHookedMethod(param);</span><br><span class="line">                XposedBridge.log(&quot;com.f0208.lebo.MyWrapperProxyApplication-&gt;onCreate afterHookedMethod&quot;);</span><br><span class="line"></span><br><span class="line">                ClassLoader finalClassLoader&#x3D;getClassloader();</span><br><span class="line">                XposedBridge.log(&quot;finalClassLoader-&gt;&quot; + finalClassLoader);</span><br><span class="line">                XposedHelpers.findAndHookMethod(&quot;com.zw.lebo.MainActivity&quot;, finalClassLoader, &quot;onCreate&quot;, Bundle.class, new XC_MethodHook() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        super.beforeHookedMethod(param);</span><br><span class="line">                        XposedBridge.log(&quot;beforeHookedMethod com.zw.lebo.MainActivity.onCreate&quot;);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        super.afterHookedMethod(param);</span><br><span class="line">                        XposedBridge.log(&quot;afterHookedMethod com.zw.lebo.MainActivity.onCreate&quot;);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="SO函数处理"><a href="#SO函数处理" class="headerlink" title="SO函数处理"></a>SO函数处理</h1><h2 id="32位hook"><a href="#32位hook" class="headerlink" title="32位hook"></a>32位hook</h2><p>Xposed01动态加载dex</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line"> public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">     Log.i(&quot;XposedHookSo&quot;, loadPackageParam.packageName);</span><br><span class="line">     XposedBridge.log(&quot;XposedHookSo-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">     if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhookso&quot;)) &#123;</span><br><span class="line">         XposedBridge.log(&quot;XposedHookSo &quot; + loadPackageParam.packageName);</span><br><span class="line">&#x2F;&#x2F; 6.0 XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary&quot;, String.class,ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">&#x2F;&#x2F; 7.0 XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary&quot;, ClassLoader.class, String.class, new XC_MethodHook() &#123;</span><br><span class="line">        XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary0&quot;, String.class,ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">             @Override</span><br><span class="line">             protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                 super.beforeHookedMethod(param);</span><br><span class="line">		&#x2F;&#x2F; 7.0 String soname&#x3D; (String) param.args[1];</span><br><span class="line">                 String soname&#x3D; (String) param.args[0];  &#x2F;&#x2F; 6.0</span><br><span class="line">                 XposedBridge.log(&quot;beforeHookedMethod Runtime.load(&quot;+soname+&quot;,&quot;+param.args[1]+&quot;)&quot;);</span><br><span class="line">             &#125;</span><br><span class="line">             @Override</span><br><span class="line">             protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                 super.afterHookedMethod(param);</span><br><span class="line">		&#x2F;&#x2F; 7.0 String soname&#x3D; (String) param.args[0];</span><br><span class="line">                 String soname&#x3D; (String) param.args[0]; &#x2F;&#x2F; 6.0</span><br><span class="line">                 XposedBridge.log(&quot;afterHookedMethod Runtime.load(&quot;+soname+&quot;)&quot;);</span><br><span class="line">                 if(soname.contains(&quot;native-lib&quot;))&#123;</span><br><span class="line">                     System.load(&quot;&#x2F;data&#x2F;data&#x2F;com.kanxue.xposedhookso&#x2F;files&#x2F;hookso.so&quot;);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>git clone <a href="https://github.com/ele7enxxh/Android-Inline-Hook.git" target="_blank" rel="noopener">https://github.com/ele7enxxh/Android-Inline-Hook.git</a> inline的hook库面向32位，复制include，inlineHook.c，relocate.c，relocate.h到cpp下，并在CMakeLists.txt中引入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">add_library( # Sets the name of the library.</span><br><span class="line">        native-lib</span><br><span class="line"></span><br><span class="line">        # Sets the library as a shared library.</span><br><span class="line">        SHARED</span><br><span class="line"></span><br><span class="line">        # Provides a relative path to your source file(s).</span><br><span class="line">        inlineHook.c</span><br><span class="line">        relocate.c</span><br><span class="line"></span><br><span class="line">        native-lib.cpp)</span><br></pre></td></tr></table></figure><p>native-lib.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;android&#x2F;log.h&gt;</span><br><span class="line">#include &lt;dlfcn.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#include &quot;include&#x2F;inlineHook.h&quot;</span><br><span class="line">&#125;</span><br><span class="line">void *(*old_strstr)(char *, char *) &#x3D; nullptr;</span><br><span class="line"></span><br><span class="line">void *new_strstr(char *arg0, char *arg1) &#123;</span><br><span class="line">    __android_log_print(4, &quot;hookso&quot;, &quot;strstr is called,arg1:%s,arg2:%s&quot;, arg0, arg1);</span><br><span class="line">    if (strcmp(arg1, &quot;hookso&quot;) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        int a &#x3D; 1;</span><br><span class="line">        return &amp;a;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        void *result &#x3D; old_strstr(arg0, arg1);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void starthooklibc() &#123;</span><br><span class="line"></span><br><span class="line">    void *libchandle &#x3D; dlopen(&quot;libc.so&quot;, RTLD_NOW);</span><br><span class="line">    void *strstr_addr &#x3D; dlsym(libchandle, &quot;strstr&quot;);</span><br><span class="line">    if (registerInlineHook((uint32_t) strstr_addr, (uint32_t) new_strstr,</span><br><span class="line">                           (uint32_t **) &amp;old_strstr) !&#x3D;</span><br><span class="line">        ELE7EN_OK) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (inlineHook((uint32_t) strstr_addr) &#x3D;&#x3D; ELE7EN_OK) &#123;</span><br><span class="line">        __android_log_print(4, &quot;hookso&quot;, &quot;hook libc.so-&gt;strstr success!&quot;);</span><br><span class="line">        &#x2F;&#x2F;return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; void _init(void) &#123;</span><br><span class="line">    __android_log_print(4,&quot;kanxuetest&quot;,&quot;go into _init&quot;);</span><br><span class="line">    starthooklibc();</span><br><span class="line">&#125;</span><br><span class="line">__attribute__ ((constructor(10), visibility (&quot;hidden&quot;))) void initarray_4(void) &#123;</span><br><span class="line">    __android_log_print(4,&quot;kanxuetest&quot;,&quot;go into initarray_4&quot;);</span><br><span class="line">&#125;</span><br><span class="line">JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *reserved) &#123;</span><br><span class="line">    JNIEnv *env &#x3D; nullptr;</span><br><span class="line">    jint result &#x3D; -1;</span><br><span class="line">    __android_log_print(4,&quot;kanxuetest&quot;,&quot;go into JNI_OnLoad&quot;);</span><br><span class="line">    &#x2F;&#x2F;starthooklibc();</span><br><span class="line">    if ((vm)-&gt;GetEnv((void **) &amp;env, JNI_VERSION_1_6) !&#x3D; JNI_OK) &#123;</span><br><span class="line">        printf(&quot;err!!&quot;);</span><br><span class="line">        return JNI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    return JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_hookso_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject &#x2F;* this *&#x2F;) &#123;</span><br><span class="line">    __android_log_print(4,&quot;kanxuetest&quot;,&quot;go into Java_com_kanxue_hookso_MainActivity_stringFromJNI&quot;);</span><br><span class="line">    std::string hello &#x3D; &quot;Hello from C++&quot;;</span><br><span class="line">    if(strstr(&quot;aaaaabbbbb&quot;,&quot;hookso&quot;)!&#x3D; nullptr)&#123;</span><br><span class="line">        __android_log_print(4,&quot;kanxuetest&quot;,&quot;find hookso&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        __android_log_print(4,&quot;kanxuetest&quot;,&quot;not find hookso&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译生成的libnative-lib.so重命名为hookso.so放到手机/data/data/com.kanxue.xposedhookso/files下，给予权限，重新启动，打开Xposed01 app，完成调用libc的strstr函数的hook。</p><h2 id="64位hook"><a href="#64位hook" class="headerlink" title="64位hook"></a>64位hook</h2><p>git clone <a href="https://github.com/asLody/SandHook.git" target="_blank" rel="noopener">https://github.com/asLody/SandHook.git</a> 将cpp中代码拷贝到XposeeHookSoBySandHook项目的cpp中</p><p>build.gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">externalNativeBuild &#123;</span><br><span class="line">    cmake &#123;</span><br><span class="line">        arguments &#39;-DBUILD_TESTING&#x3D;OFF&#39;</span><br><span class="line">        cppFlags &quot;-frtti -fexceptions -Wpointer-arith&quot;</span><br><span class="line">        abiFilters &#39;armeabi-v7a&#39;, &#39;arm64-v8a&#39;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>native-lib.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &quot;sandhook_native.h&quot;</span><br><span class="line">#include &quot;utils&#x2F;log.h&quot;</span><br><span class="line">#include &lt;android&#x2F;log.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;cassert&gt;</span><br><span class="line">#include &lt;cstdlib&gt;</span><br><span class="line"></span><br><span class="line">#include &quot;includes&#x2F;elf.h&quot;</span><br><span class="line"></span><br><span class="line">class instance;</span><br><span class="line"></span><br><span class="line">void *(*old_strstr)(char *, char *) &#x3D; nullptr;</span><br><span class="line"></span><br><span class="line">void *new_strstr(char *arg0, char *arg1) &#123;</span><br><span class="line">    __android_log_print(4, &quot;hooksoarm64&quot;, &quot;strstr is called,arg1:%s,arg2:%s&quot;, arg0, arg1);</span><br><span class="line">    if (strcmp(arg1, &quot;hookso&quot;) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        int a &#x3D; 1;</span><br><span class="line">        return &amp;a;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        void *result &#x3D; old_strstr(arg0, arg1);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void starthooklibc() &#123;</span><br><span class="line">    if (sizeof(void *) &#x3D;&#x3D; 8) &#123;</span><br><span class="line">        const char *libcpath &#x3D; &quot;&#x2F;system&#x2F;lib64&#x2F;libc.so&quot;;</span><br><span class="line">        old_strstr &#x3D; reinterpret_cast&lt;void *(*)(char *, char *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   &quot;strstr&quot;,</span><br><span class="line">                                                                                   reinterpret_cast&lt;void *&gt;(new_strstr)));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        const char *libcpath &#x3D; &quot;&#x2F;system&#x2F;lib&#x2F;libc.so&quot;;</span><br><span class="line">        old_strstr &#x3D; reinterpret_cast&lt;void *(*)(char *, char *)&gt;(SandInlineHookSym(libcpath,</span><br><span class="line">                                                                                   &quot;strstr&quot;,</span><br><span class="line">                                                                                   reinterpret_cast&lt;void *&gt;(new_strstr)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool testhook(const char *content) &#123;</span><br><span class="line">    if (strstr(content, &quot;hookso&quot;) !&#x3D; nullptr) &#123;</span><br><span class="line">        __android_log_print(4, &quot;xposedhookso&quot;, &quot;find hookso&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        __android_log_print(4, &quot;xposedhookso&quot;, &quot;not find hookso&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int (*testhookfunctin)(const char *) &#x3D; nullptr;</span><br><span class="line"></span><br><span class="line">extern &quot;C&quot; void _init(void) &#123;</span><br><span class="line">    LOGD(&quot;go into _init&quot;);</span><br><span class="line">    &#x2F;&#x2F;starthooklibc();</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 比initarray中的方法早</span><br><span class="line">extern &quot;C&quot; jint JNICALL JNI_OnLoad(JavaVM *vm, void *reserved) &#123;</span><br><span class="line">    LOGD(&quot;go into JNI_OnLoad&quot;);</span><br><span class="line">    starthooklibc();</span><br><span class="line">    return JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line">extern &quot;C&quot; JNIEXPORT jstring JNICALL</span><br><span class="line">Java_com_kanxue_xposeehooksobysandhook_MainActivity_stringFromJNI(</span><br><span class="line">        JNIEnv *env,</span><br><span class="line">        jobject &#x2F;* this *&#x2F;) &#123;</span><br><span class="line">    std::string hello &#x3D; &quot;Hello from C++&quot;;</span><br><span class="line">    return env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译生成so拷贝到/data/data/com.kanxue.xposedhookso/files/hookso.so下并配置权限</p><h2 id="主动调用-1"><a href="#主动调用-1" class="headerlink" title="主动调用"></a>主动调用</h2><p>XposeeHookSoBySandHook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">bool testhook(const char *content) &#123;</span><br><span class="line"></span><br><span class="line">    if (strstr(content, &quot;hookso&quot;) !&#x3D; nullptr) &#123;</span><br><span class="line">        __android_log_print(4, &quot;xposedhookso&quot;, &quot;find hookso&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        __android_log_print(4, &quot;xposedhookso&quot;, &quot;not find hookso&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">extern &quot;C&quot; jint JNICALL JNI_OnLoad(JavaVM *vm, void *reserved) &#123;</span><br><span class="line">    LOGD(&quot;go into JNI_OnLoad&quot;);</span><br><span class="line">    &#x2F;&#x2F;starthooklibc();</span><br><span class="line">    activecalltesthook();</span><br><span class="line"></span><br><span class="line">    return JNI_VERSION_1_6;</span><br><span class="line">&#125;</span><br><span class="line">void activecalltesthook() &#123;</span><br><span class="line">    typedef int (*testhook)(const char *a1);</span><br><span class="line"></span><br><span class="line">    testhook testhookfunction &#x3D; nullptr;</span><br><span class="line">    &#x2F;&#x2F;得到函数地址</span><br><span class="line">&#x2F;*    extern &quot;C&quot;</span><br><span class="line">    EXPORT void* SandGetModuleBase(const char* so);*&#x2F;</span><br><span class="line"></span><br><span class="line">    void *libnativebase &#x3D; SandGetModuleBase(&quot;libnative-lib.so&quot;);</span><br><span class="line">    &#x2F;&#x2F;thumb 0x8B4C是testhook的基地址偏移</span><br><span class="line">    if(sizeof(void*)&#x3D;&#x3D;4)&#123;</span><br><span class="line">		&#x2F;&#x2F; 指针不能直接参与运算  32位</span><br><span class="line">        unsigned long tmpaddr &#x3D; (unsigned long) libnativebase + 0x8B4C + 1;</span><br><span class="line">        void *testhookaddr &#x3D; reinterpret_cast&lt;void *&gt;(tmpaddr);</span><br><span class="line">        testhookfunction &#x3D; reinterpret_cast&lt;testhook&gt;(testhookaddr);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        &#x2F;&#x2F; 64位</span><br><span class="line">        unsigned long tmpaddr &#x3D; (unsigned long) libnativebase + 0xf67c;</span><br><span class="line">        void *testhookaddr &#x3D; reinterpret_cast&lt;void *&gt;(tmpaddr);</span><br><span class="line">        testhookfunction &#x3D; reinterpret_cast&lt;testhook&gt;(testhookaddr);</span><br><span class="line">        LOGD(&quot;libnative-lib.so base:%p,testfuncaddr:%p&quot;,libnativebase,(void*)tmpaddr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int result1 &#x3D; testhookfunction(&quot;aaaaahookso&quot;);</span><br><span class="line"></span><br><span class="line">    LOGD(&quot;testhookfunction(\&quot;aaaaahookso\&quot;); return:%d&quot;, result1);</span><br><span class="line"></span><br><span class="line">    int result2 &#x3D; testhookfunction(&quot;aaaabbbbb&quot;);</span><br><span class="line">    LOGD(&quot;testhookfunction(\&quot;aaaabbbbb\&quot;); return:%d&quot;, result2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译生成的libsandhook-native.so推送到/sdcard/32.so，重命名为hookso.so复制到/data/data/com.kabxue.xposedhookso/files下</p><p>进入xposed01项目中，定义XposedActiveCallSoFunction类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line"> public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">     Log.i(&quot;XposedHookSo&quot;, loadPackageParam.packageName);</span><br><span class="line">     XposedBridge.log(&quot;XposedHookSo-&gt;app packagename&quot; + loadPackageParam.packageName);</span><br><span class="line">     if (loadPackageParam.packageName.equals(&quot;com.kanxue.xposedhookso&quot;)) &#123;</span><br><span class="line">         XposedBridge.log(&quot;XposedHookSo &quot; + loadPackageParam.packageName);</span><br><span class="line">&#x2F;&#x2F; 6.0 XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary&quot;, String.class,ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">&#x2F;&#x2F; 7.0 XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary&quot;, ClassLoader.class, String.class, new XC_MethodHook() &#123;</span><br><span class="line">        XposedHelpers.findAndHookMethod(&quot;java.lang.Runtime&quot;, loadPackageParam.classLoader, &quot;loadLibrary0&quot;, String.class,ClassLoader.class, new XC_MethodHook() &#123;</span><br><span class="line">             @Override</span><br><span class="line">             protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                 super.beforeHookedMethod(param);</span><br><span class="line">		&#x2F;&#x2F; 7.0 String soname&#x3D; (String) param.args[1];</span><br><span class="line">                 String soname&#x3D; (String) param.args[0];  &#x2F;&#x2F; 6.0</span><br><span class="line">                 XposedBridge.log(&quot;beforeHookedMethod Runtime.load(&quot;+soname+&quot;,&quot;+param.args[1]+&quot;)&quot;);</span><br><span class="line">             &#125;</span><br><span class="line">             @Override</span><br><span class="line">             protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                 super.afterHookedMethod(param);</span><br><span class="line">		&#x2F;&#x2F; 7.0 String soname&#x3D; (String) param.args[0];</span><br><span class="line">                 String soname&#x3D; (String) param.args[0]; &#x2F;&#x2F; 6.0</span><br><span class="line">                 XposedBridge.log(&quot;afterHookedMethod Runtime.load(&quot;+soname+&quot;)&quot;);</span><br><span class="line">                 if(soname.contains(&quot;native-lib&quot;))&#123;</span><br><span class="line">                     System.load(&quot;&#x2F;data&#x2F;data&#x2F;com.kanxue.xposedhookso&#x2F;files&#x2F;hookso.so&quot;);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="指纹检测与定制反检测"><a href="#指纹检测与定制反检测" class="headerlink" title="指纹检测与定制反检测"></a>指纹检测与定制反检测</h1><ol><li>Xposed插件管理-XposedInstaller</li><li>Xposed对函数hook根本原理-java函数变native函数</li><li>Xposed大量api</li><li>Xposed框架特定文件等</li></ol><p><a href="https://github.com/w568w/XposedChecker" target="_blank" rel="noopener">XposedChecker</a></p><p>Xposed框架组成</p><ol><li>XposedInstaller 完整的Android工程，编译生成apk，用于管理Xposed框架的插件</li><li>Xposed 对Zygote进程定制，能够实现对接下来任何一个app进程的hook</li><li>android_art 用于支持对Java类函数hook而对ART源码进程的一系列定制</li><li>XposedBridge Xposed的java部分，可单独作为Android工程进行编译</li><li>XposedTools 用于编译和打包Xposed框架</li></ol><p>简单定制</p><p>修改Xposed框架中所有关于Xposed相关的类，函数等指纹信息(比如关键字Xposed)，便可以绕过大多数Xposed框架指纹检测技术，其他的根据Xposed对Java函数hook的根本原理进行检测(如判断函数属性是否变为native),也可以在编写对应插件进行绕过。</p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"25827-1638538754631-918",name:"万物皆可逆向",qrcode:"https://onejane.github.io/gzh.jpg",keyword:"密码"})}</script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2022/05/04/Xposed二进制补丁插件开发/">http://onejane.github.io/2022/05/04/Xposed二进制补丁插件开发/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">万物皆可逆向</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/xposed/">xposed</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/06/05/FridaHook%E5%A4%A7%E5%85%A8/"><i class="fa fa-chevron-left"></i> <span>FridaHook大全</span></a></div><div class="next-post pull-right"><a href="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/"><span>Frida逆向与利用自动化</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>