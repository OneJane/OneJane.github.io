<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Frida逆向与利用自动化"><meta name="keywords" content="frida"><meta name="author" content="J"><meta name="copyright" content="J"><title>Frida逆向与利用自动化 | 万物皆可逆向</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a345f534c85363668f09d4d5c6a9ee81";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-111479568-4","auto"),ga("send","pageview")</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer="defer"></script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},hexoVersion:"4.2.1"}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kali"><span class="toc-number">1.</span> <span class="toc-text">Kali</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Frida"><span class="toc-number">2.</span> <span class="toc-text">Frida</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#frida-example-1-0"><span class="toc-number">2.1.</span> <span class="toc-text">frida_example_1.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kgb-messenger"><span class="toc-number">2.2.</span> <span class="toc-text">kgb-messenger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC"><span class="toc-number">2.3.</span> <span class="toc-text">RPC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主动调用"><span class="toc-number">2.3.1.</span> <span class="toc-text">主动调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接受回调"><span class="toc-number">2.3.2.</span> <span class="toc-text">接受回调</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NPS"><span class="toc-number">2.4.</span> <span class="toc-text">NPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zentrace"><span class="toc-number">2.5.</span> <span class="toc-text">Zentrace</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#案例"><span class="toc-number">3.</span> <span class="toc-text">案例</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://onejane.gitee.io/picture/avatar.jpg"></div><div class="author-info__name text-center">J</div><div class="author-info__description text-center">逆向,爬虫</div><div class="follow-button"><a href="https://github.com/OneJane/" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">82</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">66</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/welggy" target="_blank" rel="noopener">OneJane</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">万物皆可逆向</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i> <span class="pull-right menus"><a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a></span></div><div id="post-info"><div id="post-title">Frida逆向与利用自动化</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">5.4k</span><span class="post-meta__separator">|</span><span>阅读时长: 30 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><div id="vip-container"><h1 id="Kali"><a href="#Kali" class="headerlink" title="Kali"></a>Kali</h1><p>kali里面时间老是不对，其实只是时区不对而已，一个命令就搞定：</p><blockquote><p> <code>dpkg-reconfigure tzdata</code> 然后选择Asia→Shanghai，然后重启即可。</p></blockquote><p>KaliLinux默认不带中文</p><blockquote><p><code>apt install xfonts-intl-chinese</code></p><p><code>apt install ttf-wqy-microhei</code></p></blockquote><p>kali装中文输入法，参考<a href="https://blog.csdn.net/qq_42333641/article/details/89325576" target="_blank" rel="noopener">https://blog.csdn.net/qq_42333641/article/details/89325576</a></p><p>apt install htop 动态查看当前活跃占用高的进程。</p><p>apt install jnettop 流量查看工具。</p><p>wifiadb qtscrcpy wifi群控</p><p><a href="https://github.com/pyenv/pyenv/wiki#suggested-build-environment" target="_blank" rel="noopener">安装pyenv</a> <a href="https://github.com/pyenv/pyenv-installer" target="_blank" rel="noopener">https://github.com/pyenv/pyenv-installer</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update; sudo apt-get install make build-essential libssl-dev zlib1g-dev \</span><br><span class="line">libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm \</span><br><span class="line">libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev</span><br><span class="line"></span><br><span class="line">curl https:&#x2F;&#x2F;pyenv.run | bash</span><br><span class="line">proxychains curl -L https:&#x2F;&#x2F;github.com&#x2F;pyenv&#x2F;pyenv-installer&#x2F;raw&#x2F;master&#x2F;bin&#x2F;pyenv-installer | bash</span><br><span class="line"> </span><br><span class="line">mkdir ~&#x2F;.pyenv</span><br><span class="line">proxychains git clone https:&#x2F;&#x2F;github.com&#x2F;pyenv&#x2F;pyenv.git ~&#x2F;.pyenv</span><br><span class="line">ls .pyenv&#x2F;</span><br><span class="line">echo $HOME</span><br><span class="line">echo &#39;export PYENV_ROOT&#x3D;&quot;$HOME&#x2F;.pyenv&quot;&#39; &gt;&gt; ~&#x2F;.bash_profile</span><br><span class="line">echo &#39;export PATH&#x3D;&quot;$PYENV_ROOT&#x2F;bin:$PATH&quot;&#39; &gt;&gt; ~&#x2F;.bash_profile</span><br><span class="line">ls .pyenv&#x2F;bin&#x2F;</span><br><span class="line">source .bash_profile</span><br><span class="line">pyenv</span><br><span class="line">pyenv --version  # 获取pyenv版本号</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo -e &#39;if command -v pyenv 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1; then\n eval &quot;$(pyenv init -)&quot;\n fi&#39; &gt;&gt; ~&#x2F;.bashrc  添加&quot;pyenv init -&quot;到shell</span><br><span class="line">exec &quot;$SHELL&quot;</span><br><span class="line">pyenv install 3.8.0</span><br></pre></td></tr></table></figure><p>安装vscode</p><p><code>dpkg -i code_1.45.1-1589445602_amd64.deb</code></p><p>安装node</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install -y nodejs</span><br></pre></td></tr></table></figure><p>刷机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dl.google.com&#x2F;dl&#x2F;android&#x2F;aosp&#x2F;sailfish-opm1.171019.011-factory-56d15350.zip</span><br><span class="line">下载https:&#x2F;&#x2F;developer.android.com&#x2F;studio&#x2F;releases&#x2F;platform-tools</span><br><span class="line">unzip platform-tools_r33.0.1-linux.zip</span><br><span class="line">cd platform-tools &amp;&amp; vim ~&#x2F;.bashrc</span><br><span class="line">export PATH&#x3D;&quot;&#x2F;root&#x2F;platform-tools:$PATH&quot;   有了fastboot</span><br><span class="line">unzip sailfish-opm1.171019.011-factory-56d15350.zip</span><br><span class="line">关机键+音量减  启动到bootloader</span><br><span class="line">.&#x2F;flash-all.sh</span><br><span class="line">重启进入BootLoader</span><br><span class="line">fastboot boot twrp-3.3.1-0-sailfish.img</span><br><span class="line">安装 magisk</span><br></pre></td></tr></table></figure><p>frida</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1. git clone https:&#x2F;&#x2F;github.com&#x2F;oleavr&#x2F;frida-agent-example.git</span><br><span class="line">2. cd frida-agent-example&#x2F;</span><br><span class="line">3. npm install</span><br><span class="line">4. 使用VSCode等IDE打开此工程，在agent下编写typescript，会有智能提示。</span><br><span class="line">5. npm run watch会监控代码修改自动编译生成js文件</span><br><span class="line">6. frida -U -f com.example.android --no-pause -l _agent.js</span><br><span class="line"></span><br><span class="line">想要使用基于特定frida版本的objection，只需先安装好特定版本的frida和frida-tools（星球里搜“特定版本”有对应关系），再去objection的release里找那个日期之后一点点的版本。比如以frida 12.8.0版本举例：</span><br><span class="line">pip install frida&#x3D;&#x3D;12.8.0</span><br><span class="line">pip install frida-tools&#x3D;&#x3D;5.3.0</span><br><span class="line">pip install objection&#x3D;&#x3D;1.8.4</span><br><span class="line">按照这个顺序，在装objection的时候，就会直接Requirement already satisfied，不会再去下载新的frida来安装了。</span><br><span class="line"></span><br><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        console.log(&quot;Inside Frida Java Perform !&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br><span class="line"></span><br><span class="line">模拟器frida-server012.9.4-android-x86.xz</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/1&e=1656604799&token=kIxbL07-8jAj8w1n4s9zv64FuZZNEATmlU_Vm6zDSMerjtKe8gL6_A6Tnt1Tx2dbVY8=.jpeg" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities</span><br><span class="line">android intent launch_activity com.android.settings.DisplaySettings       启动activity</span><br><span class="line">android hooking list services</span><br><span class="line">memory list modules 进程中加载的so</span><br><span class="line">memory list exports libssl.so  查看导出函数地址</span><br><span class="line">android heap search instances com.android.setting.DisplaySettings --fresh   查看类是否被实例化</span><br><span class="line">android heap execute 0x2286 getPreferenceScreenResId  主动调用</span><br><span class="line"> </span><br><span class="line"># android heap evaluate 0x2526                                         也可以在找到的实例上直接编写js脚本 </span><br><span class="line">(The handle at &#96;0x2526&#96; will be available as the &#96;clazz&#96; variable.)</span><br><span class="line"></span><br><span class="line">console.log(&quot;evaluate result:&quot;+clazz.getPreferenceScreenResId()) </span><br><span class="line"></span><br><span class="line">JavaScript capture complete. Evaluating...</span><br><span class="line">Handle 0x2526 is to class com.android.settings.DisplaySettings</span><br><span class="line">evaluate result:2132082764</span><br><span class="line"></span><br><span class="line">android hooking search classes display  搜索相关类</span><br><span class="line">android hooking search methods display  搜索相关方法 </span><br><span class="line">android hooking list class_methods sum.util.locale.LocaleUtils   查看类所有方法</span><br><span class="line">android hooking watch class_method android.bluetooth.BluetoothDevice.equals --dump-args --dump-backtrace --dump-return </span><br><span class="line">android hooking watch class java.io.File.$init </span><br><span class="line"></span><br><span class="line">proxychains git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;Wallbreaker.git</span><br><span class="line">plugin load &#x2F;root&#x2F;Wallbreaker</span><br><span class="line">plugin wallbreaker classdump --fullname android.bluetooth.BluetoothDevice</span><br><span class="line">plugin wallbreaker objectdump --fullname 0x12aq</span><br><span class="line">plugin wallbreaker objectsearch android.view.View$ListenerInfo  搜索实例</span><br><span class="line"></span><br><span class="line">proxychains git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;FRIDA-DEXDump.git</span><br><span class="line">plugin load &#x2F;root&#x2F;FRIDA-Dexdump</span><br><span class="line">plugin dexdump dump  脱壳</span><br><span class="line"></span><br><span class="line">objection无法hook native</span><br><span class="line">objection -g packageName explore --startup-command &#39;android hooking watch xxx&#39;  如果找不到进程就去spawn启动，看来是自带spawn</span><br></pre></td></tr></table></figure><p><a href="https://www.anquanke.com/post/id/197657" target="_blank" rel="noopener">实用FRIDA进阶：内存漫游、hook anywhere、抓包</a></p><p><a href="https://github.com/skylot/jadx/releases/download/v1.3.5/jadx-gui-1.3.5-no-jre-win.exe" target="_blank" rel="noopener">jadx-gui-1.3.5-no-jre-win.exe</a> 反编译软件</p><p>java -jar abe-all.jar unpack 1.ab 1.tar 其中<a href="https://github.com/nelenkov/android-backup-extractor/releases/download/master-20220409062712-07bb660/abe.jar" target="_blank" rel="noopener">abe.jar</a> 安卓备份文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;redirector.gvt1.com&#x2F;edgedl&#x2F;android&#x2F;studio&#x2F;ide-zips&#x2F;2021.1.1.23&#x2F;android-studio-2021.1.1.23-linux.tar.gz</span><br><span class="line">.&#x2F;bin&#x2F;studio.sh</span><br></pre></td></tr></table></figure><p>frida -U com.example.lesson -l lesson.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;*</span><br><span class="line">		&#x2F;&#x2F; 重载</span><br><span class="line">        Java.use(&quot;com.example.lesson4one.MainActivity&quot;).fun.overload(&#39;int&#39;, &#39;int&#39;).implementation &#x3D; function(arg1,arg2)&#123;</span><br><span class="line">            var result &#x3D; this.fun(arg1,arg2);</span><br><span class="line">			&#x2F;&#x2F; 打印调用栈</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            console.log(&quot;arg1,arg2,result&quot;,arg1,arg2,result)</span><br><span class="line">            return 800;</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(&quot;com.example.lesson4one.MainActivity&quot;).fun.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (arg1 )&#123;</span><br><span class="line">            </span><br><span class="line">            var result &#x3D; this.fun(Java.use(&#39;java.lang.String&#39;).$new(&quot;NIHAOJAVA&quot;));</span><br><span class="line">            console.log(&quot;arg1,result&quot;,arg1,result)</span><br><span class="line">            return Java.use(&#39;java.lang.String&#39;).$new(&quot;NIHAOJS&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">		&#x2F;&#x2F; 主动调用动态函数 </span><br><span class="line">        Java.choose(&quot;com.example.lesson4one.MainActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance)</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance.secret())</span><br><span class="line">            &#125;,onComplete:function()&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; 主动调用静态函数</span><br><span class="line">       var result &#x3D; Java.use(&quot;com.example.lesson4one.MainActivity&quot;).secret2();</span><br><span class="line">       console.log(result);</span><br><span class="line">       *&#x2F;</span><br><span class="line"></span><br><span class="line">       Java.use(&quot;net.sqlcipher.database.SQLiteOpenHelper&quot;).getWritableDatabase.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (x)&#123;</span><br><span class="line">           var result &#x3D; this.getWritableDatabase(x);</span><br><span class="line">           console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">           console.log(&quot;xString,result&quot;,x,result);</span><br><span class="line">           return result;</span><br><span class="line">       &#125;</span><br><span class="line">       Java.use(&quot;net.sqlcipher.database.SQLiteOpenHelper&quot;).getWritableDatabase.overload(&#39;[C&#39;).implementation &#x3D; function (x)&#123;</span><br><span class="line">        var result &#x3D; this.getWritableDatabase(x);</span><br><span class="line">        console.log(&quot;xCharSe,result&quot;,x,result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br><span class="line"></span><br><span class="line">function  ()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.yaphetshan.tencentwelcome.MainActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found insttance &quot;,instance);</span><br><span class="line">                console.log(&quot;invoke instance.a &quot;,instance.a());</span><br><span class="line">            &#125;,onComplete:function()&#123;console.log(&quot;search completed !&quot;)&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setTimeout(invoke,2000)</span><br></pre></td></tr></table></figure><h1 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h1><p>npm i -g @types/frida-gum 安装vs的frida自动提示</p><h2 id="frida-example-1-0"><a href="#frida-example-1-0" class="headerlink" title="frida_example_1.0"></a>frida_example_1.0</h2><p>frida -U -f com.frida.example -l hook.js –no-pause</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">function main() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line"></span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;r0gson.dex&quot;).load();</span><br><span class="line">        const gson &#x3D; Java.use(&#39;com.r0ysue.gson.Gson&#39;);</span><br><span class="line">        &#x2F;&#x2F;console.log(gson.$new().toJson(xxx));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;*</span><br><span class="line">		&#x2F;&#x2F; 字符串</span><br><span class="line">        Java.use(&quot;java.lang.Character&quot;).toString.overload(&#39;char&#39;).implementation &#x3D; function(x)&#123;</span><br><span class="line">            var result &#x3D; this.toString(x);</span><br><span class="line">            console.log(&quot;x,result&quot;,x,result);</span><br><span class="line">            return &quot;对象数组&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">		&#x2F;&#x2F; 字符数组</span><br><span class="line">        Java.use(&quot;java.util.Arrays&quot;).toString.overload(&#39;[C&#39;).implementation &#x3D; function (x)&#123;</span><br><span class="line">            var charArray &#x3D; Java.array(&#39;char&#39;, [ &#39;一&#39;,&#39;去&#39;,&#39;二&#39;,&#39;三&#39;,&#39;里&#39; ]);</span><br><span class="line">            var result &#x3D; this.toString(charArray);</span><br><span class="line">			&#x2F;&#x2F; console.log(&quot;x,result&quot;,JSON.stringify(x),result);   </span><br><span class="line">            console.log(&quot;x,result&quot;,gson.$new().toJson(charArray),result);            </span><br><span class="line">            return Java.use(&#39;java.lang.String&#39;).$new(Java.array(&#39;char&#39;,[&#39;烟&#39;,&#39;村&#39;,&#39;四&#39;,&#39;五&#39;,&#39;家&#39;]));</span><br><span class="line">        &#125;</span><br><span class="line">		&#x2F;&#x2F; 字节数组</span><br><span class="line">        Java.use(&quot;java.util.Arrays&quot;).toString.overload(&#39;[B&#39;).implementation &#x3D; function (x)&#123; </span><br><span class="line">            var result &#x3D; this.toString(x);</span><br><span class="line">            &#x2F;&#x2F;console.log(&quot;x,result&quot;,gson.$new().toJson(x),result);            </span><br><span class="line">            console.log(&quot;x,result&quot;,x,result);            </span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; 类型转换 父-&gt;子</span><br><span class="line">        var Waterhandle &#x3D; null;</span><br><span class="line">        Java.choose(&quot;com.r0ysue.a0526printout.Water&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance:&quot;,instance);</span><br><span class="line">                console.log(&quot;water instance call still:&quot;,instance.still(instance));</span><br><span class="line">                Waterhandle &#x3D; instance;</span><br><span class="line">            &#125;,onComplete:function()&#123;console.log(&quot;search completed!&quot;)&#125;</span><br><span class="line">        &#125;) </span><br><span class="line">        var JuiceHandle &#x3D; Java.cast(Waterhandle,Java.use(&quot;com.r0ysue.a0526printout.Juice&quot;));</span><br><span class="line">        console.log(&quot;Juice fillEnergy method :&quot;,JuiceHandle.fillEnergy());</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; 类型转换 子-&gt;父</span><br><span class="line">        var JuiceHandle &#x3D; null ;</span><br><span class="line">        Java.choose(&quot;com.r0ysue.a0526printout.Juice&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance);</span><br><span class="line">                console.log(&quot;filling energy,&quot;,instance.fillEnergy());</span><br><span class="line">                JuiceHandle&#x3D; instance;</span><br><span class="line">            &#125;,onComplete:function()&#123;&quot;Search Completed!&quot;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        var WaterHandle &#x3D; Java.cast(JuiceHandle ,Java.use(&quot;com.r0ysue.a0526printout.Water&quot;));</span><br><span class="line">        console.log(&quot;Water invoke still &quot;, WaterHandle.still(WaterHandle));</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F; 注册一个接口类</span><br><span class="line">        var beer &#x3D; Java.registerClass(&#123;</span><br><span class="line">            name: &#39;com.r0ysue.a0526printout.beer&#39;,</span><br><span class="line">            implements: [Java.use(&#39;com.r0ysue.a0526printout.liquid&#39;)],</span><br><span class="line">            methods: &#123;</span><br><span class="line">                flow: function () &#123;</span><br><span class="line">                    console.log(&quot;look I&#96;m beer!&quot;);</span><br><span class="line">                    return &quot;taste good!&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        console.log(&quot;beer.flow:&quot;,beer.$new().flow());  </span><br><span class="line">        *&#x2F;</span><br><span class="line">       </span><br><span class="line">		&#x2F;&#x2F; 主动调用枚举实例方法</span><br><span class="line">        Java.choose(&quot;com.r0ysue.a0526printout.Signal&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance:&quot;,instance)</span><br><span class="line">                console.log(&quot;invoke getDeclaringClass&quot;,instance.getDeclaringClass())</span><br><span class="line">            &#125;,onComplete:function()&#123;console.log(&quot;Search Completed!&quot;)&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;setImmediate(main,2000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function hashmap888()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;*</span><br><span class="line">		&#x2F;&#x2F; 主动调用打印map</span><br><span class="line">        Java.choose(&quot;java.util.HashMap&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                if(instance.toString().indexOf(&quot;ISBN&quot;)!&#x3D;-1)&#123;</span><br><span class="line">                    console.log(&quot;found HashMap&quot;,instance);</span><br><span class="line">					console.log(&quot;HashMap toString:&quot;,instance.toString());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;,onComplete:function()&#123;console.log(&quot;Search Completed!&quot;)&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        *&#x2F;</span><br><span class="line">		&#x2F;&#x2F; hook map方法</span><br><span class="line">        Java.use(&quot;java.util.HashMap&quot;).put.implementation &#x3D; function(x,y)&#123;</span><br><span class="line">            var result &#x3D; this.put(x,y);</span><br><span class="line">            console.log(&quot;x,y,result&quot;,x,y,result)</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hashmap888);</span><br></pre></td></tr></table></figure><p>Non-ASCII有一些不可视, 所以可以先编码打印出来, 再用编码后的字符串去 hook.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">int ֏(int x) &#123;</span><br><span class="line">    return x + 100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Java.perform(</span><br><span class="line">    function x() &#123;</span><br><span class="line">        var targetClass &#x3D; &quot;com.example.hooktest.MainActivity&quot;;</span><br><span class="line">        var hookCls &#x3D; Java.use(targetClass);</span><br><span class="line">        var methods &#x3D; hookCls.class.getDeclaredMethods();</span><br><span class="line">        for (var i in methods) &#123;</span><br><span class="line">            console.log(methods[i].toString());</span><br><span class="line">            console.log(encodeURIComponent(methods[i].toString().replace(&#x2F;^.*?\.([^\s\.\(\)]+)\(.*?$&#x2F;, &quot;$1&quot;)));</span><br><span class="line">        &#125;</span><br><span class="line">        hookCls[decodeURIComponent(&quot;%D6%8F&quot;)]</span><br><span class="line">            .implementation &#x3D; function (x) &#123;</span><br><span class="line">                console.log(&quot;original call: fun(&quot; + x + &quot;)&quot;);</span><br><span class="line">                var result &#x3D; this[decodeURIComponent(&quot;%D6%8F&quot;)](900);</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>六层锁机案例</p><p>objection -g com.example.androiddemo explore</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503192559469.png" alt="image-20220503192559469"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503192835365.png" alt="image-20220503192835365"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">    	&#x2F;&#x2F; 拿到result放入密码框即可  hook LoginActivity.a</span><br><span class="line">    	&#x2F;&#x2F; hook函数 打印入参及调用原返回值</span><br><span class="line">    	&#x2F;&#x2F; input text &quot;R4jSLLLLLLLLLLOrLE7&#x2F;5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL&#x3D;&quot;  自动输入文本</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.LoginActivity&quot;).a.overload(&#39;java.lang.String&#39;, &#39;java.lang.String&#39;).implementation &#x3D; function(x,y)&#123;</span><br><span class="line">            var result &#x3D; this.a(x,y);</span><br><span class="line">            console.log(&quot;x,y,result&quot;,x,y,result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">		&#x2F;&#x2F; hook 修改返回值,没有调用原来的函数，直接返回值</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity1&quot;).a.implementation &#x3D; function (x)&#123;</span><br><span class="line">            console.log(&quot;first challenge 1&quot;)</span><br><span class="line">            return &quot;R4jSLLLLLLLLLLOrLE7&#x2F;5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL&#x3D;&quot; ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503193009705.png" alt="image-20220503193009705"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function second()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        &#x2F;&#x2F; 静态主动调用</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity2&quot;).setStatic_bool_var();</span><br><span class="line">		&#x2F;&#x2F; 非静态主动调用</span><br><span class="line">        Java.choose(&quot;com.example.androiddemo.Activity.FridaActivity2&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance);</span><br><span class="line">                instance.setBool_var()</span><br><span class="line">            &#125;,onComplete:function()&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503200717670.png" alt="image-20220503200717670"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function third()&#123;</span><br><span class="line">    Java.perform(function()&#123; </span><br><span class="line">        &#x2F;&#x2F; hook设置成员变量的值</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity3&quot;).static_bool_var.value &#x3D; true ; </span><br><span class="line">        Java.choose(&quot;com.example.androiddemo.Activity.FridaActivity3&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance);</span><br><span class="line">                &#x2F;&#x2F;设置非静态成员变量的值</span><br><span class="line">                instance.bool_var.value &#x3D; true ;</span><br><span class="line">                &#x2F;&#x2F;设置有相同函数名的成员变量的值 same_name_bool_var</span><br><span class="line">                instance._same_name_bool_var.value &#x3D; true ;</span><br><span class="line">            &#125;,onComplete:function()&#123;&#125;</span><br><span class="line">        &#125;) </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503200858241.png" alt="image-20220503200858241"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function forth()&#123;</span><br><span class="line">    &#x2F;&#x2F;hook内部类 private static class InnerClasses</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check1.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check2.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check3.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check4.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check5.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;).check6.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function forth2()&#123;</span><br><span class="line">    &#x2F;&#x2F; 反射获取所有内部类的方法hook设置返回值  hook 类的多个函数</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        var class_name &#x3D; &quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot; ;</span><br><span class="line">        var InnerClass &#x3D; Java.use(class_name);</span><br><span class="line">        var all_methods &#x3D; InnerClass.class.getDeclaredMethods();</span><br><span class="line">        &#x2F;&#x2F;console.log(all_methods);</span><br><span class="line">        for(var i &#x3D; 0;i&lt;all_methods.length;i++)&#123;</span><br><span class="line">            var method &#x3D; all_methods[i];</span><br><span class="line">            &#x2F;&#x2F;console.log(method.toString());</span><br><span class="line">            var substring &#x3D; method.toString().substr(method.toString().indexOf(class_name)+class_name.length+1);</span><br><span class="line">            var finalMethodString &#x3D; substring.substr(0,substring.indexOf(&quot;(&quot;));</span><br><span class="line">            console.log(finalMethodString);</span><br><span class="line">            InnerClass[finalMethodString].implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503202727892.png" alt="image-20220503202727892"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function fifth()&#123;</span><br><span class="line">   &#x2F;&#x2F; hook 动态dex中的方法</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.androiddemo.Activity.FridaActivity5&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">               &#x2F;&#x2F; 拿到getDynamicDexCheck返回的类的className是DynamicCheck</span><br><span class="line">                console.log(&quot;found instance getDynamicDexCheck :&quot;,instance.getDynamicDexCheck().$className);</span><br><span class="line">            &#125;,onComplete:function()&#123;console.log(&quot;search complete!&quot;)&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; 枚举所有classloader</span><br><span class="line">        Java.enumerateClassLoaders(&#123;</span><br><span class="line">            onMatch:function(loader)&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; 切换classloader</span><br><span class="line">                    if(loader.findClass(&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;))&#123;</span><br><span class="line">                        console.log(&quot;Succefully found loader!&quot;,loader);</span><br><span class="line">                        Java.classFactory.loader &#x3D; loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                    console.log(&quot;found error &quot;+error)</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,onComplete:function()&#123;&quot;enum completed!&quot;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;).check.implementation &#x3D; function()&#123;return true&#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503202932282.png" alt="image-20220503202932282"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function sixth ()&#123;</span><br><span class="line">    &#x2F;&#x2F; 主动调用静态方法</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.Frida6.Frida6Class0&quot;).check.implementation &#x3D; function ()&#123;return true &#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.Frida6.Frida6Class1&quot;).check.implementation &#x3D; function ()&#123;return true &#125;;</span><br><span class="line">        Java.use(&quot;com.example.androiddemo.Activity.Frida6.Frida6Class2&quot;).check.implementation &#x3D; function ()&#123;return true &#125;;     </span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br><span class="line">function sixth2()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">     	&#x2F;&#x2F; 枚举所有类 主动调用静态方法</span><br><span class="line">        Java.enumerateLoadedClasses(&#123;</span><br><span class="line">            onMatch:function(name,handle)&#123;</span><br><span class="line">                if(name.toString().indexOf(&quot;com.example.androiddemo.Activity.Frida6.Frida6&quot;)&gt;&#x3D;0)&#123;</span><br><span class="line">                    console.log(&quot;name&quot;,name)</span><br><span class="line">                    Java.use(name).check.implementation &#x3D; function()&#123;return true&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,onComplete()&#123;&#125;</span><br><span class="line">        &#125;) </span><br><span class="line">    &#125;) </span><br><span class="line">&#125; </span><br><span class="line">setImmediate(sixth2);</span><br></pre></td></tr></table></figure><p>获取枚举所有实现类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Java.perform(function()&#123;</span><br><span class="line">    Java.enumerateLoadedClasses(&#123;</span><br><span class="line">        &quot;onMatch&quot; : function(classname)&#123;</span><br><span class="line">            if(classname.indexOf(&quot;com.csair.mbp&quot;) &lt; 0)&#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; 实现类 implements</span><br><span class="line">            try&#123;</span><br><span class="line">                var hookCls &#x3D; Java.use(classname)</span><br><span class="line">                var interFaces &#x3D; hookCls.class.getInterfaces();</span><br><span class="line">                if (interFaces.length &gt; 0) &#123;</span><br><span class="line">                    console.log(classname)</span><br><span class="line">                    for (var i in interFaces) &#123;</span><br><span class="line">                        &#x2F;&#x2F; 接口类 interFaces</span><br><span class="line">                        console.log(&quot;\t&quot;, interFaces[i].toString())</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;         </span><br><span class="line">                &#125;catch(e)&#123;</span><br><span class="line">                    console.log(e)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &quot;onComplete&quot; : function()&#123;&#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h2 id="kgb-messenger"><a href="#kgb-messenger" class="headerlink" title="kgb-messenger"></a>kgb-messenger</h2><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221011174718043.png" alt="image-20221011174718043"></p><p>R.string.User在资源文件的resources.arsc/res/valus/strings.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function hook_java() &#123; </span><br><span class="line"></span><br><span class="line">    Java.perform(function () &#123; </span><br><span class="line">        var System &#x3D; Java.use(&quot;java.lang.System&quot;);</span><br><span class="line">        console.log(System);</span><br><span class="line">        &#x2F;&#x2F;frida -U --no-pause -f  com.tlamb96.spetsnazmessenger -l hook.js</span><br><span class="line">        &#x2F;&#x2F;hook System, </span><br><span class="line">        System.getProperty.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (key) &#123;</span><br><span class="line">            var result &#x3D; this.getProperty(key);</span><br><span class="line">            result &#x3D; &quot;Russia&quot;;</span><br><span class="line">            console.log(&quot;System.getProperty:&quot;, key, result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.getenv.overload(&#39;java.lang.String&#39;).implementation &#x3D; function (key) &#123;</span><br><span class="line">            var result &#x3D; this.getProperty(key);</span><br><span class="line">            result &#x3D; &quot;RkxBR3s1N0VSTDFOR180UkNIM1J9Cg&#x3D;&#x3D;&quot;;</span><br><span class="line">            console.log(&quot;System.getenv:&quot;, key, result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012080840299.png" alt="image-20221012080840299"></p><p>R.string.username在资源文件的resources.arsc/res/valus/strings.xml</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012081407315.png" alt="image-20221012081407315"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012081924781.png" alt="image-20221012081924781"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012082145842.png" alt="image-20221012082145842"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012082555162.png" alt="image-20221012082555162"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">function hook_java() &#123;</span><br><span class="line">    &#x2F;&#x2F;var ddex &#x3D; Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;ddex.dex&quot;);</span><br><span class="line">    &#x2F;&#x2F;frida动态加载了dex</span><br><span class="line">    &#x2F;*</span><br><span class="line">    jar -cvf ddex.jar com&#x2F;example&#x2F;androiddemo&#x2F;DecodeUtils.class</span><br><span class="line">    &#x2F;Users&#x2F;yang&#x2F;Library&#x2F;Android&#x2F;sdk&#x2F;build-tools&#x2F;28.0.3&#x2F;dx --dex --output&#x3D;ddex.dex ddex.jar  生成dex的类DecodeUtils用来实现a算法逆向</span><br><span class="line">    *&#x2F;</span><br><span class="line">    var ddex2 &#x3D; Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;ddex2.dex&quot;);</span><br><span class="line"></span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        &#x2F;&#x2F;frida动态加载了dex</span><br><span class="line">        ddex2.load();</span><br><span class="line">        var DecodeUtils &#x3D; Java.use(&quot;com.example.androiddemo.DecodeUtils&quot;);</span><br><span class="line">        console.log(&quot;DecodeUtils.decode_p:&quot;, DecodeUtils.decode_p());</span><br><span class="line">        console.log(&quot;r to hex&quot;, DecodeUtils.r_to_hex());</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        var a &#x3D; Java.use(&quot;com.tlamb96.kgbmessenger.b.a&quot;);</span><br><span class="line">        &#x2F;&#x2F;hook 构造函数</span><br><span class="line">        a.$init.implementation &#x3D; function (i, str, str2, z) &#123;</span><br><span class="line">            this.$init(i, str, str2, z);</span><br><span class="line">            console.log(&quot;a.$init:&quot;, i, str, str2, z);</span><br><span class="line">            print_stack();       &#x2F;&#x2F;打印了调用栈找到com.tlamb96.kgbmessenger.MessengerActivity.a</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        var MessengerActivity &#x3D; Java.use(&quot;com.tlamb96.kgbmessenger.MessengerActivity&quot;);</span><br><span class="line">        MessengerActivity.a.implementation &#x3D; function (str) &#123;</span><br><span class="line">            console.log(&quot;MessengerActivity.a:&quot;, str);</span><br><span class="line">            var result &#x3D; this.a(str);</span><br><span class="line">            console.log(&quot;MessengerActivity.a:&quot;, str, result);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function print_stack() &#123;</span><br><span class="line">    Java.perform(function () &#123;</span><br><span class="line">        var Exception &#x3D; Java.use(&quot;java.lang.Exception&quot;);</span><br><span class="line">        var instance &#x3D; Exception.$new(&quot;print_stack&quot;);</span><br><span class="line">        var stack &#x3D; instance.getStackTrace();</span><br><span class="line">        console.log(stack);</span><br><span class="line">        instance.$dispose();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012083108436.png" alt="image-20221012083108436"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012083120793.png" alt="image-20221012083120793"></p><p>先解密r为text字符串，需要用到z3的库</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20221012083317771.png" alt="image-20221012083317771"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf ddex.jar com&#x2F;example&#x2F;androiddemo&#x2F;DecodeUtils.class</span><br><span class="line">&#x2F;Users&#x2F;yang&#x2F;Library&#x2F;Android&#x2F;sdk&#x2F;build-tools&#x2F;28.0.3&#x2F;dx --dex --output&#x3D;ddex.dex ddex.jar  生成dex的类DecodeUtils用来实现r的16进制字符串为0064736c707d6f510020646b73247c4d0068202b4159516700502a214d24675100</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line">&#x2F;&#x2F; pip install z3-solver</span><br><span class="line">from binascii import b2a_hex, a2b_hex</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    s &#x3D; Solver()</span><br><span class="line"></span><br><span class="line">    r &#x3D; &quot;0064736c707d6f510020646b73247c4d0068202b4159516700502a214d24675100&quot;</span><br><span class="line">    &#x2F;&#x2F; 转成byte数组</span><br><span class="line">    r_result &#x3D; bytearray(a2b_hex(r))</span><br><span class="line">    print(r_result)</span><br><span class="line">    &#x2F;&#x2F; 字符串翻转</span><br><span class="line">    for i in range(int(len(r_result) &#x2F; 2)):</span><br><span class="line">        c &#x3D; r_result[i]</span><br><span class="line">        r_result[i] &#x3D; r_result[len(r_result) - i - 1]</span><br><span class="line">        r_result[len(r_result) - i - 1] &#x3D; c</span><br><span class="line"></span><br><span class="line">    print(b2a_hex(r_result))</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 将反转字符串转成字节数组</span><br><span class="line">    x &#x3D; [BitVec(&quot;x%s&quot; % i, 32) for i in range(len(r_result))]</span><br><span class="line">    for i in range(len(r_result)):</span><br><span class="line">        c &#x3D; r_result[i]</span><br><span class="line">        print(i, hex(c))</span><br><span class="line">        s.add(((x[i] &gt;&gt; (i % 8)) ^ x[i]) &#x3D;&#x3D; r_result[i])        #z3</span><br><span class="line">    &#x2F;&#x2F; Solver转为字符串</span><br><span class="line">    if (s.check() &#x3D;&#x3D; sat):</span><br><span class="line">        model &#x3D; (s.model())</span><br><span class="line">        print(model)</span><br><span class="line">        flag &#x3D; &quot;&quot;</span><br><span class="line">        for i in range(len(r_result)):</span><br><span class="line">            if (model[x[i]] !&#x3D; None):</span><br><span class="line">                flag +&#x3D; chr(model[x[i]].as_long().real)</span><br><span class="line">            else:</span><br><span class="line">                flag +&#x3D; &quot; &quot;</span><br><span class="line">        print(&#39;&quot;&#39; + flag + &#39;&quot;&#39;)</span><br><span class="line">        print(len(flag), len(r_result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">    private String b(String str) &#123;</span><br><span class="line">        char[] charArray &#x3D; str.toCharArray();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; charArray.length; i++) &#123;</span><br><span class="line">            charArray[i] &#x3D; (char) ((charArray[i] &gt;&gt; (i % 8)) ^ charArray[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 字符串翻转</span><br><span class="line">        for (int i2 &#x3D; 0; i2 &lt; charArray.length &#x2F; 2; i2++) &#123;</span><br><span class="line">            char c &#x3D; charArray[i2];</span><br><span class="line">            charArray[i2] &#x3D; charArray[(charArray.length - i2) - 1];</span><br><span class="line">            charArray[(charArray.length - i2) - 1] &#x3D; c;</span><br><span class="line">        &#125;</span><br><span class="line">        return new String(charArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure><h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><h3 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h3><p>lesson7lesson4.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function invoke()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        Java.choose(&quot;com.example.lesson4one.MainActivity&quot;,&#123;</span><br><span class="line">            onMatch:function(instance)&#123;</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance)</span><br><span class="line">                console.log(&quot;found instance :&quot;,instance.secret())</span><br><span class="line">            &#125;,onComplete:function()&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125; </span><br><span class="line">&#x2F;&#x2F;setTimeout(invoke,2000)   主动调用 </span><br><span class="line">rpc.exports &#x3D; &#123;</span><br><span class="line">    invokefunc:invoke</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>lesson7loader.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import frida</span><br><span class="line"></span><br><span class="line"># frida默认27042  .&#x2F;fs1280arm4 -l 0.0.0.0:9999</span><br><span class="line">def my_message_handler(message,payload):</span><br><span class="line">    print(message)</span><br><span class="line">    print(payload)</span><br><span class="line"></span><br><span class="line">#device &#x3D; frida.get_usb_device()  wifi连接可以实现多主机多手机多端口混连</span><br><span class="line">device &#x3D; frida.get_device_manager().add_remote_device(&quot;192.168.1.102:9999&quot;)</span><br><span class="line">#device &#x3D; frida.get_device_manager().add_remote_device(&quot;192.168.1.109:9999&quot;)</span><br><span class="line"># 枚举所有进程</span><br><span class="line">print(device.enumerate_processes())</span><br><span class="line"># spawn模式</span><br><span class="line">#pid &#x3D; device.spawn([&quot;com.example.lesson4one&quot;])</span><br><span class="line">#device.resume</span><br><span class="line">#time.sleep(1)</span><br><span class="line">#session &#x3D; device.attach(pid)</span><br><span class="line"># attach模式</span><br><span class="line">session &#x3D; device.attach(&quot;com.example.lesson4one&quot;)</span><br><span class="line">with open(&quot;lesson7lesson4.js&quot;) as f :</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.on(&quot;message&quot;,my_message_handler)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">command &#x3D; &quot;&quot;</span><br><span class="line">while True :</span><br><span class="line">    command &#x3D; input(&quot;Enter Command:&quot;)</span><br><span class="line">    if command &#x3D;&#x3D; &quot;1&quot;:</span><br><span class="line">        break</span><br><span class="line">    elif command &#x3D;&#x3D; &quot;2&quot;:</span><br><span class="line">        script.exports.invokefunc()</span><br></pre></td></tr></table></figure><h3 id="接受回调"><a href="#接受回调" class="headerlink" title="接受回调"></a>接受回调</h3><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503211944602.png" alt="image-20220503211944602"></p><p>lesson7sec.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function()&#123;</span><br><span class="line">	Java.use(&quot;android.widget.TextView&quot;).setText.overload(&#39;java.lang.CharSequence&#39;).implementation &#x3D; function(x)&#123;</span><br><span class="line">		var string_to_send_x &#x3D; x.toString();</span><br><span class="line">		var string_to_recv;</span><br><span class="line">		&#x2F;&#x2F; 发送</span><br><span class="line">		send(string_to_send_x);</span><br><span class="line">		&#x2F;&#x2F; 回调</span><br><span class="line">		recv(function(received_json_objection)&#123;</span><br><span class="line">			string_to_recv &#x3D; received_json_objection.my_data</span><br><span class="line">			console.log(&quot;string_to_recv:&quot;+string_to_recv)</span><br><span class="line">		&#125;).wait();</span><br><span class="line">		var javaStringToSend&#x3D;Java.use(&#39;java.lang.String&#39;).$new(string_to_recv);</span><br><span class="line"></span><br><span class="line">		var result &#x3D; this.setText(javaStringToSend);</span><br><span class="line">		&#x2F;&#x2F;console.log(&quot;x.toString(),result&quot;,x.toString(),result);</span><br><span class="line">		return result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>lesson7secloader.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import frida</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def my_message_handler(message,payload):</span><br><span class="line">    print(message)</span><br><span class="line">    print(payload)</span><br><span class="line">    if message[&quot;type&quot;]&#x3D;&#x3D;&quot;send&quot;:</span><br><span class="line">        print(message[&quot;payload&quot;])</span><br><span class="line">        data &#x3D; message[&quot;payload&quot;].split(&quot;:&quot;)[1].strip()</span><br><span class="line">        print(&#39;message:&#39;,message)</span><br><span class="line">        data &#x3D; str(base64.b64decode(data))</span><br><span class="line">        print(&#39;data:&#39;,data)</span><br><span class="line">        usr,pw &#x3D; data.split(&quot;:&quot;)</span><br><span class="line">        print(&#39;pw:&#39;,pw)</span><br><span class="line">        &#x2F;&#x2F; 修改输入用户名改为admin</span><br><span class="line">        data &#x3D; str(base64.b64encode((&quot;admin&quot;+&quot;:&quot;+pw).encode()))</span><br><span class="line">        print(&quot;encode data:&quot;,data)</span><br><span class="line">        script.post(&#123;&quot;my_data&quot;:data&#125;)</span><br><span class="line">        print(&quot;Modified data sent !&quot;)</span><br><span class="line"></span><br><span class="line">device &#x3D; frida.get_usb_device()</span><br><span class="line"></span><br><span class="line">#pid &#x3D; device.spawn([&quot;com.example.lesson4one&quot;])</span><br><span class="line">#device.resume</span><br><span class="line">#time.sleep(1)</span><br><span class="line">#session &#x3D; device.attach(pid)</span><br><span class="line">session &#x3D; device.attach(&quot;com.example.lesson7sec&quot;)</span><br><span class="line">with open(&quot;lesson7sec.js&quot;) as f :</span><br><span class="line">    script &#x3D; session.create_script(f.read())</span><br><span class="line">script.on(&quot;message&quot;,my_message_handler)</span><br><span class="line">script.load()</span><br><span class="line">input()</span><br></pre></td></tr></table></figure><h2 id="NPS"><a href="#NPS" class="headerlink" title="NPS"></a><a href="https://ehang-io.github.io/nps/#/" target="_blank" rel="noopener">NPS</a></h2><p>内网穿透代理，<a href="https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz" target="_blank" rel="noopener">linux_amd64_server.tar.gz</a>服务端，<a href="https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_client.tar.gz" target="_blank" rel="noopener">linux_amd64_client.tar.gz</a>客户端，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo .&#x2F;nps install</span><br><span class="line">sudo nps start  启动服务端</span><br></pre></td></tr></table></figure><p>新增客户端，复制客户端命令在客户端运行即可</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220503234945838.png" alt="image-20220503234945838"></p><p>客户端启动frida ./fs1280arm64 -l 0.0.0.0:8888 ，新增TCP隧道，将内网端口8888映射到公网58888，其中的目标可以填入很多IP:端口进行映射</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504093204899.png" alt="image-20220504093204899"></p><h2 id="Zentrace"><a href="#Zentrace" class="headerlink" title="Zentrace"></a>Zentrace</h2><p>批量hook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># pyenv install 3.8.0</span><br><span class="line"># git clone https:&#x2F;&#x2F;github.com&#x2F;hluwa&#x2F;ZenTracer</span><br><span class="line"># cd ZenTracer</span><br><span class="line"># pyenv local 3.8.0</span><br><span class="line"># python -m pip install --upgrade pip</span><br><span class="line"># pip install PyQt5</span><br><span class="line"># pip install frida-tools</span><br><span class="line"># python ZenTracer.py</span><br></pre></td></tr></table></figure><ol><li>点击打开“设置”应用；</li><li>选择<code>Action</code>→<code>Match RegEx</code></li><li>输入<code>E:java.io.File</code>，点击<code>add</code>，然后关闭窗口</li><li>点击<code>Action</code>→<code>Start</code></li></ol><p>可以观察到<code>java.io.File</code>类的所有方法都被<code>hook</code>了，，并且像<code>java.io.File.createTempFile</code>方法的所有重载也被<code>hook</code>了</p><ol><li>点击<code>Action</code>→<code>Stop</code>，再点击<code>Action</code>→<code>Clean</code>，本次观察结束。</li><li>也可以使用模糊匹配模式，比如输入<code>M:java.io.File</code>之后，会将诸如<code>java.io.FileOutputStream</code>类的诸多方法也都<code>hook</code>上，不过无法打印调用栈，无法<code>hook</code>构造函数，也就是<code>$init</code>。</li></ol><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>过弹窗</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android hooking list activities</span><br><span class="line">android intent launch_activity com.tlamb96.spetsnazmessenger.LoginActivity</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504100541720.png" alt="image-20220504100541720"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504100812302.png" alt="image-20220504100812302"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123; </span><br><span class="line">        Java.use(&quot;java.lang.System&quot;).getProperty.overload(&#39;java.lang.String&#39;).implementation &#x3D; function(x)&#123;</span><br><span class="line">            var result &#x3D; this.getProperty(x);</span><br><span class="line">            console.log(&quot;x,result:&quot;,x,result);</span><br><span class="line">            return Java.use(&quot;java.lang.String&quot;).$new(&quot;Russia&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        Java.use(&quot;java.lang.System&quot;).getenv.overload(&#39;java.lang.String&#39;).implementation &#x3D; function(x)&#123;</span><br><span class="line">            var result &#x3D; this.getenv(x);</span><br><span class="line">            console.log(&quot;x,result:&quot;,x,result);</span><br><span class="line">            return Java.use(&quot;java.lang.String&quot;).$new(&quot;RkxBR3s1N0VSTDFOR180UkNIM1J9Cg&#x3D;&#x3D;&quot;);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p>过登录</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504102554204.png" alt="image-20220504102554204"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504101049048.png" alt="image-20220504101049048"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504102629422.png" alt="image-20220504102629422"></p><p>username:codenameduchess</p><p>password:guest</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504103051069.png" alt="image-20220504103051069"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123; </span><br><span class="line">        &#x2F;&#x2F; 发消息</span><br><span class="line">        Java.use(&quot;com.tlamb96.kgbmessenger.b.a&quot;).$init.implementation &#x3D; function(str0,str1,str2,b)&#123;</span><br><span class="line">            var result &#x3D; this.$init(str0,str1,str2,b);</span><br><span class="line">            console.log(Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()));</span><br><span class="line">            console.log(&quot;str0,str1,str2,b:&quot;,str0,str1,str2,b)</span><br><span class="line">            return result;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504103555933.png" alt="image-20220504103555933"></p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504103541100.png" alt="image-20220504103541100"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123; </span><br><span class="line">        Java.use(&quot;com.tlamb96.kgbmessenger.MessengerActivity&quot;).a.implementation &#x3D; function(x)&#123;            </span><br><span class="line">            var result &#x3D; this.a(x);</span><br><span class="line">            console.log(&quot;a:x,result:&quot;,x,result);</span><br><span class="line">            if(x&#x3D;&#x3D;&quot;aaaa&quot;)&#123;</span><br><span class="line">                result&#x3D; Java.use(&quot;java.lang.String&quot;).$new(&quot;V@]EAASB\u0012WZF\u0012e,a$7(&amp;am2(3.\u0003&quot;);            </span><br><span class="line">            &#125;</span><br><span class="line">            return result;</span><br><span class="line">        &#125; </span><br><span class="line">        Java.use(&quot;com.tlamb96.kgbmessenger.MessengerActivity&quot;).b.implementation &#x3D; function(x)&#123;</span><br><span class="line">            var result &#x3D; this.b(x);</span><br><span class="line">            console.log(&quot;b:x,result:&quot;,x,result);</span><br><span class="line">            if(x&#x3D;&#x3D;&quot;bbbb&quot;)&#123;</span><br><span class="line">                result&#x3D; Java.use(&quot;java.lang.String&quot;).$new(&quot;\u0000dslp&#125;oQ\u0000 dks$|M\u0000h +AYQg\u0000P*!M$gQ\u0000&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            return result;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p>逆向实现</p><p><img src="/2022/05/01/Frida%E9%80%86%E5%90%91%E4%B8%8E%E5%88%A9%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96/image-20220504113057434.png" alt="image-20220504113057434"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class reverseA &#123;</span><br><span class="line">    public static String decode_P()&#123;</span><br><span class="line">        String p &#x3D; &quot;V@]EAASB\u0012WZF\u0012e,a$7(&amp;am2(3.\u0003&quot;;</span><br><span class="line">        String result &#x3D; a(p);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static String a(String str) &#123;</span><br><span class="line">        char[] charArray &#x3D; str.toCharArray();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; charArray.length &#x2F; 2; i++) &#123;</span><br><span class="line">            char c &#x3D; charArray[i];</span><br><span class="line">            charArray[i] &#x3D; (char) (charArray[(charArray.length - i) - 1] ^ &#39;A&#39;);</span><br><span class="line">            charArray[(charArray.length - i) - 1] &#x3D; (char) (c ^ &#39;2&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">        return new String(charArray);</span><br><span class="line">    &#125;</span><br><span class="line">    public static String r_to_hex()&#123;</span><br><span class="line">        String r &#x3D; &quot;\u0000dslp&#125;oQ\u0000 dks$|M\u0000h +AYQg\u0000P*!M$gQ\u0000&quot;;</span><br><span class="line"></span><br><span class="line">        byte[] bytes &#x3D; r.getBytes();</span><br><span class="line">        String result &#x3D; &quot;&quot;;</span><br><span class="line">        for(int i&#x3D;0;i&lt;bytes.length;i++)&#123;</span><br><span class="line">            result +&#x3D; String.format(&quot;%02x&quot;,bytes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将class文件打包成dex，d8 reverseA.class</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123; </span><br><span class="line">        Java.openClassFile(&quot;&#x2F;data&#x2F;local&#x2F;tmp&#x2F;classes.dex&quot;).load();</span><br><span class="line">        const reverseA &#x3D; Java.use(&#39;com.example.lesson9.reverseA&#39;);</span><br><span class="line">        console.log(&quot;reverseA result:&quot;,reverseA.decode_P());</span><br><span class="line">        console.log(&quot;r_to_hex result:&quot;,reverseA.r_to_hex());</span><br><span class="line"> </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure><p>pip install z3-solver</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line">from binascii import b2a_hex,a2b_hex</span><br><span class="line"></span><br><span class="line">s &#x3D;Solver()</span><br><span class="line"></span><br><span class="line">r &#x3D; &quot;0064736c707d6f510020646b73247c4d0068202b4159516700502a214d24675100&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r_result &#x3D; bytearray(a2b_hex(r))</span><br><span class="line">print(r_result)</span><br><span class="line"></span><br><span class="line">for i in range(int(len(r_result)&#x2F;2)) :</span><br><span class="line">    c &#x3D; r_result[i]</span><br><span class="line">    r_result[i] &#x3D; r_result[len(r_result)-i-1]</span><br><span class="line">    r_result[len(r_result)-i-1] &#x3D; c</span><br><span class="line">print(b2a_hex(r_result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x &#x3D; [BitVec(&quot;x%s&quot; % i, 32) for i in range(len(r_result))]</span><br><span class="line">for i in range(len(r_result)):</span><br><span class="line">    c &#x3D; r_result[i]</span><br><span class="line">    print(i,hex(c))</span><br><span class="line">    s.add(((x[i] &gt;&gt; (i % 8)) ^ x[i] ) &#x3D;&#x3D; r_result[i])</span><br><span class="line">if (s.check() &#x3D;&#x3D; sat):</span><br><span class="line">    model &#x3D; s.model()</span><br><span class="line">    print(model)</span><br><span class="line">    flag&#x3D;&quot;&quot;</span><br><span class="line">    for i in range(len(r_result)):</span><br><span class="line">        if (model[x[i]] !&#x3D; None):</span><br><span class="line">            flag +&#x3D; chr(model[x[i]].as_long().real)</span><br><span class="line">        else:</span><br><span class="line">            flag +&#x3D; &quot; &quot;</span><br><span class="line">    print(&#39;&quot;&#39; + flag + &#39;&quot;&#39;)</span><br><span class="line">    print(len(flag), len(r_result))</span><br></pre></td></tr></table></figure><p>adb shell</p><p>input text “aaa” 输入adb</p></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"25827-1638538754631-918",name:"万物皆可逆向",qrcode:"https://onejane.github.io/gzh.jpg",keyword:"密码"})}</script></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">J</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://onejane.github.io/2022/05/01/Frida逆向与利用自动化/">http://onejane.github.io/2022/05/01/Frida逆向与利用自动化/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://onejane.github.io">万物皆可逆向</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frida/">frida</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/alipay.png"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://onejane.gitee.io/picture/wx.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/05/04/Xposed%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A5%E4%B8%81%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"><i class="fa fa-chevron-left"></i> <span>Xposed二进制补丁插件开发</span></a></div><div class="next-post pull-right"><a href="/2022/03/02/%E5%A4%A9%E7%8C%AB%E6%8A%A2%E8%8C%85%E5%8F%B0%E5%88%86%E6%9E%90%E5%AE%9E%E7%8E%B0/"><span>天猫抢茅台分析实现</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,record_ip=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,recordIP:record_ip,appId:"cWLsquGr5PNi33OWXNhzerep-gzGzoHsz",appKey:"S35phfCSbm8dAG9LpOc5rjm3",placeholder:"一起来吹牛逼好吗！",avatar:"mm",guest_info:guest_info,pageSize:"10",lang:"zh-cn"})</script></div></div><footer class="footer-bg" style="background-image:url(http://onejane.gitee.io/picture/kali.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By J</div><div class="framework-info"><span>驱动 -</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"),$("#top-container").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>